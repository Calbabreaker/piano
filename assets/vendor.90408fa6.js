function F(){}function Gt(t){return t&&typeof t=="object"&&typeof t.then=="function"}function Je(t){return t()}function ze(){return Object.create(null)}function H(t){t.forEach(Je)}function Ke(t){return typeof t=="function"}function Wt(t,e){return t!=t?e==e:t!==e||t&&typeof t=="object"||typeof t=="function"}function Yt(t){return Object.keys(t).length===0}function Ge(t,...e){if(t==null)return F;const r=t.subscribe(...e);return r.unsubscribe?()=>r.unsubscribe():r}function Gi(t){let e;return Ge(t,r=>e=r)(),e}function Wi(t,e,r){t.$$.on_destroy.push(Ge(e,r))}function Yi(t,e,r){return t.set(r),e}function Xi(t){return t&&Ke(t.destroy)?t.destroy:F}function Qi(t,e){t.appendChild(e)}function Zi(t,e,r){t.insertBefore(e,r||null)}function Xt(t){t.parentNode.removeChild(t)}function es(t,e){for(let r=0;r<t.length;r+=1)t[r]&&t[r].d(e)}function ts(t){return document.createElement(t)}function We(t){return document.createTextNode(t)}function rs(){return We(" ")}function ns(){return We("")}function is(t,e,r,n){return t.addEventListener(e,r,n),()=>t.removeEventListener(e,r,n)}function ss(t){return function(e){return e.preventDefault(),t.call(this,e)}}function os(t,e,r){r==null?t.removeAttribute(e):t.getAttribute(e)!==r&&t.setAttribute(e,r)}function as(t){return t===""?null:+t}function Qt(t){return Array.from(t.childNodes)}function cs(t,e){e=""+e,t.wholeText!==e&&(t.data=e)}function us(t,e){t.value=e==null?"":e}function hs(t,e,r,n){r===null?t.style.removeProperty(e):t.style.setProperty(e,r,n?"important":"")}function fs(t,e){for(let r=0;r<t.options.length;r+=1){const n=t.options[r];if(n.__value===e){n.selected=!0;return}}t.selectedIndex=-1}function ls(t){const e=t.querySelector(":checked")||t.options[0];return e&&e.__value}function ds(t,e,r){t.classList[r?"add":"remove"](e)}let J;function O(t){J=t}function Zt(){if(!J)throw new Error("Function called outside component initialization");return J}function ps(t,e){const r=t.$$.callbacks[e.type];r&&r.slice().forEach(n=>n.call(this,e))}const z=[],Ye=[],ee=[],Xe=[],er=Promise.resolve();let ge=!1;function tr(){ge||(ge=!0,er.then(ke))}function be(t){ee.push(t)}const ve=new Set;let te=0;function ke(){const t=J;do{for(;te<z.length;){const e=z[te];te++,O(e),rr(e.$$)}for(O(null),z.length=0,te=0;Ye.length;)Ye.pop()();for(let e=0;e<ee.length;e+=1){const r=ee[e];ve.has(r)||(ve.add(r),r())}ee.length=0}while(z.length);for(;Xe.length;)Xe.pop()();ge=!1,ve.clear(),O(t)}function rr(t){if(t.fragment!==null){t.update(),H(t.before_update);const e=t.dirty;t.dirty=[-1],t.fragment&&t.fragment.p(t.ctx,e),t.after_update.forEach(be)}}const re=new Set;let R;function nr(){R={r:0,c:[],p:R}}function ir(){R.r||H(R.c),R=R.p}function Qe(t,e){t&&t.i&&(re.delete(t),t.i(e))}function sr(t,e,r,n){if(t&&t.o){if(re.has(t))return;re.add(t),R.c.push(()=>{re.delete(t),n&&(r&&t.d(1),n())}),t.o(e)}}function ms(t,e){const r=e.token={};function n(i,o,s,a){if(e.token!==r)return;e.resolved=a;let u=e.ctx;s!==void 0&&(u=u.slice(),u[s]=a);const c=i&&(e.current=i)(u);let f=!1;e.block&&(e.blocks?e.blocks.forEach((l,h)=>{h!==o&&l&&(nr(),sr(l,1,1,()=>{e.blocks[h]===l&&(e.blocks[h]=null)}),ir())}):e.block.d(1),c.c(),Qe(c,1),c.m(e.mount(),e.anchor),f=!0),e.block=c,e.blocks&&(e.blocks[o]=c),f&&ke()}if(Gt(t)){const i=Zt();if(t.then(o=>{O(i),n(e.then,1,e.value,o),O(null)},o=>{if(O(i),n(e.catch,2,e.error,o),O(null),!e.hasCatch)throw o}),e.current!==e.pending)return n(e.pending,0),!0}else{if(e.current!==e.then)return n(e.then,1,e.value,t),!0;e.resolved=t}}function ys(t,e,r){const n=e.slice(),{resolved:i}=t;t.current===t.then&&(n[t.value]=i),t.current===t.catch&&(n[t.error]=i),t.block.p(n,r)}const gs=typeof window!="undefined"?window:typeof globalThis!="undefined"?globalThis:global;function bs(t){t&&t.c()}function or(t,e,r,n){const{fragment:i,on_mount:o,on_destroy:s,after_update:a}=t.$$;i&&i.m(e,r),n||be(()=>{const u=o.map(Je).filter(Ke);s?s.push(...u):H(u),t.$$.on_mount=[]}),a.forEach(be)}function ar(t,e){const r=t.$$;r.fragment!==null&&(H(r.on_destroy),r.fragment&&r.fragment.d(e),r.on_destroy=r.fragment=null,r.ctx=[])}function cr(t,e){t.$$.dirty[0]===-1&&(z.push(t),tr(),t.$$.dirty.fill(0)),t.$$.dirty[e/31|0]|=1<<e%31}function vs(t,e,r,n,i,o,s,a=[-1]){const u=J;O(t);const c=t.$$={fragment:null,ctx:null,props:o,update:F,not_equal:i,bound:ze(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(e.context||(u?u.$$.context:[])),callbacks:ze(),dirty:a,skip_bound:!1,root:e.target||u.$$.root};s&&s(c.root);let f=!1;if(c.ctx=r?r(t,e.props||{},(l,h,...m)=>{const d=m.length?m[0]:h;return c.ctx&&i(c.ctx[l],c.ctx[l]=d)&&(!c.skip_bound&&c.bound[l]&&c.bound[l](d),f&&cr(t,l)),h}):[],c.update(),f=!0,H(c.before_update),c.fragment=n?n(c.ctx):!1,e.target){if(e.hydrate){const l=Qt(e.target);c.fragment&&c.fragment.l(l),l.forEach(Xt)}else c.fragment&&c.fragment.c();e.intro&&Qe(t.$$.fragment),or(t,e.target,e.anchor,e.customElement),ke()}O(u)}class ks{$destroy(){ar(this,1),this.$destroy=F}$on(e,r){const n=this.$$.callbacks[e]||(this.$$.callbacks[e]=[]);return n.push(r),()=>{const i=n.indexOf(r);i!==-1&&n.splice(i,1)}}$set(e){this.$$set&&!Yt(e)&&(this.$$.skip_bound=!0,this.$$set(e),this.$$.skip_bound=!1)}}const D=[];function ws(t,e=F){let r;const n=new Set;function i(a){if(Wt(t,a)&&(t=a,r)){const u=!D.length;for(const c of n)c[1](),D.push(c,t);if(u){for(let c=0;c<D.length;c+=2)D[c][0](D[c+1]);D.length=0}}}function o(a){i(a(t))}function s(a,u=F){const c=[a,u];return n.add(c),n.size===1&&(r=e(i)||F),a(t),()=>{n.delete(c),n.size===0&&(r(),r=null)}}return{set:i,update:o,subscribe:s}}var U=typeof globalThis!="undefined"?globalThis:typeof window!="undefined"?window:typeof global!="undefined"?global:typeof self!="undefined"?self:{};function ur(t){if(t.__esModule)return t;var e=Object.defineProperty({},"__esModule",{value:!0});return Object.keys(t).forEach(function(r){var n=Object.getOwnPropertyDescriptor(t,r);Object.defineProperty(e,r,n.get?n:{enumerable:!0,get:function(){return t[r]}})}),e}function ne(t){throw new Error('Could not dynamically require "'+t+'". Please configure the dynamicRequireTargets or/and ignoreDynamicRequires option of @rollup/plugin-commonjs appropriately for this require call to work.')}var ie={},se={};function hr(t){var e=new x(t),r=e.readChunk();if(r.id!="MThd")throw"Bad MIDI file.  Expected 'MHdr', got: '"+r.id+"'";for(var n=fr(r.data),i=[],o=0;!e.eof()&&o<n.numTracks;o++){var s=e.readChunk();if(s.id!="MTrk")throw"Bad MIDI file.  Expected 'MTrk', got: '"+s.id+"'";var a=lr(s.data);i.push(a)}return{header:n,tracks:i}}function fr(t){var e=new x(t),r=e.readUInt16(),n=e.readUInt16(),i={format:r,numTracks:n},o=e.readUInt16();return o&32768?(i.framesPerSecond=256-(o>>8),i.ticksPerFrame=o&255):i.ticksPerBeat=o,i}function lr(t){for(var e=new x(t),r=[];!e.eof();){var n=o();r.push(n)}return r;var i;function o(){var s={};s.deltaTime=e.readVarInt();var a=e.readUInt8();if((a&240)==240)if(a===255){s.meta=!0;var u=e.readUInt8(),c=e.readVarInt();switch(u){case 0:if(s.type="sequenceNumber",c!==2)throw"Expected length for sequenceNumber event is 2, got "+c;return s.number=e.readUInt16(),s;case 1:return s.type="text",s.text=e.readString(c),s;case 2:return s.type="copyrightNotice",s.text=e.readString(c),s;case 3:return s.type="trackName",s.text=e.readString(c),s;case 4:return s.type="instrumentName",s.text=e.readString(c),s;case 5:return s.type="lyrics",s.text=e.readString(c),s;case 6:return s.type="marker",s.text=e.readString(c),s;case 7:return s.type="cuePoint",s.text=e.readString(c),s;case 32:if(s.type="channelPrefix",c!=1)throw"Expected length for channelPrefix event is 1, got "+c;return s.channel=e.readUInt8(),s;case 33:if(s.type="portPrefix",c!=1)throw"Expected length for portPrefix event is 1, got "+c;return s.port=e.readUInt8(),s;case 47:if(s.type="endOfTrack",c!=0)throw"Expected length for endOfTrack event is 0, got "+c;return s;case 81:if(s.type="setTempo",c!=3)throw"Expected length for setTempo event is 3, got "+c;return s.microsecondsPerBeat=e.readUInt24(),s;case 84:if(s.type="smpteOffset",c!=5)throw"Expected length for smpteOffset event is 5, got "+c;var f=e.readUInt8(),l={0:24,32:25,64:29,96:30};return s.frameRate=l[f&96],s.hour=f&31,s.min=e.readUInt8(),s.sec=e.readUInt8(),s.frame=e.readUInt8(),s.subFrame=e.readUInt8(),s;case 88:if(s.type="timeSignature",c!=4)throw"Expected length for timeSignature event is 4, got "+c;return s.numerator=e.readUInt8(),s.denominator=1<<e.readUInt8(),s.metronome=e.readUInt8(),s.thirtyseconds=e.readUInt8(),s;case 89:if(s.type="keySignature",c!=2)throw"Expected length for keySignature event is 2, got "+c;return s.key=e.readInt8(),s.scale=e.readUInt8(),s;case 127:return s.type="sequencerSpecific",s.data=e.readBytes(c),s;default:return s.type="unknownMeta",s.data=e.readBytes(c),s.metatypeByte=u,s}}else if(a==240){s.type="sysEx";var c=e.readVarInt();return s.data=e.readBytes(c),s}else if(a==247){s.type="endSysEx";var c=e.readVarInt();return s.data=e.readBytes(c),s}else throw"Unrecognised MIDI event type byte: "+a;else{var h;if((a&128)==0){if(i===null)throw"Running status byte encountered before status byte";h=a,a=i,s.running=!0}else h=e.readUInt8(),i=a;var m=a>>4;switch(s.channel=a&15,m){case 8:return s.type="noteOff",s.noteNumber=h,s.velocity=e.readUInt8(),s;case 9:var d=e.readUInt8();return s.type=d===0?"noteOff":"noteOn",s.noteNumber=h,s.velocity=d,d===0&&(s.byte9=!0),s;case 10:return s.type="noteAftertouch",s.noteNumber=h,s.amount=e.readUInt8(),s;case 11:return s.type="controller",s.controllerType=h,s.value=e.readUInt8(),s;case 12:return s.type="programChange",s.programNumber=h,s;case 13:return s.type="channelAftertouch",s.amount=h,s;case 14:return s.type="pitchBend",s.value=h+(e.readUInt8()<<7)-8192,s;default:throw"Unrecognised MIDI event type: "+m}}}}function x(t){this.buffer=t,this.bufferLen=this.buffer.length,this.pos=0}x.prototype.eof=function(){return this.pos>=this.bufferLen};x.prototype.readUInt8=function(){var t=this.buffer[this.pos];return this.pos+=1,t};x.prototype.readInt8=function(){var t=this.readUInt8();return t&128?t-256:t};x.prototype.readUInt16=function(){var t=this.readUInt8(),e=this.readUInt8();return(t<<8)+e};x.prototype.readInt16=function(){var t=this.readUInt16();return t&32768?t-65536:t};x.prototype.readUInt24=function(){var t=this.readUInt8(),e=this.readUInt8(),r=this.readUInt8();return(t<<16)+(e<<8)+r};x.prototype.readInt24=function(){var t=this.readUInt24();return t&8388608?t-16777216:t};x.prototype.readUInt32=function(){var t=this.readUInt8(),e=this.readUInt8(),r=this.readUInt8(),n=this.readUInt8();return(t<<24)+(e<<16)+(r<<8)+n};x.prototype.readBytes=function(t){var e=this.buffer.slice(this.pos,this.pos+t);return this.pos+=t,e};x.prototype.readString=function(t){var e=this.readBytes(t);return String.fromCharCode.apply(null,e)};x.prototype.readVarInt=function(){for(var t=0;!this.eof();){var e=this.readUInt8();if(e&128)t+=e&127,t<<=7;else return t+e}return t};x.prototype.readChunk=function(){var t=this.readString(4),e=this.readUInt32(),r=this.readBytes(e);return{id:t,length:e,data:r}};var dr=hr;function pr(t,e){if(typeof t!="object")throw"Invalid MIDI data";e=e||{};var r=t.header||{},n=t.tracks||[],i,o=n.length,s=new w;for(mr(s,r,o),i=0;i<o;i++)yr(s,n[i],e);return s.buffer}function mr(t,e,r){var n=e.format==null?1:e.format,i=128;e.timeDivision?i=e.timeDivision:e.ticksPerFrame&&e.framesPerSecond?i=-(e.framesPerSecond&255)<<8|e.ticksPerFrame&255:e.ticksPerBeat&&(i=e.ticksPerBeat&32767);var o=new w;o.writeUInt16(n),o.writeUInt16(r),o.writeUInt16(i),t.writeChunk("MThd",o.buffer)}function yr(t,e,r){var n=new w,i,o=e.length,s=null;for(i=0;i<o;i++)(r.running===!1||!r.running&&!e[i].running)&&(s=null),s=gr(n,e[i],s,r.useByte9ForNoteOff);t.writeChunk("MTrk",n.buffer)}function gr(t,e,r,n){var i=e.type,o=e.deltaTime,s=e.text||"",a=e.data||[],u=null;switch(t.writeVarInt(o),i){case"sequenceNumber":t.writeUInt8(255),t.writeUInt8(0),t.writeVarInt(2),t.writeUInt16(e.number);break;case"text":t.writeUInt8(255),t.writeUInt8(1),t.writeVarInt(s.length),t.writeString(s);break;case"copyrightNotice":t.writeUInt8(255),t.writeUInt8(2),t.writeVarInt(s.length),t.writeString(s);break;case"trackName":t.writeUInt8(255),t.writeUInt8(3),t.writeVarInt(s.length),t.writeString(s);break;case"instrumentName":t.writeUInt8(255),t.writeUInt8(4),t.writeVarInt(s.length),t.writeString(s);break;case"lyrics":t.writeUInt8(255),t.writeUInt8(5),t.writeVarInt(s.length),t.writeString(s);break;case"marker":t.writeUInt8(255),t.writeUInt8(6),t.writeVarInt(s.length),t.writeString(s);break;case"cuePoint":t.writeUInt8(255),t.writeUInt8(7),t.writeVarInt(s.length),t.writeString(s);break;case"channelPrefix":t.writeUInt8(255),t.writeUInt8(32),t.writeVarInt(1),t.writeUInt8(e.channel);break;case"portPrefix":t.writeUInt8(255),t.writeUInt8(33),t.writeVarInt(1),t.writeUInt8(e.port);break;case"endOfTrack":t.writeUInt8(255),t.writeUInt8(47),t.writeVarInt(0);break;case"setTempo":t.writeUInt8(255),t.writeUInt8(81),t.writeVarInt(3),t.writeUInt24(e.microsecondsPerBeat);break;case"smpteOffset":t.writeUInt8(255),t.writeUInt8(84),t.writeVarInt(5);var c={24:0,25:32,29:64,30:96},f=e.hour&31|c[e.frameRate];t.writeUInt8(f),t.writeUInt8(e.min),t.writeUInt8(e.sec),t.writeUInt8(e.frame),t.writeUInt8(e.subFrame);break;case"timeSignature":t.writeUInt8(255),t.writeUInt8(88),t.writeVarInt(4),t.writeUInt8(e.numerator);var l=Math.floor(Math.log(e.denominator)/Math.LN2)&255;t.writeUInt8(l),t.writeUInt8(e.metronome),t.writeUInt8(e.thirtyseconds||8);break;case"keySignature":t.writeUInt8(255),t.writeUInt8(89),t.writeVarInt(2),t.writeInt8(e.key),t.writeUInt8(e.scale);break;case"sequencerSpecific":t.writeUInt8(255),t.writeUInt8(127),t.writeVarInt(a.length),t.writeBytes(a);break;case"unknownMeta":e.metatypeByte!=null&&(t.writeUInt8(255),t.writeUInt8(e.metatypeByte),t.writeVarInt(a.length),t.writeBytes(a));break;case"sysEx":t.writeUInt8(240),t.writeVarInt(a.length),t.writeBytes(a);break;case"endSysEx":t.writeUInt8(247),t.writeVarInt(a.length),t.writeBytes(a);break;case"noteOff":var h=n!==!1&&e.byte9||n&&e.velocity==0?144:128;u=h|e.channel,u!==r&&t.writeUInt8(u),t.writeUInt8(e.noteNumber),t.writeUInt8(e.velocity);break;case"noteOn":u=144|e.channel,u!==r&&t.writeUInt8(u),t.writeUInt8(e.noteNumber),t.writeUInt8(e.velocity);break;case"noteAftertouch":u=160|e.channel,u!==r&&t.writeUInt8(u),t.writeUInt8(e.noteNumber),t.writeUInt8(e.amount);break;case"controller":u=176|e.channel,u!==r&&t.writeUInt8(u),t.writeUInt8(e.controllerType),t.writeUInt8(e.value);break;case"programChange":u=192|e.channel,u!==r&&t.writeUInt8(u),t.writeUInt8(e.programNumber);break;case"channelAftertouch":u=208|e.channel,u!==r&&t.writeUInt8(u),t.writeUInt8(e.amount);break;case"pitchBend":u=224|e.channel,u!==r&&t.writeUInt8(u);var m=8192+e.value,d=m&127,b=m>>7&127;t.writeUInt8(d),t.writeUInt8(b);break;default:throw"Unrecognized event type: "+i}return u}function w(){this.buffer=[]}w.prototype.writeUInt8=function(t){this.buffer.push(t&255)};w.prototype.writeInt8=w.prototype.writeUInt8;w.prototype.writeUInt16=function(t){var e=t>>8&255,r=t&255;this.writeUInt8(e),this.writeUInt8(r)};w.prototype.writeInt16=w.prototype.writeUInt16;w.prototype.writeUInt24=function(t){var e=t>>16&255,r=t>>8&255,n=t&255;this.writeUInt8(e),this.writeUInt8(r),this.writeUInt8(n)};w.prototype.writeInt24=w.prototype.writeUInt24;w.prototype.writeUInt32=function(t){var e=t>>24&255,r=t>>16&255,n=t>>8&255,i=t&255;this.writeUInt8(e),this.writeUInt8(r),this.writeUInt8(n),this.writeUInt8(i)};w.prototype.writeInt32=w.prototype.writeUInt32;w.prototype.writeBytes=function(t){this.buffer=this.buffer.concat(Array.prototype.slice.call(t,0))};w.prototype.writeString=function(t){var e,r=t.length,n=[];for(e=0;e<r;e++)n.push(t.codePointAt(e));this.writeBytes(n)};w.prototype.writeVarInt=function(t){if(t<0)throw"Cannot write negative variable-length integer";if(t<=127)this.writeUInt8(t);else{var e=t,r=[];for(r.push(e&127),e>>=7;e;){var n=e&127|128;r.push(n),e>>=7}this.writeBytes(r.reverse())}};w.prototype.writeChunk=function(t,e){this.writeString(t),this.writeUInt32(e.length),this.writeBytes(e)};var br=pr;se.parseMidi=dr;se.writeMidi=br;var we={},oe={},K={};Object.defineProperty(K,"__esModule",{value:!0});function Ze(t,e,r){r===void 0&&(r="ticks");var n=0,i=t.length,o=i;if(i>0&&t[i-1][r]<=e)return i-1;for(;n<o;){var s=Math.floor(n+(o-n)/2),a=t[s],u=t[s+1];if(a[r]===e){for(var c=s;c<t.length;c++){var f=t[c];f[r]===e&&(s=c)}return s}else{if(a[r]<e&&u[r]>e)return s;a[r]>e?o=s:a[r]<e&&(n=s+1)}}return-1}K.search=Ze;function vr(t,e,r){if(r===void 0&&(r="ticks"),t.length){var n=Ze(t,e[r],r);t.splice(n+1,0,e)}else t.push(e)}K.insert=vr;(function(t){Object.defineProperty(t,"__esModule",{value:!0});var e=K,r=new WeakMap;t.keySignatureKeys=["Cb","Gb","Db","Ab","Eb","Bb","F","C","G","D","A","E","B","F#","C#"];var n=function(){function i(o){var s=this;this.tempos=[],this.timeSignatures=[],this.keySignatures=[],this.meta=[],this.name="",r.set(this,480),o&&(r.set(this,o.header.ticksPerBeat),o.tracks.forEach(function(a){return a.forEach(function(u){u.meta&&(u.type==="timeSignature"?s.timeSignatures.push({ticks:u.absoluteTime,timeSignature:[u.numerator,u.denominator]}):u.type==="setTempo"?s.tempos.push({bpm:6e7/u.microsecondsPerBeat,ticks:u.absoluteTime}):u.type==="keySignature"&&s.keySignatures.push({key:t.keySignatureKeys[u.key+7],scale:u.scale===0?"major":"minor",ticks:u.absoluteTime}))})}),o.tracks[0].forEach(function(a){a.meta&&(a.type==="trackName"?s.name=a.text:(a.type==="text"||a.type==="cuePoint"||a.type==="marker"||a.type==="lyrics")&&s.meta.push({text:a.text,ticks:a.absoluteTime,type:a.type}))}),this.update())}return i.prototype.update=function(){var o=this,s=0,a=0;this.tempos.sort(function(u,c){return u.ticks-c.ticks}),this.tempos.forEach(function(u,c){var f=c>0?o.tempos[c-1].bpm:o.tempos[0].bpm,l=u.ticks/o.ppq-a,h=60/f*l;u.time=h+s,s=u.time,a+=l}),this.timeSignatures.sort(function(u,c){return u.ticks-c.ticks}),this.timeSignatures.forEach(function(u,c){var f=c>0?o.timeSignatures[c-1]:o.timeSignatures[0],l=(u.ticks-f.ticks)/o.ppq,h=l/f.timeSignature[0]/(f.timeSignature[1]/4);f.measures=f.measures||0,u.measures=h+f.measures})},i.prototype.ticksToSeconds=function(o){var s=e.search(this.tempos,o);if(s!==-1){var a=this.tempos[s],u=a.time,c=(o-a.ticks)/this.ppq;return u+60/a.bpm*c}else{var f=o/this.ppq;return 60/120*f}},i.prototype.ticksToMeasures=function(o){var s=e.search(this.timeSignatures,o);if(s!==-1){var a=this.timeSignatures[s],u=(o-a.ticks)/this.ppq;return a.measures+u/(a.timeSignature[0]/a.timeSignature[1])/4}else return o/this.ppq/4},Object.defineProperty(i.prototype,"ppq",{get:function(){return r.get(this)},enumerable:!0,configurable:!0}),i.prototype.secondsToTicks=function(o){var s=e.search(this.tempos,o,"time");if(s!==-1){var a=this.tempos[s],u=a.time,c=o-u,f=c/(60/a.bpm);return Math.round(a.ticks+f*this.ppq)}else{var l=o/(60/120);return Math.round(l*this.ppq)}},i.prototype.toJSON=function(){return{keySignatures:this.keySignatures,meta:this.meta,name:this.name,ppq:this.ppq,tempos:this.tempos.map(function(o){return{bpm:o.bpm,ticks:o.ticks}}),timeSignatures:this.timeSignatures}},i.prototype.fromJSON=function(o){this.name=o.name,this.tempos=o.tempos.map(function(s){return Object.assign({},s)}),this.timeSignatures=o.timeSignatures.map(function(s){return Object.assign({},s)}),this.keySignatures=o.keySignatures.map(function(s){return Object.assign({},s)}),this.meta=o.meta.map(function(s){return Object.assign({},s)}),r.set(this,o.ppq),this.update()},i.prototype.setTempo=function(o){this.tempos=[{bpm:o,ticks:0}],this.update()},i}();t.Header=n})(oe);var G={exports:{}};G.exports=kr;G.exports.from=et;G.exports.depth=wr;G.exports.fromDepth=tt;function kr(t){if(!Array.isArray(t))throw new TypeError("Expected value to be an array");return et(t)}function et(t){return rt(t,[])}function wr(t,e){if(!Array.isArray(t))throw new TypeError("Expected value to be an array");return tt(t,e)}function tt(t,e){if(typeof e!="number")throw new TypeError("Expected the depth to be a number");return nt(t,[],e)}function rt(t,e){for(var r=0;r<t.length;r++){var n=t[r];Array.isArray(n)?rt(n,e):e.push(n)}return e}function nt(t,e,r){r--;for(var n=0;n<t.length;n++){var i=t[n];r>-1&&Array.isArray(i)?nt(i,e,r):e.push(i)}return e}var xe=U&&U.__spreadArrays||function(){for(var t=0,e=0,r=arguments.length;e<r;e++)t+=arguments[e].length;for(var n=Array(t),i=0,e=0;e<r;e++)for(var o=arguments[e],s=0,a=o.length;s<a;s++,i++)n[i]=o[s];return n},xr=U&&U.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(we,"__esModule",{value:!0});var Tr=se,_r=oe,Ir=xr(G.exports);function Sr(t,e){return[{absoluteTime:t.ticks,channel:e,deltaTime:0,noteNumber:t.midi,type:"noteOn",velocity:Math.floor(t.velocity*127)},{absoluteTime:t.ticks+t.durationTicks,channel:e,deltaTime:0,noteNumber:t.midi,type:"noteOff",velocity:Math.floor(t.noteOffVelocity*127)}]}function Er(t){return Ir.default(t.notes.map(function(e){return Sr(e,t.channel)}))}function Ar(t,e){return{absoluteTime:t.ticks,channel:e,controllerType:t.number,deltaTime:0,type:"controller",value:Math.floor(t.value*127)}}function Or(t){for(var e=[],r=0;r<127;r++)t.controlChanges.hasOwnProperty(r)&&t.controlChanges[r].forEach(function(n){e.push(Ar(n,t.channel))});return e}function Nr(t,e){return{absoluteTime:t.ticks,channel:e,deltaTime:0,type:"pitchBend",value:t.value}}function Cr(t){var e=[];return t.pitchBends.forEach(function(r){e.push(Nr(r,t.channel))}),e}function Ur(t){return{absoluteTime:0,channel:t.channel,deltaTime:0,programNumber:t.instrument.number,type:"programChange"}}function Br(t){return{absoluteTime:0,deltaTime:0,meta:!0,text:t,type:"trackName"}}function Pr(t){return{absoluteTime:t.ticks,deltaTime:0,meta:!0,microsecondsPerBeat:Math.floor(6e7/t.bpm),type:"setTempo"}}function Mr(t){return{absoluteTime:t.ticks,deltaTime:0,denominator:t.timeSignature[1],meta:!0,metronome:24,numerator:t.timeSignature[0],thirtyseconds:8,type:"timeSignature"}}function Fr(t){var e=_r.keySignatureKeys.indexOf(t.key);return{absoluteTime:t.ticks,deltaTime:0,key:e+7,meta:!0,scale:t.scale==="major"?0:1,type:"keySignature"}}function Rr(t){return{absoluteTime:t.ticks,deltaTime:0,meta:!0,text:t.text,type:t.type}}function qr(t){var e={header:{format:1,numTracks:t.tracks.length+1,ticksPerBeat:t.header.ppq},tracks:xe([xe([{absoluteTime:0,deltaTime:0,meta:!0,text:t.header.name,type:"trackName"}],t.header.keySignatures.map(function(r){return Fr(r)}),t.header.meta.map(function(r){return Rr(r)}),t.header.tempos.map(function(r){return Pr(r)}),t.header.timeSignatures.map(function(r){return Mr(r)}))],t.tracks.map(function(r){return xe([Br(r.name),Ur(r)],Er(r),Or(r),Cr(r))}))};return e.tracks=e.tracks.map(function(r){r=r.sort(function(i,o){return i.absoluteTime-o.absoluteTime});var n=0;return r.forEach(function(i){i.deltaTime=i.absoluteTime-n,n=i.absoluteTime,delete i.absoluteTime}),r.push({deltaTime:0,meta:!0,type:"endOfTrack"}),r}),new Uint8Array(Tr.writeMidi(e))}we.encode=qr;var ae={},Te={};(function(t){Object.defineProperty(t,"__esModule",{value:!0}),t.controlChangeNames={1:"modulationWheel",2:"breath",4:"footController",5:"portamentoTime",7:"volume",8:"balance",10:"pan",64:"sustain",65:"portamentoTime",66:"sostenuto",67:"softPedal",68:"legatoFootswitch",84:"portamentoControl"},t.controlChangeIds=Object.keys(t.controlChangeNames).reduce(function(i,o){return i[t.controlChangeNames[o]]=o,i},{});var e=new WeakMap,r=new WeakMap,n=function(){function i(o,s){e.set(this,s),r.set(this,o.controllerType),this.ticks=o.absoluteTime,this.value=o.value}return Object.defineProperty(i.prototype,"number",{get:function(){return r.get(this)},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"name",{get:function(){return t.controlChangeNames[this.number]?t.controlChangeNames[this.number]:null},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"time",{get:function(){var o=e.get(this);return o.ticksToSeconds(this.ticks)},set:function(o){var s=e.get(this);this.ticks=s.secondsToTicks(o)},enumerable:!0,configurable:!0}),i.prototype.toJSON=function(){return{number:this.number,ticks:this.ticks,time:this.time,value:this.value}},i}();t.ControlChange=n})(Te);var _e={};Object.defineProperty(_e,"__esModule",{value:!0});var ce=Te;function Dr(){return new Proxy({},{get:function(t,e){if(t[e])return t[e];if(ce.controlChangeIds.hasOwnProperty(e))return t[ce.controlChangeIds[e]]},set:function(t,e,r){return ce.controlChangeIds.hasOwnProperty(e)?t[ce.controlChangeIds[e]]=r:t[e]=r,!0}})}_e.createControlChanges=Dr;var Ie={};Object.defineProperty(Ie,"__esModule",{value:!0});var Se=new WeakMap,Vr=function(){function t(e,r){Se.set(this,r),this.ticks=e.absoluteTime,this.value=e.value}return Object.defineProperty(t.prototype,"time",{get:function(){var e=Se.get(this);return e.ticksToSeconds(this.ticks)},set:function(e){var r=Se.get(this);this.ticks=r.secondsToTicks(e)},enumerable:!0,configurable:!0}),t.prototype.toJSON=function(){return{ticks:this.ticks,time:this.time,value:this.value}},t}();Ie.PitchBend=Vr;var Ee={},W={};Object.defineProperty(W,"__esModule",{value:!0});W.instrumentByPatchID=["acoustic grand piano","bright acoustic piano","electric grand piano","honky-tonk piano","electric piano 1","electric piano 2","harpsichord","clavi","celesta","glockenspiel","music box","vibraphone","marimba","xylophone","tubular bells","dulcimer","drawbar organ","percussive organ","rock organ","church organ","reed organ","accordion","harmonica","tango accordion","acoustic guitar (nylon)","acoustic guitar (steel)","electric guitar (jazz)","electric guitar (clean)","electric guitar (muted)","overdriven guitar","distortion guitar","guitar harmonics","acoustic bass","electric bass (finger)","electric bass (pick)","fretless bass","slap bass 1","slap bass 2","synth bass 1","synth bass 2","violin","viola","cello","contrabass","tremolo strings","pizzicato strings","orchestral harp","timpani","string ensemble 1","string ensemble 2","synthstrings 1","synthstrings 2","choir aahs","voice oohs","synth voice","orchestra hit","trumpet","trombone","tuba","muted trumpet","french horn","brass section","synthbrass 1","synthbrass 2","soprano sax","alto sax","tenor sax","baritone sax","oboe","english horn","bassoon","clarinet","piccolo","flute","recorder","pan flute","blown bottle","shakuhachi","whistle","ocarina","lead 1 (square)","lead 2 (sawtooth)","lead 3 (calliope)","lead 4 (chiff)","lead 5 (charang)","lead 6 (voice)","lead 7 (fifths)","lead 8 (bass + lead)","pad 1 (new age)","pad 2 (warm)","pad 3 (polysynth)","pad 4 (choir)","pad 5 (bowed)","pad 6 (metallic)","pad 7 (halo)","pad 8 (sweep)","fx 1 (rain)","fx 2 (soundtrack)","fx 3 (crystal)","fx 4 (atmosphere)","fx 5 (brightness)","fx 6 (goblins)","fx 7 (echoes)","fx 8 (sci-fi)","sitar","banjo","shamisen","koto","kalimba","bag pipe","fiddle","shanai","tinkle bell","agogo","steel drums","woodblock","taiko drum","melodic tom","synth drum","reverse cymbal","guitar fret noise","breath noise","seashore","bird tweet","telephone ring","helicopter","applause","gunshot"];W.InstrumentFamilyByID=["piano","chromatic percussion","organ","guitar","bass","strings","ensemble","brass","reed","pipe","synth lead","synth pad","synth effects","world","percussive","sound effects"];W.DrumKitByPatchID={0:"standard kit",8:"room kit",16:"power kit",24:"electronic kit",25:"tr-808 kit",32:"jazz kit",40:"brush kit",48:"orchestra kit",56:"sound fx kit"};Object.defineProperty(Ee,"__esModule",{value:!0});var ue=W,it=new WeakMap,$r=function(){function t(e,r){if(this.number=0,it.set(this,r),this.number=0,e){var n=e.find(function(i){return i.type==="programChange"});n&&(this.number=n.programNumber)}}return Object.defineProperty(t.prototype,"name",{get:function(){return this.percussion?ue.DrumKitByPatchID[this.number]:ue.instrumentByPatchID[this.number]},set:function(e){var r=ue.instrumentByPatchID.indexOf(e);r!==-1&&(this.number=r)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"family",{get:function(){return this.percussion?"drums":ue.InstrumentFamilyByID[Math.floor(this.number/8)]},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"percussion",{get:function(){var e=it.get(this);return e.channel===9},enumerable:!0,configurable:!0}),t.prototype.toJSON=function(){return{family:this.family,name:this.name,number:this.number}},t.prototype.fromJSON=function(e){this.number=e.number},t}();Ee.Instrument=$r;var Ae={};Object.defineProperty(Ae,"__esModule",{value:!0});function Lr(t){var e=Math.floor(t/12)-1;return st(t)+e.toString()}function st(t){var e=["C","C#","D","D#","E","F","F#","G","G#","A","A#","B"],r=t%12;return e[r]}function jr(t){var e=["C","C#","D","D#","E","F","F#","G","G#","A","A#","B"];return e.indexOf(t)}var Hr=function(){var t=/^([a-g]{1}(?:b|#|x|bb)?)(-?[0-9]+)/i,e={cbb:-2,cb:-1,c:0,"c#":1,cx:2,dbb:0,db:1,d:2,"d#":3,dx:4,ebb:2,eb:3,e:4,"e#":5,ex:6,fbb:3,fb:4,f:5,"f#":6,fx:7,gbb:5,gb:6,g:7,"g#":8,gx:9,abb:7,ab:8,a:9,"a#":10,ax:11,bbb:9,bb:10,b:11,"b#":12,bx:13};return function(r){var n=t.exec(r),i=n[1],o=n[2],s=e[i.toLowerCase()];return s+(parseInt(o,10)+1)*12}}(),V=new WeakMap,Jr=function(){function t(e,r,n){V.set(this,n),this.midi=e.midi,this.velocity=e.velocity,this.noteOffVelocity=r.velocity,this.ticks=e.ticks,this.durationTicks=r.ticks-e.ticks}return Object.defineProperty(t.prototype,"name",{get:function(){return Lr(this.midi)},set:function(e){this.midi=Hr(e)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"octave",{get:function(){return Math.floor(this.midi/12)-1},set:function(e){var r=e-this.octave;this.midi+=r*12},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"pitch",{get:function(){return st(this.midi)},set:function(e){this.midi=12*(this.octave+1)+jr(e)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"duration",{get:function(){var e=V.get(this);return e.ticksToSeconds(this.ticks+this.durationTicks)-e.ticksToSeconds(this.ticks)},set:function(e){var r=V.get(this),n=r.secondsToTicks(this.time+e);this.durationTicks=n-this.ticks},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"time",{get:function(){var e=V.get(this);return e.ticksToSeconds(this.ticks)},set:function(e){var r=V.get(this);this.ticks=r.secondsToTicks(e)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"bars",{get:function(){var e=V.get(this);return e.ticksToMeasures(this.ticks)},enumerable:!0,configurable:!0}),t.prototype.toJSON=function(){return{duration:this.duration,durationTicks:this.durationTicks,midi:this.midi,name:this.name,ticks:this.ticks,time:this.time,velocity:this.velocity}},t}();Ae.Note=Jr;Object.defineProperty(ae,"__esModule",{value:!0});var Oe=K,zr=Te,Kr=_e,Gr=Ie,ot=Ee,Wr=Ae,he=new WeakMap,Yr=function(){function t(e,r){var n=this;if(this.name="",this.notes=[],this.controlChanges=Kr.createControlChanges(),this.pitchBends=[],he.set(this,r),e){var i=e.find(function(h){return h.type==="trackName"});this.name=i?i.text:""}if(this.instrument=new ot.Instrument(e,this),this.channel=0,e){for(var o=e.filter(function(h){return h.type==="noteOn"}),s=e.filter(function(h){return h.type==="noteOff"}),a=function(){var h=o.shift();u.channel=h.channel;var m=s.findIndex(function(b){return b.noteNumber===h.noteNumber&&b.absoluteTime>=h.absoluteTime});if(m!==-1){var d=s.splice(m,1)[0];u.addNote({durationTicks:d.absoluteTime-h.absoluteTime,midi:h.noteNumber,noteOffVelocity:d.velocity/127,ticks:h.absoluteTime,velocity:h.velocity/127})}},u=this;o.length;)a();var c=e.filter(function(h){return h.type==="controller"});c.forEach(function(h){n.addCC({number:h.controllerType,ticks:h.absoluteTime,value:h.value/127})});var f=e.filter(function(h){return h.type==="pitchBend"});f.forEach(function(h){n.addPitchBend({ticks:h.absoluteTime,value:h.value/Math.pow(2,13)})});var l=e.find(function(h){return h.type==="endOfTrack"});this.endOfTrackTicks=l!==void 0?l.absoluteTime:void 0}}return t.prototype.addNote=function(e){var r=he.get(this),n=new Wr.Note({midi:0,ticks:0,velocity:1},{ticks:0,velocity:0},r);return Object.assign(n,e),Oe.insert(this.notes,n,"ticks"),this},t.prototype.addCC=function(e){var r=he.get(this),n=new zr.ControlChange({controllerType:e.number},r);return delete e.number,Object.assign(n,e),Array.isArray(this.controlChanges[n.number])||(this.controlChanges[n.number]=[]),Oe.insert(this.controlChanges[n.number],n,"ticks"),this},t.prototype.addPitchBend=function(e){var r=he.get(this),n=new Gr.PitchBend({},r);return Object.assign(n,e),Oe.insert(this.pitchBends,n,"ticks"),this},Object.defineProperty(t.prototype,"duration",{get:function(){if(!this.notes.length)return 0;for(var e=this.notes[this.notes.length-1].time+this.notes[this.notes.length-1].duration,r=0;r<this.notes.length-1;r++){var n=this.notes[r].time+this.notes[r].duration;e<n&&(e=n)}return e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"durationTicks",{get:function(){if(!this.notes.length)return 0;for(var e=this.notes[this.notes.length-1].ticks+this.notes[this.notes.length-1].durationTicks,r=0;r<this.notes.length-1;r++){var n=this.notes[r].ticks+this.notes[r].durationTicks;e<n&&(e=n)}return e},enumerable:!0,configurable:!0}),t.prototype.fromJSON=function(e){var r=this;this.name=e.name,this.channel=e.channel,this.instrument=new ot.Instrument(void 0,this),this.instrument.fromJSON(e.instrument),e.endOfTrackTicks!==void 0&&(this.endOfTrackTicks=e.endOfTrackTicks);for(var n in e.controlChanges)e.controlChanges[n]&&e.controlChanges[n].forEach(function(i){r.addCC({number:i.number,ticks:i.ticks,value:i.value})});e.notes.forEach(function(i){r.addNote({durationTicks:i.durationTicks,midi:i.midi,ticks:i.ticks,velocity:i.velocity})})},t.prototype.toJSON=function(){for(var e={},r=0;r<127;r++)this.controlChanges.hasOwnProperty(r)&&(e[r]=this.controlChanges[r].map(function(i){return i.toJSON()}));var n={channel:this.channel,controlChanges:e,pitchBends:this.pitchBends.map(function(i){return i.toJSON()}),instrument:this.instrument.toJSON(),name:this.name,notes:this.notes.map(function(i){return i.toJSON()})};return this.endOfTrackTicks!==void 0&&(n.endOfTrackTicks=this.endOfTrackTicks),n},t}();ae.Track=Yr;var Xr=U&&U.__awaiter||function(t,e,r,n){function i(o){return o instanceof r?o:new r(function(s){s(o)})}return new(r||(r=Promise))(function(o,s){function a(f){try{c(n.next(f))}catch(l){s(l)}}function u(f){try{c(n.throw(f))}catch(l){s(l)}}function c(f){f.done?o(f.value):i(f.value).then(a,u)}c((n=n.apply(t,e||[])).next())})},Qr=U&&U.__generator||function(t,e){var r={label:0,sent:function(){if(o[0]&1)throw o[1];return o[1]},trys:[],ops:[]},n,i,o,s;return s={next:a(0),throw:a(1),return:a(2)},typeof Symbol=="function"&&(s[Symbol.iterator]=function(){return this}),s;function a(c){return function(f){return u([c,f])}}function u(c){if(n)throw new TypeError("Generator is already executing.");for(;r;)try{if(n=1,i&&(o=c[0]&2?i.return:c[0]?i.throw||((o=i.return)&&o.call(i),0):i.next)&&!(o=o.call(i,c[1])).done)return o;switch(i=0,o&&(c=[c[0]&2,o.value]),c[0]){case 0:case 1:o=c;break;case 4:return r.label++,{value:c[1],done:!1};case 5:r.label++,i=c[1],c=[0];continue;case 7:c=r.ops.pop(),r.trys.pop();continue;default:if(o=r.trys,!(o=o.length>0&&o[o.length-1])&&(c[0]===6||c[0]===2)){r=0;continue}if(c[0]===3&&(!o||c[1]>o[0]&&c[1]<o[3])){r.label=c[1];break}if(c[0]===6&&r.label<o[1]){r.label=o[1],o=c;break}if(o&&r.label<o[2]){r.label=o[2],r.ops.push(c);break}o[2]&&r.ops.pop(),r.trys.pop();continue}c=e.call(t,r)}catch(f){c=[6,f],i=0}finally{n=o=0}if(c[0]&5)throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}};Object.defineProperty(ie,"__esModule",{value:!0});var Zr=se,en=we,at=oe,Ne=ae,tn=function(){function t(e){var r=this,n=null;e&&(e instanceof ArrayBuffer&&(e=new Uint8Array(e)),n=Zr.parseMidi(e),n.tracks.forEach(function(i){var o=0;i.forEach(function(s){o+=s.deltaTime,s.absoluteTime=o})}),n.tracks=sn(n.tracks)),this.header=new at.Header(n),this.tracks=[],e&&(this.tracks=n.tracks.map(function(i){return new Ne.Track(i,r.header)}),n.header.format===1&&this.tracks[0].duration===0&&this.tracks.shift())}return t.fromUrl=function(e){return Xr(this,void 0,void 0,function(){var r,n;return Qr(this,function(i){switch(i.label){case 0:return[4,fetch(e)];case 1:return r=i.sent(),r.ok?[4,r.arrayBuffer()]:[3,3];case 2:return n=i.sent(),[2,new t(n)];case 3:throw new Error("could not load "+e)}})})},Object.defineProperty(t.prototype,"name",{get:function(){return this.header.name},set:function(e){this.header.name=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"duration",{get:function(){var e=this.tracks.map(function(r){return r.duration});return Math.max.apply(Math,e)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"durationTicks",{get:function(){var e=this.tracks.map(function(r){return r.durationTicks});return Math.max.apply(Math,e)},enumerable:!0,configurable:!0}),t.prototype.addTrack=function(){var e=new Ne.Track(void 0,this.header);return this.tracks.push(e),e},t.prototype.toArray=function(){return en.encode(this)},t.prototype.toJSON=function(){return{header:this.header.toJSON(),tracks:this.tracks.map(function(e){return e.toJSON()})}},t.prototype.fromJSON=function(e){var r=this;this.header=new at.Header,this.header.fromJSON(e.header),this.tracks=e.tracks.map(function(n){var i=new Ne.Track(void 0,r.header);return i.fromJSON(n),i})},t.prototype.clone=function(){var e=new t;return e.fromJSON(this.toJSON()),e},t}(),xs=ie.Midi=tn,rn=ae;ie.Track=rn.Track;var nn=oe;ie.Header=nn.Header;function sn(t){for(var e=[],r=0;r<t.length;r++)for(var n=e.length,i=new Map,o=Array(16).fill(0),s=0,a=t[r];s<a.length;s++){var u=a[s],c=n,f=u.channel;if(f!==void 0){u.type==="programChange"&&(o[f]=u.programNumber);var l=o[f],h=l+" "+f;i.has(h)?c=i.get(h):(c=n+i.size,i.set(h,c))}e[c]||e.push([]),e[c].push(u)}return e}var on=/^(?:(?![^:@]+:[^:@\/]*@)(http|https|ws|wss):\/\/)?((?:(([^:@]*)(?::([^:@]*))?)?@)?((?:[a-f0-9]{0,4}:){2,7}[a-f0-9]{0,4}|[^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/,an=["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"],Ce=function(e){var r=e,n=e.indexOf("["),i=e.indexOf("]");n!=-1&&i!=-1&&(e=e.substring(0,n)+e.substring(n,i).replace(/:/g,";")+e.substring(i,e.length));for(var o=on.exec(e||""),s={},a=14;a--;)s[an[a]]=o[a]||"";return n!=-1&&i!=-1&&(s.source=r,s.host=s.host.substring(1,s.host.length-1).replace(/;/g,":"),s.authority=s.authority.replace("[","").replace("]","").replace(/;/g,":"),s.ipv6uri=!0),s.pathNames=cn(s,s.path),s.queryKey=un(s,s.query),s};function cn(t,e){var r=/\/{2,9}/g,n=e.replace(r,"/").split("/");return(e.substr(0,1)=="/"||e.length===0)&&n.splice(0,1),e.substr(e.length-1,1)=="/"&&n.splice(n.length-1,1),n}function un(t,e){var r={};return e.replace(/(?:^|&)([^&=]*)=?([^&]*)/g,function(n,i,o){i&&(r[i]=o)}),r}function hn(t,e="",r){let n=t;r=r||typeof location!="undefined"&&location,t==null&&(t=r.protocol+"//"+r.host),typeof t=="string"&&(t.charAt(0)==="/"&&(t.charAt(1)==="/"?t=r.protocol+t:t=r.host+t),/^(https?|wss?):\/\//.test(t)||(typeof r!="undefined"?t=r.protocol+"//"+t:t="https://"+t),n=Ce(t)),n.port||(/^(http|ws)$/.test(n.protocol)?n.port="80":/^(http|ws)s$/.test(n.protocol)&&(n.port="443")),n.path=n.path||"/";const o=n.host.indexOf(":")!==-1?"["+n.host+"]":n.host;return n.id=n.protocol+"://"+o+":"+n.port+e,n.href=n.protocol+"://"+o+(r&&r.port===n.port?"":":"+n.port),n}var Ue={exports:{}};try{Ue.exports=typeof XMLHttpRequest!="undefined"&&"withCredentials"in new XMLHttpRequest}catch{Ue.exports=!1}var fn=Ue.exports,B=(()=>typeof self!="undefined"?self:typeof window!="undefined"?window:Function("return this")())();function ct(t){const e=t.xdomain;try{if(typeof XMLHttpRequest!="undefined"&&(!e||fn))return new XMLHttpRequest}catch{}if(!e)try{return new B[["Active"].concat("Object").join("X")]("Microsoft.XMLHTTP")}catch{}}function ut(t,...e){return e.reduce((r,n)=>(t.hasOwnProperty(n)&&(r[n]=t[n]),r),{})}const ln=setTimeout,dn=clearTimeout;function fe(t,e){e.useNativeTimers?(t.setTimeoutFn=ln.bind(B),t.clearTimeoutFn=dn.bind(B)):(t.setTimeoutFn=setTimeout.bind(B),t.clearTimeoutFn=clearTimeout.bind(B))}var $=T;function T(t){if(t)return pn(t)}function pn(t){for(var e in T.prototype)t[e]=T.prototype[e];return t}T.prototype.on=T.prototype.addEventListener=function(t,e){return this._callbacks=this._callbacks||{},(this._callbacks["$"+t]=this._callbacks["$"+t]||[]).push(e),this};T.prototype.once=function(t,e){function r(){this.off(t,r),e.apply(this,arguments)}return r.fn=e,this.on(t,r),this};T.prototype.off=T.prototype.removeListener=T.prototype.removeAllListeners=T.prototype.removeEventListener=function(t,e){if(this._callbacks=this._callbacks||{},arguments.length==0)return this._callbacks={},this;var r=this._callbacks["$"+t];if(!r)return this;if(arguments.length==1)return delete this._callbacks["$"+t],this;for(var n,i=0;i<r.length;i++)if(n=r[i],n===e||n.fn===e){r.splice(i,1);break}return r.length===0&&delete this._callbacks["$"+t],this};T.prototype.emit=function(t){this._callbacks=this._callbacks||{};for(var e=new Array(arguments.length-1),r=this._callbacks["$"+t],n=1;n<arguments.length;n++)e[n-1]=arguments[n];if(r){r=r.slice(0);for(var n=0,i=r.length;n<i;++n)r[n].apply(this,e)}return this};T.prototype.emitReserved=T.prototype.emit;T.prototype.listeners=function(t){return this._callbacks=this._callbacks||{},this._callbacks["$"+t]||[]};T.prototype.hasListeners=function(t){return!!this.listeners(t).length};const S=Object.create(null);S.open="0";S.close="1";S.ping="2";S.pong="3";S.message="4";S.upgrade="5";S.noop="6";const le=Object.create(null);Object.keys(S).forEach(t=>{le[S[t]]=t});const mn={type:"error",data:"parser error"},yn=typeof Blob=="function"||typeof Blob!="undefined"&&Object.prototype.toString.call(Blob)==="[object BlobConstructor]",gn=typeof ArrayBuffer=="function",bn=t=>typeof ArrayBuffer.isView=="function"?ArrayBuffer.isView(t):t&&t.buffer instanceof ArrayBuffer,ht=({type:t,data:e},r,n)=>yn&&e instanceof Blob?r?n(e):ft(e,n):gn&&(e instanceof ArrayBuffer||bn(e))?r?n(e):ft(new Blob([e]),n):n(S[t]+(e||"")),ft=(t,e)=>{const r=new FileReader;return r.onload=function(){const n=r.result.split(",")[1];e("b"+n)},r.readAsDataURL(t)};var lt="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",Y=typeof Uint8Array=="undefined"?[]:new Uint8Array(256);for(var de=0;de<lt.length;de++)Y[lt.charCodeAt(de)]=de;var vn=function(t){var e=t.length*.75,r=t.length,n,i=0,o,s,a,u;t[t.length-1]==="="&&(e--,t[t.length-2]==="="&&e--);var c=new ArrayBuffer(e),f=new Uint8Array(c);for(n=0;n<r;n+=4)o=Y[t.charCodeAt(n)],s=Y[t.charCodeAt(n+1)],a=Y[t.charCodeAt(n+2)],u=Y[t.charCodeAt(n+3)],f[i++]=o<<2|s>>4,f[i++]=(s&15)<<4|a>>2,f[i++]=(a&3)<<6|u&63;return c};const kn=typeof ArrayBuffer=="function",dt=(t,e)=>{if(typeof t!="string")return{type:"message",data:pt(t,e)};const r=t.charAt(0);return r==="b"?{type:"message",data:wn(t.substring(1),e)}:le[r]?t.length>1?{type:le[r],data:t.substring(1)}:{type:le[r]}:mn},wn=(t,e)=>{if(kn){const r=vn(t);return pt(r,e)}else return{base64:!0,data:t}},pt=(t,e)=>{switch(e){case"blob":return t instanceof ArrayBuffer?new Blob([t]):t;case"arraybuffer":default:return t}},mt=String.fromCharCode(30),xn=(t,e)=>{const r=t.length,n=new Array(r);let i=0;t.forEach((o,s)=>{ht(o,!1,a=>{n[s]=a,++i===r&&e(n.join(mt))})})},Tn=(t,e)=>{const r=t.split(mt),n=[];for(let i=0;i<r.length;i++){const o=dt(r[i],e);if(n.push(o),o.type==="error")break}return n},yt=4;class gt extends ${constructor(e){super();this.writable=!1,fe(this,e),this.opts=e,this.query=e.query,this.readyState="",this.socket=e.socket}onError(e,r){const n=new Error(e);return n.type="TransportError",n.description=r,super.emit("error",n),this}open(){return(this.readyState==="closed"||this.readyState==="")&&(this.readyState="opening",this.doOpen()),this}close(){return(this.readyState==="opening"||this.readyState==="open")&&(this.doClose(),this.onClose()),this}send(e){this.readyState==="open"&&this.write(e)}onOpen(){this.readyState="open",this.writable=!0,super.emit("open")}onData(e){const r=dt(e,this.socket.binaryType);this.onPacket(r)}onPacket(e){super.emit("packet",e)}onClose(){this.readyState="closed",super.emit("close")}}var bt="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz-_".split(""),pe=64,vt={},kt=0,P=0,wt;function Be(t){var e="";do e=bt[t%pe]+e,t=Math.floor(t/pe);while(t>0);return e}function _n(t){var e=0;for(P=0;P<t.length;P++)e=e*pe+vt[t.charAt(P)];return e}function Pe(){var t=Be(+new Date);return t!==wt?(kt=0,wt=t):t+"."+Be(kt++)}for(;P<pe;P++)vt[bt[P]]=P;Pe.encode=Be;Pe.decode=_n;var xt=Pe,X={};X.encode=function(t){var e="";for(var r in t)t.hasOwnProperty(r)&&(e.length&&(e+="&"),e+=encodeURIComponent(r)+"="+encodeURIComponent(t[r]));return e};X.decode=function(t){for(var e={},r=t.split("&"),n=0,i=r.length;n<i;n++){var o=r[n].split("=");e[decodeURIComponent(o[0])]=decodeURIComponent(o[1])}return e};class In extends gt{constructor(){super(...arguments);this.polling=!1}get name(){return"polling"}doOpen(){this.poll()}pause(e){this.readyState="pausing";const r=()=>{this.readyState="paused",e()};if(this.polling||!this.writable){let n=0;this.polling&&(n++,this.once("pollComplete",function(){--n||r()})),this.writable||(n++,this.once("drain",function(){--n||r()}))}else r()}poll(){this.polling=!0,this.doPoll(),this.emit("poll")}onData(e){const r=n=>{if(this.readyState==="opening"&&n.type==="open"&&this.onOpen(),n.type==="close")return this.onClose(),!1;this.onPacket(n)};Tn(e,this.socket.binaryType).forEach(r),this.readyState!=="closed"&&(this.polling=!1,this.emit("pollComplete"),this.readyState==="open"&&this.poll())}doClose(){const e=()=>{this.write([{type:"close"}])};this.readyState==="open"?e():this.once("open",e)}write(e){this.writable=!1,xn(e,r=>{this.doWrite(r,()=>{this.writable=!0,this.emit("drain")})})}uri(){let e=this.query||{};const r=this.opts.secure?"https":"http";let n="";this.opts.timestampRequests!==!1&&(e[this.opts.timestampParam]=xt()),!this.supportsBinary&&!e.sid&&(e.b64=1),this.opts.port&&(r==="https"&&Number(this.opts.port)!==443||r==="http"&&Number(this.opts.port)!==80)&&(n=":"+this.opts.port);const i=X.encode(e),o=this.opts.hostname.indexOf(":")!==-1;return r+"://"+(o?"["+this.opts.hostname+"]":this.opts.hostname)+n+this.opts.path+(i.length?"?"+i:"")}}function Sn(){}const En=function(){return new ct({xdomain:!1}).responseType!=null}();class An extends In{constructor(e){super(e);if(typeof location!="undefined"){const n=location.protocol==="https:";let i=location.port;i||(i=n?"443":"80"),this.xd=typeof location!="undefined"&&e.hostname!==location.hostname||i!==e.port,this.xs=e.secure!==n}const r=e&&e.forceBase64;this.supportsBinary=En&&!r}request(e={}){return Object.assign(e,{xd:this.xd,xs:this.xs},this.opts),new E(this.uri(),e)}doWrite(e,r){const n=this.request({method:"POST",data:e});n.on("success",r),n.on("error",i=>{this.onError("xhr post error",i)})}doPoll(){const e=this.request();e.on("data",this.onData.bind(this)),e.on("error",r=>{this.onError("xhr poll error",r)}),this.pollXhr=e}}class E extends ${constructor(e,r){super();fe(this,r),this.opts=r,this.method=r.method||"GET",this.uri=e,this.async=r.async!==!1,this.data=r.data!==void 0?r.data:null,this.create()}create(){const e=ut(this.opts,"agent","pfx","key","passphrase","cert","ca","ciphers","rejectUnauthorized","autoUnref");e.xdomain=!!this.opts.xd,e.xscheme=!!this.opts.xs;const r=this.xhr=new ct(e);try{r.open(this.method,this.uri,this.async);try{if(this.opts.extraHeaders){r.setDisableHeaderCheck&&r.setDisableHeaderCheck(!0);for(let n in this.opts.extraHeaders)this.opts.extraHeaders.hasOwnProperty(n)&&r.setRequestHeader(n,this.opts.extraHeaders[n])}}catch{}if(this.method==="POST")try{r.setRequestHeader("Content-type","text/plain;charset=UTF-8")}catch{}try{r.setRequestHeader("Accept","*/*")}catch{}"withCredentials"in r&&(r.withCredentials=this.opts.withCredentials),this.opts.requestTimeout&&(r.timeout=this.opts.requestTimeout),r.onreadystatechange=()=>{r.readyState===4&&(r.status===200||r.status===1223?this.onLoad():this.setTimeoutFn(()=>{this.onError(typeof r.status=="number"?r.status:0)},0))},r.send(this.data)}catch(n){this.setTimeoutFn(()=>{this.onError(n)},0);return}typeof document!="undefined"&&(this.index=E.requestsCount++,E.requests[this.index]=this)}onSuccess(){this.emit("success"),this.cleanup()}onData(e){this.emit("data",e),this.onSuccess()}onError(e){this.emit("error",e),this.cleanup(!0)}cleanup(e){if(!(typeof this.xhr=="undefined"||this.xhr===null)){if(this.xhr.onreadystatechange=Sn,e)try{this.xhr.abort()}catch{}typeof document!="undefined"&&delete E.requests[this.index],this.xhr=null}}onLoad(){const e=this.xhr.responseText;e!==null&&this.onData(e)}abort(){this.cleanup()}}E.requestsCount=0;E.requests={};if(typeof document!="undefined"){if(typeof attachEvent=="function")attachEvent("onunload",Tt);else if(typeof addEventListener=="function"){const t="onpagehide"in B?"pagehide":"unload";addEventListener(t,Tt,!1)}}function Tt(){for(let t in E.requests)E.requests.hasOwnProperty(t)&&E.requests[t].abort()}const On=(()=>typeof Promise=="function"&&typeof Promise.resolve=="function"?e=>Promise.resolve().then(e):(e,r)=>r(e,0))(),Q=B.WebSocket||B.MozWebSocket,_t=!0,Nn="arraybuffer",It=typeof navigator!="undefined"&&typeof navigator.product=="string"&&navigator.product.toLowerCase()==="reactnative";class Me extends gt{constructor(e){super(e);this.supportsBinary=!e.forceBase64}get name(){return"websocket"}doOpen(){if(!this.check())return;const e=this.uri(),r=this.opts.protocols,n=It?{}:ut(this.opts,"agent","perMessageDeflate","pfx","key","passphrase","cert","ca","ciphers","rejectUnauthorized","localAddress","protocolVersion","origin","maxPayload","family","checkServerIdentity");this.opts.extraHeaders&&(n.headers=this.opts.extraHeaders);try{this.ws=_t&&!It?r?new Q(e,r):new Q(e):new Q(e,r,n)}catch(i){return this.emit("error",i)}this.ws.binaryType=this.socket.binaryType||Nn,this.addEventListeners()}addEventListeners(){this.ws.onopen=()=>{this.opts.autoUnref&&this.ws._socket.unref(),this.onOpen()},this.ws.onclose=this.onClose.bind(this),this.ws.onmessage=e=>this.onData(e.data),this.ws.onerror=e=>this.onError("websocket error",e)}write(e){this.writable=!1;for(let r=0;r<e.length;r++){const n=e[r],i=r===e.length-1;ht(n,this.supportsBinary,o=>{const s={};try{_t&&this.ws.send(o)}catch{}i&&On(()=>{this.writable=!0,this.emit("drain")},this.setTimeoutFn)})}}doClose(){typeof this.ws!="undefined"&&(this.ws.close(),this.ws=null)}uri(){let e=this.query||{};const r=this.opts.secure?"wss":"ws";let n="";this.opts.port&&(r==="wss"&&Number(this.opts.port)!==443||r==="ws"&&Number(this.opts.port)!==80)&&(n=":"+this.opts.port),this.opts.timestampRequests&&(e[this.opts.timestampParam]=xt()),this.supportsBinary||(e.b64=1);const i=X.encode(e),o=this.opts.hostname.indexOf(":")!==-1;return r+"://"+(o?"["+this.opts.hostname+"]":this.opts.hostname)+n+this.opts.path+(i.length?"?"+i:"")}check(){return!!Q&&!("__initialize"in Q&&this.name===Me.prototype.name)}}const Cn={websocket:Me,polling:An};class N extends ${constructor(e,r={}){super();e&&typeof e=="object"&&(r=e,e=null),e?(e=Ce(e),r.hostname=e.host,r.secure=e.protocol==="https"||e.protocol==="wss",r.port=e.port,e.query&&(r.query=e.query)):r.host&&(r.hostname=Ce(r.host).host),fe(this,r),this.secure=r.secure!=null?r.secure:typeof location!="undefined"&&location.protocol==="https:",r.hostname&&!r.port&&(r.port=this.secure?"443":"80"),this.hostname=r.hostname||(typeof location!="undefined"?location.hostname:"localhost"),this.port=r.port||(typeof location!="undefined"&&location.port?location.port:this.secure?"443":"80"),this.transports=r.transports||["polling","websocket"],this.readyState="",this.writeBuffer=[],this.prevBufferLen=0,this.opts=Object.assign({path:"/engine.io",agent:!1,withCredentials:!1,upgrade:!0,timestampParam:"t",rememberUpgrade:!1,rejectUnauthorized:!0,perMessageDeflate:{threshold:1024},transportOptions:{},closeOnBeforeunload:!0},r),this.opts.path=this.opts.path.replace(/\/$/,"")+"/",typeof this.opts.query=="string"&&(this.opts.query=X.decode(this.opts.query)),this.id=null,this.upgrades=null,this.pingInterval=null,this.pingTimeout=null,this.pingTimeoutTimer=null,typeof addEventListener=="function"&&(this.opts.closeOnBeforeunload&&addEventListener("beforeunload",()=>{this.transport&&(this.transport.removeAllListeners(),this.transport.close())},!1),this.hostname!=="localhost"&&(this.offlineEventListener=()=>{this.onClose("transport close")},addEventListener("offline",this.offlineEventListener,!1))),this.open()}createTransport(e){const r=Un(this.opts.query);r.EIO=yt,r.transport=e,this.id&&(r.sid=this.id);const n=Object.assign({},this.opts.transportOptions[e],this.opts,{query:r,socket:this,hostname:this.hostname,secure:this.secure,port:this.port});return new Cn[e](n)}open(){let e;if(this.opts.rememberUpgrade&&N.priorWebsocketSuccess&&this.transports.indexOf("websocket")!==-1)e="websocket";else if(this.transports.length===0){this.setTimeoutFn(()=>{this.emitReserved("error","No transports available")},0);return}else e=this.transports[0];this.readyState="opening";try{e=this.createTransport(e)}catch{this.transports.shift(),this.open();return}e.open(),this.setTransport(e)}setTransport(e){this.transport&&this.transport.removeAllListeners(),this.transport=e,e.on("drain",this.onDrain.bind(this)).on("packet",this.onPacket.bind(this)).on("error",this.onError.bind(this)).on("close",()=>{this.onClose("transport close")})}probe(e){let r=this.createTransport(e),n=!1;N.priorWebsocketSuccess=!1;const i=()=>{n||(r.send([{type:"ping",data:"probe"}]),r.once("packet",l=>{if(!n)if(l.type==="pong"&&l.data==="probe"){if(this.upgrading=!0,this.emitReserved("upgrading",r),!r)return;N.priorWebsocketSuccess=r.name==="websocket",this.transport.pause(()=>{n||this.readyState!=="closed"&&(f(),this.setTransport(r),r.send([{type:"upgrade"}]),this.emitReserved("upgrade",r),r=null,this.upgrading=!1,this.flush())})}else{const h=new Error("probe error");h.transport=r.name,this.emitReserved("upgradeError",h)}}))};function o(){n||(n=!0,f(),r.close(),r=null)}const s=l=>{const h=new Error("probe error: "+l);h.transport=r.name,o(),this.emitReserved("upgradeError",h)};function a(){s("transport closed")}function u(){s("socket closed")}function c(l){r&&l.name!==r.name&&o()}const f=()=>{r.removeListener("open",i),r.removeListener("error",s),r.removeListener("close",a),this.off("close",u),this.off("upgrading",c)};r.once("open",i),r.once("error",s),r.once("close",a),this.once("close",u),this.once("upgrading",c),r.open()}onOpen(){if(this.readyState="open",N.priorWebsocketSuccess=this.transport.name==="websocket",this.emitReserved("open"),this.flush(),this.readyState==="open"&&this.opts.upgrade&&this.transport.pause){let e=0;const r=this.upgrades.length;for(;e<r;e++)this.probe(this.upgrades[e])}}onPacket(e){if(this.readyState==="opening"||this.readyState==="open"||this.readyState==="closing")switch(this.emitReserved("packet",e),this.emitReserved("heartbeat"),e.type){case"open":this.onHandshake(JSON.parse(e.data));break;case"ping":this.resetPingTimeout(),this.sendPacket("pong"),this.emitReserved("ping"),this.emitReserved("pong");break;case"error":const r=new Error("server error");r.code=e.data,this.onError(r);break;case"message":this.emitReserved("data",e.data),this.emitReserved("message",e.data);break}}onHandshake(e){this.emitReserved("handshake",e),this.id=e.sid,this.transport.query.sid=e.sid,this.upgrades=this.filterUpgrades(e.upgrades),this.pingInterval=e.pingInterval,this.pingTimeout=e.pingTimeout,this.onOpen(),this.readyState!=="closed"&&this.resetPingTimeout()}resetPingTimeout(){this.clearTimeoutFn(this.pingTimeoutTimer),this.pingTimeoutTimer=this.setTimeoutFn(()=>{this.onClose("ping timeout")},this.pingInterval+this.pingTimeout),this.opts.autoUnref&&this.pingTimeoutTimer.unref()}onDrain(){this.writeBuffer.splice(0,this.prevBufferLen),this.prevBufferLen=0,this.writeBuffer.length===0?this.emitReserved("drain"):this.flush()}flush(){this.readyState!=="closed"&&this.transport.writable&&!this.upgrading&&this.writeBuffer.length&&(this.transport.send(this.writeBuffer),this.prevBufferLen=this.writeBuffer.length,this.emitReserved("flush"))}write(e,r,n){return this.sendPacket("message",e,r,n),this}send(e,r,n){return this.sendPacket("message",e,r,n),this}sendPacket(e,r,n,i){if(typeof r=="function"&&(i=r,r=void 0),typeof n=="function"&&(i=n,n=null),this.readyState==="closing"||this.readyState==="closed")return;n=n||{},n.compress=n.compress!==!1;const o={type:e,data:r,options:n};this.emitReserved("packetCreate",o),this.writeBuffer.push(o),i&&this.once("flush",i),this.flush()}close(){const e=()=>{this.onClose("forced close"),this.transport.close()},r=()=>{this.off("upgrade",r),this.off("upgradeError",r),e()},n=()=>{this.once("upgrade",r),this.once("upgradeError",r)};return(this.readyState==="opening"||this.readyState==="open")&&(this.readyState="closing",this.writeBuffer.length?this.once("drain",()=>{this.upgrading?n():e()}):this.upgrading?n():e()),this}onError(e){N.priorWebsocketSuccess=!1,this.emitReserved("error",e),this.onClose("transport error",e)}onClose(e,r){(this.readyState==="opening"||this.readyState==="open"||this.readyState==="closing")&&(this.clearTimeoutFn(this.pingTimeoutTimer),this.transport.removeAllListeners("close"),this.transport.close(),this.transport.removeAllListeners(),typeof removeEventListener=="function"&&removeEventListener("offline",this.offlineEventListener,!1),this.readyState="closed",this.id=null,this.emitReserved("close",e,r),this.writeBuffer=[],this.prevBufferLen=0)}filterUpgrades(e){const r=[];let n=0;const i=e.length;for(;n<i;n++)~this.transports.indexOf(e[n])&&r.push(e[n]);return r}}N.protocol=yt;function Un(t){const e={};for(let r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);return e}N.protocol;const Bn=typeof ArrayBuffer=="function",Pn=t=>typeof ArrayBuffer.isView=="function"?ArrayBuffer.isView(t):t.buffer instanceof ArrayBuffer,St=Object.prototype.toString,Mn=typeof Blob=="function"||typeof Blob!="undefined"&&St.call(Blob)==="[object BlobConstructor]",Fn=typeof File=="function"||typeof File!="undefined"&&St.call(File)==="[object FileConstructor]";function Fe(t){return Bn&&(t instanceof ArrayBuffer||Pn(t))||Mn&&t instanceof Blob||Fn&&t instanceof File}function me(t,e){if(!t||typeof t!="object")return!1;if(Array.isArray(t)){for(let r=0,n=t.length;r<n;r++)if(me(t[r]))return!0;return!1}if(Fe(t))return!0;if(t.toJSON&&typeof t.toJSON=="function"&&arguments.length===1)return me(t.toJSON(),!0);for(const r in t)if(Object.prototype.hasOwnProperty.call(t,r)&&me(t[r]))return!0;return!1}function Rn(t){const e=[],r=t.data,n=t;return n.data=Re(r,e),n.attachments=e.length,{packet:n,buffers:e}}function Re(t,e){if(!t)return t;if(Fe(t)){const r={_placeholder:!0,num:e.length};return e.push(t),r}else if(Array.isArray(t)){const r=new Array(t.length);for(let n=0;n<t.length;n++)r[n]=Re(t[n],e);return r}else if(typeof t=="object"&&!(t instanceof Date)){const r={};for(const n in t)t.hasOwnProperty(n)&&(r[n]=Re(t[n],e));return r}return t}function qn(t,e){return t.data=qe(t.data,e),t.attachments=void 0,t}function qe(t,e){if(!t)return t;if(t&&t._placeholder)return e[t.num];if(Array.isArray(t))for(let r=0;r<t.length;r++)t[r]=qe(t[r],e);else if(typeof t=="object")for(const r in t)t.hasOwnProperty(r)&&(t[r]=qe(t[r],e));return t}const Dn=5;var g;(function(t){t[t.CONNECT=0]="CONNECT",t[t.DISCONNECT=1]="DISCONNECT",t[t.EVENT=2]="EVENT",t[t.ACK=3]="ACK",t[t.CONNECT_ERROR=4]="CONNECT_ERROR",t[t.BINARY_EVENT=5]="BINARY_EVENT",t[t.BINARY_ACK=6]="BINARY_ACK"})(g||(g={}));class Vn{encode(e){return(e.type===g.EVENT||e.type===g.ACK)&&me(e)?(e.type=e.type===g.EVENT?g.BINARY_EVENT:g.BINARY_ACK,this.encodeAsBinary(e)):[this.encodeAsString(e)]}encodeAsString(e){let r=""+e.type;return(e.type===g.BINARY_EVENT||e.type===g.BINARY_ACK)&&(r+=e.attachments+"-"),e.nsp&&e.nsp!=="/"&&(r+=e.nsp+","),e.id!=null&&(r+=e.id),e.data!=null&&(r+=JSON.stringify(e.data)),r}encodeAsBinary(e){const r=Rn(e),n=this.encodeAsString(r.packet),i=r.buffers;return i.unshift(n),i}}class De extends ${constructor(){super()}add(e){let r;if(typeof e=="string")r=this.decodeString(e),r.type===g.BINARY_EVENT||r.type===g.BINARY_ACK?(this.reconstructor=new Ln(r),r.attachments===0&&super.emitReserved("decoded",r)):super.emitReserved("decoded",r);else if(Fe(e)||e.base64)if(this.reconstructor)r=this.reconstructor.takeBinaryData(e),r&&(this.reconstructor=null,super.emitReserved("decoded",r));else throw new Error("got binary data when not reconstructing a packet");else throw new Error("Unknown type: "+e)}decodeString(e){let r=0;const n={type:Number(e.charAt(0))};if(g[n.type]===void 0)throw new Error("unknown packet type "+n.type);if(n.type===g.BINARY_EVENT||n.type===g.BINARY_ACK){const o=r+1;for(;e.charAt(++r)!=="-"&&r!=e.length;);const s=e.substring(o,r);if(s!=Number(s)||e.charAt(r)!=="-")throw new Error("Illegal attachments");n.attachments=Number(s)}if(e.charAt(r+1)==="/"){const o=r+1;for(;++r&&!(e.charAt(r)===","||r===e.length););n.nsp=e.substring(o,r)}else n.nsp="/";const i=e.charAt(r+1);if(i!==""&&Number(i)==i){const o=r+1;for(;++r;){const s=e.charAt(r);if(s==null||Number(s)!=s){--r;break}if(r===e.length)break}n.id=Number(e.substring(o,r+1))}if(e.charAt(++r)){const o=$n(e.substr(r));if(De.isPayloadValid(n.type,o))n.data=o;else throw new Error("invalid payload")}return n}static isPayloadValid(e,r){switch(e){case g.CONNECT:return typeof r=="object";case g.DISCONNECT:return r===void 0;case g.CONNECT_ERROR:return typeof r=="string"||typeof r=="object";case g.EVENT:case g.BINARY_EVENT:return Array.isArray(r)&&r.length>0;case g.ACK:case g.BINARY_ACK:return Array.isArray(r)}}destroy(){this.reconstructor&&this.reconstructor.finishedReconstruction()}}function $n(t){try{return JSON.parse(t)}catch{return!1}}class Ln{constructor(e){this.packet=e,this.buffers=[],this.reconPack=e}takeBinaryData(e){if(this.buffers.push(e),this.buffers.length===this.reconPack.attachments){const r=qn(this.reconPack,this.buffers);return this.finishedReconstruction(),r}return null}finishedReconstruction(){this.reconPack=null,this.buffers=[]}}var jn=Object.freeze({__proto__:null,[Symbol.toStringTag]:"Module",protocol:Dn,get PacketType(){return g},Encoder:Vn,Decoder:De});function I(t,e,r){return t.on(e,r),function(){t.off(e,r)}}const Hn=Object.freeze({connect:1,connect_error:1,disconnect:1,disconnecting:1,newListener:1,removeListener:1});class Et extends ${constructor(e,r,n){super();this.connected=!1,this.disconnected=!0,this.receiveBuffer=[],this.sendBuffer=[],this.ids=0,this.acks={},this.flags={},this.io=e,this.nsp=r,n&&n.auth&&(this.auth=n.auth),this.io._autoConnect&&this.open()}subEvents(){if(this.subs)return;const e=this.io;this.subs=[I(e,"open",this.onopen.bind(this)),I(e,"packet",this.onpacket.bind(this)),I(e,"error",this.onerror.bind(this)),I(e,"close",this.onclose.bind(this))]}get active(){return!!this.subs}connect(){return this.connected?this:(this.subEvents(),this.io._reconnecting||this.io.open(),this.io._readyState==="open"&&this.onopen(),this)}open(){return this.connect()}send(...e){return e.unshift("message"),this.emit.apply(this,e),this}emit(e,...r){if(Hn.hasOwnProperty(e))throw new Error('"'+e+'" is a reserved event name');r.unshift(e);const n={type:g.EVENT,data:r};if(n.options={},n.options.compress=this.flags.compress!==!1,typeof r[r.length-1]=="function"){const s=this.ids++,a=r.pop();this._registerAckCallback(s,a),n.id=s}const i=this.io.engine&&this.io.engine.transport&&this.io.engine.transport.writable;return this.flags.volatile&&(!i||!this.connected)||(this.connected?this.packet(n):this.sendBuffer.push(n)),this.flags={},this}_registerAckCallback(e,r){const n=this.flags.timeout;if(n===void 0){this.acks[e]=r;return}const i=this.io.setTimeoutFn(()=>{delete this.acks[e];for(let o=0;o<this.sendBuffer.length;o++)this.sendBuffer[o].id===e&&this.sendBuffer.splice(o,1);r.call(this,new Error("operation has timed out"))},n);this.acks[e]=(...o)=>{this.io.clearTimeoutFn(i),r.apply(this,[null,...o])}}packet(e){e.nsp=this.nsp,this.io._packet(e)}onopen(){typeof this.auth=="function"?this.auth(e=>{this.packet({type:g.CONNECT,data:e})}):this.packet({type:g.CONNECT,data:this.auth})}onerror(e){this.connected||this.emitReserved("connect_error",e)}onclose(e){this.connected=!1,this.disconnected=!0,delete this.id,this.emitReserved("disconnect",e)}onpacket(e){if(e.nsp===this.nsp)switch(e.type){case g.CONNECT:if(e.data&&e.data.sid){const i=e.data.sid;this.onconnect(i)}else this.emitReserved("connect_error",new Error("It seems you are trying to reach a Socket.IO server in v2.x with a v3.x client, but they are not compatible (more information here: https://socket.io/docs/v3/migrating-from-2-x-to-3-0/)"));break;case g.EVENT:this.onevent(e);break;case g.BINARY_EVENT:this.onevent(e);break;case g.ACK:this.onack(e);break;case g.BINARY_ACK:this.onack(e);break;case g.DISCONNECT:this.ondisconnect();break;case g.CONNECT_ERROR:this.destroy();const n=new Error(e.data.message);n.data=e.data.data,this.emitReserved("connect_error",n);break}}onevent(e){const r=e.data||[];e.id!=null&&r.push(this.ack(e.id)),this.connected?this.emitEvent(r):this.receiveBuffer.push(Object.freeze(r))}emitEvent(e){if(this._anyListeners&&this._anyListeners.length){const r=this._anyListeners.slice();for(const n of r)n.apply(this,e)}super.emit.apply(this,e)}ack(e){const r=this;let n=!1;return function(...i){n||(n=!0,r.packet({type:g.ACK,id:e,data:i}))}}onack(e){const r=this.acks[e.id];typeof r=="function"&&(r.apply(this,e.data),delete this.acks[e.id])}onconnect(e){this.id=e,this.connected=!0,this.disconnected=!1,this.emitBuffered(),this.emitReserved("connect")}emitBuffered(){this.receiveBuffer.forEach(e=>this.emitEvent(e)),this.receiveBuffer=[],this.sendBuffer.forEach(e=>this.packet(e)),this.sendBuffer=[]}ondisconnect(){this.destroy(),this.onclose("io server disconnect")}destroy(){this.subs&&(this.subs.forEach(e=>e()),this.subs=void 0),this.io._destroy(this)}disconnect(){return this.connected&&this.packet({type:g.DISCONNECT}),this.destroy(),this.connected&&this.onclose("io client disconnect"),this}close(){return this.disconnect()}compress(e){return this.flags.compress=e,this}get volatile(){return this.flags.volatile=!0,this}timeout(e){return this.flags.timeout=e,this}onAny(e){return this._anyListeners=this._anyListeners||[],this._anyListeners.push(e),this}prependAny(e){return this._anyListeners=this._anyListeners||[],this._anyListeners.unshift(e),this}offAny(e){if(!this._anyListeners)return this;if(e){const r=this._anyListeners;for(let n=0;n<r.length;n++)if(e===r[n])return r.splice(n,1),this}else this._anyListeners=[];return this}listenersAny(){return this._anyListeners||[]}}var Jn=L;function L(t){t=t||{},this.ms=t.min||100,this.max=t.max||1e4,this.factor=t.factor||2,this.jitter=t.jitter>0&&t.jitter<=1?t.jitter:0,this.attempts=0}L.prototype.duration=function(){var t=this.ms*Math.pow(this.factor,this.attempts++);if(this.jitter){var e=Math.random(),r=Math.floor(e*this.jitter*t);t=(Math.floor(e*10)&1)==0?t-r:t+r}return Math.min(t,this.max)|0};L.prototype.reset=function(){this.attempts=0};L.prototype.setMin=function(t){this.ms=t};L.prototype.setMax=function(t){this.max=t};L.prototype.setJitter=function(t){this.jitter=t};class Ve extends ${constructor(e,r){var n;super();this.nsps={},this.subs=[],e&&typeof e=="object"&&(r=e,e=void 0),r=r||{},r.path=r.path||"/socket.io",this.opts=r,fe(this,r),this.reconnection(r.reconnection!==!1),this.reconnectionAttempts(r.reconnectionAttempts||1/0),this.reconnectionDelay(r.reconnectionDelay||1e3),this.reconnectionDelayMax(r.reconnectionDelayMax||5e3),this.randomizationFactor((n=r.randomizationFactor)!==null&&n!==void 0?n:.5),this.backoff=new Jn({min:this.reconnectionDelay(),max:this.reconnectionDelayMax(),jitter:this.randomizationFactor()}),this.timeout(r.timeout==null?2e4:r.timeout),this._readyState="closed",this.uri=e;const i=r.parser||jn;this.encoder=new i.Encoder,this.decoder=new i.Decoder,this._autoConnect=r.autoConnect!==!1,this._autoConnect&&this.open()}reconnection(e){return arguments.length?(this._reconnection=!!e,this):this._reconnection}reconnectionAttempts(e){return e===void 0?this._reconnectionAttempts:(this._reconnectionAttempts=e,this)}reconnectionDelay(e){var r;return e===void 0?this._reconnectionDelay:(this._reconnectionDelay=e,(r=this.backoff)===null||r===void 0||r.setMin(e),this)}randomizationFactor(e){var r;return e===void 0?this._randomizationFactor:(this._randomizationFactor=e,(r=this.backoff)===null||r===void 0||r.setJitter(e),this)}reconnectionDelayMax(e){var r;return e===void 0?this._reconnectionDelayMax:(this._reconnectionDelayMax=e,(r=this.backoff)===null||r===void 0||r.setMax(e),this)}timeout(e){return arguments.length?(this._timeout=e,this):this._timeout}maybeReconnectOnOpen(){!this._reconnecting&&this._reconnection&&this.backoff.attempts===0&&this.reconnect()}open(e){if(~this._readyState.indexOf("open"))return this;this.engine=new N(this.uri,this.opts);const r=this.engine,n=this;this._readyState="opening",this.skipReconnect=!1;const i=I(r,"open",function(){n.onopen(),e&&e()}),o=I(r,"error",s=>{n.cleanup(),n._readyState="closed",this.emitReserved("error",s),e?e(s):n.maybeReconnectOnOpen()});if(this._timeout!==!1){const s=this._timeout;s===0&&i();const a=this.setTimeoutFn(()=>{i(),r.close(),r.emit("error",new Error("timeout"))},s);this.opts.autoUnref&&a.unref(),this.subs.push(function(){clearTimeout(a)})}return this.subs.push(i),this.subs.push(o),this}connect(e){return this.open(e)}onopen(){this.cleanup(),this._readyState="open",this.emitReserved("open");const e=this.engine;this.subs.push(I(e,"ping",this.onping.bind(this)),I(e,"data",this.ondata.bind(this)),I(e,"error",this.onerror.bind(this)),I(e,"close",this.onclose.bind(this)),I(this.decoder,"decoded",this.ondecoded.bind(this)))}onping(){this.emitReserved("ping")}ondata(e){this.decoder.add(e)}ondecoded(e){this.emitReserved("packet",e)}onerror(e){this.emitReserved("error",e)}socket(e,r){let n=this.nsps[e];return n||(n=new Et(this,e,r),this.nsps[e]=n),n}_destroy(e){const r=Object.keys(this.nsps);for(const n of r)if(this.nsps[n].active)return;this._close()}_packet(e){const r=this.encoder.encode(e);for(let n=0;n<r.length;n++)this.engine.write(r[n],e.options)}cleanup(){this.subs.forEach(e=>e()),this.subs.length=0,this.decoder.destroy()}_close(){this.skipReconnect=!0,this._reconnecting=!1,this.onclose("forced close"),this.engine&&this.engine.close()}disconnect(){return this._close()}onclose(e){this.cleanup(),this.backoff.reset(),this._readyState="closed",this.emitReserved("close",e),this._reconnection&&!this.skipReconnect&&this.reconnect()}reconnect(){if(this._reconnecting||this.skipReconnect)return this;const e=this;if(this.backoff.attempts>=this._reconnectionAttempts)this.backoff.reset(),this.emitReserved("reconnect_failed"),this._reconnecting=!1;else{const r=this.backoff.duration();this._reconnecting=!0;const n=this.setTimeoutFn(()=>{e.skipReconnect||(this.emitReserved("reconnect_attempt",e.backoff.attempts),!e.skipReconnect&&e.open(i=>{i?(e._reconnecting=!1,e.reconnect(),this.emitReserved("reconnect_error",i)):e.onreconnect()}))},r);this.opts.autoUnref&&n.unref(),this.subs.push(function(){clearTimeout(n)})}}onreconnect(){const e=this.backoff.attempts;this._reconnecting=!1,this.backoff.reset(),this.emitReserved("reconnect",e)}}const Z={};function $e(t,e){typeof t=="object"&&(e=t,t=void 0),e=e||{};const r=hn(t,e.path||"/socket.io"),n=r.source,i=r.id,o=r.path,s=Z[i]&&o in Z[i].nsps,a=e.forceNew||e["force new connection"]||e.multiplex===!1||s;let u;return a?u=new Ve(n,e):(Z[i]||(Z[i]=new Ve(n,e)),u=Z[i]),r.query&&!e.query&&(e.query=r.queryKey),u.socket(r.path,e)}Object.assign($e,{Manager:Ve,Socket:Et,io:$e,connect:$e});var zn={exports:{}},At={exports:{}};function Kn(t){return t>64&&t<91?t-65:t>96&&t<123?t-71:t>47&&t<58?t+4:t===43?62:t===47?63:0}function Gn(t,e){for(var r=t.replace(/[^A-Za-z0-9\+\/]/g,""),n=r.length,i=e?Math.ceil((n*3+1>>2)/e)*e:n*3+1>>2,o=new Uint8Array(i),s,a,u=0,c=0,f=0;f<n;f++)if(a=f&3,u|=Kn(r.charCodeAt(f))<<18-6*a,a===3||n-f==1){for(s=0;s<3&&c<i;s++,c++)o[c]=u>>>(16>>>s&24)&255;u=0}return o}var Wn={decode:Gn},Yn=function(t,e){return new Promise(function(r,n){var i=new XMLHttpRequest;e&&(i.responseType=e),i.open("GET",t),i.onload=function(){i.status===200?r(i.response):n(Error(i.statusText))},i.onerror=function(){n(Error("Network Error"))},i.send()})};(function(t){var e=Wn,r=Yn;function n(y){return function(p){return typeof p=="string"&&y.test(p)}}function i(y,p){return typeof y=="string"?y+p:typeof y=="function"?y(p):p}function o(y,p,v,k){var q=s(p)?a:u(p)?c:f(p)?l:h(p)?m:d(p)?b:_(p)?ye:Lt(p)?jt:Ht(p)?Jt:null,M=v||{};return q?q(y,p,M):k?Promise.resolve(k):Promise.reject("Source not valid ("+p+")")}o.fetch=r;function s(y){return y instanceof ArrayBuffer}function a(y,p,v){return new Promise(function(k,q){y.decodeAudioData(p,function(M){k(M)},function(){q("Can't decode audio data ("+p.slice(0,30)+"...)")})})}var u=n(/\.(mp3|wav|ogg)(\?.*)?$/i);function c(y,p,v){var k=i(v.from,p);return o(y,o.fetch(k,"arraybuffer"),v)}function f(y){return y&&typeof y.then=="function"}function l(y,p,v){return p.then(function(k){return o(y,k,v)})}var h=Array.isArray;function m(y,p,v){return Promise.all(p.map(function(k){return o(y,k,v,k)}))}function d(y){return y&&typeof y=="object"}function b(y,p,v){var k={},q=Object.keys(p).map(function(M){if(v.only&&v.only.indexOf(M)===-1)return null;var He=p[M];return o(y,He,v,He).then(function(Kt){k[M]=Kt})});return Promise.all(q).then(function(){return k})}var _=n(/\.json(\?.*)?$/i);function ye(y,p,v){var k=i(v.from,p);return o(y,o.fetch(k,"text").then(JSON.parse),v)}var Lt=n(/^data:audio/);function jt(y,p,v){var k=p.indexOf(",");return o(y,e.decode(p.slice(k+1)).buffer,v)}var Ht=n(/\.js(\?.*)?$/i);function Jt(y,p,v){var k=i(v.from,p);return o(y,o.fetch(k,"text").then(zt),v)}function zt(y){var p=y.indexOf("MIDI.Soundfont.");if(p<0)throw Error("Invalid MIDI.js Soundfont format");p=y.indexOf("=",p)+2;var v=y.lastIndexOf(",");return JSON.parse(y.slice(p,v)+"}")}t.exports&&(t.exports=o),typeof window!="undefined"&&(window.loadAudio=o)})(At);var Ot={exports:{}},Xn=Qn;function Qn(t){var e=t.createGain(),r=e._voltage=ti(t),n=j(r),i=j(r),o=j(r);return e._startAmount=j(i),e._endAmount=j(o),e._multiplier=j(n),e._multiplier.connect(e),e._startAmount.connect(e),e._endAmount.connect(e),e.value=n.gain,e.startValue=i.gain,e.endValue=o.gain,e.startValue.value=0,e.endValue.value=0,Object.defineProperties(e,Zn),e}var Zn={attack:{value:0,writable:!0},decay:{value:0,writable:!0},sustain:{value:1,writable:!0},release:{value:0,writable:!0},getReleaseDuration:{value:function(){return this.release}},start:{value:function(t){var e=this._multiplier.gain,r=this._startAmount.gain,n=this._endAmount.gain;this._voltage.start(t),this._decayFrom=this._decayFrom=t+this.attack,this._startedAt=t;var i=this.sustain;e.cancelScheduledValues(t),r.cancelScheduledValues(t),n.cancelScheduledValues(t),n.setValueAtTime(0,t),this.attack?(e.setValueAtTime(0,t),e.linearRampToValueAtTime(1,t+this.attack),r.setValueAtTime(1,t),r.linearRampToValueAtTime(0,t+this.attack)):(e.setValueAtTime(1,t),r.setValueAtTime(0,t)),this.decay&&e.setTargetAtTime(i,this._decayFrom,Nt(this.decay))}},stop:{value:function(t,e){e&&(t=t-this.release);var r=t+this.release;if(this.release){var n=this._multiplier.gain,i=this._startAmount.gain,o=this._endAmount.gain;n.cancelScheduledValues(t),i.cancelScheduledValues(t),o.cancelScheduledValues(t);var s=Nt(this.release);if(this.attack&&t<this._decayFrom){var a=ri(0,1,this._startedAt,this._decayFrom,t);n.linearRampToValueAtTime(a,t),i.linearRampToValueAtTime(1-a,t),i.setTargetAtTime(0,t,s)}o.setTargetAtTime(1,t,s),n.setTargetAtTime(0,t,s)}return this._voltage.stop(r),r}},onended:{get:function(){return this._voltage.onended},set:function(t){this._voltage.onended=t}}},ei=new Float32Array([1,1]);function ti(t){var e=t.createBufferSource(),r=t.createBuffer(1,2,t.sampleRate);return r.getChannelData(0).set(ei),e.buffer=r,e.loop=!0,e}function j(t){var e=t.context.createGain();return t.connect(e),e}function Nt(t){return Math.log(t+1)/Math.log(100)}function ri(t,e,r,n,i){var o=e-t,s=n-r,a=i-r,u=a/s,c=t+u*o;return c<=t&&(c=t),c>=e&&(c=e),c}var ni=Xn,ii={},si={gain:1,attack:.01,decay:.1,sustain:.9,release:.3,loop:!1,cents:0,loopStart:0,loopEnd:0};function oi(t,e,r){var n=!1,i=0,o={},s=t.createGain();s.gain.value=1;var a=Object.assign({},si,r),u={context:t,out:s,opts:a};return e instanceof AudioBuffer?u.buffer=e:u.buffers=e,u.start=function(l,h,m){if(u.buffer&&l!==null)return u.start(null,l,h);var d=l?u.buffers[l]:u.buffer;if(d){if(!n){console.warn("SamplePlayer not connected to any node.");return}}else{console.warn("Buffer "+l+" not found.");return}var b=m||ii;h=Math.max(t.currentTime,h||0),u.emit("start",h,l,b);var _=f(l,d,b);return _.id=c(l,_),_.env.start(h),_.source.start(h),u.emit("started",h,_.id,_),b.duration&&_.stop(h+b.duration),_},u.play=function(l,h,m){return u.start(l,h,m)},u.stop=function(l,h){var m;return h=h||Object.keys(o),h.map(function(d){return m=o[d],m?(m.stop(l),m.id):null})},u.connect=function(l){return n=!0,s.connect(l),u},u.emit=function(l,h,m,d){u.onevent&&u.onevent(l,h,m,d);var b=u["on"+l];b&&b(h,m,d)},u;function c(l,h){return h.id=i++,o[h.id]=h,h.source.onended=function(){var m=t.currentTime;h.source.disconnect(),h.env.disconnect(),h.disconnect(),u.emit("ended",m,h.id,h)},h.id}function f(l,h,m){var d=t.createGain();return d.gain.value=0,d.connect(s),d.env=ci(t,m,a),d.env.connect(d.gain),d.source=t.createBufferSource(),d.source.buffer=h,d.source.connect(d),d.source.loop=m.loop||a.loop,d.source.playbackRate.value=ui(m.cents||a.cents),d.source.loopStart=m.loopStart||a.loopStart,d.source.loopEnd=m.loopEnd||a.loopEnd,d.stop=function(b){var _=b||t.currentTime;u.emit("stop",_,l);var ye=d.env.stop(_);d.source.stop(ye)},d}}function Ct(t){return typeof t=="number"}var ai=["attack","decay","sustain","release"];function ci(t,e,r){var n=ni(t),i=e.adsr||r.adsr;return ai.forEach(function(o,s){i?n[o]=i[s]:n[o]=e[o]||r[o]}),n.value.value=Ct(e.gain)?e.gain:Ct(r.gain)?r.gain:1,n}function ui(t){return t?Math.pow(2,t/1200):1}var hi=oi,fi=function(t){return t.on=function(e,r){if(arguments.length===1&&typeof e=="function")return t.on("event",e);var n="on"+e,i=t[n];return t[n]=i?li(i,r):r,t},t};function li(t,e){return function(r,n,i,o){t(r,n,i,o),e(r,n,i,o)}}var Ut=/^([a-gA-G])(#{1,}|b{1,}|x{1,}|)(-?\d*)\s*(.*)\s*$/;function di(){return Ut}var pi=[0,2,4,5,7,9,11];function Bt(t,e,r){if(typeof t!="string")return null;var n=Ut.exec(t);if(!n||!e&&n[4])return null;var i={letter:n[1].toUpperCase(),acc:n[2].replace(/x/g,"##")};return i.pc=i.letter+i.acc,i.step=(i.letter.charCodeAt(0)+3)%7,i.alt=i.acc[0]==="b"?-i.acc.length:i.acc.length,i.chroma=pi[i.step]+i.alt,n[3]&&(i.oct=+n[3],i.midi=i.chroma+12*(i.oct+1),i.freq=Pt(i.midi,r)),e&&(i.tonicOf=n[4]),i}function Pt(t,e){return Math.pow(2,(t-69)/12)*(e||440)}var Mt={parse:Bt,regex:di,midiToFreq:Pt},mi=["letter","acc","pc","step","alt","chroma","oct","midi","freq"];mi.forEach(function(t){Mt[t]=function(e){var r=Bt(e);return r&&typeof r[t]!="undefined"?r[t]:null}});var yi=Mt,gi=yi,bi=function(t){return t!==null&&t!==[]&&t>=0&&t<129},vi=function(t){return bi(t)?+t:gi.midi(t)},ki=function(t){if(t.buffers){var e=t.opts.map,r=typeof e=="function"?e:vi,n=function(o){return o?r(o)||o:null};t.buffers=wi(t.buffers,n);var i=t.start;t.start=function(o,s,a){var u=n(o),c=u%1;return c&&(u=Math.floor(u),a=Object.assign(a||{},{cents:Math.floor(c*100)})),i(u,s,a)}}return t};function wi(t,e){return Object.keys(t).reduce(function(r,n){return r[e(n)]=t[n],r},{})}var xi=Array.isArray,Ti=function(t){return t&&typeof t=="object"},_i={},Ii=function(t){return t.schedule=function(e,r){var n=t.context.currentTime,i=e<n?n:e;t.emit("schedule",i,r);var o,s,a,u;return r.map(function(c){if(c)xi(c)?(o=c[0],s=c[1]):(o=c.time,s=c);else return null;return Ti(s)?(a=s.name||s.key||s.note||s.midi||null,u=s):(a=s,u=_i),t.start(a,i+(o||0),u)})},t},Ft={exports:{}};(function(t,e){(function(r){t.exports=r()})(function(){return function r(n,i,o){function s(c,f){if(!i[c]){if(!n[c]){var l=typeof ne=="function"&&ne;if(!f&&l)return l(c,!0);if(a)return a(c,!0);var h=new Error("Cannot find module '"+c+"'");throw h.code="MODULE_NOT_FOUND",h}var m=i[c]={exports:{}};n[c][0].call(m.exports,function(d){var b=n[c][1][d];return s(b||d)},m,m.exports,r,n,i,o)}return i[c].exports}for(var a=typeof ne=="function"&&ne,u=0;u<o.length;u++)s(o[u]);return s}({1:[function(r,n,i){Object.defineProperty(i,"__esModule",{value:!0}),i.default=function(o){function s(a){if(this._event=a,this._data=a.data,this.receivedTime=a.receivedTime,this._data&&this._data.length<2){console.warn("Illegal MIDI message of length",this._data.length);return}switch(this._messageCode=a.data[0]&240,this.channel=a.data[0]&15,this._messageCode){case 128:this.messageType="noteoff",this.key=a.data[1]&127,this.velocity=a.data[2]&127;break;case 144:this.messageType="noteon",this.key=a.data[1]&127,this.velocity=a.data[2]&127;break;case 160:this.messageType="keypressure",this.key=a.data[1]&127,this.pressure=a.data[2]&127;break;case 176:this.messageType="controlchange",this.controllerNumber=a.data[1]&127,this.controllerValue=a.data[2]&127,this.controllerNumber===120&&this.controllerValue===0?this.channelModeMessage="allsoundoff":this.controllerNumber===121?this.channelModeMessage="resetallcontrollers":this.controllerNumber===122?this.controllerValue===0?this.channelModeMessage="localcontroloff":this.channelModeMessage="localcontrolon":this.controllerNumber===123&&this.controllerValue===0?this.channelModeMessage="allnotesoff":this.controllerNumber===124&&this.controllerValue===0?this.channelModeMessage="omnimodeoff":this.controllerNumber===125&&this.controllerValue===0?this.channelModeMessage="omnimodeon":this.controllerNumber===126?this.channelModeMessage="monomodeon":this.controllerNumber===127&&(this.channelModeMessage="polymodeon");break;case 192:this.messageType="programchange",this.program=a.data[1];break;case 208:this.messageType="channelpressure",this.pressure=a.data[1]&127;break;case 224:this.messageType="pitchbendchange";var u=a.data[2]&127,c=a.data[1]&127;this.pitchBend=(u<<8)+c;break}}return new s(o)},n.exports=i.default},{}]},{},[1])(1)})})(Ft);var Si=Ft.exports,Ei=function(t){return t.listenToMidi=function(e,r){var n={},i=r||{},o=i.gain||function(s){return s/127};return e.onmidimessage=function(s){var a=s.messageType?s:Si(s);if(a.messageType==="noteon"&&a.velocity===0&&(a.messageType="noteoff"),!(i.channel&&a.channel!==i.channel))switch(a.messageType){case"noteon":n[a.key]=t.play(a.key,0,{gain:o(a.velocity)});break;case"noteoff":n[a.key]&&(n[a.key].stop(),delete n[a.key]);break}},t},t};(function(t){var e=hi,r=fi,n=ki,i=Ii,o=Ei;function s(a,u,c){return o(i(n(r(e(a,u,c)))))}t.exports&&(t.exports=s),typeof window!="undefined"&&(window.SamplePlayer=s)})(Ot);function Rt(t,e){return Array(e+1).join(t)}function Le(t){return typeof t=="number"}function Ai(t){return typeof t=="string"}function Oi(t){return typeof t!="undefined"}function qt(t,e){return Math.pow(2,(t-69)/12)*(e||440)}var Dt=/^([a-gA-G])(#{1,}|b{1,}|x{1,}|)(-?\d*)\s*(.*)\s*$/;function Ni(){return Dt}var Ci=[0,2,4,5,7,9,11];function C(t,e,r){if(typeof t!="string")return null;var n=Dt.exec(t);if(!n||!e&&n[4])return null;var i={letter:n[1].toUpperCase(),acc:n[2].replace(/x/g,"##")};i.pc=i.letter+i.acc,i.step=(i.letter.charCodeAt(0)+3)%7,i.alt=i.acc[0]==="b"?-i.acc.length:i.acc.length;var o=Ci[i.step]+i.alt;return i.chroma=o<0?12+o:o%12,n[3]&&(i.oct=+n[3],i.midi=o+12*(i.oct+1),i.freq=qt(i.midi,r)),e&&(i.tonicOf=n[4]),i}var Ui="CDEFGAB";function Bi(t){return Le(t)?t<0?Rt("b",-t):Rt("#",t):""}function Pi(t){return Le(t)?""+t:""}function Vt(t,e,r){return t===null||typeof t=="undefined"?null:t.step?Vt(t.step,t.alt,t.oct):t<0||t>6?null:Ui.charAt(t)+Bi(e)+Pi(r)}function $t(t){if((Le(t)||Ai(t))&&t>=0&&t<128)return+t;var e=C(t);return e&&Oi(e.midi)?e.midi:null}function Mi(t,e){var r=$t(t);return r===null?null:qt(r,e)}function Fi(t){return(C(t)||{}).letter}function Ri(t){return(C(t)||{}).acc}function qi(t){return(C(t)||{}).pc}function Di(t){return(C(t)||{}).step}function Vi(t){return(C(t)||{}).alt}function $i(t){return(C(t)||{}).chroma}function Li(t){return(C(t)||{}).oct}var ji=Object.freeze({__proto__:null,[Symbol.toStringTag]:"Module",regex:Ni,parse:C,build:Vt,midi:$t,freq:Mi,letter:Fi,acc:Ri,pc:qi,step:Di,alt:Vi,chroma:$i,oct:Li}),Hi=ur(ji),je=Hi;function A(t,e){if(console.warn("new Soundfont() is deprected"),console.log("Please use Soundfont.instrument() instead of new Soundfont().instrument()"),!(this instanceof A))return new A(t);this.nameToUrl=e||A.nameToUrl,this.ctx=t,this.instruments={},this.promises=[]}A.prototype.onready=function(t){console.warn("deprecated API"),console.log("Please use Promise.all(Soundfont.instrument(), Soundfont.instrument()).then() instead of new Soundfont().onready()"),Promise.all(this.promises).then(t)};A.prototype.instrument=function(t,e){console.warn("new Soundfont().instrument() is deprecated."),console.log("Please use Soundfont.instrument() instead.");var r=this.ctx;if(t=t||"default",t in this.instruments)return this.instruments[t];var n={name:t,play:zi(r,e)};if(this.instruments[t]=n,t!=="default"){var i=A.instrument(r,t,e).then(function(o){return n.play=o.play,n});this.promises.push(i),n.onready=function(o){console.warn("onready is deprecated. Use Soundfont.instrument().then()"),i.then(o)}}else n.onready=function(o){console.warn("onready is deprecated. Use Soundfont.instrument().then()"),o()};return n};function Ji(t,e,r){return console.warn("Soundfont.loadBuffers is deprecate."),console.log("Use Soundfont.instrument(..) and get buffers properties from the result."),A.instrument(t,e,r).then(function(n){return n.buffers})}A.loadBuffers=Ji;function zi(t,e){return e=e||{},function(r,n,i,o){console.warn("The oscillator player is deprecated."),console.log("Starting with version 0.9.0 you will have to wait until the soundfont is loaded to play sounds.");var s=r>0&&r<129?+r:je.midi(r),a=s?je.midiToFreq(s,440):null;if(!!a){i=i||.2,o=o||{};var u=o.destination||e.destination||t.destination,c=o.vcoType||e.vcoType||"sine",f=o.gain||e.gain||.4,l=t.createOscillator();l.type=c,l.frequency.value=a;var h=t.createGain();return h.gain.value=f,l.connect(h),h.connect(u),l.start(n),i>0&&l.stop(n+i),l}}}A.noteToMidi=je.midi;var Ki=A;(function(t){var e=At.exports,r=Ot.exports;function n(a,u,c){if(arguments.length===1)return function(d,b){return n(a,d,b)};var f=c||{},l=f.isSoundfontURL||i,h=f.nameToUrl||o,m=l(u)?u:h(u,f.soundfont,f.format);return e(a,m,{only:f.only||f.notes}).then(function(d){var b=r(a,d,f).connect(f.destination?f.destination:a.destination);return b.url=m,b.name=u,b})}function i(a){return/\.js(\?.*)?$/i.test(a)}function o(a,u,c){return c=c==="ogg"?c:"mp3",u=u==="FluidR3_GM"?u:"MusyngKite","https://gleitz.github.io/midi-js-soundfonts/"+u+"/"+a+"-"+c+".js"}var s=Ki;s.instrument=n,s.nameToUrl=o,t.exports&&(t.exports=s),typeof window!="undefined"&&(window.Soundfont=s)})(zn);export{Wi as A,gs as B,Yi as C,ls as D,ns as E,ds as F,ss as G,ps as H,Ye as I,bs as J,or as K,Qe as L,xs as M,sr as N,ar as O,ks as S,$e as a,Zi as b,Qi as c,Xt as d,ts as e,rs as f,Gi as g,ms as h,vs as i,os as j,be as k,zn as l,hs as m,F as n,us as o,fs as p,is as q,Xi as r,Wt as s,We as t,as as u,cs as v,ws as w,ys as x,es as y,H as z};

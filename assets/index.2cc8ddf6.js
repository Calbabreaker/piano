import{g as te,w as W,M as Yt,l as Xt,a as Zt,S as Qe,i as Ve,s as Ye,e as h,t as re,b as K,c,n as A,d as P,h as Be,f as k,j as _,k as $t,m as St,o as q,p as At,q as y,r as xt,u as ce,v as Xe,x as en,y as Ze,z as $e,A as I,B as tn,C as z,D as nn,E as xe,F as qe,G as on,H as ln,I as sn,J as Dt,K as jt,L as Et,N as Mt,O as Ft}from"./vendor.90408fa6.js";const an=function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const l of document.querySelectorAll('link[rel="modulepreload"]'))o(l);new MutationObserver(l=>{for(const s of l)if(s.type==="childList")for(const a of s.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&o(a)}).observe(document,{childList:!0,subtree:!0});function n(l){const s={};return l.integrity&&(s.integrity=l.integrity),l.referrerpolicy&&(s.referrerPolicy=l.referrerpolicy),l.crossorigin==="use-credentials"?s.credentials="include":l.crossorigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function o(l){if(l.ep)return;l.ep=!0;const s=n(l);fetch(l.href,s)}};an();const Tt=["accordion","acoustic_bass","acoustic_grand_piano","acoustic_guitar_nylon","acoustic_guitar_steel","agogo","alto_sax","applause","bagpipe","banjo","baritone_sax","bassoon","bird_tweet","blown_bottle","brass_section","breath_noise","bright_acoustic_piano","celesta","cello","choir_aahs","church_organ","clarinet","clavinet","contrabass","distortion_guitar","drawbar_organ","dulcimer","electric_bass_finger","electric_bass_pick","electric_grand_piano","electric_guitar_clean","electric_guitar_jazz","electric_guitar_muted","electric_piano_1","electric_piano_2","english_horn","fiddle","flute","french_horn","fretless_bass","fx_1_rain","fx_2_soundtrack","fx_3_crystal","fx_4_atmosphere","fx_5_brightness","fx_6_goblins","fx_7_echoes","fx_8_scifi","glockenspiel","guitar_fret_noise","guitar_harmonics","gunshot","harmonica","harpsichord","helicopter","honkytonk_piano","kalimba","koto","lead_1_square","lead_2_sawtooth","lead_3_calliope","lead_4_chiff","lead_5_charang","lead_6_voice","lead_7_fifths","lead_8_bass__lead","marimba","melodic_tom","music_box","muted_trumpet","oboe","ocarina","orchestra_hit","orchestral_harp","overdriven_guitar","pad_1_new_age","pad_2_warm","pad_3_polysynth","pad_4_choir","pad_5_bowed","pad_6_metallic","pad_7_halo","pad_8_sweep","pan_flute","percussive_organ","piccolo","pizzicato_strings","recorder","reed_organ","reverse_cymbal","rock_organ","seashore","shakuhachi","shamisen","shanai","sitar","slap_bass_1","slap_bass_2","soprano_sax","steel_drums","string_ensemble_1","string_ensemble_2","synth_bass_1","synth_bass_2","synth_brass_1","synth_brass_2","synth_choir","synth_drum","synth_strings_1","synth_strings_2","taiko_drum","tango_accordion","telephone_ring","tenor_sax","timpani","tinkle_bell","tremolo_strings","trombone","trumpet","tuba","tubular_bells","vibraphone","viola","violin","voice_oohs","whistle","woodblock","xylophone"],Ke=["C","C#","D","D#","E","F","F#","G","G#","A","A#","B"],Ot={Backquote:"A#2",Tab:"B2",KeyQ:"C3",Digit2:"C#3",KeyW:"D3",Digit3:"D#3",KeyE:"E3",KeyR:"F3",Digit5:"F#3",KeyT:"G3",Digit6:"G#3",KeyY:"A3",Digit7:"A#3",KeyU:"B3",KeyI:"C4",Digit9:"C#4",KeyO:"D4",Digit0:"D#4",KeyP:"E4",BracketLeft:"F4",Equal:"F#4",BracketRight:"G4",Backspace:"G#4",Backslash:"A4",CapsLock:"A#4",ShiftLeft:"B4",KeyZ:"C5",KeyS:"C#5",KeyX:"D5",KeyD:"D#5",KeyC:"E5",KeyV:"F5",KeyG:"F#5",KeyB:"G5",KeyH:"G#5",KeyN:"A5",KeyJ:"A#5",KeyM:"B5",Comma:"C6",KeyL:"C#6",Period:"D6",Semicolon:"D#6",Slash:"E6",ShiftRight:"F6",Enter:"F#6"};function et(e){return parseInt(e.charAt(e.length-1))}function tt(e){return e.substring(0,e.length-1)}function nt(e){const t=Math.floor(e/12)-1;return Ke[e%12]+t}function rn(e,t){const n=et(t),o=et(e),l=Ke.indexOf(tt(e)),s=Ke.indexOf(tt(t)),a={};let u=0;for(let p=o;p<=n;p++){let r=p===o?l:0;for(;r<Ke.length&&!(p===n&&r>s);){const d=Ke[r],b=d.length===1;a[d+p]={white:b,pressedColor:null,ghost:!1},b&&u++,r++}}return{noteMap:a,whiteKeys:u}}const U=W(!1),ye=W(0),ze=W(0),ot=W(),Pe=W(1);async function cn(e,t){let n=[],o=null;function l(r){o=new Yt(r),o.tracks=o.tracks.filter(d=>d.notes.length!==0);let i=0;o.tracks.forEach(d=>{const b=d.notes[d.notes.length-1],w=b.time+b.duration;w>i&&(i=w)}),ze.set(i)}ot.subscribe(r=>{if(U.set(!1),ze.set(0),ye.set(0),!r){o=null;return}const i=new FileReader;i.onload=()=>l(i.result),i.readAsArrayBuffer(r)});function s(r){const i=te(ye)+r;ye.set(i),o.tracks.forEach((d,b)=>{const w=d.notes[n[b]];if(!w)return;i-w.time>0&&(e(w.name,w.velocity),setTimeout(()=>t(w.name),w.duration*1e3/te(Pe)),n[b]++)}),i>te(ze)&&U.set(!1)}U.subscribe(r=>{if(!r)return;if(!o)return U.set(!1),alert("No MIDI file selected!");o.tracks.forEach((b,w)=>{let v=0,D=b.notes.length-1;for(;v!=D;){const E=Math.ceil((v+D)/2);b.notes[E].time>te(ye)?D=E-1:v=E}n[w]=v});let i=performance.now();const d=()=>{if(!te(U))return;const b=performance.now(),w=b-i;i=b,s(w/1e3*te(Pe)),requestAnimationFrame(d)};d()});function a(r){const[i,d,b]=r.data;i>143&&i<160?b==0?t(nt(d)):e(nt(d),b/127):i>127&&i<144&&t(nt(d))}const u=await navigator.requestMIDIAccess();function p(){u.inputs.forEach(r=>{r.onmidimessage=a})}p(),u.onstatechange=()=>{p()}}const It=window.AudioContext||window.webkitAudioContext;It||alert("Your browser does not seem to support the Web Audio API!");const un=new It,lt={};function Bt(e){return lt[e]||(lt[e]=Xt.exports.instrument(un,e)),lt[e]}const qt=W(),Le=W("acoustic_grand_piano"),de=W(null),ue=new Map,Re={audioNodeMap:new Map,colorHue:"220"};ue.set("0",Re);let S,st,it;async function at(e,t){let n=await Bt(e),o=ue.get(t);o&&(o.instrument=n)}function zt({socketID:e,colorHue:t,instrumentName:n}){ue.set(e,{audioNodeMap:e===S.id?Re.audioNodeMap:new Map,colorHue:t}),te(de)!==null&&de.set(te(de).set(e,t)),n&&at(n,e)}function _n(e,t){st=e,it=t}function rt(e){const t=new Promise((n,o)=>{S=Zt("https://calbabreaker-piano-backend.herokuapp.com",{query:{roomName:e,instrumentName:te(Le)},path:{}.VITE_BACKEND_PATH}),S.on("connect_error",()=>o("Failed to connect to server!")),S.on("connect_timeout",()=>o("Timed out while connecting to server!")),S.on("connect",()=>{ue.delete("0"),de.set(new Map),n(),history.replaceState({},`Play Piano! - ${e}`,`?room=${e}`)}),S.on("disconnect",()=>{de.set(null),ue.clear(),ue.set("0",Re),S=null,history.replaceState({},"Play Piano!",location.pathname)}),S.on("play_note",s=>{st(s)}),S.on("stop_note",s=>{it(s)}),S.on("instrument_change",s=>{const{instrumentName:a,socketID:u}=s;at(a,u)}),S.on("client_connect",s=>{zt(s)}),S.on("client_list_recieve",s=>{const a=s;for(let u of a)zt(u)}),S.on("client_disconnect",s=>{const a=te(de);a.delete(s),de.set(a),ue.delete(s)})});qt.set(t)}function fn(e,t){const n={note:e,volume:t};S?S.emit("play_note",n):st(n)}function ct(e,t){const n={note:e,sustain:t};S?S.emit("stop_note",n):it(n)}Le.subscribe(e=>{S?S.emit("instrument_change",{instrumentName:e}):at(e,"0")});const{window:pn}=tn;function Lt(e,t,n){const o=e.slice();return o[37]=t[n][0],o[38]=t[n][1],o}function Rt(e,t,n){const o=e.slice();return o[42]=t[n],o}function Ht(e){let t,n=e[42]+"",o,l;return{c(){t=h("option"),o=re(n),t.__value=l=e[42],t.value=t.__value},m(s,a){K(s,t,a),c(t,o)},p:A,d(s){s&&P(t)}}}function dn(e){return{c:A,m:A,d:A}}function hn(e){return{c:A,m:A,d:A}}function mn(e){let t;return{c(){t=re("loading...")},m(n,o){K(n,t,o)},d(n){n&&P(t)}}}function gn(e){let t,n,o;return{c(){t=h("button"),t.textContent="Play"},m(l,s){K(l,t,s),n||(o=y(t,"click",e[23]),n=!0)},p:A,d(l){l&&P(t),n=!1,o()}}}function bn(e){let t,n,o;return{c(){t=h("button"),t.textContent="Pause"},m(l,s){K(l,t,s),n||(o=y(t,"click",e[22]),n=!0)},p:A,d(l){l&&P(t),n=!1,o()}}}function vn(e){let t,n,o;return{c(){t=h("button"),t.textContent="Join"},m(l,s){K(l,t,s),n||(o=y(t,"click",e[33]),n=!0)},p:A,d(l){l&&P(t),n=!1,o()}}}function yn(e){let t,n,o;return{c(){t=h("button"),t.textContent="Leave"},m(l,s){K(l,t,s),n||(o=y(t,"click",e[32]),n=!0)},p:A,d(l){l&&P(t),n=!1,o()}}}function kn(e){let t,n=e[41]+"",o;return{c(){t=h("span"),o=re(n),_(t,"class","error svelte-1ufj93m")},m(l,s){K(l,t,s),c(t,o)},p(l,s){s[0]&4096&&n!==(n=l[41]+"")&&Xe(o,n)},d(l){l&&P(t)}}}function wn(e){let t,n=e[11]!==null&&Gt(e);return{c(){n&&n.c(),t=xe()},m(o,l){n&&n.m(o,l),K(o,t,l)},p(o,l){o[11]!==null?n?n.p(o,l):(n=Gt(o),n.c(),n.m(t.parentNode,t)):n&&(n.d(1),n=null)},d(o){n&&n.d(o),o&&P(t)}}}function Gt(e){let t,n,o,l,s,a,u=Array.from(e[11].entries()),p=[];for(let r=0;r<u.length;r+=1)p[r]=Wt(Lt(e,u,r));return{c(){t=h("span"),t.textContent="Connected!",n=h("br"),o=k(),l=h("span"),l.textContent="People:",s=k();for(let r=0;r<p.length;r+=1)p[r].c();a=xe()},m(r,i){K(r,t,i),K(r,n,i),K(r,o,i),K(r,l,i),K(r,s,i);for(let d=0;d<p.length;d+=1)p[d].m(r,i);K(r,a,i)},p(r,i){if(i[0]&2048){u=Array.from(r[11].entries());let d;for(d=0;d<u.length;d+=1){const b=Lt(r,u,d);p[d]?p[d].p(b,i):(p[d]=Wt(b),p[d].c(),p[d].m(a.parentNode,a))}for(;d<p.length;d+=1)p[d].d(1);p.length=u.length}},d(r){r&&P(t),r&&P(n),r&&P(o),r&&P(l),r&&P(s),Ze(p,r),r&&P(a)}}}function Jt(e){let t;return{c(){t=h("span"),t.textContent="(you)",St(t,"margin-right","0.5rem")},m(n,o){K(n,t,o)},d(n){n&&P(t)}}}function Wt(e){let t,n,o,l,s=e[37]===S.id&&Jt();return{c(){t=h("div"),o=k(),s&&s.c(),l=xe(),_(t,"class","icon svelte-1ufj93m"),_(t,"style",n=`--color-hue: ${e[38]}`)},m(a,u){K(a,t,u),K(a,o,u),s&&s.m(a,u),K(a,l,u)},p(a,u){u[0]&2048&&n!==(n=`--color-hue: ${a[38]}`)&&_(t,"style",n),a[37]===S.id?s||(s=Jt(),s.c(),s.m(l.parentNode,l)):s&&(s.d(1),s=null)},d(a){a&&P(t),a&&P(o),s&&s.d(a),a&&P(l)}}}function Cn(e){let t;return{c(){t=h("span"),t.textContent="Connecting..."},m(n,o){K(n,t,o)},p:A,d(n){n&&P(t)}}}function Nn(e){let t,n,o,l,s,a,u,p,r,i,d,b,w,v,D,E,M,me,L,R,H,_e,ge,G,ke,fe,we,be,f,m,C,X,ne,oe,le,Ae,Z,pe,Ce,De,ve,je,se,g,ie,_t,F,ft,Q,pt,ae,dt,ht,mt,O,gt,Ee=e[8].toFixed(1)+"",Ge,bt,Me=e[10].toFixed(1)+"",Je,vt,yt,V,Fe,kt,$,wt,We,Te,Ue,Ct,Ne=Tt,B=[];for(let j=0;j<Ne.length;j+=1)B[j]=Ht(Rt(e,Ne,j));let Y={ctx:e,current:null,token:null,hasCatch:!1,pending:mn,then:hn,catch:dn};Be(fe=e[2],Y);function Nt(j,N){return j[7]?bn:gn}let Oe=Nt(e),x=Oe(e);function Kt(j,N){return j[11]!==null?yn:vn}let Ie=Kt(e),ee=Ie(e),J={ctx:e,current:null,token:null,hasCatch:!0,pending:Cn,then:wn,catch:kn,error:41};return Be(Te=e[12],J),{c(){t=h("div"),n=h("div"),o=h("div"),l=h("div"),s=h("span"),s.textContent="Sustain:",a=k(),u=h("input"),p=k(),r=h("div"),i=h("span"),i.textContent="Octave Shift:",d=k(),b=h("input"),w=k(),v=h("div"),D=h("span"),D.textContent="Volume:",E=k(),M=h("input"),me=k(),L=h("input"),R=k(),H=h("div"),_e=h("span"),_e.textContent="Instrument:",ge=k(),G=h("select");for(let j=0;j<B.length;j+=1)B[j].c();ke=k(),Y.block.c(),we=k(),be=h("span"),be.textContent="Size:",f=k(),m=h("select"),C=h("option"),C.textContent="Full size (88 keys)",X=h("option"),X.textContent="Half size (61 keys)",ne=h("option"),ne.textContent="Quater Size (37 keys)",oe=h("option"),oe.textContent="2 Octaves (24 keys)",le=h("option"),le.textContent="1 Octave (12 keys)",Ae=k(),Z=h("div"),pe=h("div"),Ce=h("p"),Ce.textContent="Play a midi:",De=k(),ve=h("input"),je=k(),se=h("div"),x.c(),g=k(),ie=h("button"),ie.textContent="Restart",_t=k(),F=h("div"),ft=re("Speed:"),Q=h("input"),pt=k(),ae=h("input"),dt=re("times"),ht=h("br"),mt=k(),O=h("input"),gt=k(),Ge=re(Ee),bt=re("/"),Je=re(Me),vt=re(" seconds"),yt=k(),V=h("div"),Fe=h("p"),Fe.textContent="Join a room:",kt=k(),$=h("input"),wt=k(),ee.c(),We=k(),J.block.c(),_(u,"type","checkbox"),_(u,"class","svelte-1ufj93m"),_(l,"title","Shortcut: space"),_(l,"class","svelte-1ufj93m"),_(b,"type","number"),_(b,"min","-3"),_(b,"max","3"),_(b,"class","svelte-1ufj93m"),_(r,"title","Shortcut: left ctrl +, left alt or right ctrl -"),_(r,"class","svelte-1ufj93m"),_(M,"type","range"),_(M,"min","0"),_(M,"max","50"),_(M,"step","0.1"),_(M,"class","svelte-1ufj93m"),_(L,"type","number"),_(L,"class","svelte-1ufj93m"),_(v,"class","svelte-1ufj93m"),e[0]===void 0&&$t(()=>e[19].call(G)),_(H,"class","svelte-1ufj93m"),_(C,"data-range","A0,C8"),C.__value="Full size (88 keys)",C.value=C.__value,_(X,"data-range","C2,C7"),X.selected=!0,X.__value="Half size (61 keys)",X.value=X.__value,_(ne,"data-range","C3,C6"),ne.__value="Quater Size (37 keys)",ne.value=ne.__value,_(oe,"data-range","C4,B5"),oe.__value="2 Octaves (24 keys)",oe.value=oe.__value,_(le,"data-range","C4,B4"),le.__value="1 Octave (12 keys)",le.value=le.__value,_(o,"class","svelte-1ufj93m"),_(Ce,"class","svelte-1ufj93m"),_(ve,"type","file"),_(ve,"class","svelte-1ufj93m"),_(pe,"class","svelte-1ufj93m"),_(se,"class","svelte-1ufj93m"),_(Q,"type","range"),_(Q,"min","0.01"),_(Q,"max","4"),_(Q,"step","0.01"),_(Q,"class","svelte-1ufj93m"),_(ae,"type","number"),_(ae,"min","0.01"),_(ae,"class","svelte-1ufj93m"),_(O,"type","range"),_(O,"min","0"),_(O,"max",e[10]),_(O,"step","0.1"),St(O,"width","18rem"),_(O,"class","svelte-1ufj93m"),_(F,"class","svelte-1ufj93m"),_(Z,"class","svelte-1ufj93m"),_(n,"class","row svelte-1ufj93m"),_(Fe,"class","svelte-1ufj93m"),_($,"type","text"),_($,"placeholder","Room name"),_($,"class","svelte-1ufj93m"),_(t,"class","control-panel svelte-1ufj93m")},m(j,N){K(j,t,N),c(t,n),c(n,o),c(o,l),c(l,s),c(l,a),c(l,u),u.checked=e[4],c(o,p),c(o,r),c(r,i),c(r,d),c(r,b),q(b,e[3]),c(o,w),c(o,v),c(v,D),c(v,E),c(v,M),q(M,e[5]),c(v,me),c(v,L),q(L,e[5]),c(o,R),c(o,H),c(H,_e),c(H,ge),c(H,G);for(let T=0;T<B.length;T+=1)B[T].m(G,null);At(G,e[0]),c(H,ke),Y.block.m(H,Y.anchor=null),Y.mount=()=>H,Y.anchor=null,c(o,we),c(o,be),c(o,f),c(o,m),c(m,C),c(m,X),c(m,ne),c(m,oe),c(m,le),c(n,Ae),c(n,Z),c(Z,pe),c(pe,Ce),c(pe,De),c(pe,ve),c(Z,je),c(Z,se),x.m(se,null),c(se,g),c(se,ie),c(Z,_t),c(Z,F),c(F,ft),c(F,Q),q(Q,e[9]),c(F,pt),c(F,ae),q(ae,e[9]),c(F,dt),c(F,ht),c(F,mt),c(F,O),q(O,e[8]),c(F,gt),c(F,Ge),c(F,bt),c(F,Je),c(F,vt),c(t,yt),c(t,V),c(V,Fe),c(V,kt),c(V,$),q($,e[1]),c(V,wt),ee.m(V,null),c(V,We),J.block.m(V,J.anchor=null),J.mount=()=>V,J.anchor=null,Ue||(Ct=[y(pn,"keydown",e[14]),y(u,"change",e[15]),y(b,"input",e[16]),y(M,"change",e[17]),y(M,"input",e[17]),y(L,"input",e[18]),y(G,"change",e[19]),y(m,"change",e[20]),xt(e[13].call(null,m)),y(ve,"change",e[21]),y(ie,"click",e[24]),y(Q,"change",e[25]),y(Q,"input",e[25]),y(ae,"input",e[26]),y(O,"change",e[27]),y(O,"input",e[27]),y(O,"mousedown",e[28]),y(O,"mouseup",e[29]),y($,"input",e[30]),y($,"keydown",e[31])],Ue=!0)},p(j,N){if(e=j,N[0]&16&&(u.checked=e[4]),N[0]&8&&ce(b.value)!==e[3]&&q(b,e[3]),N[0]&32&&q(M,e[5]),N[0]&32&&ce(L.value)!==e[5]&&q(L,e[5]),N&0){Ne=Tt;let T;for(T=0;T<Ne.length;T+=1){const Pt=Rt(e,Ne,T);B[T]?B[T].p(Pt,N):(B[T]=Ht(Pt),B[T].c(),B[T].m(G,null))}for(;T<B.length;T+=1)B[T].d(1);B.length=Ne.length}N[0]&1&&At(G,e[0]),Y.ctx=e,N[0]&4&&fe!==(fe=e[2])&&Be(fe,Y),Oe===(Oe=Nt(e))&&x?x.p(e,N):(x.d(1),x=Oe(e),x&&(x.c(),x.m(se,g))),N[0]&512&&q(Q,e[9]),N[0]&512&&ce(ae.value)!==e[9]&&q(ae,e[9]),N[0]&1024&&_(O,"max",e[10]),N[0]&256&&q(O,e[8]),N[0]&256&&Ee!==(Ee=e[8].toFixed(1)+"")&&Xe(Ge,Ee),N[0]&1024&&Me!==(Me=e[10].toFixed(1)+"")&&Xe(Je,Me),N[0]&2&&$.value!==e[1]&&q($,e[1]),Ie===(Ie=Kt(e))&&ee?ee.p(e,N):(ee.d(1),ee=Ie(e),ee&&(ee.c(),ee.m(V,We))),J.ctx=e,N[0]&4096&&Te!==(Te=e[12])&&Be(Te,J)||en(J,e,N)},i:A,o:A,d(j){j&&P(t),Ze(B,j),Y.block.d(),Y.token=null,Y=null,x.d(),ee.d(),J.block.d(),J.token=null,J=null,Ue=!1,$e(Ct)}}}const he=W(0),Se=W(!1),He=W(25),ut=W(["C0","C0"]);function Kn(e,t,n){let o,l,s=A,a,u=A,p,r=A,i,d,b=A,w,v,D,E,M,me,L;I(e,he,g=>n(3,l=g)),I(e,Se,g=>n(4,a=g)),I(e,ut,g=>n(34,p=g)),I(e,Le,g=>n(0,i=g)),I(e,He,g=>n(5,d=g)),I(e,ot,g=>n(6,w=g)),I(e,U,g=>n(7,v=g)),I(e,ye,g=>n(8,D=g)),I(e,Pe,g=>n(9,E=g)),I(e,ze,g=>n(10,M=g)),I(e,de,g=>n(11,me=g)),I(e,qt,g=>n(12,L=g)),e.$$.on_destroy.push(()=>s()),e.$$.on_destroy.push(()=>u()),e.$$.on_destroy.push(()=>r()),e.$$.on_destroy.push(()=>b());let R="";const _e=new URLSearchParams(window.location.search).get("room");_e&&(R=_e,rt(R));function ge(g){const ie=g.children[g.selectedIndex];z(ut,p=ie.dataset.range.split(","),p)}function G(g){g.code==="Space"&&z(Se,a=!a,a),g.code==="ControlLeft"?z(he,l-=1,l):(g.code==="AltLeft"||g.code=="ControlRight")&&z(he,l+=1,l),l<-3?z(he,l=3,l):l>3&&z(he,l=-3,l)}function ke(){a=this.checked,Se.set(a)}function fe(){l=ce(this.value),he.set(l)}function we(){d=ce(this.value),He.set(d)}function be(){d=ce(this.value),He.set(d)}function f(){i=nn(this),Le.set(i)}const m=g=>ge(g.currentTarget),C=g=>{var ie;return z(ot,w=(ie=g.currentTarget.files)==null?void 0:ie[0],w)},X=()=>z(U,v=!1,v),ne=()=>z(U,v=!0,v),oe=()=>{z(U,v=!1,v),z(ye,D=0,D),setTimeout(()=>{z(U,v=!0,v)},100)};function le(){E=ce(this.value),Pe.set(E)}function Ae(){E=ce(this.value),Pe.set(E)}function Z(){D=ce(this.value),ye.set(D)}const pe=()=>z(U,v=!1,v),Ce=()=>z(U,v=!0,v);function De(){R=this.value,n(1,R)}const ve=g=>{g.code==="Enter"&&rt(R)},je=()=>S.disconnect(),se=()=>rt(R);return e.$$.update=()=>{e.$$.dirty[0]&1&&n(2,o=Bt(i))},[i,R,o,l,a,d,w,v,D,E,M,me,L,ge,G,ke,fe,we,be,f,m,C,X,ne,oe,le,Ae,Z,pe,Ce,De,ve,je,se]}class Pn extends Qe{constructor(t){super();Ve(this,t,Kn,Nn,Ye,{},null,[-1,-1])}}function Ut(e,t,n){const o=e.slice();return o[26]=t[n][0],o[27]=t[n][1].white,o[28]=t[n][1].pressedColor,o[29]=t[n][1].ghost,o}function Qt(e){let t,n,o,l,s;function a(...i){return e[14](e[26],...i)}function u(){return e[15](e[26])}function p(){return e[16](e[26])}function r(){return e[17](e[26])}return{c(){t=h("div"),_(t,"class",n="key "+(e[27]?"white":"black")+" svelte-yqi7mq"),_(t,"style",o=`--color-hue: ${e[28]}`),qe(t,"pressed",e[28]!==null),qe(t,"ghost",e[29]&&e[28]===null)},m(i,d){K(i,t,d),l||(s=[y(t,"pointerdown",a),y(t,"pointerenter",u),y(t,"pointerleave",p),y(t,"pointerup",r)],l=!0)},p(i,d){e=i,d[0]&4&&n!==(n="key "+(e[27]?"white":"black")+" svelte-yqi7mq")&&_(t,"class",n),d[0]&4&&o!==(o=`--color-hue: ${e[28]}`)&&_(t,"style",o),d[0]&4&&qe(t,"pressed",e[28]!==null),d[0]&4&&qe(t,"ghost",e[29]&&e[28]===null)},d(i){i&&P(t),l=!1,$e(s)}}}function Sn(e){let t,n,o,l,s,a=Object.entries(e[2]),u=[];for(let p=0;p<a.length;p+=1)u[p]=Qt(Ut(e,a,p));return{c(){t=h("div"),n=h("div");for(let p=0;p<u.length;p+=1)u[p].c();_(n,"class","piano svelte-yqi7mq"),_(n,"style",o=`--white-keys: ${e[0]}`),_(t,"class","piano-container svelte-yqi7mq")},m(p,r){K(p,t,r),c(t,n);for(let i=0;i<u.length;i+=1)u[i].m(n,null);e[18](t),l||(s=[y(window,"resize",e[10]),y(window,"load",e[11]),y(window,"keyup",e[8]),y(window,"keydown",e[7]),y(window,"pointerdown",e[12]),y(window,"pointerup",e[13]),y(n,"touchend",on(e[9]))],l=!0)},p(p,r){if(r[0]&54){a=Object.entries(p[2]);let i;for(i=0;i<a.length;i+=1){const d=Ut(p,a,i);u[i]?u[i].p(d,r):(u[i]=Qt(d),u[i].c(),u[i].m(n,null))}for(;i<u.length;i+=1)u[i].d(1);u.length=a.length}r[0]&1&&o!==(o=`--white-keys: ${p[0]}`)&&_(n,"style",o)},i:A,o:A,d(p){p&&P(t),Ze(u,p),e[18](null),l=!1,$e(s)}}}function Vt(e,t){t.get(e)&&(t.get(e).stop(),t.delete(e))}function An(e,t,n){let o,l,s;I(e,Se,f=>n(19,o=f)),I(e,He,f=>n(20,l=f)),I(e,he,f=>n(21,s=f));let a=!1,u,p,r,i=new Map;ut.subscribe(f=>{const m=rn(f[0],f[1]);n(2,u=m.noteMap),n(0,p=m.whiteKeys)});function d(f){var C;const m=ue.get((C=f.socketID)!=null?C:"0");u[f.note]&&n(2,u[f.note].pressedColor=m.colorHue,u),!!m.instrument&&(Vt(f.note,m.audioNodeMap),m.audioNodeMap.set(f.note,m.instrument.play(f.note,void 0,{gain:f.volume})))}function b(f){var C;const m=ue.get((C=f.socketID)!=null?C:"0");u[f.note]&&n(2,u[f.note].pressedColor=null,u),f.sustain||Vt(f.note,m.audioNodeMap)}_n(d,b);function w(f){const m=et(f)+s;return tt(f)+m}function v(f,m){const C=w(f);i.get(C)||(u[f]&&n(2,u[f].ghost=!0,u),i.set(C,!0),fn(C,l*m))}function D(f){const m=w(f);u[f]&&n(2,u[f].ghost=!1,u),!!i.get(m)&&(i.delete(m),ct(m,o))}cn(v,D),Se.subscribe(f=>{if(!f)for(const m of Re.audioNodeMap.keys())i.get(m)||ct(m,!1)}),he.subscribe(()=>{for(const f of i.keys())ct(f,o)});function E(f=p){if(!r)return;const m=r.clientHeight/6,C=r.offsetWidth/f;r.style.setProperty("--white-key-width",`${Math.min(C,m)}px`)}function M(f){const m=Ot[f.code],C=f.target;m&&C.tagName!=="INPUT"&&(f.preventDefault(),v(m,.5))}function me(f){const m=Ot[f.code];m&&D(m)}function L(f){ln.call(this,e,f)}const R=()=>E(),H=()=>E(),_e=()=>n(1,a=!0),ge=()=>n(1,a=!1),G=(f,m)=>{m.currentTarget.releasePointerCapture(m.pointerId),v(f,.5)},ke=f=>{a&&v(f,.5)},fe=f=>D(f),we=f=>D(f);function be(f){sn[f?"unshift":"push"](()=>{r=f,n(3,r)})}return e.$$.update=()=>{e.$$.dirty[0]&1&&E(p)},[p,a,u,r,v,D,E,M,me,L,R,H,_e,ge,G,ke,fe,we,be]}class Dn extends Qe{constructor(t){super();Ve(this,t,An,Sn,Ye,{},null,[-1,-1])}}function jn(e){let t,n,o,l,s;return n=new Pn({}),l=new Dn({}),{c(){t=h("main"),Dt(n.$$.fragment),o=k(),Dt(l.$$.fragment),_(t,"class","svelte-ieeeet")},m(a,u){K(a,t,u),jt(n,t,null),c(t,o),jt(l,t,null),s=!0},p:A,i(a){s||(Et(n.$$.fragment,a),Et(l.$$.fragment,a),s=!0)},o(a){Mt(n.$$.fragment,a),Mt(l.$$.fragment,a),s=!1},d(a){a&&P(t),Ft(n),Ft(l)}}}class En extends Qe{constructor(t){super();Ve(this,t,null,jn,Ye,{})}}new En({target:document.body});

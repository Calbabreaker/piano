import{g as x,w as j,M as ln,l as sn,a as an,S as Xe,i as Ze,s as $e,e as d,t as se,b as K,c as i,n as z,d as P,h as Le,f as k,j as h,k as rn,m as xe,o as L,p as Bt,q as v,r as cn,u as ie,v as et,x as un,y as tt,z as nt,A as B,B as _n,C as R,D as pn,E as ot,F as Re,G as fn,H as dn,I as hn,J as qt,K as Lt,L as Rt,N as Ht,O as Gt}from"./vendor.90408fa6.js";const mn=function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const l of document.querySelectorAll('link[rel="modulepreload"]'))o(l);new MutationObserver(l=>{for(const s of l)if(s.type==="childList")for(const a of s.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&o(a)}).observe(document,{childList:!0,subtree:!0});function n(l){const s={};return l.integrity&&(s.integrity=l.integrity),l.referrerpolicy&&(s.referrerPolicy=l.referrerpolicy),l.crossorigin==="use-credentials"?s.credentials="include":l.crossorigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function o(l){if(l.ep)return;l.ep=!0;const s=n(l);fetch(l.href,s)}};mn();const jt=["accordion","acoustic_bass","acoustic_grand_piano","acoustic_guitar_nylon","acoustic_guitar_steel","agogo","alto_sax","applause","bagpipe","banjo","baritone_sax","bassoon","bird_tweet","blown_bottle","brass_section","breath_noise","bright_acoustic_piano","celesta","cello","choir_aahs","church_organ","clarinet","clavinet","contrabass","distortion_guitar","drawbar_organ","dulcimer","electric_bass_finger","electric_bass_pick","electric_grand_piano","electric_guitar_clean","electric_guitar_jazz","electric_guitar_muted","electric_piano_1","electric_piano_2","english_horn","fiddle","flute","french_horn","fretless_bass","fx_1_rain","fx_2_soundtrack","fx_3_crystal","fx_4_atmosphere","fx_5_brightness","fx_6_goblins","fx_7_echoes","fx_8_scifi","glockenspiel","guitar_fret_noise","guitar_harmonics","gunshot","harmonica","harpsichord","helicopter","honkytonk_piano","kalimba","koto","lead_1_square","lead_2_sawtooth","lead_3_calliope","lead_4_chiff","lead_5_charang","lead_6_voice","lead_7_fifths","lead_8_bass__lead","marimba","melodic_tom","music_box","muted_trumpet","oboe","ocarina","orchestra_hit","orchestral_harp","overdriven_guitar","pad_1_new_age","pad_2_warm","pad_3_polysynth","pad_4_choir","pad_5_bowed","pad_6_metallic","pad_7_halo","pad_8_sweep","pan_flute","percussive_organ","piccolo","pizzicato_strings","recorder","reed_organ","reverse_cymbal","rock_organ","seashore","shakuhachi","shamisen","shanai","sitar","slap_bass_1","slap_bass_2","soprano_sax","steel_drums","string_ensemble_1","string_ensemble_2","synth_bass_1","synth_bass_2","synth_brass_1","synth_brass_2","synth_choir","synth_drum","synth_strings_1","synth_strings_2","taiko_drum","tango_accordion","telephone_ring","tenor_sax","timpani","tinkle_bell","tremolo_strings","trombone","trumpet","tuba","tubular_bells","vibraphone","viola","violin","voice_oohs","whistle","woodblock","xylophone"],Ce=["C","C#","D","D#","E","F","F#","G","G#","A","A#","B"],Jt={Backquote:"A#2",Tab:"B2",KeyQ:"C3",Digit2:"C#3",KeyW:"D3",Digit3:"D#3",KeyE:"E3",KeyR:"F3",Digit5:"F#3",KeyT:"G3",Digit6:"G#3",KeyY:"A3",Digit7:"A#3",KeyU:"B3",KeyI:"C4",Digit9:"C#4",KeyO:"D4",Digit0:"D#4",KeyP:"E4",BracketLeft:"F4",Equal:"F#4",BracketRight:"G4",Backspace:"G#4",Backslash:"A4",CapsLock:"A#4",ShiftLeft:"B4",KeyZ:"C5",KeyS:"C#5",KeyX:"D5",KeyD:"D#5",KeyC:"E5",KeyV:"F5",KeyG:"F#5",KeyB:"G5",KeyH:"G#5",KeyN:"A5",KeyJ:"A#5",KeyM:"B5",Comma:"C6",KeyL:"C#6",Period:"D6",Semicolon:"D#6",Slash:"E6",ShiftRight:"F6",Enter:"F#6"};function lt(e){return parseInt(e.charAt(e.length-1))}function st(e){return e.substring(0,e.length-1)}function it(e){const t=Math.floor(e/12)-1;return Ce[e%12]+t}function bn(e,t){const n=lt(t),o=lt(e),l=Ce.indexOf(st(e)),s=Ce.indexOf(st(t)),a={};let _=0;for(let p=o;p<=n;p++){let c=p===o?l:0;for(;c<Ce.length&&!(p===n&&c>s);){const f=Ce[c],g=f.length===1;a[f+p]={white:g,pressedColor:null,ghost:!1},g&&_++,c++}}return{noteMap:a,whiteKeys:_}}const J=j(!1),me=j(0),He=j(0),at=j(),Ne=j(1);async function gn(e,t){let n=[],o=null;function l(c){o=new ln(c),o.tracks=o.tracks.filter(f=>f.notes.length!==0);let r=0;o.tracks.forEach(f=>{const g=f.notes[f.notes.length-1],C=g.time+g.duration;C>r&&(r=C)}),He.set(r)}at.subscribe(c=>{if(J.set(!1),He.set(0),me.set(0),!c){o=null;return}const r=new FileReader;r.onload=()=>l(r.result),r.readAsArrayBuffer(c)});function s(c){const r=x(me)+c;me.set(r),o.tracks.forEach((f,g)=>{const C=f.notes[n[g]];if(!C)return;r-C.time>0&&(e(C.name,C.velocity),setTimeout(()=>t(C.name),C.duration*1e3/x(Ne)),n[g]++)}),r>x(He)&&J.set(!1)}J.subscribe(c=>{if(!c)return;if(!o)return J.set(!1),alert("No MIDI file selected!");o.tracks.forEach((g,C)=>{let w=0,D=g.notes.length-1;for(;w!=D;){const S=Math.ceil((w+D)/2);g.notes[S].time>x(me)?D=S-1:w=S}n[C]=w});let r=performance.now();const f=()=>{if(!x(J))return;const g=performance.now(),C=g-r;r=g,s(C/1e3*x(Ne)),requestAnimationFrame(f)};f()});function a(c){const[r,f,g]=c.data;r>143&&r<160?g==0?t(it(f)):e(it(f),g/127):r>127&&r<144&&t(it(f))}let _=await navigator.requestMIDIAccess();function p(){_.inputs.forEach(c=>{c.onmidimessage=a})}p(),_.onstatechange=()=>{p()}}const Wt=window.AudioContext||window.webkitAudioContext;Wt||alert("Your browser does not seem to support the Web Audio API!");const yn=new Wt,rt={};function Ut(e){return rt[e]||(rt[e]=sn.exports.instrument(yn,e)),rt[e]}const Qt=j(),Ge=j("acoustic_grand_piano"),ue=j(null),ae=new Map,je={audioNodeMap:new Map,colorHue:"220"};ae.set("0",je);let A,ct,ut;async function _t(e,t){let n=await Ut(e),o=ae.get(t);o&&(o.instrument=n)}function Vt({socketID:e,colorHue:t,instrumentName:n}){ae.set(e,{audioNodeMap:e===A.id?je.audioNodeMap:new Map,colorHue:t}),x(ue)!==null&&ue.set(x(ue).set(e,t)),n&&_t(n,e)}function kn(e,t){ct=e,ut=t}function pt(e){const t=new Promise((n,o)=>{A=an("https://calbabreaker-piano-backend.herokuapp.com",{query:{roomName:e,instrumentName:x(Ge)},path:{}.VITE_BACKEND_PATH}),A.on("connect_error",()=>o("Failed to connect to server!")),A.on("connect_timeout",()=>o("Timed out while connecting to server!")),A.on("connect",()=>{ae.delete("0"),ue.set(new Map),n(),history.replaceState({},`Play Piano! - ${e}`,`?room=${e}`)}),A.on("disconnect",()=>{ue.set(null),ae.clear(),ae.set("0",je),A=null,history.replaceState({},"Play Piano!",location.pathname)}),A.on("play_note",s=>{ct(s)}),A.on("stop_note",s=>{ut(s)}),A.on("instrument_change",s=>{const{instrumentName:a,socketID:_}=s;_t(a,_)}),A.on("client_connect",s=>{Vt(s)}),A.on("client_list_recieve",s=>{const a=s;for(let _ of a)Vt(_)}),A.on("client_disconnect",s=>{const a=x(ue);a.delete(s),ue.set(a),ae.delete(s)})});Qt.set(t)}function vn(e,t){const n={note:e,volume:t};A?A.emit("play_note",n):ct(n)}function ft(e,t){const n={note:e,sustain:t};A?A.emit("stop_note",n):ut(n)}Ge.subscribe(e=>{A?A.emit("instrument_change",{instrumentName:e}):_t(e,"0")});const{window:wn}=_n;function Yt(e,t,n){const o=e.slice();return o[37]=t[n][0],o[38]=t[n][1],o}function Xt(e,t,n){const o=e.slice();return o[42]=t[n],o}function Zt(e){let t,n=e[42]+"",o,l;return{c(){t=d("option"),o=se(n),t.__value=l=e[42],t.value=t.__value},m(s,a){K(s,t,a),i(t,o)},p:z,d(s){s&&P(t)}}}function Cn(e){return{c:z,m:z,d:z}}function Nn(e){return{c:z,m:z,d:z}}function Kn(e){let t;return{c(){t=se("loading...")},m(n,o){K(n,t,o)},d(n){n&&P(t)}}}function Pn(e){let t,n,o;return{c(){t=d("button"),t.textContent="Play"},m(l,s){K(l,t,s),n||(o=v(t,"click",e[23]),n=!0)},p:z,d(l){l&&P(t),n=!1,o()}}}function An(e){let t,n,o;return{c(){t=d("button"),t.textContent="Pause"},m(l,s){K(l,t,s),n||(o=v(t,"click",e[22]),n=!0)},p:z,d(l){l&&P(t),n=!1,o()}}}function zn(e){let t,n,o;return{c(){t=d("button"),t.textContent="Join"},m(l,s){K(l,t,s),n||(o=v(t,"click",e[33]),n=!0)},p:z,d(l){l&&P(t),n=!1,o()}}}function Dn(e){let t,n,o;return{c(){t=d("button"),t.textContent="Leave"},m(l,s){K(l,t,s),n||(o=v(t,"click",e[32]),n=!0)},p:z,d(l){l&&P(t),n=!1,o()}}}function Sn(e){let t,n=e[41]+"",o;return{c(){t=d("span"),o=se(n),xe(t,"color","#fe3c3c")},m(l,s){K(l,t,s),i(t,o)},p(l,s){s[0]&4096&&n!==(n=l[41]+"")&&et(o,n)},d(l){l&&P(t)}}}function En(e){let t,n=e[11]!==null&&$t(e);return{c(){n&&n.c(),t=ot()},m(o,l){n&&n.m(o,l),K(o,t,l)},p(o,l){o[11]!==null?n?n.p(o,l):(n=$t(o),n.c(),n.m(t.parentNode,t)):n&&(n.d(1),n=null)},d(o){n&&n.d(o),o&&P(t)}}}function $t(e){let t,n,o,l,s,a,_=Array.from(e[11].entries()),p=[];for(let c=0;c<_.length;c+=1)p[c]=en(Yt(e,_,c));return{c(){t=d("span"),t.textContent="Connected!",n=d("br"),o=k(),l=d("span"),l.textContent="People:",s=k();for(let c=0;c<p.length;c+=1)p[c].c();a=ot()},m(c,r){K(c,t,r),K(c,n,r),K(c,o,r),K(c,l,r),K(c,s,r);for(let f=0;f<p.length;f+=1)p[f].m(c,r);K(c,a,r)},p(c,r){if(r[0]&2048){_=Array.from(c[11].entries());let f;for(f=0;f<_.length;f+=1){const g=Yt(c,_,f);p[f]?p[f].p(g,r):(p[f]=en(g),p[f].c(),p[f].m(a.parentNode,a))}for(;f<p.length;f+=1)p[f].d(1);p.length=_.length}},d(c){c&&P(t),c&&P(n),c&&P(o),c&&P(l),c&&P(s),tt(p,c),c&&P(a)}}}function xt(e){let t;return{c(){t=d("span"),t.textContent="(you)",xe(t,"margin-right","0.5rem")},m(n,o){K(n,t,o)},d(n){n&&P(t)}}}function en(e){let t,n,o,l,s=e[37]===A.id&&xt();return{c(){t=d("div"),o=k(),s&&s.c(),l=ot(),h(t,"class","icon svelte-1cmwzer"),h(t,"style",n=`--color-hue: ${e[38]}`)},m(a,_){K(a,t,_),K(a,o,_),s&&s.m(a,_),K(a,l,_)},p(a,_){_[0]&2048&&n!==(n=`--color-hue: ${a[38]}`)&&h(t,"style",n),a[37]===A.id?s||(s=xt(),s.c(),s.m(l.parentNode,l)):s&&(s.d(1),s=null)},d(a){a&&P(t),a&&P(o),s&&s.d(a),a&&P(l)}}}function Mn(e){let t;return{c(){t=d("span"),t.textContent="Connecting..."},m(n,o){K(n,t,o)},p:z,d(n){n&&P(t)}}}function Fn(e){let t,n,o,l,s,a,_,p,c,r,f,g,C,w,D,S,re,T,pe,M,ke,fe,de,he,be,H,ge,ce,u,b,F,ve,Pe,W,ee,Y,te,ne,oe,Ae,ze,De,Se,m,y,Ee,ht,we,mt,bt,gt,We,Me,yt,kt,vt,U,wt,le,Ct,Nt,Kt,I,Pt,Fe=e[8].toFixed(1)+"",Ue,At,Te=e[10].toFixed(1)+"",Qe,zt,Dt,St,Q,Oe,Et,X,Mt,Ve,Ie,Ye,Ft,ye=jt,q=[];for(let E=0;E<ye.length;E+=1)q[E]=Zt(Xt(e,ye,E));let V={ctx:e,current:null,token:null,hasCatch:!1,pending:Kn,then:Nn,catch:Cn};Le(ce=e[2],V);function Tt(E,N){return E[7]?An:Pn}let Be=Tt(e),Z=Be(e);function Ot(E,N){return E[11]!==null?Dn:zn}let qe=Ot(e),$=qe(e),G={ctx:e,current:null,token:null,hasCatch:!0,pending:Mn,then:En,catch:Sn,error:41};return Le(Ie=e[12],G),{c(){t=d("div"),n=d("div"),o=d("div"),l=d("span"),l.textContent="Sustain (space):",s=k(),a=d("input"),_=k(),p=d("br"),c=k(),r=d("span"),r.textContent="Octave Shift (- ctrl, + alt):",f=k(),g=d("input"),C=k(),w=d("br"),D=k(),S=d("span"),S.textContent="Volume:",re=k(),T=d("input"),pe=k(),M=d("input"),ke=k(),fe=d("br"),de=k(),he=d("span"),he.textContent="Instrument:",be=k(),H=d("select");for(let E=0;E<q.length;E+=1)q[E].c();ge=k(),V.block.c(),u=k(),b=d("br"),F=k(),ve=d("span"),ve.textContent="Size:",Pe=k(),W=d("select"),ee=d("option"),ee.textContent="Full size (88 keys)",Y=d("option"),Y.textContent="Half size (61 keys)",te=d("option"),te.textContent="Quater Size (37 keys)",ne=d("option"),ne.textContent="2 Octaves (24 keys)",oe=d("option"),oe.textContent="1 Octave (12 keys)",Ae=k(),ze=d("br"),De=k(),Se=d("br"),m=k(),y=d("div"),Ee=d("p"),Ee.textContent="Play a midi:",ht=k(),we=d("input"),mt=k(),bt=d("br"),gt=k(),Z.c(),We=k(),Me=d("button"),Me.textContent="Restart",yt=k(),kt=d("br"),vt=se(`

            Speed: `),U=d("input"),wt=k(),le=d("input"),Ct=se("times"),Nt=d("br"),Kt=k(),I=d("input"),Pt=k(),Ue=se(Fe),At=se("/"),Qe=se(Te),zt=se(` seconds
            `),Dt=d("br"),St=k(),Q=d("div"),Oe=d("p"),Oe.textContent="Join a room:",Et=k(),X=d("input"),Mt=k(),$.c(),Ve=k(),G.block.c(),h(a,"type","checkbox"),h(a,"class","svelte-1cmwzer"),h(g,"type","number"),h(g,"min","-3"),h(g,"max","3"),h(g,"class","svelte-1cmwzer"),h(T,"type","range"),h(T,"min","0"),h(T,"max","50"),h(T,"step","0.1"),h(T,"class","svelte-1cmwzer"),h(M,"type","number"),h(M,"class","svelte-1cmwzer"),e[0]===void 0&&rn(()=>e[19].call(H)),h(ee,"data-range","A0,C8"),ee.__value="Full size (88 keys)",ee.value=ee.__value,h(Y,"data-range","C2,C7"),Y.selected=!0,Y.__value="Half size (61 keys)",Y.value=Y.__value,h(te,"data-range","C3,C6"),te.__value="Quater Size (37 keys)",te.value=te.__value,h(ne,"data-range","C4,B5"),ne.__value="2 Octaves (24 keys)",ne.value=ne.__value,h(oe,"data-range","C4,B4"),oe.__value="1 Octave (12 keys)",oe.value=oe.__value,h(o,"class","svelte-1cmwzer"),h(Ee,"class","svelte-1cmwzer"),h(we,"type","file"),h(we,"class","svelte-1cmwzer"),h(U,"type","range"),h(U,"min","0.01"),h(U,"max","4"),h(U,"step","0.01"),h(U,"class","svelte-1cmwzer"),h(le,"type","number"),h(le,"min","0.01"),h(le,"class","svelte-1cmwzer"),h(I,"type","range"),h(I,"min","0"),h(I,"max",e[10]),h(I,"step","0.1"),xe(I,"width","18rem"),h(I,"class","svelte-1cmwzer"),h(y,"class","svelte-1cmwzer"),h(n,"class","row svelte-1cmwzer"),h(Oe,"class","svelte-1cmwzer"),h(X,"type","text"),h(X,"placeholder","Room name"),h(X,"class","svelte-1cmwzer"),h(t,"class","control-panel svelte-1cmwzer")},m(E,N){K(E,t,N),i(t,n),i(n,o),i(o,l),i(o,s),i(o,a),a.checked=e[4],i(o,_),i(o,p),i(o,c),i(o,r),i(o,f),i(o,g),L(g,e[3]),i(o,C),i(o,w),i(o,D),i(o,S),i(o,re),i(o,T),L(T,e[5]),i(o,pe),i(o,M),L(M,e[5]),i(o,ke),i(o,fe),i(o,de),i(o,he),i(o,be),i(o,H);for(let O=0;O<q.length;O+=1)q[O].m(H,null);Bt(H,e[0]),i(o,ge),V.block.m(o,V.anchor=null),V.mount=()=>o,V.anchor=u,i(o,u),i(o,b),i(o,F),i(o,ve),i(o,Pe),i(o,W),i(W,ee),i(W,Y),i(W,te),i(W,ne),i(W,oe),i(o,Ae),i(o,ze),i(o,De),i(o,Se),i(n,m),i(n,y),i(y,Ee),i(y,ht),i(y,we),i(y,mt),i(y,bt),i(y,gt),Z.m(y,null),i(y,We),i(y,Me),i(y,yt),i(y,kt),i(y,vt),i(y,U),L(U,e[9]),i(y,wt),i(y,le),L(le,e[9]),i(y,Ct),i(y,Nt),i(y,Kt),i(y,I),L(I,e[8]),i(y,Pt),i(y,Ue),i(y,At),i(y,Qe),i(y,zt),i(y,Dt),i(t,St),i(t,Q),i(Q,Oe),i(Q,Et),i(Q,X),L(X,e[1]),i(Q,Mt),$.m(Q,null),i(Q,Ve),G.block.m(Q,G.anchor=null),G.mount=()=>Q,G.anchor=null,Ye||(Ft=[v(wn,"keydown",e[14]),v(a,"change",e[15]),v(g,"input",e[16]),v(T,"change",e[17]),v(T,"input",e[17]),v(M,"input",e[18]),v(H,"change",e[19]),v(W,"change",e[20]),cn(e[13].call(null,W)),v(we,"change",e[21]),v(Me,"click",e[24]),v(U,"change",e[25]),v(U,"input",e[25]),v(le,"input",e[26]),v(I,"change",e[27]),v(I,"input",e[27]),v(I,"mousedown",e[28]),v(I,"mouseup",e[29]),v(X,"input",e[30]),v(X,"keydown",e[31])],Ye=!0)},p(E,N){if(e=E,N[0]&16&&(a.checked=e[4]),N[0]&8&&ie(g.value)!==e[3]&&L(g,e[3]),N[0]&32&&L(T,e[5]),N[0]&32&&ie(M.value)!==e[5]&&L(M,e[5]),N&0){ye=jt;let O;for(O=0;O<ye.length;O+=1){const It=Xt(e,ye,O);q[O]?q[O].p(It,N):(q[O]=Zt(It),q[O].c(),q[O].m(H,null))}for(;O<q.length;O+=1)q[O].d(1);q.length=ye.length}N[0]&1&&Bt(H,e[0]),V.ctx=e,N[0]&4&&ce!==(ce=e[2])&&Le(ce,V),Be===(Be=Tt(e))&&Z?Z.p(e,N):(Z.d(1),Z=Be(e),Z&&(Z.c(),Z.m(y,We))),N[0]&512&&L(U,e[9]),N[0]&512&&ie(le.value)!==e[9]&&L(le,e[9]),N[0]&1024&&h(I,"max",e[10]),N[0]&256&&L(I,e[8]),N[0]&256&&Fe!==(Fe=e[8].toFixed(1)+"")&&et(Ue,Fe),N[0]&1024&&Te!==(Te=e[10].toFixed(1)+"")&&et(Qe,Te),N[0]&2&&X.value!==e[1]&&L(X,e[1]),qe===(qe=Ot(e))&&$?$.p(e,N):($.d(1),$=qe(e),$&&($.c(),$.m(Q,Ve))),G.ctx=e,N[0]&4096&&Ie!==(Ie=e[12])&&Le(Ie,G)||un(G,e,N)},i:z,o:z,d(E){E&&P(t),tt(q,E),V.block.d(),V.token=null,V=null,Z.d(),$.d(),G.block.d(),G.token=null,G=null,Ye=!1,nt(Ft)}}}const _e=j(0),Ke=j(!1),Je=j(25),dt=j(["C0","C0"]);function Tn(e,t,n){let o,l,s=z,a,_=z,p,c=z,r,f,g=z,C,w,D,S,re,T,pe;B(e,_e,m=>n(3,l=m)),B(e,Ke,m=>n(4,a=m)),B(e,dt,m=>n(34,p=m)),B(e,Ge,m=>n(0,r=m)),B(e,Je,m=>n(5,f=m)),B(e,at,m=>n(6,C=m)),B(e,J,m=>n(7,w=m)),B(e,me,m=>n(8,D=m)),B(e,Ne,m=>n(9,S=m)),B(e,He,m=>n(10,re=m)),B(e,ue,m=>n(11,T=m)),B(e,Qt,m=>n(12,pe=m)),e.$$.on_destroy.push(()=>s()),e.$$.on_destroy.push(()=>_()),e.$$.on_destroy.push(()=>c()),e.$$.on_destroy.push(()=>g());let M="";const fe=new URLSearchParams(window.location.search).get("room");fe&&(M=fe,pt(M));function de(m){const y=m.children[m.selectedIndex];R(dt,p=y.dataset.range.split(","),p)}function he(m){m.code==="Space"&&R(Ke,a=!a,a),m.code==="ControlLeft"?R(_e,l-=1,l):m.code==="AltLeft"&&R(_e,l+=1,l),l<-3?R(_e,l=3,l):l>3&&R(_e,l=-3,l)}function be(){a=this.checked,Ke.set(a)}function H(){l=ie(this.value),_e.set(l)}function ge(){f=ie(this.value),Je.set(f)}function ce(){f=ie(this.value),Je.set(f)}function u(){r=pn(this),Ge.set(r)}const b=m=>de(m.currentTarget),F=m=>{var y;return R(at,C=(y=m.currentTarget.files)==null?void 0:y[0],C)},ve=()=>R(J,w=!1,w),Pe=()=>R(J,w=!0,w),W=()=>{R(J,w=!1,w),R(me,D=0,D),setTimeout(()=>{R(J,w=!0,w)},100)};function ee(){S=ie(this.value),Ne.set(S)}function Y(){S=ie(this.value),Ne.set(S)}function te(){D=ie(this.value),me.set(D)}const ne=()=>R(J,w=!1,w),oe=()=>R(J,w=!0,w);function Ae(){M=this.value,n(1,M)}const ze=m=>{m.code==="Enter"&&pt(M)},De=()=>A.disconnect(),Se=()=>pt(M);return e.$$.update=()=>{e.$$.dirty[0]&1&&n(2,o=Ut(r))},[r,M,o,l,a,f,C,w,D,S,re,T,pe,de,he,be,H,ge,ce,u,b,F,ve,Pe,W,ee,Y,te,ne,oe,Ae,ze,De,Se]}class On extends Xe{constructor(t){super();Ze(this,t,Tn,Fn,$e,{},null,[-1,-1])}}function tn(e,t,n){const o=e.slice();return o[26]=t[n][0],o[27]=t[n][1].white,o[28]=t[n][1].pressedColor,o[29]=t[n][1].ghost,o}function nn(e){let t,n,o,l,s;function a(...r){return e[14](e[26],...r)}function _(){return e[15](e[26])}function p(){return e[16](e[26])}function c(){return e[17](e[26])}return{c(){t=d("div"),h(t,"class",n="key "+(e[27]?"white":"black")+" svelte-yqi7mq"),h(t,"style",o=`--color-hue: ${e[28]}`),Re(t,"pressed",e[28]!==null),Re(t,"ghost",e[29]&&e[28]===null)},m(r,f){K(r,t,f),l||(s=[v(t,"pointerdown",a),v(t,"pointerenter",_),v(t,"pointerleave",p),v(t,"pointerup",c)],l=!0)},p(r,f){e=r,f[0]&4&&n!==(n="key "+(e[27]?"white":"black")+" svelte-yqi7mq")&&h(t,"class",n),f[0]&4&&o!==(o=`--color-hue: ${e[28]}`)&&h(t,"style",o),f[0]&4&&Re(t,"pressed",e[28]!==null),f[0]&4&&Re(t,"ghost",e[29]&&e[28]===null)},d(r){r&&P(t),l=!1,nt(s)}}}function In(e){let t,n,o,l,s,a=Object.entries(e[2]),_=[];for(let p=0;p<a.length;p+=1)_[p]=nn(tn(e,a,p));return{c(){t=d("div"),n=d("div");for(let p=0;p<_.length;p+=1)_[p].c();h(n,"class","piano svelte-yqi7mq"),h(n,"style",o=`--white-keys: ${e[0]}`),h(t,"class","piano-container svelte-yqi7mq")},m(p,c){K(p,t,c),i(t,n);for(let r=0;r<_.length;r+=1)_[r].m(n,null);e[18](t),l||(s=[v(window,"resize",e[10]),v(window,"load",e[11]),v(window,"keyup",e[8]),v(window,"keydown",e[7]),v(window,"pointerdown",e[12]),v(window,"pointerup",e[13]),v(n,"touchend",fn(e[9]))],l=!0)},p(p,c){if(c[0]&54){a=Object.entries(p[2]);let r;for(r=0;r<a.length;r+=1){const f=tn(p,a,r);_[r]?_[r].p(f,c):(_[r]=nn(f),_[r].c(),_[r].m(n,null))}for(;r<_.length;r+=1)_[r].d(1);_.length=a.length}c[0]&1&&o!==(o=`--white-keys: ${p[0]}`)&&h(n,"style",o)},i:z,o:z,d(p){p&&P(t),tt(_,p),e[18](null),l=!1,nt(s)}}}function on(e,t){t.get(e)&&(t.get(e).stop(),t.delete(e))}function Bn(e,t,n){let o,l,s;B(e,Ke,u=>n(19,o=u)),B(e,Je,u=>n(20,l=u)),B(e,_e,u=>n(21,s=u));let a=!1,_,p,c,r=new Map;dt.subscribe(u=>{const b=bn(u[0],u[1]);n(2,_=b.noteMap),n(0,p=b.whiteKeys)});function f(u){var F;const b=ae.get((F=u.socketID)!=null?F:"0");_[u.note]&&n(2,_[u.note].pressedColor=b.colorHue,_),!!b.instrument&&(on(u.note,b.audioNodeMap),b.audioNodeMap.set(u.note,b.instrument.play(u.note,void 0,{gain:u.volume})))}function g(u){var F;const b=ae.get((F=u.socketID)!=null?F:"0");_[u.note]&&n(2,_[u.note].pressedColor=null,_),u.sustain||on(u.note,b.audioNodeMap)}kn(f,g);function C(u){const b=lt(u)+s;return st(u)+b}function w(u,b){const F=C(u);r.get(F)||(_[u]&&n(2,_[u].ghost=!0,_),r.set(F,!0),vn(F,l*b))}function D(u){const b=C(u);_[u]&&n(2,_[u].ghost=!1,_),!!r.get(b)&&(r.delete(b),ft(b,o))}gn(w,D),Ke.subscribe(u=>{if(!u)for(const b of je.audioNodeMap.keys())r.get(b)||ft(b,!1)}),_e.subscribe(()=>{for(const u of r.keys())ft(u,o)});function S(u=p){if(!c)return;const b=c.clientHeight/6,F=c.offsetWidth/u;c.style.setProperty("--white-key-width",`${Math.min(F,b)}px`)}function re(u){const b=Jt[u.code],F=u.target;b&&F.tagName!=="INPUT"&&(u.preventDefault(),w(b,.5))}function T(u){const b=Jt[u.code];b&&D(b)}function pe(u){dn.call(this,e,u)}const M=()=>S(),ke=()=>S(),fe=()=>n(1,a=!0),de=()=>n(1,a=!1),he=(u,b)=>{b.currentTarget.releasePointerCapture(b.pointerId),w(u,.5)},be=u=>{a&&w(u,.5)},H=u=>D(u),ge=u=>D(u);function ce(u){hn[u?"unshift":"push"](()=>{c=u,n(3,c)})}return e.$$.update=()=>{e.$$.dirty[0]&1&&S(p)},[p,a,_,c,w,D,S,re,T,pe,M,ke,fe,de,he,be,H,ge,ce]}class qn extends Xe{constructor(t){super();Ze(this,t,Bn,In,$e,{},null,[-1,-1])}}function Ln(e){let t,n,o,l,s;return n=new On({}),l=new qn({}),{c(){t=d("main"),qt(n.$$.fragment),o=k(),qt(l.$$.fragment),h(t,"class","svelte-ieeeet")},m(a,_){K(a,t,_),Lt(n,t,null),i(t,o),Lt(l,t,null),s=!0},p:z,i(a){s||(Rt(n.$$.fragment,a),Rt(l.$$.fragment,a),s=!0)},o(a){Ht(n.$$.fragment,a),Ht(l.$$.fragment,a),s=!1},d(a){a&&P(t),Gt(n),Gt(l)}}}class Rn extends Xe{constructor(t){super();Ze(this,t,null,Ln,$e,{})}}new Rn({target:document.body});

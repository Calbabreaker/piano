var pi=Object.defineProperty;var mi=(t,e,n)=>e in t?pi(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n;var zt=(t,e,n)=>(mi(t,typeof e!="symbol"?e+"":e,n),n);(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))r(i);new MutationObserver(i=>{for(const o of i)if(o.type==="childList")for(const s of o.addedNodes)s.tagName==="LINK"&&s.rel==="modulepreload"&&r(s)}).observe(document,{childList:!0,subtree:!0});function n(i){const o={};return i.integrity&&(o.integrity=i.integrity),i.referrerPolicy&&(o.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?o.credentials="include":i.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function r(i){if(i.ep)return;i.ep=!0;const o=n(i);fetch(i.href,o)}})();function U(){}function yi(t){return!!t&&(typeof t=="object"||typeof t=="function")&&typeof t.then=="function"}function Nr(t){return t()}function Zn(){return Object.create(null)}function Ne(t){t.forEach(Nr)}function kn(t){return typeof t=="function"}function Ut(t,e){return t!=t?e==e:t!==e||t&&typeof t=="object"||typeof t=="function"}function gi(t){return Object.keys(t).length===0}function Br(t,...e){if(t==null){for(const r of e)r(void 0);return U}const n=t.subscribe(...e);return n.unsubscribe?()=>n.unsubscribe():n}function me(t){let e;return Br(t,n=>e=n)(),e}function G(t,e,n){t.$$.on_destroy.push(Br(e,n))}function Q(t,e,n){return t.set(n),e}function bi(t){return t&&kn(t.destroy)?t.destroy:U}function g(t,e){t.appendChild(e)}function V(t,e,n){t.insertBefore(e,n||null)}function L(t){t.parentNode&&t.parentNode.removeChild(t)}function wn(t,e){for(let n=0;n<t.length;n+=1)t[n]&&t[n].d(e)}function k(t){return document.createElement(t)}function re(t){return document.createTextNode(t)}function P(){return re(" ")}function Pr(){return re("")}function C(t,e,n,r){return t.addEventListener(e,n,r),()=>t.removeEventListener(e,n,r)}function vi(t){return function(e){return e.preventDefault(),t.call(this,e)}}function v(t,e,n){n==null?t.removeAttribute(e):t.getAttribute(e)!==n&&t.setAttribute(e,n)}function Te(t){return t===""?null:+t}function _i(t){return Array.from(t.childNodes)}function on(t,e){e=""+e,t.data!==e&&(t.data=e)}function K(t,e){t.value=e??""}function Et(t,e,n,r){n==null?t.style.removeProperty(e):t.style.setProperty(e,n,r?"important":"")}function er(t,e,n){for(let r=0;r<t.options.length;r+=1){const i=t.options[r];if(i.__value===e){i.selected=!0;return}}(!n||e!==void 0)&&(t.selectedIndex=-1)}function ki(t){const e=t.querySelector(":checked");return e&&e.__value}function pt(t,e,n){t.classList.toggle(e,!!n)}let it;function xe(t){it=t}function Ur(){if(!it)throw new Error("Function called outside component initialization");return it}function wi(t){Ur().$$.on_mount.push(t)}function Ti(t,e){const n=t.$$.callbacks[e.type];n&&n.slice().forEach(r=>r.call(this,e))}const Ke=[],an=[];let Ge=[];const tr=[],xi=Promise.resolve();let cn=!1;function Si(){cn||(cn=!0,xi.then(Tn))}function Ot(t){Ge.push(t)}const Wt=new Set;let qe=0;function Tn(){if(qe!==0)return;const t=it;do{try{for(;qe<Ke.length;){const e=Ke[qe];qe++,xe(e),Ii(e.$$)}}catch(e){throw Ke.length=0,qe=0,e}for(xe(null),Ke.length=0,qe=0;an.length;)an.pop()();for(let e=0;e<Ge.length;e+=1){const n=Ge[e];Wt.has(n)||(Wt.add(n),n())}Ge.length=0}while(Ke.length);for(;tr.length;)tr.pop()();cn=!1,Wt.clear(),xe(t)}function Ii(t){if(t.fragment!==null){t.update(),Ne(t.before_update);const e=t.dirty;t.dirty=[-1],t.fragment&&t.fragment.p(t.ctx,e),t.after_update.forEach(Ot)}}function Ci(t){const e=[],n=[];Ge.forEach(r=>t.indexOf(r)===-1?e.push(r):n.push(r)),n.forEach(r=>r()),Ge=e}const kt=new Set;let Pe;function Ei(){Pe={r:0,c:[],p:Pe}}function Oi(){Pe.r||Ne(Pe.c),Pe=Pe.p}function At(t,e){t&&t.i&&(kt.delete(t),t.i(e))}function un(t,e,n,r){if(t&&t.o){if(kt.has(t))return;kt.add(t),Pe.c.push(()=>{kt.delete(t),r&&(n&&t.d(1),r())}),t.o(e)}else r&&r()}function nr(t,e){const n=e.token={};function r(i,o,s,a){if(e.token!==n)return;e.resolved=a;let l=e.ctx;s!==void 0&&(l=l.slice(),l[s]=a);const c=i&&(e.current=i)(l);let m=!1;e.block&&(e.blocks?e.blocks.forEach((d,u)=>{u!==o&&d&&(Ei(),un(d,1,1,()=>{e.blocks[u]===d&&(e.blocks[u]=null)}),Oi())}):e.block.d(1),c.c(),At(c,1),c.m(e.mount(),e.anchor),m=!0),e.block=c,e.blocks&&(e.blocks[o]=c),m&&Tn()}if(yi(t)){const i=Ur();if(t.then(o=>{xe(i),r(e.then,1,e.value,o),xe(null)},o=>{if(xe(i),r(e.catch,2,e.error,o),xe(null),!e.hasCatch)throw o}),e.current!==e.pending)return r(e.pending,0),!0}else{if(e.current!==e.then)return r(e.then,1,e.value,t),!0;e.resolved=t}}function Xe(t){return(t==null?void 0:t.length)!==void 0?t:Array.from(t)}function rr(t){t&&t.c()}function ln(t,e,n){const{fragment:r,after_update:i}=t.$$;r&&r.m(e,n),Ot(()=>{const o=t.$$.on_mount.map(Nr).filter(kn);t.$$.on_destroy?t.$$.on_destroy.push(...o):Ne(o),t.$$.on_mount=[]}),i.forEach(Ot)}function fn(t,e){const n=t.$$;n.fragment!==null&&(Ci(n.after_update),Ne(n.on_destroy),n.fragment&&n.fragment.d(e),n.on_destroy=n.fragment=null,n.ctx=[])}function Ai(t,e){t.$$.dirty[0]===-1&&(Ke.push(t),Si(),t.$$.dirty.fill(0)),t.$$.dirty[e/31|0]|=1<<e%31}function xn(t,e,n,r,i,o,s,a=[-1]){const l=it;xe(t);const c=t.$$={fragment:null,ctx:[],props:o,update:U,not_equal:i,bound:Zn(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(e.context||(l?l.$$.context:[])),callbacks:Zn(),dirty:a,skip_bound:!1,root:e.target||l.$$.root};s&&s(c.root);let m=!1;if(c.ctx=n?n(t,e.props||{},(d,u,...f)=>{const h=f.length?f[0]:u;return c.ctx&&i(c.ctx[d],c.ctx[d]=h)&&(!c.skip_bound&&c.bound[d]&&c.bound[d](h),m&&Ai(t,d)),u}):[],c.update(),m=!0,Ne(c.before_update),c.fragment=r?r(c.ctx):!1,e.target){if(e.hydrate){const d=_i(e.target);c.fragment&&c.fragment.l(d),d.forEach(L)}else c.fragment&&c.fragment.c();e.intro&&At(t.$$.fragment),ln(t,e.target,e.anchor),Tn()}xe(l)}class Sn{constructor(){zt(this,"$$");zt(this,"$$set")}$destroy(){fn(this,1),this.$destroy=U}$on(e,n){if(!kn(n))return U;const r=this.$$.callbacks[e]||(this.$$.callbacks[e]=[]);return r.push(n),()=>{const i=r.indexOf(n);i!==-1&&r.splice(i,1)}}$set(e){this.$$set&&!gi(e)&&(this.$$.skip_bound=!0,this.$$set(e),this.$$.skip_bound=!1)}}const Ni="4";typeof window<"u"&&(window.__svelte||(window.__svelte={v:new Set})).v.add(Ni);const Ve=[];function te(t,e=U){let n;const r=new Set;function i(a){if(Ut(t,a)&&(t=a,n)){const l=!Ve.length;for(const c of r)c[1](),Ve.push(c,t);if(l){for(let c=0;c<Ve.length;c+=2)Ve[c][0](Ve[c+1]);Ve.length=0}}}function o(a){i(a(t))}function s(a,l=U){const c=[a,l];return r.add(c),r.size===1&&(n=e(i,o)||U),a(t),()=>{r.delete(c),r.size===0&&n&&(n(),n=null)}}return{set:i,update:o,subscribe:s}}const ir=["accordion","acoustic_bass","acoustic_grand_piano","acoustic_guitar_nylon","acoustic_guitar_steel","agogo","alto_sax","applause","bagpipe","banjo","baritone_sax","bassoon","bird_tweet","blown_bottle","brass_section","breath_noise","bright_acoustic_piano","celesta","cello","choir_aahs","church_organ","clarinet","clavinet","contrabass","distortion_guitar","drawbar_organ","dulcimer","electric_bass_finger","electric_bass_pick","electric_grand_piano","electric_guitar_clean","electric_guitar_jazz","electric_guitar_muted","electric_piano_1","electric_piano_2","english_horn","fiddle","flute","french_horn","fretless_bass","fx_1_rain","fx_2_soundtrack","fx_3_crystal","fx_4_atmosphere","fx_5_brightness","fx_6_goblins","fx_7_echoes","fx_8_scifi","glockenspiel","guitar_fret_noise","guitar_harmonics","gunshot","harmonica","harpsichord","helicopter","honkytonk_piano","kalimba","koto","lead_1_square","lead_2_sawtooth","lead_3_calliope","lead_4_chiff","lead_5_charang","lead_6_voice","lead_7_fifths","lead_8_bass__lead","marimba","melodic_tom","music_box","muted_trumpet","oboe","ocarina","orchestra_hit","orchestral_harp","overdriven_guitar","pad_1_new_age","pad_2_warm","pad_3_polysynth","pad_4_choir","pad_5_bowed","pad_6_metallic","pad_7_halo","pad_8_sweep","pan_flute","percussive_organ","piccolo","pizzicato_strings","recorder","reed_organ","reverse_cymbal","rock_organ","seashore","shakuhachi","shamisen","shanai","sitar","slap_bass_1","slap_bass_2","soprano_sax","steel_drums","string_ensemble_1","string_ensemble_2","synth_bass_1","synth_bass_2","synth_brass_1","synth_brass_2","synth_choir","synth_drum","synth_strings_1","synth_strings_2","taiko_drum","tango_accordion","telephone_ring","tenor_sax","timpani","tinkle_bell","tremolo_strings","trombone","trumpet","tuba","tubular_bells","vibraphone","viola","violin","voice_oohs","whistle","woodblock","xylophone"];var ze=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function Fr(t){if(t.__esModule)return t;var e=t.default;if(typeof e=="function"){var n=function r(){if(this instanceof r){var i=[null];i.push.apply(i,arguments);var o=Function.bind.apply(e,i);return new o}return e.apply(this,arguments)};n.prototype=e.prototype}else n={};return Object.defineProperty(n,"__esModule",{value:!0}),Object.keys(t).forEach(function(r){var i=Object.getOwnPropertyDescriptor(t,r);Object.defineProperty(n,r,i.get?i:{enumerable:!0,get:function(){return t[r]}})}),n}var Mr={},Ft={};function Bi(t){var e=new Z(t),n=e.readChunk();if(n.id!="MThd")throw"Bad MIDI file.  Expected 'MHdr', got: '"+n.id+"'";for(var r=Pi(n.data),i=[],o=0;!e.eof()&&o<r.numTracks;o++){var s=e.readChunk();if(s.id!="MTrk")throw"Bad MIDI file.  Expected 'MTrk', got: '"+s.id+"'";var a=Ui(s.data);i.push(a)}return{header:r,tracks:i}}function Pi(t){var e=new Z(t),n=e.readUInt16(),r=e.readUInt16(),i={format:n,numTracks:r},o=e.readUInt16();return o&32768?(i.framesPerSecond=256-(o>>8),i.ticksPerFrame=o&255):i.ticksPerBeat=o,i}function Ui(t){for(var e=new Z(t),n=[];!e.eof();){var r=o();n.push(r)}return n;var i;function o(){var s={};s.deltaTime=e.readVarInt();var a=e.readUInt8();if((a&240)===240)if(a===255){s.meta=!0;var l=e.readUInt8(),c=e.readVarInt();switch(l){case 0:if(s.type="sequenceNumber",c!==2)throw"Expected length for sequenceNumber event is 2, got "+c;return s.number=e.readUInt16(),s;case 1:return s.type="text",s.text=e.readString(c),s;case 2:return s.type="copyrightNotice",s.text=e.readString(c),s;case 3:return s.type="trackName",s.text=e.readString(c),s;case 4:return s.type="instrumentName",s.text=e.readString(c),s;case 5:return s.type="lyrics",s.text=e.readString(c),s;case 6:return s.type="marker",s.text=e.readString(c),s;case 7:return s.type="cuePoint",s.text=e.readString(c),s;case 32:if(s.type="channelPrefix",c!=1)throw"Expected length for channelPrefix event is 1, got "+c;return s.channel=e.readUInt8(),s;case 33:if(s.type="portPrefix",c!=1)throw"Expected length for portPrefix event is 1, got "+c;return s.port=e.readUInt8(),s;case 47:if(s.type="endOfTrack",c!=0)throw"Expected length for endOfTrack event is 0, got "+c;return s;case 81:if(s.type="setTempo",c!=3)throw"Expected length for setTempo event is 3, got "+c;return s.microsecondsPerBeat=e.readUInt24(),s;case 84:if(s.type="smpteOffset",c!=5)throw"Expected length for smpteOffset event is 5, got "+c;var m=e.readUInt8(),d={0:24,32:25,64:29,96:30};return s.frameRate=d[m&96],s.hour=m&31,s.min=e.readUInt8(),s.sec=e.readUInt8(),s.frame=e.readUInt8(),s.subFrame=e.readUInt8(),s;case 88:if(s.type="timeSignature",c!=2&&c!=4)throw"Expected length for timeSignature event is 4 or 2, got "+c;return s.numerator=e.readUInt8(),s.denominator=1<<e.readUInt8(),c===4?(s.metronome=e.readUInt8(),s.thirtyseconds=e.readUInt8()):(s.metronome=36,s.thirtyseconds=8),s;case 89:if(s.type="keySignature",c!=2)throw"Expected length for keySignature event is 2, got "+c;return s.key=e.readInt8(),s.scale=e.readUInt8(),s;case 127:return s.type="sequencerSpecific",s.data=e.readBytes(c),s;default:return s.type="unknownMeta",s.data=e.readBytes(c),s.metatypeByte=l,s}}else if(a==240){s.type="sysEx";var c=e.readVarInt();return s.data=e.readBytes(c),s}else if(a==247){s.type="endSysEx";var c=e.readVarInt();return s.data=e.readBytes(c),s}else throw"Unrecognised MIDI event type byte: "+a;else{var u;if(a&128)u=e.readUInt8(),i=a;else{if(i===null)throw"Running status byte encountered before status byte";u=a,a=i,s.running=!0}var f=a>>4;switch(s.channel=a&15,f){case 8:return s.type="noteOff",s.noteNumber=u,s.velocity=e.readUInt8(),s;case 9:var h=e.readUInt8();return s.type=h===0?"noteOff":"noteOn",s.noteNumber=u,s.velocity=h,h===0&&(s.byte9=!0),s;case 10:return s.type="noteAftertouch",s.noteNumber=u,s.amount=e.readUInt8(),s;case 11:return s.type="controller",s.controllerType=u,s.value=e.readUInt8(),s;case 12:return s.type="programChange",s.programNumber=u,s;case 13:return s.type="channelAftertouch",s.amount=u,s;case 14:return s.type="pitchBend",s.value=u+(e.readUInt8()<<7)-8192,s;default:throw"Unrecognised MIDI event type: "+f}}}}function Z(t){this.buffer=t,this.bufferLen=this.buffer.length,this.pos=0}Z.prototype.eof=function(){return this.pos>=this.bufferLen};Z.prototype.readUInt8=function(){var t=this.buffer[this.pos];return this.pos+=1,t};Z.prototype.readInt8=function(){var t=this.readUInt8();return t&128?t-256:t};Z.prototype.readUInt16=function(){var t=this.readUInt8(),e=this.readUInt8();return(t<<8)+e};Z.prototype.readInt16=function(){var t=this.readUInt16();return t&32768?t-65536:t};Z.prototype.readUInt24=function(){var t=this.readUInt8(),e=this.readUInt8(),n=this.readUInt8();return(t<<16)+(e<<8)+n};Z.prototype.readInt24=function(){var t=this.readUInt24();return t&8388608?t-16777216:t};Z.prototype.readUInt32=function(){var t=this.readUInt8(),e=this.readUInt8(),n=this.readUInt8(),r=this.readUInt8();return(t<<24)+(e<<16)+(n<<8)+r};Z.prototype.readBytes=function(t){var e=this.buffer.slice(this.pos,this.pos+t);return this.pos+=t,e};Z.prototype.readString=function(t){var e=this.readBytes(t);return String.fromCharCode.apply(null,e)};Z.prototype.readVarInt=function(){for(var t=0;!this.eof();){var e=this.readUInt8();if(e&128)t+=e&127,t<<=7;else return t+e}return t};Z.prototype.readChunk=function(){var t=this.readString(4),e=this.readUInt32(),n=this.readBytes(e);return{id:t,length:e,data:n}};var Fi=Bi;function Mi(t,e){if(typeof t!="object")throw"Invalid MIDI data";e=e||{};var n=t.header||{},r=t.tracks||[],i,o=r.length,s=new J;for(Ri(s,n,o),i=0;i<o;i++)Li(s,r[i],e);return s.buffer}function Ri(t,e,n){var r=e.format==null?1:e.format,i=128;e.timeDivision?i=e.timeDivision:e.ticksPerFrame&&e.framesPerSecond?i=-(e.framesPerSecond&255)<<8|e.ticksPerFrame&255:e.ticksPerBeat&&(i=e.ticksPerBeat&32767);var o=new J;o.writeUInt16(r),o.writeUInt16(n),o.writeUInt16(i),t.writeChunk("MThd",o.buffer)}function Li(t,e,n){var r=new J,i,o=e.length,s=null;for(i=0;i<o;i++)(n.running===!1||!n.running&&!e[i].running)&&(s=null),s=Di(r,e[i],s,n.useByte9ForNoteOff);t.writeChunk("MTrk",r.buffer)}function Di(t,e,n,r){var i=e.type,o=e.deltaTime,s=e.text||"",a=e.data||[],l=null;switch(t.writeVarInt(o),i){case"sequenceNumber":t.writeUInt8(255),t.writeUInt8(0),t.writeVarInt(2),t.writeUInt16(e.number);break;case"text":t.writeUInt8(255),t.writeUInt8(1),t.writeVarInt(s.length),t.writeString(s);break;case"copyrightNotice":t.writeUInt8(255),t.writeUInt8(2),t.writeVarInt(s.length),t.writeString(s);break;case"trackName":t.writeUInt8(255),t.writeUInt8(3),t.writeVarInt(s.length),t.writeString(s);break;case"instrumentName":t.writeUInt8(255),t.writeUInt8(4),t.writeVarInt(s.length),t.writeString(s);break;case"lyrics":t.writeUInt8(255),t.writeUInt8(5),t.writeVarInt(s.length),t.writeString(s);break;case"marker":t.writeUInt8(255),t.writeUInt8(6),t.writeVarInt(s.length),t.writeString(s);break;case"cuePoint":t.writeUInt8(255),t.writeUInt8(7),t.writeVarInt(s.length),t.writeString(s);break;case"channelPrefix":t.writeUInt8(255),t.writeUInt8(32),t.writeVarInt(1),t.writeUInt8(e.channel);break;case"portPrefix":t.writeUInt8(255),t.writeUInt8(33),t.writeVarInt(1),t.writeUInt8(e.port);break;case"endOfTrack":t.writeUInt8(255),t.writeUInt8(47),t.writeVarInt(0);break;case"setTempo":t.writeUInt8(255),t.writeUInt8(81),t.writeVarInt(3),t.writeUInt24(e.microsecondsPerBeat);break;case"smpteOffset":t.writeUInt8(255),t.writeUInt8(84),t.writeVarInt(5);var c={24:0,25:32,29:64,30:96},m=e.hour&31|c[e.frameRate];t.writeUInt8(m),t.writeUInt8(e.min),t.writeUInt8(e.sec),t.writeUInt8(e.frame),t.writeUInt8(e.subFrame);break;case"timeSignature":t.writeUInt8(255),t.writeUInt8(88),t.writeVarInt(4),t.writeUInt8(e.numerator);var d=Math.floor(Math.log(e.denominator)/Math.LN2)&255;t.writeUInt8(d),t.writeUInt8(e.metronome),t.writeUInt8(e.thirtyseconds||8);break;case"keySignature":t.writeUInt8(255),t.writeUInt8(89),t.writeVarInt(2),t.writeInt8(e.key),t.writeUInt8(e.scale);break;case"sequencerSpecific":t.writeUInt8(255),t.writeUInt8(127),t.writeVarInt(a.length),t.writeBytes(a);break;case"unknownMeta":e.metatypeByte!=null&&(t.writeUInt8(255),t.writeUInt8(e.metatypeByte),t.writeVarInt(a.length),t.writeBytes(a));break;case"sysEx":t.writeUInt8(240),t.writeVarInt(a.length),t.writeBytes(a);break;case"endSysEx":t.writeUInt8(247),t.writeVarInt(a.length),t.writeBytes(a);break;case"noteOff":var u=r!==!1&&e.byte9||r&&e.velocity==0?144:128;l=u|e.channel,l!==n&&t.writeUInt8(l),t.writeUInt8(e.noteNumber),t.writeUInt8(e.velocity);break;case"noteOn":l=144|e.channel,l!==n&&t.writeUInt8(l),t.writeUInt8(e.noteNumber),t.writeUInt8(e.velocity);break;case"noteAftertouch":l=160|e.channel,l!==n&&t.writeUInt8(l),t.writeUInt8(e.noteNumber),t.writeUInt8(e.amount);break;case"controller":l=176|e.channel,l!==n&&t.writeUInt8(l),t.writeUInt8(e.controllerType),t.writeUInt8(e.value);break;case"programChange":l=192|e.channel,l!==n&&t.writeUInt8(l),t.writeUInt8(e.programNumber);break;case"channelAftertouch":l=208|e.channel,l!==n&&t.writeUInt8(l),t.writeUInt8(e.amount);break;case"pitchBend":l=224|e.channel,l!==n&&t.writeUInt8(l);var f=8192+e.value,h=f&127,p=f>>7&127;t.writeUInt8(h),t.writeUInt8(p);break;default:throw"Unrecognized event type: "+i}return l}function J(){this.buffer=[]}J.prototype.writeUInt8=function(t){this.buffer.push(t&255)};J.prototype.writeInt8=J.prototype.writeUInt8;J.prototype.writeUInt16=function(t){var e=t>>8&255,n=t&255;this.writeUInt8(e),this.writeUInt8(n)};J.prototype.writeInt16=J.prototype.writeUInt16;J.prototype.writeUInt24=function(t){var e=t>>16&255,n=t>>8&255,r=t&255;this.writeUInt8(e),this.writeUInt8(n),this.writeUInt8(r)};J.prototype.writeInt24=J.prototype.writeUInt24;J.prototype.writeUInt32=function(t){var e=t>>24&255,n=t>>16&255,r=t>>8&255,i=t&255;this.writeUInt8(e),this.writeUInt8(n),this.writeUInt8(r),this.writeUInt8(i)};J.prototype.writeInt32=J.prototype.writeUInt32;J.prototype.writeBytes=function(t){this.buffer=this.buffer.concat(Array.prototype.slice.call(t,0))};J.prototype.writeString=function(t){var e,n=t.length,r=[];for(e=0;e<n;e++)r.push(t.codePointAt(e));this.writeBytes(r)};J.prototype.writeVarInt=function(t){if(t<0)throw"Cannot write negative variable-length integer";if(t<=127)this.writeUInt8(t);else{var e=t,n=[];for(n.push(e&127),e>>=7;e;){var r=e&127|128;n.push(r),e>>=7}this.writeBytes(n.reverse())}};J.prototype.writeChunk=function(t,e){this.writeString(t),this.writeUInt32(e.length),this.writeBytes(e)};var qi=Mi;Ft.parseMidi=Fi;Ft.writeMidi=qi;var Nt={},Fe={};Object.defineProperty(Fe,"__esModule",{value:!0});Fe.insert=Fe.search=void 0;function Rr(t,e,n){n===void 0&&(n="ticks");var r=0,i=t.length,o=i;if(i>0&&t[i-1][n]<=e)return i-1;for(;r<o;){var s=Math.floor(r+(o-r)/2),a=t[s],l=t[s+1];if(a[n]===e){for(var c=s;c<t.length;c++){var m=t[c];m[n]===e&&(s=c)}return s}else{if(a[n]<e&&l[n]>e)return s;a[n]>e?o=s:a[n]<e&&(r=s+1)}}return-1}Fe.search=Rr;function Vi(t,e,n){if(n===void 0&&(n="ticks"),t.length){var r=Rr(t,e[n],n);t.splice(r+1,0,e)}else t.push(e)}Fe.insert=Vi;(function(t){Object.defineProperty(t,"__esModule",{value:!0}),t.Header=t.keySignatureKeys=void 0;var e=Fe,n=new WeakMap;t.keySignatureKeys=["Cb","Gb","Db","Ab","Eb","Bb","F","C","G","D","A","E","B","F#","C#"];var r=function(){function i(o){var s=this;if(this.tempos=[],this.timeSignatures=[],this.keySignatures=[],this.meta=[],this.name="",n.set(this,480),o){n.set(this,o.header.ticksPerBeat),o.tracks.forEach(function(l){l.forEach(function(c){c.meta&&(c.type==="timeSignature"?s.timeSignatures.push({ticks:c.absoluteTime,timeSignature:[c.numerator,c.denominator]}):c.type==="setTempo"?s.tempos.push({bpm:6e7/c.microsecondsPerBeat,ticks:c.absoluteTime}):c.type==="keySignature"&&s.keySignatures.push({key:t.keySignatureKeys[c.key+7],scale:c.scale===0?"major":"minor",ticks:c.absoluteTime}))})});var a=0;o.tracks[0].forEach(function(l){a+=l.deltaTime,l.meta&&(l.type==="trackName"?s.name=l.text:(l.type==="text"||l.type==="cuePoint"||l.type==="marker"||l.type==="lyrics")&&s.meta.push({text:l.text,ticks:a,type:l.type}))}),this.update()}}return i.prototype.update=function(){var o=this,s=0,a=0;this.tempos.sort(function(l,c){return l.ticks-c.ticks}),this.tempos.forEach(function(l,c){var m=c>0?o.tempos[c-1].bpm:o.tempos[0].bpm,d=l.ticks/o.ppq-a,u=60/m*d;l.time=u+s,s=l.time,a+=d}),this.timeSignatures.sort(function(l,c){return l.ticks-c.ticks}),this.timeSignatures.forEach(function(l,c){var m=c>0?o.timeSignatures[c-1]:o.timeSignatures[0],d=(l.ticks-m.ticks)/o.ppq,u=d/m.timeSignature[0]/(m.timeSignature[1]/4);m.measures=m.measures||0,l.measures=u+m.measures})},i.prototype.ticksToSeconds=function(o){var s=(0,e.search)(this.tempos,o);if(s!==-1){var a=this.tempos[s],l=a.time,c=(o-a.ticks)/this.ppq;return l+60/a.bpm*c}else{var m=o/this.ppq;return 60/120*m}},i.prototype.ticksToMeasures=function(o){var s=(0,e.search)(this.timeSignatures,o);if(s!==-1){var a=this.timeSignatures[s],l=(o-a.ticks)/this.ppq;return a.measures+l/(a.timeSignature[0]/a.timeSignature[1])/4}else return o/this.ppq/4},Object.defineProperty(i.prototype,"ppq",{get:function(){return n.get(this)},enumerable:!1,configurable:!0}),i.prototype.secondsToTicks=function(o){var s=(0,e.search)(this.tempos,o,"time");if(s!==-1){var a=this.tempos[s],l=a.time,c=o-l,m=c/(60/a.bpm);return Math.round(a.ticks+m*this.ppq)}else{var d=o/.5;return Math.round(d*this.ppq)}},i.prototype.toJSON=function(){return{keySignatures:this.keySignatures,meta:this.meta,name:this.name,ppq:this.ppq,tempos:this.tempos.map(function(o){return{bpm:o.bpm,ticks:o.ticks}}),timeSignatures:this.timeSignatures}},i.prototype.fromJSON=function(o){this.name=o.name,this.tempos=o.tempos.map(function(s){return Object.assign({},s)}),this.timeSignatures=o.timeSignatures.map(function(s){return Object.assign({},s)}),this.keySignatures=o.keySignatures.map(function(s){return Object.assign({},s)}),this.meta=o.meta.map(function(s){return Object.assign({},s)}),n.set(this,o.ppq),this.update()},i.prototype.setTempo=function(o){this.tempos=[{bpm:o,ticks:0}],this.update()},i}();t.Header=r})(Nt);var st={},In={};(function(t){Object.defineProperty(t,"__esModule",{value:!0}),t.ControlChange=t.controlChangeIds=t.controlChangeNames=void 0,t.controlChangeNames={1:"modulationWheel",2:"breath",4:"footController",5:"portamentoTime",7:"volume",8:"balance",10:"pan",64:"sustain",65:"portamentoTime",66:"sostenuto",67:"softPedal",68:"legatoFootswitch",84:"portamentoControl"},t.controlChangeIds=Object.keys(t.controlChangeNames).reduce(function(i,o){return i[t.controlChangeNames[o]]=o,i},{});var e=new WeakMap,n=new WeakMap,r=function(){function i(o,s){e.set(this,s),n.set(this,o.controllerType),this.ticks=o.absoluteTime,this.value=o.value}return Object.defineProperty(i.prototype,"number",{get:function(){return n.get(this)},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"name",{get:function(){return t.controlChangeNames[this.number]?t.controlChangeNames[this.number]:null},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"time",{get:function(){var o=e.get(this);return o.ticksToSeconds(this.ticks)},set:function(o){var s=e.get(this);this.ticks=s.secondsToTicks(o)},enumerable:!1,configurable:!0}),i.prototype.toJSON=function(){return{number:this.number,ticks:this.ticks,time:this.time,value:this.value}},i}();t.ControlChange=r})(In);var Mt={};Object.defineProperty(Mt,"__esModule",{value:!0});Mt.createControlChanges=void 0;var mt=In;function $i(){return new Proxy({},{get:function(t,e){if(t[e])return t[e];if(mt.controlChangeIds.hasOwnProperty(e))return t[mt.controlChangeIds[e]]},set:function(t,e,n){return mt.controlChangeIds.hasOwnProperty(e)?t[mt.controlChangeIds[e]]=n:t[e]=n,!0}})}Mt.createControlChanges=$i;var Rt={};Object.defineProperty(Rt,"__esModule",{value:!0});Rt.PitchBend=void 0;var Gt=new WeakMap,ji=function(){function t(e,n){Gt.set(this,n),this.ticks=e.absoluteTime,this.value=e.value}return Object.defineProperty(t.prototype,"time",{get:function(){var e=Gt.get(this);return e.ticksToSeconds(this.ticks)},set:function(e){var n=Gt.get(this);this.ticks=n.secondsToTicks(e)},enumerable:!1,configurable:!0}),t.prototype.toJSON=function(){return{ticks:this.ticks,time:this.time,value:this.value}},t}();Rt.PitchBend=ji;var Lt={},Ae={};Object.defineProperty(Ae,"__esModule",{value:!0});Ae.DrumKitByPatchID=Ae.InstrumentFamilyByID=Ae.instrumentByPatchID=void 0;Ae.instrumentByPatchID=["acoustic grand piano","bright acoustic piano","electric grand piano","honky-tonk piano","electric piano 1","electric piano 2","harpsichord","clavi","celesta","glockenspiel","music box","vibraphone","marimba","xylophone","tubular bells","dulcimer","drawbar organ","percussive organ","rock organ","church organ","reed organ","accordion","harmonica","tango accordion","acoustic guitar (nylon)","acoustic guitar (steel)","electric guitar (jazz)","electric guitar (clean)","electric guitar (muted)","overdriven guitar","distortion guitar","guitar harmonics","acoustic bass","electric bass (finger)","electric bass (pick)","fretless bass","slap bass 1","slap bass 2","synth bass 1","synth bass 2","violin","viola","cello","contrabass","tremolo strings","pizzicato strings","orchestral harp","timpani","string ensemble 1","string ensemble 2","synthstrings 1","synthstrings 2","choir aahs","voice oohs","synth voice","orchestra hit","trumpet","trombone","tuba","muted trumpet","french horn","brass section","synthbrass 1","synthbrass 2","soprano sax","alto sax","tenor sax","baritone sax","oboe","english horn","bassoon","clarinet","piccolo","flute","recorder","pan flute","blown bottle","shakuhachi","whistle","ocarina","lead 1 (square)","lead 2 (sawtooth)","lead 3 (calliope)","lead 4 (chiff)","lead 5 (charang)","lead 6 (voice)","lead 7 (fifths)","lead 8 (bass + lead)","pad 1 (new age)","pad 2 (warm)","pad 3 (polysynth)","pad 4 (choir)","pad 5 (bowed)","pad 6 (metallic)","pad 7 (halo)","pad 8 (sweep)","fx 1 (rain)","fx 2 (soundtrack)","fx 3 (crystal)","fx 4 (atmosphere)","fx 5 (brightness)","fx 6 (goblins)","fx 7 (echoes)","fx 8 (sci-fi)","sitar","banjo","shamisen","koto","kalimba","bag pipe","fiddle","shanai","tinkle bell","agogo","steel drums","woodblock","taiko drum","melodic tom","synth drum","reverse cymbal","guitar fret noise","breath noise","seashore","bird tweet","telephone ring","helicopter","applause","gunshot"];Ae.InstrumentFamilyByID=["piano","chromatic percussion","organ","guitar","bass","strings","ensemble","brass","reed","pipe","synth lead","synth pad","synth effects","world","percussive","sound effects"];Ae.DrumKitByPatchID={0:"standard kit",8:"room kit",16:"power kit",24:"electronic kit",25:"tr-808 kit",32:"jazz kit",40:"brush kit",48:"orchestra kit",56:"sound fx kit"};Object.defineProperty(Lt,"__esModule",{value:!0});Lt.Instrument=void 0;var yt=Ae,sr=new WeakMap,Ki=function(){function t(e,n){if(this.number=0,sr.set(this,n),this.number=0,e){var r=e.find(function(i){return i.type==="programChange"});r&&(this.number=r.programNumber)}}return Object.defineProperty(t.prototype,"name",{get:function(){return this.percussion?yt.DrumKitByPatchID[this.number]:yt.instrumentByPatchID[this.number]},set:function(e){var n=yt.instrumentByPatchID.indexOf(e);n!==-1&&(this.number=n)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"family",{get:function(){return this.percussion?"drums":yt.InstrumentFamilyByID[Math.floor(this.number/8)]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"percussion",{get:function(){var e=sr.get(this);return e.channel===9},enumerable:!1,configurable:!0}),t.prototype.toJSON=function(){return{family:this.family,number:this.number,name:this.name}},t.prototype.fromJSON=function(e){this.number=e.number},t}();Lt.Instrument=Ki;var Dt={};Object.defineProperty(Dt,"__esModule",{value:!0});Dt.Note=void 0;function Hi(t){var e=Math.floor(t/12)-1;return Lr(t)+e.toString()}function Lr(t){var e=["C","C#","D","D#","E","F","F#","G","G#","A","A#","B"],n=t%12;return e[n]}function Ji(t){var e=["C","C#","D","D#","E","F","F#","G","G#","A","A#","B"];return e.indexOf(t)}var zi=function(){var t=/^([a-g]{1}(?:b|#|x|bb)?)(-?[0-9]+)/i,e={cbb:-2,cb:-1,c:0,"c#":1,cx:2,dbb:0,db:1,d:2,"d#":3,dx:4,ebb:2,eb:3,e:4,"e#":5,ex:6,fbb:3,fb:4,f:5,"f#":6,fx:7,gbb:5,gb:6,g:7,"g#":8,gx:9,abb:7,ab:8,a:9,"a#":10,ax:11,bbb:9,bb:10,b:11,"b#":12,bx:13};return function(n){var r=t.exec(n),i=r[1],o=r[2],s=e[i.toLowerCase()];return s+(parseInt(o,10)+1)*12}}(),$e=new WeakMap,Wi=function(){function t(e,n,r){$e.set(this,r),this.midi=e.midi,this.velocity=e.velocity,this.noteOffVelocity=n.velocity,this.ticks=e.ticks,this.durationTicks=n.ticks-e.ticks}return Object.defineProperty(t.prototype,"name",{get:function(){return Hi(this.midi)},set:function(e){this.midi=zi(e)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"octave",{get:function(){return Math.floor(this.midi/12)-1},set:function(e){var n=e-this.octave;this.midi+=n*12},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"pitch",{get:function(){return Lr(this.midi)},set:function(e){this.midi=12*(this.octave+1)+Ji(e)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"duration",{get:function(){var e=$e.get(this);return e.ticksToSeconds(this.ticks+this.durationTicks)-e.ticksToSeconds(this.ticks)},set:function(e){var n=$e.get(this),r=n.secondsToTicks(this.time+e);this.durationTicks=r-this.ticks},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"time",{get:function(){var e=$e.get(this);return e.ticksToSeconds(this.ticks)},set:function(e){var n=$e.get(this);this.ticks=n.secondsToTicks(e)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"bars",{get:function(){var e=$e.get(this);return e.ticksToMeasures(this.ticks)},enumerable:!1,configurable:!0}),t.prototype.toJSON=function(){return{duration:this.duration,durationTicks:this.durationTicks,midi:this.midi,name:this.name,ticks:this.ticks,time:this.time,velocity:this.velocity}},t}();Dt.Note=Wi;Object.defineProperty(st,"__esModule",{value:!0});st.Track=void 0;var Yt=Fe,Gi=In,Yi=Mt,Xi=Rt,or=Lt,Qi=Dt,gt=new WeakMap,Zi=function(){function t(e,n){var r=this;if(this.name="",this.notes=[],this.controlChanges=(0,Yi.createControlChanges)(),this.pitchBends=[],gt.set(this,n),e){var i=e.find(function(u){return u.type==="trackName"});this.name=i?i.text:""}if(this.instrument=new or.Instrument(e,this),this.channel=0,e){for(var o=e.filter(function(u){return u.type==="noteOn"}),s=e.filter(function(u){return u.type==="noteOff"}),a=function(){var u=o.shift();l.channel=u.channel;var f=s.findIndex(function(p){return p.noteNumber===u.noteNumber&&p.absoluteTime>=u.absoluteTime});if(f!==-1){var h=s.splice(f,1)[0];l.addNote({durationTicks:h.absoluteTime-u.absoluteTime,midi:u.noteNumber,noteOffVelocity:h.velocity/127,ticks:u.absoluteTime,velocity:u.velocity/127})}},l=this;o.length;)a();var c=e.filter(function(u){return u.type==="controller"});c.forEach(function(u){r.addCC({number:u.controllerType,ticks:u.absoluteTime,value:u.value/127})});var m=e.filter(function(u){return u.type==="pitchBend"});m.forEach(function(u){r.addPitchBend({ticks:u.absoluteTime,value:u.value/Math.pow(2,13)})});var d=e.find(function(u){return u.type==="endOfTrack"});this.endOfTrackTicks=d!==void 0?d.absoluteTime:void 0}}return t.prototype.addNote=function(e){var n=gt.get(this),r=new Qi.Note({midi:0,ticks:0,velocity:1},{ticks:0,velocity:0},n);return Object.assign(r,e),(0,Yt.insert)(this.notes,r,"ticks"),this},t.prototype.addCC=function(e){var n=gt.get(this),r=new Gi.ControlChange({controllerType:e.number},n);return delete e.number,Object.assign(r,e),Array.isArray(this.controlChanges[r.number])||(this.controlChanges[r.number]=[]),(0,Yt.insert)(this.controlChanges[r.number],r,"ticks"),this},t.prototype.addPitchBend=function(e){var n=gt.get(this),r=new Xi.PitchBend({},n);return Object.assign(r,e),(0,Yt.insert)(this.pitchBends,r,"ticks"),this},Object.defineProperty(t.prototype,"duration",{get:function(){if(!this.notes.length)return 0;for(var e=this.notes[this.notes.length-1].time+this.notes[this.notes.length-1].duration,n=0;n<this.notes.length-1;n++){var r=this.notes[n].time+this.notes[n].duration;e<r&&(e=r)}return e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"durationTicks",{get:function(){if(!this.notes.length)return 0;for(var e=this.notes[this.notes.length-1].ticks+this.notes[this.notes.length-1].durationTicks,n=0;n<this.notes.length-1;n++){var r=this.notes[n].ticks+this.notes[n].durationTicks;e<r&&(e=r)}return e},enumerable:!1,configurable:!0}),t.prototype.fromJSON=function(e){var n=this;this.name=e.name,this.channel=e.channel,this.instrument=new or.Instrument(void 0,this),this.instrument.fromJSON(e.instrument),e.endOfTrackTicks!==void 0&&(this.endOfTrackTicks=e.endOfTrackTicks);for(var r in e.controlChanges)e.controlChanges[r]&&e.controlChanges[r].forEach(function(i){n.addCC({number:i.number,ticks:i.ticks,value:i.value})});e.notes.forEach(function(i){n.addNote({durationTicks:i.durationTicks,midi:i.midi,ticks:i.ticks,velocity:i.velocity})})},t.prototype.toJSON=function(){for(var e={},n=0;n<127;n++)this.controlChanges.hasOwnProperty(n)&&(e[n]=this.controlChanges[n].map(function(i){return i.toJSON()}));var r={channel:this.channel,controlChanges:e,pitchBends:this.pitchBends.map(function(i){return i.toJSON()}),instrument:this.instrument.toJSON(),name:this.name,notes:this.notes.map(function(i){return i.toJSON()})};return this.endOfTrackTicks!==void 0&&(r.endOfTrackTicks=this.endOfTrackTicks),r},t}();st.Track=Zi;var qt={};function es(t){var e=[];return Dr(t,e),e}function Dr(t,e){for(var n=0;n<t.length;n++){var r=t[n];Array.isArray(r)?Dr(r,e):e.push(r)}}const ts=Object.freeze(Object.defineProperty({__proto__:null,flatten:es},Symbol.toStringTag,{value:"Module"})),ns=Fr(ts);var Ee=ze&&ze.__spreadArray||function(t,e,n){if(n||arguments.length===2)for(var r=0,i=e.length,o;r<i;r++)(o||!(r in e))&&(o||(o=Array.prototype.slice.call(e,0,r)),o[r]=e[r]);return t.concat(o||Array.prototype.slice.call(e))};Object.defineProperty(qt,"__esModule",{value:!0});qt.encode=void 0;var rs=Ft,is=Nt,ss=ns;function os(t,e){return[{absoluteTime:t.ticks,channel:e,deltaTime:0,noteNumber:t.midi,type:"noteOn",velocity:Math.floor(t.velocity*127)},{absoluteTime:t.ticks+t.durationTicks,channel:e,deltaTime:0,noteNumber:t.midi,type:"noteOff",velocity:Math.floor(t.noteOffVelocity*127)}]}function as(t){return(0,ss.flatten)(t.notes.map(function(e){return os(e,t.channel)}))}function cs(t,e){return{absoluteTime:t.ticks,channel:e,controllerType:t.number,deltaTime:0,type:"controller",value:Math.floor(t.value*127)}}function us(t){for(var e=[],n=0;n<127;n++)t.controlChanges.hasOwnProperty(n)&&t.controlChanges[n].forEach(function(r){e.push(cs(r,t.channel))});return e}function ls(t,e){return{absoluteTime:t.ticks,channel:e,deltaTime:0,type:"pitchBend",value:t.value}}function fs(t){var e=[];return t.pitchBends.forEach(function(n){e.push(ls(n,t.channel))}),e}function hs(t){return{absoluteTime:0,channel:t.channel,deltaTime:0,programNumber:t.instrument.number,type:"programChange"}}function ds(t){return{absoluteTime:0,deltaTime:0,meta:!0,text:t,type:"trackName"}}function ps(t){return{absoluteTime:t.ticks,deltaTime:0,meta:!0,microsecondsPerBeat:Math.floor(6e7/t.bpm),type:"setTempo"}}function ms(t){return{absoluteTime:t.ticks,deltaTime:0,denominator:t.timeSignature[1],meta:!0,metronome:24,numerator:t.timeSignature[0],thirtyseconds:8,type:"timeSignature"}}function ys(t){var e=is.keySignatureKeys.indexOf(t.key);return{absoluteTime:t.ticks,deltaTime:0,key:e+7,meta:!0,scale:t.scale==="major"?0:1,type:"keySignature"}}function gs(t){return{absoluteTime:t.ticks,deltaTime:0,meta:!0,text:t.text,type:t.type}}function bs(t){var e={header:{format:1,numTracks:t.tracks.length+1,ticksPerBeat:t.header.ppq},tracks:Ee([Ee(Ee(Ee(Ee([{absoluteTime:0,deltaTime:0,meta:!0,text:t.header.name,type:"trackName"}],t.header.keySignatures.map(function(n){return ys(n)}),!0),t.header.meta.map(function(n){return gs(n)}),!0),t.header.tempos.map(function(n){return ps(n)}),!0),t.header.timeSignatures.map(function(n){return ms(n)}),!0)],t.tracks.map(function(n){return Ee(Ee(Ee([ds(n.name),hs(n)],as(n),!0),us(n),!0),fs(n),!0)}),!0)};return e.tracks=e.tracks.map(function(n){n=n.sort(function(i,o){return i.absoluteTime-o.absoluteTime});var r=0;return n.forEach(function(i){i.deltaTime=i.absoluteTime-r,r=i.absoluteTime,delete i.absoluteTime}),n.push({deltaTime:0,meta:!0,type:"endOfTrack"}),n}),new Uint8Array((0,rs.writeMidi)(e))}qt.encode=bs;(function(t){var e=ze&&ze.__awaiter||function(d,u,f,h){function p(y){return y instanceof f?y:new f(function(I){I(y)})}return new(f||(f=Promise))(function(y,I){function D(O){try{w(h.next(O))}catch(j){I(j)}}function M(O){try{w(h.throw(O))}catch(j){I(j)}}function w(O){O.done?y(O.value):p(O.value).then(D,M)}w((h=h.apply(d,u||[])).next())})},n=ze&&ze.__generator||function(d,u){var f={label:0,sent:function(){if(y[0]&1)throw y[1];return y[1]},trys:[],ops:[]},h,p,y,I;return I={next:D(0),throw:D(1),return:D(2)},typeof Symbol=="function"&&(I[Symbol.iterator]=function(){return this}),I;function D(w){return function(O){return M([w,O])}}function M(w){if(h)throw new TypeError("Generator is already executing.");for(;f;)try{if(h=1,p&&(y=w[0]&2?p.return:w[0]?p.throw||((y=p.return)&&y.call(p),0):p.next)&&!(y=y.call(p,w[1])).done)return y;switch(p=0,y&&(w=[w[0]&2,y.value]),w[0]){case 0:case 1:y=w;break;case 4:return f.label++,{value:w[1],done:!1};case 5:f.label++,p=w[1],w=[0];continue;case 7:w=f.ops.pop(),f.trys.pop();continue;default:if(y=f.trys,!(y=y.length>0&&y[y.length-1])&&(w[0]===6||w[0]===2)){f=0;continue}if(w[0]===3&&(!y||w[1]>y[0]&&w[1]<y[3])){f.label=w[1];break}if(w[0]===6&&f.label<y[1]){f.label=y[1],y=w;break}if(y&&f.label<y[2]){f.label=y[2],f.ops.push(w);break}y[2]&&f.ops.pop(),f.trys.pop();continue}w=u.call(d,f)}catch(O){w=[6,O],p=0}finally{h=y=0}if(w[0]&5)throw w[1];return{value:w[0]?w[1]:void 0,done:!0}}};Object.defineProperty(t,"__esModule",{value:!0}),t.Header=t.Track=t.Midi=void 0;var r=Ft,i=Nt,o=st,s=qt,a=function(){function d(u){var f=this,h=null;if(u){var p=u instanceof ArrayBuffer?new Uint8Array(u):u;h=(0,r.parseMidi)(p),h.tracks.forEach(function(y){var I=0;y.forEach(function(D){I+=D.deltaTime,D.absoluteTime=I})}),h.tracks=m(h.tracks)}this.header=new i.Header(h),this.tracks=[],u&&(this.tracks=h.tracks.map(function(y){return new o.Track(y,f.header)}),h.header.format===1&&this.tracks[0].duration===0&&this.tracks.shift())}return d.fromUrl=function(u){return e(this,void 0,void 0,function(){var f,h;return n(this,function(p){switch(p.label){case 0:return[4,fetch(u)];case 1:return f=p.sent(),f.ok?[4,f.arrayBuffer()]:[3,3];case 2:return h=p.sent(),[2,new d(h)];case 3:throw new Error("Could not load '".concat(u,"'"))}})})},Object.defineProperty(d.prototype,"name",{get:function(){return this.header.name},set:function(u){this.header.name=u},enumerable:!1,configurable:!0}),Object.defineProperty(d.prototype,"duration",{get:function(){var u=this.tracks.map(function(f){return f.duration});return Math.max.apply(Math,u)},enumerable:!1,configurable:!0}),Object.defineProperty(d.prototype,"durationTicks",{get:function(){var u=this.tracks.map(function(f){return f.durationTicks});return Math.max.apply(Math,u)},enumerable:!1,configurable:!0}),d.prototype.addTrack=function(){var u=new o.Track(void 0,this.header);return this.tracks.push(u),u},d.prototype.toArray=function(){return(0,s.encode)(this)},d.prototype.toJSON=function(){return{header:this.header.toJSON(),tracks:this.tracks.map(function(u){return u.toJSON()})}},d.prototype.fromJSON=function(u){var f=this;this.header=new i.Header,this.header.fromJSON(u.header),this.tracks=u.tracks.map(function(h){var p=new o.Track(void 0,f.header);return p.fromJSON(h),p})},d.prototype.clone=function(){var u=new d;return u.fromJSON(this.toJSON()),u},d}();t.Midi=a;var l=st;Object.defineProperty(t,"Track",{enumerable:!0,get:function(){return l.Track}});var c=Nt;Object.defineProperty(t,"Header",{enumerable:!0,get:function(){return c.Header}});function m(d){for(var u=[],f=0;f<d.length;f++)for(var h=u.length,p=new Map,y=Array(16).fill(0),I=0,D=d[f];I<D.length;I++){var M=D[I],w=h,O=M.channel;if(O!==void 0){M.type==="programChange"&&(y[O]=M.programNumber);var j=y[O],T="".concat(j," ").concat(O);p.has(T)?w=p.get(T):(w=h+p.size,p.set(T,w))}u[w]||u.push([]),u[w].push(M)}return u}})(Mr);const tt=["C","C#","D","D#","E","F","F#","G","G#","A","A#","B"],ar={Backquote:"A#2",Tab:"B2",KeyQ:"C3",Digit2:"C#3",KeyW:"D3",Digit3:"D#3",KeyE:"E3",KeyR:"F3",Digit5:"F#3",KeyT:"G3",Digit6:"G#3",KeyY:"A3",Digit7:"A#3",KeyU:"B3",KeyI:"C4",Digit9:"C#4",KeyO:"D4",Digit0:"D#4",KeyP:"E4",BracketLeft:"F4",Equal:"F#4",BracketRight:"G4",Backspace:"G#4",Backslash:"A4",CapsLock:"A#4",ShiftLeft:"B4",KeyZ:"C5",KeyS:"C#5",KeyX:"D5",KeyD:"D#5",KeyC:"E5",KeyV:"F5",KeyG:"F#5",KeyB:"G5",KeyH:"G#5",KeyN:"A5",KeyJ:"A#5",KeyM:"B5",Comma:"C6",KeyL:"C#6",Period:"D6",Semicolon:"D#6",Slash:"E6",ShiftRight:"F6",Enter:"F#6"};function hn(t){return parseInt(t.charAt(t.length-1))}function dn(t){return t.substring(0,t.length-1)}function Xt(t){const e=Math.floor(t/12)-1;return tt[t%12]+e}function vs(t,e){const n=hn(e),r=hn(t),i=tt.indexOf(dn(t)),o=tt.indexOf(dn(e)),s={};let a=0;for(let l=r;l<=n;l++){let c=l===r?i:0;for(;c<tt.length&&!(l===n&&c>o);){const d=tt[c],u=d.length===1;s[d+l]={isWhite:u,pressedColor:null,isGhost:!1},u&&a++,c++}}return{noteMap:s,whiteKeys:a}}const ce=te(!1),Ue=te(0),wt=te(0),pn=te(),Tt=te(1);async function _s(t,e){let n=[],r=null,i,o=[];function s(d){r=new Mr.Midi(d),r.tracks=r.tracks.filter(f=>f.notes.length!==0);let u=0;r.tracks.forEach(f=>{const h=f.notes[f.notes.length-1],p=h.time+h.duration;p>u&&(u=p)}),wt.set(u)}pn.subscribe(d=>{if(ce.set(!1),wt.set(0),Ue.set(0),!d){r=null;return}const u=new FileReader;u.onload=()=>s(u.result),u.readAsArrayBuffer(d)});function a(d){const u=me(Ue)+d;Ue.set(u),o.forEach((f,h)=>{u>f.time+f.duration&&(e(f.name),ws(o,h))}),r.tracks.forEach((f,h)=>{for(;;){const p=f.notes[n[h]];if(!p||u<p.time)break;t(p.name,p.velocity),o.push(p),n[h]++}}),u>me(wt)&&ce.set(!1)}ce.subscribe(d=>{if(!d){clearInterval(i),o.forEach(h=>e(h.name)),o=[];return}if(!r)return ce.set(!1),alert("No MIDI file selected!");r.tracks.forEach((h,p)=>{const y=me(Ue),I=ks(h.notes,D=>D.time-y);n[p]=I});let u=performance.now();function f(){const h=performance.now(),p=h-u;u=h,a(p/1e3*me(Tt))}i=setInterval(f,10)});function l(d){const[u,f,h]=d.data;u>143&&u<160?h==0?e(Xt(f)):t(Xt(f),h/127):u>127&&u<144&&e(Xt(f))}const c=await navigator.requestMIDIAccess();function m(){c.inputs.forEach(d=>{d.onmidimessage=l})}m(),c.onstatechange=()=>{m()}}function ks(t,e){let n=0,r=t.length-1;for(;n!=r;){const i=Math.ceil((n+r)/2);e(t[i])>0?r=i-1:n=i}return r}function ws(t,e){t[e]=t[t.length-1],t.pop()}const ge=Object.create(null);ge.open="0";ge.close="1";ge.ping="2";ge.pong="3";ge.message="4";ge.upgrade="5";ge.noop="6";const xt=Object.create(null);Object.keys(ge).forEach(t=>{xt[ge[t]]=t});const Ts={type:"error",data:"parser error"},qr=typeof Blob=="function"||typeof Blob<"u"&&Object.prototype.toString.call(Blob)==="[object BlobConstructor]",Vr=typeof ArrayBuffer=="function",$r=t=>typeof ArrayBuffer.isView=="function"?ArrayBuffer.isView(t):t&&t.buffer instanceof ArrayBuffer,Cn=({type:t,data:e},n,r)=>qr&&e instanceof Blob?n?r(e):cr(e,r):Vr&&(e instanceof ArrayBuffer||$r(e))?n?r(e):cr(new Blob([e]),r):r(ge[t]+(e||"")),cr=(t,e)=>{const n=new FileReader;return n.onload=function(){const r=n.result.split(",")[1];e("b"+(r||""))},n.readAsDataURL(t)};function ur(t){return t instanceof Uint8Array?t:t instanceof ArrayBuffer?new Uint8Array(t):new Uint8Array(t.buffer,t.byteOffset,t.byteLength)}let Qt;function xs(t,e){if(qr&&t.data instanceof Blob)return t.data.arrayBuffer().then(ur).then(e);if(Vr&&(t.data instanceof ArrayBuffer||$r(t.data)))return e(ur(t.data));Cn(t,!1,n=>{Qt||(Qt=new TextEncoder),e(Qt.encode(n))})}const lr="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",nt=typeof Uint8Array>"u"?[]:new Uint8Array(256);for(let t=0;t<lr.length;t++)nt[lr.charCodeAt(t)]=t;const Ss=t=>{let e=t.length*.75,n=t.length,r,i=0,o,s,a,l;t[t.length-1]==="="&&(e--,t[t.length-2]==="="&&e--);const c=new ArrayBuffer(e),m=new Uint8Array(c);for(r=0;r<n;r+=4)o=nt[t.charCodeAt(r)],s=nt[t.charCodeAt(r+1)],a=nt[t.charCodeAt(r+2)],l=nt[t.charCodeAt(r+3)],m[i++]=o<<2|s>>4,m[i++]=(s&15)<<4|a>>2,m[i++]=(a&3)<<6|l&63;return c},Is=typeof ArrayBuffer=="function",En=(t,e)=>{if(typeof t!="string")return{type:"message",data:jr(t,e)};const n=t.charAt(0);return n==="b"?{type:"message",data:Cs(t.substring(1),e)}:xt[n]?t.length>1?{type:xt[n],data:t.substring(1)}:{type:xt[n]}:Ts},Cs=(t,e)=>{if(Is){const n=Ss(t);return jr(n,e)}else return{base64:!0,data:t}},jr=(t,e)=>{switch(e){case"blob":return t instanceof Blob?t:new Blob([t]);case"arraybuffer":default:return t instanceof ArrayBuffer?t:t.buffer}},Kr=String.fromCharCode(30),Es=(t,e)=>{const n=t.length,r=new Array(n);let i=0;t.forEach((o,s)=>{Cn(o,!1,a=>{r[s]=a,++i===n&&e(r.join(Kr))})})},Os=(t,e)=>{const n=t.split(Kr),r=[];for(let i=0;i<n.length;i++){const o=En(n[i],e);if(r.push(o),o.type==="error")break}return r};let Zt;function As(t,e,n){Zt||(Zt=new TextDecoder);const r=e||t[0]<48||t[0]>54;return En(r?t:Zt.decode(t),n)}const Hr=4;function H(t){if(t)return Ns(t)}function Ns(t){for(var e in H.prototype)t[e]=H.prototype[e];return t}H.prototype.on=H.prototype.addEventListener=function(t,e){return this._callbacks=this._callbacks||{},(this._callbacks["$"+t]=this._callbacks["$"+t]||[]).push(e),this};H.prototype.once=function(t,e){function n(){this.off(t,n),e.apply(this,arguments)}return n.fn=e,this.on(t,n),this};H.prototype.off=H.prototype.removeListener=H.prototype.removeAllListeners=H.prototype.removeEventListener=function(t,e){if(this._callbacks=this._callbacks||{},arguments.length==0)return this._callbacks={},this;var n=this._callbacks["$"+t];if(!n)return this;if(arguments.length==1)return delete this._callbacks["$"+t],this;for(var r,i=0;i<n.length;i++)if(r=n[i],r===e||r.fn===e){n.splice(i,1);break}return n.length===0&&delete this._callbacks["$"+t],this};H.prototype.emit=function(t){this._callbacks=this._callbacks||{};for(var e=new Array(arguments.length-1),n=this._callbacks["$"+t],r=1;r<arguments.length;r++)e[r-1]=arguments[r];if(n){n=n.slice(0);for(var r=0,i=n.length;r<i;++r)n[r].apply(this,e)}return this};H.prototype.emitReserved=H.prototype.emit;H.prototype.listeners=function(t){return this._callbacks=this._callbacks||{},this._callbacks["$"+t]||[]};H.prototype.hasListeners=function(t){return!!this.listeners(t).length};const ie=(()=>typeof self<"u"?self:typeof window<"u"?window:Function("return this")())();function Jr(t,...e){return e.reduce((n,r)=>(t.hasOwnProperty(r)&&(n[r]=t[r]),n),{})}const Bs=ie.setTimeout,Ps=ie.clearTimeout;function Vt(t,e){e.useNativeTimers?(t.setTimeoutFn=Bs.bind(ie),t.clearTimeoutFn=Ps.bind(ie)):(t.setTimeoutFn=ie.setTimeout.bind(ie),t.clearTimeoutFn=ie.clearTimeout.bind(ie))}const Us=1.33;function Fs(t){return typeof t=="string"?Ms(t):Math.ceil((t.byteLength||t.size)*Us)}function Ms(t){let e=0,n=0;for(let r=0,i=t.length;r<i;r++)e=t.charCodeAt(r),e<128?n+=1:e<2048?n+=2:e<55296||e>=57344?n+=3:(r++,n+=4);return n}function Rs(t){let e="";for(let n in t)t.hasOwnProperty(n)&&(e.length&&(e+="&"),e+=encodeURIComponent(n)+"="+encodeURIComponent(t[n]));return e}function Ls(t){let e={},n=t.split("&");for(let r=0,i=n.length;r<i;r++){let o=n[r].split("=");e[decodeURIComponent(o[0])]=decodeURIComponent(o[1])}return e}class Ds extends Error{constructor(e,n,r){super(e),this.description=n,this.context=r,this.type="TransportError"}}class On extends H{constructor(e){super(),this.writable=!1,Vt(this,e),this.opts=e,this.query=e.query,this.socket=e.socket}onError(e,n,r){return super.emitReserved("error",new Ds(e,n,r)),this}open(){return this.readyState="opening",this.doOpen(),this}close(){return(this.readyState==="opening"||this.readyState==="open")&&(this.doClose(),this.onClose()),this}send(e){this.readyState==="open"&&this.write(e)}onOpen(){this.readyState="open",this.writable=!0,super.emitReserved("open")}onData(e){const n=En(e,this.socket.binaryType);this.onPacket(n)}onPacket(e){super.emitReserved("packet",e)}onClose(e){this.readyState="closed",super.emitReserved("close",e)}pause(e){}createUri(e,n={}){return e+"://"+this._hostname()+this._port()+this.opts.path+this._query(n)}_hostname(){const e=this.opts.hostname;return e.indexOf(":")===-1?e:"["+e+"]"}_port(){return this.opts.port&&(this.opts.secure&&+(this.opts.port!==443)||!this.opts.secure&&Number(this.opts.port)!==80)?":"+this.opts.port:""}_query(e){const n=Rs(e);return n.length?"?"+n:""}}const zr="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz-_".split(""),mn=64,qs={};let fr=0,bt=0,hr;function dr(t){let e="";do e=zr[t%mn]+e,t=Math.floor(t/mn);while(t>0);return e}function Wr(){const t=dr(+new Date);return t!==hr?(fr=0,hr=t):t+"."+dr(fr++)}for(;bt<mn;bt++)qs[zr[bt]]=bt;let Gr=!1;try{Gr=typeof XMLHttpRequest<"u"&&"withCredentials"in new XMLHttpRequest}catch{}const Vs=Gr;function Yr(t){const e=t.xdomain;try{if(typeof XMLHttpRequest<"u"&&(!e||Vs))return new XMLHttpRequest}catch{}if(!e)try{return new ie[["Active"].concat("Object").join("X")]("Microsoft.XMLHTTP")}catch{}}function $s(){}const js=function(){return new Yr({xdomain:!1}).responseType!=null}();class Ks extends On{constructor(e){if(super(e),this.polling=!1,typeof location<"u"){const r=location.protocol==="https:";let i=location.port;i||(i=r?"443":"80"),this.xd=typeof location<"u"&&e.hostname!==location.hostname||i!==e.port}const n=e&&e.forceBase64;this.supportsBinary=js&&!n,this.opts.withCredentials&&(this.cookieJar=void 0)}get name(){return"polling"}doOpen(){this.poll()}pause(e){this.readyState="pausing";const n=()=>{this.readyState="paused",e()};if(this.polling||!this.writable){let r=0;this.polling&&(r++,this.once("pollComplete",function(){--r||n()})),this.writable||(r++,this.once("drain",function(){--r||n()}))}else n()}poll(){this.polling=!0,this.doPoll(),this.emitReserved("poll")}onData(e){const n=r=>{if(this.readyState==="opening"&&r.type==="open"&&this.onOpen(),r.type==="close")return this.onClose({description:"transport closed by the server"}),!1;this.onPacket(r)};Os(e,this.socket.binaryType).forEach(n),this.readyState!=="closed"&&(this.polling=!1,this.emitReserved("pollComplete"),this.readyState==="open"&&this.poll())}doClose(){const e=()=>{this.write([{type:"close"}])};this.readyState==="open"?e():this.once("open",e)}write(e){this.writable=!1,Es(e,n=>{this.doWrite(n,()=>{this.writable=!0,this.emitReserved("drain")})})}uri(){const e=this.opts.secure?"https":"http",n=this.query||{};return this.opts.timestampRequests!==!1&&(n[this.opts.timestampParam]=Wr()),!this.supportsBinary&&!n.sid&&(n.b64=1),this.createUri(e,n)}request(e={}){return Object.assign(e,{xd:this.xd,cookieJar:this.cookieJar},this.opts),new ye(this.uri(),e)}doWrite(e,n){const r=this.request({method:"POST",data:e});r.on("success",n),r.on("error",(i,o)=>{this.onError("xhr post error",i,o)})}doPoll(){const e=this.request();e.on("data",this.onData.bind(this)),e.on("error",(n,r)=>{this.onError("xhr poll error",n,r)}),this.pollXhr=e}}class ye extends H{constructor(e,n){super(),Vt(this,n),this.opts=n,this.method=n.method||"GET",this.uri=e,this.data=n.data!==void 0?n.data:null,this.create()}create(){var e;const n=Jr(this.opts,"agent","pfx","key","passphrase","cert","ca","ciphers","rejectUnauthorized","autoUnref");n.xdomain=!!this.opts.xd;const r=this.xhr=new Yr(n);try{r.open(this.method,this.uri,!0);try{if(this.opts.extraHeaders){r.setDisableHeaderCheck&&r.setDisableHeaderCheck(!0);for(let i in this.opts.extraHeaders)this.opts.extraHeaders.hasOwnProperty(i)&&r.setRequestHeader(i,this.opts.extraHeaders[i])}}catch{}if(this.method==="POST")try{r.setRequestHeader("Content-type","text/plain;charset=UTF-8")}catch{}try{r.setRequestHeader("Accept","*/*")}catch{}(e=this.opts.cookieJar)===null||e===void 0||e.addCookies(r),"withCredentials"in r&&(r.withCredentials=this.opts.withCredentials),this.opts.requestTimeout&&(r.timeout=this.opts.requestTimeout),r.onreadystatechange=()=>{var i;r.readyState===3&&((i=this.opts.cookieJar)===null||i===void 0||i.parseCookies(r)),r.readyState===4&&(r.status===200||r.status===1223?this.onLoad():this.setTimeoutFn(()=>{this.onError(typeof r.status=="number"?r.status:0)},0))},r.send(this.data)}catch(i){this.setTimeoutFn(()=>{this.onError(i)},0);return}typeof document<"u"&&(this.index=ye.requestsCount++,ye.requests[this.index]=this)}onError(e){this.emitReserved("error",e,this.xhr),this.cleanup(!0)}cleanup(e){if(!(typeof this.xhr>"u"||this.xhr===null)){if(this.xhr.onreadystatechange=$s,e)try{this.xhr.abort()}catch{}typeof document<"u"&&delete ye.requests[this.index],this.xhr=null}}onLoad(){const e=this.xhr.responseText;e!==null&&(this.emitReserved("data",e),this.emitReserved("success"),this.cleanup())}abort(){this.cleanup()}}ye.requestsCount=0;ye.requests={};if(typeof document<"u"){if(typeof attachEvent=="function")attachEvent("onunload",pr);else if(typeof addEventListener=="function"){const t="onpagehide"in ie?"pagehide":"unload";addEventListener(t,pr,!1)}}function pr(){for(let t in ye.requests)ye.requests.hasOwnProperty(t)&&ye.requests[t].abort()}const An=(()=>typeof Promise=="function"&&typeof Promise.resolve=="function"?e=>Promise.resolve().then(e):(e,n)=>n(e,0))(),vt=ie.WebSocket||ie.MozWebSocket,mr=!0,Hs="arraybuffer",yr=typeof navigator<"u"&&typeof navigator.product=="string"&&navigator.product.toLowerCase()==="reactnative";class Js extends On{constructor(e){super(e),this.supportsBinary=!e.forceBase64}get name(){return"websocket"}doOpen(){if(!this.check())return;const e=this.uri(),n=this.opts.protocols,r=yr?{}:Jr(this.opts,"agent","perMessageDeflate","pfx","key","passphrase","cert","ca","ciphers","rejectUnauthorized","localAddress","protocolVersion","origin","maxPayload","family","checkServerIdentity");this.opts.extraHeaders&&(r.headers=this.opts.extraHeaders);try{this.ws=mr&&!yr?n?new vt(e,n):new vt(e):new vt(e,n,r)}catch(i){return this.emitReserved("error",i)}this.ws.binaryType=this.socket.binaryType||Hs,this.addEventListeners()}addEventListeners(){this.ws.onopen=()=>{this.opts.autoUnref&&this.ws._socket.unref(),this.onOpen()},this.ws.onclose=e=>this.onClose({description:"websocket connection closed",context:e}),this.ws.onmessage=e=>this.onData(e.data),this.ws.onerror=e=>this.onError("websocket error",e)}write(e){this.writable=!1;for(let n=0;n<e.length;n++){const r=e[n],i=n===e.length-1;Cn(r,this.supportsBinary,o=>{const s={};try{mr&&this.ws.send(o)}catch{}i&&An(()=>{this.writable=!0,this.emitReserved("drain")},this.setTimeoutFn)})}}doClose(){typeof this.ws<"u"&&(this.ws.close(),this.ws=null)}uri(){const e=this.opts.secure?"wss":"ws",n=this.query||{};return this.opts.timestampRequests&&(n[this.opts.timestampParam]=Wr()),this.supportsBinary||(n.b64=1),this.createUri(e,n)}check(){return!!vt}}function zs(t,e){return t.type==="message"&&typeof t.data!="string"&&e[0]>=48&&e[0]<=54}class Ws extends On{get name(){return"webtransport"}doOpen(){typeof WebTransport=="function"&&(this.transport=new WebTransport(this.createUri("https"),this.opts.transportOptions[this.name]),this.transport.closed.then(()=>{this.onClose()}).catch(e=>{this.onError("webtransport error",e)}),this.transport.ready.then(()=>{this.transport.createBidirectionalStream().then(e=>{const n=e.readable.getReader();this.writer=e.writable.getWriter();let r;const i=()=>{n.read().then(({done:s,value:a})=>{s||(!r&&a.byteLength===1&&a[0]===54?r=!0:(this.onPacket(As(a,r,"arraybuffer")),r=!1),i())}).catch(s=>{})};i();const o=this.query.sid?`0{"sid":"${this.query.sid}"}`:"0";this.writer.write(new TextEncoder().encode(o)).then(()=>this.onOpen())})}))}write(e){this.writable=!1;for(let n=0;n<e.length;n++){const r=e[n],i=n===e.length-1;xs(r,o=>{zs(r,o)&&this.writer.write(Uint8Array.of(54)),this.writer.write(o).then(()=>{i&&An(()=>{this.writable=!0,this.emitReserved("drain")},this.setTimeoutFn)})})}}doClose(){var e;(e=this.transport)===null||e===void 0||e.close()}}const Gs={websocket:Js,webtransport:Ws,polling:Ks},Ys=/^(?:(?![^:@\/?#]+:[^:@\/]*@)(http|https|ws|wss):\/\/)?((?:(([^:@\/?#]*)(?::([^:@\/?#]*))?)?@)?((?:[a-f0-9]{0,4}:){2,7}[a-f0-9]{0,4}|[^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/,Xs=["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"];function yn(t){const e=t,n=t.indexOf("["),r=t.indexOf("]");n!=-1&&r!=-1&&(t=t.substring(0,n)+t.substring(n,r).replace(/:/g,";")+t.substring(r,t.length));let i=Ys.exec(t||""),o={},s=14;for(;s--;)o[Xs[s]]=i[s]||"";return n!=-1&&r!=-1&&(o.source=e,o.host=o.host.substring(1,o.host.length-1).replace(/;/g,":"),o.authority=o.authority.replace("[","").replace("]","").replace(/;/g,":"),o.ipv6uri=!0),o.pathNames=Qs(o,o.path),o.queryKey=Zs(o,o.query),o}function Qs(t,e){const n=/\/{2,9}/g,r=e.replace(n,"/").split("/");return(e.slice(0,1)=="/"||e.length===0)&&r.splice(0,1),e.slice(-1)=="/"&&r.splice(r.length-1,1),r}function Zs(t,e){const n={};return e.replace(/(?:^|&)([^&=]*)=?([^&]*)/g,function(r,i,o){i&&(n[i]=o)}),n}let Xr=class He extends H{constructor(e,n={}){super(),this.writeBuffer=[],e&&typeof e=="object"&&(n=e,e=null),e?(e=yn(e),n.hostname=e.host,n.secure=e.protocol==="https"||e.protocol==="wss",n.port=e.port,e.query&&(n.query=e.query)):n.host&&(n.hostname=yn(n.host).host),Vt(this,n),this.secure=n.secure!=null?n.secure:typeof location<"u"&&location.protocol==="https:",n.hostname&&!n.port&&(n.port=this.secure?"443":"80"),this.hostname=n.hostname||(typeof location<"u"?location.hostname:"localhost"),this.port=n.port||(typeof location<"u"&&location.port?location.port:this.secure?"443":"80"),this.transports=n.transports||["polling","websocket","webtransport"],this.writeBuffer=[],this.prevBufferLen=0,this.opts=Object.assign({path:"/engine.io",agent:!1,withCredentials:!1,upgrade:!0,timestampParam:"t",rememberUpgrade:!1,addTrailingSlash:!0,rejectUnauthorized:!0,perMessageDeflate:{threshold:1024},transportOptions:{},closeOnBeforeunload:!1},n),this.opts.path=this.opts.path.replace(/\/$/,"")+(this.opts.addTrailingSlash?"/":""),typeof this.opts.query=="string"&&(this.opts.query=Ls(this.opts.query)),this.id=null,this.upgrades=null,this.pingInterval=null,this.pingTimeout=null,this.pingTimeoutTimer=null,typeof addEventListener=="function"&&(this.opts.closeOnBeforeunload&&(this.beforeunloadEventListener=()=>{this.transport&&(this.transport.removeAllListeners(),this.transport.close())},addEventListener("beforeunload",this.beforeunloadEventListener,!1)),this.hostname!=="localhost"&&(this.offlineEventListener=()=>{this.onClose("transport close",{description:"network connection lost"})},addEventListener("offline",this.offlineEventListener,!1))),this.open()}createTransport(e){const n=Object.assign({},this.opts.query);n.EIO=Hr,n.transport=e,this.id&&(n.sid=this.id);const r=Object.assign({},this.opts,{query:n,socket:this,hostname:this.hostname,secure:this.secure,port:this.port},this.opts.transportOptions[e]);return new Gs[e](r)}open(){let e;if(this.opts.rememberUpgrade&&He.priorWebsocketSuccess&&this.transports.indexOf("websocket")!==-1)e="websocket";else if(this.transports.length===0){this.setTimeoutFn(()=>{this.emitReserved("error","No transports available")},0);return}else e=this.transports[0];this.readyState="opening";try{e=this.createTransport(e)}catch{this.transports.shift(),this.open();return}e.open(),this.setTransport(e)}setTransport(e){this.transport&&this.transport.removeAllListeners(),this.transport=e,e.on("drain",this.onDrain.bind(this)).on("packet",this.onPacket.bind(this)).on("error",this.onError.bind(this)).on("close",n=>this.onClose("transport close",n))}probe(e){let n=this.createTransport(e),r=!1;He.priorWebsocketSuccess=!1;const i=()=>{r||(n.send([{type:"ping",data:"probe"}]),n.once("packet",d=>{if(!r)if(d.type==="pong"&&d.data==="probe"){if(this.upgrading=!0,this.emitReserved("upgrading",n),!n)return;He.priorWebsocketSuccess=n.name==="websocket",this.transport.pause(()=>{r||this.readyState!=="closed"&&(m(),this.setTransport(n),n.send([{type:"upgrade"}]),this.emitReserved("upgrade",n),n=null,this.upgrading=!1,this.flush())})}else{const u=new Error("probe error");u.transport=n.name,this.emitReserved("upgradeError",u)}}))};function o(){r||(r=!0,m(),n.close(),n=null)}const s=d=>{const u=new Error("probe error: "+d);u.transport=n.name,o(),this.emitReserved("upgradeError",u)};function a(){s("transport closed")}function l(){s("socket closed")}function c(d){n&&d.name!==n.name&&o()}const m=()=>{n.removeListener("open",i),n.removeListener("error",s),n.removeListener("close",a),this.off("close",l),this.off("upgrading",c)};n.once("open",i),n.once("error",s),n.once("close",a),this.once("close",l),this.once("upgrading",c),this.upgrades.indexOf("webtransport")!==-1&&e!=="webtransport"?this.setTimeoutFn(()=>{r||n.open()},200):n.open()}onOpen(){if(this.readyState="open",He.priorWebsocketSuccess=this.transport.name==="websocket",this.emitReserved("open"),this.flush(),this.readyState==="open"&&this.opts.upgrade){let e=0;const n=this.upgrades.length;for(;e<n;e++)this.probe(this.upgrades[e])}}onPacket(e){if(this.readyState==="opening"||this.readyState==="open"||this.readyState==="closing")switch(this.emitReserved("packet",e),this.emitReserved("heartbeat"),e.type){case"open":this.onHandshake(JSON.parse(e.data));break;case"ping":this.resetPingTimeout(),this.sendPacket("pong"),this.emitReserved("ping"),this.emitReserved("pong");break;case"error":const n=new Error("server error");n.code=e.data,this.onError(n);break;case"message":this.emitReserved("data",e.data),this.emitReserved("message",e.data);break}}onHandshake(e){this.emitReserved("handshake",e),this.id=e.sid,this.transport.query.sid=e.sid,this.upgrades=this.filterUpgrades(e.upgrades),this.pingInterval=e.pingInterval,this.pingTimeout=e.pingTimeout,this.maxPayload=e.maxPayload,this.onOpen(),this.readyState!=="closed"&&this.resetPingTimeout()}resetPingTimeout(){this.clearTimeoutFn(this.pingTimeoutTimer),this.pingTimeoutTimer=this.setTimeoutFn(()=>{this.onClose("ping timeout")},this.pingInterval+this.pingTimeout),this.opts.autoUnref&&this.pingTimeoutTimer.unref()}onDrain(){this.writeBuffer.splice(0,this.prevBufferLen),this.prevBufferLen=0,this.writeBuffer.length===0?this.emitReserved("drain"):this.flush()}flush(){if(this.readyState!=="closed"&&this.transport.writable&&!this.upgrading&&this.writeBuffer.length){const e=this.getWritablePackets();this.transport.send(e),this.prevBufferLen=e.length,this.emitReserved("flush")}}getWritablePackets(){if(!(this.maxPayload&&this.transport.name==="polling"&&this.writeBuffer.length>1))return this.writeBuffer;let n=1;for(let r=0;r<this.writeBuffer.length;r++){const i=this.writeBuffer[r].data;if(i&&(n+=Fs(i)),r>0&&n>this.maxPayload)return this.writeBuffer.slice(0,r);n+=2}return this.writeBuffer}write(e,n,r){return this.sendPacket("message",e,n,r),this}send(e,n,r){return this.sendPacket("message",e,n,r),this}sendPacket(e,n,r,i){if(typeof n=="function"&&(i=n,n=void 0),typeof r=="function"&&(i=r,r=null),this.readyState==="closing"||this.readyState==="closed")return;r=r||{},r.compress=r.compress!==!1;const o={type:e,data:n,options:r};this.emitReserved("packetCreate",o),this.writeBuffer.push(o),i&&this.once("flush",i),this.flush()}close(){const e=()=>{this.onClose("forced close"),this.transport.close()},n=()=>{this.off("upgrade",n),this.off("upgradeError",n),e()},r=()=>{this.once("upgrade",n),this.once("upgradeError",n)};return(this.readyState==="opening"||this.readyState==="open")&&(this.readyState="closing",this.writeBuffer.length?this.once("drain",()=>{this.upgrading?r():e()}):this.upgrading?r():e()),this}onError(e){He.priorWebsocketSuccess=!1,this.emitReserved("error",e),this.onClose("transport error",e)}onClose(e,n){(this.readyState==="opening"||this.readyState==="open"||this.readyState==="closing")&&(this.clearTimeoutFn(this.pingTimeoutTimer),this.transport.removeAllListeners("close"),this.transport.close(),this.transport.removeAllListeners(),typeof removeEventListener=="function"&&(removeEventListener("beforeunload",this.beforeunloadEventListener,!1),removeEventListener("offline",this.offlineEventListener,!1)),this.readyState="closed",this.id=null,this.emitReserved("close",e,n),this.writeBuffer=[],this.prevBufferLen=0)}filterUpgrades(e){const n=[];let r=0;const i=e.length;for(;r<i;r++)~this.transports.indexOf(e[r])&&n.push(e[r]);return n}};Xr.protocol=Hr;function eo(t,e="",n){let r=t;n=n||typeof location<"u"&&location,t==null&&(t=n.protocol+"//"+n.host),typeof t=="string"&&(t.charAt(0)==="/"&&(t.charAt(1)==="/"?t=n.protocol+t:t=n.host+t),/^(https?|wss?):\/\//.test(t)||(typeof n<"u"?t=n.protocol+"//"+t:t="https://"+t),r=yn(t)),r.port||(/^(http|ws)$/.test(r.protocol)?r.port="80":/^(http|ws)s$/.test(r.protocol)&&(r.port="443")),r.path=r.path||"/";const o=r.host.indexOf(":")!==-1?"["+r.host+"]":r.host;return r.id=r.protocol+"://"+o+":"+r.port+e,r.href=r.protocol+"://"+o+(n&&n.port===r.port?"":":"+r.port),r}const to=typeof ArrayBuffer=="function",no=t=>typeof ArrayBuffer.isView=="function"?ArrayBuffer.isView(t):t.buffer instanceof ArrayBuffer,Qr=Object.prototype.toString,ro=typeof Blob=="function"||typeof Blob<"u"&&Qr.call(Blob)==="[object BlobConstructor]",io=typeof File=="function"||typeof File<"u"&&Qr.call(File)==="[object FileConstructor]";function Nn(t){return to&&(t instanceof ArrayBuffer||no(t))||ro&&t instanceof Blob||io&&t instanceof File}function St(t,e){if(!t||typeof t!="object")return!1;if(Array.isArray(t)){for(let n=0,r=t.length;n<r;n++)if(St(t[n]))return!0;return!1}if(Nn(t))return!0;if(t.toJSON&&typeof t.toJSON=="function"&&arguments.length===1)return St(t.toJSON(),!0);for(const n in t)if(Object.prototype.hasOwnProperty.call(t,n)&&St(t[n]))return!0;return!1}function so(t){const e=[],n=t.data,r=t;return r.data=gn(n,e),r.attachments=e.length,{packet:r,buffers:e}}function gn(t,e){if(!t)return t;if(Nn(t)){const n={_placeholder:!0,num:e.length};return e.push(t),n}else if(Array.isArray(t)){const n=new Array(t.length);for(let r=0;r<t.length;r++)n[r]=gn(t[r],e);return n}else if(typeof t=="object"&&!(t instanceof Date)){const n={};for(const r in t)Object.prototype.hasOwnProperty.call(t,r)&&(n[r]=gn(t[r],e));return n}return t}function oo(t,e){return t.data=bn(t.data,e),delete t.attachments,t}function bn(t,e){if(!t)return t;if(t&&t._placeholder===!0){if(typeof t.num=="number"&&t.num>=0&&t.num<e.length)return e[t.num];throw new Error("illegal attachments")}else if(Array.isArray(t))for(let n=0;n<t.length;n++)t[n]=bn(t[n],e);else if(typeof t=="object")for(const n in t)Object.prototype.hasOwnProperty.call(t,n)&&(t[n]=bn(t[n],e));return t}const ao=["connect","connect_error","disconnect","disconnecting","newListener","removeListener"],co=5;var E;(function(t){t[t.CONNECT=0]="CONNECT",t[t.DISCONNECT=1]="DISCONNECT",t[t.EVENT=2]="EVENT",t[t.ACK=3]="ACK",t[t.CONNECT_ERROR=4]="CONNECT_ERROR",t[t.BINARY_EVENT=5]="BINARY_EVENT",t[t.BINARY_ACK=6]="BINARY_ACK"})(E||(E={}));class uo{constructor(e){this.replacer=e}encode(e){return(e.type===E.EVENT||e.type===E.ACK)&&St(e)?this.encodeAsBinary({type:e.type===E.EVENT?E.BINARY_EVENT:E.BINARY_ACK,nsp:e.nsp,data:e.data,id:e.id}):[this.encodeAsString(e)]}encodeAsString(e){let n=""+e.type;return(e.type===E.BINARY_EVENT||e.type===E.BINARY_ACK)&&(n+=e.attachments+"-"),e.nsp&&e.nsp!=="/"&&(n+=e.nsp+","),e.id!=null&&(n+=e.id),e.data!=null&&(n+=JSON.stringify(e.data,this.replacer)),n}encodeAsBinary(e){const n=so(e),r=this.encodeAsString(n.packet),i=n.buffers;return i.unshift(r),i}}function gr(t){return Object.prototype.toString.call(t)==="[object Object]"}class Bn extends H{constructor(e){super(),this.reviver=e}add(e){let n;if(typeof e=="string"){if(this.reconstructor)throw new Error("got plaintext data when reconstructing a packet");n=this.decodeString(e);const r=n.type===E.BINARY_EVENT;r||n.type===E.BINARY_ACK?(n.type=r?E.EVENT:E.ACK,this.reconstructor=new lo(n),n.attachments===0&&super.emitReserved("decoded",n)):super.emitReserved("decoded",n)}else if(Nn(e)||e.base64)if(this.reconstructor)n=this.reconstructor.takeBinaryData(e),n&&(this.reconstructor=null,super.emitReserved("decoded",n));else throw new Error("got binary data when not reconstructing a packet");else throw new Error("Unknown type: "+e)}decodeString(e){let n=0;const r={type:Number(e.charAt(0))};if(E[r.type]===void 0)throw new Error("unknown packet type "+r.type);if(r.type===E.BINARY_EVENT||r.type===E.BINARY_ACK){const o=n+1;for(;e.charAt(++n)!=="-"&&n!=e.length;);const s=e.substring(o,n);if(s!=Number(s)||e.charAt(n)!=="-")throw new Error("Illegal attachments");r.attachments=Number(s)}if(e.charAt(n+1)==="/"){const o=n+1;for(;++n&&!(e.charAt(n)===","||n===e.length););r.nsp=e.substring(o,n)}else r.nsp="/";const i=e.charAt(n+1);if(i!==""&&Number(i)==i){const o=n+1;for(;++n;){const s=e.charAt(n);if(s==null||Number(s)!=s){--n;break}if(n===e.length)break}r.id=Number(e.substring(o,n+1))}if(e.charAt(++n)){const o=this.tryParse(e.substr(n));if(Bn.isPayloadValid(r.type,o))r.data=o;else throw new Error("invalid payload")}return r}tryParse(e){try{return JSON.parse(e,this.reviver)}catch{return!1}}static isPayloadValid(e,n){switch(e){case E.CONNECT:return gr(n);case E.DISCONNECT:return n===void 0;case E.CONNECT_ERROR:return typeof n=="string"||gr(n);case E.EVENT:case E.BINARY_EVENT:return Array.isArray(n)&&(typeof n[0]=="number"||typeof n[0]=="string"&&ao.indexOf(n[0])===-1);case E.ACK:case E.BINARY_ACK:return Array.isArray(n)}}destroy(){this.reconstructor&&(this.reconstructor.finishedReconstruction(),this.reconstructor=null)}}class lo{constructor(e){this.packet=e,this.buffers=[],this.reconPack=e}takeBinaryData(e){if(this.buffers.push(e),this.buffers.length===this.reconPack.attachments){const n=oo(this.reconPack,this.buffers);return this.finishedReconstruction(),n}return null}finishedReconstruction(){this.reconPack=null,this.buffers=[]}}const fo=Object.freeze(Object.defineProperty({__proto__:null,Decoder:Bn,Encoder:uo,get PacketType(){return E},protocol:co},Symbol.toStringTag,{value:"Module"}));function ue(t,e,n){return t.on(e,n),function(){t.off(e,n)}}const ho=Object.freeze({connect:1,connect_error:1,disconnect:1,disconnecting:1,newListener:1,removeListener:1});class Zr extends H{constructor(e,n,r){super(),this.connected=!1,this.recovered=!1,this.receiveBuffer=[],this.sendBuffer=[],this._queue=[],this._queueSeq=0,this.ids=0,this.acks={},this.flags={},this.io=e,this.nsp=n,r&&r.auth&&(this.auth=r.auth),this._opts=Object.assign({},r),this.io._autoConnect&&this.open()}get disconnected(){return!this.connected}subEvents(){if(this.subs)return;const e=this.io;this.subs=[ue(e,"open",this.onopen.bind(this)),ue(e,"packet",this.onpacket.bind(this)),ue(e,"error",this.onerror.bind(this)),ue(e,"close",this.onclose.bind(this))]}get active(){return!!this.subs}connect(){return this.connected?this:(this.subEvents(),this.io._reconnecting||this.io.open(),this.io._readyState==="open"&&this.onopen(),this)}open(){return this.connect()}send(...e){return e.unshift("message"),this.emit.apply(this,e),this}emit(e,...n){if(ho.hasOwnProperty(e))throw new Error('"'+e.toString()+'" is a reserved event name');if(n.unshift(e),this._opts.retries&&!this.flags.fromQueue&&!this.flags.volatile)return this._addToQueue(n),this;const r={type:E.EVENT,data:n};if(r.options={},r.options.compress=this.flags.compress!==!1,typeof n[n.length-1]=="function"){const s=this.ids++,a=n.pop();this._registerAckCallback(s,a),r.id=s}const i=this.io.engine&&this.io.engine.transport&&this.io.engine.transport.writable;return this.flags.volatile&&(!i||!this.connected)||(this.connected?(this.notifyOutgoingListeners(r),this.packet(r)):this.sendBuffer.push(r)),this.flags={},this}_registerAckCallback(e,n){var r;const i=(r=this.flags.timeout)!==null&&r!==void 0?r:this._opts.ackTimeout;if(i===void 0){this.acks[e]=n;return}const o=this.io.setTimeoutFn(()=>{delete this.acks[e];for(let s=0;s<this.sendBuffer.length;s++)this.sendBuffer[s].id===e&&this.sendBuffer.splice(s,1);n.call(this,new Error("operation has timed out"))},i);this.acks[e]=(...s)=>{this.io.clearTimeoutFn(o),n.apply(this,[null,...s])}}emitWithAck(e,...n){const r=this.flags.timeout!==void 0||this._opts.ackTimeout!==void 0;return new Promise((i,o)=>{n.push((s,a)=>r?s?o(s):i(a):i(s)),this.emit(e,...n)})}_addToQueue(e){let n;typeof e[e.length-1]=="function"&&(n=e.pop());const r={id:this._queueSeq++,tryCount:0,pending:!1,args:e,flags:Object.assign({fromQueue:!0},this.flags)};e.push((i,...o)=>r!==this._queue[0]?void 0:(i!==null?r.tryCount>this._opts.retries&&(this._queue.shift(),n&&n(i)):(this._queue.shift(),n&&n(null,...o)),r.pending=!1,this._drainQueue())),this._queue.push(r),this._drainQueue()}_drainQueue(e=!1){if(!this.connected||this._queue.length===0)return;const n=this._queue[0];n.pending&&!e||(n.pending=!0,n.tryCount++,this.flags=n.flags,this.emit.apply(this,n.args))}packet(e){e.nsp=this.nsp,this.io._packet(e)}onopen(){typeof this.auth=="function"?this.auth(e=>{this._sendConnectPacket(e)}):this._sendConnectPacket(this.auth)}_sendConnectPacket(e){this.packet({type:E.CONNECT,data:this._pid?Object.assign({pid:this._pid,offset:this._lastOffset},e):e})}onerror(e){this.connected||this.emitReserved("connect_error",e)}onclose(e,n){this.connected=!1,delete this.id,this.emitReserved("disconnect",e,n)}onpacket(e){if(e.nsp===this.nsp)switch(e.type){case E.CONNECT:e.data&&e.data.sid?this.onconnect(e.data.sid,e.data.pid):this.emitReserved("connect_error",new Error("It seems you are trying to reach a Socket.IO server in v2.x with a v3.x client, but they are not compatible (more information here: https://socket.io/docs/v3/migrating-from-2-x-to-3-0/)"));break;case E.EVENT:case E.BINARY_EVENT:this.onevent(e);break;case E.ACK:case E.BINARY_ACK:this.onack(e);break;case E.DISCONNECT:this.ondisconnect();break;case E.CONNECT_ERROR:this.destroy();const r=new Error(e.data.message);r.data=e.data.data,this.emitReserved("connect_error",r);break}}onevent(e){const n=e.data||[];e.id!=null&&n.push(this.ack(e.id)),this.connected?this.emitEvent(n):this.receiveBuffer.push(Object.freeze(n))}emitEvent(e){if(this._anyListeners&&this._anyListeners.length){const n=this._anyListeners.slice();for(const r of n)r.apply(this,e)}super.emit.apply(this,e),this._pid&&e.length&&typeof e[e.length-1]=="string"&&(this._lastOffset=e[e.length-1])}ack(e){const n=this;let r=!1;return function(...i){r||(r=!0,n.packet({type:E.ACK,id:e,data:i}))}}onack(e){const n=this.acks[e.id];typeof n=="function"&&(n.apply(this,e.data),delete this.acks[e.id])}onconnect(e,n){this.id=e,this.recovered=n&&this._pid===n,this._pid=n,this.connected=!0,this.emitBuffered(),this.emitReserved("connect"),this._drainQueue(!0)}emitBuffered(){this.receiveBuffer.forEach(e=>this.emitEvent(e)),this.receiveBuffer=[],this.sendBuffer.forEach(e=>{this.notifyOutgoingListeners(e),this.packet(e)}),this.sendBuffer=[]}ondisconnect(){this.destroy(),this.onclose("io server disconnect")}destroy(){this.subs&&(this.subs.forEach(e=>e()),this.subs=void 0),this.io._destroy(this)}disconnect(){return this.connected&&this.packet({type:E.DISCONNECT}),this.destroy(),this.connected&&this.onclose("io client disconnect"),this}close(){return this.disconnect()}compress(e){return this.flags.compress=e,this}get volatile(){return this.flags.volatile=!0,this}timeout(e){return this.flags.timeout=e,this}onAny(e){return this._anyListeners=this._anyListeners||[],this._anyListeners.push(e),this}prependAny(e){return this._anyListeners=this._anyListeners||[],this._anyListeners.unshift(e),this}offAny(e){if(!this._anyListeners)return this;if(e){const n=this._anyListeners;for(let r=0;r<n.length;r++)if(e===n[r])return n.splice(r,1),this}else this._anyListeners=[];return this}listenersAny(){return this._anyListeners||[]}onAnyOutgoing(e){return this._anyOutgoingListeners=this._anyOutgoingListeners||[],this._anyOutgoingListeners.push(e),this}prependAnyOutgoing(e){return this._anyOutgoingListeners=this._anyOutgoingListeners||[],this._anyOutgoingListeners.unshift(e),this}offAnyOutgoing(e){if(!this._anyOutgoingListeners)return this;if(e){const n=this._anyOutgoingListeners;for(let r=0;r<n.length;r++)if(e===n[r])return n.splice(r,1),this}else this._anyOutgoingListeners=[];return this}listenersAnyOutgoing(){return this._anyOutgoingListeners||[]}notifyOutgoingListeners(e){if(this._anyOutgoingListeners&&this._anyOutgoingListeners.length){const n=this._anyOutgoingListeners.slice();for(const r of n)r.apply(this,e.data)}}}function Qe(t){t=t||{},this.ms=t.min||100,this.max=t.max||1e4,this.factor=t.factor||2,this.jitter=t.jitter>0&&t.jitter<=1?t.jitter:0,this.attempts=0}Qe.prototype.duration=function(){var t=this.ms*Math.pow(this.factor,this.attempts++);if(this.jitter){var e=Math.random(),n=Math.floor(e*this.jitter*t);t=Math.floor(e*10)&1?t+n:t-n}return Math.min(t,this.max)|0};Qe.prototype.reset=function(){this.attempts=0};Qe.prototype.setMin=function(t){this.ms=t};Qe.prototype.setMax=function(t){this.max=t};Qe.prototype.setJitter=function(t){this.jitter=t};class vn extends H{constructor(e,n){var r;super(),this.nsps={},this.subs=[],e&&typeof e=="object"&&(n=e,e=void 0),n=n||{},n.path=n.path||"/socket.io",this.opts=n,Vt(this,n),this.reconnection(n.reconnection!==!1),this.reconnectionAttempts(n.reconnectionAttempts||1/0),this.reconnectionDelay(n.reconnectionDelay||1e3),this.reconnectionDelayMax(n.reconnectionDelayMax||5e3),this.randomizationFactor((r=n.randomizationFactor)!==null&&r!==void 0?r:.5),this.backoff=new Qe({min:this.reconnectionDelay(),max:this.reconnectionDelayMax(),jitter:this.randomizationFactor()}),this.timeout(n.timeout==null?2e4:n.timeout),this._readyState="closed",this.uri=e;const i=n.parser||fo;this.encoder=new i.Encoder,this.decoder=new i.Decoder,this._autoConnect=n.autoConnect!==!1,this._autoConnect&&this.open()}reconnection(e){return arguments.length?(this._reconnection=!!e,this):this._reconnection}reconnectionAttempts(e){return e===void 0?this._reconnectionAttempts:(this._reconnectionAttempts=e,this)}reconnectionDelay(e){var n;return e===void 0?this._reconnectionDelay:(this._reconnectionDelay=e,(n=this.backoff)===null||n===void 0||n.setMin(e),this)}randomizationFactor(e){var n;return e===void 0?this._randomizationFactor:(this._randomizationFactor=e,(n=this.backoff)===null||n===void 0||n.setJitter(e),this)}reconnectionDelayMax(e){var n;return e===void 0?this._reconnectionDelayMax:(this._reconnectionDelayMax=e,(n=this.backoff)===null||n===void 0||n.setMax(e),this)}timeout(e){return arguments.length?(this._timeout=e,this):this._timeout}maybeReconnectOnOpen(){!this._reconnecting&&this._reconnection&&this.backoff.attempts===0&&this.reconnect()}open(e){if(~this._readyState.indexOf("open"))return this;this.engine=new Xr(this.uri,this.opts);const n=this.engine,r=this;this._readyState="opening",this.skipReconnect=!1;const i=ue(n,"open",function(){r.onopen(),e&&e()}),o=a=>{this.cleanup(),this._readyState="closed",this.emitReserved("error",a),e?e(a):this.maybeReconnectOnOpen()},s=ue(n,"error",o);if(this._timeout!==!1){const a=this._timeout,l=this.setTimeoutFn(()=>{i(),o(new Error("timeout")),n.close()},a);this.opts.autoUnref&&l.unref(),this.subs.push(()=>{this.clearTimeoutFn(l)})}return this.subs.push(i),this.subs.push(s),this}connect(e){return this.open(e)}onopen(){this.cleanup(),this._readyState="open",this.emitReserved("open");const e=this.engine;this.subs.push(ue(e,"ping",this.onping.bind(this)),ue(e,"data",this.ondata.bind(this)),ue(e,"error",this.onerror.bind(this)),ue(e,"close",this.onclose.bind(this)),ue(this.decoder,"decoded",this.ondecoded.bind(this)))}onping(){this.emitReserved("ping")}ondata(e){try{this.decoder.add(e)}catch(n){this.onclose("parse error",n)}}ondecoded(e){An(()=>{this.emitReserved("packet",e)},this.setTimeoutFn)}onerror(e){this.emitReserved("error",e)}socket(e,n){let r=this.nsps[e];return r?this._autoConnect&&!r.active&&r.connect():(r=new Zr(this,e,n),this.nsps[e]=r),r}_destroy(e){const n=Object.keys(this.nsps);for(const r of n)if(this.nsps[r].active)return;this._close()}_packet(e){const n=this.encoder.encode(e);for(let r=0;r<n.length;r++)this.engine.write(n[r],e.options)}cleanup(){this.subs.forEach(e=>e()),this.subs.length=0,this.decoder.destroy()}_close(){this.skipReconnect=!0,this._reconnecting=!1,this.onclose("forced close"),this.engine&&this.engine.close()}disconnect(){return this._close()}onclose(e,n){this.cleanup(),this.backoff.reset(),this._readyState="closed",this.emitReserved("close",e,n),this._reconnection&&!this.skipReconnect&&this.reconnect()}reconnect(){if(this._reconnecting||this.skipReconnect)return this;const e=this;if(this.backoff.attempts>=this._reconnectionAttempts)this.backoff.reset(),this.emitReserved("reconnect_failed"),this._reconnecting=!1;else{const n=this.backoff.duration();this._reconnecting=!0;const r=this.setTimeoutFn(()=>{e.skipReconnect||(this.emitReserved("reconnect_attempt",e.backoff.attempts),!e.skipReconnect&&e.open(i=>{i?(e._reconnecting=!1,e.reconnect(),this.emitReserved("reconnect_error",i)):e.onreconnect()}))},n);this.opts.autoUnref&&r.unref(),this.subs.push(()=>{this.clearTimeoutFn(r)})}}onreconnect(){const e=this.backoff.attempts;this._reconnecting=!1,this.backoff.reset(),this.emitReserved("reconnect",e)}}const et={};function It(t,e){typeof t=="object"&&(e=t,t=void 0),e=e||{};const n=eo(t,e.path||"/socket.io"),r=n.source,i=n.id,o=n.path,s=et[i]&&o in et[i].nsps,a=e.forceNew||e["force new connection"]||e.multiplex===!1||s;let l;return a?l=new vn(r,e):(et[i]||(et[i]=new vn(r,e)),l=et[i]),n.query&&!e.query&&(e.query=n.queryKey),l.socket(n.path,e)}Object.assign(It,{Manager:vn,Socket:Zr,io:It,connect:It});var ei={exports:{}},ti={exports:{}};function po(t){return t>64&&t<91?t-65:t>96&&t<123?t-71:t>47&&t<58?t+4:t===43?62:t===47?63:0}function mo(t,e){for(var n=t.replace(/[^A-Za-z0-9\+\/]/g,""),r=n.length,i=e?Math.ceil((r*3+1>>2)/e)*e:r*3+1>>2,o=new Uint8Array(i),s,a,l=0,c=0,m=0;m<r;m++)if(a=m&3,l|=po(n.charCodeAt(m))<<18-6*a,a===3||r-m===1){for(s=0;s<3&&c<i;s++,c++)o[c]=l>>>(16>>>s&24)&255;l=0}return o}var yo={decode:mo},go=function(t,e){return new Promise(function(n,r){var i=new XMLHttpRequest;e&&(i.responseType=e),i.open("GET",t),i.onload=function(){i.status===200?n(i.response):r(Error(i.statusText))},i.onerror=function(){r(Error("Network Error"))},i.send()})};(function(t){var e=yo,n=go;function r(T){return function(_){return typeof _=="string"&&T.test(_)}}function i(T,_){return typeof T=="string"?T+_:typeof T=="function"?T(_):_}function o(T,_,N,B){var ne=s(_)?a:l(_)?c:m(_)?d:u(_)?f:h(_)?p:y(_)?I:D(_)?M:w(_)?O:null,b=N||{};return ne?ne(T,_,b):B?Promise.resolve(B):Promise.reject("Source not valid ("+_+")")}o.fetch=n;function s(T){return T instanceof ArrayBuffer}function a(T,_,N){return new Promise(function(B,ne){T.decodeAudioData(_,function(b){B(b)},function(){ne("Can't decode audio data ("+_.slice(0,30)+"...)")})})}var l=r(/\.(mp3|wav|ogg)(\?.*)?$/i);function c(T,_,N){var B=i(N.from,_);return o(T,o.fetch(B,"arraybuffer"),N)}function m(T){return T&&typeof T.then=="function"}function d(T,_,N){return _.then(function(B){return o(T,B,N)})}var u=Array.isArray;function f(T,_,N){return Promise.all(_.map(function(B){return o(T,B,N,B)}))}function h(T){return T&&typeof T=="object"}function p(T,_,N){var B={},ne=Object.keys(_).map(function(b){if(N.only&&N.only.indexOf(b)===-1)return null;var S=_[b];return o(T,S,N,S).then(function(F){B[b]=F})});return Promise.all(ne).then(function(){return B})}var y=r(/\.json(\?.*)?$/i);function I(T,_,N){var B=i(N.from,_);return o(T,o.fetch(B,"text").then(JSON.parse),N)}var D=r(/^data:audio/);function M(T,_,N){var B=_.indexOf(",");return o(T,e.decode(_.slice(B+1)).buffer,N)}var w=r(/\.js(\?.*)?$/i);function O(T,_,N){var B=i(N.from,_);return o(T,o.fetch(B,"text").then(j),N)}function j(T){var _=T.indexOf("MIDI.Soundfont.");if(_<0)throw Error("Invalid MIDI.js Soundfont format");_=T.indexOf("=",_)+2;var N=T.lastIndexOf(",");return JSON.parse(T.slice(_,N)+"}")}t.exports&&(t.exports=o),typeof window<"u"&&(window.loadAudio=o)})(ti);var bo=ti.exports,ni={exports:{}},vo=_o;function _o(t){var e=t.createGain(),n=e._voltage=To(t),r=je(n),i=je(n),o=je(n);return e._startAmount=je(i),e._endAmount=je(o),e._multiplier=je(r),e._multiplier.connect(e),e._startAmount.connect(e),e._endAmount.connect(e),e.value=r.gain,e.startValue=i.gain,e.endValue=o.gain,e.startValue.value=0,e.endValue.value=0,Object.defineProperties(e,ko),e}var ko={attack:{value:0,writable:!0},decay:{value:0,writable:!0},sustain:{value:1,writable:!0},release:{value:0,writable:!0},getReleaseDuration:{value:function(){return this.release}},start:{value:function(t){var e=this._multiplier.gain,n=this._startAmount.gain,r=this._endAmount.gain;this._voltage.start(t),this._decayFrom=this._decayFrom=t+this.attack,this._startedAt=t;var i=this.sustain;e.cancelScheduledValues(t),n.cancelScheduledValues(t),r.cancelScheduledValues(t),r.setValueAtTime(0,t),this.attack?(e.setValueAtTime(0,t),e.linearRampToValueAtTime(1,t+this.attack),n.setValueAtTime(1,t),n.linearRampToValueAtTime(0,t+this.attack)):(e.setValueAtTime(1,t),n.setValueAtTime(0,t)),this.decay&&e.setTargetAtTime(i,this._decayFrom,br(this.decay))}},stop:{value:function(t,e){e&&(t=t-this.release);var n=t+this.release;if(this.release){var r=this._multiplier.gain,i=this._startAmount.gain,o=this._endAmount.gain;r.cancelScheduledValues(t),i.cancelScheduledValues(t),o.cancelScheduledValues(t);var s=br(this.release);if(this.attack&&t<this._decayFrom){var a=xo(0,1,this._startedAt,this._decayFrom,t);r.linearRampToValueAtTime(a,t),i.linearRampToValueAtTime(1-a,t),i.setTargetAtTime(0,t,s)}o.setTargetAtTime(1,t,s),r.setTargetAtTime(0,t,s)}return this._voltage.stop(n),n}},onended:{get:function(){return this._voltage.onended},set:function(t){this._voltage.onended=t}}},wo=new Float32Array([1,1]);function To(t){var e=t.createBufferSource(),n=t.createBuffer(1,2,t.sampleRate);return n.getChannelData(0).set(wo),e.buffer=n,e.loop=!0,e}function je(t){var e=t.context.createGain();return t.connect(e),e}function br(t){return Math.log(t+1)/Math.log(100)}function xo(t,e,n,r,i){var o=e-t,s=r-n,a=i-n,l=a/s,c=t+l*o;return c<=t&&(c=t),c>=e&&(c=e),c}var So=vo,Io={},Co={gain:1,attack:.01,decay:.1,sustain:.9,release:.3,loop:!1,cents:0,loopStart:0,loopEnd:0};function Eo(t,e,n){var r=!1,i=0,o={},s=t.createGain();s.gain.value=1;var a=Object.assign({},Co,n),l={context:t,out:s,opts:a};return e instanceof AudioBuffer?l.buffer=e:l.buffers=e,l.start=function(d,u,f){if(l.buffer&&d!==null)return l.start(null,d,u);var h=d?l.buffers[d]:l.buffer;if(h){if(!r){console.warn("SamplePlayer not connected to any node.");return}}else{console.warn("Buffer "+d+" not found.");return}var p=f||Io;u=Math.max(t.currentTime,u||0),l.emit("start",u,d,p);var y=m(d,h,p);return y.id=c(d,y),y.env.start(u),y.source.start(u),l.emit("started",u,y.id,y),p.duration&&y.stop(u+p.duration),y},l.play=function(d,u,f){return l.start(d,u,f)},l.stop=function(d,u){var f;return u=u||Object.keys(o),u.map(function(h){return f=o[h],f?(f.stop(d),f.id):null})},l.connect=function(d){return r=!0,s.connect(d),l},l.emit=function(d,u,f,h){l.onevent&&l.onevent(d,u,f,h);var p=l["on"+d];p&&p(u,f,h)},l;function c(d,u){return u.id=i++,o[u.id]=u,u.source.onended=function(){var f=t.currentTime;u.source.disconnect(),u.env.disconnect(),u.disconnect(),l.emit("ended",f,u.id,u)},u.id}function m(d,u,f){var h=t.createGain();return h.gain.value=0,h.connect(s),h.env=Ao(t,f,a),h.env.connect(h.gain),h.source=t.createBufferSource(),h.source.buffer=u,h.source.connect(h),h.source.loop=f.loop||a.loop,h.source.playbackRate.value=No(f.cents||a.cents),h.source.loopStart=f.loopStart||a.loopStart,h.source.loopEnd=f.loopEnd||a.loopEnd,h.stop=function(p){var y=p||t.currentTime;l.emit("stop",y,d);var I=h.env.stop(y);h.source.stop(I)},h}}function vr(t){return typeof t=="number"}var Oo=["attack","decay","sustain","release"];function Ao(t,e,n){var r=So(t),i=e.adsr||n.adsr;return Oo.forEach(function(o,s){i?r[o]=i[s]:r[o]=e[o]||n[o]}),r.value.value=vr(e.gain)?e.gain:vr(n.gain)?n.gain:1,r}function No(t){return t?Math.pow(2,t/1200):1}var Bo=Eo,Po=function(t){return t.on=function(e,n){if(arguments.length===1&&typeof e=="function")return t.on("event",e);var r="on"+e,i=t[r];return t[r]=i?Uo(i,n):n,t},t};function Uo(t,e){return function(n,r,i,o){t(n,r,i,o),e(n,r,i,o)}}var ri=/^([a-gA-G])(#{1,}|b{1,}|x{1,}|)(-?\d*)\s*(.*)\s*$/;function Fo(){return ri}var Mo=[0,2,4,5,7,9,11];function ii(t,e,n){if(typeof t!="string")return null;var r=ri.exec(t);if(!r||!e&&r[4])return null;var i={letter:r[1].toUpperCase(),acc:r[2].replace(/x/g,"##")};return i.pc=i.letter+i.acc,i.step=(i.letter.charCodeAt(0)+3)%7,i.alt=i.acc[0]==="b"?-i.acc.length:i.acc.length,i.chroma=Mo[i.step]+i.alt,r[3]&&(i.oct=+r[3],i.midi=i.chroma+12*(i.oct+1),i.freq=si(i.midi,n)),e&&(i.tonicOf=r[4]),i}function si(t,e){return Math.pow(2,(t-69)/12)*(e||440)}var oi={parse:ii,regex:Fo,midiToFreq:si},Ro=["letter","acc","pc","step","alt","chroma","oct","midi","freq"];Ro.forEach(function(t){oi[t]=function(e){var n=ii(e);return n&&typeof n[t]<"u"?n[t]:null}});var Lo=oi,Do=Lo,qo=function(t){return t!==null&&t!==[]&&t>=0&&t<129},Vo=function(t){return qo(t)?+t:Do.midi(t)},$o=function(t){if(t.buffers){var e=t.opts.map,n=typeof e=="function"?e:Vo,r=function(o){return o?n(o)||o:null};t.buffers=jo(t.buffers,r);var i=t.start;t.start=function(o,s,a){var l=r(o),c=l%1;return c&&(l=Math.floor(l),a=Object.assign(a||{},{cents:Math.floor(c*100)})),i(l,s,a)}}return t};function jo(t,e){return Object.keys(t).reduce(function(n,r){return n[e(r)]=t[r],n},{})}var Ko=Array.isArray,Ho=function(t){return t&&typeof t=="object"},Jo={},zo=function(t){return t.schedule=function(e,n){var r=t.context.currentTime,i=e<r?r:e;t.emit("schedule",i,n);var o,s,a,l;return n.map(function(c){if(c)Ko(c)?(o=c[0],s=c[1]):(o=c.time,s=c);else return null;return Ho(s)?(a=s.name||s.key||s.note||s.midi||null,l=s):(a=s,l=Jo),t.start(a,i+(o||0),l)})},t};function _t(t){throw new Error('Could not dynamically require "'+t+'". Please configure the dynamicRequireTargets or/and ignoreDynamicRequires option of @rollup/plugin-commonjs appropriately for this require call to work.')}var ai={exports:{}};(function(t,e){(function(n){t.exports=n()})(function(){return function n(r,i,o){function s(c,m){if(!i[c]){if(!r[c]){var d=typeof _t=="function"&&_t;if(!m&&d)return d(c,!0);if(a)return a(c,!0);var u=new Error("Cannot find module '"+c+"'");throw u.code="MODULE_NOT_FOUND",u}var f=i[c]={exports:{}};r[c][0].call(f.exports,function(h){var p=r[c][1][h];return s(p||h)},f,f.exports,n,r,i,o)}return i[c].exports}for(var a=typeof _t=="function"&&_t,l=0;l<o.length;l++)s(o[l]);return s}({1:[function(n,r,i){Object.defineProperty(i,"__esModule",{value:!0}),i.default=function(o){function s(a){if(this._event=a,this._data=a.data,this.receivedTime=a.receivedTime,this._data&&this._data.length<2){console.warn("Illegal MIDI message of length",this._data.length);return}switch(this._messageCode=a.data[0]&240,this.channel=a.data[0]&15,this._messageCode){case 128:this.messageType="noteoff",this.key=a.data[1]&127,this.velocity=a.data[2]&127;break;case 144:this.messageType="noteon",this.key=a.data[1]&127,this.velocity=a.data[2]&127;break;case 160:this.messageType="keypressure",this.key=a.data[1]&127,this.pressure=a.data[2]&127;break;case 176:this.messageType="controlchange",this.controllerNumber=a.data[1]&127,this.controllerValue=a.data[2]&127,this.controllerNumber===120&&this.controllerValue===0?this.channelModeMessage="allsoundoff":this.controllerNumber===121?this.channelModeMessage="resetallcontrollers":this.controllerNumber===122?this.controllerValue===0?this.channelModeMessage="localcontroloff":this.channelModeMessage="localcontrolon":this.controllerNumber===123&&this.controllerValue===0?this.channelModeMessage="allnotesoff":this.controllerNumber===124&&this.controllerValue===0?this.channelModeMessage="omnimodeoff":this.controllerNumber===125&&this.controllerValue===0?this.channelModeMessage="omnimodeon":this.controllerNumber===126?this.channelModeMessage="monomodeon":this.controllerNumber===127&&(this.channelModeMessage="polymodeon");break;case 192:this.messageType="programchange",this.program=a.data[1];break;case 208:this.messageType="channelpressure",this.pressure=a.data[1]&127;break;case 224:this.messageType="pitchbendchange";var l=a.data[2]&127,c=a.data[1]&127;this.pitchBend=(l<<8)+c;break}}return new s(o)},r.exports=i.default},{}]},{},[1])(1)})})(ai);var Wo=ai.exports,Go=Wo,Yo=function(t){return t.listenToMidi=function(e,n){var r={},i=n||{},o=i.gain||function(s){return s/127};return e.onmidimessage=function(s){var a=s.messageType?s:Go(s);if(a.messageType==="noteon"&&a.velocity===0&&(a.messageType="noteoff"),!(i.channel&&a.channel!==i.channel))switch(a.messageType){case"noteon":r[a.key]=t.play(a.key,0,{gain:o(a.velocity)});break;case"noteoff":r[a.key]&&(r[a.key].stop(),delete r[a.key]);break}},t},t};(function(t){var e=Bo,n=Po,r=$o,i=zo,o=Yo;function s(a,l,c){return o(i(r(n(e(a,l,c)))))}t.exports&&(t.exports=s),typeof window<"u"&&(window.SamplePlayer=s)})(ni);var Xo=ni.exports;function _r(t,e){return Array(e+1).join(t)}function Pn(t){return typeof t=="number"}function Qo(t){return typeof t=="string"}function Zo(t){return typeof t<"u"}function ci(t,e){return Math.pow(2,(t-69)/12)*(e||440)}var ui=/^([a-gA-G])(#{1,}|b{1,}|x{1,}|)(-?\d*)\s*(.*)\s*$/;function ea(){return ui}var ta=[0,2,4,5,7,9,11];function Ie(t,e,n){if(typeof t!="string")return null;var r=ui.exec(t);if(!r||!e&&r[4])return null;var i={letter:r[1].toUpperCase(),acc:r[2].replace(/x/g,"##")};i.pc=i.letter+i.acc,i.step=(i.letter.charCodeAt(0)+3)%7,i.alt=i.acc[0]==="b"?-i.acc.length:i.acc.length;var o=ta[i.step]+i.alt;return i.chroma=o<0?12+o:o%12,r[3]&&(i.oct=+r[3],i.midi=o+12*(i.oct+1),i.freq=ci(i.midi,n)),e&&(i.tonicOf=r[4]),i}var na="CDEFGAB";function ra(t){return Pn(t)?t<0?_r("b",-t):_r("#",t):""}function ia(t){return Pn(t)?""+t:""}function li(t,e,n){return t===null||typeof t>"u"?null:t.step?li(t.step,t.alt,t.oct):t<0||t>6?null:na.charAt(t)+ra(e)+ia(n)}function fi(t){if((Pn(t)||Qo(t))&&t>=0&&t<128)return+t;var e=Ie(t);return e&&Zo(e.midi)?e.midi:null}function sa(t,e){var n=fi(t);return n===null?null:ci(n,e)}function oa(t){return(Ie(t)||{}).letter}function aa(t){return(Ie(t)||{}).acc}function ca(t){return(Ie(t)||{}).pc}function ua(t){return(Ie(t)||{}).step}function la(t){return(Ie(t)||{}).alt}function fa(t){return(Ie(t)||{}).chroma}function ha(t){return(Ie(t)||{}).oct}const da=Object.freeze(Object.defineProperty({__proto__:null,acc:aa,alt:la,build:li,chroma:fa,freq:sa,letter:oa,midi:fi,oct:ha,parse:Ie,pc:ca,regex:ea,step:ua},Symbol.toStringTag,{value:"Module"})),pa=Fr(da);var en,kr;function ma(){if(kr)return en;kr=1;var t=pa;function e(i,o){if(console.warn("new Soundfont() is deprected"),console.log("Please use Soundfont.instrument() instead of new Soundfont().instrument()"),!(this instanceof e))return new e(i);this.nameToUrl=o||e.nameToUrl,this.ctx=i,this.instruments={},this.promises=[]}e.prototype.onready=function(i){console.warn("deprecated API"),console.log("Please use Promise.all(Soundfont.instrument(), Soundfont.instrument()).then() instead of new Soundfont().onready()"),Promise.all(this.promises).then(i)},e.prototype.instrument=function(i,o){console.warn("new Soundfont().instrument() is deprecated."),console.log("Please use Soundfont.instrument() instead.");var s=this.ctx;if(i=i||"default",i in this.instruments)return this.instruments[i];var a={name:i,play:r(s,o)};if(this.instruments[i]=a,i!=="default"){var l=e.instrument(s,i,o).then(function(c){return a.play=c.play,a});this.promises.push(l),a.onready=function(c){console.warn("onready is deprecated. Use Soundfont.instrument().then()"),l.then(c)}}else a.onready=function(c){console.warn("onready is deprecated. Use Soundfont.instrument().then()"),c()};return a};function n(i,o,s){return console.warn("Soundfont.loadBuffers is deprecate."),console.log("Use Soundfont.instrument(..) and get buffers properties from the result."),e.instrument(i,o,s).then(function(a){return a.buffers})}e.loadBuffers=n;function r(i,o){return o=o||{},function(s,a,l,c){console.warn("The oscillator player is deprecated."),console.log("Starting with version 0.9.0 you will have to wait until the soundfont is loaded to play sounds.");var m=s>0&&s<129?+s:t.midi(s),d=m?t.midiToFreq(m,440):null;if(d){l=l||.2,c=c||{};var u=c.destination||o.destination||i.destination,f=c.vcoType||o.vcoType||"sine",h=c.gain||o.gain||.4,p=i.createOscillator();p.type=f,p.frequency.value=d;var y=i.createGain();return y.gain.value=h,p.connect(y),y.connect(u),p.start(a),l>0&&p.stop(a+l),p}}}return e.noteToMidi=t.midi,en=e,en}(function(t){var e=bo,n=Xo;function r(a,l,c){if(arguments.length===1)return function(h,p){return r(a,h,p)};var m=c||{},d=m.isSoundfontURL||i,u=m.nameToUrl||o,f=d(l)?l:u(l,m.soundfont,m.format);return e(a,f,{only:m.only||m.notes}).then(function(h){var p=n(a,h,m).connect(m.destination?m.destination:a.destination);return p.url=f,p.name=l,p})}function i(a){return/\.js(\?.*)?$/i.test(a)}function o(a,l,c){return c=c==="ogg"?c:"mp3",l=l==="FluidR3_GM"?l:"MusyngKite","https://gleitz.github.io/midi-js-soundfonts/"+l+"/"+a+"-"+c+".js"}var s=ma();s.instrument=r,s.nameToUrl=o,t.exports&&(t.exports=s),typeof window<"u"&&(window.Soundfont=s)})(ei);var ya=ei.exports;const hi=window.AudioContext||window.webkitAudioContext;hi||alert("Your browser does not seem to support the Web Audio API!");const ga=new hi,tn={};function di(t){return tn[t]||(tn[t]=ya.instrument(ga,t)),tn[t]}const rt=te(!1),Je=te(""),Bt=te("acoustic_grand_piano"),Ye=te(new Map),Pt=te(!1),Se=new Map,$t={audioNodeMap:new Map,colorHue:"220"};Se.set("0",$t);let A,Un,Fn;async function Mn(t,e){let n=await di(t),r=Se.get(e);r&&(r.instrument=n)}function wr({socketID:t,colorHue:e,instrumentName:n}){Se.set(t,{audioNodeMap:t===A.id?$t.audioNodeMap:new Map,colorHue:e}),Ye.set(me(Ye).set(t,e)),n&&Mn(n,t)}function nn(){A.removeAllListeners(),A=null,rt.set(!1),Pt.set(!1),Se.clear(),Se.set("0",$t)}function ba(t,e){Un=t,Fn=e}function rn(t){if(me(rt)||me(Pt))return;if(t.length>100)return Je.set("Room name to long!");const e="https://piano-backend.onrender.com";Je.set(""),rt.set(!0),A=It(e,{query:{roomName:t,instrumentName:me(Bt)},path:{}.VITE_BACKEND_PATH,reconnection:!1}),A.on("connect_error",n=>{nn(),Je.set("Failed to connect to server: "+n.message)}),A.on("error_message",n=>{Je.set(n)}),A.on("connect_timeout",()=>{nn(),Je.set("Timed out while connecting to server!")}),A.on("connect",()=>{rt.set(!1),Pt.set(!0),Se.delete("0"),me(Ye).clear(),history.replaceState({},void 0,`?room=${t}`),document.title=`Room ${t} - Play Piano!`}),A.on("disconnect",()=>{nn(),history.replaceState({},void 0,location.pathname),document.title="Play Piano!"}),A.on("play_note",n=>{Un(n)}),A.on("stop_note",n=>{Fn(n)}),A.on("instrument_change",n=>{const{instrumentName:r,socketID:i}=n;Mn(r,i)}),A.on("client_connect",n=>{wr(n)}),A.on("client_list_recieve",n=>{const r=n;for(let i of r)wr(i)}),A.on("client_disconnect",n=>{const r=me(Ye);r.delete(n),Ye.set(r),Se.delete(n)})}function va(t,e){const n={note:t,volume:e};A&&A.emit("play_note",n),Un({...n,socketID:(A==null?void 0:A.id)??"0"})}function sn(t,e){const n={note:t,sustain:e};A&&A.emit("stop_note",n),Fn({...n,socketID:(A==null?void 0:A.id)??"0"})}Bt.subscribe(t=>{A&&A.emit("instrument_change",{instrumentName:t}),Mn(t,(A==null?void 0:A.id)??"0")});function Tr(t,e,n){const r=t.slice();return r[39]=e[n][0],r[40]=e[n][1],r}function xr(t,e,n){const r=t.slice();return r[43]=e[n],r}function Sr(t){let e,n=t[43]+"",r;return{c(){e=k("option"),r=re(n),e.__value=t[43],K(e,e.__value)},m(i,o){V(i,e,o),g(e,r)},p:U,d(i){i&&L(e)}}}function _a(t){return{c:U,m:U,d:U}}function ka(t){return{c:U,m:U,d:U}}function wa(t){let e;return{c(){e=re("loading...")},m(n,r){V(n,e,r)},d(n){n&&L(e)}}}function Ta(t){let e,n,r;return{c(){e=k("button"),e.textContent="Play"},m(i,o){V(i,e,o),n||(r=C(e,"click",t[27]),n=!0)},p:U,d(i){i&&L(e),n=!1,r()}}}function xa(t){let e,n,r;return{c(){e=k("button"),e.textContent="Pause"},m(i,o){V(i,e,o),n||(r=C(e,"click",t[26]),n=!0)},p:U,d(i){i&&L(e),n=!1,r()}}}function Sa(t){let e,n,r,i;return{c(){e=k("button"),n=re("Join"),e.disabled=t[13]},m(o,s){V(o,e,s),g(e,n),r||(i=C(e,"click",t[37]),r=!0)},p(o,s){s[0]&8192&&(e.disabled=o[13])},d(o){o&&L(e),r=!1,i()}}}function Ia(t){let e,n,r,i,o,s,a,l,c,m,d=Xe(Array.from(t[12].entries())),u=[];for(let f=0;f<d.length;f+=1)u[f]=Cr(Tr(t,d,f));return{c(){e=k("button"),e.textContent="Leave",n=P(),r=k("span"),r.textContent="Connected!",i=k("br"),o=P(),s=k("span"),s.textContent="People:",a=P();for(let f=0;f<u.length;f+=1)u[f].c();l=Pr()},m(f,h){V(f,e,h),V(f,n,h),V(f,r,h),V(f,i,h),V(f,o,h),V(f,s,h),V(f,a,h);for(let p=0;p<u.length;p+=1)u[p]&&u[p].m(f,h);V(f,l,h),c||(m=C(e,"click",t[36]),c=!0)},p(f,h){if(h[0]&4096){d=Xe(Array.from(f[12].entries()));let p;for(p=0;p<d.length;p+=1){const y=Tr(f,d,p);u[p]?u[p].p(y,h):(u[p]=Cr(y),u[p].c(),u[p].m(l.parentNode,l))}for(;p<u.length;p+=1)u[p].d(1);u.length=d.length}},d(f){f&&(L(e),L(n),L(r),L(i),L(o),L(s),L(a),L(l)),wn(u,f),c=!1,m()}}}function Ir(t){let e;return{c(){e=k("span"),e.textContent="(you)",Et(e,"margin-right","0.5rem")},m(n,r){V(n,e,r)},d(n){n&&L(e)}}}function Cr(t){let e,n,r,i,o=t[39]===A.id&&Ir();return{c(){e=k("div"),r=P(),o&&o.c(),i=Pr(),v(e,"class","icon svelte-kmoprw"),v(e,"style",n=`--color-hue: ${t[40]}`)},m(s,a){V(s,e,a),V(s,r,a),o&&o.m(s,a),V(s,i,a)},p(s,a){a[0]&4096&&n!==(n=`--color-hue: ${s[40]}`)&&v(e,"style",n),s[39]===A.id?o||(o=Ir(),o.c(),o.m(i.parentNode,i)):o&&(o.d(1),o=null)},d(s){s&&(L(e),L(r),L(i)),o&&o.d(s)}}}function Ca(t){let e;return{c(){e=k("span"),e.textContent="Connecting..."},m(n,r){V(n,e,r)},p:U,d(n){n&&L(e)}}}function Ea(t){let e,n;return{c(){e=k("span"),n=re(t[14]),v(e,"class","error svelte-kmoprw")},m(r,i){V(r,e,i),g(e,n)},p(r,i){i[0]&16384&&on(n,r[14])},d(r){r&&L(e)}}}function Oa(t){let e,n,r,i,o,s,a,l,c,m,d,u,f,h,p,y,I,D,M,w,O,j,T,_,N,B,ne,b,S,F,z,le,be,ve,_e,ot,fe,Ce,Me,at,Be,ct,ke,Ze,Re,x,R,Rn,se,Ln,we,Dn,qn,Vn,Y,$n,ut=t[8].toFixed(1)+"",jt,jn,lt=t[10].toFixed(1)+"",Kt,Kn,Hn,oe,ft,Jn,he,zn,Ht,Jt,Wn,Le=Xe(ir),X=[];for(let $=0;$<Le.length;$+=1)X[$]=Sr(xr(t,Le,$));let ae={ctx:t,current:null,token:null,hasCatch:!1,pending:wa,then:ka,catch:_a};nr(B=t[2],ae);function Gn($,q){return $[7]?xa:Ta}let ht=Gn(t),de=ht(t);function Yn($,q){return $[11]?Ia:Sa}let dt=Yn(t),pe=dt(t);function Xn($,q){if($[14])return Ea;if($[13])return Ca}let De=Xn(t),ee=De&&De(t);return{c(){e=k("div"),n=k("div"),r=k("div"),i=k("div"),o=k("span"),o.textContent="Sustain:",s=P(),a=k("input"),l=P(),c=k("div"),m=k("span"),m.textContent="Octave Shift:",d=P(),u=k("input"),f=P(),h=k("div"),p=k("span"),p.textContent="Volume:",y=P(),I=k("input"),D=P(),M=k("input"),w=P(),O=k("div"),j=k("span"),j.textContent="Instrument:",T=P(),_=k("select");for(let $=0;$<X.length;$+=1)X[$].c();N=P(),ae.block.c(),ne=P(),b=k("span"),b.textContent="Size:",S=P(),F=k("select"),z=k("option"),z.textContent="Full size (88 keys)",le=k("option"),le.textContent="Half size (61 keys)",be=k("option"),be.textContent="Quater Size (37 keys)",ve=k("option"),ve.textContent="2 Octaves (24 keys)",_e=k("option"),_e.textContent="1 Octave (12 keys)",ot=P(),fe=k("div"),Ce=k("div"),Me=k("p"),Me.textContent="Play a midi:",at=P(),Be=k("input"),ct=P(),ke=k("div"),de.c(),Ze=P(),Re=k("button"),Re.textContent="Restart",x=P(),R=k("div"),Rn=re("Speed:"),se=k("input"),Ln=P(),we=k("input"),Dn=re("times"),qn=k("br"),Vn=P(),Y=k("input"),$n=P(),jt=re(ut),jn=re("/"),Kt=re(lt),Kn=re(" seconds"),Hn=P(),oe=k("div"),ft=k("p"),ft.textContent="Join a room:",Jn=P(),he=k("input"),zn=P(),pe.c(),Ht=P(),ee&&ee.c(),v(a,"type","checkbox"),v(a,"class","svelte-kmoprw"),v(i,"title","Shortcut: space"),v(i,"class","svelte-kmoprw"),v(u,"type","number"),v(u,"min","-3"),v(u,"max","3"),v(u,"class","svelte-kmoprw"),v(c,"title","Shortcut: left ctrl +, left alt or right ctrl -"),v(c,"class","svelte-kmoprw"),v(I,"type","range"),v(I,"min","0"),v(I,"max","10"),v(I,"step","0.1"),v(I,"class","svelte-kmoprw"),v(M,"type","number"),v(M,"class","svelte-kmoprw"),v(h,"class","svelte-kmoprw"),t[0]===void 0&&Ot(()=>t[23].call(_)),v(O,"class","svelte-kmoprw"),v(z,"data-range","A0,C8"),z.__value="Full size (88 keys)",K(z,z.__value),v(le,"data-range","C2,C7"),le.selected=!0,le.__value="Half size (61 keys)",K(le,le.__value),v(be,"data-range","C3,C6"),be.__value="Quater Size (37 keys)",K(be,be.__value),v(ve,"data-range","C4,B5"),ve.__value="2 Octaves (24 keys)",K(ve,ve.__value),v(_e,"data-range","C4,B4"),_e.__value="1 Octave (12 keys)",K(_e,_e.__value),v(r,"class","svelte-kmoprw"),v(Me,"class","svelte-kmoprw"),v(Be,"type","file"),v(Be,"class","svelte-kmoprw"),v(Ce,"class","svelte-kmoprw"),v(ke,"class","svelte-kmoprw"),v(se,"type","range"),v(se,"min","0.01"),v(se,"max","4"),v(se,"step","0.01"),v(se,"class","svelte-kmoprw"),v(we,"type","number"),v(we,"min","0.01"),v(we,"class","svelte-kmoprw"),v(Y,"type","range"),v(Y,"min","0"),v(Y,"max",t[10]),v(Y,"step","0.1"),Et(Y,"width","18rem"),v(Y,"class","svelte-kmoprw"),v(R,"class","svelte-kmoprw"),v(fe,"class","svelte-kmoprw"),v(n,"class","row svelte-kmoprw"),v(ft,"class","svelte-kmoprw"),v(he,"type","text"),v(he,"placeholder","Room name"),v(he,"class","svelte-kmoprw"),v(e,"class","control-panel svelte-kmoprw")},m($,q){V($,e,q),g(e,n),g(n,r),g(r,i),g(i,o),g(i,s),g(i,a),a.checked=t[3],g(r,l),g(r,c),g(c,m),g(c,d),g(c,u),K(u,t[4]),g(r,f),g(r,h),g(h,p),g(h,y),g(h,I),K(I,t[5]),g(h,D),g(h,M),K(M,t[5]),g(r,w),g(r,O),g(O,j),g(O,T),g(O,_);for(let W=0;W<X.length;W+=1)X[W]&&X[W].m(_,null);er(_,t[0],!0),g(O,N),ae.block.m(O,ae.anchor=null),ae.mount=()=>O,ae.anchor=null,g(r,ne),g(r,b),g(r,S),g(r,F),g(F,z),g(F,le),g(F,be),g(F,ve),g(F,_e),g(n,ot),g(n,fe),g(fe,Ce),g(Ce,Me),g(Ce,at),g(Ce,Be),g(fe,ct),g(fe,ke),de.m(ke,null),g(ke,Ze),g(ke,Re),g(fe,x),g(fe,R),g(R,Rn),g(R,se),K(se,t[9]),g(R,Ln),g(R,we),K(we,t[9]),g(R,Dn),g(R,qn),g(R,Vn),g(R,Y),K(Y,t[8]),g(R,$n),g(R,jt),g(R,jn),g(R,Kt),g(R,Kn),g(e,Hn),g(e,oe),g(oe,ft),g(oe,Jn),g(oe,he),K(he,t[1]),g(oe,zn),pe.m(oe,null),g(oe,Ht),ee&&ee.m(oe,null),Jt||(Wn=[C(window,"keydown",t[17]),C(window,"keyup",t[18]),C(window,"load",t[15]),C(a,"change",t[19]),C(u,"input",t[20]),C(I,"change",t[21]),C(I,"input",t[21]),C(M,"input",t[22]),C(_,"change",t[23]),C(F,"change",t[24]),bi(t[16].call(null,F)),C(Be,"change",t[25]),C(Re,"click",t[28]),C(se,"change",t[29]),C(se,"input",t[29]),C(we,"input",t[30]),C(Y,"change",t[31]),C(Y,"input",t[31]),C(Y,"mousedown",t[32]),C(Y,"mouseup",t[33]),C(he,"input",t[34]),C(he,"keydown",t[35])],Jt=!0)},p($,q){if(t=$,q[0]&8&&(a.checked=t[3]),q[0]&16&&Te(u.value)!==t[4]&&K(u,t[4]),q[0]&32&&K(I,t[5]),q[0]&32&&Te(M.value)!==t[5]&&K(M,t[5]),q&0){Le=Xe(ir);let W;for(W=0;W<Le.length;W+=1){const Qn=xr(t,Le,W);X[W]?X[W].p(Qn,q):(X[W]=Sr(Qn),X[W].c(),X[W].m(_,null))}for(;W<X.length;W+=1)X[W].d(1);X.length=Le.length}q[0]&1&&er(_,t[0]),ae.ctx=t,q[0]&4&&B!==(B=t[2])&&nr(B,ae),ht===(ht=Gn(t))&&de?de.p(t,q):(de.d(1),de=ht(t),de&&(de.c(),de.m(ke,Ze))),q[0]&512&&K(se,t[9]),q[0]&512&&Te(we.value)!==t[9]&&K(we,t[9]),q[0]&1024&&v(Y,"max",t[10]),q[0]&256&&K(Y,t[8]),q[0]&256&&ut!==(ut=t[8].toFixed(1)+"")&&on(jt,ut),q[0]&1024&&lt!==(lt=t[10].toFixed(1)+"")&&on(Kt,lt),q[0]&2&&he.value!==t[1]&&K(he,t[1]),dt===(dt=Yn(t))&&pe?pe.p(t,q):(pe.d(1),pe=dt(t),pe&&(pe.c(),pe.m(oe,Ht))),De===(De=Xn(t))&&ee?ee.p(t,q):(ee&&ee.d(1),ee=De&&De(t),ee&&(ee.c(),ee.m(oe,null)))},i:U,o:U,d($){$&&L(e),wn(X,$),ae.block.d(),ae.token=null,ae=null,de.d(),pe.d(),ee&&ee.d(),Jt=!1,Ne(Wn)}}}const Oe=te(0),We=te(!1),Ct=te(5),_n=te(["C0","C0"]);function Aa(t,e,n){let r,i,o=U,s,a=U,l,c=U,m,d,u=U,f,h,p,y,I,D,M,w,O;G(t,We,x=>n(3,i=x)),G(t,Oe,x=>n(4,s=x)),G(t,_n,x=>n(38,l=x)),G(t,Bt,x=>n(0,m=x)),G(t,Ct,x=>n(5,d=x)),G(t,pn,x=>n(6,f=x)),G(t,ce,x=>n(7,h=x)),G(t,Ue,x=>n(8,p=x)),G(t,Tt,x=>n(9,y=x)),G(t,wt,x=>n(10,I=x)),G(t,Pt,x=>n(11,D=x)),G(t,Ye,x=>n(12,M=x)),G(t,rt,x=>n(13,w=x)),G(t,Je,x=>n(14,O=x)),t.$$.on_destroy.push(()=>o()),t.$$.on_destroy.push(()=>a()),t.$$.on_destroy.push(()=>c()),t.$$.on_destroy.push(()=>u());let j="";function T(){const R=new URLSearchParams(location.search).get("room");R!=null&&(n(1,j=R),rn(j))}function _(x){const R=x.children[x.selectedIndex];Q(_n,l=R.dataset.range.split(","),l)}function N(x){x.code==="Space"&&Q(We,i=!0,i),x.code==="ControlLeft"?Q(Oe,s-=1,s):(x.code==="AltLeft"||x.code=="ControlRight")&&Q(Oe,s+=1,s),s<-3?Q(Oe,s=3,s):s>3&&Q(Oe,s=-3,s)}function B(x){x.code==="Space"&&Q(We,i=!1,i)}function ne(){i=this.checked,We.set(i)}function b(){s=Te(this.value),Oe.set(s)}function S(){d=Te(this.value),Ct.set(d)}function F(){d=Te(this.value),Ct.set(d)}function z(){m=ki(this),Bt.set(m)}const le=x=>_(x.currentTarget),be=x=>{var R;return Q(pn,f=(R=x.currentTarget.files)==null?void 0:R[0],f)},ve=()=>Q(ce,h=!1,h),_e=()=>Q(ce,h=!0,h),ot=()=>{Q(ce,h=!1,h),Q(Ue,p=0,p),setTimeout(()=>Q(ce,h=!0,h),100)};function fe(){y=Te(this.value),Tt.set(y)}function Ce(){y=Te(this.value),Tt.set(y)}function Me(){p=Te(this.value),Ue.set(p)}const at=()=>Q(ce,h=!1,h),Be=()=>Q(ce,h=!0,h);function ct(){j=this.value,n(1,j)}const ke=x=>{x.code==="Enter"&&rn(j)},Ze=()=>A.disconnect(),Re=()=>rn(j);return t.$$.update=()=>{t.$$.dirty[0]&1&&n(2,r=di(m))},[m,j,r,i,s,d,f,h,p,y,I,D,M,w,O,T,_,N,B,ne,b,S,F,z,le,be,ve,_e,ot,fe,Ce,Me,at,Be,ct,ke,Ze,Re]}class Na extends Sn{constructor(e){super(),xn(this,e,Aa,Oa,Ut,{},null,[-1,-1])}}function Er(t,e,n){const r=t.slice();return r[25]=e[n][0],r[26]=e[n][1].isWhite,r[27]=e[n][1].pressedColor,r[28]=e[n][1].isGhost,r}function Or(t){let e,n,r,i;function o(...c){return t[13](t[25],...c)}function s(){return t[14](t[25])}function a(){return t[15](t[25])}function l(){return t[16](t[25])}return{c(){e=k("div"),v(e,"class",n="key "+(t[26]?"white":"black")+" svelte-rsi44m"),Et(e,"--color-hue",t[27]),pt(e,"pressed",t[27]!==null),pt(e,"ghost",t[28]&&t[27]===null)},m(c,m){V(c,e,m),r||(i=[C(e,"pointerdown",o),C(e,"pointerenter",s),C(e,"pointerleave",a),C(e,"pointerup",l)],r=!0)},p(c,m){t=c,m&2&&n!==(n="key "+(t[26]?"white":"black")+" svelte-rsi44m")&&v(e,"class",n),m&2&&Et(e,"--color-hue",t[27]),m&2&&pt(e,"pressed",t[27]!==null),m&2&&pt(e,"ghost",t[28]&&t[27]===null)},d(c){c&&L(e),r=!1,Ne(i)}}}function Ba(t){let e,n,r,i,o=Xe(Object.entries(t[1])),s=[];for(let a=0;a<o.length;a+=1)s[a]=Or(Er(t,o,a));return{c(){e=k("div"),n=k("div");for(let a=0;a<s.length;a+=1)s[a].c();v(n,"class","piano svelte-rsi44m"),v(e,"class","piano-container svelte-rsi44m")},m(a,l){V(a,e,l),g(e,n);for(let c=0;c<s.length;c+=1)s[c]&&s[c].m(n,null);t[17](e),r||(i=[C(window,"resize",t[10]),C(window,"keyup",t[7]),C(window,"keydown",t[6]),C(window,"pointerdown",t[11]),C(window,"pointerup",t[12]),C(n,"touchstart",vi(t[9]))],r=!0)},p(a,[l]){if(l&27){o=Xe(Object.entries(a[1]));let c;for(c=0;c<o.length;c+=1){const m=Er(a,o,c);s[c]?s[c].p(m,l):(s[c]=Or(m),s[c].c(),s[c].m(n,null))}for(;c<s.length;c+=1)s[c].d(1);s.length=o.length}},i:U,o:U,d(a){a&&L(e),wn(s,a),t[17](null),r=!1,Ne(i)}}}function Ar(t,e){e.get(t)&&(e.get(t).stop(),e.delete(t))}function Pa(t,e,n){let r,i,o;G(t,We,b=>n(18,r=b)),G(t,Ct,b=>n(19,i=b)),G(t,Oe,b=>n(20,o=b));let s=!1,a,l,c,m=new Map;_n.subscribe(b=>{const S=vs(b[0],b[1]);n(1,a=S.noteMap),n(8,l=S.whiteKeys)}),ba(h,p);function d(b){const S=hn(b)+o;return dn(b)+S}function u(b,S){const F=d(b);m.get(F)||(a[b]&&n(1,a[b].isGhost=!0,a),m.set(F,!0),va(F,i*S))}function f(b){const S=d(b);a[b]&&n(1,a[b].isGhost=!1,a),m.get(S)&&(m.delete(S),sn(S,r))}function h({socketID:b,note:S,volume:F}){const z=Se.get(b);a[S]&&n(1,a[S].pressedColor=z.colorHue,a),z.instrument&&(Ar(S,z.audioNodeMap),z.audioNodeMap.set(S,z.instrument.play(S,void 0,{gain:F})))}function p({socketID:b,note:S,sustain:F}){const z=Se.get(b);a[S]&&n(1,a[S].pressedColor=null,a),F||Ar(S,z.audioNodeMap)}_s(u,f),We.subscribe(b=>{if(!b)for(const S of $t.audioNodeMap.keys())m.get(S)||sn(S,!1)}),Oe.subscribe(()=>{for(const b of m.keys())sn(b,r)});function y(b=l){if(!c)return;const S=c.clientHeight/6,F=c.offsetWidth/b;c.style.setProperty("--white-key-width",`${Math.min(F,S)}px`)}wi(()=>{y()});function I(b){const S=ar[b.code],F=b.target;S&&F.tagName!=="INPUT"&&(b.preventDefault(),u(S,.5))}function D(b){const S=ar[b.code];S&&f(S)}function M(b){Ti.call(this,t,b)}const w=()=>y(),O=()=>n(0,s=!0),j=()=>n(0,s=!1),T=(b,S)=>{S.currentTarget.releasePointerCapture(S.pointerId),u(b,.5)},_=b=>{s&&u(b,.5)},N=b=>f(b),B=b=>f(b);function ne(b){an[b?"unshift":"push"](()=>{c=b,n(2,c)})}return t.$$.update=()=>{t.$$.dirty&256&&y(l)},[s,a,c,u,f,y,I,D,l,M,w,O,j,T,_,N,B,ne]}class Ua extends Sn{constructor(e){super(),xn(this,e,Pa,Ba,Ut,{})}}function Fa(t){let e,n,r,i,o;return n=new Na({}),i=new Ua({}),{c(){e=k("main"),rr(n.$$.fragment),r=P(),rr(i.$$.fragment),v(e,"class","svelte-ieeeet")},m(s,a){V(s,e,a),ln(n,e,null),g(e,r),ln(i,e,null),o=!0},p:U,i(s){o||(At(n.$$.fragment,s),At(i.$$.fragment,s),o=!0)},o(s){un(n.$$.fragment,s),un(i.$$.fragment,s),o=!1},d(s){s&&L(e),fn(n),fn(i)}}}class Ma extends Sn{constructor(e){super(),xn(this,e,null,Fa,Ut,{})}}new Ma({target:document.body});

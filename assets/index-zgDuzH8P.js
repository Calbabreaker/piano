var Yn=Object.defineProperty;var Qn=(t,e,n)=>e in t?Yn(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n;var A=(t,e,n)=>Qn(t,typeof e!="symbol"?e+"":e,n);(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))r(i);new MutationObserver(i=>{for(const o of i)if(o.type==="childList")for(const s of o.addedNodes)s.tagName==="LINK"&&s.rel==="modulepreload"&&r(s)}).observe(document,{childList:!0,subtree:!0});function n(i){const o={};return i.integrity&&(o.integrity=i.integrity),i.referrerPolicy&&(o.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?o.credentials="include":i.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function r(i){if(i.ep)return;i.ep=!0;const o=n(i);fetch(i.href,o)}})();function q(){}function Zn(t){return!!t&&(typeof t=="object"||typeof t=="function")&&typeof t.then=="function"}function Pn(t){return t()}function en(){return Object.create(null)}function be(t){t.forEach(Pn)}function En(t){return typeof t=="function"}function He(t,e){return t!=t?e==e:t!==e||t&&typeof t=="object"||typeof t=="function"}let yt;function Mn(t,e){return t===e?!0:(yt||(yt=document.createElement("a")),yt.href=e,t===yt.href)}function $n(t){return Object.keys(t).length===0}function An(t,...e){if(t==null){for(const r of e)r(void 0);return q}const n=t.subscribe(...e);return n.unsubscribe?()=>n.unsubscribe():n}function re(t){let e;return An(t,n=>e=n)(),e}function Y(t,e,n){t.$$.on_destroy.push(An(e,n))}function ue(t,e,n){return t.set(n),e}function v(t,e){t.appendChild(e)}function O(t,e,n){t.insertBefore(e,n||null)}function F(t){t.parentNode&&t.parentNode.removeChild(t)}function ht(t,e){for(let n=0;n<t.length;n+=1)t[n]&&t[n].d(e)}function b(t){return document.createElement(t)}function ie(t){return document.createTextNode(t)}function D(){return ie(" ")}function Dn(){return ie("")}function P(t,e,n,r){return t.addEventListener(e,n,r),()=>t.removeEventListener(e,n,r)}function jn(t){return function(e){return e.preventDefault(),t.call(this,e)}}function w(t,e,n){n==null?t.removeAttribute(e):t.getAttribute(e)!==n&&t.setAttribute(e,n)}function Ue(t){return t===""?null:+t}function er(t){return Array.from(t.childNodes)}function ze(t,e){e=""+e,t.data!==e&&(t.data=e)}function $(t,e){t.value=e??""}function Oe(t,e,n,r){n==null?t.style.removeProperty(e):t.style.setProperty(e,n,"")}function Pe(t,e,n){for(let r=0;r<t.options.length;r+=1){const i=t.options[r];if(i.__value===e){i.selected=!0;return}}(!n||e!==void 0)&&(t.selectedIndex=-1)}function kt(t){const e=t.querySelector(":checked");return e&&e.__value}function tn(t,e,n){t.classList.toggle(e,!!n)}let dt;function Te(t){dt=t}function Nn(){if(!dt)throw new Error("Function called outside component initialization");return dt}function Fn(t){Nn().$$.on_mount.push(t)}function tr(t,e){const n=t.$$.callbacks[e.type];n&&n.slice().forEach(r=>r.call(this,e))}const Ge=[],Gt=[];let Ze=[];const nn=[],nr=Promise.resolve();let qt=!1;function rr(){qt||(qt=!0,nr.then(Qt))}function Be(t){Ze.push(t)}const Lt=new Set;let Ve=0;function Qt(){if(Ve!==0)return;const t=dt;do{try{for(;Ve<Ge.length;){const e=Ge[Ve];Ve++,Te(e),ir(e.$$)}}catch(e){throw Ge.length=0,Ve=0,e}for(Te(null),Ge.length=0,Ve=0;Gt.length;)Gt.pop()();for(let e=0;e<Ze.length;e+=1){const n=Ze[e];Lt.has(n)||(Lt.add(n),n())}Ze.length=0}while(Ge.length);for(;nn.length;)nn.pop()();qt=!1,Lt.clear(),Te(t)}function ir(t){if(t.fragment!==null){t.update(),be(t.before_update);const e=t.dirty;t.dirty=[-1],t.fragment&&t.fragment.p(t.ctx,e),t.after_update.forEach(Be)}}function sr(t){const e=[],n=[];Ze.forEach(r=>t.indexOf(r)===-1?e.push(r):n.push(r)),n.forEach(r=>r()),Ze=e}const xt=new Set;let Fe;function or(){Fe={r:0,c:[],p:Fe}}function ar(){Fe.r||be(Fe.c),Fe=Fe.p}function Le(t,e){t&&t.i&&(xt.delete(t),t.i(e))}function $e(t,e,n,r){if(t&&t.o){if(xt.has(t))return;xt.add(t),Fe.c.push(()=>{xt.delete(t),r&&(n&&t.d(1),r())}),t.o(e)}else r&&r()}function rn(t,e){const n=e.token={};function r(i,o,s,c){if(e.token!==n)return;e.resolved=c;let u=e.ctx;s!==void 0&&(u=u.slice(),u[s]=c);const a=i&&(e.current=i)(u);let p=!1;e.block&&(e.blocks?e.blocks.forEach((h,l)=>{l!==o&&h&&(or(),$e(h,1,1,()=>{e.blocks[l]===h&&(e.blocks[l]=null)}),ar())}):e.block.d(1),a.c(),Le(a,1),a.m(e.mount(),e.anchor),p=!0),e.block=a,e.blocks&&(e.blocks[o]=a),p&&Qt()}if(Zn(t)){const i=Nn();if(t.then(o=>{Te(i),r(e.then,1,e.value,o),Te(null)},o=>{if(Te(i),r(e.catch,2,e.error,o),Te(null),!e.hasCatch)throw o}),e.current!==e.pending)return r(e.pending,0),!0}else{if(e.current!==e.then)return r(e.then,1,e.value,t),!0;e.resolved=t}}function ke(t){return(t==null?void 0:t.length)!==void 0?t:Array.from(t)}function ft(t){t&&t.c()}function je(t,e,n){const{fragment:r,after_update:i}=t.$$;r&&r.m(e,n),Be(()=>{const o=t.$$.on_mount.map(Pn).filter(En);t.$$.on_destroy?t.$$.on_destroy.push(...o):be(o),t.$$.on_mount=[]}),i.forEach(Be)}function et(t,e){const n=t.$$;n.fragment!==null&&(sr(n.after_update),be(n.on_destroy),n.fragment&&n.fragment.d(e),n.on_destroy=n.fragment=null,n.ctx=[])}function cr(t,e){t.$$.dirty[0]===-1&&(Ge.push(t),rr(),t.$$.dirty.fill(0)),t.$$.dirty[e/31|0]|=1<<e%31}function nt(t,e,n,r,i,o,s=null,c=[-1]){const u=dt;Te(t);const a=t.$$={fragment:null,ctx:[],props:o,update:q,not_equal:i,bound:en(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(e.context||(u?u.$$.context:[])),callbacks:en(),dirty:c,skip_bound:!1,root:e.target||u.$$.root};s&&s(a.root);let p=!1;if(a.ctx=n?n(t,e.props||{},(h,l,...f)=>{const d=f.length?f[0]:l;return a.ctx&&i(a.ctx[h],a.ctx[h]=d)&&(!a.skip_bound&&a.bound[h]&&a.bound[h](d),p&&cr(t,h)),l}):[],a.update(),p=!0,be(a.before_update),a.fragment=r?r(a.ctx):!1,e.target){if(e.hydrate){const h=er(e.target);a.fragment&&a.fragment.l(h),h.forEach(F)}else a.fragment&&a.fragment.c();e.intro&&Le(t.$$.fragment),je(t,e.target,e.anchor),Qt()}Te(u)}class rt{constructor(){A(this,"$$");A(this,"$$set")}$destroy(){et(this,1),this.$destroy=q}$on(e,n){if(!En(n))return q;const r=this.$$.callbacks[e]||(this.$$.callbacks[e]=[]);return r.push(n),()=>{const i=r.indexOf(n);i!==-1&&r.splice(i,1)}}$set(e){this.$$set&&!$n(e)&&(this.$$.skip_bound=!0,this.$$set(e),this.$$.skip_bound=!1)}}const lr="4";typeof window<"u"&&(window.__svelte||(window.__svelte={v:new Set})).v.add(lr);var Ye=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function ur(t){if(t.__esModule)return t;var e=t.default;if(typeof e=="function"){var n=function r(){return this instanceof r?Reflect.construct(e,arguments,this.constructor):e.apply(this,arguments)};n.prototype=e.prototype}else n={};return Object.defineProperty(n,"__esModule",{value:!0}),Object.keys(t).forEach(function(r){var i=Object.getOwnPropertyDescriptor(t,r);Object.defineProperty(n,r,i.get?i:{enumerable:!0,get:function(){return t[r]}})}),n}var Jt={},At={};function fr(t){var e=new ye(t),n=e.readChunk();if(n.id!="MThd")throw"Bad MIDI file.  Expected 'MHdr', got: '"+n.id+"'";for(var r=hr(n.data),i=[],o=0;!e.eof()&&o<r.numTracks;o++){var s=e.readChunk();if(s.id!="MTrk")throw"Bad MIDI file.  Expected 'MTrk', got: '"+s.id+"'";var c=dr(s.data);i.push(c)}return{header:r,tracks:i}}function hr(t){var e=new ye(t),n=e.readUInt16(),r=e.readUInt16(),i={format:n,numTracks:r},o=e.readUInt16();return o&32768?(i.framesPerSecond=256-(o>>8),i.ticksPerFrame=o&255):i.ticksPerBeat=o,i}function dr(t){for(var e=new ye(t),n=[];!e.eof();){var r=o();n.push(r)}return n;var i;function o(){var s={};s.deltaTime=e.readVarInt();var c=e.readUInt8();if((c&240)===240)if(c===255){s.meta=!0;var u=e.readUInt8(),a=e.readVarInt();switch(u){case 0:if(s.type="sequenceNumber",a!==2)throw"Expected length for sequenceNumber event is 2, got "+a;return s.number=e.readUInt16(),s;case 1:return s.type="text",s.text=e.readString(a),s;case 2:return s.type="copyrightNotice",s.text=e.readString(a),s;case 3:return s.type="trackName",s.text=e.readString(a),s;case 4:return s.type="instrumentName",s.text=e.readString(a),s;case 5:return s.type="lyrics",s.text=e.readString(a),s;case 6:return s.type="marker",s.text=e.readString(a),s;case 7:return s.type="cuePoint",s.text=e.readString(a),s;case 32:if(s.type="channelPrefix",a!=1)throw"Expected length for channelPrefix event is 1, got "+a;return s.channel=e.readUInt8(),s;case 33:if(s.type="portPrefix",a!=1)throw"Expected length for portPrefix event is 1, got "+a;return s.port=e.readUInt8(),s;case 47:if(s.type="endOfTrack",a!=0)throw"Expected length for endOfTrack event is 0, got "+a;return s;case 81:if(s.type="setTempo",a!=3)throw"Expected length for setTempo event is 3, got "+a;return s.microsecondsPerBeat=e.readUInt24(),s;case 84:if(s.type="smpteOffset",a!=5)throw"Expected length for smpteOffset event is 5, got "+a;var p=e.readUInt8(),h={0:24,32:25,64:29,96:30};return s.frameRate=h[p&96],s.hour=p&31,s.min=e.readUInt8(),s.sec=e.readUInt8(),s.frame=e.readUInt8(),s.subFrame=e.readUInt8(),s;case 88:if(s.type="timeSignature",a!=2&&a!=4)throw"Expected length for timeSignature event is 4 or 2, got "+a;return s.numerator=e.readUInt8(),s.denominator=1<<e.readUInt8(),a===4?(s.metronome=e.readUInt8(),s.thirtyseconds=e.readUInt8()):(s.metronome=36,s.thirtyseconds=8),s;case 89:if(s.type="keySignature",a!=2)throw"Expected length for keySignature event is 2, got "+a;return s.key=e.readInt8(),s.scale=e.readUInt8(),s;case 127:return s.type="sequencerSpecific",s.data=e.readBytes(a),s;default:return s.type="unknownMeta",s.data=e.readBytes(a),s.metatypeByte=u,s}}else if(c==240){s.type="sysEx";var a=e.readVarInt();return s.data=e.readBytes(a),s}else if(c==247){s.type="endSysEx";var a=e.readVarInt();return s.data=e.readBytes(a),s}else throw"Unrecognised MIDI event type byte: "+c;else{var l;if(c&128)l=e.readUInt8(),i=c;else{if(i===null)throw"Running status byte encountered before status byte";l=c,c=i,s.running=!0}var f=c>>4;switch(s.channel=c&15,f){case 8:return s.type="noteOff",s.noteNumber=l,s.velocity=e.readUInt8(),s;case 9:var d=e.readUInt8();return s.type=d===0?"noteOff":"noteOn",s.noteNumber=l,s.velocity=d,d===0&&(s.byte9=!0),s;case 10:return s.type="noteAftertouch",s.noteNumber=l,s.amount=e.readUInt8(),s;case 11:return s.type="controller",s.controllerType=l,s.value=e.readUInt8(),s;case 12:return s.type="programChange",s.programNumber=l,s;case 13:return s.type="channelAftertouch",s.amount=l,s;case 14:return s.type="pitchBend",s.value=l+(e.readUInt8()<<7)-8192,s;default:throw"Unrecognised MIDI event type: "+f}}}}function ye(t){this.buffer=t,this.bufferLen=this.buffer.length,this.pos=0}ye.prototype.eof=function(){return this.pos>=this.bufferLen};ye.prototype.readUInt8=function(){var t=this.buffer[this.pos];return this.pos+=1,t};ye.prototype.readInt8=function(){var t=this.readUInt8();return t&128?t-256:t};ye.prototype.readUInt16=function(){var t=this.readUInt8(),e=this.readUInt8();return(t<<8)+e};ye.prototype.readInt16=function(){var t=this.readUInt16();return t&32768?t-65536:t};ye.prototype.readUInt24=function(){var t=this.readUInt8(),e=this.readUInt8(),n=this.readUInt8();return(t<<16)+(e<<8)+n};ye.prototype.readInt24=function(){var t=this.readUInt24();return t&8388608?t-16777216:t};ye.prototype.readUInt32=function(){var t=this.readUInt8(),e=this.readUInt8(),n=this.readUInt8(),r=this.readUInt8();return(t<<24)+(e<<16)+(n<<8)+r};ye.prototype.readBytes=function(t){var e=this.buffer.slice(this.pos,this.pos+t);return this.pos+=t,e};ye.prototype.readString=function(t){var e=this.readBytes(t);return String.fromCharCode.apply(null,e)};ye.prototype.readVarInt=function(){for(var t=0;!this.eof();){var e=this.readUInt8();if(e&128)t+=e&127,t<<=7;else return t+e}return t};ye.prototype.readChunk=function(){var t=this.readString(4),e=this.readUInt32(),n=this.readBytes(e);return{id:t,length:e,data:n}};var pr=fr;function mr(t,e){if(typeof t!="object")throw"Invalid MIDI data";e=e||{};var n=t.header||{},r=t.tracks||[],i,o=r.length,s=new se;for(yr(s,n,o),i=0;i<o;i++)vr(s,r[i],e);return s.buffer}function yr(t,e,n){var r=e.format==null?1:e.format,i=128;e.timeDivision?i=e.timeDivision:e.ticksPerFrame&&e.framesPerSecond?i=-(e.framesPerSecond&255)<<8|e.ticksPerFrame&255:e.ticksPerBeat&&(i=e.ticksPerBeat&32767);var o=new se;o.writeUInt16(r),o.writeUInt16(n),o.writeUInt16(i),t.writeChunk("MThd",o.buffer)}function vr(t,e,n){var r=new se,i,o=e.length,s=null;for(i=0;i<o;i++)(n.running===!1||!n.running&&!e[i].running)&&(s=null),s=gr(r,e[i],s,n.useByte9ForNoteOff);t.writeChunk("MTrk",r.buffer)}function gr(t,e,n,r){var i=e.type,o=e.deltaTime,s=e.text||"",c=e.data||[],u=null;switch(t.writeVarInt(o),i){case"sequenceNumber":t.writeUInt8(255),t.writeUInt8(0),t.writeVarInt(2),t.writeUInt16(e.number);break;case"text":t.writeUInt8(255),t.writeUInt8(1),t.writeVarInt(s.length),t.writeString(s);break;case"copyrightNotice":t.writeUInt8(255),t.writeUInt8(2),t.writeVarInt(s.length),t.writeString(s);break;case"trackName":t.writeUInt8(255),t.writeUInt8(3),t.writeVarInt(s.length),t.writeString(s);break;case"instrumentName":t.writeUInt8(255),t.writeUInt8(4),t.writeVarInt(s.length),t.writeString(s);break;case"lyrics":t.writeUInt8(255),t.writeUInt8(5),t.writeVarInt(s.length),t.writeString(s);break;case"marker":t.writeUInt8(255),t.writeUInt8(6),t.writeVarInt(s.length),t.writeString(s);break;case"cuePoint":t.writeUInt8(255),t.writeUInt8(7),t.writeVarInt(s.length),t.writeString(s);break;case"channelPrefix":t.writeUInt8(255),t.writeUInt8(32),t.writeVarInt(1),t.writeUInt8(e.channel);break;case"portPrefix":t.writeUInt8(255),t.writeUInt8(33),t.writeVarInt(1),t.writeUInt8(e.port);break;case"endOfTrack":t.writeUInt8(255),t.writeUInt8(47),t.writeVarInt(0);break;case"setTempo":t.writeUInt8(255),t.writeUInt8(81),t.writeVarInt(3),t.writeUInt24(e.microsecondsPerBeat);break;case"smpteOffset":t.writeUInt8(255),t.writeUInt8(84),t.writeVarInt(5);var a={24:0,25:32,29:64,30:96},p=e.hour&31|a[e.frameRate];t.writeUInt8(p),t.writeUInt8(e.min),t.writeUInt8(e.sec),t.writeUInt8(e.frame),t.writeUInt8(e.subFrame);break;case"timeSignature":t.writeUInt8(255),t.writeUInt8(88),t.writeVarInt(4),t.writeUInt8(e.numerator);var h=Math.floor(Math.log(e.denominator)/Math.LN2)&255;t.writeUInt8(h),t.writeUInt8(e.metronome),t.writeUInt8(e.thirtyseconds||8);break;case"keySignature":t.writeUInt8(255),t.writeUInt8(89),t.writeVarInt(2),t.writeInt8(e.key),t.writeUInt8(e.scale);break;case"sequencerSpecific":t.writeUInt8(255),t.writeUInt8(127),t.writeVarInt(c.length),t.writeBytes(c);break;case"unknownMeta":e.metatypeByte!=null&&(t.writeUInt8(255),t.writeUInt8(e.metatypeByte),t.writeVarInt(c.length),t.writeBytes(c));break;case"sysEx":t.writeUInt8(240),t.writeVarInt(c.length),t.writeBytes(c);break;case"endSysEx":t.writeUInt8(247),t.writeVarInt(c.length),t.writeBytes(c);break;case"noteOff":var l=r!==!1&&e.byte9||r&&e.velocity==0?144:128;u=l|e.channel,u!==n&&t.writeUInt8(u),t.writeUInt8(e.noteNumber),t.writeUInt8(e.velocity);break;case"noteOn":u=144|e.channel,u!==n&&t.writeUInt8(u),t.writeUInt8(e.noteNumber),t.writeUInt8(e.velocity);break;case"noteAftertouch":u=160|e.channel,u!==n&&t.writeUInt8(u),t.writeUInt8(e.noteNumber),t.writeUInt8(e.amount);break;case"controller":u=176|e.channel,u!==n&&t.writeUInt8(u),t.writeUInt8(e.controllerType),t.writeUInt8(e.value);break;case"programChange":u=192|e.channel,u!==n&&t.writeUInt8(u),t.writeUInt8(e.programNumber);break;case"channelAftertouch":u=208|e.channel,u!==n&&t.writeUInt8(u),t.writeUInt8(e.amount);break;case"pitchBend":u=224|e.channel,u!==n&&t.writeUInt8(u);var f=8192+e.value,d=f&127,m=f>>7&127;t.writeUInt8(d),t.writeUInt8(m);break;default:throw"Unrecognized event type: "+i}return u}function se(){this.buffer=[]}se.prototype.writeUInt8=function(t){this.buffer.push(t&255)};se.prototype.writeInt8=se.prototype.writeUInt8;se.prototype.writeUInt16=function(t){var e=t>>8&255,n=t&255;this.writeUInt8(e),this.writeUInt8(n)};se.prototype.writeInt16=se.prototype.writeUInt16;se.prototype.writeUInt24=function(t){var e=t>>16&255,n=t>>8&255,r=t&255;this.writeUInt8(e),this.writeUInt8(n),this.writeUInt8(r)};se.prototype.writeInt24=se.prototype.writeUInt24;se.prototype.writeUInt32=function(t){var e=t>>24&255,n=t>>16&255,r=t>>8&255,i=t&255;this.writeUInt8(e),this.writeUInt8(n),this.writeUInt8(r),this.writeUInt8(i)};se.prototype.writeInt32=se.prototype.writeUInt32;se.prototype.writeBytes=function(t){this.buffer=this.buffer.concat(Array.prototype.slice.call(t,0))};se.prototype.writeString=function(t){var e,n=t.length,r=[];for(e=0;e<n;e++)r.push(t.codePointAt(e));this.writeBytes(r)};se.prototype.writeVarInt=function(t){if(t<0)throw"Cannot write negative variable-length integer";if(t<=127)this.writeUInt8(t);else{var e=t,n=[];for(n.push(e&127),e>>=7;e;){var r=e&127|128;n.push(r),e>>=7}this.writeBytes(n.reverse())}};se.prototype.writeChunk=function(t,e){this.writeString(t),this.writeUInt32(e.length),this.writeBytes(e)};var _r=mr;At.parseMidi=pr;At.writeMidi=_r;var Ct={},Re={};Object.defineProperty(Re,"__esModule",{value:!0});Re.insert=Re.search=void 0;function On(t,e,n){n===void 0&&(n="ticks");var r=0,i=t.length,o=i;if(i>0&&t[i-1][n]<=e)return i-1;for(;r<o;){var s=Math.floor(r+(o-r)/2),c=t[s],u=t[s+1];if(c[n]===e){for(var a=s;a<t.length;a++){var p=t[a];p[n]===e&&(s=a)}return s}else{if(c[n]<e&&u[n]>e)return s;c[n]>e?o=s:c[n]<e&&(r=s+1)}}return-1}Re.search=On;function br(t,e,n){if(n===void 0&&(n="ticks"),t.length){var r=On(t,e[n],n);t.splice(r+1,0,e)}else t.push(e)}Re.insert=br;(function(t){Object.defineProperty(t,"__esModule",{value:!0}),t.Header=t.keySignatureKeys=void 0;var e=Re,n=new WeakMap;t.keySignatureKeys=["Cb","Gb","Db","Ab","Eb","Bb","F","C","G","D","A","E","B","F#","C#"];var r=function(){function i(o){var s=this;if(this.tempos=[],this.timeSignatures=[],this.keySignatures=[],this.meta=[],this.name="",n.set(this,480),o){n.set(this,o.header.ticksPerBeat),o.tracks.forEach(function(u){u.forEach(function(a){a.meta&&(a.type==="timeSignature"?s.timeSignatures.push({ticks:a.absoluteTime,timeSignature:[a.numerator,a.denominator]}):a.type==="setTempo"?s.tempos.push({bpm:6e7/a.microsecondsPerBeat,ticks:a.absoluteTime}):a.type==="keySignature"&&s.keySignatures.push({key:t.keySignatureKeys[a.key+7],scale:a.scale===0?"major":"minor",ticks:a.absoluteTime}))})});var c=0;o.tracks[0].forEach(function(u){c+=u.deltaTime,u.meta&&(u.type==="trackName"?s.name=u.text:(u.type==="text"||u.type==="cuePoint"||u.type==="marker"||u.type==="lyrics")&&s.meta.push({text:u.text,ticks:c,type:u.type}))}),this.update()}}return i.prototype.update=function(){var o=this,s=0,c=0;this.tempos.sort(function(u,a){return u.ticks-a.ticks}),this.tempos.forEach(function(u,a){var p=a>0?o.tempos[a-1].bpm:o.tempos[0].bpm,h=u.ticks/o.ppq-c,l=60/p*h;u.time=l+s,s=u.time,c+=h}),this.timeSignatures.sort(function(u,a){return u.ticks-a.ticks}),this.timeSignatures.forEach(function(u,a){var p=a>0?o.timeSignatures[a-1]:o.timeSignatures[0],h=(u.ticks-p.ticks)/o.ppq,l=h/p.timeSignature[0]/(p.timeSignature[1]/4);p.measures=p.measures||0,u.measures=l+p.measures})},i.prototype.ticksToSeconds=function(o){var s=(0,e.search)(this.tempos,o);if(s!==-1){var c=this.tempos[s],u=c.time,a=(o-c.ticks)/this.ppq;return u+60/c.bpm*a}else{var p=o/this.ppq;return 60/120*p}},i.prototype.ticksToMeasures=function(o){var s=(0,e.search)(this.timeSignatures,o);if(s!==-1){var c=this.timeSignatures[s],u=(o-c.ticks)/this.ppq;return c.measures+u/(c.timeSignature[0]/c.timeSignature[1])/4}else return o/this.ppq/4},Object.defineProperty(i.prototype,"ppq",{get:function(){return n.get(this)},enumerable:!1,configurable:!0}),i.prototype.secondsToTicks=function(o){var s=(0,e.search)(this.tempos,o,"time");if(s!==-1){var c=this.tempos[s],u=c.time,a=o-u,p=a/(60/c.bpm);return Math.round(c.ticks+p*this.ppq)}else{var h=o/.5;return Math.round(h*this.ppq)}},i.prototype.toJSON=function(){return{keySignatures:this.keySignatures,meta:this.meta,name:this.name,ppq:this.ppq,tempos:this.tempos.map(function(o){return{bpm:o.bpm,ticks:o.ticks}}),timeSignatures:this.timeSignatures}},i.prototype.fromJSON=function(o){this.name=o.name,this.tempos=o.tempos.map(function(s){return Object.assign({},s)}),this.timeSignatures=o.timeSignatures.map(function(s){return Object.assign({},s)}),this.keySignatures=o.keySignatures.map(function(s){return Object.assign({},s)}),this.meta=o.meta.map(function(s){return Object.assign({},s)}),n.set(this,o.ppq),this.update()},i.prototype.setTempo=function(o){this.tempos=[{bpm:o,ticks:0}],this.update()},i}();t.Header=r})(Ct);var pt={},Zt={};(function(t){Object.defineProperty(t,"__esModule",{value:!0}),t.ControlChange=t.controlChangeIds=t.controlChangeNames=void 0,t.controlChangeNames={1:"modulationWheel",2:"breath",4:"footController",5:"portamentoTime",7:"volume",8:"balance",10:"pan",64:"sustain",65:"portamentoTime",66:"sostenuto",67:"softPedal",68:"legatoFootswitch",84:"portamentoControl"},t.controlChangeIds=Object.keys(t.controlChangeNames).reduce(function(i,o){return i[t.controlChangeNames[o]]=o,i},{});var e=new WeakMap,n=new WeakMap,r=function(){function i(o,s){e.set(this,s),n.set(this,o.controllerType),this.ticks=o.absoluteTime,this.value=o.value}return Object.defineProperty(i.prototype,"number",{get:function(){return n.get(this)},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"name",{get:function(){return t.controlChangeNames[this.number]?t.controlChangeNames[this.number]:null},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"time",{get:function(){var o=e.get(this);return o.ticksToSeconds(this.ticks)},set:function(o){var s=e.get(this);this.ticks=s.secondsToTicks(o)},enumerable:!1,configurable:!0}),i.prototype.toJSON=function(){return{number:this.number,ticks:this.ticks,time:this.time,value:this.value}},i}();t.ControlChange=r})(Zt);var Dt={};Object.defineProperty(Dt,"__esModule",{value:!0});Dt.createControlChanges=void 0;var vt=Zt;function wr(){return new Proxy({},{get:function(t,e){if(t[e])return t[e];if(vt.controlChangeIds.hasOwnProperty(e))return t[vt.controlChangeIds[e]]},set:function(t,e,n){return vt.controlChangeIds.hasOwnProperty(e)?t[vt.controlChangeIds[e]]=n:t[e]=n,!0}})}Dt.createControlChanges=wr;var Nt={};Object.defineProperty(Nt,"__esModule",{value:!0});Nt.PitchBend=void 0;var zt=new WeakMap,kr=function(){function t(e,n){zt.set(this,n),this.ticks=e.absoluteTime,this.value=e.value}return Object.defineProperty(t.prototype,"time",{get:function(){var e=zt.get(this);return e.ticksToSeconds(this.ticks)},set:function(e){var n=zt.get(this);this.ticks=n.secondsToTicks(e)},enumerable:!1,configurable:!0}),t.prototype.toJSON=function(){return{ticks:this.ticks,time:this.time,value:this.value}},t}();Nt.PitchBend=kr;var Ft={},Ee={};Object.defineProperty(Ee,"__esModule",{value:!0});Ee.DrumKitByPatchID=Ee.InstrumentFamilyByID=Ee.instrumentByPatchID=void 0;Ee.instrumentByPatchID=["acoustic grand piano","bright acoustic piano","electric grand piano","honky-tonk piano","electric piano 1","electric piano 2","harpsichord","clavi","celesta","glockenspiel","music box","vibraphone","marimba","xylophone","tubular bells","dulcimer","drawbar organ","percussive organ","rock organ","church organ","reed organ","accordion","harmonica","tango accordion","acoustic guitar (nylon)","acoustic guitar (steel)","electric guitar (jazz)","electric guitar (clean)","electric guitar (muted)","overdriven guitar","distortion guitar","guitar harmonics","acoustic bass","electric bass (finger)","electric bass (pick)","fretless bass","slap bass 1","slap bass 2","synth bass 1","synth bass 2","violin","viola","cello","contrabass","tremolo strings","pizzicato strings","orchestral harp","timpani","string ensemble 1","string ensemble 2","synthstrings 1","synthstrings 2","choir aahs","voice oohs","synth voice","orchestra hit","trumpet","trombone","tuba","muted trumpet","french horn","brass section","synthbrass 1","synthbrass 2","soprano sax","alto sax","tenor sax","baritone sax","oboe","english horn","bassoon","clarinet","piccolo","flute","recorder","pan flute","blown bottle","shakuhachi","whistle","ocarina","lead 1 (square)","lead 2 (sawtooth)","lead 3 (calliope)","lead 4 (chiff)","lead 5 (charang)","lead 6 (voice)","lead 7 (fifths)","lead 8 (bass + lead)","pad 1 (new age)","pad 2 (warm)","pad 3 (polysynth)","pad 4 (choir)","pad 5 (bowed)","pad 6 (metallic)","pad 7 (halo)","pad 8 (sweep)","fx 1 (rain)","fx 2 (soundtrack)","fx 3 (crystal)","fx 4 (atmosphere)","fx 5 (brightness)","fx 6 (goblins)","fx 7 (echoes)","fx 8 (sci-fi)","sitar","banjo","shamisen","koto","kalimba","bag pipe","fiddle","shanai","tinkle bell","agogo","steel drums","woodblock","taiko drum","melodic tom","synth drum","reverse cymbal","guitar fret noise","breath noise","seashore","bird tweet","telephone ring","helicopter","applause","gunshot"];Ee.InstrumentFamilyByID=["piano","chromatic percussion","organ","guitar","bass","strings","ensemble","brass","reed","pipe","synth lead","synth pad","synth effects","world","percussive","sound effects"];Ee.DrumKitByPatchID={0:"standard kit",8:"room kit",16:"power kit",24:"electronic kit",25:"tr-808 kit",32:"jazz kit",40:"brush kit",48:"orchestra kit",56:"sound fx kit"};Object.defineProperty(Ft,"__esModule",{value:!0});Ft.Instrument=void 0;var gt=Ee,sn=new WeakMap,xr=function(){function t(e,n){if(this.number=0,sn.set(this,n),this.number=0,e){var r=e.find(function(i){return i.type==="programChange"});r&&(this.number=r.programNumber)}}return Object.defineProperty(t.prototype,"name",{get:function(){return this.percussion?gt.DrumKitByPatchID[this.number]:gt.instrumentByPatchID[this.number]},set:function(e){var n=gt.instrumentByPatchID.indexOf(e);n!==-1&&(this.number=n)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"family",{get:function(){return this.percussion?"drums":gt.InstrumentFamilyByID[Math.floor(this.number/8)]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"percussion",{get:function(){var e=sn.get(this);return e.channel===9},enumerable:!1,configurable:!0}),t.prototype.toJSON=function(){return{family:this.family,number:this.number,name:this.name}},t.prototype.fromJSON=function(e){this.number=e.number},t}();Ft.Instrument=xr;var Ot={};Object.defineProperty(Ot,"__esModule",{value:!0});Ot.Note=void 0;function Ir(t){var e=Math.floor(t/12)-1;return Bn(t)+e.toString()}function Bn(t){var e=["C","C#","D","D#","E","F","F#","G","G#","A","A#","B"],n=t%12;return e[n]}function Tr(t){var e=["C","C#","D","D#","E","F","F#","G","G#","A","A#","B"];return e.indexOf(t)}var Ur=function(){var t=/^([a-g]{1}(?:b|#|x|bb)?)(-?[0-9]+)/i,e={cbb:-2,cb:-1,c:0,"c#":1,cx:2,dbb:0,db:1,d:2,"d#":3,dx:4,ebb:2,eb:3,e:4,"e#":5,ex:6,fbb:3,fb:4,f:5,"f#":6,fx:7,gbb:5,gb:6,g:7,"g#":8,gx:9,abb:7,ab:8,a:9,"a#":10,ax:11,bbb:9,bb:10,b:11,"b#":12,bx:13};return function(n){var r=t.exec(n),i=r[1],o=r[2],s=e[i.toLowerCase()];return s+(parseInt(o,10)+1)*12}}(),Ke=new WeakMap,Sr=function(){function t(e,n,r){Ke.set(this,r),this.midi=e.midi,this.velocity=e.velocity,this.noteOffVelocity=n.velocity,this.ticks=e.ticks,this.durationTicks=n.ticks-e.ticks}return Object.defineProperty(t.prototype,"name",{get:function(){return Ir(this.midi)},set:function(e){this.midi=Ur(e)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"octave",{get:function(){return Math.floor(this.midi/12)-1},set:function(e){var n=e-this.octave;this.midi+=n*12},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"pitch",{get:function(){return Bn(this.midi)},set:function(e){this.midi=12*(this.octave+1)+Tr(e)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"duration",{get:function(){var e=Ke.get(this);return e.ticksToSeconds(this.ticks+this.durationTicks)-e.ticksToSeconds(this.ticks)},set:function(e){var n=Ke.get(this),r=n.secondsToTicks(this.time+e);this.durationTicks=r-this.ticks},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"time",{get:function(){var e=Ke.get(this);return e.ticksToSeconds(this.ticks)},set:function(e){var n=Ke.get(this);this.ticks=n.secondsToTicks(e)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"bars",{get:function(){var e=Ke.get(this);return e.ticksToMeasures(this.ticks)},enumerable:!1,configurable:!0}),t.prototype.toJSON=function(){return{duration:this.duration,durationTicks:this.durationTicks,midi:this.midi,name:this.name,ticks:this.ticks,time:this.time,velocity:this.velocity}},t}();Ot.Note=Sr;Object.defineProperty(pt,"__esModule",{value:!0});pt.Track=void 0;var Rt=Re,Cr=Zt,Pr=Dt,Er=Nt,on=Ft,Mr=Ot,_t=new WeakMap,Ar=function(){function t(e,n){var r=this;if(this.name="",this.notes=[],this.controlChanges=(0,Pr.createControlChanges)(),this.pitchBends=[],_t.set(this,n),e){var i=e.find(function(l){return l.type==="trackName"});this.name=i?i.text:""}if(this.instrument=new on.Instrument(e,this),this.channel=0,e){for(var o=e.filter(function(l){return l.type==="noteOn"}),s=e.filter(function(l){return l.type==="noteOff"}),c=function(){var l=o.shift();u.channel=l.channel;var f=s.findIndex(function(m){return m.noteNumber===l.noteNumber&&m.absoluteTime>=l.absoluteTime});if(f!==-1){var d=s.splice(f,1)[0];u.addNote({durationTicks:d.absoluteTime-l.absoluteTime,midi:l.noteNumber,noteOffVelocity:d.velocity/127,ticks:l.absoluteTime,velocity:l.velocity/127})}},u=this;o.length;)c();var a=e.filter(function(l){return l.type==="controller"});a.forEach(function(l){r.addCC({number:l.controllerType,ticks:l.absoluteTime,value:l.value/127})});var p=e.filter(function(l){return l.type==="pitchBend"});p.forEach(function(l){r.addPitchBend({ticks:l.absoluteTime,value:l.value/Math.pow(2,13)})});var h=e.find(function(l){return l.type==="endOfTrack"});this.endOfTrackTicks=h!==void 0?h.absoluteTime:void 0}}return t.prototype.addNote=function(e){var n=_t.get(this),r=new Mr.Note({midi:0,ticks:0,velocity:1},{ticks:0,velocity:0},n);return Object.assign(r,e),(0,Rt.insert)(this.notes,r,"ticks"),this},t.prototype.addCC=function(e){var n=_t.get(this),r=new Cr.ControlChange({controllerType:e.number},n);return delete e.number,Object.assign(r,e),Array.isArray(this.controlChanges[r.number])||(this.controlChanges[r.number]=[]),(0,Rt.insert)(this.controlChanges[r.number],r,"ticks"),this},t.prototype.addPitchBend=function(e){var n=_t.get(this),r=new Er.PitchBend({},n);return Object.assign(r,e),(0,Rt.insert)(this.pitchBends,r,"ticks"),this},Object.defineProperty(t.prototype,"duration",{get:function(){if(!this.notes.length)return 0;for(var e=this.notes[this.notes.length-1].time+this.notes[this.notes.length-1].duration,n=0;n<this.notes.length-1;n++){var r=this.notes[n].time+this.notes[n].duration;e<r&&(e=r)}return e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"durationTicks",{get:function(){if(!this.notes.length)return 0;for(var e=this.notes[this.notes.length-1].ticks+this.notes[this.notes.length-1].durationTicks,n=0;n<this.notes.length-1;n++){var r=this.notes[n].ticks+this.notes[n].durationTicks;e<r&&(e=r)}return e},enumerable:!1,configurable:!0}),t.prototype.fromJSON=function(e){var n=this;this.name=e.name,this.channel=e.channel,this.instrument=new on.Instrument(void 0,this),this.instrument.fromJSON(e.instrument),e.endOfTrackTicks!==void 0&&(this.endOfTrackTicks=e.endOfTrackTicks);for(var r in e.controlChanges)e.controlChanges[r]&&e.controlChanges[r].forEach(function(i){n.addCC({number:i.number,ticks:i.ticks,value:i.value})});e.notes.forEach(function(i){n.addNote({durationTicks:i.durationTicks,midi:i.midi,ticks:i.ticks,velocity:i.velocity})})},t.prototype.toJSON=function(){for(var e={},n=0;n<127;n++)this.controlChanges.hasOwnProperty(n)&&(e[n]=this.controlChanges[n].map(function(i){return i.toJSON()}));var r={channel:this.channel,controlChanges:e,pitchBends:this.pitchBends.map(function(i){return i.toJSON()}),instrument:this.instrument.toJSON(),name:this.name,notes:this.notes.map(function(i){return i.toJSON()})};return this.endOfTrackTicks!==void 0&&(r.endOfTrackTicks=this.endOfTrackTicks),r},t}();pt.Track=Ar;var Bt={};function Dr(t){var e=[];return Ln(t,e),e}function Ln(t,e){for(var n=0;n<t.length;n++){var r=t[n];Array.isArray(r)?Ln(r,e):e.push(r)}}const Nr=Object.freeze(Object.defineProperty({__proto__:null,flatten:Dr},Symbol.toStringTag,{value:"Module"})),Fr=ur(Nr);var Se=Ye&&Ye.__spreadArray||function(t,e,n){if(n||arguments.length===2)for(var r=0,i=e.length,o;r<i;r++)(o||!(r in e))&&(o||(o=Array.prototype.slice.call(e,0,r)),o[r]=e[r]);return t.concat(o||Array.prototype.slice.call(e))};Object.defineProperty(Bt,"__esModule",{value:!0});Bt.encode=void 0;var Or=At,Br=Ct,Lr=Fr;function zr(t,e){return[{absoluteTime:t.ticks,channel:e,deltaTime:0,noteNumber:t.midi,type:"noteOn",velocity:Math.floor(t.velocity*127)},{absoluteTime:t.ticks+t.durationTicks,channel:e,deltaTime:0,noteNumber:t.midi,type:"noteOff",velocity:Math.floor(t.noteOffVelocity*127)}]}function Rr(t){return(0,Lr.flatten)(t.notes.map(function(e){return zr(e,t.channel)}))}function Hr(t,e){return{absoluteTime:t.ticks,channel:e,controllerType:t.number,deltaTime:0,type:"controller",value:Math.floor(t.value*127)}}function Vr(t){for(var e=[],n=0;n<127;n++)t.controlChanges.hasOwnProperty(n)&&t.controlChanges[n].forEach(function(r){e.push(Hr(r,t.channel))});return e}function Kr(t,e){return{absoluteTime:t.ticks,channel:e,deltaTime:0,type:"pitchBend",value:t.value}}function Wr(t){var e=[];return t.pitchBends.forEach(function(n){e.push(Kr(n,t.channel))}),e}function Gr(t){return{absoluteTime:0,channel:t.channel,deltaTime:0,programNumber:t.instrument.number,type:"programChange"}}function qr(t){return{absoluteTime:0,deltaTime:0,meta:!0,text:t,type:"trackName"}}function Jr(t){return{absoluteTime:t.ticks,deltaTime:0,meta:!0,microsecondsPerBeat:Math.floor(6e7/t.bpm),type:"setTempo"}}function Xr(t){return{absoluteTime:t.ticks,deltaTime:0,denominator:t.timeSignature[1],meta:!0,metronome:24,numerator:t.timeSignature[0],thirtyseconds:8,type:"timeSignature"}}function Yr(t){var e=Br.keySignatureKeys.indexOf(t.key);return{absoluteTime:t.ticks,deltaTime:0,key:e+7,meta:!0,scale:t.scale==="major"?0:1,type:"keySignature"}}function Qr(t){return{absoluteTime:t.ticks,deltaTime:0,meta:!0,text:t.text,type:t.type}}function Zr(t){var e={header:{format:1,numTracks:t.tracks.length+1,ticksPerBeat:t.header.ppq},tracks:Se([Se(Se(Se(Se([{absoluteTime:0,deltaTime:0,meta:!0,text:t.header.name,type:"trackName"}],t.header.keySignatures.map(function(n){return Yr(n)}),!0),t.header.meta.map(function(n){return Qr(n)}),!0),t.header.tempos.map(function(n){return Jr(n)}),!0),t.header.timeSignatures.map(function(n){return Xr(n)}),!0)],t.tracks.map(function(n){return Se(Se(Se([qr(n.name),Gr(n)],Rr(n),!0),Vr(n),!0),Wr(n),!0)}),!0)};return e.tracks=e.tracks.map(function(n){n=n.sort(function(i,o){return i.absoluteTime-o.absoluteTime});var r=0;return n.forEach(function(i){i.deltaTime=i.absoluteTime-r,r=i.absoluteTime,delete i.absoluteTime}),n.push({deltaTime:0,meta:!0,type:"endOfTrack"}),n}),new Uint8Array((0,Or.writeMidi)(e))}Bt.encode=Zr;(function(t){var e=Ye&&Ye.__awaiter||function(h,l,f,d){function m(y){return y instanceof f?y:new f(function(_){_(y)})}return new(f||(f=Promise))(function(y,_){function T(E){try{k(d.next(E))}catch(N){_(N)}}function z(E){try{k(d.throw(E))}catch(N){_(N)}}function k(E){E.done?y(E.value):m(E.value).then(T,z)}k((d=d.apply(h,l||[])).next())})},n=Ye&&Ye.__generator||function(h,l){var f={label:0,sent:function(){if(y[0]&1)throw y[1];return y[1]},trys:[],ops:[]},d,m,y,_;return _={next:T(0),throw:T(1),return:T(2)},typeof Symbol=="function"&&(_[Symbol.iterator]=function(){return this}),_;function T(k){return function(E){return z([k,E])}}function z(k){if(d)throw new TypeError("Generator is already executing.");for(;f;)try{if(d=1,m&&(y=k[0]&2?m.return:k[0]?m.throw||((y=m.return)&&y.call(m),0):m.next)&&!(y=y.call(m,k[1])).done)return y;switch(m=0,y&&(k=[k[0]&2,y.value]),k[0]){case 0:case 1:y=k;break;case 4:return f.label++,{value:k[1],done:!1};case 5:f.label++,m=k[1],k=[0];continue;case 7:k=f.ops.pop(),f.trys.pop();continue;default:if(y=f.trys,!(y=y.length>0&&y[y.length-1])&&(k[0]===6||k[0]===2)){f=0;continue}if(k[0]===3&&(!y||k[1]>y[0]&&k[1]<y[3])){f.label=k[1];break}if(k[0]===6&&f.label<y[1]){f.label=y[1],y=k;break}if(y&&f.label<y[2]){f.label=y[2],f.ops.push(k);break}y[2]&&f.ops.pop(),f.trys.pop();continue}k=l.call(h,f)}catch(E){k=[6,E],m=0}finally{d=y=0}if(k[0]&5)throw k[1];return{value:k[0]?k[1]:void 0,done:!0}}};Object.defineProperty(t,"__esModule",{value:!0}),t.Header=t.Track=t.Midi=void 0;var r=At,i=Ct,o=pt,s=Bt,c=function(){function h(l){var f=this,d=null;if(l){var m=l instanceof ArrayBuffer?new Uint8Array(l):l;d=(0,r.parseMidi)(m),d.tracks.forEach(function(y){var _=0;y.forEach(function(T){_+=T.deltaTime,T.absoluteTime=_})}),d.tracks=p(d.tracks)}this.header=new i.Header(d),this.tracks=[],l&&(this.tracks=d.tracks.map(function(y){return new o.Track(y,f.header)}),d.header.format===1&&this.tracks[0].duration===0&&this.tracks.shift())}return h.fromUrl=function(l){return e(this,void 0,void 0,function(){var f,d;return n(this,function(m){switch(m.label){case 0:return[4,fetch(l)];case 1:return f=m.sent(),f.ok?[4,f.arrayBuffer()]:[3,3];case 2:return d=m.sent(),[2,new h(d)];case 3:throw new Error("Could not load '".concat(l,"'"))}})})},Object.defineProperty(h.prototype,"name",{get:function(){return this.header.name},set:function(l){this.header.name=l},enumerable:!1,configurable:!0}),Object.defineProperty(h.prototype,"duration",{get:function(){var l=this.tracks.map(function(f){return f.duration});return Math.max.apply(Math,l)},enumerable:!1,configurable:!0}),Object.defineProperty(h.prototype,"durationTicks",{get:function(){var l=this.tracks.map(function(f){return f.durationTicks});return Math.max.apply(Math,l)},enumerable:!1,configurable:!0}),h.prototype.addTrack=function(){var l=new o.Track(void 0,this.header);return this.tracks.push(l),l},h.prototype.toArray=function(){return(0,s.encode)(this)},h.prototype.toJSON=function(){return{header:this.header.toJSON(),tracks:this.tracks.map(function(l){return l.toJSON()})}},h.prototype.fromJSON=function(l){var f=this;this.header=new i.Header,this.header.fromJSON(l.header),this.tracks=l.tracks.map(function(d){var m=new o.Track(void 0,f.header);return m.fromJSON(d),m})},h.prototype.clone=function(){var l=new h;return l.fromJSON(this.toJSON()),l},h}();t.Midi=c;var u=pt;Object.defineProperty(t,"Track",{enumerable:!0,get:function(){return u.Track}});var a=Ct;Object.defineProperty(t,"Header",{enumerable:!0,get:function(){return a.Header}});function p(h){for(var l=[],f=0;f<h.length;f++)for(var d=l.length,m=new Map,y=Array(16).fill(0),_=0,T=h[f];_<T.length;_++){var z=T[_],k=d,E=z.channel;if(E!==void 0){z.type==="programChange"&&(y[E]=z.programNumber);var N=y[E],R="".concat(N," ").concat(E);m.has(R)?k=m.get(R):(k=d+m.size,m.set(R,k))}l[k]||l.push([]),l[k].push(z)}return l}})(Jt);const We=[];function le(t,e=q){let n;const r=new Set;function i(c){if(He(t,c)&&(t=c,n)){const u=!We.length;for(const a of r)a[1](),We.push(a,t);if(u){for(let a=0;a<We.length;a+=2)We[a][0](We[a+1]);We.length=0}}}function o(c){i(c(t))}function s(c,u=q){const a=[c,u];return r.add(a),r.size===1&&(n=e(i,o)||q),c(t),()=>{r.delete(a),r.size===0&&n&&(n(),n=null)}}return{set:i,update:o,subscribe:s}}const Qe=["C","C#","D","D#","E","F","F#","G","G#","A","A#","B"],an={Backquote:"A#2",Tab:"B2",KeyQ:"C3",Digit2:"C#3",KeyW:"D3",Digit3:"D#3",KeyE:"E3",KeyR:"F3",Digit5:"F#3",KeyT:"G3",Digit6:"G#3",KeyY:"A3",Digit7:"A#3",KeyU:"B3",KeyI:"C4",Digit9:"C#4",KeyO:"D4",Digit0:"D#4",KeyP:"E4",BracketLeft:"F4",Equal:"F#4",BracketRight:"G4",Backspace:"G#4",Backslash:"A4",CapsLock:"A#4",Escape:"A#4",ShiftLeft:"B4",KeyZ:"C5",KeyS:"C#5",KeyX:"D5",KeyD:"D#5",KeyC:"E5",KeyV:"F5",KeyG:"F#5",KeyB:"G5",KeyH:"G#5",KeyN:"A5",KeyJ:"A#5",KeyM:"B5",Comma:"C6",KeyL:"C#6",Period:"D6",Semicolon:"D#6",Slash:"E6",ShiftRight:"F6",Enter:"F#6"},$r={"A#2":"`",B2:"↹",C3:"Q","C#3":"2",D3:"W","D#3":"3",E3:"E",F3:"R","F#3":"5",G3:"T","G#3":"6",A3:"Y","A#3":"7",B3:"U",C4:"I","C#4":"9",D4:"O","D#4":"0",E4:"P",F4:"[","F#4":"=",G4:"]","G#4":"⌫",A4:"\\","A#4":"⇪",B4:"⇧",C5:"Z","C#5":"S",D5:"X","D#5":"D",E5:"C",F5:"V","F#5":"G",G5:"B","G#5":"H",A5:"N","A#5":"J",B5:"M",C6:",","C#6":"L",D6:".","D#6":";",E6:"/",F6:"⇧","F#6":"↩"};function Xt(t){return parseInt(t.charAt(t.length-1))}function Pt(t){return t.substring(0,t.length-1)}function st(t){const e=Math.floor(t/12)-1;return Qe[t%12]+e}function Et(t){const e=Qe.indexOf(Pt(t));return(Xt(t)+1)*12+e}function jr(t){const[e,n]=t.split(","),r=Xt(n),i=Xt(e),o=Qe.indexOf(Pt(e)),s=Qe.indexOf(Pt(n)),c={};let u=0,a=o;for(let p=i;p<=r;p++){for(;a<Qe.length&&!(p===r&&a>s);){const h=Qe[a],l=h.length===1;c[h+p]={isWhite:l,pressedColor:null},l&&u++,a++}a=0}return[c,u]}class ei{constructor(){A(this,"isPlaying",le(!1));A(this,"currentTime",le(0));A(this,"totalTime",le(0));A(this,"speed",le(1));A(this,"isRecording",le(!1));A(this,"selectedTrack",le(0));A(this,"data",new Jt.Midi);A(this,"tracks",le(this.data.tracks));A(this,"shouldPlaySolo",le(!1));A(this,"lastStartFunc",()=>{});A(this,"tracksIndexUpTo",[]);A(this,"loopIntervalID",null);A(this,"playingHeldNotes",[]);A(this,"recordingHeldNotes",new Map);A(this,"recoringMidiData",null);A(this,"midiLastStartTime",0);A(this,"onPlayNote");A(this,"onStopNote");this.tracks.subscribe(e=>{const n=e.length==0?0:this.data.duration;this.totalTime.set(n),this.currentTime.set(Math.min(n,re(this.currentTime)))})}startPlaying(){this.recalcPlayIndex(),this.startLoop(e=>{this.onPlayUpdate(e),e>re(this.totalTime)&&(this.stop(),this.lastStartFunc=()=>{},this.currentTime.set(0))}),this.isPlaying.set(!0),this.lastStartFunc=this.startPlaying.bind(this),this.midiLastStartTime=re(this.currentTime)}startRecording(){this.data.tracks.length==0&&this.addTrack(),this.data.tracks[re(this.selectedTrack)].notes=[],this.recoringMidiData=this.data.clone(),this.recalcPlayIndex(),this.isRecording.set(!0),this.lastStartFunc=this.startRecording.bind(this),this.midiLastStartTime=re(this.currentTime)}stop(){clearInterval(this.loopIntervalID),this.loopIntervalID=null,this.playingHeldNotes.forEach(e=>this.onStopNote(e.name)),this.playingHeldNotes=[],this.isPlaying.set(!1),this.recoringMidiData&&(this.data=this.recoringMidiData,this.recoringMidiData=null,this.tracks.set(this.data.tracks)),this.isRecording.set(!1),this.recordingHeldNotes.clear()}recordPlayNote(e,n){if(!re(this.isRecording))return;this.loopIntervalID===null&&this.startLoop(i=>{this.onPlayUpdate(i),i>re(this.totalTime)&&this.totalTime.set(i)});const r=Et(e);this.recordingHeldNotes.set(r,{midi:r,velocity:n,time:re(this.currentTime)})}recordStopNote(e){if(!re(this.isRecording))return;const n=Et(e),r=this.recordingHeldNotes.get(n);r&&(r.duration=re(this.currentTime)-r.time,this.recoringMidiData.tracks[re(this.selectedTrack)].addNote(r),this.recordingHeldNotes.delete(n))}addTrack(){const e=this.data.addTrack();this.selectedTrack.set(this.data.tracks.length-1),this.tracks.set(this.data.tracks);const n=prompt("Enter the track name: ");n&&(e.name=n)}deleteTrack(){const e=re(this.selectedTrack);this.data.tracks.splice(e,1),this.selectedTrack.set(Math.min(this.data.tracks.length-1,e)),this.tracks.set(this.data.tracks)}saveFile(){const e=new Blob([this.data.toArray()],{type:"application/octet-stream"}),n=URL.createObjectURL(e),r=document.createElement("a");r.href=n,r.download="record.midi",document.body.appendChild(r),r.click(),document.body.removeChild(r),URL.revokeObjectURL(n)}setFile(e){if(!e)return;const n=new FileReader;n.onload=()=>{this.data=new Jt.Midi(n.result),this.tracks.set(this.data.tracks),this.selectedTrack.set(0)},n.readAsArrayBuffer(e)}stopAndReseek(){this.stop(),this.lastStartFunc=()=>{},this.currentTime.set(this.midiLastStartTime)}recalcPlayIndex(){this.data.tracks.forEach((e,n)=>{const r=re(this.currentTime);this.tracksIndexUpTo[n]=ti(e.notes,i=>i.time-r)})}startLoop(e){let n=performance.now();this.loopIntervalID=setInterval(()=>{const r=performance.now(),o=(r-n)/1e3*re(this.speed),s=re(this.currentTime)+o;this.currentTime.set(s),e(s),n=r},10)}onPlayUpdate(e){if(this.playingHeldNotes.forEach((n,r)=>{e>n.time+n.duration&&(this.onStopNote(n.name),ni(this.playingHeldNotes,r))}),re(this.shouldPlaySolo)){const n=re(this.selectedTrack);this.checkTracksPlayNotes(e,n)}else for(let n=0;n<this.data.tracks.length;n++)this.checkTracksPlayNotes(e,n)}checkTracksPlayNotes(e,n){const r=this.data.tracks[n];for(;;){const i=r.notes[this.tracksIndexUpTo[n]];if(!i||e<i.time)break;i.time+i.duration>e&&(this.onPlayNote(i.name,i.velocity),this.playingHeldNotes.push(i)),this.tracksIndexUpTo[n]++}}}function ti(t,e){if(!t||t.length==0)return 0;let n=0,r=t.length-1;for(;n!=r;){const i=Math.ceil((n+r)/2);e(t[i])>=0?r=i-1:n=i}return r}function ni(t,e){t[e]=t[t.length-1],t.pop()}function cn(t,e,n){const r=t.slice();return r[39]=e[n][0],r[40]=e[n][1].isWhite,r[41]=e[n][1].pressedColor,r}function ln(t){let e,n=t[18](t[39],t[6],t[5],t[4])+"",r,i,o,s,c;function u(...l){return t[27](t[39],...l)}function a(){return t[28](t[39])}function p(){return t[29](t[39])}function h(){return t[30](t[39])}return{c(){e=b("div"),r=ie(n),i=D(),w(e,"class",o="key "+(t[40]?"white":"black")+" svelte-1569eu9"),Oe(e,"--color-hue",t[41]),tn(e,"pressed",t[41]!==null)},m(l,f){O(l,e,f),v(e,r),v(e,i),s||(c=[P(e,"pointerdown",u),P(e,"pointerenter",a),P(e,"pointerleave",p),P(e,"pointerup",h)],s=!0)},p(l,f){t=l,f[0]&120&&n!==(n=t[18](t[39],t[6],t[5],t[4])+"")&&ze(r,n),f[0]&8&&o!==(o="key "+(t[40]?"white":"black")+" svelte-1569eu9")&&w(e,"class",o),f[0]&8&&Oe(e,"--color-hue",t[41]),f[0]&8&&tn(e,"pressed",t[41]!==null)},d(l){l&&F(e),s=!1,be(c)}}}function ri(t){let e,n,r,i,o=ke(Object.entries(t[3])),s=[];for(let c=0;c<o.length;c+=1)s[c]=ln(cn(t,o,c));return{c(){e=b("div"),n=b("div");for(let c=0;c<s.length;c+=1)s[c].c();w(n,"class","piano svelte-1569eu9"),w(e,"class","piano-container svelte-1569eu9")},m(c,u){O(c,e,u),v(e,n);for(let a=0;a<s.length;a+=1)s[a]&&s[a].m(n,null);t[31](e),r||(i=[P(window,"resize",t[24]),P(window,"keyup",t[17]),P(window,"keydown",t[16]),P(window,"pointerdown",t[25]),P(window,"pointerup",t[26]),P(n,"touchstart",jn(t[23]))],r=!0)},p(c,u){if(u[0]&286842){o=ke(Object.entries(c[3]));let a;for(a=0;a<o.length;a+=1){const p=cn(c,o,a);s[a]?s[a].p(p,u):(s[a]=ln(p),s[a].c(),s[a].m(n,null))}for(;a<s.length;a+=1)s[a].d(1);s.length=o.length}},i:q,o:q,d(c){c&&F(e),ht(s,c),t[31](null),r=!1,be(i)}}}function ii(t,e,n){let r,i,o,s,c,u,a,p,h=!1,l,f=new Map,{pianoControlsData:d}=e,{noteRange:m,sustain:y,noteShift:_,octaveShift:T,volume:z,labelType:k}=d;Y(t,m,g=>n(22,a=g)),Y(t,y,g=>n(32,o=g)),Y(t,_,g=>n(5,u=g)),Y(t,T,g=>n(4,c=g)),Y(t,z,g=>n(33,s=g)),Y(t,k,g=>n(6,p=g));let{midiPlayer:E}=e;E.onPlayNote=Q,E.onStopNote=H;let{socketPlayer:N}=e;N.onPlayNote=(g,I,Z)=>{r[g]&&n(3,r[g].pressedColor=String(Z.colorHue),r),Z.playAudio(g,I)},N.onStopNote=(g,I,Z)=>{r[g]&&n(3,r[g].pressedColor=null,r),I||Z.stopAudio(g)};function R(g){const I=Et(g)+u+c*12;return st(I)}function Q(g,I=.5,Z=!0){const te=R(g);if(f.has(te))if(Z)H(g);else return;f.set(te,!0),N.playNote(te,s*I),this!==E&&E.recordPlayNote(g,I)}function H(g){const I=R(g);f.has(I)&&(f.delete(I),N.stopNote(I,o),this!==E&&E.recordStopNote(g))}y.subscribe(g=>{if(!g)for(const I of N.localClient.stopAudioMap.keys())f.get(I)||N.stopNote(I,!1)});function W(){for(const g of f.keys())N.stopNote(g,o)}T.subscribe(W),_.subscribe(W);function J(g){if(l){const I=l.clientHeight/6,Z=l.offsetWidth/g;l.style.setProperty("--white-key-width",`${Math.min(Z,I)}px`)}}function X(g){const I=an[g.code],Z=g.target;I&&Z.tagName!=="INPUT"&&(g.preventDefault(),Q(I,void 0,!1))}function M(g){const I=an[g.code];I&&H(I)}function oe(g,I,Z,te){if(I=="notes")return Pt(g);if(I=="keybinds"){const K=Et(g)-Z-te*12;return $r[st(K)]??""}else return""}function de(g){const[I,Z,te]=g.data;I>=144&&I<=159?te==0?H(st(Z)):Q(st(Z),te/127):I>=128&&I<=143&&H(st(Z))}function V(g){g.inputs.forEach(I=>{I.onmidimessage=de})}Fn(()=>{J(i),navigator.requestMIDIAccess().then(g=>{V(g),g.onstatechange=()=>{V(g)}})});function U(g){tr.call(this,t,g)}const fe=()=>J(i),ee=g=>{var I;g.button===0&&((I=g.target)==null?void 0:I.tagName)!=="SELECT"&&n(1,h=!0)},ae=()=>n(1,h=!1),he=(g,I)=>{I.currentTarget.releasePointerCapture(I.pointerId),Q(g)},L=g=>{h&&Q(g)},ce=g=>{h&&H(g)},ge=g=>H(g);function xe(g){Gt[g?"unshift":"push"](()=>{l=g,n(2,l)})}return t.$$set=g=>{"pianoControlsData"in g&&n(21,d=g.pianoControlsData),"midiPlayer"in g&&n(19,E=g.midiPlayer),"socketPlayer"in g&&n(20,N=g.socketPlayer)},t.$$.update=()=>{t.$$.dirty[0]&4194304&&n(3,[r,i]=jr(a),r,(n(0,i),n(22,a))),t.$$.dirty[0]&1&&J(i)},[i,h,l,r,c,u,p,m,y,_,T,z,k,Q,H,J,X,M,oe,E,N,d,a,U,fe,ee,ae,he,L,ce,ge,xe]}class si extends rt{constructor(e){super(),nt(this,e,ii,ri,He,{pianoControlsData:21,midiPlayer:19,socketPlayer:20},null,[-1,-1])}}function un(t,e,n){const r=t.slice();return r[35]=e[n],r[37]=n,r}function oi(t){let e,n,r,i,o;return{c(){e=b("button"),n=ie("Play"),e.disabled=r=t[3].length==0},m(s,c){O(s,e,c),v(e,n),i||(o=P(e,"click",t[21]),i=!0)},p(s,c){c[0]&8&&r!==(r=s[3].length==0)&&(e.disabled=r)},d(s){s&&F(e),i=!1,o()}}}function ai(t){let e,n,r;return{c(){e=b("button"),e.textContent="Stop"},m(i,o){O(i,e,o),n||(r=P(e,"click",t[20]),n=!0)},p:q,d(i){i&&F(e),n=!1,r()}}}function fn(t){let e,n=t[5]?"single track":"all tracks",r,i,o;return{c(){e=b("button"),r=ie(n),w(e,"title","Click to toggle")},m(s,c){O(s,e,c),v(e,r),i||(o=P(e,"click",t[23]),i=!0)},p(s,c){c[0]&32&&n!==(n=s[5]?"single track":"all tracks")&&ze(r,n)},d(s){s&&F(e),i=!1,o()}}}function hn(t){let e,n,r,i,o,s,c,u,a,p=ke(t[3]),h=[];for(let l=0;l<p.length;l+=1)h[l]=dn(un(t,p,l));return{c(){e=b("select");for(let l=0;l<h.length;l+=1)h[l].c();n=D(),r=b("button"),i=ie("Add Track"),o=D(),s=b("button"),c=ie("Delete Track"),e.disabled=t[1],t[6]===void 0&&Be(()=>t[26].call(e)),r.disabled=t[1],s.disabled=t[1]},m(l,f){O(l,e,f);for(let d=0;d<h.length;d+=1)h[d]&&h[d].m(e,null);Pe(e,t[6],!0),O(l,n,f),O(l,r,f),v(r,i),O(l,o,f),O(l,s,f),v(s,c),u||(a=[P(e,"change",t[26]),P(r,"click",t[27]),P(s,"click",t[28])],u=!0)},p(l,f){if(f[0]&8){p=ke(l[3]);let d;for(d=0;d<p.length;d+=1){const m=un(l,p,d);h[d]?h[d].p(m,f):(h[d]=dn(m),h[d].c(),h[d].m(e,null))}for(;d<h.length;d+=1)h[d].d(1);h.length=p.length}f[0]&2&&(e.disabled=l[1]),f[0]&64&&Pe(e,l[6]),f[0]&2&&(r.disabled=l[1]),f[0]&2&&(s.disabled=l[1])},d(l){l&&(F(e),F(n),F(r),F(o),F(s)),ht(h,l),u=!1,be(a)}}}function dn(t){let e,n=(t[35].name||`[Track ${t[37]}]`)+"",r;return{c(){e=b("option"),r=ie(n),e.__value=t[37],$(e,e.__value)},m(i,o){O(i,e,o),v(e,r)},p(i,o){o[0]&8&&n!==(n=(i[35].name||`[Track ${i[37]}]`)+"")&&ze(r,n)},d(i){i&&F(e)}}}function ci(t){let e,n,r,i,o,s,c,u,a,p,h,l,f,d,m,y,_,T,z,k,E,N,R,Q,H,W,J,X,M,oe,de,V,U,fe,ee,ae=t[4].toFixed(1)+"",he,L,ce=t[8].toFixed(1)+"",ge,xe,g,I;function Z(S,C){return S[2]?ai:oi}let te=Z(t),K=te(t),G=t[3].length>0&&fn(t),j=t[3].length>0&&hn(t);return{c(){e=b("div"),n=b("p"),n.textContent="Play midi:",r=D(),i=b("div"),o=b("input"),s=D(),c=b("div"),K.c(),u=D(),a=b("button"),p=ie("Restart"),l=D(),G&&G.c(),f=D(),d=b("div"),m=b("button"),y=ie("Record"),_=D(),T=b("button"),z=ie("Save"),E=D(),j&&j.c(),N=D(),R=b("div"),Q=b("span"),Q.textContent="Speed",H=D(),W=b("input"),J=D(),X=b("input"),M=D(),oe=b("span"),oe.textContent="times",de=D(),V=b("div"),U=b("input"),fe=D(),ee=b("span"),he=ie(ae),L=ie("/"),ge=ie(ce),xe=ie(" seconds"),w(o,"type","file"),w(o,"accept",".midi,.mid"),o.disabled=t[2],w(i,"class","svelte-1owab3p"),a.disabled=h=t[3].length==0,w(c,"class","svelte-1owab3p"),m.disabled=t[2],T.disabled=k=t[3].length==0||t[2],w(d,"class","svelte-1owab3p"),w(Q,"class","svelte-1owab3p"),w(W,"type","range"),w(W,"min","0.01"),w(W,"max","4"),w(W,"step","0.01"),w(W,"title","Double click to set speed to normal"),w(X,"type","number"),w(X,"min","0.01"),w(oe,"class","svelte-1owab3p"),Oe(R,"display","flex"),w(R,"class","svelte-1owab3p"),w(U,"type","range"),w(U,"min","0"),w(U,"max",t[8]),w(U,"step","0.1"),Oe(U,"width","18rem"),U.disabled=t[1],w(ee,"class","svelte-1owab3p"),Oe(V,"display","flex"),w(V,"class","svelte-1owab3p"),w(e,"class","svelte-1owab3p")},m(S,C){O(S,e,C),v(e,n),v(e,r),v(e,i),v(i,o),v(e,s),v(e,c),K.m(c,null),v(c,u),v(c,a),v(a,p),v(c,l),G&&G.m(c,null),v(e,f),v(e,d),v(d,m),v(m,y),v(d,_),v(d,T),v(T,z),v(d,E),j&&j.m(d,null),v(e,N),v(e,R),v(R,Q),v(R,H),v(R,W),$(W,t[7]),v(R,J),v(R,X),$(X,t[7]),v(R,M),v(R,oe),v(e,de),v(e,V),v(V,U),$(U,t[4]),v(V,fe),v(V,ee),v(ee,he),v(ee,L),v(ee,ge),v(ee,xe),g||(I=[P(o,"change",t[19]),P(a,"click",t[22]),P(m,"click",t[24]),P(T,"click",t[25]),P(W,"change",t[29]),P(W,"input",t[29]),P(W,"click",t[30]),P(X,"input",t[31]),P(U,"change",t[32]),P(U,"input",t[32]),P(U,"mousedown",t[33]),P(U,"mouseup",t[34])],g=!0)},p(S,C){C[0]&4&&(o.disabled=S[2]),te===(te=Z(S))&&K?K.p(S,C):(K.d(1),K=te(S),K&&(K.c(),K.m(c,u))),C[0]&8&&h!==(h=S[3].length==0)&&(a.disabled=h),S[3].length>0?G?G.p(S,C):(G=fn(S),G.c(),G.m(c,null)):G&&(G.d(1),G=null),C[0]&4&&(m.disabled=S[2]),C[0]&12&&k!==(k=S[3].length==0||S[2])&&(T.disabled=k),S[3].length>0?j?j.p(S,C):(j=hn(S),j.c(),j.m(d,null)):j&&(j.d(1),j=null),C[0]&128&&$(W,S[7]),C[0]&128&&Ue(X.value)!==S[7]&&$(X,S[7]),C[0]&256&&w(U,"max",S[8]),C[0]&2&&(U.disabled=S[1]),C[0]&16&&$(U,S[4]),C[0]&16&&ae!==(ae=S[4].toFixed(1)+"")&&ze(he,ae),C[0]&256&&ce!==(ce=S[8].toFixed(1)+"")&&ze(ge,ce)},i:q,o:q,d(S){S&&F(e),K.d(),G&&G.d(),j&&j.d(),g=!1,be(I)}}}function li(t,e,n){let r,i,o,s,c,u,a,p,h,{midiPlayer:l}=e,{isPlaying:f,isRecording:d,currentTime:m,speed:y,totalTime:_,selectedTrack:T,tracks:z,shouldPlaySolo:k}=l;Y(t,f,L=>n(18,o=L)),Y(t,d,L=>n(1,i=L)),Y(t,m,L=>n(4,c=L)),Y(t,y,L=>n(7,p=L)),Y(t,_,L=>n(8,h=L)),Y(t,T,L=>n(6,a=L)),Y(t,z,L=>n(3,s=L)),Y(t,k,L=>n(5,u=L));function E(){l.startRecording(),localStorage.getItem("hasRecordedBefore")||(alert("Play any key to start recording. Recording WILL override the selected track."),localStorage.setItem("hasRecordedBefore","true"))}const N=L=>{var ce;return l.setFile((ce=L.currentTarget.files)==null?void 0:ce[0])},R=()=>l.stopAndReseek(),Q=()=>l.startPlaying(),H=()=>{ue(m,c=0,c),l.stop(),l.lastStartFunc()},W=()=>ue(k,u=!u,u),J=()=>E(),X=()=>l.saveFile();function M(){a=kt(this),T.set(a)}const oe=()=>l.addTrack(),de=()=>l.deleteTrack();function V(){p=Ue(this.value),y.set(p)}const U=L=>{L.detail==2&&ue(y,p=1,p)};function fe(){p=Ue(this.value),y.set(p)}function ee(){c=Ue(this.value),m.set(c)}const ae=()=>l.stop(),he=()=>l.lastStartFunc();return t.$$set=L=>{"midiPlayer"in L&&n(0,l=L.midiPlayer)},t.$$.update=()=>{t.$$.dirty[0]&262146&&n(2,r=o||i)},[l,i,r,s,c,u,a,p,h,f,d,m,y,_,T,z,k,E,o,N,R,Q,H,W,J,X,M,oe,de,V,U,fe,ee,ae,he]}class ui extends rt{constructor(e){super(),nt(this,e,li,ci,He,{midiPlayer:0},null,[-1,-1])}}const pn=["accordion","acoustic_bass","acoustic_grand_piano","acoustic_guitar_nylon","acoustic_guitar_steel","agogo","alto_sax","applause","bagpipe","banjo","baritone_sax","bassoon","bird_tweet","blown_bottle","brass_section","breath_noise","bright_acoustic_piano","celesta","cello","choir_aahs","church_organ","clarinet","clavinet","contrabass","distortion_guitar","drawbar_organ","dulcimer","electric_bass_finger","electric_bass_pick","electric_grand_piano","electric_guitar_clean","electric_guitar_jazz","electric_guitar_muted","electric_piano_1","electric_piano_2","english_horn","fiddle","flute","french_horn","fretless_bass","fx_1_rain","fx_2_soundtrack","fx_3_crystal","fx_4_atmosphere","fx_5_brightness","fx_6_goblins","fx_7_echoes","fx_8_scifi","glockenspiel","guitar_fret_noise","guitar_harmonics","gunshot","harmonica","harpsichord","helicopter","honkytonk_piano","kalimba","koto","lead_1_square","lead_2_sawtooth","lead_3_calliope","lead_4_chiff","lead_5_charang","lead_6_voice","lead_7_fifths","lead_8_bass__lead","marimba","melodic_tom","music_box","muted_trumpet","oboe","ocarina","orchestra_hit","orchestral_harp","overdriven_guitar","pad_1_new_age","pad_2_warm","pad_3_polysynth","pad_4_choir","pad_5_bowed","pad_6_metallic","pad_7_halo","pad_8_sweep","pan_flute","percussive_organ","piccolo","pizzicato_strings","recorder","reed_organ","reverse_cymbal","rock_organ","seashore","shakuhachi","shamisen","shanai","sitar","slap_bass_1","slap_bass_2","soprano_sax","steel_drums","string_ensemble_1","string_ensemble_2","synth_bass_1","synth_bass_2","synth_brass_1","synth_brass_2","synth_choir","synth_drum","synth_strings_1","synth_strings_2","taiko_drum","tango_accordion","telephone_ring","tenor_sax","timpani","tinkle_bell","tremolo_strings","trombone","trumpet","tuba","tubular_bells","vibraphone","viola","violin","voice_oohs","whistle","woodblock","xylophone"],zn="data:image/svg+xml,%3c!--%20Taken%20from%20https://github.com/n3r4zzurr0/svg-spinners%20--%3e%3csvg%20width='24'%20height='24'%20stroke='%23fff'%20viewBox='0%200%2024%2024'%20xmlns='http://www.w3.org/2000/svg'%3e%3cstyle%3e.spinner_V8m1{transform-origin:center;animation:spinner_zKoa%202s%20linear%20infinite}.spinner_V8m1%20circle{stroke-linecap:round;animation:spinner_YpZS%201.5s%20ease-in-out%20infinite}@keyframes%20spinner_zKoa{100%25{transform:rotate(360deg)}}@keyframes%20spinner_YpZS{0%25{stroke-dasharray:0%20150;stroke-dashoffset:0}47.5%25{stroke-dasharray:42%20150;stroke-dashoffset:-16}95%25,100%25{stroke-dasharray:42%20150;stroke-dashoffset:-59}}%3c/style%3e%3cg%20class='spinner_V8m1'%3e%3ccircle%20cx='12'%20cy='12'%20r='9.5'%20fill='none'%20stroke-width='3'%3e%3c/circle%3e%3c/g%3e%3c/svg%3e";function mn(t,e,n){const r=t.slice();return r[26]=e[n],r}function yn(t,e,n){const r=t.slice();return r[29]=e[n],r}function vn(t){let e;return{c(){e=b("option"),e.textContent=`${Rn(t[29])}`,e.__value=t[29],$(e,e.__value)},m(n,r){O(n,e,r)},p:q,d(n){n&&F(e)}}}function fi(t){return{c:q,m:q,d:q}}function hi(t){return{c:q,m:q,d:q}}function di(t){let e,n;return{c(){e=b("img"),Mn(e.src,n=zn)||w(e,"src",n),w(e,"alt","spinner")},m(r,i){O(r,e,i)},d(r){r&&F(e)}}}function gn(t){let e,n=Rn(t[26])+"",r;return{c(){e=b("option"),r=ie(n),e.__value=t[26],$(e,e.__value)},m(i,o){O(i,e,o),v(e,r)},p:q,d(i){i&&F(e)}}}function pi(t){let e,n,r,i,o,s,c,u,a,p,h,l,f,d,m,y,_,T,z,k,E,N,R,Q,H,W,J,X,M,oe,de,V,U,fe,ee,ae,he,L,ce,ge,xe,g,I,Z,te=ke(pn),K=[];for(let C=0;C<te.length;C+=1)K[C]=vn(yn(t,te,C));let G={ctx:t,current:null,token:null,hasCatch:!1,pending:di,then:hi,catch:fi};rn(J=t[1],G);let j=ke(_n),S=[];for(let C=0;C<j.length;C+=1)S[C]=gn(mn(t,j,C));return{c(){e=b("div"),n=b("div"),r=b("span"),r.textContent="Sustain",i=D(),o=b("input"),s=D(),c=b("div"),u=b("span"),u.textContent="Tranpose",a=D(),p=b("input"),h=D(),l=b("input"),f=D(),d=b("div"),m=b("span"),m.textContent="Volume",y=D(),_=b("input"),T=D(),z=b("span"),k=ie(t[5]),E=D(),N=b("div"),R=b("span"),R.textContent="Instrument",Q=D(),H=b("select");for(let C=0;C<K.length;C+=1)K[C].c();W=D(),G.block.c(),X=D(),M=b("div"),oe=b("span"),oe.textContent="Size",de=D(),V=b("select"),U=b("option"),U.textContent="Full size (88 keys)",fe=b("option"),fe.textContent="Half size (61 keys)",ee=b("option"),ee.textContent="Quater Size (37 keys)",ae=b("option"),ae.textContent="2 Octaves (24 keys)",he=b("option"),he.textContent="1 Octave (12 keys)",L=D(),ce=b("div"),ge=b("span"),ge.textContent="Labels",xe=D(),g=b("select");for(let C=0;C<S.length;C+=1)S[C].c();w(r,"class","svelte-1ue5508"),w(o,"type","checkbox"),w(n,"title","Shortcut: space"),w(n,"class","svelte-1ue5508"),w(u,"title","Double click to reset"),w(u,"class","svelte-1ue5508"),w(p,"title","Note shift (shortcut: left ctrl + left alt)"),w(p,"type","number"),w(l,"title","Octave shift (shortcut: right alt + right ctrl)"),w(l,"type","number"),w(c,"class","svelte-1ue5508"),w(m,"class","svelte-1ue5508"),w(_,"type","range"),w(_,"min","0"),w(_,"max","10"),w(_,"step","0.1"),Oe(_,"width","8rem"),w(z,"class","svelte-1ue5508"),w(d,"class","svelte-1ue5508"),w(R,"class","svelte-1ue5508"),t[0]===void 0&&Be(()=>t[23].call(H)),w(N,"class","svelte-1ue5508"),w(oe,"class","svelte-1ue5508"),U.__value="A0,C8",$(U,U.__value),fe.__value="C2,C7",$(fe,fe.__value),ee.__value="C3,C6",$(ee,ee.__value),ae.__value="C4,B5",$(ae,ae.__value),he.__value="C4,B4",$(he,he.__value),t[6]===void 0&&Be(()=>t[24].call(V)),w(M,"class","svelte-1ue5508"),w(ge,"class","svelte-1ue5508"),t[7]===void 0&&Be(()=>t[25].call(g)),w(ce,"class","svelte-1ue5508"),w(e,"class","option-list svelte-1ue5508")},m(C,pe){O(C,e,pe),v(e,n),v(n,r),v(n,i),v(n,o),o.checked=t[2],v(e,s),v(e,c),v(c,u),v(c,a),v(c,p),$(p,t[4]),v(c,h),v(c,l),$(l,t[3]),v(e,f),v(e,d),v(d,m),v(d,y),v(d,_),$(_,t[5]),v(d,T),v(d,z),v(z,k),v(e,E),v(e,N),v(N,R),v(N,Q),v(N,H);for(let B=0;B<K.length;B+=1)K[B]&&K[B].m(H,null);Pe(H,t[0],!0),v(N,W),G.block.m(N,G.anchor=null),G.mount=()=>N,G.anchor=null,v(e,X),v(e,M),v(M,oe),v(M,de),v(M,V),v(V,U),v(V,fe),v(V,ee),v(V,ae),v(V,he),Pe(V,t[6],!0),v(e,L),v(e,ce),v(ce,ge),v(ce,xe),v(ce,g);for(let B=0;B<S.length;B+=1)S[B]&&S[B].m(g,null);Pe(g,t[7],!0),I||(Z=[P(window,"keydown",t[14]),P(window,"keyup",t[15]),P(o,"change",t[18]),P(u,"click",t[19]),P(p,"input",t[20]),P(l,"input",t[21]),P(_,"change",t[22]),P(_,"input",t[22]),P(H,"change",t[23]),P(V,"change",t[24]),P(g,"change",t[25])],I=!0)},p(C,pe){if(t=C,pe[0]&4&&(o.checked=t[2]),pe[0]&16&&Ue(p.value)!==t[4]&&$(p,t[4]),pe[0]&8&&Ue(l.value)!==t[3]&&$(l,t[3]),pe[0]&32&&$(_,t[5]),pe[0]&32&&ze(k,t[5]),pe&0){te=ke(pn);let B;for(B=0;B<te.length;B+=1){const it=yn(t,te,B);K[B]?K[B].p(it,pe):(K[B]=vn(it),K[B].c(),K[B].m(H,null))}for(;B<K.length;B+=1)K[B].d(1);K.length=te.length}if(pe[0]&1&&Pe(H,t[0]),G.ctx=t,pe[0]&2&&J!==(J=t[1])&&rn(J,G),pe[0]&64&&Pe(V,t[6]),pe&0){j=ke(_n);let B;for(B=0;B<j.length;B+=1){const it=mn(t,j,B);S[B]?S[B].p(it,pe):(S[B]=gn(it),S[B].c(),S[B].m(g,null))}for(;B<S.length;B+=1)S[B].d(1);S.length=j.length}pe[0]&128&&Pe(g,t[7])},i:q,o:q,d(C){C&&F(e),ht(K,C),G.block.d(),G.token=null,G=null,ht(S,C),I=!1,be(Z)}}}const _n=["none","notes","keybinds"];class mi{constructor(){A(this,"octaveShift",le(0));A(this,"noteShift",le(0));A(this,"sustain",le(!1));A(this,"volume",le(10));A(this,"noteRange",le("C2,C7"));A(this,"labelType",le("keybinds"))}}function Rn(t){return t.split("_").map(r=>r.charAt(0).toUpperCase()+r.slice(1)).join(" ")}function yi(t,e,n){let r,i,o,s,c,u,a,{pianoControlsData:p}=e,{socketPlayer:h}=e,l="acoustic_grand_piano",{noteRange:f,sustain:d,noteShift:m,octaveShift:y,volume:_,labelType:T}=p;Y(t,f,M=>n(6,u=M)),Y(t,d,M=>n(2,i=M)),Y(t,m,M=>n(4,s=M)),Y(t,y,M=>n(3,o=M)),Y(t,_,M=>n(5,c=M)),Y(t,T,M=>n(7,a=M));function z(M){if(M.target.tagName!=="INPUT")switch(M.code){case"Space":ue(d,i=!0,i);break;case"ControlLeft":ue(m,s-=1,s);break;case"AltLeft":ue(m,s+=1,s);break;case"AltRight":ue(y,o-=1,o);break;case"ControlRight":ue(y,o+=1,o);break}}m.subscribe(()=>{s>=12?(ue(y,o+=1,o),ue(m,s=0,s)):s<=-12&&(ue(y,o-=1,o),ue(m,s=0,s))}),y.subscribe(()=>{o<-3?ue(y,o=3,o):o>3&&ue(y,o=-3,o)});function k(M){M.code==="Space"&&ue(d,i=!1,i)}function E(){i=this.checked,d.set(i)}const N=M=>{M.detail==2&&(ue(m,s=0,s),ue(y,o=0,o))};function R(){s=Ue(this.value),m.set(s)}function Q(){o=Ue(this.value),y.set(o)}function H(){c=Ue(this.value),_.set(c)}function W(){l=kt(this),n(0,l)}function J(){u=kt(this),f.set(u)}function X(){a=kt(this),T.set(a)}return t.$$set=M=>{"pianoControlsData"in M&&n(16,p=M.pianoControlsData),"socketPlayer"in M&&n(17,h=M.socketPlayer)},t.$$.update=()=>{t.$$.dirty[0]&131073&&n(1,r=h.changeInstrument(l))},[l,r,i,o,s,c,u,a,f,d,m,y,_,T,z,k,p,h,E,N,R,Q,H,W,J,X]}class vi extends rt{constructor(e){super(),nt(this,e,yi,pi,He,{pianoControlsData:16,socketPlayer:17},null,[-1,-1])}}function gi(t){for(var e=t.length,n=0,r=0;r<e;){var i=t.charCodeAt(r++);if(i&4294967168)if(!(i&4294965248))n+=2;else{if(i>=55296&&i<=56319&&r<e){var o=t.charCodeAt(r);(o&64512)===56320&&(++r,i=((i&1023)<<10)+(o&1023)+65536)}i&4294901760?n+=4:n+=3}else{n++;continue}}return n}function _i(t,e,n){for(var r=t.length,i=n,o=0;o<r;){var s=t.charCodeAt(o++);if(s&4294967168)if(!(s&4294965248))e[i++]=s>>6&31|192;else{if(s>=55296&&s<=56319&&o<r){var c=t.charCodeAt(o);(c&64512)===56320&&(++o,s=((s&1023)<<10)+(c&1023)+65536)}s&4294901760?(e[i++]=s>>18&7|240,e[i++]=s>>12&63|128,e[i++]=s>>6&63|128):(e[i++]=s>>12&15|224,e[i++]=s>>6&63|128)}else{e[i++]=s;continue}e[i++]=s&63|128}}var bi=new TextEncoder,wi=50;function ki(t,e,n){bi.encodeInto(t,e.subarray(n))}function xi(t,e,n){t.length>wi?ki(t,e,n):_i(t,e,n)}var Ii=4096;function Hn(t,e,n){for(var r=e,i=r+n,o=[],s="";r<i;){var c=t[r++];if(!(c&128))o.push(c);else if((c&224)===192){var u=t[r++]&63;o.push((c&31)<<6|u)}else if((c&240)===224){var u=t[r++]&63,a=t[r++]&63;o.push((c&31)<<12|u<<6|a)}else if((c&248)===240){var u=t[r++]&63,a=t[r++]&63,p=t[r++]&63,h=(c&7)<<18|u<<12|a<<6|p;h>65535&&(h-=65536,o.push(h>>>10&1023|55296),h=56320|h&1023),o.push(h)}else o.push(c);o.length>=Ii&&(s+=String.fromCharCode.apply(String,o),o.length=0)}return o.length>0&&(s+=String.fromCharCode.apply(String,o)),s}var Ti=new TextDecoder,Ui=200;function Si(t,e,n){var r=t.subarray(e,e+n);return Ti.decode(r)}function Ci(t,e,n){return n>Ui?Si(t,e,n):Hn(t,e,n)}var bt=function(){function t(e,n){this.type=e,this.data=n}return t}(),Pi=function(){var t=function(e,n){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,i){r.__proto__=i}||function(r,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(r[o]=i[o])},t(e,n)};return function(e,n){if(typeof n!="function"&&n!==null)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");t(e,n);function r(){this.constructor=e}e.prototype=n===null?Object.create(n):(r.prototype=n.prototype,new r)}}(),we=function(t){Pi(e,t);function e(n){var r=t.call(this,n)||this,i=Object.create(e.prototype);return Object.setPrototypeOf(r,i),Object.defineProperty(r,"name",{configurable:!0,enumerable:!1,value:e.name}),r}return e}(Error),ot=4294967295;function Ei(t,e,n){var r=n/4294967296,i=n;t.setUint32(e,r),t.setUint32(e+4,i)}function Vn(t,e,n){var r=Math.floor(n/4294967296),i=n;t.setUint32(e,r),t.setUint32(e+4,i)}function Kn(t,e){var n=t.getInt32(e),r=t.getUint32(e+4);return n*4294967296+r}function Mi(t,e){var n=t.getUint32(e),r=t.getUint32(e+4);return n*4294967296+r}var Ai=-1,Di=4294967296-1,Ni=17179869184-1;function Fi(t){var e=t.sec,n=t.nsec;if(e>=0&&n>=0&&e<=Ni)if(n===0&&e<=Di){var r=new Uint8Array(4),i=new DataView(r.buffer);return i.setUint32(0,e),r}else{var o=e/4294967296,s=e&4294967295,r=new Uint8Array(8),i=new DataView(r.buffer);return i.setUint32(0,n<<2|o&3),i.setUint32(4,s),r}else{var r=new Uint8Array(12),i=new DataView(r.buffer);return i.setUint32(0,n),Vn(i,4,e),r}}function Oi(t){var e=t.getTime(),n=Math.floor(e/1e3),r=(e-n*1e3)*1e6,i=Math.floor(r/1e9);return{sec:n+i,nsec:r-i*1e9}}function Bi(t){if(t instanceof Date){var e=Oi(t);return Fi(e)}else return null}function Li(t){var e=new DataView(t.buffer,t.byteOffset,t.byteLength);switch(t.byteLength){case 4:{var n=e.getUint32(0),r=0;return{sec:n,nsec:r}}case 8:{var i=e.getUint32(0),o=e.getUint32(4),n=(i&3)*4294967296+o,r=i>>>2;return{sec:n,nsec:r}}case 12:{var n=Kn(e,4),r=e.getUint32(0);return{sec:n,nsec:r}}default:throw new we("Unrecognized data size for timestamp (expected 4, 8, or 12): ".concat(t.length))}}function zi(t){var e=Li(t);return new Date(e.sec*1e3+e.nsec/1e6)}var Ri={type:Ai,encode:Bi,decode:zi},Wn=function(){function t(){this.builtInEncoders=[],this.builtInDecoders=[],this.encoders=[],this.decoders=[],this.register(Ri)}return t.prototype.register=function(e){var n=e.type,r=e.encode,i=e.decode;if(n>=0)this.encoders[n]=r,this.decoders[n]=i;else{var o=1+n;this.builtInEncoders[o]=r,this.builtInDecoders[o]=i}},t.prototype.tryToEncode=function(e,n){for(var r=0;r<this.builtInEncoders.length;r++){var i=this.builtInEncoders[r];if(i!=null){var o=i(e,n);if(o!=null){var s=-1-r;return new bt(s,o)}}}for(var r=0;r<this.encoders.length;r++){var i=this.encoders[r];if(i!=null){var o=i(e,n);if(o!=null){var s=r;return new bt(s,o)}}}return e instanceof bt?e:null},t.prototype.decode=function(e,n,r){var i=n<0?this.builtInDecoders[-1-n]:this.decoders[n];return i?i(e,n,r):new bt(n,e)},t.defaultCodec=new t,t}();function Mt(t){return t instanceof Uint8Array?t:ArrayBuffer.isView(t)?new Uint8Array(t.buffer,t.byteOffset,t.byteLength):t instanceof ArrayBuffer?new Uint8Array(t):Uint8Array.from(t)}function Hi(t){if(t instanceof ArrayBuffer)return new DataView(t);var e=Mt(t);return new DataView(e.buffer,e.byteOffset,e.byteLength)}var Vi=100,Ki=2048,Wi=function(){function t(e){var n,r,i,o,s,c,u,a;this.extensionCodec=(n=e==null?void 0:e.extensionCodec)!==null&&n!==void 0?n:Wn.defaultCodec,this.context=e==null?void 0:e.context,this.useBigInt64=(r=e==null?void 0:e.useBigInt64)!==null&&r!==void 0?r:!1,this.maxDepth=(i=e==null?void 0:e.maxDepth)!==null&&i!==void 0?i:Vi,this.initialBufferSize=(o=e==null?void 0:e.initialBufferSize)!==null&&o!==void 0?o:Ki,this.sortKeys=(s=e==null?void 0:e.sortKeys)!==null&&s!==void 0?s:!1,this.forceFloat32=(c=e==null?void 0:e.forceFloat32)!==null&&c!==void 0?c:!1,this.ignoreUndefined=(u=e==null?void 0:e.ignoreUndefined)!==null&&u!==void 0?u:!1,this.forceIntegerToFloat=(a=e==null?void 0:e.forceIntegerToFloat)!==null&&a!==void 0?a:!1,this.pos=0,this.view=new DataView(new ArrayBuffer(this.initialBufferSize)),this.bytes=new Uint8Array(this.view.buffer)}return t.prototype.reinitializeState=function(){this.pos=0},t.prototype.encodeSharedRef=function(e){return this.reinitializeState(),this.doEncode(e,1),this.bytes.subarray(0,this.pos)},t.prototype.encode=function(e){return this.reinitializeState(),this.doEncode(e,1),this.bytes.slice(0,this.pos)},t.prototype.doEncode=function(e,n){if(n>this.maxDepth)throw new Error("Too deep objects in depth ".concat(n));e==null?this.encodeNil():typeof e=="boolean"?this.encodeBoolean(e):typeof e=="number"?this.forceIntegerToFloat?this.encodeNumberAsFloat(e):this.encodeNumber(e):typeof e=="string"?this.encodeString(e):this.useBigInt64&&typeof e=="bigint"?this.encodeBigInt64(e):this.encodeObject(e,n)},t.prototype.ensureBufferSizeToWrite=function(e){var n=this.pos+e;this.view.byteLength<n&&this.resizeBuffer(n*2)},t.prototype.resizeBuffer=function(e){var n=new ArrayBuffer(e),r=new Uint8Array(n),i=new DataView(n);r.set(this.bytes),this.view=i,this.bytes=r},t.prototype.encodeNil=function(){this.writeU8(192)},t.prototype.encodeBoolean=function(e){e===!1?this.writeU8(194):this.writeU8(195)},t.prototype.encodeNumber=function(e){!this.forceIntegerToFloat&&Number.isSafeInteger(e)?e>=0?e<128?this.writeU8(e):e<256?(this.writeU8(204),this.writeU8(e)):e<65536?(this.writeU8(205),this.writeU16(e)):e<4294967296?(this.writeU8(206),this.writeU32(e)):this.useBigInt64?this.encodeNumberAsFloat(e):(this.writeU8(207),this.writeU64(e)):e>=-32?this.writeU8(224|e+32):e>=-128?(this.writeU8(208),this.writeI8(e)):e>=-32768?(this.writeU8(209),this.writeI16(e)):e>=-2147483648?(this.writeU8(210),this.writeI32(e)):this.useBigInt64?this.encodeNumberAsFloat(e):(this.writeU8(211),this.writeI64(e)):this.encodeNumberAsFloat(e)},t.prototype.encodeNumberAsFloat=function(e){this.forceFloat32?(this.writeU8(202),this.writeF32(e)):(this.writeU8(203),this.writeF64(e))},t.prototype.encodeBigInt64=function(e){e>=BigInt(0)?(this.writeU8(207),this.writeBigUint64(e)):(this.writeU8(211),this.writeBigInt64(e))},t.prototype.writeStringHeader=function(e){if(e<32)this.writeU8(160+e);else if(e<256)this.writeU8(217),this.writeU8(e);else if(e<65536)this.writeU8(218),this.writeU16(e);else if(e<4294967296)this.writeU8(219),this.writeU32(e);else throw new Error("Too long string: ".concat(e," bytes in UTF-8"))},t.prototype.encodeString=function(e){var n=5,r=gi(e);this.ensureBufferSizeToWrite(n+r),this.writeStringHeader(r),xi(e,this.bytes,this.pos),this.pos+=r},t.prototype.encodeObject=function(e,n){var r=this.extensionCodec.tryToEncode(e,this.context);if(r!=null)this.encodeExtension(r);else if(Array.isArray(e))this.encodeArray(e,n);else if(ArrayBuffer.isView(e))this.encodeBinary(e);else if(typeof e=="object")this.encodeMap(e,n);else throw new Error("Unrecognized object: ".concat(Object.prototype.toString.apply(e)))},t.prototype.encodeBinary=function(e){var n=e.byteLength;if(n<256)this.writeU8(196),this.writeU8(n);else if(n<65536)this.writeU8(197),this.writeU16(n);else if(n<4294967296)this.writeU8(198),this.writeU32(n);else throw new Error("Too large binary: ".concat(n));var r=Mt(e);this.writeU8a(r)},t.prototype.encodeArray=function(e,n){var r=e.length;if(r<16)this.writeU8(144+r);else if(r<65536)this.writeU8(220),this.writeU16(r);else if(r<4294967296)this.writeU8(221),this.writeU32(r);else throw new Error("Too large array: ".concat(r));for(var i=0,o=e;i<o.length;i++){var s=o[i];this.doEncode(s,n+1)}},t.prototype.countWithoutUndefined=function(e,n){for(var r=0,i=0,o=n;i<o.length;i++){var s=o[i];e[s]!==void 0&&r++}return r},t.prototype.encodeMap=function(e,n){var r=Object.keys(e);this.sortKeys&&r.sort();var i=this.ignoreUndefined?this.countWithoutUndefined(e,r):r.length;if(i<16)this.writeU8(128+i);else if(i<65536)this.writeU8(222),this.writeU16(i);else if(i<4294967296)this.writeU8(223),this.writeU32(i);else throw new Error("Too large map object: ".concat(i));for(var o=0,s=r;o<s.length;o++){var c=s[o],u=e[c];this.ignoreUndefined&&u===void 0||(this.encodeString(c),this.doEncode(u,n+1))}},t.prototype.encodeExtension=function(e){var n=e.data.length;if(n===1)this.writeU8(212);else if(n===2)this.writeU8(213);else if(n===4)this.writeU8(214);else if(n===8)this.writeU8(215);else if(n===16)this.writeU8(216);else if(n<256)this.writeU8(199),this.writeU8(n);else if(n<65536)this.writeU8(200),this.writeU16(n);else if(n<4294967296)this.writeU8(201),this.writeU32(n);else throw new Error("Too large extension object: ".concat(n));this.writeI8(e.type),this.writeU8a(e.data)},t.prototype.writeU8=function(e){this.ensureBufferSizeToWrite(1),this.view.setUint8(this.pos,e),this.pos++},t.prototype.writeU8a=function(e){var n=e.length;this.ensureBufferSizeToWrite(n),this.bytes.set(e,this.pos),this.pos+=n},t.prototype.writeI8=function(e){this.ensureBufferSizeToWrite(1),this.view.setInt8(this.pos,e),this.pos++},t.prototype.writeU16=function(e){this.ensureBufferSizeToWrite(2),this.view.setUint16(this.pos,e),this.pos+=2},t.prototype.writeI16=function(e){this.ensureBufferSizeToWrite(2),this.view.setInt16(this.pos,e),this.pos+=2},t.prototype.writeU32=function(e){this.ensureBufferSizeToWrite(4),this.view.setUint32(this.pos,e),this.pos+=4},t.prototype.writeI32=function(e){this.ensureBufferSizeToWrite(4),this.view.setInt32(this.pos,e),this.pos+=4},t.prototype.writeF32=function(e){this.ensureBufferSizeToWrite(4),this.view.setFloat32(this.pos,e),this.pos+=4},t.prototype.writeF64=function(e){this.ensureBufferSizeToWrite(8),this.view.setFloat64(this.pos,e),this.pos+=8},t.prototype.writeU64=function(e){this.ensureBufferSizeToWrite(8),Ei(this.view,this.pos,e),this.pos+=8},t.prototype.writeI64=function(e){this.ensureBufferSizeToWrite(8),Vn(this.view,this.pos,e),this.pos+=8},t.prototype.writeBigUint64=function(e){this.ensureBufferSizeToWrite(8),this.view.setBigUint64(this.pos,e),this.pos+=8},t.prototype.writeBigInt64=function(e){this.ensureBufferSizeToWrite(8),this.view.setBigInt64(this.pos,e),this.pos+=8},t}();function Gi(t,e){var n=new Wi(e);return n.encodeSharedRef(t)}function Ht(t){return"".concat(t<0?"-":"","0x").concat(Math.abs(t).toString(16).padStart(2,"0"))}var qi=16,Ji=16,Xi=function(){function t(e,n){e===void 0&&(e=qi),n===void 0&&(n=Ji),this.maxKeyLength=e,this.maxLengthPerKey=n,this.hit=0,this.miss=0,this.caches=[];for(var r=0;r<this.maxKeyLength;r++)this.caches.push([])}return t.prototype.canBeCached=function(e){return e>0&&e<=this.maxKeyLength},t.prototype.find=function(e,n,r){var i=this.caches[r-1];e:for(var o=0,s=i;o<s.length;o++){for(var c=s[o],u=c.bytes,a=0;a<r;a++)if(u[a]!==e[n+a])continue e;return c.str}return null},t.prototype.store=function(e,n){var r=this.caches[e.length-1],i={bytes:e,str:n};r.length>=this.maxLengthPerKey?r[Math.random()*r.length|0]=i:r.push(i)},t.prototype.decode=function(e,n,r){var i=this.find(e,n,r);if(i!=null)return this.hit++,i;this.miss++;var o=Hn(e,n,r),s=Uint8Array.prototype.slice.call(e,n,n+r);return this.store(s,o),o},t}(),Yi=function(t,e,n,r){function i(o){return o instanceof n?o:new n(function(s){s(o)})}return new(n||(n=Promise))(function(o,s){function c(p){try{a(r.next(p))}catch(h){s(h)}}function u(p){try{a(r.throw(p))}catch(h){s(h)}}function a(p){p.done?o(p.value):i(p.value).then(c,u)}a((r=r.apply(t,e||[])).next())})},Vt=function(t,e){var n={label:0,sent:function(){if(o[0]&1)throw o[1];return o[1]},trys:[],ops:[]},r,i,o,s;return s={next:c(0),throw:c(1),return:c(2)},typeof Symbol=="function"&&(s[Symbol.iterator]=function(){return this}),s;function c(a){return function(p){return u([a,p])}}function u(a){if(r)throw new TypeError("Generator is already executing.");for(;s&&(s=0,a[0]&&(n=0)),n;)try{if(r=1,i&&(o=a[0]&2?i.return:a[0]?i.throw||((o=i.return)&&o.call(i),0):i.next)&&!(o=o.call(i,a[1])).done)return o;switch(i=0,o&&(a=[a[0]&2,o.value]),a[0]){case 0:case 1:o=a;break;case 4:return n.label++,{value:a[1],done:!1};case 5:n.label++,i=a[1],a=[0];continue;case 7:a=n.ops.pop(),n.trys.pop();continue;default:if(o=n.trys,!(o=o.length>0&&o[o.length-1])&&(a[0]===6||a[0]===2)){n=0;continue}if(a[0]===3&&(!o||a[1]>o[0]&&a[1]<o[3])){n.label=a[1];break}if(a[0]===6&&n.label<o[1]){n.label=o[1],o=a;break}if(o&&n.label<o[2]){n.label=o[2],n.ops.push(a);break}o[2]&&n.ops.pop(),n.trys.pop();continue}a=e.call(t,n)}catch(p){a=[6,p],i=0}finally{r=o=0}if(a[0]&5)throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}},bn=function(t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var e=t[Symbol.asyncIterator],n;return e?e.call(t):(t=typeof __values=="function"?__values(t):t[Symbol.iterator](),n={},r("next"),r("throw"),r("return"),n[Symbol.asyncIterator]=function(){return this},n);function r(o){n[o]=t[o]&&function(s){return new Promise(function(c,u){s=t[o](s),i(c,u,s.done,s.value)})}}function i(o,s,c,u){Promise.resolve(u).then(function(a){o({value:a,done:c})},s)}},tt=function(t){return this instanceof tt?(this.v=t,this):new tt(t)},Qi=function(t,e,n){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var r=n.apply(t,e||[]),i,o=[];return i={},s("next"),s("throw"),s("return"),i[Symbol.asyncIterator]=function(){return this},i;function s(l){r[l]&&(i[l]=function(f){return new Promise(function(d,m){o.push([l,f,d,m])>1||c(l,f)})})}function c(l,f){try{u(r[l](f))}catch(d){h(o[0][3],d)}}function u(l){l.value instanceof tt?Promise.resolve(l.value.v).then(a,p):h(o[0][2],l)}function a(l){c("next",l)}function p(l){c("throw",l)}function h(l,f){l(f),o.shift(),o.length&&c(o[0][0],o[0][1])}},wn="array",wt="map_key",Zi="map_value",$i=function(t){return typeof t=="string"||typeof t=="number"},at=-1,$t=new DataView(new ArrayBuffer(0)),ji=new Uint8Array($t.buffer);try{$t.getInt8(0)}catch(t){if(!(t instanceof RangeError))throw new Error("This module is not supported in the current JavaScript engine because DataView does not throw RangeError on out-of-bounds access")}var Yt=RangeError,kn=new Yt("Insufficient data"),es=new Xi,ts=function(){function t(e){var n,r,i,o,s,c,u;this.totalPos=0,this.pos=0,this.view=$t,this.bytes=ji,this.headByte=at,this.stack=[],this.extensionCodec=(n=e==null?void 0:e.extensionCodec)!==null&&n!==void 0?n:Wn.defaultCodec,this.context=e==null?void 0:e.context,this.useBigInt64=(r=e==null?void 0:e.useBigInt64)!==null&&r!==void 0?r:!1,this.maxStrLength=(i=e==null?void 0:e.maxStrLength)!==null&&i!==void 0?i:ot,this.maxBinLength=(o=e==null?void 0:e.maxBinLength)!==null&&o!==void 0?o:ot,this.maxArrayLength=(s=e==null?void 0:e.maxArrayLength)!==null&&s!==void 0?s:ot,this.maxMapLength=(c=e==null?void 0:e.maxMapLength)!==null&&c!==void 0?c:ot,this.maxExtLength=(u=e==null?void 0:e.maxExtLength)!==null&&u!==void 0?u:ot,this.keyDecoder=(e==null?void 0:e.keyDecoder)!==void 0?e.keyDecoder:es}return t.prototype.reinitializeState=function(){this.totalPos=0,this.headByte=at,this.stack.length=0},t.prototype.setBuffer=function(e){this.bytes=Mt(e),this.view=Hi(this.bytes),this.pos=0},t.prototype.appendBuffer=function(e){if(this.headByte===at&&!this.hasRemaining(1))this.setBuffer(e);else{var n=this.bytes.subarray(this.pos),r=Mt(e),i=new Uint8Array(n.length+r.length);i.set(n),i.set(r,n.length),this.setBuffer(i)}},t.prototype.hasRemaining=function(e){return this.view.byteLength-this.pos>=e},t.prototype.createExtraByteError=function(e){var n=this,r=n.view,i=n.pos;return new RangeError("Extra ".concat(r.byteLength-i," of ").concat(r.byteLength," byte(s) found at buffer[").concat(e,"]"))},t.prototype.decode=function(e){this.reinitializeState(),this.setBuffer(e);var n=this.doDecodeSync();if(this.hasRemaining(1))throw this.createExtraByteError(this.pos);return n},t.prototype.decodeMulti=function(e){return Vt(this,function(n){switch(n.label){case 0:this.reinitializeState(),this.setBuffer(e),n.label=1;case 1:return this.hasRemaining(1)?[4,this.doDecodeSync()]:[3,3];case 2:return n.sent(),[3,1];case 3:return[2]}})},t.prototype.decodeAsync=function(e){var n,r,i,o,s,c,u;return Yi(this,void 0,void 0,function(){var a,p,h,l,f,d,m,y;return Vt(this,function(_){switch(_.label){case 0:a=!1,_.label=1;case 1:_.trys.push([1,6,7,12]),n=!0,r=bn(e),_.label=2;case 2:return[4,r.next()];case 3:if(i=_.sent(),o=i.done,!!o)return[3,5];u=i.value,n=!1;try{if(h=u,a)throw this.createExtraByteError(this.totalPos);this.appendBuffer(h);try{p=this.doDecodeSync(),a=!0}catch(T){if(!(T instanceof Yt))throw T}this.totalPos+=this.pos}finally{n=!0}_.label=4;case 4:return[3,2];case 5:return[3,12];case 6:return l=_.sent(),s={error:l},[3,12];case 7:return _.trys.push([7,,10,11]),!n&&!o&&(c=r.return)?[4,c.call(r)]:[3,9];case 8:_.sent(),_.label=9;case 9:return[3,11];case 10:if(s)throw s.error;return[7];case 11:return[7];case 12:if(a){if(this.hasRemaining(1))throw this.createExtraByteError(this.totalPos);return[2,p]}throw f=this,d=f.headByte,m=f.pos,y=f.totalPos,new RangeError("Insufficient data in parsing ".concat(Ht(d)," at ").concat(y," (").concat(m," in the current buffer)"))}})})},t.prototype.decodeArrayStream=function(e){return this.decodeMultiAsync(e,!0)},t.prototype.decodeStream=function(e){return this.decodeMultiAsync(e,!1)},t.prototype.decodeMultiAsync=function(e,n){return Qi(this,arguments,function(){var i,o,s,c,u,a,p,h,l,f,d,m;return Vt(this,function(y){switch(y.label){case 0:i=n,o=-1,y.label=1;case 1:y.trys.push([1,15,16,21]),s=!0,c=bn(e),y.label=2;case 2:return[4,tt(c.next())];case 3:if(u=y.sent(),l=u.done,!!l)return[3,14];m=u.value,s=!1,y.label=4;case 4:if(y.trys.push([4,,12,13]),a=m,n&&o===0)throw this.createExtraByteError(this.totalPos);this.appendBuffer(a),i&&(o=this.readArraySize(),i=!1,this.complete()),y.label=5;case 5:y.trys.push([5,10,,11]),y.label=6;case 6:return[4,tt(this.doDecodeSync())];case 7:return[4,y.sent()];case 8:return y.sent(),--o===0?[3,9]:[3,6];case 9:return[3,11];case 10:if(p=y.sent(),!(p instanceof Yt))throw p;return[3,11];case 11:return this.totalPos+=this.pos,[3,13];case 12:return s=!0,[7];case 13:return[3,2];case 14:return[3,21];case 15:return h=y.sent(),f={error:h},[3,21];case 16:return y.trys.push([16,,19,20]),!s&&!l&&(d=c.return)?[4,tt(d.call(c))]:[3,18];case 17:y.sent(),y.label=18;case 18:return[3,20];case 19:if(f)throw f.error;return[7];case 20:return[7];case 21:return[2]}})})},t.prototype.doDecodeSync=function(){e:for(;;){var e=this.readHeadByte(),n=void 0;if(e>=224)n=e-256;else if(e<192)if(e<128)n=e;else if(e<144){var r=e-128;if(r!==0){this.pushMapState(r),this.complete();continue e}else n={}}else if(e<160){var r=e-144;if(r!==0){this.pushArrayState(r),this.complete();continue e}else n=[]}else{var i=e-160;n=this.decodeUtf8String(i,0)}else if(e===192)n=null;else if(e===194)n=!1;else if(e===195)n=!0;else if(e===202)n=this.readF32();else if(e===203)n=this.readF64();else if(e===204)n=this.readU8();else if(e===205)n=this.readU16();else if(e===206)n=this.readU32();else if(e===207)this.useBigInt64?n=this.readU64AsBigInt():n=this.readU64();else if(e===208)n=this.readI8();else if(e===209)n=this.readI16();else if(e===210)n=this.readI32();else if(e===211)this.useBigInt64?n=this.readI64AsBigInt():n=this.readI64();else if(e===217){var i=this.lookU8();n=this.decodeUtf8String(i,1)}else if(e===218){var i=this.lookU16();n=this.decodeUtf8String(i,2)}else if(e===219){var i=this.lookU32();n=this.decodeUtf8String(i,4)}else if(e===220){var r=this.readU16();if(r!==0){this.pushArrayState(r),this.complete();continue e}else n=[]}else if(e===221){var r=this.readU32();if(r!==0){this.pushArrayState(r),this.complete();continue e}else n=[]}else if(e===222){var r=this.readU16();if(r!==0){this.pushMapState(r),this.complete();continue e}else n={}}else if(e===223){var r=this.readU32();if(r!==0){this.pushMapState(r),this.complete();continue e}else n={}}else if(e===196){var r=this.lookU8();n=this.decodeBinary(r,1)}else if(e===197){var r=this.lookU16();n=this.decodeBinary(r,2)}else if(e===198){var r=this.lookU32();n=this.decodeBinary(r,4)}else if(e===212)n=this.decodeExtension(1,0);else if(e===213)n=this.decodeExtension(2,0);else if(e===214)n=this.decodeExtension(4,0);else if(e===215)n=this.decodeExtension(8,0);else if(e===216)n=this.decodeExtension(16,0);else if(e===199){var r=this.lookU8();n=this.decodeExtension(r,1)}else if(e===200){var r=this.lookU16();n=this.decodeExtension(r,2)}else if(e===201){var r=this.lookU32();n=this.decodeExtension(r,4)}else throw new we("Unrecognized type byte: ".concat(Ht(e)));this.complete();for(var o=this.stack;o.length>0;){var s=o[o.length-1];if(s.type===wn)if(s.array[s.position]=n,s.position++,s.position===s.size)o.pop(),n=s.array;else continue e;else if(s.type===wt){if(!$i(n))throw new we("The type of key must be string or number but "+typeof n);if(n==="__proto__")throw new we("The key __proto__ is not allowed");s.key=n,s.type=Zi;continue e}else if(s.map[s.key]=n,s.readCount++,s.readCount===s.size)o.pop(),n=s.map;else{s.key=null,s.type=wt;continue e}}return n}},t.prototype.readHeadByte=function(){return this.headByte===at&&(this.headByte=this.readU8()),this.headByte},t.prototype.complete=function(){this.headByte=at},t.prototype.readArraySize=function(){var e=this.readHeadByte();switch(e){case 220:return this.readU16();case 221:return this.readU32();default:{if(e<160)return e-144;throw new we("Unrecognized array type byte: ".concat(Ht(e)))}}},t.prototype.pushMapState=function(e){if(e>this.maxMapLength)throw new we("Max length exceeded: map length (".concat(e,") > maxMapLengthLength (").concat(this.maxMapLength,")"));this.stack.push({type:wt,size:e,key:null,readCount:0,map:{}})},t.prototype.pushArrayState=function(e){if(e>this.maxArrayLength)throw new we("Max length exceeded: array length (".concat(e,") > maxArrayLength (").concat(this.maxArrayLength,")"));this.stack.push({type:wn,size:e,array:new Array(e),position:0})},t.prototype.decodeUtf8String=function(e,n){var r;if(e>this.maxStrLength)throw new we("Max length exceeded: UTF-8 byte length (".concat(e,") > maxStrLength (").concat(this.maxStrLength,")"));if(this.bytes.byteLength<this.pos+n+e)throw kn;var i=this.pos+n,o;return this.stateIsMapKey()&&(!((r=this.keyDecoder)===null||r===void 0)&&r.canBeCached(e))?o=this.keyDecoder.decode(this.bytes,i,e):o=Ci(this.bytes,i,e),this.pos+=n+e,o},t.prototype.stateIsMapKey=function(){if(this.stack.length>0){var e=this.stack[this.stack.length-1];return e.type===wt}return!1},t.prototype.decodeBinary=function(e,n){if(e>this.maxBinLength)throw new we("Max length exceeded: bin length (".concat(e,") > maxBinLength (").concat(this.maxBinLength,")"));if(!this.hasRemaining(e+n))throw kn;var r=this.pos+n,i=this.bytes.subarray(r,r+e);return this.pos+=n+e,i},t.prototype.decodeExtension=function(e,n){if(e>this.maxExtLength)throw new we("Max length exceeded: ext length (".concat(e,") > maxExtLength (").concat(this.maxExtLength,")"));var r=this.view.getInt8(this.pos+n),i=this.decodeBinary(e,n+1);return this.extensionCodec.decode(i,r,this.context)},t.prototype.lookU8=function(){return this.view.getUint8(this.pos)},t.prototype.lookU16=function(){return this.view.getUint16(this.pos)},t.prototype.lookU32=function(){return this.view.getUint32(this.pos)},t.prototype.readU8=function(){var e=this.view.getUint8(this.pos);return this.pos++,e},t.prototype.readI8=function(){var e=this.view.getInt8(this.pos);return this.pos++,e},t.prototype.readU16=function(){var e=this.view.getUint16(this.pos);return this.pos+=2,e},t.prototype.readI16=function(){var e=this.view.getInt16(this.pos);return this.pos+=2,e},t.prototype.readU32=function(){var e=this.view.getUint32(this.pos);return this.pos+=4,e},t.prototype.readI32=function(){var e=this.view.getInt32(this.pos);return this.pos+=4,e},t.prototype.readU64=function(){var e=Mi(this.view,this.pos);return this.pos+=8,e},t.prototype.readI64=function(){var e=Kn(this.view,this.pos);return this.pos+=8,e},t.prototype.readU64AsBigInt=function(){var e=this.view.getBigUint64(this.pos);return this.pos+=8,e},t.prototype.readI64AsBigInt=function(){var e=this.view.getBigInt64(this.pos);return this.pos+=8,e},t.prototype.readF32=function(){var e=this.view.getFloat32(this.pos);return this.pos+=4,e},t.prototype.readF64=function(){var e=this.view.getFloat64(this.pos);return this.pos+=8,e},t}();function ns(t,e){var n=new ts(e);return n.decode(t)}var rs=Object.defineProperty,is=Object.defineProperties,ss=Object.getOwnPropertyDescriptors,xn=Object.getOwnPropertySymbols,os=Object.prototype.hasOwnProperty,as=Object.prototype.propertyIsEnumerable,Gn=t=>{throw TypeError(t)},In=(t,e,n)=>e in t?rs(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,It=(t,e)=>{for(var n in e||(e={}))os.call(e,n)&&In(t,n,e[n]);if(xn)for(var n of xn(e))as.call(e,n)&&In(t,n,e[n]);return t},Tt=(t,e)=>is(t,ss(e)),qn=(t,e,n)=>e.has(t)||Gn("Cannot "+n),x=(t,e,n)=>(qn(t,e,"read from private field"),n?n.call(t):e.get(t)),me=(t,e,n)=>e.has(t)?Gn("Cannot add the same private member more than once"):e instanceof WeakSet?e.add(t):e.set(t,n),ne=(t,e,n,r)=>(qn(t,e,"write to private field"),e.set(t,n),n),mt=(t,e,n)=>new Promise((r,i)=>{var o=u=>{try{c(n.next(u))}catch(a){i(a)}},s=u=>{try{c(n.throw(u))}catch(a){i(a)}},c=u=>u.done?r(u.value):Promise.resolve(u.value).then(o,s);c((n=n.apply(t,e)).next())});function Ut(t){const e=t.filter(n=>!!n);return e.reduce((n,r)=>{const i="output"in n?n.output:n,o="input"in r?r.input:r;return i.connect(o),r}),()=>{e.reduce((n,r)=>{const i="output"in n?n.output:n,o="input"in r?r.input:r;return i.disconnect(o),r})}}function cs(t){let e=t;const n=new Set;function r(s){return n.add(s),s(e),()=>{n.delete(s)}}function i(s){e=s,n.forEach(c=>c(e))}function o(){return e}return{subscribe:r,set:i,get:o}}function ls(){const t=new Set;function e(r){return t.add(r),()=>{t.delete(r)}}function n(r){t.forEach(i=>i(r))}return{subscribe:e,trigger:n}}function us(t){let e=!1;return()=>{e||(e=!0,t.forEach(n=>n==null?void 0:n()))}}function Jn(t){return t*t/16129}function fs(t){return Math.pow(10,t/20)}var Me,Ce,qe,Je,St,Ae,De,hs=class{constructor(t,e){this.context=t,me(this,Me),me(this,Ce),me(this,qe),me(this,Je),me(this,St),me(this,Ae),me(this,De,!1);var n,r,i;ne(this,Ae,{destination:(n=e==null?void 0:e.destination)!=null?n:t.destination,volume:(r=e==null?void 0:e.volume)!=null?r:100,volumeToGain:(i=e==null?void 0:e.volumeToGain)!=null?i:Jn}),this.input=t.createGain(),ne(this,Me,t.createGain()),ne(this,Je,Ut([this.input,x(this,Me),x(this,Ae).destination]));const o=cs(x(this,Ae).volume);this.setVolume=o.set,ne(this,St,o.subscribe(s=>{x(this,Me).gain.value=x(this,Ae).volumeToGain(s)}))}addInsert(t){var e;if(x(this,De))throw Error("Can't add insert to disconnected channel");(e=x(this,qe))!=null||ne(this,qe,[]),x(this,qe).push(t),x(this,Je).call(this),ne(this,Je,Ut([this.input,...x(this,qe),x(this,Me),x(this,Ae).destination]))}addEffect(t,e,n){var r;if(x(this,De))throw Error("Can't add effect to disconnected channel");const i=this.context.createGain();i.gain.value=n;const o="input"in e?e.input:e,s=Ut([x(this,Me),i,o]);(r=x(this,Ce))!=null||ne(this,Ce,[]),x(this,Ce).push({name:t,mix:i,disconnect:s})}sendEffect(t,e){var n;if(x(this,De))throw Error("Can't send effect to disconnected channel");const r=(n=x(this,Ce))==null?void 0:n.find(i=>i.name===t);r?r.mix.gain.value=e:console.warn("Send bus not found: "+t)}disconnect(){var t;x(this,De)||(ne(this,De,!0),x(this,Je).call(this),x(this,St).call(this),(t=x(this,Ce))==null||t.forEach(e=>e.disconnect()),ne(this,Ce,void 0))}};Me=new WeakMap;Ce=new WeakMap;qe=new WeakMap;Je=new WeakMap;St=new WeakMap;Ae=new WeakMap;De=new WeakMap;var ve,ds=class{constructor(t){this.compare=t,me(this,ve,[])}push(t){const e=x(this,ve).length;let n=0,r=e-1,i=e;for(;n<=r;){const o=Math.floor((n+r)/2);this.compare(t,x(this,ve)[o])<0?(i=o,r=o-1):n=o+1}x(this,ve).splice(i,0,t)}pop(){return x(this,ve).shift()}peek(){return x(this,ve)[0]}removeAll(t){const e=x(this,ve).length;return ne(this,ve,x(this,ve).filter(n=>!t(n))),x(this,ve).length!==e}clear(){ne(this,ve,[])}size(){return x(this,ve).length}};ve=new WeakMap;function Tn(t,e){return t&&e?n=>{t(n),e(n)}:t??e}function ps(t){var e,n,r;const i={disableScheduler:(e=t.disableScheduler)!=null?e:!1,scheduleLookaheadMs:(n=t.scheduleLookaheadMs)!=null?n:200,scheduleIntervalMs:(r=t.scheduleIntervalMs)!=null?r:50,onStart:t.onStart,onEnded:t.onEnded};if(i.scheduleLookaheadMs<1)throw Error("scheduleLookaheadMs must be greater than 0");if(i.scheduleIntervalMs<1)throw Error("scheduleIntervalMs must be greater than 0");if(i.scheduleLookaheadMs<i.scheduleIntervalMs)throw Error("scheduleLookaheadMs must be greater than scheduleIntervalMs");return i}var Ie,_e,Ne,ms=class{constructor(t,e={}){me(this,Ie),me(this,_e),me(this,Ne),ne(this,Ie,ps(e)),ne(this,_e,new ds((n,r)=>n.time-r.time)),this.player=t}get context(){return this.player.context}get buffers(){return this.player.buffers}get isRunning(){return x(this,Ne)!==void 0}start(t){var e;if(x(this,Ie).disableScheduler)return this.player.start(t);const n=this.player.context,r=n.currentTime,i=(e=t.time)!=null?e:r,o=x(this,Ie).scheduleLookaheadMs/1e3;return t.onStart=Tn(t.onStart,x(this,Ie).onStart),t.onEnded=Tn(t.onEnded,x(this,Ie).onEnded),i<r+o?this.player.start(t):(x(this,_e).push(Tt(It({},t),{time:i})),x(this,Ne)||ne(this,Ne,setInterval(()=>{const s=n.currentTime+o;for(;x(this,_e).size()&&x(this,_e).peek().time<=s;){const c=x(this,_e).pop();c&&this.player.start(c)}x(this,_e).size()||(clearInterval(x(this,Ne)),ne(this,Ne,void 0))},x(this,Ie).scheduleIntervalMs)),s=>{!s||s<i?x(this,_e).removeAll(c=>c===t)||this.player.stop(Tt(It({},t),{time:s})):this.player.stop(Tt(It({},t),{time:s}))})}stop(t){var e;if(x(this,Ie).disableScheduler)return this.player.stop(t);if(this.player.stop(t),!t){x(this,_e).clear();return}const n=(e=t==null?void 0:t.time)!=null?e:0,r=t==null?void 0:t.stopId;r?x(this,_e).removeAll(i=>i.time>=n&&i.stopId?i.stopId===r:i.note===r):x(this,_e).removeAll(i=>i.time>=n)}disconnect(){this.player.disconnect()}};Ie=new WeakMap;_e=new WeakMap;Ne=new WeakMap;var ct,Xe,lt,ys=class{constructor(t,e){this.context=t,this.options=e,me(this,ct),me(this,Xe,!1),me(this,lt);var n,r;ne(this,ct,{velocityToGain:(n=e.velocityToGain)!=null?n:Jn,destination:(r=e.destination)!=null?r:t.destination}),this.buffers={},ne(this,lt,ls())}start(t){var e,n,r,i,o,s,c,u,a,p,h,l,f,d;if(x(this,Xe))throw new Error("Can't start a sample on disconnected player");const m=this.context,y=t.name&&this.buffers[t.name]||this.buffers[t.note];if(!y)return console.warn(`Sample not found: '${t.note}'`),()=>{};const _=m.createBufferSource();_.buffer=y;const T=(n=(e=t.detune)!=null?e:this.options.detune)!=null?n:0;_.detune?_.detune.value=T:_.playbackRate&&(_.playbackRate.value=Math.pow(2,T/1200));const z=(r=t.lpfCutoffHz)!=null?r:this.options.lpfCutoffHz,k=z?m.createBiquadFilter():void 0;z&&k&&(k.type="lowpass",k.frequency.value=z);const E=m.createGain(),N=(o=(i=t.velocity)!=null?i:this.options.velocity)!=null?o:100;E.gain.value=x(this,ct).velocityToGain(N),((s=t.loop)!=null?s:this.options.loop)&&(_.loop=!0,_.loopStart=(c=t.loopStart)!=null?c:0,_.loopEnd=(u=t.loopEnd)!=null?u:y.duration);const Q=(a=t.decayTime)!=null?a:this.options.decayTime,[H,W]=vs(m,Q);function J(U){if(U??(U=m.currentTime),U<=de)_.stop(U);else{const fe=W(U);_.stop(fe)}}const X=t.gainOffset?m.createGain():void 0;X&&t.gainOffset&&(X.gain.value=t.gainOffset);const M=(p=t.stopId)!=null?p:t.note,oe=us([Ut([_,k,E,H,X,x(this,ct).destination]),(h=t.stop)==null?void 0:h.call(t,J),x(this,lt).subscribe(U=>{(!U||U.stopId===void 0||U.stopId===M)&&J(U==null?void 0:U.time)})]);_.onended=()=>{var U;oe(),(U=t.onEnded)==null||U.call(t,t)},(l=t.onStart)==null||l.call(t,t);const de=Math.max((f=t.time)!=null?f:0,m.currentTime);_.start(t.time);let V=(d=t.duration)!=null?d:y.duration;return typeof t.duration=="number"&&J(de+V),J}stop(t){x(this,lt).trigger(t)}disconnect(){x(this,Xe)||(ne(this,Xe,!0),this.stop(),Object.keys(this.buffers).forEach(t=>{delete this.buffers[t]}))}get connected(){return!x(this,Xe)}};ct=new WeakMap;Xe=new WeakMap;lt=new WeakMap;function vs(t,e=.2){let n=0;const r=t.createGain();r.gain.value=1;function i(o){if(n)return n;r.gain.cancelScheduledValues(o);const s=o||t.currentTime;return n=s+e,r.gain.setValueAtTime(1,s),r.gain.linearRampToValueAtTime(0,n),n}return[r,i]}var gs=class{constructor(t,e){this.context=t;const n=new hs(t,e);this.player=new ms(new ys(t,Tt(It({},e),{destination:n.input})),e),this.output=n}get buffers(){return this.player.buffers}start(t){return this.player.start(t)}stop(t){this.player.stop(typeof t=="object"?t:t!==void 0?{stopId:t}:void 0)}disconnect(){this.output.disconnect(),this.player.disconnect()}};function _s(t){if(typeof document>"u")return null;const e=document.createElement("audio");for(let n=0;n<t.length;n++){const r=t[n],i=e.canPlayType(`audio/${r}`);if(i==="probably"||i==="maybe")return r;if(r==="m4a"){const o=e.canPlayType("audio/aac");if(o==="probably"||o==="maybe")return r}}return null}var bs={fetch(t){return fetch(t)}};function ws(t){const n=/^([a-gA-G]?)(#{1,}|b{1,}|)(-?\d+)$/.exec(t);if(!n)return;const r=n[1].toUpperCase();if(!r)return;const i=n[2],o=i[0]==="b"?-i.length:i.length,s=n[3]?+n[3]:4,c=(r.charCodeAt(0)+3)%7;return[0,2,4,5,7,9,11][c]+o+12*(s+1)}function jt(t){return t===void 0?void 0:typeof t=="number"?t:ws(t)}function ks(){return{regions:[]}}function xs(t,e,n,r){const i=jt(e.note);if(i!==void 0)for(const o of t.regions){const s=Is(i,0,e,o,r);if(s)return s}}function Is(t,e,n,r,i){var o,s,c,u,a,p,h,l,f,d,m,y,_,T,z,k,E,N,R,Q,H,W,J,X,M,oe,de,V;if(!(t>=((o=r.midiLow)!=null?o:0)&&t<((s=r.midiHigh)!=null?s:127)+1)||!(n.velocity===void 0||n.velocity>=((c=r.velLow)!=null?c:0)&&n.velocity<=((u=r.velHigh)!=null?u:127)))return;if(r.seqLength){const ge=e%r.seqLength,xe=((a=r.seqPosition)!=null?a:1)-1;if(ge!==xe)return}const ee=t-r.midiPitch,ae=(p=n.velocity)!=null?p:i==null?void 0:i.velocity,he=r.volume?fs(r.volume):0,L=(l=(h=n.gainOffset)!=null?h:i==null?void 0:i.gainOffset)!=null?l:0,ce=(f=n.detune)!=null?f:0;return{decayTime:(y=(m=n==null?void 0:n.decayTime)!=null?m:(d=r.sample)==null?void 0:d.decayTime)!=null?y:i==null?void 0:i.decayTime,detune:100*(ee+((_=r.tune)!=null?_:0))+ce,duration:(k=(z=n==null?void 0:n.duration)!=null?z:(T=r.sample)==null?void 0:T.duration)!=null?k:i==null?void 0:i.duration,gainOffset:L+he||void 0,loop:(R=(N=n==null?void 0:n.loop)!=null?N:(E=r.sample)==null?void 0:E.loop)!=null?R:i==null?void 0:i.loop,loopEnd:(W=(H=n==null?void 0:n.loopEnd)!=null?H:(Q=r.sample)==null?void 0:Q.loopEnd)!=null?W:i==null?void 0:i.loopEnd,loopStart:(M=(X=n==null?void 0:n.loopStart)!=null?X:(J=r.sample)==null?void 0:J.loopStart)!=null?M:i==null?void 0:i.loopStart,lpfCutoffHz:(V=(de=n==null?void 0:n.lpfCutoffHz)!=null?de:(oe=r.sample)==null?void 0:oe.lpfCutoffHz)!=null?V:i==null?void 0:i.lpfCutoffHz,name:r.sampleName,note:t,onEnded:n.onEnded,onStart:n.onStart,stopId:n.name,time:n.time,velocity:ae??void 0}}function Ts(t){if(t.length===0)return[];if(t.sort((e,n)=>e.midiPitch-n.midiPitch),t[0].midiLow=0,t[0].midiHigh=127,t.length===1)return t;for(let e=1;e<t.length;e++){const n=t[e-1],r=t[e],i=Math.floor((n.midiPitch+r.midiPitch)/2);n.midiHigh=i,r.midiLow=i+1}return t[t.length-1].midiHigh=127,t}function Us(t,e){var n;const r=(n=_s(["ogg","mp3"]))!=null?n:"mp3";return`https://gleitz.github.io/midi-js-soundfonts/${e}/${t}-${r}.js`}function Ss(t,e,n){return(r,i)=>mt(this,null,function*(){const o=yield(yield i.fetch(t)).text(),s=Cs(o),c=Object.keys(s);yield Promise.all(c.map(u=>mt(this,null,function*(){const a=jt(u);if(!a)return;const p=Es(Ps(s[u])),h=yield r.decodeAudioData(p);e[u]=h,n.regions.push({sampleName:u,midiPitch:a})}))),Ts(n.regions)})}function Cs(t){const e=t.indexOf("MIDI.Soundfont.");if(e<0)throw Error("Invalid MIDI.js Soundfont format");const n=t.indexOf("=",e)+2,r=t.lastIndexOf(",");return JSON.parse(t.slice(n,r)+"}")}function Ps(t){return t.slice(t.indexOf(",")+1)}function Es(t){const e=window.atob(t),n=e.length,r=new Uint8Array(n);for(let i=0;i<n;i++)r[i]=e.charCodeAt(i);return r.buffer}function Ms(t,e){if(!t.startsWith("http"))return`https://goldst.dev/midi-js-soundfonts/${e}/${t}-loop.json`}function As(t,e=44100){return mt(this,null,function*(){if(t)try{const n=yield fetch(t);if(n.status!==200)return;const r=yield n.json(),i={};return Object.keys(r).forEach(o=>{const s=jt(o);if(s){const c=r[o];i[s]=[c[0]/e,c[1]/e]}}),i}catch{return}})}var ut,Ds=class{constructor(t,e){this.context=t,me(this,ut),this.config=Fs(e),this.player=new gs(t,e),this.group=ks(),ne(this,ut,!1);const n=Ns(this.config.instrumentUrl,this.config.loopDataUrl,this.player.buffers,this.group);this.load=n(t,this.config.storage).then(i=>(ne(this,ut,i),this));const r=t.createGain();r.gain.value=this.config.extraGain,this.player.output.addInsert(r)}get output(){return this.player.output}get hasLoops(){return x(this,ut)}loaded(){return mt(this,null,function*(){return console.warn("deprecated: use load instead"),this.load})}disconnect(){this.player.disconnect()}start(t){const e=xs(this.group,typeof t=="object"?t:{note:t});return e?this.player.start(e):()=>{}}stop(t){return this.player.stop(t)}};ut=new WeakMap;function Ns(t,e,n,r){const i=Ss(t,n,r);return(o,s)=>mt(this,null,function*(){const[c,u]=yield Promise.all([i(o,s),As(e)]);return u&&r.regions.forEach(a=>{var p;const h=u[a.midiPitch];h&&((p=a.sample)!=null||(a.sample={}),a.sample.loop=!0,a.sample.loopStart=h[0],a.sample.loopEnd=h[1])}),!!u})}function Fs(t){var e,n,r,i;if(!t.instrument&&!t.instrumentUrl)throw Error("Soundfont: instrument or instrumentUrl is required");const o={kit:"MusyngKite",instrument:t.instrument,storage:(e=t.storage)!=null?e:bs,extraGain:(n=t.extraGain)!=null?n:5,loadLoopData:(r=t.loadLoopData)!=null?r:!1,loopDataUrl:t.loopDataUrl,instrumentUrl:(i=t.instrumentUrl)!=null?i:""};return o.instrument&&o.instrument.startsWith("http")&&(console.warn("Use 'instrumentUrl' instead of 'instrument' to load from a URL"),o.instrumentUrl=o.instrument,o.instrument=void 0),o.instrument&&!o.instrumentUrl&&(o.instrumentUrl=Us(o.instrument,o.kit)),o.loadLoopData&&o.instrument&&!o.loopDataUrl&&(o.loopDataUrl=Ms(o.instrument,o.kit)),o}const Xn=window.AudioContext||window.webkitAudioContext,Os=new Xn;Xn||alert("Your browser does not seem to support the Web Audio API!");const Kt={};class Wt{constructor(e){A(this,"stopAudioMap",new Map);A(this,"instrument");A(this,"instrumentName");A(this,"colorHue");A(this,"socketID");this.colorHue=e.color_hue,this.socketID=e.id,this.setInstrument(e.instrument_name)}async setInstrument(e){return Kt[e]||(Kt[e]=new Ds(Os,{instrument:e})),this.instrumentName=e,this.instrument=Kt[e],this.instrument.output.setVolume(127),this.instrument.load}stopAudio(e){const n=this.stopAudioMap.get(e);n&&(n(),this.stopAudioMap.delete(e))}playAudio(e,n){this.instrument&&(this.stopAudio(e),this.stopAudioMap.set(e,this.instrument.start({note:e,velocity:Math.min(n*20,127)})))}}var Bs={BASE_URL:"./",DEV:!1,MODE:"production",PROD:!0,SSR:!1,VITE_BACKEND_HOST:"piano-backend.onrender.com"};class Ls{constructor(){A(this,"connecting",le(!1));A(this,"connectError",le(""));A(this,"connectedColorHues",le(new Map));A(this,"connected",le(!1));A(this,"clientMap",new Map);A(this,"localClient",new Wt({color_hue:220,id:0,instrument_name:"acoustic_grand_piano"}));A(this,"socket",null);A(this,"onPlayNote");A(this,"onStopNote")}connect(e,n=6){if(e.length>100)return this.connectError.set("Room name to long!");const r="piano-backend.onrender.com",i=location.protocol==="https:"?"wss":"ws",o=Bs.VITE_BACKEND_PATH??"",s=`room_name=${e}&instrument_name=${this.localClient.instrumentName}`;this.socket=new WebSocket(`${i}://${r}/${o}?${s}`),this.socket.binaryType="arraybuffer",this.socket.onopen=()=>{console.log("Connected to websocket"),this.connecting.set(!1),this.connected.set(!0),history.replaceState({},"",`?room=${e}`),document.title=`Room ${e} - Play Piano!`},this.socket.onclose=()=>{history.replaceState({},"",location.pathname),document.title="Play Piano!",this.clean(),re(this.connected)&&(console.log("Trying to reconnect"),this.connect(e),this.connected.set(!1))},this.socket.onerror=()=>{console.log(`Failed to connect, reconnecting ${n} attempts left`),setTimeout(()=>{n==0?(this.connectError.set("Failed to connect to websocket server"),this.disconnect()):this.connect(e,n-1)},1e3)},this.socket.onmessage=async c=>{if(c.data instanceof ArrayBuffer){const u=ns(new Uint8Array(c.data));u&&this.handleMessage(u)}},this.connectError.set(""),this.connecting.set(!0)}disconnect(){this.connected.set(!1),this.connecting.set(!1),this.socket&&this.socket.close()}playNote(e,n){this.onPlayNote(e,n,this.localClient),this.sendMessage({type:"Play",note:e,volume:n})}stopNote(e,n){this.onStopNote(e,n,this.localClient),this.sendMessage({type:"Stop",note:e,sustain:n})}async changeInstrument(e){this.sendMessage({type:"InstrumentChange",instrument_name:e}),await this.localClient.setInstrument(e)}handleMessage(e){switch(e.type){case"Error":this.connectError.set(e.error);break;case"Relay":this.handleRelayMessage(e.msg,e.id);break;case"ClientConnect":this.addClient(new Wt(e));break;case"ReceiveInfo":{for(const i of e.client_list)this.addClient(new Wt(i));const r=e.created_client;this.localClient.colorHue=r.color_hue,this.localClient.socketID=e.created_client.id,this.addClient(this.localClient);break}case"ClientDisconnect":this.connectedColorHues.update(r=>(r.delete(e.id),r));const n=this.getClient(e.id);n&&(this.cleanClient(n),this.clientMap.delete(e.id));break}}handleRelayMessage(e,n){switch(e.type){case"Play":this.onPlayNote(e.note,e.volume,this.getClient(n));break;case"Stop":this.onStopNote(e.note,e.sustain,this.getClient(n));break;case"InstrumentChange":this.getClient(n).setInstrument(e.instrument_name);break}}getClient(e){return this.clientMap.get(e)}sendMessage(e){this.clientMap.size!=1&&this.socket&&re(this.connected)&&this.socket.send(Gi(e))}addClient(e){this.connectedColorHues.update(n=>(n.set(e.socketID,e.colorHue),n)),this.clientMap.set(e.socketID,e)}clean(){for(const e of this.clientMap.values())this.cleanClient(e);this.socket=null,this.clientMap.clear(),this.localClient.colorHue=220,this.localClient.socketID=0,this.connectedColorHues.update(e=>(e.clear(),e))}cleanClient(e){for(const n of e.stopAudioMap.keys())this.onStopNote(n,!1,e)}}function Un(t,e,n){const r=t.slice();return r[14]=e[n][0],r[15]=e[n][1],r}function zs(t){let e,n,r,i;return{c(){e=b("button"),n=ie("Join"),e.disabled=t[3]},m(o,s){O(o,e,s),v(e,n),r||(i=P(e,"click",t[13]),r=!0)},p(o,s){s&8&&(e.disabled=o[3])},d(o){o&&F(e),r=!1,i()}}}function Rs(t){let e,n,r,i,o,s,c,u,a,p,h=ke(Array.from(t[4].entries())),l=[];for(let f=0;f<h.length;f+=1)l[f]=Cn(Un(t,h,f));return{c(){e=b("button"),e.textContent="Leave",n=D(),r=b("span"),r.textContent="Connected!",i=b("br"),o=D(),s=b("span"),s.textContent="People:",c=D();for(let f=0;f<l.length;f+=1)l[f].c();u=Dn()},m(f,d){O(f,e,d),O(f,n,d),O(f,r,d),O(f,i,d),O(f,o,d),O(f,s,d),O(f,c,d);for(let m=0;m<l.length;m+=1)l[m]&&l[m].m(f,d);O(f,u,d),a||(p=P(e,"click",t[12]),a=!0)},p(f,d){if(d&17){h=ke(Array.from(f[4].entries()));let m;for(m=0;m<h.length;m+=1){const y=Un(f,h,m);l[m]?l[m].p(y,d):(l[m]=Cn(y),l[m].c(),l[m].m(u.parentNode,u))}for(;m<l.length;m+=1)l[m].d(1);l.length=h.length}},d(f){f&&(F(e),F(n),F(r),F(i),F(o),F(s),F(c),F(u)),ht(l,f),a=!1,p()}}}function Sn(t){let e;return{c(){e=b("span"),e.textContent="(you)",Oe(e,"margin-right","0.5rem")},m(n,r){O(n,e,r)},d(n){n&&F(e)}}}function Cn(t){let e,n,r,i,o=t[14]===t[0].localClient.socketID&&Sn();return{c(){e=b("div"),r=D(),o&&o.c(),i=Dn(),w(e,"class","icon svelte-ye3hvw"),w(e,"style",n=`--color-hue: ${t[15]}`)},m(s,c){O(s,e,c),O(s,r,c),o&&o.m(s,c),O(s,i,c)},p(s,c){c&16&&n!==(n=`--color-hue: ${s[15]}`)&&w(e,"style",n),s[14]===s[0].localClient.socketID?o||(o=Sn(),o.c(),o.m(i.parentNode,i)):o&&(o.d(1),o=null)},d(s){s&&(F(e),F(r),F(i)),o&&o.d(s)}}}function Hs(t){let e,n,r,i;return{c(){e=b("span"),e.textContent="Connecting...",n=D(),r=b("img"),Mn(r.src,i=zn)||w(r,"src",i),w(r,"alt","spinner")},m(o,s){O(o,e,s),O(o,n,s),O(o,r,s)},p:q,d(o){o&&(F(e),F(n),F(r))}}}function Vs(t){let e,n;return{c(){e=b("span"),n=ie(t[5]),w(e,"class","error svelte-ye3hvw")},m(r,i){O(r,e,i),v(e,n)},p(r,i){i&32&&ze(n,r[5])},d(r){r&&F(e)}}}function Ks(t){let e,n,r,i,o,s,c,u;function a(m,y){return m[2]?Rs:zs}let p=a(t),h=p(t);function l(m,y){if(m[5])return Vs;if(m[3])return Hs}let f=l(t),d=f&&f(t);return{c(){e=b("div"),n=b("p"),n.textContent="Join a room:",r=D(),i=b("input"),o=D(),h.c(),s=D(),d&&d.c(),w(i,"type","text"),w(i,"placeholder","Room name")},m(m,y){O(m,e,y),v(e,n),v(e,r),v(e,i),$(i,t[1]),v(e,o),h.m(e,null),v(e,s),d&&d.m(e,null),c||(u=[P(i,"input",t[10]),P(i,"keydown",t[11])],c=!0)},p(m,[y]){y&2&&i.value!==m[1]&&$(i,m[1]),p===(p=a(m))&&h?h.p(m,y):(h.d(1),h=p(m),h&&(h.c(),h.m(e,s))),f===(f=l(m))&&d?d.p(m,y):(d&&d.d(1),d=f&&f(m),d&&(d.c(),d.m(e,null)))},i:q,o:q,d(m){m&&F(e),h.d(),d&&d.d(),c=!1,be(u)}}}function Ws(t,e,n){let r,i,o,s,{socketPlayer:c}=e,u="",{connected:a,connecting:p,connectError:h,connectedColorHues:l}=c;Y(t,a,_=>n(2,r=_)),Y(t,p,_=>n(3,i=_)),Y(t,h,_=>n(5,s=_)),Y(t,l,_=>n(4,o=_)),Fn(()=>{const T=new URLSearchParams(location.search).get("room");T!=null&&(n(1,u=T),c.connect(u))});function f(){u=this.value,n(1,u)}const d=_=>{_.code==="Enter"&&!r&&!i&&c.connect(u)},m=()=>c.disconnect(),y=()=>c.connect(u);return t.$$set=_=>{"socketPlayer"in _&&n(0,c=_.socketPlayer)},[c,u,r,i,o,s,a,p,h,l,f,d,m,y]}class Gs extends rt{constructor(e){super(),nt(this,e,Ws,Ks,He,{socketPlayer:0})}}function qs(t){let e,n,r,i,o,s,c,u;return r=new vi({props:{pianoControlsData:t[0],socketPlayer:t[2]}}),o=new ui({props:{midiPlayer:t[1]}}),c=new Gs({props:{socketPlayer:t[2]}}),{c(){e=b("div"),n=b("div"),ft(r.$$.fragment),i=D(),ft(o.$$.fragment),s=D(),ft(c.$$.fragment),w(n,"class","row svelte-b9289n"),w(e,"class","control-panel svelte-b9289n")},m(a,p){O(a,e,p),v(e,n),je(r,n,null),v(n,i),je(o,n,null),v(e,s),je(c,e,null),u=!0},p(a,[p]){const h={};p&1&&(h.pianoControlsData=a[0]),p&4&&(h.socketPlayer=a[2]),r.$set(h);const l={};p&2&&(l.midiPlayer=a[1]),o.$set(l);const f={};p&4&&(f.socketPlayer=a[2]),c.$set(f)},i(a){u||(Le(r.$$.fragment,a),Le(o.$$.fragment,a),Le(c.$$.fragment,a),u=!0)},o(a){$e(r.$$.fragment,a),$e(o.$$.fragment,a),$e(c.$$.fragment,a),u=!1},d(a){a&&F(e),et(r),et(o),et(c)}}}function Js(t,e,n){let{pianoControlsData:r}=e,{midiPlayer:i}=e,{socketPlayer:o}=e;return t.$$set=s=>{"pianoControlsData"in s&&n(0,r=s.pianoControlsData),"midiPlayer"in s&&n(1,i=s.midiPlayer),"socketPlayer"in s&&n(2,o=s.socketPlayer)},[r,i,o]}class Xs extends rt{constructor(e){super(),nt(this,e,Js,qs,He,{pianoControlsData:0,midiPlayer:1,socketPlayer:2})}}function Ys(t){let e,n,r,i,o;return n=new Xs({props:{pianoControlsData:t[0],midiPlayer:t[1],socketPlayer:t[2]}}),i=new si({props:{pianoControlsData:t[0],midiPlayer:t[1],socketPlayer:t[2]}}),{c(){e=b("main"),ft(n.$$.fragment),r=D(),ft(i.$$.fragment)},m(s,c){O(s,e,c),je(n,e,null),v(e,r),je(i,e,null),o=!0},p:q,i(s){o||(Le(n.$$.fragment,s),Le(i.$$.fragment,s),o=!0)},o(s){$e(n.$$.fragment,s),$e(i.$$.fragment,s),o=!1},d(s){s&&F(e),et(n),et(i)}}}function Qs(t){const e=new mi,n=new ei,r=new Ls;return[e,n,r]}class Zs extends rt{constructor(e){super(),nt(this,e,Qs,Ys,He,{})}}new Zs({target:document.body});

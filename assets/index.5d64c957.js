import{g as ie,w as R,M as on,l as ln,a as sn,S as xe,i as $e,s as et,e as h,t as pe,b as S,c as a,n as E,d as A,h as He,f as y,j as r,k as an,m as Bt,o as I,p as Ot,q as v,r as rn,u as ee,v as tt,x as cn,y as nt,z as ot,A as M,B as un,C as H,D as _n,E as lt,F as Ge,G as fn,H as pn,I as dn,J as It,K as qt,L as Lt,N as zt,O as Rt}from"./vendor.90408fa6.js";const hn=function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const l of document.querySelectorAll('link[rel="modulepreload"]'))o(l);new MutationObserver(l=>{for(const s of l)if(s.type==="childList")for(const c of s.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&o(c)}).observe(document,{childList:!0,subtree:!0});function n(l){const s={};return l.integrity&&(s.integrity=l.integrity),l.referrerpolicy&&(s.referrerPolicy=l.referrerpolicy),l.crossorigin==="use-credentials"?s.credentials="include":l.crossorigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function o(l){if(l.ep)return;l.ep=!0;const s=n(l);fetch(l.href,s)}};hn();const Ht=["accordion","acoustic_bass","acoustic_grand_piano","acoustic_guitar_nylon","acoustic_guitar_steel","agogo","alto_sax","applause","bagpipe","banjo","baritone_sax","bassoon","bird_tweet","blown_bottle","brass_section","breath_noise","bright_acoustic_piano","celesta","cello","choir_aahs","church_organ","clarinet","clavinet","contrabass","distortion_guitar","drawbar_organ","dulcimer","electric_bass_finger","electric_bass_pick","electric_grand_piano","electric_guitar_clean","electric_guitar_jazz","electric_guitar_muted","electric_piano_1","electric_piano_2","english_horn","fiddle","flute","french_horn","fretless_bass","fx_1_rain","fx_2_soundtrack","fx_3_crystal","fx_4_atmosphere","fx_5_brightness","fx_6_goblins","fx_7_echoes","fx_8_scifi","glockenspiel","guitar_fret_noise","guitar_harmonics","gunshot","harmonica","harpsichord","helicopter","honkytonk_piano","kalimba","koto","lead_1_square","lead_2_sawtooth","lead_3_calliope","lead_4_chiff","lead_5_charang","lead_6_voice","lead_7_fifths","lead_8_bass__lead","marimba","melodic_tom","music_box","muted_trumpet","oboe","ocarina","orchestra_hit","orchestral_harp","overdriven_guitar","pad_1_new_age","pad_2_warm","pad_3_polysynth","pad_4_choir","pad_5_bowed","pad_6_metallic","pad_7_halo","pad_8_sweep","pan_flute","percussive_organ","piccolo","pizzicato_strings","recorder","reed_organ","reverse_cymbal","rock_organ","seashore","shakuhachi","shamisen","shanai","sitar","slap_bass_1","slap_bass_2","soprano_sax","steel_drums","string_ensemble_1","string_ensemble_2","synth_bass_1","synth_bass_2","synth_brass_1","synth_brass_2","synth_choir","synth_drum","synth_strings_1","synth_strings_2","taiko_drum","tango_accordion","telephone_ring","tenor_sax","timpani","tinkle_bell","tremolo_strings","trombone","trumpet","tuba","tubular_bells","vibraphone","viola","violin","voice_oohs","whistle","woodblock","xylophone"],ae=["C","C#","D","D#","E","E#","F","F#","G","G#","A","A#","B","B#"],Gt={Backquote:"A#2",Tab:"B2",KeyQ:"C3",Digit2:"C#3",KeyW:"D3",Digit3:"D#3",KeyE:"E3",Key4:"E#3",KeyR:"F3",Digit5:"F#3",KeyT:"G3",Digit6:"G#3",KeyY:"A3",Digit7:"A#3",KeyU:"B3",Key8:"B#8",KeyI:"C4",Digit9:"C#4",KeyO:"D4",Digit0:"D#4",KeyP:"E4",Minus:"E#4",BracketLeft:"F4",Equal:"F#4",BracketRight:"G4",Backspace:"G#4",Backslash:"A4",CapsLock:"A#4",ShiftLeft:"B4",KeyA:"B#4",KeyZ:"C5",KeyS:"C#5",KeyX:"D5",KeyD:"D#5",KeyC:"E5",KeyF:"E#5",KeyV:"F5",KeyG:"F#5",KeyB:"G5",KeyH:"G#5",KeyN:"A5",KeyJ:"A#5",KeyM:"B5",KeyK:"B#5",Comma:"C6",KeyL:"C#6",Period:"D6",Semicolon:"D#6",Slash:"E6",Quote:"E#6",ShiftRight:"F6",Enter:"F#6"};function st(e){return parseInt(e.charAt(e.length-1))}function it(e){return e.substring(0,e.length-1)}function at(e){const t=Math.floor(e/12)-1;return ae[e%12]+t}function mn(e,t){const n=st(t),o=st(e),l=ae.indexOf(it(e)),s=ae.indexOf(it(t)),c={};let p=0;const f=["E#","B#"];for(let u=o;u<=n;u++){let i=u===o?l:0;for(;i<ae.length&&!(u===n&&i>s);){const b=ae[i];if(!f.includes(b)){const k=b.length===1;c[b+u]={white:k,pressedColor:null,ghost:!1},k&&p++}i++}}return{noteMap:c,whiteKeys:p}}const U=R(!1),Ce=R(0),Je=R(0),rt=R(),Ee=R(1);async function gn(e,t){let n=[],o=null;function l(u){o=new on(u),o.tracks=o.tracks.filter(d=>d.notes.length!==0);let i=0;o.tracks.forEach(d=>{const b=d.notes[d.notes.length-1],k=b.time+b.duration;k>i&&(i=k)}),Je.set(i)}rt.subscribe(u=>{if(U.set(!1),Je.set(0),Ce.set(0),!u){o=null;return}const i=new FileReader;i.onload=()=>l(i.result),i.readAsArrayBuffer(u)});function s(u){const i=ie(Ce)+u;Ce.set(i),o.tracks.forEach((d,b)=>{const k=d.notes[n[b]];if(!k)return;i-k.time>0&&(e(k.name,k.velocity),setTimeout(()=>t(k.name),k.duration*1e3/ie(Ee)),n[b]++)}),i>ie(Je)&&U.set(!1)}U.subscribe(u=>{if(!u)return;if(!o)return U.set(!1),alert("No MIDI file selected!");o.tracks.forEach((b,k)=>{let F=0,D=b.notes.length-1;for(;F!=D;){const w=Math.ceil((F+D)/2);b.notes[w].time>ie(Ce)?D=w-1:F=w}n[k]=F});let i=performance.now();const d=()=>{if(!ie(U))return;const b=performance.now(),k=b-i;i=b,s(k/1e3*ie(Ee)),requestAnimationFrame(d)};d()});function c(u){const[i,d,b]=u.data;i>143&&i<160?b==0?t(at(d)):e(at(d),b/127):i>127&&i<144&&t(at(d))}const p=await navigator.requestMIDIAccess();function f(){p.inputs.forEach(u=>{u.onmidimessage=c})}f(),p.onstatechange=()=>{f()}}const Jt=window.AudioContext||window.webkitAudioContext;Jt||alert("Your browser does not seem to support the Web Audio API!");const bn=new Jt,ct={};function Wt(e){return ct[e]||(ct[e]=ln.exports.instrument(bn,e)),ct[e]}const Qt=R(),We=R("acoustic_grand_piano"),Ae=R(new Map),ut=R(!1),de=new Map,Qe={audioNodeMap:new Map,colorHue:"220"};de.set("0",Qe);let P,_t,ft;async function pt(e,t){let n=await Wt(e),o=de.get(t);o&&(o.instrument=n)}function Ut({socketID:e,colorHue:t,instrumentName:n}){de.set(e,{audioNodeMap:e===P.id?Qe.audioNodeMap:new Map,colorHue:t}),Ae.set(ie(Ae).set(e,t)),n&&pt(n,e)}function dt(){P.removeAllListeners(),P=null,ut.set(!1)}function vn(e,t){_t=e,ft=t}function ht(e){const t=new Promise((n,o)=>{P=sn("https://calbabreaker-piano-backend.herokuapp.com",{query:{roomName:e,instrumentName:ie(We)},path:{}.VITE_BACKEND_PATH}),P.on("connect_error",()=>{dt(),o("Failed to connect to server!")}),P.on("connect_timeout",()=>{dt(),o("Timed out while connecting to server!")}),P.on("connect",()=>{ut.set(!0),de.delete("0"),ie(Ae).clear(),n(),history.replaceState({},`Play Piano! - ${e}`,`?room=${e}`)}),P.on("disconnect",()=>{de.clear(),de.set("0",Qe),dt(),history.replaceState({},"Play Piano!",location.pathname)}),P.on("play_note",s=>{_t(s)}),P.on("stop_note",s=>{ft(s)}),P.on("instrument_change",s=>{const{instrumentName:c,socketID:p}=s;pt(c,p)}),P.on("client_connect",s=>{Ut(s)}),P.on("client_list_recieve",s=>{const c=s;for(let p of c)Ut(p)}),P.on("client_disconnect",s=>{const c=ie(Ae);c.delete(s),Ae.set(c),de.delete(s)})});Qt.set(t)}function yn(e,t){const n={note:e,volume:t};P?P.emit("play_note",n):_t(n)}function mt(e,t){const n={note:e,sustain:t};P?P.emit("stop_note",n):ft(n)}We.subscribe(e=>{P?P.emit("instrument_change",{instrumentName:e}):pt(e,"0")});const{window:kn}=un;function Vt(e,t,n){const o=e.slice();return o[40]=t[n][0],o[41]=t[n][1],o}function Yt(e,t,n){const o=e.slice();return o[45]=t[n],o}function Xt(e){let t,n=e[45]+"",o,l;return{c(){t=h("option"),o=pe(n),t.__value=l=e[45],t.value=t.__value},m(s,c){S(s,t,c),a(t,o)},p:E,d(s){s&&A(t)}}}function wn(e){return{c:E,m:E,d:E}}function Cn(e){return{c:E,m:E,d:E}}function Nn(e){let t;return{c(){t=pe("loading...")},m(n,o){S(n,t,o)},d(n){n&&A(t)}}}function Kn(e){let t,n,o;return{c(){t=h("button"),t.textContent="Play"},m(l,s){S(l,t,s),n||(o=v(t,"click",e[26]),n=!0)},p:E,d(l){l&&A(t),n=!1,o()}}}function Sn(e){let t,n,o;return{c(){t=h("button"),t.textContent="Pause"},m(l,s){S(l,t,s),n||(o=v(t,"click",e[25]),n=!0)},p:E,d(l){l&&A(t),n=!1,o()}}}function An(e){let t,n,o;return{c(){t=h("button"),t.textContent="Join"},m(l,s){S(l,t,s),n||(o=v(t,"click",e[36]),n=!0)},p:E,d(l){l&&A(t),n=!1,o()}}}function Pn(e){let t,n,o;return{c(){t=h("button"),t.textContent="Leave"},m(l,s){S(l,t,s),n||(o=v(t,"click",e[35]),n=!0)},p:E,d(l){l&&A(t),n=!1,o()}}}function En(e){let t,n=e[44]+"",o;return{c(){t=h("span"),o=pe(n),r(t,"class","error svelte-1ufj93m")},m(l,s){S(l,t,s),a(t,o)},p(l,s){s[0]&8192&&n!==(n=l[44]+"")&&tt(o,n)},d(l){l&&A(t)}}}function jn(e){let t,n=e[12]&&Zt(e);return{c(){n&&n.c(),t=lt()},m(o,l){n&&n.m(o,l),S(o,t,l)},p(o,l){o[12]?n?n.p(o,l):(n=Zt(o),n.c(),n.m(t.parentNode,t)):n&&(n.d(1),n=null)},d(o){n&&n.d(o),o&&A(t)}}}function Zt(e){let t,n,o,l,s,c,p=Array.from(e[14].entries()),f=[];for(let u=0;u<p.length;u+=1)f[u]=$t(Vt(e,p,u));return{c(){t=h("span"),t.textContent="Connected!",n=h("br"),o=y(),l=h("span"),l.textContent="People:",s=y();for(let u=0;u<f.length;u+=1)f[u].c();c=lt()},m(u,i){S(u,t,i),S(u,n,i),S(u,o,i),S(u,l,i),S(u,s,i);for(let d=0;d<f.length;d+=1)f[d].m(u,i);S(u,c,i)},p(u,i){if(i[0]&16384){p=Array.from(u[14].entries());let d;for(d=0;d<p.length;d+=1){const b=Vt(u,p,d);f[d]?f[d].p(b,i):(f[d]=$t(b),f[d].c(),f[d].m(c.parentNode,c))}for(;d<f.length;d+=1)f[d].d(1);f.length=p.length}},d(u){u&&A(t),u&&A(n),u&&A(o),u&&A(l),u&&A(s),nt(f,u),u&&A(c)}}}function xt(e){let t;return{c(){t=h("span"),t.textContent="(you)",Bt(t,"margin-right","0.5rem")},m(n,o){S(n,t,o)},d(n){n&&A(t)}}}function $t(e){let t,n,o,l,s=e[40]===P.id&&xt();return{c(){t=h("div"),o=y(),s&&s.c(),l=lt(),r(t,"class","icon svelte-1ufj93m"),r(t,"style",n=`--color-hue: ${e[41]}`)},m(c,p){S(c,t,p),S(c,o,p),s&&s.m(c,p),S(c,l,p)},p(c,p){p[0]&16384&&n!==(n=`--color-hue: ${c[41]}`)&&r(t,"style",n),c[40]===P.id?s||(s=xt(),s.c(),s.m(l.parentNode,l)):s&&(s.d(1),s=null)},d(c){c&&A(t),c&&A(o),s&&s.d(c),c&&A(l)}}}function Dn(e){let t;return{c(){t=h("span"),t.textContent="Connecting..."},m(n,o){S(n,t,o)},p:E,d(n){n&&A(t)}}}function Mn(e){let t,n,o,l,s,c,p,f,u,i,d,b,k,F,D,w,K,V,G,he,ve,T,J,Y,ye,L,ke,Ne,W,_,g,C,Pe,De,X,re,te,ce,ue,_e,Me,ne,me,Ke,Fe,we,Te,m,ge,Be,vt,B,yt,Z,kt,fe,wt,Ct,Nt,q,Kt,Oe=e[9].toFixed(1)+"",Ve,St,Ie=e[11].toFixed(1)+"",Ye,At,Pt,x,qe,Et,oe,jt,Xe,Le,Ze,Dt,Se=Ht,z=[];for(let j=0;j<Se.length;j+=1)z[j]=Xt(Yt(e,Se,j));let $={ctx:e,current:null,token:null,hasCatch:!1,pending:Nn,then:Cn,catch:wn};He(g=e[2],$);function Mt(j,N){return j[8]?Sn:Kn}let ze=Mt(e),le=ze(e);function Ft(j,N){return j[12]?Pn:An}let Re=Ft(e),se=Re(e),Q={ctx:e,current:null,token:null,hasCatch:!0,pending:Dn,then:jn,catch:En,error:44};return He(Le=e[13],Q),{c(){t=h("div"),n=h("div"),o=h("div"),l=h("div"),s=h("span"),s.textContent="Sustain:",c=y(),p=h("input"),f=y(),u=h("div"),i=h("span"),i.textContent="Octave Shift:",d=y(),b=h("input"),k=y(),F=h("div"),D=h("span"),D.textContent="Note Shift:",w=y(),K=h("input"),V=y(),G=h("div"),he=h("span"),he.textContent="Volume:",ve=y(),T=h("input"),J=y(),Y=h("input"),ye=y(),L=h("div"),ke=h("span"),ke.textContent="Instrument:",Ne=y(),W=h("select");for(let j=0;j<z.length;j+=1)z[j].c();_=y(),$.block.c(),C=y(),Pe=h("span"),Pe.textContent="Size:",De=y(),X=h("select"),re=h("option"),re.textContent="Full size (88 keys)",te=h("option"),te.textContent="Half size (61 keys)",ce=h("option"),ce.textContent="Quater Size (37 keys)",ue=h("option"),ue.textContent="2 Octaves (24 keys)",_e=h("option"),_e.textContent="1 Octave (12 keys)",Me=y(),ne=h("div"),me=h("div"),Ke=h("p"),Ke.textContent="Play a midi:",Fe=y(),we=h("input"),Te=y(),m=h("div"),le.c(),ge=y(),Be=h("button"),Be.textContent="Restart",vt=y(),B=h("div"),yt=pe("Speed:"),Z=h("input"),kt=y(),fe=h("input"),wt=pe("times"),Ct=h("br"),Nt=y(),q=h("input"),Kt=y(),Ve=pe(Oe),St=pe("/"),Ye=pe(Ie),At=pe(" seconds"),Pt=y(),x=h("div"),qe=h("p"),qe.textContent="Join a room:",Et=y(),oe=h("input"),jt=y(),se.c(),Xe=y(),Q.block.c(),r(p,"type","checkbox"),r(p,"class","svelte-1ufj93m"),r(l,"title","Shortcut: space"),r(l,"class","svelte-1ufj93m"),r(b,"type","number"),r(b,"min","-3"),r(b,"max","3"),r(b,"class","svelte-1ufj93m"),r(u,"title","Shortcut: left ctrl +, left alt or right ctrl -"),r(u,"class","svelte-1ufj93m"),r(K,"type","number"),r(K,"min","-12"),r(K,"max","12"),r(K,"class","svelte-1ufj93m"),r(F,"class","svelte-1ufj93m"),r(T,"type","range"),r(T,"min","0"),r(T,"max","50"),r(T,"step","0.1"),r(T,"class","svelte-1ufj93m"),r(Y,"type","number"),r(Y,"class","svelte-1ufj93m"),r(G,"class","svelte-1ufj93m"),e[0]===void 0&&an(()=>e[22].call(W)),r(L,"class","svelte-1ufj93m"),r(re,"data-range","A0,C8"),re.__value="Full size (88 keys)",re.value=re.__value,r(te,"data-range","C2,C7"),te.selected=!0,te.__value="Half size (61 keys)",te.value=te.__value,r(ce,"data-range","C3,C6"),ce.__value="Quater Size (37 keys)",ce.value=ce.__value,r(ue,"data-range","C4,B5"),ue.__value="2 Octaves (24 keys)",ue.value=ue.__value,r(_e,"data-range","C4,B4"),_e.__value="1 Octave (12 keys)",_e.value=_e.__value,r(o,"class","svelte-1ufj93m"),r(Ke,"class","svelte-1ufj93m"),r(we,"type","file"),r(we,"class","svelte-1ufj93m"),r(me,"class","svelte-1ufj93m"),r(m,"class","svelte-1ufj93m"),r(Z,"type","range"),r(Z,"min","0.01"),r(Z,"max","4"),r(Z,"step","0.01"),r(Z,"class","svelte-1ufj93m"),r(fe,"type","number"),r(fe,"min","0.01"),r(fe,"class","svelte-1ufj93m"),r(q,"type","range"),r(q,"min","0"),r(q,"max",e[11]),r(q,"step","0.1"),Bt(q,"width","18rem"),r(q,"class","svelte-1ufj93m"),r(B,"class","svelte-1ufj93m"),r(ne,"class","svelte-1ufj93m"),r(n,"class","row svelte-1ufj93m"),r(qe,"class","svelte-1ufj93m"),r(oe,"type","text"),r(oe,"placeholder","Room name"),r(oe,"class","svelte-1ufj93m"),r(t,"class","control-panel svelte-1ufj93m")},m(j,N){S(j,t,N),a(t,n),a(n,o),a(o,l),a(l,s),a(l,c),a(l,p),p.checked=e[4],a(o,f),a(o,u),a(u,i),a(u,d),a(u,b),I(b,e[3]),a(o,k),a(o,F),a(F,D),a(F,w),a(F,K),I(K,e[5]),a(o,V),a(o,G),a(G,he),a(G,ve),a(G,T),I(T,e[6]),a(G,J),a(G,Y),I(Y,e[6]),a(o,ye),a(o,L),a(L,ke),a(L,Ne),a(L,W);for(let O=0;O<z.length;O+=1)z[O].m(W,null);Ot(W,e[0]),a(L,_),$.block.m(L,$.anchor=null),$.mount=()=>L,$.anchor=null,a(o,C),a(o,Pe),a(o,De),a(o,X),a(X,re),a(X,te),a(X,ce),a(X,ue),a(X,_e),a(n,Me),a(n,ne),a(ne,me),a(me,Ke),a(me,Fe),a(me,we),a(ne,Te),a(ne,m),le.m(m,null),a(m,ge),a(m,Be),a(ne,vt),a(ne,B),a(B,yt),a(B,Z),I(Z,e[10]),a(B,kt),a(B,fe),I(fe,e[10]),a(B,wt),a(B,Ct),a(B,Nt),a(B,q),I(q,e[9]),a(B,Kt),a(B,Ve),a(B,St),a(B,Ye),a(B,At),a(t,Pt),a(t,x),a(x,qe),a(x,Et),a(x,oe),I(oe,e[1]),a(x,jt),se.m(x,null),a(x,Xe),Q.block.m(x,Q.anchor=null),Q.mount=()=>x,Q.anchor=null,Ze||(Dt=[v(kn,"keydown",e[16]),v(p,"change",e[17]),v(b,"input",e[18]),v(K,"input",e[19]),v(T,"change",e[20]),v(T,"input",e[20]),v(Y,"input",e[21]),v(W,"change",e[22]),v(X,"change",e[23]),rn(e[15].call(null,X)),v(we,"change",e[24]),v(Be,"click",e[27]),v(Z,"change",e[28]),v(Z,"input",e[28]),v(fe,"input",e[29]),v(q,"change",e[30]),v(q,"input",e[30]),v(q,"mousedown",e[31]),v(q,"mouseup",e[32]),v(oe,"input",e[33]),v(oe,"keydown",e[34])],Ze=!0)},p(j,N){if(e=j,N[0]&16&&(p.checked=e[4]),N[0]&8&&ee(b.value)!==e[3]&&I(b,e[3]),N[0]&32&&ee(K.value)!==e[5]&&I(K,e[5]),N[0]&64&&I(T,e[6]),N[0]&64&&ee(Y.value)!==e[6]&&I(Y,e[6]),N&0){Se=Ht;let O;for(O=0;O<Se.length;O+=1){const Tt=Yt(e,Se,O);z[O]?z[O].p(Tt,N):(z[O]=Xt(Tt),z[O].c(),z[O].m(W,null))}for(;O<z.length;O+=1)z[O].d(1);z.length=Se.length}N[0]&1&&Ot(W,e[0]),$.ctx=e,N[0]&4&&g!==(g=e[2])&&He(g,$),ze===(ze=Mt(e))&&le?le.p(e,N):(le.d(1),le=ze(e),le&&(le.c(),le.m(m,ge))),N[0]&1024&&I(Z,e[10]),N[0]&1024&&ee(fe.value)!==e[10]&&I(fe,e[10]),N[0]&2048&&r(q,"max",e[11]),N[0]&512&&I(q,e[9]),N[0]&512&&Oe!==(Oe=e[9].toFixed(1)+"")&&tt(Ve,Oe),N[0]&2048&&Ie!==(Ie=e[11].toFixed(1)+"")&&tt(Ye,Ie),N[0]&2&&oe.value!==e[1]&&I(oe,e[1]),Re===(Re=Ft(e))&&se?se.p(e,N):(se.d(1),se=Re(e),se&&(se.c(),se.m(x,Xe))),Q.ctx=e,N[0]&8192&&Le!==(Le=e[13])&&He(Le,Q)||cn(Q,e,N)},i:E,o:E,d(j){j&&A(t),nt(z,j),$.block.d(),$.token=null,$=null,le.d(),se.d(),Q.block.d(),Q.token=null,Q=null,Ze=!1,ot(Dt)}}}const be=R(0),gt=R(0),je=R(!1),Ue=R(25),bt=R(["C0","C0"]);function Fn(e,t,n){let o,l,s=E,c,p=E,f,u=E,i,d,b=E,k,F=E,D,w,K,V,G,he,ve,T;M(e,be,m=>n(3,l=m)),M(e,je,m=>n(4,c=m)),M(e,bt,m=>n(37,f=m)),M(e,We,m=>n(0,i=m)),M(e,gt,m=>n(5,d=m)),M(e,Ue,m=>n(6,k=m)),M(e,rt,m=>n(7,D=m)),M(e,U,m=>n(8,w=m)),M(e,Ce,m=>n(9,K=m)),M(e,Ee,m=>n(10,V=m)),M(e,Je,m=>n(11,G=m)),M(e,ut,m=>n(12,he=m)),M(e,Qt,m=>n(13,ve=m)),M(e,Ae,m=>n(14,T=m)),e.$$.on_destroy.push(()=>s()),e.$$.on_destroy.push(()=>p()),e.$$.on_destroy.push(()=>u()),e.$$.on_destroy.push(()=>b()),e.$$.on_destroy.push(()=>F());let J="";const ye=new URLSearchParams(window.location.search).get("room");ye&&(J=ye,ht(J));function L(m){const ge=m.children[m.selectedIndex];H(bt,f=ge.dataset.range.split(","),f)}function ke(m){m.code==="Space"&&H(je,c=!c,c),m.code==="ControlLeft"?H(be,l-=1,l):(m.code==="AltLeft"||m.code=="ControlRight")&&H(be,l+=1,l),l<-3?H(be,l=3,l):l>3&&H(be,l=-3,l)}function Ne(){c=this.checked,je.set(c)}function W(){l=ee(this.value),be.set(l)}function _(){d=ee(this.value),gt.set(d)}function g(){k=ee(this.value),Ue.set(k)}function C(){k=ee(this.value),Ue.set(k)}function Pe(){i=_n(this),We.set(i)}const De=m=>L(m.currentTarget),X=m=>{var ge;return H(rt,D=(ge=m.currentTarget.files)==null?void 0:ge[0],D)},re=()=>H(U,w=!1,w),te=()=>H(U,w=!0,w),ce=()=>{H(U,w=!1,w),H(Ce,K=0,K),setTimeout(()=>{H(U,w=!0,w)},100)};function ue(){V=ee(this.value),Ee.set(V)}function _e(){V=ee(this.value),Ee.set(V)}function Me(){K=ee(this.value),Ce.set(K)}const ne=()=>H(U,w=!1,w),me=()=>H(U,w=!0,w);function Ke(){J=this.value,n(1,J)}const Fe=m=>{m.code==="Enter"&&ht(J)},we=()=>P.disconnect(),Te=()=>ht(J);return e.$$.update=()=>{e.$$.dirty[0]&1&&n(2,o=Wt(i))},[i,J,o,l,c,d,k,D,w,K,V,G,he,ve,T,L,ke,Ne,W,_,g,C,Pe,De,X,re,te,ce,ue,_e,Me,ne,me,Ke,Fe,we,Te]}class Tn extends xe{constructor(t){super();$e(this,t,Fn,Mn,et,{},null,[-1,-1])}}function en(e,t,n){const o=e.slice();return o[27]=t[n][0],o[28]=t[n][1].white,o[29]=t[n][1].pressedColor,o[30]=t[n][1].ghost,o}function tn(e){let t,n,o,l,s;function c(...i){return e[14](e[27],...i)}function p(){return e[15](e[27])}function f(){return e[16](e[27])}function u(){return e[17](e[27])}return{c(){t=h("div"),r(t,"class",n="key "+(e[28]?"white":"black")+" svelte-yqi7mq"),r(t,"style",o=`--color-hue: ${e[29]}`),Ge(t,"pressed",e[29]!==null),Ge(t,"ghost",e[30]&&e[29]===null)},m(i,d){S(i,t,d),l||(s=[v(t,"pointerdown",c),v(t,"pointerenter",p),v(t,"pointerleave",f),v(t,"pointerup",u)],l=!0)},p(i,d){e=i,d[0]&4&&n!==(n="key "+(e[28]?"white":"black")+" svelte-yqi7mq")&&r(t,"class",n),d[0]&4&&o!==(o=`--color-hue: ${e[29]}`)&&r(t,"style",o),d[0]&4&&Ge(t,"pressed",e[29]!==null),d[0]&4&&Ge(t,"ghost",e[30]&&e[29]===null)},d(i){i&&A(t),l=!1,ot(s)}}}function Bn(e){let t,n,o,l,s,c=Object.entries(e[2]),p=[];for(let f=0;f<c.length;f+=1)p[f]=tn(en(e,c,f));return{c(){t=h("div"),n=h("div");for(let f=0;f<p.length;f+=1)p[f].c();r(n,"class","piano svelte-yqi7mq"),r(n,"style",o=`--white-keys: ${e[0]}`),r(t,"class","piano-container svelte-yqi7mq")},m(f,u){S(f,t,u),a(t,n);for(let i=0;i<p.length;i+=1)p[i].m(n,null);e[18](t),l||(s=[v(window,"resize",e[10]),v(window,"load",e[11]),v(window,"keyup",e[8]),v(window,"keydown",e[7]),v(window,"pointerdown",e[12]),v(window,"pointerup",e[13]),v(n,"touchend",fn(e[9]))],l=!0)},p(f,u){if(u[0]&54){c=Object.entries(f[2]);let i;for(i=0;i<c.length;i+=1){const d=en(f,c,i);p[i]?p[i].p(d,u):(p[i]=tn(d),p[i].c(),p[i].m(n,null))}for(;i<p.length;i+=1)p[i].d(1);p.length=c.length}u[0]&1&&o!==(o=`--white-keys: ${f[0]}`)&&r(n,"style",o)},i:E,o:E,d(f){f&&A(t),nt(p,f),e[18](null),l=!1,ot(s)}}}function nn(e,t){t.get(e)&&(t.get(e).stop(),t.delete(e))}function On(e,t,n){let o,l,s,c;M(e,je,_=>n(19,o=_)),M(e,Ue,_=>n(20,l=_)),M(e,gt,_=>n(21,s=_)),M(e,be,_=>n(22,c=_));let p=!1,f,u,i,d=new Map;bt.subscribe(_=>{const g=mn(_[0],_[1]);n(2,f=g.noteMap),n(0,u=g.whiteKeys)});function b(_){var C;const g=de.get((C=_.socketID)!=null?C:"0");f[_.note]&&n(2,f[_.note].pressedColor=g.colorHue,f),!!g.instrument&&(nn(_.note,g.audioNodeMap),g.audioNodeMap.set(_.note,g.instrument.play(_.note,void 0,{gain:_.volume})))}function k(_){var C;const g=de.get((C=_.socketID)!=null?C:"0");f[_.note]&&n(2,f[_.note].pressedColor=null,f),_.sustain||nn(_.note,g.audioNodeMap)}vn(b,k);function F(_){let g=st(_)+c,C=ae.indexOf(it(_));return C+=s,C>=ae.length&&(g+=Math.floor(C/ae.length),C=C%ae.length),ae[C]+g}function D(_,g){const C=F(_);d.get(C)||(f[_]&&n(2,f[_].ghost=!0,f),d.set(C,!0),yn(C,l*g))}function w(_){const g=F(_);f[_]&&n(2,f[_].ghost=!1,f),!!d.get(g)&&(d.delete(g),mt(g,o))}gn(D,w),je.subscribe(_=>{if(!_)for(const g of Qe.audioNodeMap.keys())d.get(g)||mt(g,!1)}),be.subscribe(()=>{for(const _ of d.keys())mt(_,o)});function K(_=u){if(!i)return;const g=i.clientHeight/6,C=i.offsetWidth/_;i.style.setProperty("--white-key-width",`${Math.min(C,g)}px`)}function V(_){const g=Gt[_.code],C=_.target;g&&C.tagName!=="INPUT"&&(_.preventDefault(),D(g,.5))}function G(_){const g=Gt[_.code];g&&w(g)}function he(_){pn.call(this,e,_)}const ve=()=>K(),T=()=>K(),J=()=>n(1,p=!0),Y=()=>n(1,p=!1),ye=(_,g)=>{g.currentTarget.releasePointerCapture(g.pointerId),D(_,.5)},L=_=>{p&&D(_,.5)},ke=_=>w(_),Ne=_=>w(_);function W(_){dn[_?"unshift":"push"](()=>{i=_,n(3,i)})}return e.$$.update=()=>{e.$$.dirty[0]&1&&K(u)},[u,p,f,i,D,w,K,V,G,he,ve,T,J,Y,ye,L,ke,Ne,W]}class In extends xe{constructor(t){super();$e(this,t,On,Bn,et,{},null,[-1,-1])}}function qn(e){let t,n,o,l,s;return n=new Tn({}),l=new In({}),{c(){t=h("main"),It(n.$$.fragment),o=y(),It(l.$$.fragment),r(t,"class","svelte-ieeeet")},m(c,p){S(c,t,p),qt(n,t,null),a(t,o),qt(l,t,null),s=!0},p:E,i(c){s||(Lt(n.$$.fragment,c),Lt(l.$$.fragment,c),s=!0)},o(c){zt(n.$$.fragment,c),zt(l.$$.fragment,c),s=!1},d(c){c&&A(t),Rt(n),Rt(l)}}}class Ln extends xe{constructor(t){super();$e(this,t,null,qn,et,{})}}new Ln({target:document.body});

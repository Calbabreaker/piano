var Zn=Object.defineProperty;var $n=(t,e,n)=>e in t?Zn(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n;var M=(t,e,n)=>$n(t,typeof e!="symbol"?e+"":e,n);(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))r(i);new MutationObserver(i=>{for(const o of i)if(o.type==="childList")for(const s of o.addedNodes)s.tagName==="LINK"&&s.rel==="modulepreload"&&r(s)}).observe(document,{childList:!0,subtree:!0});function n(i){const o={};return i.integrity&&(o.integrity=i.integrity),i.referrerPolicy&&(o.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?o.credentials="include":i.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function r(i){if(i.ep)return;i.ep=!0;const o=n(i);fetch(i.href,o)}})();function X(){}function jn(t){return!!t&&(typeof t=="object"||typeof t=="function")&&typeof t.then=="function"}function Dn(t){return t()}function tn(){return Object.create(null)}function we(t){t.forEach(Dn)}function An(t){return typeof t=="function"}function He(t,e){return t!=t?e==e:t!==e||t&&typeof t=="object"||typeof t=="function"}let yt;function Nn(t,e){return t===e?!0:(yt||(yt=document.createElement("a")),yt.href=e,t===yt.href)}function er(t){return Object.keys(t).length===0}function On(t,...e){if(t==null){for(const r of e)r(void 0);return X}const n=t.subscribe(...e);return n.unsubscribe?()=>n.unsubscribe():n}function ee(t){let e;return On(t,n=>e=n)(),e}function Y(t,e,n){t.$$.on_destroy.push(On(e,n))}function ce(t,e,n){return t.set(n),e}function v(t,e){t.appendChild(e)}function N(t,e,n){t.insertBefore(e,n||null)}function A(t){t.parentNode&&t.parentNode.removeChild(t)}function ht(t,e){for(let n=0;n<t.length;n+=1)t[n]&&t[n].d(e)}function b(t){return document.createElement(t)}function ne(t){return document.createTextNode(t)}function E(){return ne(" ")}function Bn(){return ne("")}function C(t,e,n,r){return t.addEventListener(e,n,r),()=>t.removeEventListener(e,n,r)}function nn(t){return function(e){return e.preventDefault(),t.call(this,e)}}function k(t,e,n){n==null?t.removeAttribute(e):t.getAttribute(e)!==n&&t.setAttribute(e,n)}function Ue(t){return t===""?null:+t}function tr(t){return Array.from(t.childNodes)}function ze(t,e){e=""+e,t.data!==e&&(t.data=e)}function Z(t,e){t.value=e??""}function Be(t,e,n,r){n==null?t.style.removeProperty(e):t.style.setProperty(e,n,"")}function Pe(t,e,n){for(let r=0;r<t.options.length;r+=1){const i=t.options[r];if(i.__value===e){i.selected=!0;return}}(!n||e!==void 0)&&(t.selectedIndex=-1)}function kt(t){const e=t.querySelector(":checked");return e&&e.__value}function rn(t,e,n){t.classList.toggle(e,!!n)}let dt;function Te(t){dt=t}function Qt(){if(!dt)throw new Error("Function called outside component initialization");return dt}function Fn(t){Qt().$$.on_mount.push(t)}function nr(t){Qt().$$.on_destroy.push(t)}function sn(t,e){const n=t.$$.callbacks[e.type];n&&n.slice().forEach(r=>r.call(this,e))}const Ge=[],Gt=[];let Ze=[];const on=[],rr=Promise.resolve();let qt=!1;function ir(){qt||(qt=!0,rr.then(Zt))}function Fe(t){Ze.push(t)}const Lt=new Set;let Ve=0;function Zt(){if(Ve!==0)return;const t=dt;do{try{for(;Ve<Ge.length;){const e=Ge[Ve];Ve++,Te(e),sr(e.$$)}}catch(e){throw Ge.length=0,Ve=0,e}for(Te(null),Ge.length=0,Ve=0;Gt.length;)Gt.pop()();for(let e=0;e<Ze.length;e+=1){const n=Ze[e];Lt.has(n)||(Lt.add(n),n())}Ze.length=0}while(Ge.length);for(;on.length;)on.pop()();qt=!1,Lt.clear(),Te(t)}function sr(t){if(t.fragment!==null){t.update(),we(t.before_update);const e=t.dirty;t.dirty=[-1],t.fragment&&t.fragment.p(t.ctx,e),t.after_update.forEach(Fe)}}function or(t){const e=[],n=[];Ze.forEach(r=>t.indexOf(r)===-1?e.push(r):n.push(r)),n.forEach(r=>r()),Ze=e}const It=new Set;let Oe;function ar(){Oe={r:0,c:[],p:Oe}}function cr(){Oe.r||we(Oe.c),Oe=Oe.p}function Le(t,e){t&&t.i&&(It.delete(t),t.i(e))}function $e(t,e,n,r){if(t&&t.o){if(It.has(t))return;It.add(t),Oe.c.push(()=>{It.delete(t),r&&(n&&t.d(1),r())}),t.o(e)}else r&&r()}function an(t,e){const n=e.token={};function r(i,o,s,c){if(e.token!==n)return;e.resolved=c;let u=e.ctx;s!==void 0&&(u=u.slice(),u[s]=c);const a=i&&(e.current=i)(u);let d=!1;e.block&&(e.blocks?e.blocks.forEach((f,l)=>{l!==o&&f&&(ar(),$e(f,1,1,()=>{e.blocks[l]===f&&(e.blocks[l]=null)}),cr())}):e.block.d(1),a.c(),Le(a,1),a.m(e.mount(),e.anchor),d=!0),e.block=a,e.blocks&&(e.blocks[o]=a),d&&Zt()}if(jn(t)){const i=Qt();if(t.then(o=>{Te(i),r(e.then,1,e.value,o),Te(null)},o=>{if(Te(i),r(e.catch,2,e.error,o),Te(null),!e.hasCatch)throw o}),e.current!==e.pending)return r(e.pending,0),!0}else{if(e.current!==e.then)return r(e.then,1,e.value,t),!0;e.resolved=t}}function Ie(t){return(t==null?void 0:t.length)!==void 0?t:Array.from(t)}function ft(t){t&&t.c()}function je(t,e,n){const{fragment:r,after_update:i}=t.$$;r&&r.m(e,n),Fe(()=>{const o=t.$$.on_mount.map(Dn).filter(An);t.$$.on_destroy?t.$$.on_destroy.push(...o):we(o),t.$$.on_mount=[]}),i.forEach(Fe)}function et(t,e){const n=t.$$;n.fragment!==null&&(or(n.after_update),we(n.on_destroy),n.fragment&&n.fragment.d(e),n.on_destroy=n.fragment=null,n.ctx=[])}function lr(t,e){t.$$.dirty[0]===-1&&(Ge.push(t),ir(),t.$$.dirty.fill(0)),t.$$.dirty[e/31|0]|=1<<e%31}function nt(t,e,n,r,i,o,s=null,c=[-1]){const u=dt;Te(t);const a=t.$$={fragment:null,ctx:[],props:o,update:X,not_equal:i,bound:tn(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(e.context||(u?u.$$.context:[])),callbacks:tn(),dirty:c,skip_bound:!1,root:e.target||u.$$.root};s&&s(a.root);let d=!1;if(a.ctx=n?n(t,e.props||{},(f,l,...h)=>{const p=h.length?h[0]:l;return a.ctx&&i(a.ctx[f],a.ctx[f]=p)&&(!a.skip_bound&&a.bound[f]&&a.bound[f](p),d&&lr(t,f)),l}):[],a.update(),d=!0,we(a.before_update),a.fragment=r?r(a.ctx):!1,e.target){if(e.hydrate){const f=tr(e.target);a.fragment&&a.fragment.l(f),f.forEach(A)}else a.fragment&&a.fragment.c();e.intro&&Le(t.$$.fragment),je(t,e.target,e.anchor),Zt()}Te(u)}class rt{constructor(){M(this,"$$");M(this,"$$set")}$destroy(){et(this,1),this.$destroy=X}$on(e,n){if(!An(n))return X;const r=this.$$.callbacks[e]||(this.$$.callbacks[e]=[]);return r.push(n),()=>{const i=r.indexOf(n);i!==-1&&r.splice(i,1)}}$set(e){this.$$set&&!er(e)&&(this.$$.skip_bound=!0,this.$$set(e),this.$$.skip_bound=!1)}}const ur="4";typeof window<"u"&&(window.__svelte||(window.__svelte={v:new Set})).v.add(ur);var Ye=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function fr(t){if(t.__esModule)return t;var e=t.default;if(typeof e=="function"){var n=function r(){return this instanceof r?Reflect.construct(e,arguments,this.constructor):e.apply(this,arguments)};n.prototype=e.prototype}else n={};return Object.defineProperty(n,"__esModule",{value:!0}),Object.keys(t).forEach(function(r){var i=Object.getOwnPropertyDescriptor(t,r);Object.defineProperty(n,r,i.get?i:{enumerable:!0,get:function(){return t[r]}})}),n}var Jt={},Dt={};function hr(t){var e=new ye(t),n=e.readChunk();if(n.id!="MThd")throw"Bad MIDI file.  Expected 'MHdr', got: '"+n.id+"'";for(var r=dr(n.data),i=[],o=0;!e.eof()&&o<r.numTracks;o++){var s=e.readChunk();if(s.id!="MTrk")throw"Bad MIDI file.  Expected 'MTrk', got: '"+s.id+"'";var c=pr(s.data);i.push(c)}return{header:r,tracks:i}}function dr(t){var e=new ye(t),n=e.readUInt16(),r=e.readUInt16(),i={format:n,numTracks:r},o=e.readUInt16();return o&32768?(i.framesPerSecond=256-(o>>8),i.ticksPerFrame=o&255):i.ticksPerBeat=o,i}function pr(t){for(var e=new ye(t),n=[];!e.eof();){var r=o();n.push(r)}return n;var i;function o(){var s={};s.deltaTime=e.readVarInt();var c=e.readUInt8();if((c&240)===240)if(c===255){s.meta=!0;var u=e.readUInt8(),a=e.readVarInt();switch(u){case 0:if(s.type="sequenceNumber",a!==2)throw"Expected length for sequenceNumber event is 2, got "+a;return s.number=e.readUInt16(),s;case 1:return s.type="text",s.text=e.readString(a),s;case 2:return s.type="copyrightNotice",s.text=e.readString(a),s;case 3:return s.type="trackName",s.text=e.readString(a),s;case 4:return s.type="instrumentName",s.text=e.readString(a),s;case 5:return s.type="lyrics",s.text=e.readString(a),s;case 6:return s.type="marker",s.text=e.readString(a),s;case 7:return s.type="cuePoint",s.text=e.readString(a),s;case 32:if(s.type="channelPrefix",a!=1)throw"Expected length for channelPrefix event is 1, got "+a;return s.channel=e.readUInt8(),s;case 33:if(s.type="portPrefix",a!=1)throw"Expected length for portPrefix event is 1, got "+a;return s.port=e.readUInt8(),s;case 47:if(s.type="endOfTrack",a!=0)throw"Expected length for endOfTrack event is 0, got "+a;return s;case 81:if(s.type="setTempo",a!=3)throw"Expected length for setTempo event is 3, got "+a;return s.microsecondsPerBeat=e.readUInt24(),s;case 84:if(s.type="smpteOffset",a!=5)throw"Expected length for smpteOffset event is 5, got "+a;var d=e.readUInt8(),f={0:24,32:25,64:29,96:30};return s.frameRate=f[d&96],s.hour=d&31,s.min=e.readUInt8(),s.sec=e.readUInt8(),s.frame=e.readUInt8(),s.subFrame=e.readUInt8(),s;case 88:if(s.type="timeSignature",a!=2&&a!=4)throw"Expected length for timeSignature event is 4 or 2, got "+a;return s.numerator=e.readUInt8(),s.denominator=1<<e.readUInt8(),a===4?(s.metronome=e.readUInt8(),s.thirtyseconds=e.readUInt8()):(s.metronome=36,s.thirtyseconds=8),s;case 89:if(s.type="keySignature",a!=2)throw"Expected length for keySignature event is 2, got "+a;return s.key=e.readInt8(),s.scale=e.readUInt8(),s;case 127:return s.type="sequencerSpecific",s.data=e.readBytes(a),s;default:return s.type="unknownMeta",s.data=e.readBytes(a),s.metatypeByte=u,s}}else if(c==240){s.type="sysEx";var a=e.readVarInt();return s.data=e.readBytes(a),s}else if(c==247){s.type="endSysEx";var a=e.readVarInt();return s.data=e.readBytes(a),s}else throw"Unrecognised MIDI event type byte: "+c;else{var l;if(c&128)l=e.readUInt8(),i=c;else{if(i===null)throw"Running status byte encountered before status byte";l=c,c=i,s.running=!0}var h=c>>4;switch(s.channel=c&15,h){case 8:return s.type="noteOff",s.noteNumber=l,s.velocity=e.readUInt8(),s;case 9:var p=e.readUInt8();return s.type=p===0?"noteOff":"noteOn",s.noteNumber=l,s.velocity=p,p===0&&(s.byte9=!0),s;case 10:return s.type="noteAftertouch",s.noteNumber=l,s.amount=e.readUInt8(),s;case 11:return s.type="controller",s.controllerType=l,s.value=e.readUInt8(),s;case 12:return s.type="programChange",s.programNumber=l,s;case 13:return s.type="channelAftertouch",s.amount=l,s;case 14:return s.type="pitchBend",s.value=l+(e.readUInt8()<<7)-8192,s;default:throw"Unrecognised MIDI event type: "+h}}}}function ye(t){this.buffer=t,this.bufferLen=this.buffer.length,this.pos=0}ye.prototype.eof=function(){return this.pos>=this.bufferLen};ye.prototype.readUInt8=function(){var t=this.buffer[this.pos];return this.pos+=1,t};ye.prototype.readInt8=function(){var t=this.readUInt8();return t&128?t-256:t};ye.prototype.readUInt16=function(){var t=this.readUInt8(),e=this.readUInt8();return(t<<8)+e};ye.prototype.readInt16=function(){var t=this.readUInt16();return t&32768?t-65536:t};ye.prototype.readUInt24=function(){var t=this.readUInt8(),e=this.readUInt8(),n=this.readUInt8();return(t<<16)+(e<<8)+n};ye.prototype.readInt24=function(){var t=this.readUInt24();return t&8388608?t-16777216:t};ye.prototype.readUInt32=function(){var t=this.readUInt8(),e=this.readUInt8(),n=this.readUInt8(),r=this.readUInt8();return(t<<24)+(e<<16)+(n<<8)+r};ye.prototype.readBytes=function(t){var e=this.buffer.slice(this.pos,this.pos+t);return this.pos+=t,e};ye.prototype.readString=function(t){var e=this.readBytes(t);return String.fromCharCode.apply(null,e)};ye.prototype.readVarInt=function(){for(var t=0;!this.eof();){var e=this.readUInt8();if(e&128)t+=e&127,t<<=7;else return t+e}return t};ye.prototype.readChunk=function(){var t=this.readString(4),e=this.readUInt32(),n=this.readBytes(e);return{id:t,length:e,data:n}};var mr=hr;function yr(t,e){if(typeof t!="object")throw"Invalid MIDI data";e=e||{};var n=t.header||{},r=t.tracks||[],i,o=r.length,s=new re;for(vr(s,n,o),i=0;i<o;i++)gr(s,r[i],e);return s.buffer}function vr(t,e,n){var r=e.format==null?1:e.format,i=128;e.timeDivision?i=e.timeDivision:e.ticksPerFrame&&e.framesPerSecond?i=-(e.framesPerSecond&255)<<8|e.ticksPerFrame&255:e.ticksPerBeat&&(i=e.ticksPerBeat&32767);var o=new re;o.writeUInt16(r),o.writeUInt16(n),o.writeUInt16(i),t.writeChunk("MThd",o.buffer)}function gr(t,e,n){var r=new re,i,o=e.length,s=null;for(i=0;i<o;i++)(n.running===!1||!n.running&&!e[i].running)&&(s=null),s=_r(r,e[i],s,n.useByte9ForNoteOff);t.writeChunk("MTrk",r.buffer)}function _r(t,e,n,r){var i=e.type,o=e.deltaTime,s=e.text||"",c=e.data||[],u=null;switch(t.writeVarInt(o),i){case"sequenceNumber":t.writeUInt8(255),t.writeUInt8(0),t.writeVarInt(2),t.writeUInt16(e.number);break;case"text":t.writeUInt8(255),t.writeUInt8(1),t.writeVarInt(s.length),t.writeString(s);break;case"copyrightNotice":t.writeUInt8(255),t.writeUInt8(2),t.writeVarInt(s.length),t.writeString(s);break;case"trackName":t.writeUInt8(255),t.writeUInt8(3),t.writeVarInt(s.length),t.writeString(s);break;case"instrumentName":t.writeUInt8(255),t.writeUInt8(4),t.writeVarInt(s.length),t.writeString(s);break;case"lyrics":t.writeUInt8(255),t.writeUInt8(5),t.writeVarInt(s.length),t.writeString(s);break;case"marker":t.writeUInt8(255),t.writeUInt8(6),t.writeVarInt(s.length),t.writeString(s);break;case"cuePoint":t.writeUInt8(255),t.writeUInt8(7),t.writeVarInt(s.length),t.writeString(s);break;case"channelPrefix":t.writeUInt8(255),t.writeUInt8(32),t.writeVarInt(1),t.writeUInt8(e.channel);break;case"portPrefix":t.writeUInt8(255),t.writeUInt8(33),t.writeVarInt(1),t.writeUInt8(e.port);break;case"endOfTrack":t.writeUInt8(255),t.writeUInt8(47),t.writeVarInt(0);break;case"setTempo":t.writeUInt8(255),t.writeUInt8(81),t.writeVarInt(3),t.writeUInt24(e.microsecondsPerBeat);break;case"smpteOffset":t.writeUInt8(255),t.writeUInt8(84),t.writeVarInt(5);var a={24:0,25:32,29:64,30:96},d=e.hour&31|a[e.frameRate];t.writeUInt8(d),t.writeUInt8(e.min),t.writeUInt8(e.sec),t.writeUInt8(e.frame),t.writeUInt8(e.subFrame);break;case"timeSignature":t.writeUInt8(255),t.writeUInt8(88),t.writeVarInt(4),t.writeUInt8(e.numerator);var f=Math.floor(Math.log(e.denominator)/Math.LN2)&255;t.writeUInt8(f),t.writeUInt8(e.metronome),t.writeUInt8(e.thirtyseconds||8);break;case"keySignature":t.writeUInt8(255),t.writeUInt8(89),t.writeVarInt(2),t.writeInt8(e.key),t.writeUInt8(e.scale);break;case"sequencerSpecific":t.writeUInt8(255),t.writeUInt8(127),t.writeVarInt(c.length),t.writeBytes(c);break;case"unknownMeta":e.metatypeByte!=null&&(t.writeUInt8(255),t.writeUInt8(e.metatypeByte),t.writeVarInt(c.length),t.writeBytes(c));break;case"sysEx":t.writeUInt8(240),t.writeVarInt(c.length),t.writeBytes(c);break;case"endSysEx":t.writeUInt8(247),t.writeVarInt(c.length),t.writeBytes(c);break;case"noteOff":var l=r!==!1&&e.byte9||r&&e.velocity==0?144:128;u=l|e.channel,u!==n&&t.writeUInt8(u),t.writeUInt8(e.noteNumber),t.writeUInt8(e.velocity);break;case"noteOn":u=144|e.channel,u!==n&&t.writeUInt8(u),t.writeUInt8(e.noteNumber),t.writeUInt8(e.velocity);break;case"noteAftertouch":u=160|e.channel,u!==n&&t.writeUInt8(u),t.writeUInt8(e.noteNumber),t.writeUInt8(e.amount);break;case"controller":u=176|e.channel,u!==n&&t.writeUInt8(u),t.writeUInt8(e.controllerType),t.writeUInt8(e.value);break;case"programChange":u=192|e.channel,u!==n&&t.writeUInt8(u),t.writeUInt8(e.programNumber);break;case"channelAftertouch":u=208|e.channel,u!==n&&t.writeUInt8(u),t.writeUInt8(e.amount);break;case"pitchBend":u=224|e.channel,u!==n&&t.writeUInt8(u);var h=8192+e.value,p=h&127,m=h>>7&127;t.writeUInt8(p),t.writeUInt8(m);break;default:throw"Unrecognized event type: "+i}return u}function re(){this.buffer=[]}re.prototype.writeUInt8=function(t){this.buffer.push(t&255)};re.prototype.writeInt8=re.prototype.writeUInt8;re.prototype.writeUInt16=function(t){var e=t>>8&255,n=t&255;this.writeUInt8(e),this.writeUInt8(n)};re.prototype.writeInt16=re.prototype.writeUInt16;re.prototype.writeUInt24=function(t){var e=t>>16&255,n=t>>8&255,r=t&255;this.writeUInt8(e),this.writeUInt8(n),this.writeUInt8(r)};re.prototype.writeInt24=re.prototype.writeUInt24;re.prototype.writeUInt32=function(t){var e=t>>24&255,n=t>>16&255,r=t>>8&255,i=t&255;this.writeUInt8(e),this.writeUInt8(n),this.writeUInt8(r),this.writeUInt8(i)};re.prototype.writeInt32=re.prototype.writeUInt32;re.prototype.writeBytes=function(t){this.buffer=this.buffer.concat(Array.prototype.slice.call(t,0))};re.prototype.writeString=function(t){var e,n=t.length,r=[];for(e=0;e<n;e++)r.push(t.codePointAt(e));this.writeBytes(r)};re.prototype.writeVarInt=function(t){if(t<0)throw"Cannot write negative variable-length integer";if(t<=127)this.writeUInt8(t);else{var e=t,n=[];for(n.push(e&127),e>>=7;e;){var r=e&127|128;n.push(r),e>>=7}this.writeBytes(n.reverse())}};re.prototype.writeChunk=function(t,e){this.writeString(t),this.writeUInt32(e.length),this.writeBytes(e)};var br=yr;Dt.parseMidi=mr;Dt.writeMidi=br;var Ct={},Re={};Object.defineProperty(Re,"__esModule",{value:!0});Re.insert=Re.search=void 0;function Ln(t,e,n){n===void 0&&(n="ticks");var r=0,i=t.length,o=i;if(i>0&&t[i-1][n]<=e)return i-1;for(;r<o;){var s=Math.floor(r+(o-r)/2),c=t[s],u=t[s+1];if(c[n]===e){for(var a=s;a<t.length;a++){var d=t[a];d[n]===e&&(s=a)}return s}else{if(c[n]<e&&u[n]>e)return s;c[n]>e?o=s:c[n]<e&&(r=s+1)}}return-1}Re.search=Ln;function wr(t,e,n){if(n===void 0&&(n="ticks"),t.length){var r=Ln(t,e[n],n);t.splice(r+1,0,e)}else t.push(e)}Re.insert=wr;(function(t){Object.defineProperty(t,"__esModule",{value:!0}),t.Header=t.keySignatureKeys=void 0;var e=Re,n=new WeakMap;t.keySignatureKeys=["Cb","Gb","Db","Ab","Eb","Bb","F","C","G","D","A","E","B","F#","C#"];var r=function(){function i(o){var s=this;if(this.tempos=[],this.timeSignatures=[],this.keySignatures=[],this.meta=[],this.name="",n.set(this,480),o){n.set(this,o.header.ticksPerBeat),o.tracks.forEach(function(u){u.forEach(function(a){a.meta&&(a.type==="timeSignature"?s.timeSignatures.push({ticks:a.absoluteTime,timeSignature:[a.numerator,a.denominator]}):a.type==="setTempo"?s.tempos.push({bpm:6e7/a.microsecondsPerBeat,ticks:a.absoluteTime}):a.type==="keySignature"&&s.keySignatures.push({key:t.keySignatureKeys[a.key+7],scale:a.scale===0?"major":"minor",ticks:a.absoluteTime}))})});var c=0;o.tracks[0].forEach(function(u){c+=u.deltaTime,u.meta&&(u.type==="trackName"?s.name=u.text:(u.type==="text"||u.type==="cuePoint"||u.type==="marker"||u.type==="lyrics")&&s.meta.push({text:u.text,ticks:c,type:u.type}))}),this.update()}}return i.prototype.update=function(){var o=this,s=0,c=0;this.tempos.sort(function(u,a){return u.ticks-a.ticks}),this.tempos.forEach(function(u,a){var d=a>0?o.tempos[a-1].bpm:o.tempos[0].bpm,f=u.ticks/o.ppq-c,l=60/d*f;u.time=l+s,s=u.time,c+=f}),this.timeSignatures.sort(function(u,a){return u.ticks-a.ticks}),this.timeSignatures.forEach(function(u,a){var d=a>0?o.timeSignatures[a-1]:o.timeSignatures[0],f=(u.ticks-d.ticks)/o.ppq,l=f/d.timeSignature[0]/(d.timeSignature[1]/4);d.measures=d.measures||0,u.measures=l+d.measures})},i.prototype.ticksToSeconds=function(o){var s=(0,e.search)(this.tempos,o);if(s!==-1){var c=this.tempos[s],u=c.time,a=(o-c.ticks)/this.ppq;return u+60/c.bpm*a}else{var d=o/this.ppq;return 60/120*d}},i.prototype.ticksToMeasures=function(o){var s=(0,e.search)(this.timeSignatures,o);if(s!==-1){var c=this.timeSignatures[s],u=(o-c.ticks)/this.ppq;return c.measures+u/(c.timeSignature[0]/c.timeSignature[1])/4}else return o/this.ppq/4},Object.defineProperty(i.prototype,"ppq",{get:function(){return n.get(this)},enumerable:!1,configurable:!0}),i.prototype.secondsToTicks=function(o){var s=(0,e.search)(this.tempos,o,"time");if(s!==-1){var c=this.tempos[s],u=c.time,a=o-u,d=a/(60/c.bpm);return Math.round(c.ticks+d*this.ppq)}else{var f=o/.5;return Math.round(f*this.ppq)}},i.prototype.toJSON=function(){return{keySignatures:this.keySignatures,meta:this.meta,name:this.name,ppq:this.ppq,tempos:this.tempos.map(function(o){return{bpm:o.bpm,ticks:o.ticks}}),timeSignatures:this.timeSignatures}},i.prototype.fromJSON=function(o){this.name=o.name,this.tempos=o.tempos.map(function(s){return Object.assign({},s)}),this.timeSignatures=o.timeSignatures.map(function(s){return Object.assign({},s)}),this.keySignatures=o.keySignatures.map(function(s){return Object.assign({},s)}),this.meta=o.meta.map(function(s){return Object.assign({},s)}),n.set(this,o.ppq),this.update()},i.prototype.setTempo=function(o){this.tempos=[{bpm:o,ticks:0}],this.update()},i}();t.Header=r})(Ct);var pt={},$t={};(function(t){Object.defineProperty(t,"__esModule",{value:!0}),t.ControlChange=t.controlChangeIds=t.controlChangeNames=void 0,t.controlChangeNames={1:"modulationWheel",2:"breath",4:"footController",5:"portamentoTime",7:"volume",8:"balance",10:"pan",64:"sustain",65:"portamentoTime",66:"sostenuto",67:"softPedal",68:"legatoFootswitch",84:"portamentoControl"},t.controlChangeIds=Object.keys(t.controlChangeNames).reduce(function(i,o){return i[t.controlChangeNames[o]]=o,i},{});var e=new WeakMap,n=new WeakMap,r=function(){function i(o,s){e.set(this,s),n.set(this,o.controllerType),this.ticks=o.absoluteTime,this.value=o.value}return Object.defineProperty(i.prototype,"number",{get:function(){return n.get(this)},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"name",{get:function(){return t.controlChangeNames[this.number]?t.controlChangeNames[this.number]:null},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"time",{get:function(){var o=e.get(this);return o.ticksToSeconds(this.ticks)},set:function(o){var s=e.get(this);this.ticks=s.secondsToTicks(o)},enumerable:!1,configurable:!0}),i.prototype.toJSON=function(){return{number:this.number,ticks:this.ticks,time:this.time,value:this.value}},i}();t.ControlChange=r})($t);var At={};Object.defineProperty(At,"__esModule",{value:!0});At.createControlChanges=void 0;var vt=$t;function kr(){return new Proxy({},{get:function(t,e){if(t[e])return t[e];if(vt.controlChangeIds.hasOwnProperty(e))return t[vt.controlChangeIds[e]]},set:function(t,e,n){return vt.controlChangeIds.hasOwnProperty(e)?t[vt.controlChangeIds[e]]=n:t[e]=n,!0}})}At.createControlChanges=kr;var Nt={};Object.defineProperty(Nt,"__esModule",{value:!0});Nt.PitchBend=void 0;var zt=new WeakMap,Ir=function(){function t(e,n){zt.set(this,n),this.ticks=e.absoluteTime,this.value=e.value}return Object.defineProperty(t.prototype,"time",{get:function(){var e=zt.get(this);return e.ticksToSeconds(this.ticks)},set:function(e){var n=zt.get(this);this.ticks=n.secondsToTicks(e)},enumerable:!1,configurable:!0}),t.prototype.toJSON=function(){return{ticks:this.ticks,time:this.time,value:this.value}},t}();Nt.PitchBend=Ir;var Ot={},Ee={};Object.defineProperty(Ee,"__esModule",{value:!0});Ee.DrumKitByPatchID=Ee.InstrumentFamilyByID=Ee.instrumentByPatchID=void 0;Ee.instrumentByPatchID=["acoustic grand piano","bright acoustic piano","electric grand piano","honky-tonk piano","electric piano 1","electric piano 2","harpsichord","clavi","celesta","glockenspiel","music box","vibraphone","marimba","xylophone","tubular bells","dulcimer","drawbar organ","percussive organ","rock organ","church organ","reed organ","accordion","harmonica","tango accordion","acoustic guitar (nylon)","acoustic guitar (steel)","electric guitar (jazz)","electric guitar (clean)","electric guitar (muted)","overdriven guitar","distortion guitar","guitar harmonics","acoustic bass","electric bass (finger)","electric bass (pick)","fretless bass","slap bass 1","slap bass 2","synth bass 1","synth bass 2","violin","viola","cello","contrabass","tremolo strings","pizzicato strings","orchestral harp","timpani","string ensemble 1","string ensemble 2","synthstrings 1","synthstrings 2","choir aahs","voice oohs","synth voice","orchestra hit","trumpet","trombone","tuba","muted trumpet","french horn","brass section","synthbrass 1","synthbrass 2","soprano sax","alto sax","tenor sax","baritone sax","oboe","english horn","bassoon","clarinet","piccolo","flute","recorder","pan flute","blown bottle","shakuhachi","whistle","ocarina","lead 1 (square)","lead 2 (sawtooth)","lead 3 (calliope)","lead 4 (chiff)","lead 5 (charang)","lead 6 (voice)","lead 7 (fifths)","lead 8 (bass + lead)","pad 1 (new age)","pad 2 (warm)","pad 3 (polysynth)","pad 4 (choir)","pad 5 (bowed)","pad 6 (metallic)","pad 7 (halo)","pad 8 (sweep)","fx 1 (rain)","fx 2 (soundtrack)","fx 3 (crystal)","fx 4 (atmosphere)","fx 5 (brightness)","fx 6 (goblins)","fx 7 (echoes)","fx 8 (sci-fi)","sitar","banjo","shamisen","koto","kalimba","bag pipe","fiddle","shanai","tinkle bell","agogo","steel drums","woodblock","taiko drum","melodic tom","synth drum","reverse cymbal","guitar fret noise","breath noise","seashore","bird tweet","telephone ring","helicopter","applause","gunshot"];Ee.InstrumentFamilyByID=["piano","chromatic percussion","organ","guitar","bass","strings","ensemble","brass","reed","pipe","synth lead","synth pad","synth effects","world","percussive","sound effects"];Ee.DrumKitByPatchID={0:"standard kit",8:"room kit",16:"power kit",24:"electronic kit",25:"tr-808 kit",32:"jazz kit",40:"brush kit",48:"orchestra kit",56:"sound fx kit"};Object.defineProperty(Ot,"__esModule",{value:!0});Ot.Instrument=void 0;var gt=Ee,cn=new WeakMap,xr=function(){function t(e,n){if(this.number=0,cn.set(this,n),this.number=0,e){var r=e.find(function(i){return i.type==="programChange"});r&&(this.number=r.programNumber)}}return Object.defineProperty(t.prototype,"name",{get:function(){return this.percussion?gt.DrumKitByPatchID[this.number]:gt.instrumentByPatchID[this.number]},set:function(e){var n=gt.instrumentByPatchID.indexOf(e);n!==-1&&(this.number=n)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"family",{get:function(){return this.percussion?"drums":gt.InstrumentFamilyByID[Math.floor(this.number/8)]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"percussion",{get:function(){var e=cn.get(this);return e.channel===9},enumerable:!1,configurable:!0}),t.prototype.toJSON=function(){return{family:this.family,number:this.number,name:this.name}},t.prototype.fromJSON=function(e){this.number=e.number},t}();Ot.Instrument=xr;var Bt={};Object.defineProperty(Bt,"__esModule",{value:!0});Bt.Note=void 0;function Tr(t){var e=Math.floor(t/12)-1;return zn(t)+e.toString()}function zn(t){var e=["C","C#","D","D#","E","F","F#","G","G#","A","A#","B"],n=t%12;return e[n]}function Ur(t){var e=["C","C#","D","D#","E","F","F#","G","G#","A","A#","B"];return e.indexOf(t)}var Sr=function(){var t=/^([a-g]{1}(?:b|#|x|bb)?)(-?[0-9]+)/i,e={cbb:-2,cb:-1,c:0,"c#":1,cx:2,dbb:0,db:1,d:2,"d#":3,dx:4,ebb:2,eb:3,e:4,"e#":5,ex:6,fbb:3,fb:4,f:5,"f#":6,fx:7,gbb:5,gb:6,g:7,"g#":8,gx:9,abb:7,ab:8,a:9,"a#":10,ax:11,bbb:9,bb:10,b:11,"b#":12,bx:13};return function(n){var r=t.exec(n),i=r[1],o=r[2],s=e[i.toLowerCase()];return s+(parseInt(o,10)+1)*12}}(),We=new WeakMap,Cr=function(){function t(e,n,r){We.set(this,r),this.midi=e.midi,this.velocity=e.velocity,this.noteOffVelocity=n.velocity,this.ticks=e.ticks,this.durationTicks=n.ticks-e.ticks}return Object.defineProperty(t.prototype,"name",{get:function(){return Tr(this.midi)},set:function(e){this.midi=Sr(e)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"octave",{get:function(){return Math.floor(this.midi/12)-1},set:function(e){var n=e-this.octave;this.midi+=n*12},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"pitch",{get:function(){return zn(this.midi)},set:function(e){this.midi=12*(this.octave+1)+Ur(e)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"duration",{get:function(){var e=We.get(this);return e.ticksToSeconds(this.ticks+this.durationTicks)-e.ticksToSeconds(this.ticks)},set:function(e){var n=We.get(this),r=n.secondsToTicks(this.time+e);this.durationTicks=r-this.ticks},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"time",{get:function(){var e=We.get(this);return e.ticksToSeconds(this.ticks)},set:function(e){var n=We.get(this);this.ticks=n.secondsToTicks(e)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"bars",{get:function(){var e=We.get(this);return e.ticksToMeasures(this.ticks)},enumerable:!1,configurable:!0}),t.prototype.toJSON=function(){return{duration:this.duration,durationTicks:this.durationTicks,midi:this.midi,name:this.name,ticks:this.ticks,time:this.time,velocity:this.velocity}},t}();Bt.Note=Cr;Object.defineProperty(pt,"__esModule",{value:!0});pt.Track=void 0;var Rt=Re,Pr=$t,Er=At,Mr=Nt,ln=Ot,Dr=Bt,_t=new WeakMap,Ar=function(){function t(e,n){var r=this;if(this.name="",this.notes=[],this.controlChanges=(0,Er.createControlChanges)(),this.pitchBends=[],_t.set(this,n),e){var i=e.find(function(l){return l.type==="trackName"});this.name=i?i.text:""}if(this.instrument=new ln.Instrument(e,this),this.channel=0,e){for(var o=e.filter(function(l){return l.type==="noteOn"}),s=e.filter(function(l){return l.type==="noteOff"}),c=function(){var l=o.shift();u.channel=l.channel;var h=s.findIndex(function(m){return m.noteNumber===l.noteNumber&&m.absoluteTime>=l.absoluteTime});if(h!==-1){var p=s.splice(h,1)[0];u.addNote({durationTicks:p.absoluteTime-l.absoluteTime,midi:l.noteNumber,noteOffVelocity:p.velocity/127,ticks:l.absoluteTime,velocity:l.velocity/127})}},u=this;o.length;)c();var a=e.filter(function(l){return l.type==="controller"});a.forEach(function(l){r.addCC({number:l.controllerType,ticks:l.absoluteTime,value:l.value/127})});var d=e.filter(function(l){return l.type==="pitchBend"});d.forEach(function(l){r.addPitchBend({ticks:l.absoluteTime,value:l.value/Math.pow(2,13)})});var f=e.find(function(l){return l.type==="endOfTrack"});this.endOfTrackTicks=f!==void 0?f.absoluteTime:void 0}}return t.prototype.addNote=function(e){var n=_t.get(this),r=new Dr.Note({midi:0,ticks:0,velocity:1},{ticks:0,velocity:0},n);return Object.assign(r,e),(0,Rt.insert)(this.notes,r,"ticks"),this},t.prototype.addCC=function(e){var n=_t.get(this),r=new Pr.ControlChange({controllerType:e.number},n);return delete e.number,Object.assign(r,e),Array.isArray(this.controlChanges[r.number])||(this.controlChanges[r.number]=[]),(0,Rt.insert)(this.controlChanges[r.number],r,"ticks"),this},t.prototype.addPitchBend=function(e){var n=_t.get(this),r=new Mr.PitchBend({},n);return Object.assign(r,e),(0,Rt.insert)(this.pitchBends,r,"ticks"),this},Object.defineProperty(t.prototype,"duration",{get:function(){if(!this.notes.length)return 0;for(var e=this.notes[this.notes.length-1].time+this.notes[this.notes.length-1].duration,n=0;n<this.notes.length-1;n++){var r=this.notes[n].time+this.notes[n].duration;e<r&&(e=r)}return e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"durationTicks",{get:function(){if(!this.notes.length)return 0;for(var e=this.notes[this.notes.length-1].ticks+this.notes[this.notes.length-1].durationTicks,n=0;n<this.notes.length-1;n++){var r=this.notes[n].ticks+this.notes[n].durationTicks;e<r&&(e=r)}return e},enumerable:!1,configurable:!0}),t.prototype.fromJSON=function(e){var n=this;this.name=e.name,this.channel=e.channel,this.instrument=new ln.Instrument(void 0,this),this.instrument.fromJSON(e.instrument),e.endOfTrackTicks!==void 0&&(this.endOfTrackTicks=e.endOfTrackTicks);for(var r in e.controlChanges)e.controlChanges[r]&&e.controlChanges[r].forEach(function(i){n.addCC({number:i.number,ticks:i.ticks,value:i.value})});e.notes.forEach(function(i){n.addNote({durationTicks:i.durationTicks,midi:i.midi,ticks:i.ticks,velocity:i.velocity})})},t.prototype.toJSON=function(){for(var e={},n=0;n<127;n++)this.controlChanges.hasOwnProperty(n)&&(e[n]=this.controlChanges[n].map(function(i){return i.toJSON()}));var r={channel:this.channel,controlChanges:e,pitchBends:this.pitchBends.map(function(i){return i.toJSON()}),instrument:this.instrument.toJSON(),name:this.name,notes:this.notes.map(function(i){return i.toJSON()})};return this.endOfTrackTicks!==void 0&&(r.endOfTrackTicks=this.endOfTrackTicks),r},t}();pt.Track=Ar;var Ft={};function Nr(t){var e=[];return Rn(t,e),e}function Rn(t,e){for(var n=0;n<t.length;n++){var r=t[n];Array.isArray(r)?Rn(r,e):e.push(r)}}const Or=Object.freeze(Object.defineProperty({__proto__:null,flatten:Nr},Symbol.toStringTag,{value:"Module"})),Br=fr(Or);var Se=Ye&&Ye.__spreadArray||function(t,e,n){if(n||arguments.length===2)for(var r=0,i=e.length,o;r<i;r++)(o||!(r in e))&&(o||(o=Array.prototype.slice.call(e,0,r)),o[r]=e[r]);return t.concat(o||Array.prototype.slice.call(e))};Object.defineProperty(Ft,"__esModule",{value:!0});Ft.encode=void 0;var Fr=Dt,Lr=Ct,zr=Br;function Rr(t,e){return[{absoluteTime:t.ticks,channel:e,deltaTime:0,noteNumber:t.midi,type:"noteOn",velocity:Math.floor(t.velocity*127)},{absoluteTime:t.ticks+t.durationTicks,channel:e,deltaTime:0,noteNumber:t.midi,type:"noteOff",velocity:Math.floor(t.noteOffVelocity*127)}]}function Hr(t){return(0,zr.flatten)(t.notes.map(function(e){return Rr(e,t.channel)}))}function Vr(t,e){return{absoluteTime:t.ticks,channel:e,controllerType:t.number,deltaTime:0,type:"controller",value:Math.floor(t.value*127)}}function Wr(t){for(var e=[],n=0;n<127;n++)t.controlChanges.hasOwnProperty(n)&&t.controlChanges[n].forEach(function(r){e.push(Vr(r,t.channel))});return e}function Kr(t,e){return{absoluteTime:t.ticks,channel:e,deltaTime:0,type:"pitchBend",value:t.value}}function Gr(t){var e=[];return t.pitchBends.forEach(function(n){e.push(Kr(n,t.channel))}),e}function qr(t){return{absoluteTime:0,channel:t.channel,deltaTime:0,programNumber:t.instrument.number,type:"programChange"}}function Jr(t){return{absoluteTime:0,deltaTime:0,meta:!0,text:t,type:"trackName"}}function Xr(t){return{absoluteTime:t.ticks,deltaTime:0,meta:!0,microsecondsPerBeat:Math.floor(6e7/t.bpm),type:"setTempo"}}function Yr(t){return{absoluteTime:t.ticks,deltaTime:0,denominator:t.timeSignature[1],meta:!0,metronome:24,numerator:t.timeSignature[0],thirtyseconds:8,type:"timeSignature"}}function Qr(t){var e=Lr.keySignatureKeys.indexOf(t.key);return{absoluteTime:t.ticks,deltaTime:0,key:e+7,meta:!0,scale:t.scale==="major"?0:1,type:"keySignature"}}function Zr(t){return{absoluteTime:t.ticks,deltaTime:0,meta:!0,text:t.text,type:t.type}}function $r(t){var e={header:{format:1,numTracks:t.tracks.length+1,ticksPerBeat:t.header.ppq},tracks:Se([Se(Se(Se(Se([{absoluteTime:0,deltaTime:0,meta:!0,text:t.header.name,type:"trackName"}],t.header.keySignatures.map(function(n){return Qr(n)}),!0),t.header.meta.map(function(n){return Zr(n)}),!0),t.header.tempos.map(function(n){return Xr(n)}),!0),t.header.timeSignatures.map(function(n){return Yr(n)}),!0)],t.tracks.map(function(n){return Se(Se(Se([Jr(n.name),qr(n)],Hr(n),!0),Wr(n),!0),Gr(n),!0)}),!0)};return e.tracks=e.tracks.map(function(n){n=n.sort(function(i,o){return i.absoluteTime-o.absoluteTime});var r=0;return n.forEach(function(i){i.deltaTime=i.absoluteTime-r,r=i.absoluteTime,delete i.absoluteTime}),n.push({deltaTime:0,meta:!0,type:"endOfTrack"}),n}),new Uint8Array((0,Fr.writeMidi)(e))}Ft.encode=$r;(function(t){var e=Ye&&Ye.__awaiter||function(f,l,h,p){function m(y){return y instanceof h?y:new h(function(_){_(y)})}return new(h||(h=Promise))(function(y,_){function P(T){try{w(p.next(T))}catch(O){_(O)}}function V(T){try{w(p.throw(T))}catch(O){_(O)}}function w(T){T.done?y(T.value):m(T.value).then(P,V)}w((p=p.apply(f,l||[])).next())})},n=Ye&&Ye.__generator||function(f,l){var h={label:0,sent:function(){if(y[0]&1)throw y[1];return y[1]},trys:[],ops:[]},p,m,y,_;return _={next:P(0),throw:P(1),return:P(2)},typeof Symbol=="function"&&(_[Symbol.iterator]=function(){return this}),_;function P(w){return function(T){return V([w,T])}}function V(w){if(p)throw new TypeError("Generator is already executing.");for(;h;)try{if(p=1,m&&(y=w[0]&2?m.return:w[0]?m.throw||((y=m.return)&&y.call(m),0):m.next)&&!(y=y.call(m,w[1])).done)return y;switch(m=0,y&&(w=[w[0]&2,y.value]),w[0]){case 0:case 1:y=w;break;case 4:return h.label++,{value:w[1],done:!1};case 5:h.label++,m=w[1],w=[0];continue;case 7:w=h.ops.pop(),h.trys.pop();continue;default:if(y=h.trys,!(y=y.length>0&&y[y.length-1])&&(w[0]===6||w[0]===2)){h=0;continue}if(w[0]===3&&(!y||w[1]>y[0]&&w[1]<y[3])){h.label=w[1];break}if(w[0]===6&&h.label<y[1]){h.label=y[1],y=w;break}if(y&&h.label<y[2]){h.label=y[2],h.ops.push(w);break}y[2]&&h.ops.pop(),h.trys.pop();continue}w=l.call(f,h)}catch(T){w=[6,T],m=0}finally{p=y=0}if(w[0]&5)throw w[1];return{value:w[0]?w[1]:void 0,done:!0}}};Object.defineProperty(t,"__esModule",{value:!0}),t.Header=t.Track=t.Midi=void 0;var r=Dt,i=Ct,o=pt,s=Ft,c=function(){function f(l){var h=this,p=null;if(l){var m=l instanceof ArrayBuffer?new Uint8Array(l):l;p=(0,r.parseMidi)(m),p.tracks.forEach(function(y){var _=0;y.forEach(function(P){_+=P.deltaTime,P.absoluteTime=_})}),p.tracks=d(p.tracks)}this.header=new i.Header(p),this.tracks=[],l&&(this.tracks=p.tracks.map(function(y){return new o.Track(y,h.header)}),p.header.format===1&&this.tracks[0].duration===0&&this.tracks.shift())}return f.fromUrl=function(l){return e(this,void 0,void 0,function(){var h,p;return n(this,function(m){switch(m.label){case 0:return[4,fetch(l)];case 1:return h=m.sent(),h.ok?[4,h.arrayBuffer()]:[3,3];case 2:return p=m.sent(),[2,new f(p)];case 3:throw new Error("Could not load '".concat(l,"'"))}})})},Object.defineProperty(f.prototype,"name",{get:function(){return this.header.name},set:function(l){this.header.name=l},enumerable:!1,configurable:!0}),Object.defineProperty(f.prototype,"duration",{get:function(){var l=this.tracks.map(function(h){return h.duration});return Math.max.apply(Math,l)},enumerable:!1,configurable:!0}),Object.defineProperty(f.prototype,"durationTicks",{get:function(){var l=this.tracks.map(function(h){return h.durationTicks});return Math.max.apply(Math,l)},enumerable:!1,configurable:!0}),f.prototype.addTrack=function(){var l=new o.Track(void 0,this.header);return this.tracks.push(l),l},f.prototype.toArray=function(){return(0,s.encode)(this)},f.prototype.toJSON=function(){return{header:this.header.toJSON(),tracks:this.tracks.map(function(l){return l.toJSON()})}},f.prototype.fromJSON=function(l){var h=this;this.header=new i.Header,this.header.fromJSON(l.header),this.tracks=l.tracks.map(function(p){var m=new o.Track(void 0,h.header);return m.fromJSON(p),m})},f.prototype.clone=function(){var l=new f;return l.fromJSON(this.toJSON()),l},f}();t.Midi=c;var u=pt;Object.defineProperty(t,"Track",{enumerable:!0,get:function(){return u.Track}});var a=Ct;Object.defineProperty(t,"Header",{enumerable:!0,get:function(){return a.Header}});function d(f){for(var l=[],h=0;h<f.length;h++)for(var p=l.length,m=new Map,y=Array(16).fill(0),_=0,P=f[h];_<P.length;_++){var V=P[_],w=p,T=V.channel;if(T!==void 0){V.type==="programChange"&&(y[T]=V.programNumber);var O=y[T],B="".concat(O," ").concat(T);m.has(B)?w=m.get(B):(w=p+m.size,m.set(B,w))}l[w]||l.push([]),l[w].push(V)}return l}})(Jt);const Ke=[];function se(t,e=X){let n;const r=new Set;function i(c){if(He(t,c)&&(t=c,n)){const u=!Ke.length;for(const a of r)a[1](),Ke.push(a,t);if(u){for(let a=0;a<Ke.length;a+=2)Ke[a][0](Ke[a+1]);Ke.length=0}}}function o(c){i(c(t))}function s(c,u=X){const a=[c,u];return r.add(a),r.size===1&&(n=e(i,o)||X),c(t),()=>{r.delete(a),r.size===0&&n&&(n(),n=null)}}return{set:i,update:o,subscribe:s}}const Qe=["C","C#","D","D#","E","F","F#","G","G#","A","A#","B"],un={Backquote:"A#2",Tab:"B2",KeyQ:"C3",Digit2:"C#3",KeyW:"D3",Digit3:"D#3",KeyE:"E3",KeyR:"F3",Digit5:"F#3",KeyT:"G3",Digit6:"G#3",KeyY:"A3",Digit7:"A#3",KeyU:"B3",KeyI:"C4",Digit9:"C#4",KeyO:"D4",Digit0:"D#4",KeyP:"E4",BracketLeft:"F4",Equal:"F#4",BracketRight:"G4",Backspace:"G#4",Backslash:"A4",CapsLock:"A#4",Escape:"A#4",ShiftLeft:"B4",KeyZ:"C5",KeyS:"C#5",KeyX:"D5",KeyD:"D#5",KeyC:"E5",KeyV:"F5",KeyG:"F#5",KeyB:"G5",KeyH:"G#5",KeyN:"A5",KeyJ:"A#5",KeyM:"B5",Comma:"C6",KeyL:"C#6",Period:"D6",Semicolon:"D#6",Slash:"E6",ShiftRight:"F6",Enter:"F#6"},jr={"A#2":"`",B2:"↹",C3:"Q","C#3":"2",D3:"W","D#3":"3",E3:"E",F3:"R","F#3":"5",G3:"T","G#3":"6",A3:"Y","A#3":"7",B3:"U",C4:"I","C#4":"9",D4:"O","D#4":"0",E4:"P",F4:"[","F#4":"=",G4:"]","G#4":"⌫",A4:"\\","A#4":"⇪",B4:"⇧",C5:"Z","C#5":"S",D5:"X","D#5":"D",E5:"C",F5:"V","F#5":"G",G5:"B","G#5":"H",A5:"N","A#5":"J",B5:"M",C6:",","C#6":"L",D6:".","D#6":";",E6:"/",F6:"⇧","F#6":"↩"};function Xt(t){return parseInt(t.charAt(t.length-1))}function Pt(t){return t.substring(0,t.length-1)}function st(t){const e=Math.floor(t/12)-1;return Qe[t%12]+e}function Et(t){const e=Qe.indexOf(Pt(t));return(Xt(t)+1)*12+e}function ei(t){const[e,n]=t.split(","),r=Xt(n),i=Xt(e),o=Qe.indexOf(Pt(e)),s=Qe.indexOf(Pt(n)),c={};let u=0,a=o;for(let d=i;d<=r;d++){for(;a<Qe.length&&!(d===r&&a>s);){const f=Qe[a],l=f.length===1;c[f+d]={isWhite:l,pressedColor:null},l&&u++,a++}a=0}return[c,u]}class ti{constructor(){M(this,"isPlaying",se(!1));M(this,"currentTime",se(0));M(this,"totalTime",se(0));M(this,"speed",se(1));M(this,"isRecording",se(!1));M(this,"selectedTrackI",se(0));M(this,"midiData",new Jt.Midi);M(this,"tracks",se(this.midiData.tracks));M(this,"shouldPlaySolo",se(!1));M(this,"tracksIndexUpTo",[]);M(this,"loopIntervalID",null);M(this,"playingHeldNotes",[]);M(this,"recordingHeldNotes",new Map);M(this,"backupMidiData",null);M(this,"lastStartTime",0);M(this,"onPlayNote");M(this,"onStopNote");this.tracks.subscribe(e=>{const n=e.length==0?0:this.midiData.duration;this.totalTime.set(n),this.currentTime.set(Math.min(n,ee(this.currentTime)))})}startPlaying(){this.lastStartTime=ee(this.currentTime),this.stop(),this.recalcPlayIndex(),this.startLoop(e=>{this.onPlayUpdate(e),e>ee(this.totalTime)&&(this.stop(),this.currentTime.set(0))}),this.isPlaying.set(!0)}startRecording(){this.midiData.tracks.length==0&&this.addTrack(),this.backupMidiData=this.midiData.clone(),this.midiData.tracks[ee(this.selectedTrackI)].notes=[],this.recalcPlayIndex(),this.isRecording.set(!0),this.lastStartTime=ee(this.currentTime)}stop(e=!1){clearInterval(this.loopIntervalID),this.loopIntervalID=null,this.playingHeldNotes.forEach(n=>this.onStopNote(n.name)),this.playingHeldNotes=[],this.isPlaying.set(!1),e&&this.backupMidiData&&(this.midiData=this.backupMidiData,this.backupMidiData=null),this.isRecording.set(!1),this.recordingHeldNotes.clear(),this.currentTime.set(this.lastStartTime),this.tracks.set(this.midiData.tracks)}recordPlayNote(e,n){if(!ee(this.isRecording))return;this.loopIntervalID===null&&this.startLoop(i=>{this.onPlayUpdate(i),i>ee(this.totalTime)&&this.totalTime.set(i)});const r=Et(e);this.recordingHeldNotes.set(r,{midi:r,velocity:n,time:ee(this.currentTime)})}recordStopNote(e){if(!ee(this.isRecording))return;const n=Et(e),r=this.recordingHeldNotes.get(n);r&&(r.duration=ee(this.currentTime)-r.time,this.midiData.tracks[ee(this.selectedTrackI)].addNote(r),this.recordingHeldNotes.delete(n))}addTrack(){const e=this.midiData.addTrack();this.selectedTrackI.set(this.midiData.tracks.length-1),this.tracks.set(this.midiData.tracks);const n=prompt("Enter the track name: ");n&&(e.name=n)}deleteTrack(){const e=ee(this.selectedTrackI);this.midiData.tracks.splice(e,1),this.selectedTrackI.set(Math.min(this.midiData.tracks.length-1,e)),this.tracks.set(this.midiData.tracks)}saveFile(){const e=new Blob([this.midiData.toArray()],{type:"application/octet-stream"}),n=URL.createObjectURL(e),r=document.createElement("a");r.href=n,r.download="record.midi",document.body.appendChild(r),r.click(),document.body.removeChild(r),URL.revokeObjectURL(n)}setFile(e){if(!e)return;const n=new FileReader;n.onload=()=>{this.midiData=new Jt.Midi(n.result),this.tracks.set(this.midiData.tracks),this.selectedTrackI.set(0)},n.readAsArrayBuffer(e)}recalcPlayIndex(){this.midiData.tracks.forEach((e,n)=>{const r=ee(this.currentTime);this.tracksIndexUpTo[n]=ni(e.notes,i=>i.time-r)})}startLoop(e){let n=performance.now();this.loopIntervalID=setInterval(()=>{const r=performance.now(),o=(r-n)/1e3*ee(this.speed),s=ee(this.currentTime)+o;this.currentTime.set(s),e(s),n=r},10)}onPlayUpdate(e){if(this.playingHeldNotes.forEach((n,r)=>{e>n.time+n.duration&&(this.onStopNote(n.name),ri(this.playingHeldNotes,r))}),ee(this.shouldPlaySolo)){const n=ee(this.selectedTrackI);this.checkTracksPlayNotes(e,n)}else for(let n=0;n<this.midiData.tracks.length;n++)this.checkTracksPlayNotes(e,n)}checkTracksPlayNotes(e,n){if(ee(this.isRecording)&&ee(this.selectedTrackI)==n)return;const r=this.midiData.tracks[n];for(;;){const i=r.notes[this.tracksIndexUpTo[n]];if(!i||e<i.time)break;i.time+i.duration>e&&(this.onPlayNote(i.name,i.velocity),this.playingHeldNotes.push(i)),this.tracksIndexUpTo[n]++}}}function ni(t,e){if(!t||t.length==0)return 0;let n=0,r=t.length-1;for(;n!=r;){const i=Math.ceil((n+r)/2);e(t[i])>=0?r=i-1:n=i}return r}function ri(t,e){t[e]=t[t.length-1],t.pop()}function fn(t,e,n){const r=t.slice();return r[40]=e[n][0],r[41]=e[n][1].isWhite,r[42]=e[n][1].pressedColor,r}function hn(t){let e,n=t[18](t[40],t[6],t[5],t[4])+"",r,i,o,s,c;function u(...l){return t[26](t[40],...l)}function a(){return t[27](t[40])}function d(){return t[28](t[40])}function f(){return t[29](t[40])}return{c(){e=b("div"),r=ne(n),i=E(),k(e,"class",o="key "+(t[41]?"white":"black")+" svelte-1569eu9"),Be(e,"--color-hue",t[42]),rn(e,"pressed",t[42]!==null)},m(l,h){N(l,e,h),v(e,r),v(e,i),s||(c=[C(e,"pointerdown",u),C(e,"pointerenter",a),C(e,"pointerleave",d),C(e,"pointerup",f)],s=!0)},p(l,h){t=l,h[0]&120&&n!==(n=t[18](t[40],t[6],t[5],t[4])+"")&&ze(r,n),h[0]&8&&o!==(o="key "+(t[41]?"white":"black")+" svelte-1569eu9")&&k(e,"class",o),h[0]&8&&Be(e,"--color-hue",t[42]),h[0]&8&&rn(e,"pressed",t[42]!==null)},d(l){l&&A(e),s=!1,we(c)}}}function ii(t){let e,n,r,i,o=Ie(Object.entries(t[3])),s=[];for(let c=0;c<o.length;c+=1)s[c]=hn(fn(t,o,c));return{c(){e=b("div"),n=b("div");for(let c=0;c<s.length;c+=1)s[c].c();k(n,"class","piano svelte-1569eu9"),k(e,"class","piano-container svelte-1569eu9")},m(c,u){N(c,e,u),v(e,n);for(let a=0;a<s.length;a+=1)s[a]&&s[a].m(n,null);t[30](e),r||(i=[C(window,"resize",t[25]),C(window,"keyup",t[17]),C(window,"keydown",t[16]),C(n,"touchstart",nn(t[23])),C(n,"contextmenu",nn(t[24])),C(e,"pointerdown",t[31]),C(e,"pointerup",t[32])],r=!0)},p(c,u){if(u[0]&286842){o=Ie(Object.entries(c[3]));let a;for(a=0;a<o.length;a+=1){const d=fn(c,o,a);s[a]?s[a].p(d,u):(s[a]=hn(d),s[a].c(),s[a].m(n,null))}for(;a<s.length;a+=1)s[a].d(1);s.length=o.length}},i:X,o:X,d(c){c&&A(e),ht(s,c),t[30](null),r=!1,we(i)}}}function si(t,e,n){let r,i,o,s,c,u,a,d,f=!1,l,h=new Map,{pianoControlsData:p}=e,{noteRange:m,sustain:y,noteShift:_,octaveShift:P,volume:V,labelType:w}=p;Y(t,m,g=>n(22,a=g)),Y(t,y,g=>n(33,o=g)),Y(t,_,g=>n(5,u=g)),Y(t,P,g=>n(4,c=g)),Y(t,V,g=>n(34,s=g)),Y(t,w,g=>n(6,d=g));let{midiPlayer:T}=e;T.onPlayNote=$,T.onStopNote=F;let{socketPlayer:O}=e;O.onPlayNote=(g,U,R)=>{r[g]&&n(3,r[g].pressedColor=String(R.colorHue),r),R.playAudio(g,U)},O.onStopNote=(g,U,R)=>{r[g]&&n(3,r[g].pressedColor=null,r),U||R.stopAudio(g)};function B(g){const U=Et(g)+u+c*12;return st(U)}function $(g,U=.8){const R=B(g);h.has(R)&&F(g),h.set(R,!0),O.playNote(R,s*U),this!==T&&T.recordPlayNote(g,U)}function F(g,U=!0){const R=U?B(g):g;h.has(R)&&(h.delete(R),O.stopNote(R,o),this!==T&&T.recordStopNote(g))}y.subscribe(g=>{if(!g)for(const U of O.localClient.stopAudioMap.keys())h.get(U)||O.stopNote(U,!1)});function oe(){for(const g of h.keys())F(g,!1)}P.subscribe(oe),_.subscribe(oe);function J(g){if(l){const U=l.clientHeight/6,R=l.offsetWidth/g;l.style.setProperty("--white-key-width",`${Math.min(R,U)}px`)}}function D(g){const U=un[g.code],R=g.target;U&&R.tagName!=="INPUT"&&(g.preventDefault(),h.has(B(U))||$(U))}function Q(g){const U=un[g.code];U&&F(U)}function K(g,U,R,W){if(U=="notes")return Pt(g);if(U=="keybinds"){const q=Et(g)-R-W*12;return jr[st(q)]??""}else return""}function fe(g){const[U,R,W]=g.data;U>=144&&U<=159?W==0?F(st(R)):$(st(R),W/127):U>=128&&U<=143&&F(st(R))}function G(g){g.inputs.forEach(U=>{U.onmidimessage=fe})}Fn(()=>{J(i),navigator.requestMIDIAccess().then(g=>{G(g),g.onstatechange=()=>{G(g)}})});function H(g){sn.call(this,t,g)}function ae(g){sn.call(this,t,g)}const he=()=>J(i),ie=(g,U)=>{U.currentTarget.releasePointerCapture(U.pointerId),$(g)},le=g=>{f&&$(g)},be=g=>{f&&F(g)},ue=g=>F(g);function z(g){Gt[g?"unshift":"push"](()=>{l=g,n(2,l)})}const ge=g=>{var U;((U=g.target)==null?void 0:U.tagName)!=="SELECT"&&n(1,f=!0)},de=()=>n(1,f=!1);return t.$$set=g=>{"pianoControlsData"in g&&n(21,p=g.pianoControlsData),"midiPlayer"in g&&n(19,T=g.midiPlayer),"socketPlayer"in g&&n(20,O=g.socketPlayer)},t.$$.update=()=>{t.$$.dirty[0]&4194304&&n(3,[r,i]=ei(a),r,(n(0,i),n(22,a))),t.$$.dirty[0]&1&&J(i)},[i,f,l,r,c,u,d,m,y,_,P,V,w,$,F,J,D,Q,K,T,O,p,a,H,ae,he,ie,le,be,ue,z,ge,de]}class oi extends rt{constructor(e){super(),nt(this,e,si,ii,He,{pianoControlsData:21,midiPlayer:19,socketPlayer:20},null,[-1,-1])}}function dn(t,e,n){const r=t.slice();return r[37]=e[n],r[39]=n,r}function ai(t){let e,n,r,i,o;return{c(){e=b("button"),n=ne("Play"),e.disabled=r=t[6].length==0},m(s,c){N(s,e,c),v(e,n),i||(o=C(e,"click",t[23]),i=!0)},p(s,c){c[0]&64&&r!==(r=s[6].length==0)&&(e.disabled=r)},d(s){s&&A(e),i=!1,o()}}}function ci(t){let e,n,r;return{c(){e=b("button"),e.textContent="Stop"},m(i,o){N(i,e,o),n||(r=C(e,"click",t[22]),n=!0)},p:X,d(i){i&&A(e),n=!1,r()}}}function li(t){let e,n,r,i,o;return{c(){e=b("button"),n=ne("Restart"),e.disabled=r=t[6].length==0},m(s,c){N(s,e,c),v(e,n),i||(o=C(e,"click",t[20]),i=!0)},p(s,c){c[0]&64&&r!==(r=s[6].length==0)&&(e.disabled=r)},d(s){s&&A(e),i=!1,o()}}}function ui(t){let e,n,r,i,o;return{c(){e=b("button"),n=ne("Cancel"),e.disabled=r=t[6].length==0},m(s,c){N(s,e,c),v(e,n),i||(o=C(e,"click",t[24]),i=!0)},p(s,c){c[0]&64&&r!==(r=s[6].length==0)&&(e.disabled=r)},d(s){s&&A(e),i=!1,o()}}}function pn(t){let e,n=t[7]?"single track":"all tracks",r,i,o;return{c(){e=b("button"),r=ne(n),k(e,"title","Click to toggle")},m(s,c){N(s,e,c),v(e,r),i||(o=C(e,"click",t[25]),i=!0)},p(s,c){c[0]&128&&n!==(n=s[7]?"single track":"all tracks")&&ze(r,n)},d(s){s&&A(e),i=!1,o()}}}function mn(t){let e,n,r,i,o,s,c,u,a,d=Ie(t[6]),f=[];for(let l=0;l<d.length;l+=1)f[l]=yn(dn(t,d,l));return{c(){e=b("select");for(let l=0;l<f.length;l+=1)f[l].c();n=E(),r=b("button"),i=ne("Add Track"),o=E(),s=b("button"),c=ne("Delete Track"),e.disabled=t[1],t[8]===void 0&&Fe(()=>t[28].call(e)),r.disabled=t[1],s.disabled=t[1]},m(l,h){N(l,e,h);for(let p=0;p<f.length;p+=1)f[p]&&f[p].m(e,null);Pe(e,t[8],!0),N(l,n,h),N(l,r,h),v(r,i),N(l,o,h),N(l,s,h),v(s,c),u||(a=[C(e,"change",t[28]),C(r,"click",t[29]),C(s,"click",t[30])],u=!0)},p(l,h){if(h[0]&64){d=Ie(l[6]);let p;for(p=0;p<d.length;p+=1){const m=dn(l,d,p);f[p]?f[p].p(m,h):(f[p]=yn(m),f[p].c(),f[p].m(e,null))}for(;p<f.length;p+=1)f[p].d(1);f.length=d.length}h[0]&2&&(e.disabled=l[1]),h[0]&256&&Pe(e,l[8]),h[0]&2&&(r.disabled=l[1]),h[0]&2&&(s.disabled=l[1])},d(l){l&&(A(e),A(n),A(r),A(o),A(s)),ht(f,l),u=!1,we(a)}}}function yn(t){let e,n=(t[37].name||`[Track ${t[39]}]`)+"",r;return{c(){e=b("option"),r=ne(n),e.__value=t[39],Z(e,e.__value)},m(i,o){N(i,e,o),v(e,r)},p(i,o){o[0]&64&&n!==(n=(i[37].name||`[Track ${i[39]}]`)+"")&&ze(r,n)},d(i){i&&A(e)}}}function fi(t){let e,n,r,i,o,s,c,u,a,d,f,l,h,p,m,y,_,P,V,w,T,O,B,$,F,oe,J,D,Q,K,fe,G,H=t[5].toFixed(1)+"",ae,he,ie=t[10].toFixed(1)+"",le,be,ue,z;function ge(x,S){return x[4]?ci:ai}let de=ge(t),g=de(t);function U(x,S){return x[1]?ui:li}let R=U(t),W=R(t),q=t[6].length>0&&pn(t),j=t[6].length>0&&mn(t);return{c(){e=b("div"),n=b("p"),n.textContent="Play midi:",r=E(),i=b("div"),o=b("input"),s=E(),c=b("div"),g.c(),u=E(),W.c(),a=E(),q&&q.c(),d=E(),f=b("div"),l=b("button"),h=ne("Record"),p=E(),m=b("button"),y=ne("Save"),P=E(),j&&j.c(),V=E(),w=b("div"),T=b("span"),T.textContent="Speed",O=E(),B=b("input"),$=E(),F=b("input"),oe=E(),J=b("span"),J.textContent="times",D=E(),Q=b("div"),K=b("input"),fe=E(),G=b("span"),ae=ne(H),he=ne("/"),le=ne(ie),be=ne(" seconds"),k(o,"type","file"),k(o,"accept",".midi,.mid"),o.disabled=t[4],k(i,"class","svelte-1owab3p"),k(c,"class","svelte-1owab3p"),l.disabled=t[4],m.disabled=_=t[6].length==0||t[4],k(f,"class","svelte-1owab3p"),k(T,"class","svelte-1owab3p"),k(B,"type","range"),k(B,"min","0.01"),k(B,"max","4"),k(B,"step","0.01"),k(B,"title","Double click to set speed to normal"),k(F,"type","number"),k(F,"min","0.01"),k(J,"class","svelte-1owab3p"),Be(w,"display","flex"),k(w,"class","svelte-1owab3p"),k(K,"type","range"),k(K,"min","0"),k(K,"max",t[10]),k(K,"step","0.1"),Be(K,"width","18rem"),K.disabled=t[1],k(G,"class","svelte-1owab3p"),Be(Q,"display","flex"),k(Q,"class","svelte-1owab3p"),k(e,"class","svelte-1owab3p")},m(x,S){N(x,e,S),v(e,n),v(e,r),v(e,i),v(i,o),v(e,s),v(e,c),g.m(c,null),v(c,u),W.m(c,null),v(c,a),q&&q.m(c,null),v(e,d),v(e,f),v(f,l),v(l,h),v(f,p),v(f,m),v(m,y),v(f,P),j&&j.m(f,null),v(e,V),v(e,w),v(w,T),v(w,O),v(w,B),Z(B,t[9]),v(w,$),v(w,F),Z(F,t[9]),v(w,oe),v(w,J),v(e,D),v(e,Q),v(Q,K),Z(K,t[5]),v(Q,fe),v(Q,G),v(G,ae),v(G,he),v(G,le),v(G,be),ue||(z=[C(o,"change",t[21]),C(l,"click",t[26]),C(m,"click",t[27]),C(B,"change",t[31]),C(B,"input",t[31]),C(B,"click",t[32]),C(F,"input",t[33]),C(K,"change",t[34]),C(K,"input",t[34]),C(K,"mousedown",t[35]),C(K,"mouseup",t[36])],ue=!0)},p(x,S){S[0]&16&&(o.disabled=x[4]),de===(de=ge(x))&&g?g.p(x,S):(g.d(1),g=de(x),g&&(g.c(),g.m(c,u))),R===(R=U(x))&&W?W.p(x,S):(W.d(1),W=R(x),W&&(W.c(),W.m(c,a))),x[6].length>0?q?q.p(x,S):(q=pn(x),q.c(),q.m(c,null)):q&&(q.d(1),q=null),S[0]&16&&(l.disabled=x[4]),S[0]&80&&_!==(_=x[6].length==0||x[4])&&(m.disabled=_),x[6].length>0?j?j.p(x,S):(j=mn(x),j.c(),j.m(f,null)):j&&(j.d(1),j=null),S[0]&512&&Z(B,x[9]),S[0]&512&&Ue(F.value)!==x[9]&&Z(F,x[9]),S[0]&1024&&k(K,"max",x[10]),S[0]&2&&(K.disabled=x[1]),S[0]&32&&Z(K,x[5]),S[0]&32&&H!==(H=x[5].toFixed(1)+"")&&ze(ae,H),S[0]&1024&&ie!==(ie=x[10].toFixed(1)+"")&&ze(le,ie)},i:X,o:X,d(x){x&&A(e),g.d(),W.d(),q&&q.d(),j&&j.d(),ue=!1,we(z)}}}function hi(t,e,n){let r,i,o,s,c,u,a,d,f,{midiPlayer:l}=e,{isPlaying:h,isRecording:p,currentTime:m,speed:y,totalTime:_,selectedTrackI:P,tracks:V,shouldPlaySolo:w}=l;Y(t,h,z=>n(2,s=z)),Y(t,p,z=>n(1,o=z)),Y(t,m,z=>n(5,i=z)),Y(t,y,z=>n(9,d=z)),Y(t,_,z=>n(10,f=z)),Y(t,P,z=>n(8,a=z)),Y(t,V,z=>n(6,c=z)),Y(t,w,z=>n(7,u=z));function T(){l.startRecording(),localStorage.getItem("hasRecordedBefore")||(alert("Play any key to start recording. Recording WILL override the selected track."),localStorage.setItem("hasRecordedBefore","true"))}function O(){l.stop(),ce(m,i=0,i),l.startPlaying()}let B=!1;const $=z=>{var ge;return l.setFile((ge=z.currentTarget.files)==null?void 0:ge[0])},F=()=>l.stop(),oe=()=>l.startPlaying(),J=()=>l.stop(!0),D=()=>ce(w,u=!u,u),Q=()=>T(),K=()=>l.saveFile();function fe(){a=kt(this),P.set(a)}const G=()=>l.addTrack(),H=()=>l.deleteTrack();function ae(){d=Ue(this.value),y.set(d)}const he=z=>{z.detail==2&&ce(y,d=1,d)};function ie(){d=Ue(this.value),y.set(d)}function le(){i=Ue(this.value),m.set(i)}const be=()=>{s&&(n(3,B=!0),l.stop())},ue=()=>{B&&(l.startPlaying(),n(3,B=!1))};return t.$$set=z=>{"midiPlayer"in z&&n(0,l=z.midiPlayer)},t.$$.update=()=>{t.$$.dirty[0]&6&&n(4,r=s||o)},[l,o,s,B,r,i,c,u,a,d,f,h,p,m,y,_,P,V,w,T,O,$,F,oe,J,D,Q,K,fe,G,H,ae,he,ie,le,be,ue]}class di extends rt{constructor(e){super(),nt(this,e,hi,fi,He,{midiPlayer:0},null,[-1,-1])}}const vn=["accordion","acoustic_bass","acoustic_grand_piano","acoustic_guitar_nylon","acoustic_guitar_steel","agogo","alto_sax","applause","bagpipe","banjo","baritone_sax","bassoon","bird_tweet","blown_bottle","brass_section","breath_noise","bright_acoustic_piano","celesta","cello","choir_aahs","church_organ","clarinet","clavinet","contrabass","distortion_guitar","drawbar_organ","dulcimer","electric_bass_finger","electric_bass_pick","electric_grand_piano","electric_guitar_clean","electric_guitar_jazz","electric_guitar_muted","electric_piano_1","electric_piano_2","english_horn","fiddle","flute","french_horn","fretless_bass","fx_1_rain","fx_2_soundtrack","fx_3_crystal","fx_4_atmosphere","fx_5_brightness","fx_6_goblins","fx_7_echoes","fx_8_scifi","glockenspiel","guitar_fret_noise","guitar_harmonics","gunshot","harmonica","harpsichord","helicopter","honkytonk_piano","kalimba","koto","lead_1_square","lead_2_sawtooth","lead_3_calliope","lead_4_chiff","lead_5_charang","lead_6_voice","lead_7_fifths","lead_8_bass__lead","marimba","melodic_tom","music_box","muted_trumpet","oboe","ocarina","orchestra_hit","orchestral_harp","overdriven_guitar","pad_1_new_age","pad_2_warm","pad_3_polysynth","pad_4_choir","pad_5_bowed","pad_6_metallic","pad_7_halo","pad_8_sweep","pan_flute","percussive_organ","piccolo","pizzicato_strings","recorder","reed_organ","reverse_cymbal","rock_organ","seashore","shakuhachi","shamisen","shanai","sitar","slap_bass_1","slap_bass_2","soprano_sax","steel_drums","string_ensemble_1","string_ensemble_2","synth_bass_1","synth_bass_2","synth_brass_1","synth_brass_2","synth_choir","synth_drum","synth_strings_1","synth_strings_2","taiko_drum","tango_accordion","telephone_ring","tenor_sax","timpani","tinkle_bell","tremolo_strings","trombone","trumpet","tuba","tubular_bells","vibraphone","viola","violin","voice_oohs","whistle","woodblock","xylophone"],Hn="data:image/svg+xml,%3c!--%20Taken%20from%20https://github.com/n3r4zzurr0/svg-spinners%20--%3e%3csvg%20width='24'%20height='24'%20stroke='%23fff'%20viewBox='0%200%2024%2024'%20xmlns='http://www.w3.org/2000/svg'%3e%3cstyle%3e.spinner_V8m1{transform-origin:center;animation:spinner_zKoa%202s%20linear%20infinite}.spinner_V8m1%20circle{stroke-linecap:round;animation:spinner_YpZS%201.5s%20ease-in-out%20infinite}@keyframes%20spinner_zKoa{100%25{transform:rotate(360deg)}}@keyframes%20spinner_YpZS{0%25{stroke-dasharray:0%20150;stroke-dashoffset:0}47.5%25{stroke-dasharray:42%20150;stroke-dashoffset:-16}95%25,100%25{stroke-dasharray:42%20150;stroke-dashoffset:-59}}%3c/style%3e%3cg%20class='spinner_V8m1'%3e%3ccircle%20cx='12'%20cy='12'%20r='9.5'%20fill='none'%20stroke-width='3'%3e%3c/circle%3e%3c/g%3e%3c/svg%3e";function gn(t,e,n){const r=t.slice();return r[25]=e[n],r}function _n(t,e,n){const r=t.slice();return r[28]=e[n],r}function bn(t){let e;return{c(){e=b("option"),e.textContent=`${Vn(t[28])}`,e.__value=t[28],Z(e,e.__value)},m(n,r){N(n,e,r)},p:X,d(n){n&&A(e)}}}function pi(t){return{c:X,m:X,d:X}}function mi(t){return{c:X,m:X,d:X}}function yi(t){let e,n;return{c(){e=b("img"),Nn(e.src,n=Hn)||k(e,"src",n),k(e,"alt","spinner")},m(r,i){N(r,e,i)},d(r){r&&A(e)}}}function wn(t){let e,n=Vn(t[25])+"",r;return{c(){e=b("option"),r=ne(n),e.__value=t[25],Z(e,e.__value)},m(i,o){N(i,e,o),v(e,r)},p:X,d(i){i&&A(e)}}}function vi(t){let e,n,r,i,o,s,c,u,a,d,f,l,h,p,m,y,_,P,V,w,T,O,B,$,F,oe,J,D,Q,K,fe,G,H,ae,he,ie,le,be,ue,z,ge,de,g,U,R=Ie(vn),W=[];for(let S=0;S<R.length;S+=1)W[S]=bn(_n(t,R,S));let q={ctx:t,current:null,token:null,hasCatch:!1,pending:yi,then:mi,catch:pi};an(J=t[1],q);let j=Ie(kn),x=[];for(let S=0;S<j.length;S+=1)x[S]=wn(gn(t,j,S));return{c(){e=b("div"),n=b("div"),r=b("span"),r.textContent="Sustain",i=E(),o=b("input"),s=E(),c=b("div"),u=b("span"),u.textContent="Tranpose",a=E(),d=b("input"),f=E(),l=b("input"),h=E(),p=b("div"),m=b("span"),m.textContent="Volume",y=E(),_=b("input"),P=E(),V=b("span"),w=ne(t[5]),T=E(),O=b("div"),B=b("span"),B.textContent="Instrument",$=E(),F=b("select");for(let S=0;S<W.length;S+=1)W[S].c();oe=E(),q.block.c(),D=E(),Q=b("div"),K=b("span"),K.textContent="Size",fe=E(),G=b("select"),H=b("option"),H.textContent="Full size (88 keys)",ae=b("option"),ae.textContent="Half size (61 keys)",he=b("option"),he.textContent="Quater Size (37 keys)",ie=b("option"),ie.textContent="2 Octaves (24 keys)",le=b("option"),le.textContent="1 Octave (12 keys)",be=E(),ue=b("div"),z=b("span"),z.textContent="Labels",ge=E(),de=b("select");for(let S=0;S<x.length;S+=1)x[S].c();k(r,"class","svelte-1ue5508"),k(o,"type","checkbox"),k(n,"title","Shortcut: space"),k(n,"class","svelte-1ue5508"),k(u,"title","Double click to reset"),k(u,"class","svelte-1ue5508"),k(d,"title","Note shift (shortcut: left ctrl + left alt)"),k(d,"type","number"),k(l,"title","Octave shift (shortcut: right alt + right ctrl)"),k(l,"type","number"),k(c,"class","svelte-1ue5508"),k(m,"class","svelte-1ue5508"),k(_,"type","range"),k(_,"min","0"),k(_,"max","10"),k(_,"step","0.1"),Be(_,"width","8rem"),k(V,"class","svelte-1ue5508"),k(p,"class","svelte-1ue5508"),k(B,"class","svelte-1ue5508"),t[0]===void 0&&Fe(()=>t[22].call(F)),k(O,"class","svelte-1ue5508"),k(K,"class","svelte-1ue5508"),H.__value="A0,C8",Z(H,H.__value),ae.__value="C2,C7",Z(ae,ae.__value),he.__value="C3,C6",Z(he,he.__value),ie.__value="C4,B5",Z(ie,ie.__value),le.__value="C4,B4",Z(le,le.__value),t[6]===void 0&&Fe(()=>t[23].call(G)),k(Q,"class","svelte-1ue5508"),k(z,"class","svelte-1ue5508"),t[7]===void 0&&Fe(()=>t[24].call(de)),k(ue,"class","svelte-1ue5508"),k(e,"class","option-list svelte-1ue5508")},m(S,pe){N(S,e,pe),v(e,n),v(n,r),v(n,i),v(n,o),o.checked=t[4],v(e,s),v(e,c),v(c,u),v(c,a),v(c,d),Z(d,t[3]),v(c,f),v(c,l),Z(l,t[2]),v(e,h),v(e,p),v(p,m),v(p,y),v(p,_),Z(_,t[5]),v(p,P),v(p,V),v(V,w),v(e,T),v(e,O),v(O,B),v(O,$),v(O,F);for(let L=0;L<W.length;L+=1)W[L]&&W[L].m(F,null);Pe(F,t[0],!0),v(O,oe),q.block.m(O,q.anchor=null),q.mount=()=>O,q.anchor=null,v(e,D),v(e,Q),v(Q,K),v(Q,fe),v(Q,G),v(G,H),v(G,ae),v(G,he),v(G,ie),v(G,le),Pe(G,t[6],!0),v(e,be),v(e,ue),v(ue,z),v(ue,ge),v(ue,de);for(let L=0;L<x.length;L+=1)x[L]&&x[L].m(de,null);Pe(de,t[7],!0),g||(U=[C(window,"keyup",t[14]),C(o,"change",t[17]),C(u,"click",t[18]),C(d,"input",t[19]),C(l,"input",t[20]),C(_,"change",t[21]),C(_,"input",t[21]),C(F,"change",t[22]),C(G,"change",t[23]),C(de,"change",t[24])],g=!0)},p(S,[pe]){if(t=S,pe&16&&(o.checked=t[4]),pe&8&&Ue(d.value)!==t[3]&&Z(d,t[3]),pe&4&&Ue(l.value)!==t[2]&&Z(l,t[2]),pe&32&&Z(_,t[5]),pe&32&&ze(w,t[5]),pe&0){R=Ie(vn);let L;for(L=0;L<R.length;L+=1){const it=_n(t,R,L);W[L]?W[L].p(it,pe):(W[L]=bn(it),W[L].c(),W[L].m(F,null))}for(;L<W.length;L+=1)W[L].d(1);W.length=R.length}if(pe&1&&Pe(F,t[0]),q.ctx=t,pe&2&&J!==(J=t[1])&&an(J,q),pe&64&&Pe(G,t[6]),pe&0){j=Ie(kn);let L;for(L=0;L<j.length;L+=1){const it=gn(t,j,L);x[L]?x[L].p(it,pe):(x[L]=wn(it),x[L].c(),x[L].m(de,null))}for(;L<x.length;L+=1)x[L].d(1);x.length=j.length}pe&128&&Pe(de,t[7])},i:X,o:X,d(S){S&&A(e),ht(W,S),q.block.d(),q.token=null,q=null,ht(x,S),g=!1,we(U)}}}const kn=["none","notes","keybinds"];class gi{constructor(){M(this,"octaveShift",se(0));M(this,"noteShift",se(0));M(this,"sustain",se(!1));M(this,"volume",se(10));M(this,"noteRange",se("C2,C7"));M(this,"labelType",se("keybinds"))}}function Vn(t){return t.split("_").map(r=>r.charAt(0).toUpperCase()+r.slice(1)).join(" ")}function _i(t,e,n){let r,i,o,s,c,u,a,{pianoControlsData:d}=e,{socketPlayer:f}=e,l="acoustic_grand_piano",{noteRange:h,sustain:p,noteShift:m,octaveShift:y,volume:_,labelType:P}=d;Y(t,h,D=>n(6,u=D)),Y(t,p,D=>n(4,s=D)),Y(t,m,D=>n(3,o=D)),Y(t,y,D=>n(2,i=D)),Y(t,_,D=>n(5,c=D)),Y(t,P,D=>n(7,a=D)),m.subscribe(()=>{o>=12?(ce(y,i+=1,i),ce(m,o=0,o)):o<=-12&&(ce(y,i-=1,i),ce(m,o=0,o))}),y.subscribe(()=>{i<-3?ce(y,i=3,i):i>3&&ce(y,i=-3,i)});function V(D){if(D.code==="Space"&&ce(p,s=!1,s),D.target.tagName!=="INPUT")switch(D.code){case"Space":ce(p,s=!0,s);break;case"ControlLeft":ce(m,o-=1,o);break;case"AltLeft":ce(m,o+=1,o);break;case"AltRight":ce(y,i-=1,i);break;case"ControlRight":ce(y,i+=1,i);break}}function w(){s=this.checked,p.set(s)}const T=D=>{D.detail==2&&(ce(m,o=0,o),ce(y,i=0,i))};function O(){o=Ue(this.value),m.set(o)}function B(){i=Ue(this.value),y.set(i)}function $(){c=Ue(this.value),_.set(c)}function F(){l=kt(this),n(0,l)}function oe(){u=kt(this),h.set(u)}function J(){a=kt(this),P.set(a)}return t.$$set=D=>{"pianoControlsData"in D&&n(15,d=D.pianoControlsData),"socketPlayer"in D&&n(16,f=D.socketPlayer)},t.$$.update=()=>{t.$$.dirty&65537&&n(1,r=f.changeInstrument(l))},[l,r,i,o,s,c,u,a,h,p,m,y,_,P,V,d,f,w,T,O,B,$,F,oe,J]}class bi extends rt{constructor(e){super(),nt(this,e,_i,vi,He,{pianoControlsData:15,socketPlayer:16})}}function wi(t){for(var e=t.length,n=0,r=0;r<e;){var i=t.charCodeAt(r++);if(i&4294967168)if(!(i&4294965248))n+=2;else{if(i>=55296&&i<=56319&&r<e){var o=t.charCodeAt(r);(o&64512)===56320&&(++r,i=((i&1023)<<10)+(o&1023)+65536)}i&4294901760?n+=4:n+=3}else{n++;continue}}return n}function ki(t,e,n){for(var r=t.length,i=n,o=0;o<r;){var s=t.charCodeAt(o++);if(s&4294967168)if(!(s&4294965248))e[i++]=s>>6&31|192;else{if(s>=55296&&s<=56319&&o<r){var c=t.charCodeAt(o);(c&64512)===56320&&(++o,s=((s&1023)<<10)+(c&1023)+65536)}s&4294901760?(e[i++]=s>>18&7|240,e[i++]=s>>12&63|128,e[i++]=s>>6&63|128):(e[i++]=s>>12&15|224,e[i++]=s>>6&63|128)}else{e[i++]=s;continue}e[i++]=s&63|128}}var Ii=new TextEncoder,xi=50;function Ti(t,e,n){Ii.encodeInto(t,e.subarray(n))}function Ui(t,e,n){t.length>xi?Ti(t,e,n):ki(t,e,n)}var Si=4096;function Wn(t,e,n){for(var r=e,i=r+n,o=[],s="";r<i;){var c=t[r++];if(!(c&128))o.push(c);else if((c&224)===192){var u=t[r++]&63;o.push((c&31)<<6|u)}else if((c&240)===224){var u=t[r++]&63,a=t[r++]&63;o.push((c&31)<<12|u<<6|a)}else if((c&248)===240){var u=t[r++]&63,a=t[r++]&63,d=t[r++]&63,f=(c&7)<<18|u<<12|a<<6|d;f>65535&&(f-=65536,o.push(f>>>10&1023|55296),f=56320|f&1023),o.push(f)}else o.push(c);o.length>=Si&&(s+=String.fromCharCode.apply(String,o),o.length=0)}return o.length>0&&(s+=String.fromCharCode.apply(String,o)),s}var Ci=new TextDecoder,Pi=200;function Ei(t,e,n){var r=t.subarray(e,e+n);return Ci.decode(r)}function Mi(t,e,n){return n>Pi?Ei(t,e,n):Wn(t,e,n)}var bt=function(){function t(e,n){this.type=e,this.data=n}return t}(),Di=function(){var t=function(e,n){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,i){r.__proto__=i}||function(r,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(r[o]=i[o])},t(e,n)};return function(e,n){if(typeof n!="function"&&n!==null)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");t(e,n);function r(){this.constructor=e}e.prototype=n===null?Object.create(n):(r.prototype=n.prototype,new r)}}(),ke=function(t){Di(e,t);function e(n){var r=t.call(this,n)||this,i=Object.create(e.prototype);return Object.setPrototypeOf(r,i),Object.defineProperty(r,"name",{configurable:!0,enumerable:!1,value:e.name}),r}return e}(Error),ot=4294967295;function Ai(t,e,n){var r=n/4294967296,i=n;t.setUint32(e,r),t.setUint32(e+4,i)}function Kn(t,e,n){var r=Math.floor(n/4294967296),i=n;t.setUint32(e,r),t.setUint32(e+4,i)}function Gn(t,e){var n=t.getInt32(e),r=t.getUint32(e+4);return n*4294967296+r}function Ni(t,e){var n=t.getUint32(e),r=t.getUint32(e+4);return n*4294967296+r}var Oi=-1,Bi=4294967296-1,Fi=17179869184-1;function Li(t){var e=t.sec,n=t.nsec;if(e>=0&&n>=0&&e<=Fi)if(n===0&&e<=Bi){var r=new Uint8Array(4),i=new DataView(r.buffer);return i.setUint32(0,e),r}else{var o=e/4294967296,s=e&4294967295,r=new Uint8Array(8),i=new DataView(r.buffer);return i.setUint32(0,n<<2|o&3),i.setUint32(4,s),r}else{var r=new Uint8Array(12),i=new DataView(r.buffer);return i.setUint32(0,n),Kn(i,4,e),r}}function zi(t){var e=t.getTime(),n=Math.floor(e/1e3),r=(e-n*1e3)*1e6,i=Math.floor(r/1e9);return{sec:n+i,nsec:r-i*1e9}}function Ri(t){if(t instanceof Date){var e=zi(t);return Li(e)}else return null}function Hi(t){var e=new DataView(t.buffer,t.byteOffset,t.byteLength);switch(t.byteLength){case 4:{var n=e.getUint32(0),r=0;return{sec:n,nsec:r}}case 8:{var i=e.getUint32(0),o=e.getUint32(4),n=(i&3)*4294967296+o,r=i>>>2;return{sec:n,nsec:r}}case 12:{var n=Gn(e,4),r=e.getUint32(0);return{sec:n,nsec:r}}default:throw new ke("Unrecognized data size for timestamp (expected 4, 8, or 12): ".concat(t.length))}}function Vi(t){var e=Hi(t);return new Date(e.sec*1e3+e.nsec/1e6)}var Wi={type:Oi,encode:Ri,decode:Vi},qn=function(){function t(){this.builtInEncoders=[],this.builtInDecoders=[],this.encoders=[],this.decoders=[],this.register(Wi)}return t.prototype.register=function(e){var n=e.type,r=e.encode,i=e.decode;if(n>=0)this.encoders[n]=r,this.decoders[n]=i;else{var o=1+n;this.builtInEncoders[o]=r,this.builtInDecoders[o]=i}},t.prototype.tryToEncode=function(e,n){for(var r=0;r<this.builtInEncoders.length;r++){var i=this.builtInEncoders[r];if(i!=null){var o=i(e,n);if(o!=null){var s=-1-r;return new bt(s,o)}}}for(var r=0;r<this.encoders.length;r++){var i=this.encoders[r];if(i!=null){var o=i(e,n);if(o!=null){var s=r;return new bt(s,o)}}}return e instanceof bt?e:null},t.prototype.decode=function(e,n,r){var i=n<0?this.builtInDecoders[-1-n]:this.decoders[n];return i?i(e,n,r):new bt(n,e)},t.defaultCodec=new t,t}();function Mt(t){return t instanceof Uint8Array?t:ArrayBuffer.isView(t)?new Uint8Array(t.buffer,t.byteOffset,t.byteLength):t instanceof ArrayBuffer?new Uint8Array(t):Uint8Array.from(t)}function Ki(t){if(t instanceof ArrayBuffer)return new DataView(t);var e=Mt(t);return new DataView(e.buffer,e.byteOffset,e.byteLength)}var Gi=100,qi=2048,Ji=function(){function t(e){var n,r,i,o,s,c,u,a;this.extensionCodec=(n=e==null?void 0:e.extensionCodec)!==null&&n!==void 0?n:qn.defaultCodec,this.context=e==null?void 0:e.context,this.useBigInt64=(r=e==null?void 0:e.useBigInt64)!==null&&r!==void 0?r:!1,this.maxDepth=(i=e==null?void 0:e.maxDepth)!==null&&i!==void 0?i:Gi,this.initialBufferSize=(o=e==null?void 0:e.initialBufferSize)!==null&&o!==void 0?o:qi,this.sortKeys=(s=e==null?void 0:e.sortKeys)!==null&&s!==void 0?s:!1,this.forceFloat32=(c=e==null?void 0:e.forceFloat32)!==null&&c!==void 0?c:!1,this.ignoreUndefined=(u=e==null?void 0:e.ignoreUndefined)!==null&&u!==void 0?u:!1,this.forceIntegerToFloat=(a=e==null?void 0:e.forceIntegerToFloat)!==null&&a!==void 0?a:!1,this.pos=0,this.view=new DataView(new ArrayBuffer(this.initialBufferSize)),this.bytes=new Uint8Array(this.view.buffer)}return t.prototype.reinitializeState=function(){this.pos=0},t.prototype.encodeSharedRef=function(e){return this.reinitializeState(),this.doEncode(e,1),this.bytes.subarray(0,this.pos)},t.prototype.encode=function(e){return this.reinitializeState(),this.doEncode(e,1),this.bytes.slice(0,this.pos)},t.prototype.doEncode=function(e,n){if(n>this.maxDepth)throw new Error("Too deep objects in depth ".concat(n));e==null?this.encodeNil():typeof e=="boolean"?this.encodeBoolean(e):typeof e=="number"?this.forceIntegerToFloat?this.encodeNumberAsFloat(e):this.encodeNumber(e):typeof e=="string"?this.encodeString(e):this.useBigInt64&&typeof e=="bigint"?this.encodeBigInt64(e):this.encodeObject(e,n)},t.prototype.ensureBufferSizeToWrite=function(e){var n=this.pos+e;this.view.byteLength<n&&this.resizeBuffer(n*2)},t.prototype.resizeBuffer=function(e){var n=new ArrayBuffer(e),r=new Uint8Array(n),i=new DataView(n);r.set(this.bytes),this.view=i,this.bytes=r},t.prototype.encodeNil=function(){this.writeU8(192)},t.prototype.encodeBoolean=function(e){e===!1?this.writeU8(194):this.writeU8(195)},t.prototype.encodeNumber=function(e){!this.forceIntegerToFloat&&Number.isSafeInteger(e)?e>=0?e<128?this.writeU8(e):e<256?(this.writeU8(204),this.writeU8(e)):e<65536?(this.writeU8(205),this.writeU16(e)):e<4294967296?(this.writeU8(206),this.writeU32(e)):this.useBigInt64?this.encodeNumberAsFloat(e):(this.writeU8(207),this.writeU64(e)):e>=-32?this.writeU8(224|e+32):e>=-128?(this.writeU8(208),this.writeI8(e)):e>=-32768?(this.writeU8(209),this.writeI16(e)):e>=-2147483648?(this.writeU8(210),this.writeI32(e)):this.useBigInt64?this.encodeNumberAsFloat(e):(this.writeU8(211),this.writeI64(e)):this.encodeNumberAsFloat(e)},t.prototype.encodeNumberAsFloat=function(e){this.forceFloat32?(this.writeU8(202),this.writeF32(e)):(this.writeU8(203),this.writeF64(e))},t.prototype.encodeBigInt64=function(e){e>=BigInt(0)?(this.writeU8(207),this.writeBigUint64(e)):(this.writeU8(211),this.writeBigInt64(e))},t.prototype.writeStringHeader=function(e){if(e<32)this.writeU8(160+e);else if(e<256)this.writeU8(217),this.writeU8(e);else if(e<65536)this.writeU8(218),this.writeU16(e);else if(e<4294967296)this.writeU8(219),this.writeU32(e);else throw new Error("Too long string: ".concat(e," bytes in UTF-8"))},t.prototype.encodeString=function(e){var n=5,r=wi(e);this.ensureBufferSizeToWrite(n+r),this.writeStringHeader(r),Ui(e,this.bytes,this.pos),this.pos+=r},t.prototype.encodeObject=function(e,n){var r=this.extensionCodec.tryToEncode(e,this.context);if(r!=null)this.encodeExtension(r);else if(Array.isArray(e))this.encodeArray(e,n);else if(ArrayBuffer.isView(e))this.encodeBinary(e);else if(typeof e=="object")this.encodeMap(e,n);else throw new Error("Unrecognized object: ".concat(Object.prototype.toString.apply(e)))},t.prototype.encodeBinary=function(e){var n=e.byteLength;if(n<256)this.writeU8(196),this.writeU8(n);else if(n<65536)this.writeU8(197),this.writeU16(n);else if(n<4294967296)this.writeU8(198),this.writeU32(n);else throw new Error("Too large binary: ".concat(n));var r=Mt(e);this.writeU8a(r)},t.prototype.encodeArray=function(e,n){var r=e.length;if(r<16)this.writeU8(144+r);else if(r<65536)this.writeU8(220),this.writeU16(r);else if(r<4294967296)this.writeU8(221),this.writeU32(r);else throw new Error("Too large array: ".concat(r));for(var i=0,o=e;i<o.length;i++){var s=o[i];this.doEncode(s,n+1)}},t.prototype.countWithoutUndefined=function(e,n){for(var r=0,i=0,o=n;i<o.length;i++){var s=o[i];e[s]!==void 0&&r++}return r},t.prototype.encodeMap=function(e,n){var r=Object.keys(e);this.sortKeys&&r.sort();var i=this.ignoreUndefined?this.countWithoutUndefined(e,r):r.length;if(i<16)this.writeU8(128+i);else if(i<65536)this.writeU8(222),this.writeU16(i);else if(i<4294967296)this.writeU8(223),this.writeU32(i);else throw new Error("Too large map object: ".concat(i));for(var o=0,s=r;o<s.length;o++){var c=s[o],u=e[c];this.ignoreUndefined&&u===void 0||(this.encodeString(c),this.doEncode(u,n+1))}},t.prototype.encodeExtension=function(e){var n=e.data.length;if(n===1)this.writeU8(212);else if(n===2)this.writeU8(213);else if(n===4)this.writeU8(214);else if(n===8)this.writeU8(215);else if(n===16)this.writeU8(216);else if(n<256)this.writeU8(199),this.writeU8(n);else if(n<65536)this.writeU8(200),this.writeU16(n);else if(n<4294967296)this.writeU8(201),this.writeU32(n);else throw new Error("Too large extension object: ".concat(n));this.writeI8(e.type),this.writeU8a(e.data)},t.prototype.writeU8=function(e){this.ensureBufferSizeToWrite(1),this.view.setUint8(this.pos,e),this.pos++},t.prototype.writeU8a=function(e){var n=e.length;this.ensureBufferSizeToWrite(n),this.bytes.set(e,this.pos),this.pos+=n},t.prototype.writeI8=function(e){this.ensureBufferSizeToWrite(1),this.view.setInt8(this.pos,e),this.pos++},t.prototype.writeU16=function(e){this.ensureBufferSizeToWrite(2),this.view.setUint16(this.pos,e),this.pos+=2},t.prototype.writeI16=function(e){this.ensureBufferSizeToWrite(2),this.view.setInt16(this.pos,e),this.pos+=2},t.prototype.writeU32=function(e){this.ensureBufferSizeToWrite(4),this.view.setUint32(this.pos,e),this.pos+=4},t.prototype.writeI32=function(e){this.ensureBufferSizeToWrite(4),this.view.setInt32(this.pos,e),this.pos+=4},t.prototype.writeF32=function(e){this.ensureBufferSizeToWrite(4),this.view.setFloat32(this.pos,e),this.pos+=4},t.prototype.writeF64=function(e){this.ensureBufferSizeToWrite(8),this.view.setFloat64(this.pos,e),this.pos+=8},t.prototype.writeU64=function(e){this.ensureBufferSizeToWrite(8),Ai(this.view,this.pos,e),this.pos+=8},t.prototype.writeI64=function(e){this.ensureBufferSizeToWrite(8),Kn(this.view,this.pos,e),this.pos+=8},t.prototype.writeBigUint64=function(e){this.ensureBufferSizeToWrite(8),this.view.setBigUint64(this.pos,e),this.pos+=8},t.prototype.writeBigInt64=function(e){this.ensureBufferSizeToWrite(8),this.view.setBigInt64(this.pos,e),this.pos+=8},t}();function Xi(t,e){var n=new Ji(e);return n.encodeSharedRef(t)}function Ht(t){return"".concat(t<0?"-":"","0x").concat(Math.abs(t).toString(16).padStart(2,"0"))}var Yi=16,Qi=16,Zi=function(){function t(e,n){e===void 0&&(e=Yi),n===void 0&&(n=Qi),this.maxKeyLength=e,this.maxLengthPerKey=n,this.hit=0,this.miss=0,this.caches=[];for(var r=0;r<this.maxKeyLength;r++)this.caches.push([])}return t.prototype.canBeCached=function(e){return e>0&&e<=this.maxKeyLength},t.prototype.find=function(e,n,r){var i=this.caches[r-1];e:for(var o=0,s=i;o<s.length;o++){for(var c=s[o],u=c.bytes,a=0;a<r;a++)if(u[a]!==e[n+a])continue e;return c.str}return null},t.prototype.store=function(e,n){var r=this.caches[e.length-1],i={bytes:e,str:n};r.length>=this.maxLengthPerKey?r[Math.random()*r.length|0]=i:r.push(i)},t.prototype.decode=function(e,n,r){var i=this.find(e,n,r);if(i!=null)return this.hit++,i;this.miss++;var o=Wn(e,n,r),s=Uint8Array.prototype.slice.call(e,n,n+r);return this.store(s,o),o},t}(),$i=function(t,e,n,r){function i(o){return o instanceof n?o:new n(function(s){s(o)})}return new(n||(n=Promise))(function(o,s){function c(d){try{a(r.next(d))}catch(f){s(f)}}function u(d){try{a(r.throw(d))}catch(f){s(f)}}function a(d){d.done?o(d.value):i(d.value).then(c,u)}a((r=r.apply(t,e||[])).next())})},Vt=function(t,e){var n={label:0,sent:function(){if(o[0]&1)throw o[1];return o[1]},trys:[],ops:[]},r,i,o,s;return s={next:c(0),throw:c(1),return:c(2)},typeof Symbol=="function"&&(s[Symbol.iterator]=function(){return this}),s;function c(a){return function(d){return u([a,d])}}function u(a){if(r)throw new TypeError("Generator is already executing.");for(;s&&(s=0,a[0]&&(n=0)),n;)try{if(r=1,i&&(o=a[0]&2?i.return:a[0]?i.throw||((o=i.return)&&o.call(i),0):i.next)&&!(o=o.call(i,a[1])).done)return o;switch(i=0,o&&(a=[a[0]&2,o.value]),a[0]){case 0:case 1:o=a;break;case 4:return n.label++,{value:a[1],done:!1};case 5:n.label++,i=a[1],a=[0];continue;case 7:a=n.ops.pop(),n.trys.pop();continue;default:if(o=n.trys,!(o=o.length>0&&o[o.length-1])&&(a[0]===6||a[0]===2)){n=0;continue}if(a[0]===3&&(!o||a[1]>o[0]&&a[1]<o[3])){n.label=a[1];break}if(a[0]===6&&n.label<o[1]){n.label=o[1],o=a;break}if(o&&n.label<o[2]){n.label=o[2],n.ops.push(a);break}o[2]&&n.ops.pop(),n.trys.pop();continue}a=e.call(t,n)}catch(d){a=[6,d],i=0}finally{r=o=0}if(a[0]&5)throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}},In=function(t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var e=t[Symbol.asyncIterator],n;return e?e.call(t):(t=typeof __values=="function"?__values(t):t[Symbol.iterator](),n={},r("next"),r("throw"),r("return"),n[Symbol.asyncIterator]=function(){return this},n);function r(o){n[o]=t[o]&&function(s){return new Promise(function(c,u){s=t[o](s),i(c,u,s.done,s.value)})}}function i(o,s,c,u){Promise.resolve(u).then(function(a){o({value:a,done:c})},s)}},tt=function(t){return this instanceof tt?(this.v=t,this):new tt(t)},ji=function(t,e,n){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var r=n.apply(t,e||[]),i,o=[];return i={},s("next"),s("throw"),s("return"),i[Symbol.asyncIterator]=function(){return this},i;function s(l){r[l]&&(i[l]=function(h){return new Promise(function(p,m){o.push([l,h,p,m])>1||c(l,h)})})}function c(l,h){try{u(r[l](h))}catch(p){f(o[0][3],p)}}function u(l){l.value instanceof tt?Promise.resolve(l.value.v).then(a,d):f(o[0][2],l)}function a(l){c("next",l)}function d(l){c("throw",l)}function f(l,h){l(h),o.shift(),o.length&&c(o[0][0],o[0][1])}},xn="array",wt="map_key",es="map_value",ts=function(t){return typeof t=="string"||typeof t=="number"},at=-1,jt=new DataView(new ArrayBuffer(0)),ns=new Uint8Array(jt.buffer);try{jt.getInt8(0)}catch(t){if(!(t instanceof RangeError))throw new Error("This module is not supported in the current JavaScript engine because DataView does not throw RangeError on out-of-bounds access")}var Yt=RangeError,Tn=new Yt("Insufficient data"),rs=new Zi,is=function(){function t(e){var n,r,i,o,s,c,u;this.totalPos=0,this.pos=0,this.view=jt,this.bytes=ns,this.headByte=at,this.stack=[],this.extensionCodec=(n=e==null?void 0:e.extensionCodec)!==null&&n!==void 0?n:qn.defaultCodec,this.context=e==null?void 0:e.context,this.useBigInt64=(r=e==null?void 0:e.useBigInt64)!==null&&r!==void 0?r:!1,this.maxStrLength=(i=e==null?void 0:e.maxStrLength)!==null&&i!==void 0?i:ot,this.maxBinLength=(o=e==null?void 0:e.maxBinLength)!==null&&o!==void 0?o:ot,this.maxArrayLength=(s=e==null?void 0:e.maxArrayLength)!==null&&s!==void 0?s:ot,this.maxMapLength=(c=e==null?void 0:e.maxMapLength)!==null&&c!==void 0?c:ot,this.maxExtLength=(u=e==null?void 0:e.maxExtLength)!==null&&u!==void 0?u:ot,this.keyDecoder=(e==null?void 0:e.keyDecoder)!==void 0?e.keyDecoder:rs}return t.prototype.reinitializeState=function(){this.totalPos=0,this.headByte=at,this.stack.length=0},t.prototype.setBuffer=function(e){this.bytes=Mt(e),this.view=Ki(this.bytes),this.pos=0},t.prototype.appendBuffer=function(e){if(this.headByte===at&&!this.hasRemaining(1))this.setBuffer(e);else{var n=this.bytes.subarray(this.pos),r=Mt(e),i=new Uint8Array(n.length+r.length);i.set(n),i.set(r,n.length),this.setBuffer(i)}},t.prototype.hasRemaining=function(e){return this.view.byteLength-this.pos>=e},t.prototype.createExtraByteError=function(e){var n=this,r=n.view,i=n.pos;return new RangeError("Extra ".concat(r.byteLength-i," of ").concat(r.byteLength," byte(s) found at buffer[").concat(e,"]"))},t.prototype.decode=function(e){this.reinitializeState(),this.setBuffer(e);var n=this.doDecodeSync();if(this.hasRemaining(1))throw this.createExtraByteError(this.pos);return n},t.prototype.decodeMulti=function(e){return Vt(this,function(n){switch(n.label){case 0:this.reinitializeState(),this.setBuffer(e),n.label=1;case 1:return this.hasRemaining(1)?[4,this.doDecodeSync()]:[3,3];case 2:return n.sent(),[3,1];case 3:return[2]}})},t.prototype.decodeAsync=function(e){var n,r,i,o,s,c,u;return $i(this,void 0,void 0,function(){var a,d,f,l,h,p,m,y;return Vt(this,function(_){switch(_.label){case 0:a=!1,_.label=1;case 1:_.trys.push([1,6,7,12]),n=!0,r=In(e),_.label=2;case 2:return[4,r.next()];case 3:if(i=_.sent(),o=i.done,!!o)return[3,5];u=i.value,n=!1;try{if(f=u,a)throw this.createExtraByteError(this.totalPos);this.appendBuffer(f);try{d=this.doDecodeSync(),a=!0}catch(P){if(!(P instanceof Yt))throw P}this.totalPos+=this.pos}finally{n=!0}_.label=4;case 4:return[3,2];case 5:return[3,12];case 6:return l=_.sent(),s={error:l},[3,12];case 7:return _.trys.push([7,,10,11]),!n&&!o&&(c=r.return)?[4,c.call(r)]:[3,9];case 8:_.sent(),_.label=9;case 9:return[3,11];case 10:if(s)throw s.error;return[7];case 11:return[7];case 12:if(a){if(this.hasRemaining(1))throw this.createExtraByteError(this.totalPos);return[2,d]}throw h=this,p=h.headByte,m=h.pos,y=h.totalPos,new RangeError("Insufficient data in parsing ".concat(Ht(p)," at ").concat(y," (").concat(m," in the current buffer)"))}})})},t.prototype.decodeArrayStream=function(e){return this.decodeMultiAsync(e,!0)},t.prototype.decodeStream=function(e){return this.decodeMultiAsync(e,!1)},t.prototype.decodeMultiAsync=function(e,n){return ji(this,arguments,function(){var i,o,s,c,u,a,d,f,l,h,p,m;return Vt(this,function(y){switch(y.label){case 0:i=n,o=-1,y.label=1;case 1:y.trys.push([1,15,16,21]),s=!0,c=In(e),y.label=2;case 2:return[4,tt(c.next())];case 3:if(u=y.sent(),l=u.done,!!l)return[3,14];m=u.value,s=!1,y.label=4;case 4:if(y.trys.push([4,,12,13]),a=m,n&&o===0)throw this.createExtraByteError(this.totalPos);this.appendBuffer(a),i&&(o=this.readArraySize(),i=!1,this.complete()),y.label=5;case 5:y.trys.push([5,10,,11]),y.label=6;case 6:return[4,tt(this.doDecodeSync())];case 7:return[4,y.sent()];case 8:return y.sent(),--o===0?[3,9]:[3,6];case 9:return[3,11];case 10:if(d=y.sent(),!(d instanceof Yt))throw d;return[3,11];case 11:return this.totalPos+=this.pos,[3,13];case 12:return s=!0,[7];case 13:return[3,2];case 14:return[3,21];case 15:return f=y.sent(),h={error:f},[3,21];case 16:return y.trys.push([16,,19,20]),!s&&!l&&(p=c.return)?[4,tt(p.call(c))]:[3,18];case 17:y.sent(),y.label=18;case 18:return[3,20];case 19:if(h)throw h.error;return[7];case 20:return[7];case 21:return[2]}})})},t.prototype.doDecodeSync=function(){e:for(;;){var e=this.readHeadByte(),n=void 0;if(e>=224)n=e-256;else if(e<192)if(e<128)n=e;else if(e<144){var r=e-128;if(r!==0){this.pushMapState(r),this.complete();continue e}else n={}}else if(e<160){var r=e-144;if(r!==0){this.pushArrayState(r),this.complete();continue e}else n=[]}else{var i=e-160;n=this.decodeUtf8String(i,0)}else if(e===192)n=null;else if(e===194)n=!1;else if(e===195)n=!0;else if(e===202)n=this.readF32();else if(e===203)n=this.readF64();else if(e===204)n=this.readU8();else if(e===205)n=this.readU16();else if(e===206)n=this.readU32();else if(e===207)this.useBigInt64?n=this.readU64AsBigInt():n=this.readU64();else if(e===208)n=this.readI8();else if(e===209)n=this.readI16();else if(e===210)n=this.readI32();else if(e===211)this.useBigInt64?n=this.readI64AsBigInt():n=this.readI64();else if(e===217){var i=this.lookU8();n=this.decodeUtf8String(i,1)}else if(e===218){var i=this.lookU16();n=this.decodeUtf8String(i,2)}else if(e===219){var i=this.lookU32();n=this.decodeUtf8String(i,4)}else if(e===220){var r=this.readU16();if(r!==0){this.pushArrayState(r),this.complete();continue e}else n=[]}else if(e===221){var r=this.readU32();if(r!==0){this.pushArrayState(r),this.complete();continue e}else n=[]}else if(e===222){var r=this.readU16();if(r!==0){this.pushMapState(r),this.complete();continue e}else n={}}else if(e===223){var r=this.readU32();if(r!==0){this.pushMapState(r),this.complete();continue e}else n={}}else if(e===196){var r=this.lookU8();n=this.decodeBinary(r,1)}else if(e===197){var r=this.lookU16();n=this.decodeBinary(r,2)}else if(e===198){var r=this.lookU32();n=this.decodeBinary(r,4)}else if(e===212)n=this.decodeExtension(1,0);else if(e===213)n=this.decodeExtension(2,0);else if(e===214)n=this.decodeExtension(4,0);else if(e===215)n=this.decodeExtension(8,0);else if(e===216)n=this.decodeExtension(16,0);else if(e===199){var r=this.lookU8();n=this.decodeExtension(r,1)}else if(e===200){var r=this.lookU16();n=this.decodeExtension(r,2)}else if(e===201){var r=this.lookU32();n=this.decodeExtension(r,4)}else throw new ke("Unrecognized type byte: ".concat(Ht(e)));this.complete();for(var o=this.stack;o.length>0;){var s=o[o.length-1];if(s.type===xn)if(s.array[s.position]=n,s.position++,s.position===s.size)o.pop(),n=s.array;else continue e;else if(s.type===wt){if(!ts(n))throw new ke("The type of key must be string or number but "+typeof n);if(n==="__proto__")throw new ke("The key __proto__ is not allowed");s.key=n,s.type=es;continue e}else if(s.map[s.key]=n,s.readCount++,s.readCount===s.size)o.pop(),n=s.map;else{s.key=null,s.type=wt;continue e}}return n}},t.prototype.readHeadByte=function(){return this.headByte===at&&(this.headByte=this.readU8()),this.headByte},t.prototype.complete=function(){this.headByte=at},t.prototype.readArraySize=function(){var e=this.readHeadByte();switch(e){case 220:return this.readU16();case 221:return this.readU32();default:{if(e<160)return e-144;throw new ke("Unrecognized array type byte: ".concat(Ht(e)))}}},t.prototype.pushMapState=function(e){if(e>this.maxMapLength)throw new ke("Max length exceeded: map length (".concat(e,") > maxMapLengthLength (").concat(this.maxMapLength,")"));this.stack.push({type:wt,size:e,key:null,readCount:0,map:{}})},t.prototype.pushArrayState=function(e){if(e>this.maxArrayLength)throw new ke("Max length exceeded: array length (".concat(e,") > maxArrayLength (").concat(this.maxArrayLength,")"));this.stack.push({type:xn,size:e,array:new Array(e),position:0})},t.prototype.decodeUtf8String=function(e,n){var r;if(e>this.maxStrLength)throw new ke("Max length exceeded: UTF-8 byte length (".concat(e,") > maxStrLength (").concat(this.maxStrLength,")"));if(this.bytes.byteLength<this.pos+n+e)throw Tn;var i=this.pos+n,o;return this.stateIsMapKey()&&(!((r=this.keyDecoder)===null||r===void 0)&&r.canBeCached(e))?o=this.keyDecoder.decode(this.bytes,i,e):o=Mi(this.bytes,i,e),this.pos+=n+e,o},t.prototype.stateIsMapKey=function(){if(this.stack.length>0){var e=this.stack[this.stack.length-1];return e.type===wt}return!1},t.prototype.decodeBinary=function(e,n){if(e>this.maxBinLength)throw new ke("Max length exceeded: bin length (".concat(e,") > maxBinLength (").concat(this.maxBinLength,")"));if(!this.hasRemaining(e+n))throw Tn;var r=this.pos+n,i=this.bytes.subarray(r,r+e);return this.pos+=n+e,i},t.prototype.decodeExtension=function(e,n){if(e>this.maxExtLength)throw new ke("Max length exceeded: ext length (".concat(e,") > maxExtLength (").concat(this.maxExtLength,")"));var r=this.view.getInt8(this.pos+n),i=this.decodeBinary(e,n+1);return this.extensionCodec.decode(i,r,this.context)},t.prototype.lookU8=function(){return this.view.getUint8(this.pos)},t.prototype.lookU16=function(){return this.view.getUint16(this.pos)},t.prototype.lookU32=function(){return this.view.getUint32(this.pos)},t.prototype.readU8=function(){var e=this.view.getUint8(this.pos);return this.pos++,e},t.prototype.readI8=function(){var e=this.view.getInt8(this.pos);return this.pos++,e},t.prototype.readU16=function(){var e=this.view.getUint16(this.pos);return this.pos+=2,e},t.prototype.readI16=function(){var e=this.view.getInt16(this.pos);return this.pos+=2,e},t.prototype.readU32=function(){var e=this.view.getUint32(this.pos);return this.pos+=4,e},t.prototype.readI32=function(){var e=this.view.getInt32(this.pos);return this.pos+=4,e},t.prototype.readU64=function(){var e=Ni(this.view,this.pos);return this.pos+=8,e},t.prototype.readI64=function(){var e=Gn(this.view,this.pos);return this.pos+=8,e},t.prototype.readU64AsBigInt=function(){var e=this.view.getBigUint64(this.pos);return this.pos+=8,e},t.prototype.readI64AsBigInt=function(){var e=this.view.getBigInt64(this.pos);return this.pos+=8,e},t.prototype.readF32=function(){var e=this.view.getFloat32(this.pos);return this.pos+=4,e},t.prototype.readF64=function(){var e=this.view.getFloat64(this.pos);return this.pos+=8,e},t}();function ss(t,e){var n=new is(e);return n.decode(t)}var os=Object.defineProperty,as=Object.defineProperties,cs=Object.getOwnPropertyDescriptors,Un=Object.getOwnPropertySymbols,ls=Object.prototype.hasOwnProperty,us=Object.prototype.propertyIsEnumerable,Jn=t=>{throw TypeError(t)},Sn=(t,e,n)=>e in t?os(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,xt=(t,e)=>{for(var n in e||(e={}))ls.call(e,n)&&Sn(t,n,e[n]);if(Un)for(var n of Un(e))us.call(e,n)&&Sn(t,n,e[n]);return t},Tt=(t,e)=>as(t,cs(e)),Xn=(t,e,n)=>e.has(t)||Jn("Cannot "+n),I=(t,e,n)=>(Xn(t,e,"read from private field"),n?n.call(t):e.get(t)),me=(t,e,n)=>e.has(t)?Jn("Cannot add the same private member more than once"):e instanceof WeakSet?e.add(t):e.set(t,n),te=(t,e,n,r)=>(Xn(t,e,"write to private field"),e.set(t,n),n),mt=(t,e,n)=>new Promise((r,i)=>{var o=u=>{try{c(n.next(u))}catch(a){i(a)}},s=u=>{try{c(n.throw(u))}catch(a){i(a)}},c=u=>u.done?r(u.value):Promise.resolve(u.value).then(o,s);c((n=n.apply(t,e)).next())});function Ut(t){const e=t.filter(n=>!!n);return e.reduce((n,r)=>{const i="output"in n?n.output:n,o="input"in r?r.input:r;return i.connect(o),r}),()=>{e.reduce((n,r)=>{const i="output"in n?n.output:n,o="input"in r?r.input:r;return i.disconnect(o),r})}}function fs(t){let e=t;const n=new Set;function r(s){return n.add(s),s(e),()=>{n.delete(s)}}function i(s){e=s,n.forEach(c=>c(e))}function o(){return e}return{subscribe:r,set:i,get:o}}function hs(){const t=new Set;function e(r){return t.add(r),()=>{t.delete(r)}}function n(r){t.forEach(i=>i(r))}return{subscribe:e,trigger:n}}function ds(t){let e=!1;return()=>{e||(e=!0,t.forEach(n=>n==null?void 0:n()))}}function Yn(t){return t*t/16129}function ps(t){return Math.pow(10,t/20)}var Me,Ce,qe,Je,St,De,Ae,ms=class{constructor(t,e){this.context=t,me(this,Me),me(this,Ce),me(this,qe),me(this,Je),me(this,St),me(this,De),me(this,Ae,!1);var n,r,i;te(this,De,{destination:(n=e==null?void 0:e.destination)!=null?n:t.destination,volume:(r=e==null?void 0:e.volume)!=null?r:100,volumeToGain:(i=e==null?void 0:e.volumeToGain)!=null?i:Yn}),this.input=t.createGain(),te(this,Me,t.createGain()),te(this,Je,Ut([this.input,I(this,Me),I(this,De).destination]));const o=fs(I(this,De).volume);this.setVolume=o.set,te(this,St,o.subscribe(s=>{I(this,Me).gain.value=I(this,De).volumeToGain(s)}))}addInsert(t){var e;if(I(this,Ae))throw Error("Can't add insert to disconnected channel");(e=I(this,qe))!=null||te(this,qe,[]),I(this,qe).push(t),I(this,Je).call(this),te(this,Je,Ut([this.input,...I(this,qe),I(this,Me),I(this,De).destination]))}addEffect(t,e,n){var r;if(I(this,Ae))throw Error("Can't add effect to disconnected channel");const i=this.context.createGain();i.gain.value=n;const o="input"in e?e.input:e,s=Ut([I(this,Me),i,o]);(r=I(this,Ce))!=null||te(this,Ce,[]),I(this,Ce).push({name:t,mix:i,disconnect:s})}sendEffect(t,e){var n;if(I(this,Ae))throw Error("Can't send effect to disconnected channel");const r=(n=I(this,Ce))==null?void 0:n.find(i=>i.name===t);r?r.mix.gain.value=e:console.warn("Send bus not found: "+t)}disconnect(){var t;I(this,Ae)||(te(this,Ae,!0),I(this,Je).call(this),I(this,St).call(this),(t=I(this,Ce))==null||t.forEach(e=>e.disconnect()),te(this,Ce,void 0))}};Me=new WeakMap;Ce=new WeakMap;qe=new WeakMap;Je=new WeakMap;St=new WeakMap;De=new WeakMap;Ae=new WeakMap;var ve,ys=class{constructor(t){this.compare=t,me(this,ve,[])}push(t){const e=I(this,ve).length;let n=0,r=e-1,i=e;for(;n<=r;){const o=Math.floor((n+r)/2);this.compare(t,I(this,ve)[o])<0?(i=o,r=o-1):n=o+1}I(this,ve).splice(i,0,t)}pop(){return I(this,ve).shift()}peek(){return I(this,ve)[0]}removeAll(t){const e=I(this,ve).length;return te(this,ve,I(this,ve).filter(n=>!t(n))),I(this,ve).length!==e}clear(){te(this,ve,[])}size(){return I(this,ve).length}};ve=new WeakMap;function Cn(t,e){return t&&e?n=>{t(n),e(n)}:t??e}function vs(t){var e,n,r;const i={disableScheduler:(e=t.disableScheduler)!=null?e:!1,scheduleLookaheadMs:(n=t.scheduleLookaheadMs)!=null?n:200,scheduleIntervalMs:(r=t.scheduleIntervalMs)!=null?r:50,onStart:t.onStart,onEnded:t.onEnded};if(i.scheduleLookaheadMs<1)throw Error("scheduleLookaheadMs must be greater than 0");if(i.scheduleIntervalMs<1)throw Error("scheduleIntervalMs must be greater than 0");if(i.scheduleLookaheadMs<i.scheduleIntervalMs)throw Error("scheduleLookaheadMs must be greater than scheduleIntervalMs");return i}var xe,_e,Ne,gs=class{constructor(t,e={}){me(this,xe),me(this,_e),me(this,Ne),te(this,xe,vs(e)),te(this,_e,new ys((n,r)=>n.time-r.time)),this.player=t}get context(){return this.player.context}get buffers(){return this.player.buffers}get isRunning(){return I(this,Ne)!==void 0}start(t){var e;if(I(this,xe).disableScheduler)return this.player.start(t);const n=this.player.context,r=n.currentTime,i=(e=t.time)!=null?e:r,o=I(this,xe).scheduleLookaheadMs/1e3;return t.onStart=Cn(t.onStart,I(this,xe).onStart),t.onEnded=Cn(t.onEnded,I(this,xe).onEnded),i<r+o?this.player.start(t):(I(this,_e).push(Tt(xt({},t),{time:i})),I(this,Ne)||te(this,Ne,setInterval(()=>{const s=n.currentTime+o;for(;I(this,_e).size()&&I(this,_e).peek().time<=s;){const c=I(this,_e).pop();c&&this.player.start(c)}I(this,_e).size()||(clearInterval(I(this,Ne)),te(this,Ne,void 0))},I(this,xe).scheduleIntervalMs)),s=>{!s||s<i?I(this,_e).removeAll(c=>c===t)||this.player.stop(Tt(xt({},t),{time:s})):this.player.stop(Tt(xt({},t),{time:s}))})}stop(t){var e;if(I(this,xe).disableScheduler)return this.player.stop(t);if(this.player.stop(t),!t){I(this,_e).clear();return}const n=(e=t==null?void 0:t.time)!=null?e:0,r=t==null?void 0:t.stopId;r?I(this,_e).removeAll(i=>i.time>=n&&i.stopId?i.stopId===r:i.note===r):I(this,_e).removeAll(i=>i.time>=n)}disconnect(){this.player.disconnect()}};xe=new WeakMap;_e=new WeakMap;Ne=new WeakMap;var ct,Xe,lt,_s=class{constructor(t,e){this.context=t,this.options=e,me(this,ct),me(this,Xe,!1),me(this,lt);var n,r;te(this,ct,{velocityToGain:(n=e.velocityToGain)!=null?n:Yn,destination:(r=e.destination)!=null?r:t.destination}),this.buffers={},te(this,lt,hs())}start(t){var e,n,r,i,o,s,c,u,a,d,f,l,h,p;if(I(this,Xe))throw new Error("Can't start a sample on disconnected player");const m=this.context,y=t.name&&this.buffers[t.name]||this.buffers[t.note];if(!y)return console.warn(`Sample not found: '${t.note}'`),()=>{};const _=m.createBufferSource();_.buffer=y;const P=(n=(e=t.detune)!=null?e:this.options.detune)!=null?n:0;_.detune?_.detune.value=P:_.playbackRate&&(_.playbackRate.value=Math.pow(2,P/1200));const V=(r=t.lpfCutoffHz)!=null?r:this.options.lpfCutoffHz,w=V?m.createBiquadFilter():void 0;V&&w&&(w.type="lowpass",w.frequency.value=V);const T=m.createGain(),O=(o=(i=t.velocity)!=null?i:this.options.velocity)!=null?o:100;T.gain.value=I(this,ct).velocityToGain(O),((s=t.loop)!=null?s:this.options.loop)&&(_.loop=!0,_.loopStart=(c=t.loopStart)!=null?c:0,_.loopEnd=(u=t.loopEnd)!=null?u:y.duration);const $=(a=t.decayTime)!=null?a:this.options.decayTime,[F,oe]=bs(m,$);function J(H){if(H??(H=m.currentTime),H<=fe)_.stop(H);else{const ae=oe(H);_.stop(ae)}}const D=t.gainOffset?m.createGain():void 0;D&&t.gainOffset&&(D.gain.value=t.gainOffset);const Q=(d=t.stopId)!=null?d:t.note,K=ds([Ut([_,w,T,F,D,I(this,ct).destination]),(f=t.stop)==null?void 0:f.call(t,J),I(this,lt).subscribe(H=>{(!H||H.stopId===void 0||H.stopId===Q)&&J(H==null?void 0:H.time)})]);_.onended=()=>{var H;K(),(H=t.onEnded)==null||H.call(t,t)},(l=t.onStart)==null||l.call(t,t);const fe=Math.max((h=t.time)!=null?h:0,m.currentTime);_.start(t.time);let G=(p=t.duration)!=null?p:y.duration;return typeof t.duration=="number"&&J(fe+G),J}stop(t){I(this,lt).trigger(t)}disconnect(){I(this,Xe)||(te(this,Xe,!0),this.stop(),Object.keys(this.buffers).forEach(t=>{delete this.buffers[t]}))}get connected(){return!I(this,Xe)}};ct=new WeakMap;Xe=new WeakMap;lt=new WeakMap;function bs(t,e=.2){let n=0;const r=t.createGain();r.gain.value=1;function i(o){if(n)return n;r.gain.cancelScheduledValues(o);const s=o||t.currentTime;return n=s+e,r.gain.setValueAtTime(1,s),r.gain.linearRampToValueAtTime(0,n),n}return[r,i]}var ws=class{constructor(t,e){this.context=t;const n=new ms(t,e);this.player=new gs(new _s(t,Tt(xt({},e),{destination:n.input})),e),this.output=n}get buffers(){return this.player.buffers}start(t){return this.player.start(t)}stop(t){this.player.stop(typeof t=="object"?t:t!==void 0?{stopId:t}:void 0)}disconnect(){this.output.disconnect(),this.player.disconnect()}};function ks(t){if(typeof document>"u")return null;const e=document.createElement("audio");for(let n=0;n<t.length;n++){const r=t[n],i=e.canPlayType(`audio/${r}`);if(i==="probably"||i==="maybe")return r;if(r==="m4a"){const o=e.canPlayType("audio/aac");if(o==="probably"||o==="maybe")return r}}return null}var Is={fetch(t){return fetch(t)}};function xs(t){const n=/^([a-gA-G]?)(#{1,}|b{1,}|)(-?\d+)$/.exec(t);if(!n)return;const r=n[1].toUpperCase();if(!r)return;const i=n[2],o=i[0]==="b"?-i.length:i.length,s=n[3]?+n[3]:4,c=(r.charCodeAt(0)+3)%7;return[0,2,4,5,7,9,11][c]+o+12*(s+1)}function en(t){return t===void 0?void 0:typeof t=="number"?t:xs(t)}function Ts(){return{regions:[]}}function Us(t,e,n,r){const i=en(e.note);if(i!==void 0)for(const o of t.regions){const s=Ss(i,0,e,o,r);if(s)return s}}function Ss(t,e,n,r,i){var o,s,c,u,a,d,f,l,h,p,m,y,_,P,V,w,T,O,B,$,F,oe,J,D,Q,K,fe,G;if(!(t>=((o=r.midiLow)!=null?o:0)&&t<((s=r.midiHigh)!=null?s:127)+1)||!(n.velocity===void 0||n.velocity>=((c=r.velLow)!=null?c:0)&&n.velocity<=((u=r.velHigh)!=null?u:127)))return;if(r.seqLength){const z=e%r.seqLength,ge=((a=r.seqPosition)!=null?a:1)-1;if(z!==ge)return}const he=t-r.midiPitch,ie=(d=n.velocity)!=null?d:i==null?void 0:i.velocity,le=r.volume?ps(r.volume):0,be=(l=(f=n.gainOffset)!=null?f:i==null?void 0:i.gainOffset)!=null?l:0,ue=(h=n.detune)!=null?h:0;return{decayTime:(y=(m=n==null?void 0:n.decayTime)!=null?m:(p=r.sample)==null?void 0:p.decayTime)!=null?y:i==null?void 0:i.decayTime,detune:100*(he+((_=r.tune)!=null?_:0))+ue,duration:(w=(V=n==null?void 0:n.duration)!=null?V:(P=r.sample)==null?void 0:P.duration)!=null?w:i==null?void 0:i.duration,gainOffset:be+le||void 0,loop:(B=(O=n==null?void 0:n.loop)!=null?O:(T=r.sample)==null?void 0:T.loop)!=null?B:i==null?void 0:i.loop,loopEnd:(oe=(F=n==null?void 0:n.loopEnd)!=null?F:($=r.sample)==null?void 0:$.loopEnd)!=null?oe:i==null?void 0:i.loopEnd,loopStart:(Q=(D=n==null?void 0:n.loopStart)!=null?D:(J=r.sample)==null?void 0:J.loopStart)!=null?Q:i==null?void 0:i.loopStart,lpfCutoffHz:(G=(fe=n==null?void 0:n.lpfCutoffHz)!=null?fe:(K=r.sample)==null?void 0:K.lpfCutoffHz)!=null?G:i==null?void 0:i.lpfCutoffHz,name:r.sampleName,note:t,onEnded:n.onEnded,onStart:n.onStart,stopId:n.name,time:n.time,velocity:ie??void 0}}function Cs(t){if(t.length===0)return[];if(t.sort((e,n)=>e.midiPitch-n.midiPitch),t[0].midiLow=0,t[0].midiHigh=127,t.length===1)return t;for(let e=1;e<t.length;e++){const n=t[e-1],r=t[e],i=Math.floor((n.midiPitch+r.midiPitch)/2);n.midiHigh=i,r.midiLow=i+1}return t[t.length-1].midiHigh=127,t}function Ps(t,e){var n;const r=(n=ks(["ogg","mp3"]))!=null?n:"mp3";return`https://gleitz.github.io/midi-js-soundfonts/${e}/${t}-${r}.js`}function Es(t,e,n){return(r,i)=>mt(this,null,function*(){const o=yield(yield i.fetch(t)).text(),s=Ms(o),c=Object.keys(s);yield Promise.all(c.map(u=>mt(this,null,function*(){const a=en(u);if(!a)return;const d=As(Ds(s[u])),f=yield r.decodeAudioData(d);e[u]=f,n.regions.push({sampleName:u,midiPitch:a})}))),Cs(n.regions)})}function Ms(t){const e=t.indexOf("MIDI.Soundfont.");if(e<0)throw Error("Invalid MIDI.js Soundfont format");const n=t.indexOf("=",e)+2,r=t.lastIndexOf(",");return JSON.parse(t.slice(n,r)+"}")}function Ds(t){return t.slice(t.indexOf(",")+1)}function As(t){const e=window.atob(t),n=e.length,r=new Uint8Array(n);for(let i=0;i<n;i++)r[i]=e.charCodeAt(i);return r.buffer}function Ns(t,e){if(!t.startsWith("http"))return`https://goldst.dev/midi-js-soundfonts/${e}/${t}-loop.json`}function Os(t,e=44100){return mt(this,null,function*(){if(t)try{const n=yield fetch(t);if(n.status!==200)return;const r=yield n.json(),i={};return Object.keys(r).forEach(o=>{const s=en(o);if(s){const c=r[o];i[s]=[c[0]/e,c[1]/e]}}),i}catch{return}})}var ut,Bs=class{constructor(t,e){this.context=t,me(this,ut),this.config=Ls(e),this.player=new ws(t,e),this.group=Ts(),te(this,ut,!1);const n=Fs(this.config.instrumentUrl,this.config.loopDataUrl,this.player.buffers,this.group);this.load=n(t,this.config.storage).then(i=>(te(this,ut,i),this));const r=t.createGain();r.gain.value=this.config.extraGain,this.player.output.addInsert(r)}get output(){return this.player.output}get hasLoops(){return I(this,ut)}loaded(){return mt(this,null,function*(){return console.warn("deprecated: use load instead"),this.load})}disconnect(){this.player.disconnect()}start(t){const e=Us(this.group,typeof t=="object"?t:{note:t});return e?this.player.start(e):()=>{}}stop(t){return this.player.stop(t)}};ut=new WeakMap;function Fs(t,e,n,r){const i=Es(t,n,r);return(o,s)=>mt(this,null,function*(){const[c,u]=yield Promise.all([i(o,s),Os(e)]);return u&&r.regions.forEach(a=>{var d;const f=u[a.midiPitch];f&&((d=a.sample)!=null||(a.sample={}),a.sample.loop=!0,a.sample.loopStart=f[0],a.sample.loopEnd=f[1])}),!!u})}function Ls(t){var e,n,r,i;if(!t.instrument&&!t.instrumentUrl)throw Error("Soundfont: instrument or instrumentUrl is required");const o={kit:"MusyngKite",instrument:t.instrument,storage:(e=t.storage)!=null?e:Is,extraGain:(n=t.extraGain)!=null?n:5,loadLoopData:(r=t.loadLoopData)!=null?r:!1,loopDataUrl:t.loopDataUrl,instrumentUrl:(i=t.instrumentUrl)!=null?i:""};return o.instrument&&o.instrument.startsWith("http")&&(console.warn("Use 'instrumentUrl' instead of 'instrument' to load from a URL"),o.instrumentUrl=o.instrument,o.instrument=void 0),o.instrument&&!o.instrumentUrl&&(o.instrumentUrl=Ps(o.instrument,o.kit)),o.loadLoopData&&o.instrument&&!o.loopDataUrl&&(o.loopDataUrl=Ns(o.instrument,o.kit)),o}const Qn=window.AudioContext||window.webkitAudioContext,zs=new Qn;Qn||alert("Your browser does not seem to support the Web Audio API!");const Wt={};class Kt{constructor(e){M(this,"stopAudioMap",new Map);M(this,"instrument");M(this,"instrumentName");M(this,"colorHue");M(this,"socketID");this.colorHue=e.color_hue,this.socketID=e.id,this.setInstrument(e.instrument_name)}async setInstrument(e){return Wt[e]||(Wt[e]=new Bs(zs,{instrument:e})),this.instrumentName=e,this.instrument=Wt[e],this.instrument.output.setVolume(127),this.instrument.load}stopAudio(e){const n=this.stopAudioMap.get(e);n&&(n(),this.stopAudioMap.delete(e))}playAudio(e,n){this.instrument&&(this.stopAudio(e),this.stopAudioMap.set(e,this.instrument.start({note:e,velocity:Math.min(n*20,127)})))}}var Rs={BASE_URL:"./",DEV:!1,MODE:"production",PROD:!0,SSR:!1,VITE_BACKEND_HOST:"piano-backend.onrender.com"};class Hs{constructor(){M(this,"connecting",se(!1));M(this,"connectError",se(""));M(this,"connectedColorHues",se(new Map));M(this,"connected",se(!1));M(this,"clientMap",new Map);M(this,"localClient",new Kt({color_hue:220,id:0,instrument_name:"acoustic_grand_piano"}));M(this,"socket",null);M(this,"onPlayNote");M(this,"onStopNote")}connect(e,n=6){if(e.length>100)return this.connectError.set("Room name to long!");const r="piano-backend.onrender.com",i=location.protocol==="https:"?"wss":"ws",o=Rs.VITE_BACKEND_PATH??"",s=`room_name=${e}&instrument_name=${this.localClient.instrumentName}`;this.socket=new WebSocket(`${i}://${r}/${o}?${s}`),this.socket.binaryType="arraybuffer",this.socket.onopen=()=>{console.log("Connected to websocket"),this.connecting.set(!1),this.connected.set(!0),history.replaceState({},"",`?room=${e}`),document.title=`Room ${e} - Play Piano!`},this.socket.onclose=()=>{history.replaceState({},"",location.pathname),document.title="Play Piano!",this.clean(),this.connected.set(!1),ee(this.connectError)||(console.log("Trying to reconnect"),this.connect(e))},this.socket.onerror=()=>{console.log(`Failed to connect, reconnecting ${n} attempts left`),setTimeout(()=>{n==0?(this.connectError.set("Failed to connect to websocket server"),this.disconnect()):this.connect(e,n-1)},1e3)},this.socket.onmessage=async c=>{if(c.data instanceof ArrayBuffer){const u=ss(new Uint8Array(c.data));u&&this.handleMessage(u)}},this.connectError.set(""),this.connecting.set(!0)}disconnect(){this.connected.set(!1),this.connecting.set(!1),this.socket&&this.socket.close()}playNote(e,n){this.onPlayNote(e,n,this.localClient),this.sendMessage({type:"Play",note:e,volume:n})}stopNote(e,n){this.onStopNote(e,n,this.localClient),this.sendMessage({type:"Stop",note:e,sustain:n})}async changeInstrument(e){this.sendMessage({type:"InstrumentChange",instrument_name:e}),await this.localClient.setInstrument(e)}handleMessage(e){switch(e.type){case"Error":this.connectError.set(e.error);break;case"Relay":this.handleRelayMessage(e.msg,e.id);break;case"ClientConnect":this.addClient(new Kt(e));break;case"ReceiveInfo":{for(const i of e.client_list)this.addClient(new Kt(i));const r=e.created_client;this.localClient.colorHue=r.color_hue,this.localClient.socketID=e.created_client.id,this.addClient(this.localClient);break}case"ClientDisconnect":this.connectedColorHues.update(r=>(r.delete(e.id),r));const n=this.getClient(e.id);n&&(this.cleanClient(n),this.clientMap.delete(e.id));break}}handleRelayMessage(e,n){switch(e.type){case"Play":this.onPlayNote(e.note,e.volume,this.getClient(n));break;case"Stop":this.onStopNote(e.note,e.sustain,this.getClient(n));break;case"InstrumentChange":this.getClient(n).setInstrument(e.instrument_name);break}}getClient(e){return this.clientMap.get(e)}sendMessage(e){this.clientMap.size!=1&&this.socket&&ee(this.connected)&&this.socket.send(Xi(e))}addClient(e){this.connectedColorHues.update(n=>(n.set(e.socketID,e.colorHue),n)),this.clientMap.set(e.socketID,e)}clean(){for(const e of this.clientMap.values())this.cleanClient(e);this.socket=null,this.clientMap.clear(),this.localClient.colorHue=220,this.localClient.socketID=0,this.connectedColorHues.update(e=>(e.clear(),e))}cleanClient(e){for(const n of e.stopAudioMap.keys())this.onStopNote(n,!1,e)}}function Pn(t,e,n){const r=t.slice();return r[14]=e[n][0],r[15]=e[n][1],r}function Vs(t){let e,n,r,i;return{c(){e=b("button"),n=ne("Join"),e.disabled=t[3]},m(o,s){N(o,e,s),v(e,n),r||(i=C(e,"click",t[13]),r=!0)},p(o,s){s&8&&(e.disabled=o[3])},d(o){o&&A(e),r=!1,i()}}}function Ws(t){let e,n,r,i,o,s,c,u,a,d,f=Ie(Array.from(t[4].entries())),l=[];for(let h=0;h<f.length;h+=1)l[h]=Mn(Pn(t,f,h));return{c(){e=b("button"),e.textContent="Leave",n=E(),r=b("span"),r.textContent="Connected!",i=b("br"),o=E(),s=b("span"),s.textContent="People:",c=E();for(let h=0;h<l.length;h+=1)l[h].c();u=Bn()},m(h,p){N(h,e,p),N(h,n,p),N(h,r,p),N(h,i,p),N(h,o,p),N(h,s,p),N(h,c,p);for(let m=0;m<l.length;m+=1)l[m]&&l[m].m(h,p);N(h,u,p),a||(d=C(e,"click",t[12]),a=!0)},p(h,p){if(p&17){f=Ie(Array.from(h[4].entries()));let m;for(m=0;m<f.length;m+=1){const y=Pn(h,f,m);l[m]?l[m].p(y,p):(l[m]=Mn(y),l[m].c(),l[m].m(u.parentNode,u))}for(;m<l.length;m+=1)l[m].d(1);l.length=f.length}},d(h){h&&(A(e),A(n),A(r),A(i),A(o),A(s),A(c),A(u)),ht(l,h),a=!1,d()}}}function En(t){let e;return{c(){e=b("span"),e.textContent="(you)",Be(e,"margin-right","0.5rem")},m(n,r){N(n,e,r)},d(n){n&&A(e)}}}function Mn(t){let e,n,r,i,o=t[14]===t[0].localClient.socketID&&En();return{c(){e=b("div"),r=E(),o&&o.c(),i=Bn(),k(e,"class","icon svelte-ye3hvw"),k(e,"style",n=`--color-hue: ${t[15]}`)},m(s,c){N(s,e,c),N(s,r,c),o&&o.m(s,c),N(s,i,c)},p(s,c){c&16&&n!==(n=`--color-hue: ${s[15]}`)&&k(e,"style",n),s[14]===s[0].localClient.socketID?o||(o=En(),o.c(),o.m(i.parentNode,i)):o&&(o.d(1),o=null)},d(s){s&&(A(e),A(r),A(i)),o&&o.d(s)}}}function Ks(t){let e,n,r,i;return{c(){e=b("span"),e.textContent="Connecting...",n=E(),r=b("img"),Nn(r.src,i=Hn)||k(r,"src",i),k(r,"alt","spinner")},m(o,s){N(o,e,s),N(o,n,s),N(o,r,s)},p:X,d(o){o&&(A(e),A(n),A(r))}}}function Gs(t){let e,n;return{c(){e=b("span"),n=ne(t[5]),k(e,"class","error svelte-ye3hvw")},m(r,i){N(r,e,i),v(e,n)},p(r,i){i&32&&ze(n,r[5])},d(r){r&&A(e)}}}function qs(t){let e,n,r,i,o,s,c,u;function a(m,y){return m[2]?Ws:Vs}let d=a(t),f=d(t);function l(m,y){if(m[5])return Gs;if(m[3])return Ks}let h=l(t),p=h&&h(t);return{c(){e=b("div"),n=b("p"),n.textContent="Join a room:",r=E(),i=b("input"),o=E(),f.c(),s=E(),p&&p.c(),k(i,"type","text"),k(i,"placeholder","Room name")},m(m,y){N(m,e,y),v(e,n),v(e,r),v(e,i),Z(i,t[1]),v(e,o),f.m(e,null),v(e,s),p&&p.m(e,null),c||(u=[C(i,"input",t[10]),C(i,"keydown",t[11])],c=!0)},p(m,[y]){y&2&&i.value!==m[1]&&Z(i,m[1]),d===(d=a(m))&&f?f.p(m,y):(f.d(1),f=d(m),f&&(f.c(),f.m(e,s))),h===(h=l(m))&&p?p.p(m,y):(p&&p.d(1),p=h&&h(m),p&&(p.c(),p.m(e,null)))},i:X,o:X,d(m){m&&A(e),f.d(),p&&p.d(),c=!1,we(u)}}}function Js(t,e,n){let r,i,o,s,{socketPlayer:c}=e,u="",{connected:a,connecting:d,connectError:f,connectedColorHues:l}=c;Y(t,a,_=>n(2,r=_)),Y(t,d,_=>n(3,i=_)),Y(t,f,_=>n(5,s=_)),Y(t,l,_=>n(4,o=_)),Fn(()=>{const P=new URLSearchParams(location.search).get("room");P!=null&&(n(1,u=P),c.connect(u))});function h(){u=this.value,n(1,u)}const p=_=>{_.code==="Enter"&&!r&&!i&&c.connect(u)},m=()=>c.disconnect(),y=()=>c.connect(u);return t.$$set=_=>{"socketPlayer"in _&&n(0,c=_.socketPlayer)},[c,u,r,i,o,s,a,d,f,l,h,p,m,y]}class Xs extends rt{constructor(e){super(),nt(this,e,Js,qs,He,{socketPlayer:0})}}function Ys(t){let e,n,r,i,o,s,c,u;return r=new bi({props:{pianoControlsData:t[0],socketPlayer:t[2]}}),o=new di({props:{midiPlayer:t[1]}}),c=new Xs({props:{socketPlayer:t[2]}}),{c(){e=b("div"),n=b("div"),ft(r.$$.fragment),i=E(),ft(o.$$.fragment),s=E(),ft(c.$$.fragment),k(n,"class","row svelte-b9289n"),k(e,"class","control-panel svelte-b9289n")},m(a,d){N(a,e,d),v(e,n),je(r,n,null),v(n,i),je(o,n,null),v(e,s),je(c,e,null),u=!0},p(a,[d]){const f={};d&1&&(f.pianoControlsData=a[0]),d&4&&(f.socketPlayer=a[2]),r.$set(f);const l={};d&2&&(l.midiPlayer=a[1]),o.$set(l);const h={};d&4&&(h.socketPlayer=a[2]),c.$set(h)},i(a){u||(Le(r.$$.fragment,a),Le(o.$$.fragment,a),Le(c.$$.fragment,a),u=!0)},o(a){$e(r.$$.fragment,a),$e(o.$$.fragment,a),$e(c.$$.fragment,a),u=!1},d(a){a&&A(e),et(r),et(o),et(c)}}}function Qs(t,e,n){let{pianoControlsData:r}=e,{midiPlayer:i}=e,{socketPlayer:o}=e;return t.$$set=s=>{"pianoControlsData"in s&&n(0,r=s.pianoControlsData),"midiPlayer"in s&&n(1,i=s.midiPlayer),"socketPlayer"in s&&n(2,o=s.socketPlayer)},[r,i,o]}class Zs extends rt{constructor(e){super(),nt(this,e,Qs,Ys,He,{pianoControlsData:0,midiPlayer:1,socketPlayer:2})}}function $s(t){let e,n,r,i,o;return n=new Zs({props:{pianoControlsData:t[0],midiPlayer:t[1],socketPlayer:t[2]}}),i=new oi({props:{pianoControlsData:t[0],midiPlayer:t[1],socketPlayer:t[2]}}),{c(){e=b("main"),ft(n.$$.fragment),r=E(),ft(i.$$.fragment)},m(s,c){N(s,e,c),je(n,e,null),v(e,r),je(i,e,null),o=!0},p:X,i(s){o||(Le(n.$$.fragment,s),Le(i.$$.fragment,s),o=!0)},o(s){$e(n.$$.fragment,s),$e(i.$$.fragment,s),o=!1},d(s){s&&A(e),et(n),et(i)}}}function js(t){const e=new gi,n=new ti,r=new Hs;return nr(()=>{n.stop()}),[e,n,r]}class eo extends rt{constructor(e){super(),nt(this,e,js,$s,He,{})}}new eo({target:document.body});

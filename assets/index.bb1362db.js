import{g as x,w as j,M as ln,l as sn,a as an,S as Xe,i as Ze,s as $e,e as d,t as se,b as K,c as i,n as D,d as P,h as Le,f as y,j as h,k as rn,m as xe,o as L,p as qt,q as k,r as cn,u as ie,v as et,x as un,y as tt,z as nt,A as q,B as _n,C as R,D as pn,E as ot,F as Re,G as fn,H as dn,I as hn,J as zt,K as Lt,L as Rt,N as Ht,O as Gt}from"./vendor.90408fa6.js";const mn=function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const l of document.querySelectorAll('link[rel="modulepreload"]'))o(l);new MutationObserver(l=>{for(const s of l)if(s.type==="childList")for(const a of s.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&o(a)}).observe(document,{childList:!0,subtree:!0});function n(l){const s={};return l.integrity&&(s.integrity=l.integrity),l.referrerpolicy&&(s.referrerPolicy=l.referrerpolicy),l.crossorigin==="use-credentials"?s.credentials="include":l.crossorigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function o(l){if(l.ep)return;l.ep=!0;const s=n(l);fetch(l.href,s)}};mn();const jt=["accordion","acoustic_bass","acoustic_grand_piano","acoustic_guitar_nylon","acoustic_guitar_steel","agogo","alto_sax","applause","bagpipe","banjo","baritone_sax","bassoon","bird_tweet","blown_bottle","brass_section","breath_noise","bright_acoustic_piano","celesta","cello","choir_aahs","church_organ","clarinet","clavinet","contrabass","distortion_guitar","drawbar_organ","dulcimer","electric_bass_finger","electric_bass_pick","electric_grand_piano","electric_guitar_clean","electric_guitar_jazz","electric_guitar_muted","electric_piano_1","electric_piano_2","english_horn","fiddle","flute","french_horn","fretless_bass","fx_1_rain","fx_2_soundtrack","fx_3_crystal","fx_4_atmosphere","fx_5_brightness","fx_6_goblins","fx_7_echoes","fx_8_scifi","glockenspiel","guitar_fret_noise","guitar_harmonics","gunshot","harmonica","harpsichord","helicopter","honkytonk_piano","kalimba","koto","lead_1_square","lead_2_sawtooth","lead_3_calliope","lead_4_chiff","lead_5_charang","lead_6_voice","lead_7_fifths","lead_8_bass__lead","marimba","melodic_tom","music_box","muted_trumpet","oboe","ocarina","orchestra_hit","orchestral_harp","overdriven_guitar","pad_1_new_age","pad_2_warm","pad_3_polysynth","pad_4_choir","pad_5_bowed","pad_6_metallic","pad_7_halo","pad_8_sweep","pan_flute","percussive_organ","piccolo","pizzicato_strings","recorder","reed_organ","reverse_cymbal","rock_organ","seashore","shakuhachi","shamisen","shanai","sitar","slap_bass_1","slap_bass_2","soprano_sax","steel_drums","string_ensemble_1","string_ensemble_2","synth_bass_1","synth_bass_2","synth_brass_1","synth_brass_2","synth_choir","synth_drum","synth_strings_1","synth_strings_2","taiko_drum","tango_accordion","telephone_ring","tenor_sax","timpani","tinkle_bell","tremolo_strings","trombone","trumpet","tuba","tubular_bells","vibraphone","viola","violin","voice_oohs","whistle","woodblock","xylophone"],Ce=["C","C#","D","D#","E","F","F#","G","G#","A","A#","B"],Jt={Backquote:"A#2",Tab:"B2",KeyQ:"C3",Digit2:"C#3",KeyW:"D3",Digit3:"D#3",KeyE:"E3",KeyR:"F3",Digit5:"F#3",KeyT:"G3",Digit6:"G#3",KeyY:"A3",Digit7:"A#3",KeyU:"B3",KeyI:"C4",Digit9:"C#4",KeyO:"D4",Digit0:"D#4",KeyP:"E4",BracketLeft:"F4",Equal:"F#4",BracketRight:"G4",Backspace:"G#4",Backslash:"A4",CapsLock:"A#4",ShiftLeft:"B4",KeyZ:"C5",KeyS:"C#5",KeyX:"D5",KeyD:"D#5",KeyC:"E5",KeyV:"F5",KeyG:"F#5",KeyB:"G5",KeyH:"G#5",KeyN:"A5",KeyJ:"A#5",KeyM:"B5",Comma:"C6",KeyL:"C#6",Period:"D6",Semicolon:"D#6",Slash:"E6",ShiftRight:"F6",Enter:"F#6"};function lt(e){return parseInt(e.charAt(e.length-1))}function st(e){return e.substring(0,e.length-1)}function it(e){const t=Math.floor(e/12)-1;return Ce[e%12]+t}function bn(e,t){const n=lt(t),o=lt(e),l=Ce.indexOf(st(e)),s=Ce.indexOf(st(t)),a={};let _=0;for(let p=o;p<=n;p++){let c=p===o?l:0;for(;c<Ce.length&&!(p===n&&c>s);){const f=Ce[c],g=f.length===1;a[f+p]={white:g,pressedColor:null,ghost:!1},g&&_++,c++}}return{noteMap:a,whiteKeys:_}}const J=j(!1),me=j(0),He=j(0),at=j(),Ne=j(1);async function gn(e,t){let n=[],o=null;function l(c){o=new ln(c),o.tracks=o.tracks.filter(f=>f.notes.length!==0);let r=0;o.tracks.forEach(f=>{const g=f.notes[f.notes.length-1],C=g.time+g.duration;C>r&&(r=C)}),He.set(r)}at.subscribe(c=>{if(J.set(!1),He.set(0),me.set(0),!c){o=null;return}const r=new FileReader;r.onload=()=>l(r.result),r.readAsArrayBuffer(c)});function s(c){const r=x(me)+c;me.set(r),o.tracks.forEach((f,g)=>{const C=f.notes[n[g]];if(!C)return;r-C.time>0&&(e(C.name,C.velocity),setTimeout(()=>t(C.name),C.duration*1e3/x(Ne)),n[g]++)}),r>x(He)&&J.set(!1)}J.subscribe(c=>{if(!c)return;if(!o)return J.set(!1),alert("No MIDI file selected!");o.tracks.forEach((g,C)=>{let w=0,S=g.notes.length-1;for(;w!=S;){const E=Math.ceil((w+S)/2);g.notes[E].time>x(me)?S=E-1:w=E}n[C]=w});let r=performance.now();const f=()=>{if(!x(J))return;const g=performance.now(),C=g-r;r=g,s(C/1e3*x(Ne)),requestAnimationFrame(f)};f()});function a(c){const[r,f,g]=c.data;r>143&&r<160?g==0?t(it(f)):e(it(f),g/127):r>127&&r<144&&t(it(f))}let _=await navigator.requestMIDIAccess();function p(){_.inputs.forEach(c=>{c.onmidimessage=a})}p(),_.onstatechange=()=>{p()}}const Wt=window.AudioContext||window.webkitAudioContext;Wt||alert("Your browser does not seem to support the Web Audio API!");const vn=new Wt,rt={};function Ut(e){return rt[e]||(rt[e]=sn.exports.instrument(vn,e)),rt[e]}const Qt=j(),Ge=j("acoustic_grand_piano"),ue=j(null),ae=new Map,je={audioNodeMap:new Map,colorHue:"220"};ae.set("0",je);let A,ct,ut;async function _t(e,t){let n=await Ut(e),o=ae.get(t);o&&(o.instrument=n)}function Vt({socketID:e,colorHue:t,instrumentName:n}){ae.set(e,{audioNodeMap:e===A.id?je.audioNodeMap:new Map,colorHue:t}),x(ue)!==null&&ue.set(x(ue).set(e,t)),n&&_t(n,e)}function yn(e,t){ct=e,ut=t}function pt(e){const t=new Promise((n,o)=>{A=an("https://calbabreaker-piano-backend.herokuapp.com",{query:{roomName:e,instrumentName:x(Ge)},path:{}.VITE_BACKEND_PATH}),A.on("connect_error",()=>o("Failed to connect to server!")),A.on("connect_timeout",()=>o("Timed out while connecting to server!")),A.on("connect",()=>{ae.delete("0"),ue.set(new Map),n(),history.replaceState({},`Play Piano! - ${e}`,`?room=${e}`)}),A.on("disconnect",()=>{ue.set(null),ae.clear(),ae.set("0",je),A=null,history.replaceState({},"Play Piano!",location.pathname)}),A.on("play_note",s=>{ct(s)}),A.on("stop_note",s=>{ut(s)}),A.on("instrument_change",s=>{const{instrumentName:a,socketID:_}=s;_t(a,_)}),A.on("client_connect",s=>{Vt(s)}),A.on("client_list_recieve",s=>{const a=s;for(let _ of a)Vt(_)}),A.on("client_disconnect",s=>{const a=x(ue);a.delete(s),ue.set(a),ae.delete(s)})});Qt.set(t)}function kn(e,t){const n={note:e,volume:t};A?A.emit("play_note",n):ct(n)}function ft(e,t){const n={note:e,sustain:t};A?A.emit("stop_note",n):ut(n)}Ge.subscribe(e=>{A?A.emit("instrument_change",{instrumentName:e}):_t(e,"0")});const{window:wn}=_n;function Yt(e,t,n){const o=e.slice();return o[37]=t[n][0],o[38]=t[n][1],o}function Xt(e,t,n){const o=e.slice();return o[42]=t[n],o}function Zt(e){let t,n=e[42]+"",o,l;return{c(){t=d("option"),o=se(n),t.__value=l=e[42],t.value=t.__value},m(s,a){K(s,t,a),i(t,o)},p:D,d(s){s&&P(t)}}}function Cn(e){return{c:D,m:D,d:D}}function Nn(e){return{c:D,m:D,d:D}}function Kn(e){let t;return{c(){t=se("loading...")},m(n,o){K(n,t,o)},d(n){n&&P(t)}}}function Pn(e){let t,n,o;return{c(){t=d("button"),t.textContent="Play"},m(l,s){K(l,t,s),n||(o=k(t,"click",e[23]),n=!0)},p:D,d(l){l&&P(t),n=!1,o()}}}function An(e){let t,n,o;return{c(){t=d("button"),t.textContent="Pause"},m(l,s){K(l,t,s),n||(o=k(t,"click",e[22]),n=!0)},p:D,d(l){l&&P(t),n=!1,o()}}}function Dn(e){let t,n,o;return{c(){t=d("button"),t.textContent="Join"},m(l,s){K(l,t,s),n||(o=k(t,"click",e[33]),n=!0)},p:D,d(l){l&&P(t),n=!1,o()}}}function Sn(e){let t,n,o;return{c(){t=d("button"),t.textContent="Leave"},m(l,s){K(l,t,s),n||(o=k(t,"click",e[32]),n=!0)},p:D,d(l){l&&P(t),n=!1,o()}}}function En(e){let t,n=e[41]+"",o;return{c(){t=d("span"),o=se(n),xe(t,"color","#fe3c3c")},m(l,s){K(l,t,s),i(t,o)},p(l,s){s[0]&4096&&n!==(n=l[41]+"")&&et(o,n)},d(l){l&&P(t)}}}function Mn(e){let t,n=e[11]!==null&&$t(e);return{c(){n&&n.c(),t=ot()},m(o,l){n&&n.m(o,l),K(o,t,l)},p(o,l){o[11]!==null?n?n.p(o,l):(n=$t(o),n.c(),n.m(t.parentNode,t)):n&&(n.d(1),n=null)},d(o){n&&n.d(o),o&&P(t)}}}function $t(e){let t,n,o,l,s,a,_=Array.from(e[11].entries()),p=[];for(let c=0;c<_.length;c+=1)p[c]=en(Yt(e,_,c));return{c(){t=d("span"),t.textContent="Connected!",n=d("br"),o=y(),l=d("span"),l.textContent="People:",s=y();for(let c=0;c<p.length;c+=1)p[c].c();a=ot()},m(c,r){K(c,t,r),K(c,n,r),K(c,o,r),K(c,l,r),K(c,s,r);for(let f=0;f<p.length;f+=1)p[f].m(c,r);K(c,a,r)},p(c,r){if(r[0]&2048){_=Array.from(c[11].entries());let f;for(f=0;f<_.length;f+=1){const g=Yt(c,_,f);p[f]?p[f].p(g,r):(p[f]=en(g),p[f].c(),p[f].m(a.parentNode,a))}for(;f<p.length;f+=1)p[f].d(1);p.length=_.length}},d(c){c&&P(t),c&&P(n),c&&P(o),c&&P(l),c&&P(s),tt(p,c),c&&P(a)}}}function xt(e){let t;return{c(){t=d("span"),t.textContent="(you)",xe(t,"margin-right","0.5rem")},m(n,o){K(n,t,o)},d(n){n&&P(t)}}}function en(e){let t,n,o,l,s=e[37]===A.id&&xt();return{c(){t=d("div"),o=y(),s&&s.c(),l=ot(),h(t,"class","icon svelte-tba0vh"),h(t,"style",n=`--color-hue: ${e[38]}`)},m(a,_){K(a,t,_),K(a,o,_),s&&s.m(a,_),K(a,l,_)},p(a,_){_[0]&2048&&n!==(n=`--color-hue: ${a[38]}`)&&h(t,"style",n),a[37]===A.id?s||(s=xt(),s.c(),s.m(l.parentNode,l)):s&&(s.d(1),s=null)},d(a){a&&P(t),a&&P(o),s&&s.d(a),a&&P(l)}}}function Fn(e){let t;return{c(){t=d("span"),t.textContent="Connecting..."},m(n,o){K(n,t,o)},p:D,d(n){n&&P(t)}}}function Tn(e){let t,n,o,l,s,a,_,p,c,r,f,g,C,w,S,E,re,O,pe,F,ye,fe,de,he,be,H,ge,ce,u,b,T,ke,Pe,W,ee,Y,te,ne,oe,Ae,De,Se,Ee,m,v,Me,ht,we,mt,bt,gt,We,Fe,vt,yt,kt,U,wt,le,Ct,Nt,Kt,B,Pt,Te=e[8].toFixed(1)+"",Ue,At,Oe=e[10].toFixed(1)+"",Qe,Dt,St,Et,Q,Ie,Mt,X,Ft,Ve,Be,Ye,Tt,ve=jt,z=[];for(let M=0;M<ve.length;M+=1)z[M]=Zt(Xt(e,ve,M));let V={ctx:e,current:null,token:null,hasCatch:!1,pending:Kn,then:Nn,catch:Cn};Le(ce=e[2],V);function Ot(M,N){return M[7]?An:Pn}let qe=Ot(e),Z=qe(e);function It(M,N){return M[11]!==null?Sn:Dn}let ze=It(e),$=ze(e),G={ctx:e,current:null,token:null,hasCatch:!0,pending:Fn,then:Mn,catch:En,error:41};return Le(Be=e[12],G),{c(){t=d("div"),n=d("div"),o=d("div"),l=d("span"),l.textContent="Sustain (space):",s=y(),a=d("input"),_=y(),p=d("br"),c=y(),r=d("span"),r.textContent="Octave Shift (- ctrl, + alt):",f=y(),g=d("input"),C=y(),w=d("br"),S=y(),E=d("span"),E.textContent="Volume:",re=y(),O=d("input"),pe=y(),F=d("input"),ye=y(),fe=d("br"),de=y(),he=d("span"),he.textContent="Instrument:",be=y(),H=d("select");for(let M=0;M<z.length;M+=1)z[M].c();ge=y(),V.block.c(),u=y(),b=d("br"),T=y(),ke=d("span"),ke.textContent="Size:",Pe=y(),W=d("select"),ee=d("option"),ee.textContent="Full size (88 keys)",Y=d("option"),Y.textContent="Half size (61 keys)",te=d("option"),te.textContent="Quater Size (37 keys)",ne=d("option"),ne.textContent="2 Octaves (24 keys)",oe=d("option"),oe.textContent="1 Octave (12 keys)",Ae=y(),De=d("br"),Se=y(),Ee=d("br"),m=y(),v=d("div"),Me=d("p"),Me.textContent="Play a midi:",ht=y(),we=d("input"),mt=y(),bt=d("br"),gt=y(),Z.c(),We=y(),Fe=d("button"),Fe.textContent="Restart",vt=y(),yt=d("br"),kt=se(`

            Speed: `),U=d("input"),wt=y(),le=d("input"),Ct=se("times"),Nt=d("br"),Kt=y(),B=d("input"),Pt=y(),Ue=se(Te),At=se("/"),Qe=se(Oe),Dt=se(` seconds
            `),St=d("br"),Et=y(),Q=d("div"),Ie=d("p"),Ie.textContent="Join a room:",Mt=y(),X=d("input"),Ft=y(),$.c(),Ve=y(),G.block.c(),h(a,"type","checkbox"),h(a,"class","svelte-tba0vh"),h(g,"type","number"),h(g,"min","-3"),h(g,"max","3"),h(g,"class","svelte-tba0vh"),h(O,"type","range"),h(O,"min","0"),h(O,"max","50"),h(O,"step","0.1"),h(O,"class","svelte-tba0vh"),h(F,"type","number"),h(F,"class","svelte-tba0vh"),e[0]===void 0&&rn(()=>e[19].call(H)),h(ee,"data-range","A0,C8"),ee.__value="Full size (88 keys)",ee.value=ee.__value,h(Y,"data-range","C2,C7"),Y.selected=!0,Y.__value="Half size (61 keys)",Y.value=Y.__value,h(te,"data-range","C3,C6"),te.__value="Quater Size (37 keys)",te.value=te.__value,h(ne,"data-range","C4,B5"),ne.__value="2 Octaves (24 keys)",ne.value=ne.__value,h(oe,"data-range","C4,B4"),oe.__value="1 Octave (12 keys)",oe.value=oe.__value,h(o,"class","svelte-tba0vh"),h(Me,"class","svelte-tba0vh"),h(we,"type","file"),h(we,"class","svelte-tba0vh"),h(U,"type","range"),h(U,"min","0.01"),h(U,"max","4"),h(U,"step","0.01"),h(U,"class","svelte-tba0vh"),h(le,"type","number"),h(le,"min","0.01"),h(le,"class","svelte-tba0vh"),h(B,"type","range"),h(B,"min","0"),h(B,"max",e[10]),h(B,"step","0.1"),xe(B,"width","18rem"),h(B,"class","svelte-tba0vh"),h(v,"class","svelte-tba0vh"),h(n,"class","row svelte-tba0vh"),h(Ie,"class","svelte-tba0vh"),h(X,"type","text"),h(X,"placeholder","Room name"),h(X,"class","svelte-tba0vh"),h(t,"class","control-panel svelte-tba0vh")},m(M,N){K(M,t,N),i(t,n),i(n,o),i(o,l),i(o,s),i(o,a),a.checked=e[4],i(o,_),i(o,p),i(o,c),i(o,r),i(o,f),i(o,g),L(g,e[3]),i(o,C),i(o,w),i(o,S),i(o,E),i(o,re),i(o,O),L(O,e[5]),i(o,pe),i(o,F),L(F,e[5]),i(o,ye),i(o,fe),i(o,de),i(o,he),i(o,be),i(o,H);for(let I=0;I<z.length;I+=1)z[I].m(H,null);qt(H,e[0]),i(o,ge),V.block.m(o,V.anchor=null),V.mount=()=>o,V.anchor=u,i(o,u),i(o,b),i(o,T),i(o,ke),i(o,Pe),i(o,W),i(W,ee),i(W,Y),i(W,te),i(W,ne),i(W,oe),i(o,Ae),i(o,De),i(o,Se),i(o,Ee),i(n,m),i(n,v),i(v,Me),i(v,ht),i(v,we),i(v,mt),i(v,bt),i(v,gt),Z.m(v,null),i(v,We),i(v,Fe),i(v,vt),i(v,yt),i(v,kt),i(v,U),L(U,e[9]),i(v,wt),i(v,le),L(le,e[9]),i(v,Ct),i(v,Nt),i(v,Kt),i(v,B),L(B,e[8]),i(v,Pt),i(v,Ue),i(v,At),i(v,Qe),i(v,Dt),i(v,St),i(t,Et),i(t,Q),i(Q,Ie),i(Q,Mt),i(Q,X),L(X,e[1]),i(Q,Ft),$.m(Q,null),i(Q,Ve),G.block.m(Q,G.anchor=null),G.mount=()=>Q,G.anchor=null,Ye||(Tt=[k(wn,"keydown",e[14]),k(a,"change",e[15]),k(g,"input",e[16]),k(O,"change",e[17]),k(O,"input",e[17]),k(F,"input",e[18]),k(H,"change",e[19]),k(W,"change",e[20]),cn(e[13].call(null,W)),k(we,"change",e[21]),k(Fe,"click",e[24]),k(U,"change",e[25]),k(U,"input",e[25]),k(le,"input",e[26]),k(B,"change",e[27]),k(B,"input",e[27]),k(B,"mousedown",e[28]),k(B,"mouseup",e[29]),k(X,"input",e[30]),k(X,"keydown",e[31])],Ye=!0)},p(M,N){if(e=M,N[0]&16&&(a.checked=e[4]),N[0]&8&&ie(g.value)!==e[3]&&L(g,e[3]),N[0]&32&&L(O,e[5]),N[0]&32&&ie(F.value)!==e[5]&&L(F,e[5]),N&0){ve=jt;let I;for(I=0;I<ve.length;I+=1){const Bt=Xt(e,ve,I);z[I]?z[I].p(Bt,N):(z[I]=Zt(Bt),z[I].c(),z[I].m(H,null))}for(;I<z.length;I+=1)z[I].d(1);z.length=ve.length}N[0]&1&&qt(H,e[0]),V.ctx=e,N[0]&4&&ce!==(ce=e[2])&&Le(ce,V),qe===(qe=Ot(e))&&Z?Z.p(e,N):(Z.d(1),Z=qe(e),Z&&(Z.c(),Z.m(v,We))),N[0]&512&&L(U,e[9]),N[0]&512&&ie(le.value)!==e[9]&&L(le,e[9]),N[0]&1024&&h(B,"max",e[10]),N[0]&256&&L(B,e[8]),N[0]&256&&Te!==(Te=e[8].toFixed(1)+"")&&et(Ue,Te),N[0]&1024&&Oe!==(Oe=e[10].toFixed(1)+"")&&et(Qe,Oe),N[0]&2&&X.value!==e[1]&&L(X,e[1]),ze===(ze=It(e))&&$?$.p(e,N):($.d(1),$=ze(e),$&&($.c(),$.m(Q,Ve))),G.ctx=e,N[0]&4096&&Be!==(Be=e[12])&&Le(Be,G)||un(G,e,N)},i:D,o:D,d(M){M&&P(t),tt(z,M),V.block.d(),V.token=null,V=null,Z.d(),$.d(),G.block.d(),G.token=null,G=null,Ye=!1,nt(Tt)}}}const _e=j(0),Ke=j(!1),Je=j(25),dt=j(["C0","C0"]);function On(e,t,n){let o,l,s=D,a,_=D,p,c=D,r,f,g=D,C,w,S,E,re,O,pe;q(e,_e,m=>n(3,l=m)),q(e,Ke,m=>n(4,a=m)),q(e,dt,m=>n(34,p=m)),q(e,Ge,m=>n(0,r=m)),q(e,Je,m=>n(5,f=m)),q(e,at,m=>n(6,C=m)),q(e,J,m=>n(7,w=m)),q(e,me,m=>n(8,S=m)),q(e,Ne,m=>n(9,E=m)),q(e,He,m=>n(10,re=m)),q(e,ue,m=>n(11,O=m)),q(e,Qt,m=>n(12,pe=m)),e.$$.on_destroy.push(()=>s()),e.$$.on_destroy.push(()=>_()),e.$$.on_destroy.push(()=>c()),e.$$.on_destroy.push(()=>g());let F="";const fe=new URLSearchParams(window.location.search).get("room");fe&&(F=fe,pt(F));function de(m){const v=m.children[m.selectedIndex];R(dt,p=v.dataset.range.split(","),p)}function he(m){m.code==="Space"&&R(Ke,a=!a,a),m.code==="ControlLeft"?R(_e,l-=1,l):m.code==="AltLeft"&&R(_e,l+=1,l),l<-3?R(_e,l=3,l):l>3&&R(_e,l=-3,l)}function be(){a=this.checked,Ke.set(a)}function H(){l=ie(this.value),_e.set(l)}function ge(){f=ie(this.value),Je.set(f)}function ce(){f=ie(this.value),Je.set(f)}function u(){r=pn(this),Ge.set(r)}const b=m=>de(m.currentTarget),T=m=>{var v;return R(at,C=(v=m.currentTarget.files)==null?void 0:v[0],C)},ke=()=>R(J,w=!1,w),Pe=()=>R(J,w=!0,w),W=()=>{R(J,w=!1,w),R(me,S=0,S),setTimeout(()=>{R(J,w=!0,w)},100)};function ee(){E=ie(this.value),Ne.set(E)}function Y(){E=ie(this.value),Ne.set(E)}function te(){S=ie(this.value),me.set(S)}const ne=()=>R(J,w=!1,w),oe=()=>R(J,w=!0,w);function Ae(){F=this.value,n(1,F)}const De=m=>{m.code==="Enter"&&pt(F)},Se=()=>A.disconnect(),Ee=()=>pt(F);return e.$$.update=()=>{e.$$.dirty[0]&1&&n(2,o=Ut(r))},[r,F,o,l,a,f,C,w,S,E,re,O,pe,de,he,be,H,ge,ce,u,b,T,ke,Pe,W,ee,Y,te,ne,oe,Ae,De,Se,Ee]}class In extends Xe{constructor(t){super();Ze(this,t,On,Tn,$e,{},null,[-1,-1])}}function tn(e,t,n){const o=e.slice();return o[26]=t[n][0],o[27]=t[n][1].white,o[28]=t[n][1].pressedColor,o[29]=t[n][1].ghost,o}function nn(e){let t,n,o,l,s;function a(...r){return e[14](e[26],...r)}function _(){return e[15](e[26])}function p(){return e[16](e[26])}function c(){return e[17](e[26])}return{c(){t=d("div"),h(t,"class",n="key "+(e[27]?"white":"black")+" svelte-yqi7mq"),h(t,"style",o=`--color-hue: ${e[28]}`),Re(t,"pressed",e[28]!==null),Re(t,"ghost",e[29]&&e[28]===null)},m(r,f){K(r,t,f),l||(s=[k(t,"pointerdown",a),k(t,"pointerenter",_),k(t,"pointerleave",p),k(t,"pointerup",c)],l=!0)},p(r,f){e=r,f[0]&4&&n!==(n="key "+(e[27]?"white":"black")+" svelte-yqi7mq")&&h(t,"class",n),f[0]&4&&o!==(o=`--color-hue: ${e[28]}`)&&h(t,"style",o),f[0]&4&&Re(t,"pressed",e[28]!==null),f[0]&4&&Re(t,"ghost",e[29]&&e[28]===null)},d(r){r&&P(t),l=!1,nt(s)}}}function Bn(e){let t,n,o,l,s,a=Object.entries(e[2]),_=[];for(let p=0;p<a.length;p+=1)_[p]=nn(tn(e,a,p));return{c(){t=d("div"),n=d("div");for(let p=0;p<_.length;p+=1)_[p].c();h(n,"class","piano svelte-yqi7mq"),h(n,"style",o=`--white-keys: ${e[0]}`),h(t,"class","piano-container svelte-yqi7mq")},m(p,c){K(p,t,c),i(t,n);for(let r=0;r<_.length;r+=1)_[r].m(n,null);e[18](t),l||(s=[k(window,"resize",e[10]),k(window,"load",e[11]),k(window,"keyup",e[8]),k(window,"keydown",e[7]),k(window,"pointerdown",e[12]),k(window,"pointerup",e[13]),k(n,"touchend",fn(e[9]))],l=!0)},p(p,c){if(c[0]&54){a=Object.entries(p[2]);let r;for(r=0;r<a.length;r+=1){const f=tn(p,a,r);_[r]?_[r].p(f,c):(_[r]=nn(f),_[r].c(),_[r].m(n,null))}for(;r<_.length;r+=1)_[r].d(1);_.length=a.length}c[0]&1&&o!==(o=`--white-keys: ${p[0]}`)&&h(n,"style",o)},i:D,o:D,d(p){p&&P(t),tt(_,p),e[18](null),l=!1,nt(s)}}}function on(e,t){t.get(e)&&(t.get(e).stop(),t.delete(e))}function qn(e,t,n){let o,l,s;q(e,Ke,u=>n(19,o=u)),q(e,Je,u=>n(20,l=u)),q(e,_e,u=>n(21,s=u));let a=!1,_,p,c,r=new Map;dt.subscribe(u=>{const b=bn(u[0],u[1]);n(2,_=b.noteMap),n(0,p=b.whiteKeys)});function f(u){var T;const b=ae.get((T=u.socketID)!=null?T:"0");_[u.note]&&n(2,_[u.note].pressedColor=b.colorHue,_),!!b.instrument&&(on(u.note,b.audioNodeMap),b.audioNodeMap.set(u.note,b.instrument.play(u.note,void 0,{gain:u.volume})))}function g(u){var T;const b=ae.get((T=u.socketID)!=null?T:"0");_[u.note]&&n(2,_[u.note].pressedColor=null,_),u.sustain||on(u.note,b.audioNodeMap)}yn(f,g);function C(u){const b=lt(u)+s;return st(u)+b}function w(u,b){const T=C(u);r.get(T)||(_[u]&&n(2,_[u].ghost=!0,_),r.set(T,!0),kn(T,l*b))}function S(u){const b=C(u);_[u]&&n(2,_[u].ghost=!1,_),!!r.get(b)&&(r.delete(b),ft(b,o))}gn(w,S),Ke.subscribe(u=>{if(!u)for(const b of je.audioNodeMap.keys())r.get(b)||ft(b,!1)}),_e.subscribe(()=>{for(const u of r.keys())ft(u,o)});function E(u=p){if(!c)return;const b=c.clientHeight/6,T=c.offsetWidth/u;c.style.setProperty("--white-key-width",`${Math.min(T,b)}px`)}function re(u){const b=Jt[u.code],T=u.target;b&&T.tagName!=="INPUT"&&(u.preventDefault(),w(b,.5))}function O(u){const b=Jt[u.code];b&&S(b)}function pe(u){dn.call(this,e,u)}const F=()=>E(),ye=()=>E(),fe=()=>n(1,a=!0),de=()=>n(1,a=!1),he=(u,b)=>{b.currentTarget.releasePointerCapture(b.pointerId),w(u,.5)},be=u=>{a&&w(u,.5)},H=u=>S(u),ge=u=>S(u);function ce(u){hn[u?"unshift":"push"](()=>{c=u,n(3,c)})}return e.$$.update=()=>{e.$$.dirty[0]&1&&E(p)},[p,a,_,c,w,S,E,re,O,pe,F,ye,fe,de,he,be,H,ge,ce]}class zn extends Xe{constructor(t){super();Ze(this,t,qn,Bn,$e,{},null,[-1,-1])}}function Ln(e){let t,n,o,l,s;return n=new In({}),l=new zn({}),{c(){t=d("main"),zt(n.$$.fragment),o=y(),zt(l.$$.fragment),h(t,"class","svelte-ieeeet")},m(a,_){K(a,t,_),Lt(n,t,null),i(t,o),Lt(l,t,null),s=!0},p:D,i(a){s||(Rt(n.$$.fragment,a),Rt(l.$$.fragment,a),s=!0)},o(a){Ht(n.$$.fragment,a),Ht(l.$$.fragment,a),s=!1},d(a){a&&P(t),Gt(n),Gt(l)}}}class Rn extends Xe{constructor(t){super();Ze(this,t,null,Ln,$e,{})}}new Rn({target:document.body});

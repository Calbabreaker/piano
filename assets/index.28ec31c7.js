const ri=function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))r(i);new MutationObserver(i=>{for(const o of i)if(o.type==="childList")for(const s of o.addedNodes)s.tagName==="LINK"&&s.rel==="modulepreload"&&r(s)}).observe(document,{childList:!0,subtree:!0});function n(i){const o={};return i.integrity&&(o.integrity=i.integrity),i.referrerpolicy&&(o.referrerPolicy=i.referrerpolicy),i.crossorigin==="use-credentials"?o.credentials="include":i.crossorigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function r(i){if(i.ep)return;i.ep=!0;const o=n(i);fetch(i.href,o)}};ri();function B(){}function ii(e){return e&&typeof e=="object"&&typeof e.then=="function"}function vr(e){return e()}function Kn(){return Object.create(null)}function Pe(e){e.forEach(vr)}function _r(e){return typeof e=="function"}function Et(e,t){return e!=e?t==t:e!==t||e&&typeof e=="object"||typeof e=="function"}function si(e){return Object.keys(e).length===0}function kr(e,...t){if(e==null)return B;const n=e.subscribe(...t);return n.unsubscribe?()=>n.unsubscribe():n}function pe(e){let t;return kr(e,n=>t=n)(),t}function z(e,t,n){e.$$.on_destroy.push(kr(t,n))}function W(e,t,n){return e.set(n),t}function oi(e){return e&&_r(e.destroy)?e.destroy:B}function g(e,t){e.appendChild(t)}function D(e,t,n){e.insertBefore(t,n||null)}function M(e){e.parentNode.removeChild(e)}function mn(e,t){for(let n=0;n<e.length;n+=1)e[n]&&e[n].d(t)}function k(e){return document.createElement(e)}function ce(e){return document.createTextNode(e)}function P(){return ce(" ")}function yn(){return ce("")}function O(e,t,n,r){return e.addEventListener(t,n,r),()=>e.removeEventListener(t,n,r)}function ai(e){return function(t){return t.preventDefault(),e.call(this,t)}}function v(e,t,n){n==null?e.removeAttribute(t):e.getAttribute(t)!==n&&e.setAttribute(t,n)}function Te(e){return e===""?null:+e}function ci(e){return Array.from(e.childNodes)}function Qt(e,t){t=""+t,e.wholeText!==t&&(e.data=t)}function Z(e,t){e.value=t==null?"":t}function wr(e,t,n,r){n===null?e.style.removeProperty(t):e.style.setProperty(t,n,r?"important":"")}function $n(e,t){for(let n=0;n<e.options.length;n+=1){const r=e.options[n];if(r.__value===t){r.selected=!0;return}}e.selectedIndex=-1}function ui(e){const t=e.querySelector(":checked")||e.options[0];return t&&t.__value}function ft(e,t,n){e.classList[n?"add":"remove"](t)}let et;function xe(e){et=e}function li(){if(!et)throw new Error("Function called outside component initialization");return et}function fi(e,t){const n=e.$$.callbacks[t.type];n&&n.slice().forEach(r=>r.call(this,t))}const Ye=[],Zt=[],_t=[],Hn=[],hi=Promise.resolve();let en=!1;function di(){en||(en=!0,hi.then(gn))}function Ct(e){_t.push(e)}const $t=new Set;let ht=0;function gn(){const e=et;do{for(;ht<Ye.length;){const t=Ye[ht];ht++,xe(t),pi(t.$$)}for(xe(null),Ye.length=0,ht=0;Zt.length;)Zt.pop()();for(let t=0;t<_t.length;t+=1){const n=_t[t];$t.has(n)||($t.add(n),n())}_t.length=0}while(Ye.length);for(;Hn.length;)Hn.pop()();en=!1,$t.clear(),xe(e)}function pi(e){if(e.fragment!==null){e.update(),Pe(e.before_update);const t=e.dirty;e.dirty=[-1],e.fragment&&e.fragment.p(e.ctx,t),e.after_update.forEach(Ct)}}const kt=new Set;let Me;function mi(){Me={r:0,c:[],p:Me}}function yi(){Me.r||Pe(Me.c),Me=Me.p}function Ot(e,t){e&&e.i&&(kt.delete(e),e.i(t))}function tn(e,t,n,r){if(e&&e.o){if(kt.has(e))return;kt.add(e),Me.c.push(()=>{kt.delete(e),r&&(n&&e.d(1),r())}),e.o(t)}}function dt(e,t){const n=t.token={};function r(i,o,s,c){if(t.token!==n)return;t.resolved=c;let u=t.ctx;s!==void 0&&(u=u.slice(),u[s]=c);const a=i&&(t.current=i)(u);let h=!1;t.block&&(t.blocks?t.blocks.forEach((f,l)=>{l!==o&&f&&(mi(),tn(f,1,1,()=>{t.blocks[l]===f&&(t.blocks[l]=null)}),yi())}):t.block.d(1),a.c(),Ot(a,1),a.m(t.mount(),t.anchor),h=!0),t.block=a,t.blocks&&(t.blocks[o]=a),h&&gn()}if(ii(e)){const i=li();if(e.then(o=>{xe(i),r(t.then,1,t.value,o),xe(null)},o=>{if(xe(i),r(t.catch,2,t.error,o),xe(null),!t.hasCatch)throw o}),t.current!==t.pending)return r(t.pending,0),!0}else{if(t.current!==t.then)return r(t.then,1,t.value,e),!0;t.resolved=e}}function gi(e,t,n){const r=t.slice(),{resolved:i}=e;e.current===e.then&&(r[e.value]=i),e.current===e.catch&&(r[e.error]=i),e.block.p(r,n)}const bi=typeof window!="undefined"?window:typeof globalThis!="undefined"?globalThis:global;function zn(e){e&&e.c()}function nn(e,t,n,r){const{fragment:i,on_mount:o,on_destroy:s,after_update:c}=e.$$;i&&i.m(t,n),r||Ct(()=>{const u=o.map(vr).filter(_r);s?s.push(...u):Pe(u),e.$$.on_mount=[]}),c.forEach(Ct)}function rn(e,t){const n=e.$$;n.fragment!==null&&(Pe(n.on_destroy),n.fragment&&n.fragment.d(t),n.on_destroy=n.fragment=null,n.ctx=[])}function vi(e,t){e.$$.dirty[0]===-1&&(Ye.push(e),di(),e.$$.dirty.fill(0)),e.$$.dirty[t/31|0]|=1<<t%31}function bn(e,t,n,r,i,o,s,c=[-1]){const u=et;xe(e);const a=e.$$={fragment:null,ctx:null,props:o,update:B,not_equal:i,bound:Kn(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(t.context||(u?u.$$.context:[])),callbacks:Kn(),dirty:c,skip_bound:!1,root:t.target||u.$$.root};s&&s(a.root);let h=!1;if(a.ctx=n?n(e,t.props||{},(f,l,...p)=>{const d=p.length?p[0]:l;return a.ctx&&i(a.ctx[f],a.ctx[f]=d)&&(!a.skip_bound&&a.bound[f]&&a.bound[f](d),h&&vi(e,f)),l}):[],a.update(),h=!0,Pe(a.before_update),a.fragment=r?r(a.ctx):!1,t.target){if(t.hydrate){const f=ci(t.target);a.fragment&&a.fragment.l(f),f.forEach(M)}else a.fragment&&a.fragment.c();t.intro&&Ot(e.$$.fragment),nn(e,t.target,t.anchor,t.customElement),gn()}xe(u)}class vn{$destroy(){rn(this,1),this.$destroy=B}$on(t,n){const r=this.$$.callbacks[t]||(this.$$.callbacks[t]=[]);return r.push(n),()=>{const i=r.indexOf(n);i!==-1&&r.splice(i,1)}}$set(t){this.$$set&&!si(t)&&(this.$$.skip_bound=!0,this.$$set(t),this.$$.skip_bound=!1)}}const Le=[];function te(e,t=B){let n;const r=new Set;function i(c){if(Et(e,c)&&(e=c,n)){const u=!Le.length;for(const a of r)a[1](),Le.push(a,e);if(u){for(let a=0;a<Le.length;a+=2)Le[a][0](Le[a+1]);Le.length=0}}}function o(c){i(c(e))}function s(c,u=B){const a=[c,u];return r.add(a),r.size===1&&(n=t(i)||B),c(e),()=>{r.delete(a),r.size===0&&(n(),n=null)}}return{set:i,update:o,subscribe:s}}const Jn=["accordion","acoustic_bass","acoustic_grand_piano","acoustic_guitar_nylon","acoustic_guitar_steel","agogo","alto_sax","applause","bagpipe","banjo","baritone_sax","bassoon","bird_tweet","blown_bottle","brass_section","breath_noise","bright_acoustic_piano","celesta","cello","choir_aahs","church_organ","clarinet","clavinet","contrabass","distortion_guitar","drawbar_organ","dulcimer","electric_bass_finger","electric_bass_pick","electric_grand_piano","electric_guitar_clean","electric_guitar_jazz","electric_guitar_muted","electric_piano_1","electric_piano_2","english_horn","fiddle","flute","french_horn","fretless_bass","fx_1_rain","fx_2_soundtrack","fx_3_crystal","fx_4_atmosphere","fx_5_brightness","fx_6_goblins","fx_7_echoes","fx_8_scifi","glockenspiel","guitar_fret_noise","guitar_harmonics","gunshot","harmonica","harpsichord","helicopter","honkytonk_piano","kalimba","koto","lead_1_square","lead_2_sawtooth","lead_3_calliope","lead_4_chiff","lead_5_charang","lead_6_voice","lead_7_fifths","lead_8_bass__lead","marimba","melodic_tom","music_box","muted_trumpet","oboe","ocarina","orchestra_hit","orchestral_harp","overdriven_guitar","pad_1_new_age","pad_2_warm","pad_3_polysynth","pad_4_choir","pad_5_bowed","pad_6_metallic","pad_7_halo","pad_8_sweep","pan_flute","percussive_organ","piccolo","pizzicato_strings","recorder","reed_organ","reverse_cymbal","rock_organ","seashore","shakuhachi","shamisen","shanai","sitar","slap_bass_1","slap_bass_2","soprano_sax","steel_drums","string_ensemble_1","string_ensemble_2","synth_bass_1","synth_bass_2","synth_brass_1","synth_brass_2","synth_choir","synth_drum","synth_strings_1","synth_strings_2","taiko_drum","tango_accordion","telephone_ring","tenor_sax","timpani","tinkle_bell","tremolo_strings","trombone","trumpet","tuba","tubular_bells","vibraphone","viola","violin","voice_oohs","whistle","woodblock","xylophone"];var $e=typeof globalThis!="undefined"?globalThis:typeof window!="undefined"?window:typeof global!="undefined"?global:typeof self!="undefined"?self:{};function Tr(e){if(e.__esModule)return e;var t=Object.defineProperty({},"__esModule",{value:!0});return Object.keys(e).forEach(function(n){var r=Object.getOwnPropertyDescriptor(e,n);Object.defineProperty(t,n,r.get?r:{enumerable:!0,get:function(){return e[n]}})}),t}function pt(e){throw new Error('Could not dynamically require "'+e+'". Please configure the dynamicRequireTargets or/and ignoreDynamicRequires option of @rollup/plugin-commonjs appropriately for this require call to work.')}var xr={},Bt={};function _i(e){var t=new Y(e),n=t.readChunk();if(n.id!="MThd")throw"Bad MIDI file.  Expected 'MHdr', got: '"+n.id+"'";for(var r=ki(n.data),i=[],o=0;!t.eof()&&o<r.numTracks;o++){var s=t.readChunk();if(s.id!="MTrk")throw"Bad MIDI file.  Expected 'MTrk', got: '"+s.id+"'";var c=wi(s.data);i.push(c)}return{header:r,tracks:i}}function ki(e){var t=new Y(e),n=t.readUInt16(),r=t.readUInt16(),i={format:n,numTracks:r},o=t.readUInt16();return o&32768?(i.framesPerSecond=256-(o>>8),i.ticksPerFrame=o&255):i.ticksPerBeat=o,i}function wi(e){for(var t=new Y(e),n=[];!t.eof();){var r=o();n.push(r)}return n;var i;function o(){var s={};s.deltaTime=t.readVarInt();var c=t.readUInt8();if((c&240)===240)if(c===255){s.meta=!0;var u=t.readUInt8(),a=t.readVarInt();switch(u){case 0:if(s.type="sequenceNumber",a!==2)throw"Expected length for sequenceNumber event is 2, got "+a;return s.number=t.readUInt16(),s;case 1:return s.type="text",s.text=t.readString(a),s;case 2:return s.type="copyrightNotice",s.text=t.readString(a),s;case 3:return s.type="trackName",s.text=t.readString(a),s;case 4:return s.type="instrumentName",s.text=t.readString(a),s;case 5:return s.type="lyrics",s.text=t.readString(a),s;case 6:return s.type="marker",s.text=t.readString(a),s;case 7:return s.type="cuePoint",s.text=t.readString(a),s;case 32:if(s.type="channelPrefix",a!=1)throw"Expected length for channelPrefix event is 1, got "+a;return s.channel=t.readUInt8(),s;case 33:if(s.type="portPrefix",a!=1)throw"Expected length for portPrefix event is 1, got "+a;return s.port=t.readUInt8(),s;case 47:if(s.type="endOfTrack",a!=0)throw"Expected length for endOfTrack event is 0, got "+a;return s;case 81:if(s.type="setTempo",a!=3)throw"Expected length for setTempo event is 3, got "+a;return s.microsecondsPerBeat=t.readUInt24(),s;case 84:if(s.type="smpteOffset",a!=5)throw"Expected length for smpteOffset event is 5, got "+a;var h=t.readUInt8(),f={0:24,32:25,64:29,96:30};return s.frameRate=f[h&96],s.hour=h&31,s.min=t.readUInt8(),s.sec=t.readUInt8(),s.frame=t.readUInt8(),s.subFrame=t.readUInt8(),s;case 88:if(s.type="timeSignature",a!=2&&a!=4)throw"Expected length for timeSignature event is 4 or 2, got "+a;return s.numerator=t.readUInt8(),s.denominator=1<<t.readUInt8(),a===4?(s.metronome=t.readUInt8(),s.thirtyseconds=t.readUInt8()):(s.metronome=36,s.thirtyseconds=8),s;case 89:if(s.type="keySignature",a!=2)throw"Expected length for keySignature event is 2, got "+a;return s.key=t.readInt8(),s.scale=t.readUInt8(),s;case 127:return s.type="sequencerSpecific",s.data=t.readBytes(a),s;default:return s.type="unknownMeta",s.data=t.readBytes(a),s.metatypeByte=u,s}}else if(c==240){s.type="sysEx";var a=t.readVarInt();return s.data=t.readBytes(a),s}else if(c==247){s.type="endSysEx";var a=t.readVarInt();return s.data=t.readBytes(a),s}else throw"Unrecognised MIDI event type byte: "+c;else{var l;if((c&128)===0){if(i===null)throw"Running status byte encountered before status byte";l=c,c=i,s.running=!0}else l=t.readUInt8(),i=c;var p=c>>4;switch(s.channel=c&15,p){case 8:return s.type="noteOff",s.noteNumber=l,s.velocity=t.readUInt8(),s;case 9:var d=t.readUInt8();return s.type=d===0?"noteOff":"noteOn",s.noteNumber=l,s.velocity=d,d===0&&(s.byte9=!0),s;case 10:return s.type="noteAftertouch",s.noteNumber=l,s.amount=t.readUInt8(),s;case 11:return s.type="controller",s.controllerType=l,s.value=t.readUInt8(),s;case 12:return s.type="programChange",s.programNumber=l,s;case 13:return s.type="channelAftertouch",s.amount=l,s;case 14:return s.type="pitchBend",s.value=l+(t.readUInt8()<<7)-8192,s;default:throw"Unrecognised MIDI event type: "+p}}}}function Y(e){this.buffer=e,this.bufferLen=this.buffer.length,this.pos=0}Y.prototype.eof=function(){return this.pos>=this.bufferLen};Y.prototype.readUInt8=function(){var e=this.buffer[this.pos];return this.pos+=1,e};Y.prototype.readInt8=function(){var e=this.readUInt8();return e&128?e-256:e};Y.prototype.readUInt16=function(){var e=this.readUInt8(),t=this.readUInt8();return(e<<8)+t};Y.prototype.readInt16=function(){var e=this.readUInt16();return e&32768?e-65536:e};Y.prototype.readUInt24=function(){var e=this.readUInt8(),t=this.readUInt8(),n=this.readUInt8();return(e<<16)+(t<<8)+n};Y.prototype.readInt24=function(){var e=this.readUInt24();return e&8388608?e-16777216:e};Y.prototype.readUInt32=function(){var e=this.readUInt8(),t=this.readUInt8(),n=this.readUInt8(),r=this.readUInt8();return(e<<24)+(t<<16)+(n<<8)+r};Y.prototype.readBytes=function(e){var t=this.buffer.slice(this.pos,this.pos+e);return this.pos+=e,t};Y.prototype.readString=function(e){var t=this.readBytes(e);return String.fromCharCode.apply(null,t)};Y.prototype.readVarInt=function(){for(var e=0;!this.eof();){var t=this.readUInt8();if(t&128)e+=t&127,e<<=7;else return e+t}return e};Y.prototype.readChunk=function(){var e=this.readString(4),t=this.readUInt32(),n=this.readBytes(t);return{id:e,length:t,data:n}};var Ti=_i;function xi(e,t){if(typeof e!="object")throw"Invalid MIDI data";t=t||{};var n=e.header||{},r=e.tracks||[],i,o=r.length,s=new $;for(Si(s,n,o),i=0;i<o;i++)Ii(s,r[i],t);return s.buffer}function Si(e,t,n){var r=t.format==null?1:t.format,i=128;t.timeDivision?i=t.timeDivision:t.ticksPerFrame&&t.framesPerSecond?i=-(t.framesPerSecond&255)<<8|t.ticksPerFrame&255:t.ticksPerBeat&&(i=t.ticksPerBeat&32767);var o=new $;o.writeUInt16(r),o.writeUInt16(n),o.writeUInt16(i),e.writeChunk("MThd",o.buffer)}function Ii(e,t,n){var r=new $,i,o=t.length,s=null;for(i=0;i<o;i++)(n.running===!1||!n.running&&!t[i].running)&&(s=null),s=Ci(r,t[i],s,n.useByte9ForNoteOff);e.writeChunk("MTrk",r.buffer)}function Ci(e,t,n,r){var i=t.type,o=t.deltaTime,s=t.text||"",c=t.data||[],u=null;switch(e.writeVarInt(o),i){case"sequenceNumber":e.writeUInt8(255),e.writeUInt8(0),e.writeVarInt(2),e.writeUInt16(t.number);break;case"text":e.writeUInt8(255),e.writeUInt8(1),e.writeVarInt(s.length),e.writeString(s);break;case"copyrightNotice":e.writeUInt8(255),e.writeUInt8(2),e.writeVarInt(s.length),e.writeString(s);break;case"trackName":e.writeUInt8(255),e.writeUInt8(3),e.writeVarInt(s.length),e.writeString(s);break;case"instrumentName":e.writeUInt8(255),e.writeUInt8(4),e.writeVarInt(s.length),e.writeString(s);break;case"lyrics":e.writeUInt8(255),e.writeUInt8(5),e.writeVarInt(s.length),e.writeString(s);break;case"marker":e.writeUInt8(255),e.writeUInt8(6),e.writeVarInt(s.length),e.writeString(s);break;case"cuePoint":e.writeUInt8(255),e.writeUInt8(7),e.writeVarInt(s.length),e.writeString(s);break;case"channelPrefix":e.writeUInt8(255),e.writeUInt8(32),e.writeVarInt(1),e.writeUInt8(t.channel);break;case"portPrefix":e.writeUInt8(255),e.writeUInt8(33),e.writeVarInt(1),e.writeUInt8(t.port);break;case"endOfTrack":e.writeUInt8(255),e.writeUInt8(47),e.writeVarInt(0);break;case"setTempo":e.writeUInt8(255),e.writeUInt8(81),e.writeVarInt(3),e.writeUInt24(t.microsecondsPerBeat);break;case"smpteOffset":e.writeUInt8(255),e.writeUInt8(84),e.writeVarInt(5);var a={24:0,25:32,29:64,30:96},h=t.hour&31|a[t.frameRate];e.writeUInt8(h),e.writeUInt8(t.min),e.writeUInt8(t.sec),e.writeUInt8(t.frame),e.writeUInt8(t.subFrame);break;case"timeSignature":e.writeUInt8(255),e.writeUInt8(88),e.writeVarInt(4),e.writeUInt8(t.numerator);var f=Math.floor(Math.log(t.denominator)/Math.LN2)&255;e.writeUInt8(f),e.writeUInt8(t.metronome),e.writeUInt8(t.thirtyseconds||8);break;case"keySignature":e.writeUInt8(255),e.writeUInt8(89),e.writeVarInt(2),e.writeInt8(t.key),e.writeUInt8(t.scale);break;case"sequencerSpecific":e.writeUInt8(255),e.writeUInt8(127),e.writeVarInt(c.length),e.writeBytes(c);break;case"unknownMeta":t.metatypeByte!=null&&(e.writeUInt8(255),e.writeUInt8(t.metatypeByte),e.writeVarInt(c.length),e.writeBytes(c));break;case"sysEx":e.writeUInt8(240),e.writeVarInt(c.length),e.writeBytes(c);break;case"endSysEx":e.writeUInt8(247),e.writeVarInt(c.length),e.writeBytes(c);break;case"noteOff":var l=r!==!1&&t.byte9||r&&t.velocity==0?144:128;u=l|t.channel,u!==n&&e.writeUInt8(u),e.writeUInt8(t.noteNumber),e.writeUInt8(t.velocity);break;case"noteOn":u=144|t.channel,u!==n&&e.writeUInt8(u),e.writeUInt8(t.noteNumber),e.writeUInt8(t.velocity);break;case"noteAftertouch":u=160|t.channel,u!==n&&e.writeUInt8(u),e.writeUInt8(t.noteNumber),e.writeUInt8(t.amount);break;case"controller":u=176|t.channel,u!==n&&e.writeUInt8(u),e.writeUInt8(t.controllerType),e.writeUInt8(t.value);break;case"programChange":u=192|t.channel,u!==n&&e.writeUInt8(u),e.writeUInt8(t.programNumber);break;case"channelAftertouch":u=208|t.channel,u!==n&&e.writeUInt8(u),e.writeUInt8(t.amount);break;case"pitchBend":u=224|t.channel,u!==n&&e.writeUInt8(u);var p=8192+t.value,d=p&127,y=p>>7&127;e.writeUInt8(d),e.writeUInt8(y);break;default:throw"Unrecognized event type: "+i}return u}function $(){this.buffer=[]}$.prototype.writeUInt8=function(e){this.buffer.push(e&255)};$.prototype.writeInt8=$.prototype.writeUInt8;$.prototype.writeUInt16=function(e){var t=e>>8&255,n=e&255;this.writeUInt8(t),this.writeUInt8(n)};$.prototype.writeInt16=$.prototype.writeUInt16;$.prototype.writeUInt24=function(e){var t=e>>16&255,n=e>>8&255,r=e&255;this.writeUInt8(t),this.writeUInt8(n),this.writeUInt8(r)};$.prototype.writeInt24=$.prototype.writeUInt24;$.prototype.writeUInt32=function(e){var t=e>>24&255,n=e>>16&255,r=e>>8&255,i=e&255;this.writeUInt8(t),this.writeUInt8(n),this.writeUInt8(r),this.writeUInt8(i)};$.prototype.writeInt32=$.prototype.writeUInt32;$.prototype.writeBytes=function(e){this.buffer=this.buffer.concat(Array.prototype.slice.call(e,0))};$.prototype.writeString=function(e){var t,n=e.length,r=[];for(t=0;t<n;t++)r.push(e.codePointAt(t));this.writeBytes(r)};$.prototype.writeVarInt=function(e){if(e<0)throw"Cannot write negative variable-length integer";if(e<=127)this.writeUInt8(e);else{var t=e,n=[];for(n.push(t&127),t>>=7;t;){var r=t&127|128;n.push(r),t>>=7}this.writeBytes(n.reverse())}};$.prototype.writeChunk=function(e,t){this.writeString(e),this.writeUInt32(t.length),this.writeBytes(t)};var Oi=xi;Bt.parseMidi=Ti;Bt.writeMidi=Oi;var Nt={},Re={};Object.defineProperty(Re,"__esModule",{value:!0});Re.insert=Re.search=void 0;function Sr(e,t,n){n===void 0&&(n="ticks");var r=0,i=e.length,o=i;if(i>0&&e[i-1][n]<=t)return i-1;for(;r<o;){var s=Math.floor(r+(o-r)/2),c=e[s],u=e[s+1];if(c[n]===t){for(var a=s;a<e.length;a++){var h=e[a];h[n]===t&&(s=a)}return s}else{if(c[n]<t&&u[n]>t)return s;c[n]>t?o=s:c[n]<t&&(r=s+1)}}return-1}Re.search=Sr;function Ni(e,t,n){if(n===void 0&&(n="ticks"),e.length){var r=Sr(e,t[n],n);e.splice(r+1,0,t)}else e.push(t)}Re.insert=Ni;(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.Header=e.keySignatureKeys=void 0;var t=Re,n=new WeakMap;e.keySignatureKeys=["Cb","Gb","Db","Ab","Eb","Bb","F","C","G","D","A","E","B","F#","C#"];var r=function(){function i(o){var s=this;if(this.tempos=[],this.timeSignatures=[],this.keySignatures=[],this.meta=[],this.name="",n.set(this,480),o){n.set(this,o.header.ticksPerBeat),o.tracks.forEach(function(u){u.forEach(function(a){a.meta&&(a.type==="timeSignature"?s.timeSignatures.push({ticks:a.absoluteTime,timeSignature:[a.numerator,a.denominator]}):a.type==="setTempo"?s.tempos.push({bpm:6e7/a.microsecondsPerBeat,ticks:a.absoluteTime}):a.type==="keySignature"&&s.keySignatures.push({key:e.keySignatureKeys[a.key+7],scale:a.scale===0?"major":"minor",ticks:a.absoluteTime}))})});var c=0;o.tracks[0].forEach(function(u){c+=u.deltaTime,u.meta&&(u.type==="trackName"?s.name=u.text:(u.type==="text"||u.type==="cuePoint"||u.type==="marker"||u.type==="lyrics")&&s.meta.push({text:u.text,ticks:c,type:u.type}))}),this.update()}}return i.prototype.update=function(){var o=this,s=0,c=0;this.tempos.sort(function(u,a){return u.ticks-a.ticks}),this.tempos.forEach(function(u,a){var h=a>0?o.tempos[a-1].bpm:o.tempos[0].bpm,f=u.ticks/o.ppq-c,l=60/h*f;u.time=l+s,s=u.time,c+=f}),this.timeSignatures.sort(function(u,a){return u.ticks-a.ticks}),this.timeSignatures.forEach(function(u,a){var h=a>0?o.timeSignatures[a-1]:o.timeSignatures[0],f=(u.ticks-h.ticks)/o.ppq,l=f/h.timeSignature[0]/(h.timeSignature[1]/4);h.measures=h.measures||0,u.measures=l+h.measures})},i.prototype.ticksToSeconds=function(o){var s=(0,t.search)(this.tempos,o);if(s!==-1){var c=this.tempos[s],u=c.time,a=(o-c.ticks)/this.ppq;return u+60/c.bpm*a}else{var h=o/this.ppq;return 60/120*h}},i.prototype.ticksToMeasures=function(o){var s=(0,t.search)(this.timeSignatures,o);if(s!==-1){var c=this.timeSignatures[s],u=(o-c.ticks)/this.ppq;return c.measures+u/(c.timeSignature[0]/c.timeSignature[1])/4}else return o/this.ppq/4},Object.defineProperty(i.prototype,"ppq",{get:function(){return n.get(this)},enumerable:!1,configurable:!0}),i.prototype.secondsToTicks=function(o){var s=(0,t.search)(this.tempos,o,"time");if(s!==-1){var c=this.tempos[s],u=c.time,a=o-u,h=a/(60/c.bpm);return Math.round(c.ticks+h*this.ppq)}else{var f=o/.5;return Math.round(f*this.ppq)}},i.prototype.toJSON=function(){return{keySignatures:this.keySignatures,meta:this.meta,name:this.name,ppq:this.ppq,tempos:this.tempos.map(function(o){return{bpm:o.bpm,ticks:o.ticks}}),timeSignatures:this.timeSignatures}},i.prototype.fromJSON=function(o){this.name=o.name,this.tempos=o.tempos.map(function(s){return Object.assign({},s)}),this.timeSignatures=o.timeSignatures.map(function(s){return Object.assign({},s)}),this.keySignatures=o.keySignatures.map(function(s){return Object.assign({},s)}),this.meta=o.meta.map(function(s){return Object.assign({},s)}),n.set(this,o.ppq),this.update()},i.prototype.setTempo=function(o){this.tempos=[{bpm:o,ticks:0}],this.update()},i}();e.Header=r})(Nt);var tt={},_n={};(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.ControlChange=e.controlChangeIds=e.controlChangeNames=void 0,e.controlChangeNames={1:"modulationWheel",2:"breath",4:"footController",5:"portamentoTime",7:"volume",8:"balance",10:"pan",64:"sustain",65:"portamentoTime",66:"sostenuto",67:"softPedal",68:"legatoFootswitch",84:"portamentoControl"},e.controlChangeIds=Object.keys(e.controlChangeNames).reduce(function(i,o){return i[e.controlChangeNames[o]]=o,i},{});var t=new WeakMap,n=new WeakMap,r=function(){function i(o,s){t.set(this,s),n.set(this,o.controllerType),this.ticks=o.absoluteTime,this.value=o.value}return Object.defineProperty(i.prototype,"number",{get:function(){return n.get(this)},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"name",{get:function(){return e.controlChangeNames[this.number]?e.controlChangeNames[this.number]:null},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"time",{get:function(){var o=t.get(this);return o.ticksToSeconds(this.ticks)},set:function(o){var s=t.get(this);this.ticks=s.secondsToTicks(o)},enumerable:!1,configurable:!0}),i.prototype.toJSON=function(){return{number:this.number,ticks:this.ticks,time:this.time,value:this.value}},i}();e.ControlChange=r})(_n);var Pt={};Object.defineProperty(Pt,"__esModule",{value:!0});Pt.createControlChanges=void 0;var mt=_n;function Ai(){return new Proxy({},{get:function(e,t){if(e[t])return e[t];if(mt.controlChangeIds.hasOwnProperty(t))return e[mt.controlChangeIds[t]]},set:function(e,t,n){return mt.controlChangeIds.hasOwnProperty(t)?e[mt.controlChangeIds[t]]=n:e[t]=n,!0}})}Pt.createControlChanges=Ai;var Ut={};Object.defineProperty(Ut,"__esModule",{value:!0});Ut.PitchBend=void 0;var Ht=new WeakMap,Ei=function(){function e(t,n){Ht.set(this,n),this.ticks=t.absoluteTime,this.value=t.value}return Object.defineProperty(e.prototype,"time",{get:function(){var t=Ht.get(this);return t.ticksToSeconds(this.ticks)},set:function(t){var n=Ht.get(this);this.ticks=n.secondsToTicks(t)},enumerable:!1,configurable:!0}),e.prototype.toJSON=function(){return{ticks:this.ticks,time:this.time,value:this.value}},e}();Ut.PitchBend=Ei;var Mt={},Be={};Object.defineProperty(Be,"__esModule",{value:!0});Be.DrumKitByPatchID=Be.InstrumentFamilyByID=Be.instrumentByPatchID=void 0;Be.instrumentByPatchID=["acoustic grand piano","bright acoustic piano","electric grand piano","honky-tonk piano","electric piano 1","electric piano 2","harpsichord","clavi","celesta","glockenspiel","music box","vibraphone","marimba","xylophone","tubular bells","dulcimer","drawbar organ","percussive organ","rock organ","church organ","reed organ","accordion","harmonica","tango accordion","acoustic guitar (nylon)","acoustic guitar (steel)","electric guitar (jazz)","electric guitar (clean)","electric guitar (muted)","overdriven guitar","distortion guitar","guitar harmonics","acoustic bass","electric bass (finger)","electric bass (pick)","fretless bass","slap bass 1","slap bass 2","synth bass 1","synth bass 2","violin","viola","cello","contrabass","tremolo strings","pizzicato strings","orchestral harp","timpani","string ensemble 1","string ensemble 2","synthstrings 1","synthstrings 2","choir aahs","voice oohs","synth voice","orchestra hit","trumpet","trombone","tuba","muted trumpet","french horn","brass section","synthbrass 1","synthbrass 2","soprano sax","alto sax","tenor sax","baritone sax","oboe","english horn","bassoon","clarinet","piccolo","flute","recorder","pan flute","blown bottle","shakuhachi","whistle","ocarina","lead 1 (square)","lead 2 (sawtooth)","lead 3 (calliope)","lead 4 (chiff)","lead 5 (charang)","lead 6 (voice)","lead 7 (fifths)","lead 8 (bass + lead)","pad 1 (new age)","pad 2 (warm)","pad 3 (polysynth)","pad 4 (choir)","pad 5 (bowed)","pad 6 (metallic)","pad 7 (halo)","pad 8 (sweep)","fx 1 (rain)","fx 2 (soundtrack)","fx 3 (crystal)","fx 4 (atmosphere)","fx 5 (brightness)","fx 6 (goblins)","fx 7 (echoes)","fx 8 (sci-fi)","sitar","banjo","shamisen","koto","kalimba","bag pipe","fiddle","shanai","tinkle bell","agogo","steel drums","woodblock","taiko drum","melodic tom","synth drum","reverse cymbal","guitar fret noise","breath noise","seashore","bird tweet","telephone ring","helicopter","applause","gunshot"];Be.InstrumentFamilyByID=["piano","chromatic percussion","organ","guitar","bass","strings","ensemble","brass","reed","pipe","synth lead","synth pad","synth effects","world","percussive","sound effects"];Be.DrumKitByPatchID={0:"standard kit",8:"room kit",16:"power kit",24:"electronic kit",25:"tr-808 kit",32:"jazz kit",40:"brush kit",48:"orchestra kit",56:"sound fx kit"};Object.defineProperty(Mt,"__esModule",{value:!0});Mt.Instrument=void 0;var yt=Be,Gn=new WeakMap,Bi=function(){function e(t,n){if(this.number=0,Gn.set(this,n),this.number=0,t){var r=t.find(function(i){return i.type==="programChange"});r&&(this.number=r.programNumber)}}return Object.defineProperty(e.prototype,"name",{get:function(){return this.percussion?yt.DrumKitByPatchID[this.number]:yt.instrumentByPatchID[this.number]},set:function(t){var n=yt.instrumentByPatchID.indexOf(t);n!==-1&&(this.number=n)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"family",{get:function(){return this.percussion?"drums":yt.InstrumentFamilyByID[Math.floor(this.number/8)]},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"percussion",{get:function(){var t=Gn.get(this);return t.channel===9},enumerable:!1,configurable:!0}),e.prototype.toJSON=function(){return{family:this.family,number:this.number,name:this.name}},e.prototype.fromJSON=function(t){this.number=t.number},e}();Mt.Instrument=Bi;var Ft={};Object.defineProperty(Ft,"__esModule",{value:!0});Ft.Note=void 0;function Pi(e){var t=Math.floor(e/12)-1;return Ir(e)+t.toString()}function Ir(e){var t=["C","C#","D","D#","E","F","F#","G","G#","A","A#","B"],n=e%12;return t[n]}function Ui(e){var t=["C","C#","D","D#","E","F","F#","G","G#","A","A#","B"];return t.indexOf(e)}var Mi=function(){var e=/^([a-g]{1}(?:b|#|x|bb)?)(-?[0-9]+)/i,t={cbb:-2,cb:-1,c:0,"c#":1,cx:2,dbb:0,db:1,d:2,"d#":3,dx:4,ebb:2,eb:3,e:4,"e#":5,ex:6,fbb:3,fb:4,f:5,"f#":6,fx:7,gbb:5,gb:6,g:7,"g#":8,gx:9,abb:7,ab:8,a:9,"a#":10,ax:11,bbb:9,bb:10,b:11,"b#":12,bx:13};return function(n){var r=e.exec(n),i=r[1],o=r[2],s=t[i.toLowerCase()];return s+(parseInt(o,10)+1)*12}}(),Ve=new WeakMap,Fi=function(){function e(t,n,r){Ve.set(this,r),this.midi=t.midi,this.velocity=t.velocity,this.noteOffVelocity=n.velocity,this.ticks=t.ticks,this.durationTicks=n.ticks-t.ticks}return Object.defineProperty(e.prototype,"name",{get:function(){return Pi(this.midi)},set:function(t){this.midi=Mi(t)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"octave",{get:function(){return Math.floor(this.midi/12)-1},set:function(t){var n=t-this.octave;this.midi+=n*12},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"pitch",{get:function(){return Ir(this.midi)},set:function(t){this.midi=12*(this.octave+1)+Ui(t)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"duration",{get:function(){var t=Ve.get(this);return t.ticksToSeconds(this.ticks+this.durationTicks)-t.ticksToSeconds(this.ticks)},set:function(t){var n=Ve.get(this),r=n.secondsToTicks(this.time+t);this.durationTicks=r-this.ticks},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"time",{get:function(){var t=Ve.get(this);return t.ticksToSeconds(this.ticks)},set:function(t){var n=Ve.get(this);this.ticks=n.secondsToTicks(t)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"bars",{get:function(){var t=Ve.get(this);return t.ticksToMeasures(this.ticks)},enumerable:!1,configurable:!0}),e.prototype.toJSON=function(){return{duration:this.duration,durationTicks:this.durationTicks,midi:this.midi,name:this.name,ticks:this.ticks,time:this.time,velocity:this.velocity}},e}();Ft.Note=Fi;Object.defineProperty(tt,"__esModule",{value:!0});tt.Track=void 0;var zt=Re,Ri=_n,qi=Pt,Di=Ut,Wn=Mt,ji=Ft,gt=new WeakMap,Li=function(){function e(t,n){var r=this;if(this.name="",this.notes=[],this.controlChanges=(0,qi.createControlChanges)(),this.pitchBends=[],gt.set(this,n),t){var i=t.find(function(l){return l.type==="trackName"});this.name=i?i.text:""}if(this.instrument=new Wn.Instrument(t,this),this.channel=0,t){for(var o=t.filter(function(l){return l.type==="noteOn"}),s=t.filter(function(l){return l.type==="noteOff"}),c=function(){var l=o.shift();u.channel=l.channel;var p=s.findIndex(function(y){return y.noteNumber===l.noteNumber&&y.absoluteTime>=l.absoluteTime});if(p!==-1){var d=s.splice(p,1)[0];u.addNote({durationTicks:d.absoluteTime-l.absoluteTime,midi:l.noteNumber,noteOffVelocity:d.velocity/127,ticks:l.absoluteTime,velocity:l.velocity/127})}},u=this;o.length;)c();var a=t.filter(function(l){return l.type==="controller"});a.forEach(function(l){r.addCC({number:l.controllerType,ticks:l.absoluteTime,value:l.value/127})});var h=t.filter(function(l){return l.type==="pitchBend"});h.forEach(function(l){r.addPitchBend({ticks:l.absoluteTime,value:l.value/Math.pow(2,13)})});var f=t.find(function(l){return l.type==="endOfTrack"});this.endOfTrackTicks=f!==void 0?f.absoluteTime:void 0}}return e.prototype.addNote=function(t){var n=gt.get(this),r=new ji.Note({midi:0,ticks:0,velocity:1},{ticks:0,velocity:0},n);return Object.assign(r,t),(0,zt.insert)(this.notes,r,"ticks"),this},e.prototype.addCC=function(t){var n=gt.get(this),r=new Ri.ControlChange({controllerType:t.number},n);return delete t.number,Object.assign(r,t),Array.isArray(this.controlChanges[r.number])||(this.controlChanges[r.number]=[]),(0,zt.insert)(this.controlChanges[r.number],r,"ticks"),this},e.prototype.addPitchBend=function(t){var n=gt.get(this),r=new Di.PitchBend({},n);return Object.assign(r,t),(0,zt.insert)(this.pitchBends,r,"ticks"),this},Object.defineProperty(e.prototype,"duration",{get:function(){if(!this.notes.length)return 0;for(var t=this.notes[this.notes.length-1].time+this.notes[this.notes.length-1].duration,n=0;n<this.notes.length-1;n++){var r=this.notes[n].time+this.notes[n].duration;t<r&&(t=r)}return t},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"durationTicks",{get:function(){if(!this.notes.length)return 0;for(var t=this.notes[this.notes.length-1].ticks+this.notes[this.notes.length-1].durationTicks,n=0;n<this.notes.length-1;n++){var r=this.notes[n].ticks+this.notes[n].durationTicks;t<r&&(t=r)}return t},enumerable:!1,configurable:!0}),e.prototype.fromJSON=function(t){var n=this;this.name=t.name,this.channel=t.channel,this.instrument=new Wn.Instrument(void 0,this),this.instrument.fromJSON(t.instrument),t.endOfTrackTicks!==void 0&&(this.endOfTrackTicks=t.endOfTrackTicks);for(var r in t.controlChanges)t.controlChanges[r]&&t.controlChanges[r].forEach(function(i){n.addCC({number:i.number,ticks:i.ticks,value:i.value})});t.notes.forEach(function(i){n.addNote({durationTicks:i.durationTicks,midi:i.midi,ticks:i.ticks,velocity:i.velocity})})},e.prototype.toJSON=function(){for(var t={},n=0;n<127;n++)this.controlChanges.hasOwnProperty(n)&&(t[n]=this.controlChanges[n].map(function(i){return i.toJSON()}));var r={channel:this.channel,controlChanges:t,pitchBends:this.pitchBends.map(function(i){return i.toJSON()}),instrument:this.instrument.toJSON(),name:this.name,notes:this.notes.map(function(i){return i.toJSON()})};return this.endOfTrackTicks!==void 0&&(r.endOfTrackTicks=this.endOfTrackTicks),r},e}();tt.Track=Li;var Rt={};function Vi(e){var t=[];return Cr(e,t),t}function Cr(e,t){for(var n=0;n<e.length;n++){var r=e[n];Array.isArray(r)?Cr(r,t):t.push(r)}}var Ki=Object.freeze(Object.defineProperty({__proto__:null,flatten:Vi},Symbol.toStringTag,{value:"Module"})),$i=Tr(Ki),Oe=$e&&$e.__spreadArray||function(e,t,n){if(n||arguments.length===2)for(var r=0,i=t.length,o;r<i;r++)(o||!(r in t))&&(o||(o=Array.prototype.slice.call(t,0,r)),o[r]=t[r]);return e.concat(o||Array.prototype.slice.call(t))};Object.defineProperty(Rt,"__esModule",{value:!0});Rt.encode=void 0;var Hi=Bt,zi=Nt,Ji=$i;function Gi(e,t){return[{absoluteTime:e.ticks,channel:t,deltaTime:0,noteNumber:e.midi,type:"noteOn",velocity:Math.floor(e.velocity*127)},{absoluteTime:e.ticks+e.durationTicks,channel:t,deltaTime:0,noteNumber:e.midi,type:"noteOff",velocity:Math.floor(e.noteOffVelocity*127)}]}function Wi(e){return(0,Ji.flatten)(e.notes.map(function(t){return Gi(t,e.channel)}))}function Yi(e,t){return{absoluteTime:e.ticks,channel:t,controllerType:e.number,deltaTime:0,type:"controller",value:Math.floor(e.value*127)}}function Xi(e){for(var t=[],n=0;n<127;n++)e.controlChanges.hasOwnProperty(n)&&e.controlChanges[n].forEach(function(r){t.push(Yi(r,e.channel))});return t}function Qi(e,t){return{absoluteTime:e.ticks,channel:t,deltaTime:0,type:"pitchBend",value:e.value}}function Zi(e){var t=[];return e.pitchBends.forEach(function(n){t.push(Qi(n,e.channel))}),t}function es(e){return{absoluteTime:0,channel:e.channel,deltaTime:0,programNumber:e.instrument.number,type:"programChange"}}function ts(e){return{absoluteTime:0,deltaTime:0,meta:!0,text:e,type:"trackName"}}function ns(e){return{absoluteTime:e.ticks,deltaTime:0,meta:!0,microsecondsPerBeat:Math.floor(6e7/e.bpm),type:"setTempo"}}function rs(e){return{absoluteTime:e.ticks,deltaTime:0,denominator:e.timeSignature[1],meta:!0,metronome:24,numerator:e.timeSignature[0],thirtyseconds:8,type:"timeSignature"}}function is(e){var t=zi.keySignatureKeys.indexOf(e.key);return{absoluteTime:e.ticks,deltaTime:0,key:t+7,meta:!0,scale:e.scale==="major"?0:1,type:"keySignature"}}function ss(e){return{absoluteTime:e.ticks,deltaTime:0,meta:!0,text:e.text,type:e.type}}function os(e){var t={header:{format:1,numTracks:e.tracks.length+1,ticksPerBeat:e.header.ppq},tracks:Oe([Oe(Oe(Oe(Oe([{absoluteTime:0,deltaTime:0,meta:!0,text:e.header.name,type:"trackName"}],e.header.keySignatures.map(function(n){return is(n)}),!0),e.header.meta.map(function(n){return ss(n)}),!0),e.header.tempos.map(function(n){return ns(n)}),!0),e.header.timeSignatures.map(function(n){return rs(n)}),!0)],e.tracks.map(function(n){return Oe(Oe(Oe([ts(n.name),es(n)],Wi(n),!0),Xi(n),!0),Zi(n),!0)}),!0)};return t.tracks=t.tracks.map(function(n){n=n.sort(function(i,o){return i.absoluteTime-o.absoluteTime});var r=0;return n.forEach(function(i){i.deltaTime=i.absoluteTime-r,r=i.absoluteTime,delete i.absoluteTime}),n.push({deltaTime:0,meta:!0,type:"endOfTrack"}),n}),new Uint8Array((0,Hi.writeMidi)(t))}Rt.encode=os;(function(e){var t=$e&&$e.__awaiter||function(f,l,p,d){function y(m){return m instanceof p?m:new p(function(C){C(m)})}return new(p||(p=Promise))(function(m,C){function j(I){try{T(d.next(I))}catch(X){C(X)}}function U(I){try{T(d.throw(I))}catch(X){C(X)}}function T(I){I.done?m(I.value):y(I.value).then(j,U)}T((d=d.apply(f,l||[])).next())})},n=$e&&$e.__generator||function(f,l){var p={label:0,sent:function(){if(m[0]&1)throw m[1];return m[1]},trys:[],ops:[]},d,y,m,C;return C={next:j(0),throw:j(1),return:j(2)},typeof Symbol=="function"&&(C[Symbol.iterator]=function(){return this}),C;function j(T){return function(I){return U([T,I])}}function U(T){if(d)throw new TypeError("Generator is already executing.");for(;p;)try{if(d=1,y&&(m=T[0]&2?y.return:T[0]?y.throw||((m=y.return)&&m.call(y),0):y.next)&&!(m=m.call(y,T[1])).done)return m;switch(y=0,m&&(T=[T[0]&2,m.value]),T[0]){case 0:case 1:m=T;break;case 4:return p.label++,{value:T[1],done:!1};case 5:p.label++,y=T[1],T=[0];continue;case 7:T=p.ops.pop(),p.trys.pop();continue;default:if(m=p.trys,!(m=m.length>0&&m[m.length-1])&&(T[0]===6||T[0]===2)){p=0;continue}if(T[0]===3&&(!m||T[1]>m[0]&&T[1]<m[3])){p.label=T[1];break}if(T[0]===6&&p.label<m[1]){p.label=m[1],m=T;break}if(m&&p.label<m[2]){p.label=m[2],p.ops.push(T);break}m[2]&&p.ops.pop(),p.trys.pop();continue}T=l.call(f,p)}catch(I){T=[6,I],y=0}finally{d=m=0}if(T[0]&5)throw T[1];return{value:T[0]?T[1]:void 0,done:!0}}};Object.defineProperty(e,"__esModule",{value:!0}),e.Header=e.Track=e.Midi=void 0;var r=Bt,i=Nt,o=tt,s=Rt,c=function(){function f(l){var p=this,d=null;if(l){var y=l instanceof ArrayBuffer?new Uint8Array(l):l;d=(0,r.parseMidi)(y),d.tracks.forEach(function(m){var C=0;m.forEach(function(j){C+=j.deltaTime,j.absoluteTime=C})}),d.tracks=h(d.tracks)}this.header=new i.Header(d),this.tracks=[],l&&(this.tracks=d.tracks.map(function(m){return new o.Track(m,p.header)}),d.header.format===1&&this.tracks[0].duration===0&&this.tracks.shift())}return f.fromUrl=function(l){return t(this,void 0,void 0,function(){var p,d;return n(this,function(y){switch(y.label){case 0:return[4,fetch(l)];case 1:return p=y.sent(),p.ok?[4,p.arrayBuffer()]:[3,3];case 2:return d=y.sent(),[2,new f(d)];case 3:throw new Error("Could not load '".concat(l,"'"))}})})},Object.defineProperty(f.prototype,"name",{get:function(){return this.header.name},set:function(l){this.header.name=l},enumerable:!1,configurable:!0}),Object.defineProperty(f.prototype,"duration",{get:function(){var l=this.tracks.map(function(p){return p.duration});return Math.max.apply(Math,l)},enumerable:!1,configurable:!0}),Object.defineProperty(f.prototype,"durationTicks",{get:function(){var l=this.tracks.map(function(p){return p.durationTicks});return Math.max.apply(Math,l)},enumerable:!1,configurable:!0}),f.prototype.addTrack=function(){var l=new o.Track(void 0,this.header);return this.tracks.push(l),l},f.prototype.toArray=function(){return(0,s.encode)(this)},f.prototype.toJSON=function(){return{header:this.header.toJSON(),tracks:this.tracks.map(function(l){return l.toJSON()})}},f.prototype.fromJSON=function(l){var p=this;this.header=new i.Header,this.header.fromJSON(l.header),this.tracks=l.tracks.map(function(d){var y=new o.Track(void 0,p.header);return y.fromJSON(d),y})},f.prototype.clone=function(){var l=new f;return l.fromJSON(this.toJSON()),l},f}();e.Midi=c;var u=tt;Object.defineProperty(e,"Track",{enumerable:!0,get:function(){return u.Track}});var a=Nt;Object.defineProperty(e,"Header",{enumerable:!0,get:function(){return a.Header}});function h(f){for(var l=[],p=0;p<f.length;p++)for(var d=l.length,y=new Map,m=Array(16).fill(0),C=0,j=f[p];C<j.length;C++){var U=j[C],T=d,I=U.channel;if(I!==void 0){U.type==="programChange"&&(m[I]=U.programNumber);var X=m[I],w="".concat(X," ").concat(I);y.has(w)?T=y.get(w):(T=d+y.size,y.set(w,T))}l[T]||l.push([]),l[T].push(U)}return l}})(xr);const Xe=["C","C#","D","D#","E","F","F#","G","G#","A","A#","B"],Yn={Backquote:"A#2",Tab:"B2",KeyQ:"C3",Digit2:"C#3",KeyW:"D3",Digit3:"D#3",KeyE:"E3",KeyR:"F3",Digit5:"F#3",KeyT:"G3",Digit6:"G#3",KeyY:"A3",Digit7:"A#3",KeyU:"B3",KeyI:"C4",Digit9:"C#4",KeyO:"D4",Digit0:"D#4",KeyP:"E4",BracketLeft:"F4",Equal:"F#4",BracketRight:"G4",Backspace:"G#4",Backslash:"A4",CapsLock:"A#4",ShiftLeft:"B4",KeyZ:"C5",KeyS:"C#5",KeyX:"D5",KeyD:"D#5",KeyC:"E5",KeyV:"F5",KeyG:"F#5",KeyB:"G5",KeyH:"G#5",KeyN:"A5",KeyJ:"A#5",KeyM:"B5",Comma:"C6",KeyL:"C#6",Period:"D6",Semicolon:"D#6",Slash:"E6",ShiftRight:"F6",Enter:"F#6"};function sn(e){return parseInt(e.charAt(e.length-1))}function on(e){return e.substring(0,e.length-1)}function Jt(e){const t=Math.floor(e/12)-1;return Xe[e%12]+t}function as(e,t){const n=sn(t),r=sn(e),i=Xe.indexOf(on(e)),o=Xe.indexOf(on(t)),s={};let c=0;for(let u=r;u<=n;u++){let a=u===r?i:0;for(;a<Xe.length&&!(u===n&&a>o);){const f=Xe[a],l=f.length===1;s[f+u]={white:l,pressedColor:null,ghost:!1},l&&c++,a++}}return{noteMap:s,whiteKeys:c}}const re=te(!1),Fe=te(0),wt=te(0),an=te(),Ze=te(1);async function cs(e,t){let n=[],r=null;function i(a){r=new xr.Midi(a),r.tracks=r.tracks.filter(f=>f.notes.length!==0);let h=0;r.tracks.forEach(f=>{const l=f.notes[f.notes.length-1],p=l.time+l.duration;p>h&&(h=p)}),wt.set(h)}an.subscribe(a=>{if(re.set(!1),wt.set(0),Fe.set(0),!a){r=null;return}const h=new FileReader;h.onload=()=>i(h.result),h.readAsArrayBuffer(a)});function o(a){const h=pe(Fe)+a;Fe.set(h),r.tracks.forEach((f,l)=>{const p=f.notes[n[l]];if(!p)return;h-p.time>0&&(e(p.name,p.velocity),setTimeout(()=>t(p.name),p.duration*1e3/pe(Ze)),n[l]++)}),h>pe(wt)&&re.set(!1)}re.subscribe(a=>{if(!a)return;if(!r)return re.set(!1),alert("No MIDI file selected!");r.tracks.forEach((l,p)=>{let d=0,y=l.notes.length-1;for(;d!=y;){const m=Math.ceil((d+y)/2);l.notes[m].time>pe(Fe)?y=m-1:d=m}n[p]=d});let h=performance.now();const f=()=>{if(!pe(re))return;const l=performance.now(),p=l-h;h=l,o(p/1e3*pe(Ze)),requestAnimationFrame(f)};f()});function s(a){const[h,f,l]=a.data;h>143&&h<160?l==0?t(Jt(f)):e(Jt(f),l/127):h>127&&h<144&&t(Jt(f))}const c=await navigator.requestMIDIAccess();function u(){c.inputs.forEach(a=>{a.onmidimessage=s})}u(),c.onstatechange=()=>{u()}}const ge=Object.create(null);ge.open="0";ge.close="1";ge.ping="2";ge.pong="3";ge.message="4";ge.upgrade="5";ge.noop="6";const Tt=Object.create(null);Object.keys(ge).forEach(e=>{Tt[ge[e]]=e});const us={type:"error",data:"parser error"},ls=typeof Blob=="function"||typeof Blob!="undefined"&&Object.prototype.toString.call(Blob)==="[object BlobConstructor]",fs=typeof ArrayBuffer=="function",hs=e=>typeof ArrayBuffer.isView=="function"?ArrayBuffer.isView(e):e&&e.buffer instanceof ArrayBuffer,Or=({type:e,data:t},n,r)=>ls&&t instanceof Blob?n?r(t):Xn(t,r):fs&&(t instanceof ArrayBuffer||hs(t))?n?r(t):Xn(new Blob([t]),r):r(ge[e]+(t||"")),Xn=(e,t)=>{const n=new FileReader;return n.onload=function(){const r=n.result.split(",")[1];t("b"+r)},n.readAsDataURL(e)},Qn="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",Qe=typeof Uint8Array=="undefined"?[]:new Uint8Array(256);for(let e=0;e<Qn.length;e++)Qe[Qn.charCodeAt(e)]=e;const ds=e=>{let t=e.length*.75,n=e.length,r,i=0,o,s,c,u;e[e.length-1]==="="&&(t--,e[e.length-2]==="="&&t--);const a=new ArrayBuffer(t),h=new Uint8Array(a);for(r=0;r<n;r+=4)o=Qe[e.charCodeAt(r)],s=Qe[e.charCodeAt(r+1)],c=Qe[e.charCodeAt(r+2)],u=Qe[e.charCodeAt(r+3)],h[i++]=o<<2|s>>4,h[i++]=(s&15)<<4|c>>2,h[i++]=(c&3)<<6|u&63;return a},ps=typeof ArrayBuffer=="function",Nr=(e,t)=>{if(typeof e!="string")return{type:"message",data:Ar(e,t)};const n=e.charAt(0);return n==="b"?{type:"message",data:ms(e.substring(1),t)}:Tt[n]?e.length>1?{type:Tt[n],data:e.substring(1)}:{type:Tt[n]}:us},ms=(e,t)=>{if(ps){const n=ds(e);return Ar(n,t)}else return{base64:!0,data:e}},Ar=(e,t)=>{switch(t){case"blob":return e instanceof ArrayBuffer?new Blob([e]):e;case"arraybuffer":default:return e}},Er=String.fromCharCode(30),ys=(e,t)=>{const n=e.length,r=new Array(n);let i=0;e.forEach((o,s)=>{Or(o,!1,c=>{r[s]=c,++i===n&&t(r.join(Er))})})},gs=(e,t)=>{const n=e.split(Er),r=[];for(let i=0;i<n.length;i++){const o=Nr(n[i],t);if(r.push(o),o.type==="error")break}return r},Br=4;function V(e){if(e)return bs(e)}function bs(e){for(var t in V.prototype)e[t]=V.prototype[t];return e}V.prototype.on=V.prototype.addEventListener=function(e,t){return this._callbacks=this._callbacks||{},(this._callbacks["$"+e]=this._callbacks["$"+e]||[]).push(t),this};V.prototype.once=function(e,t){function n(){this.off(e,n),t.apply(this,arguments)}return n.fn=t,this.on(e,n),this};V.prototype.off=V.prototype.removeListener=V.prototype.removeAllListeners=V.prototype.removeEventListener=function(e,t){if(this._callbacks=this._callbacks||{},arguments.length==0)return this._callbacks={},this;var n=this._callbacks["$"+e];if(!n)return this;if(arguments.length==1)return delete this._callbacks["$"+e],this;for(var r,i=0;i<n.length;i++)if(r=n[i],r===t||r.fn===t){n.splice(i,1);break}return n.length===0&&delete this._callbacks["$"+e],this};V.prototype.emit=function(e){this._callbacks=this._callbacks||{};for(var t=new Array(arguments.length-1),n=this._callbacks["$"+e],r=1;r<arguments.length;r++)t[r-1]=arguments[r];if(n){n=n.slice(0);for(var r=0,i=n.length;r<i;++r)n[r].apply(this,t)}return this};V.prototype.emitReserved=V.prototype.emit;V.prototype.listeners=function(e){return this._callbacks=this._callbacks||{},this._callbacks["$"+e]||[]};V.prototype.hasListeners=function(e){return!!this.listeners(e).length};const Ee=(()=>typeof self!="undefined"?self:typeof window!="undefined"?window:Function("return this")())();function Pr(e,...t){return t.reduce((n,r)=>(e.hasOwnProperty(r)&&(n[r]=e[r]),n),{})}const vs=setTimeout,_s=clearTimeout;function qt(e,t){t.useNativeTimers?(e.setTimeoutFn=vs.bind(Ee),e.clearTimeoutFn=_s.bind(Ee)):(e.setTimeoutFn=setTimeout.bind(Ee),e.clearTimeoutFn=clearTimeout.bind(Ee))}const ks=1.33;function ws(e){return typeof e=="string"?Ts(e):Math.ceil((e.byteLength||e.size)*ks)}function Ts(e){let t=0,n=0;for(let r=0,i=e.length;r<i;r++)t=e.charCodeAt(r),t<128?n+=1:t<2048?n+=2:t<55296||t>=57344?n+=3:(r++,n+=4);return n}class xs extends Error{constructor(t,n,r){super(t),this.description=n,this.context=r,this.type="TransportError"}}class Ur extends V{constructor(t){super(),this.writable=!1,qt(this,t),this.opts=t,this.query=t.query,this.readyState="",this.socket=t.socket}onError(t,n,r){return super.emitReserved("error",new xs(t,n,r)),this}open(){return(this.readyState==="closed"||this.readyState==="")&&(this.readyState="opening",this.doOpen()),this}close(){return(this.readyState==="opening"||this.readyState==="open")&&(this.doClose(),this.onClose()),this}send(t){this.readyState==="open"&&this.write(t)}onOpen(){this.readyState="open",this.writable=!0,super.emitReserved("open")}onData(t){const n=Nr(t,this.socket.binaryType);this.onPacket(n)}onPacket(t){super.emitReserved("packet",t)}onClose(t){this.readyState="closed",super.emitReserved("close",t)}}const Mr="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz-_".split(""),cn=64,Ss={};let Zn=0,bt=0,er;function tr(e){let t="";do t=Mr[e%cn]+t,e=Math.floor(e/cn);while(e>0);return t}function Fr(){const e=tr(+new Date);return e!==er?(Zn=0,er=e):e+"."+tr(Zn++)}for(;bt<cn;bt++)Ss[Mr[bt]]=bt;function Rr(e){let t="";for(let n in e)e.hasOwnProperty(n)&&(t.length&&(t+="&"),t+=encodeURIComponent(n)+"="+encodeURIComponent(e[n]));return t}function Is(e){let t={},n=e.split("&");for(let r=0,i=n.length;r<i;r++){let o=n[r].split("=");t[decodeURIComponent(o[0])]=decodeURIComponent(o[1])}return t}let qr=!1;try{qr=typeof XMLHttpRequest!="undefined"&&"withCredentials"in new XMLHttpRequest}catch{}const Cs=qr;function Dr(e){const t=e.xdomain;try{if(typeof XMLHttpRequest!="undefined"&&(!t||Cs))return new XMLHttpRequest}catch{}if(!t)try{return new Ee[["Active"].concat("Object").join("X")]("Microsoft.XMLHTTP")}catch{}}function Os(){}const Ns=function(){return new Dr({xdomain:!1}).responseType!=null}();class As extends Ur{constructor(t){if(super(t),this.polling=!1,typeof location!="undefined"){const r=location.protocol==="https:";let i=location.port;i||(i=r?"443":"80"),this.xd=typeof location!="undefined"&&t.hostname!==location.hostname||i!==t.port,this.xs=t.secure!==r}const n=t&&t.forceBase64;this.supportsBinary=Ns&&!n}get name(){return"polling"}doOpen(){this.poll()}pause(t){this.readyState="pausing";const n=()=>{this.readyState="paused",t()};if(this.polling||!this.writable){let r=0;this.polling&&(r++,this.once("pollComplete",function(){--r||n()})),this.writable||(r++,this.once("drain",function(){--r||n()}))}else n()}poll(){this.polling=!0,this.doPoll(),this.emitReserved("poll")}onData(t){const n=r=>{if(this.readyState==="opening"&&r.type==="open"&&this.onOpen(),r.type==="close")return this.onClose({description:"transport closed by the server"}),!1;this.onPacket(r)};gs(t,this.socket.binaryType).forEach(n),this.readyState!=="closed"&&(this.polling=!1,this.emitReserved("pollComplete"),this.readyState==="open"&&this.poll())}doClose(){const t=()=>{this.write([{type:"close"}])};this.readyState==="open"?t():this.once("open",t)}write(t){this.writable=!1,ys(t,n=>{this.doWrite(n,()=>{this.writable=!0,this.emitReserved("drain")})})}uri(){let t=this.query||{};const n=this.opts.secure?"https":"http";let r="";this.opts.timestampRequests!==!1&&(t[this.opts.timestampParam]=Fr()),!this.supportsBinary&&!t.sid&&(t.b64=1),this.opts.port&&(n==="https"&&Number(this.opts.port)!==443||n==="http"&&Number(this.opts.port)!==80)&&(r=":"+this.opts.port);const i=Rr(t),o=this.opts.hostname.indexOf(":")!==-1;return n+"://"+(o?"["+this.opts.hostname+"]":this.opts.hostname)+r+this.opts.path+(i.length?"?"+i:"")}request(t={}){return Object.assign(t,{xd:this.xd,xs:this.xs},this.opts),new me(this.uri(),t)}doWrite(t,n){const r=this.request({method:"POST",data:t});r.on("success",n),r.on("error",(i,o)=>{this.onError("xhr post error",i,o)})}doPoll(){const t=this.request();t.on("data",this.onData.bind(this)),t.on("error",(n,r)=>{this.onError("xhr poll error",n,r)}),this.pollXhr=t}}class me extends V{constructor(t,n){super(),qt(this,n),this.opts=n,this.method=n.method||"GET",this.uri=t,this.async=n.async!==!1,this.data=n.data!==void 0?n.data:null,this.create()}create(){const t=Pr(this.opts,"agent","pfx","key","passphrase","cert","ca","ciphers","rejectUnauthorized","autoUnref");t.xdomain=!!this.opts.xd,t.xscheme=!!this.opts.xs;const n=this.xhr=new Dr(t);try{n.open(this.method,this.uri,this.async);try{if(this.opts.extraHeaders){n.setDisableHeaderCheck&&n.setDisableHeaderCheck(!0);for(let r in this.opts.extraHeaders)this.opts.extraHeaders.hasOwnProperty(r)&&n.setRequestHeader(r,this.opts.extraHeaders[r])}}catch{}if(this.method==="POST")try{n.setRequestHeader("Content-type","text/plain;charset=UTF-8")}catch{}try{n.setRequestHeader("Accept","*/*")}catch{}"withCredentials"in n&&(n.withCredentials=this.opts.withCredentials),this.opts.requestTimeout&&(n.timeout=this.opts.requestTimeout),n.onreadystatechange=()=>{n.readyState===4&&(n.status===200||n.status===1223?this.onLoad():this.setTimeoutFn(()=>{this.onError(typeof n.status=="number"?n.status:0)},0))},n.send(this.data)}catch(r){this.setTimeoutFn(()=>{this.onError(r)},0);return}typeof document!="undefined"&&(this.index=me.requestsCount++,me.requests[this.index]=this)}onError(t){this.emitReserved("error",t,this.xhr),this.cleanup(!0)}cleanup(t){if(!(typeof this.xhr=="undefined"||this.xhr===null)){if(this.xhr.onreadystatechange=Os,t)try{this.xhr.abort()}catch{}typeof document!="undefined"&&delete me.requests[this.index],this.xhr=null}}onLoad(){const t=this.xhr.responseText;t!==null&&(this.emitReserved("data",t),this.emitReserved("success"),this.cleanup())}abort(){this.cleanup()}}me.requestsCount=0;me.requests={};if(typeof document!="undefined"){if(typeof attachEvent=="function")attachEvent("onunload",nr);else if(typeof addEventListener=="function"){const e="onpagehide"in Ee?"pagehide":"unload";addEventListener(e,nr,!1)}}function nr(){for(let e in me.requests)me.requests.hasOwnProperty(e)&&me.requests[e].abort()}const Es=(()=>typeof Promise=="function"&&typeof Promise.resolve=="function"?t=>Promise.resolve().then(t):(t,n)=>n(t,0))(),vt=Ee.WebSocket||Ee.MozWebSocket,rr=!0,Bs="arraybuffer",ir=typeof navigator!="undefined"&&typeof navigator.product=="string"&&navigator.product.toLowerCase()==="reactnative";class Ps extends Ur{constructor(t){super(t),this.supportsBinary=!t.forceBase64}get name(){return"websocket"}doOpen(){if(!this.check())return;const t=this.uri(),n=this.opts.protocols,r=ir?{}:Pr(this.opts,"agent","perMessageDeflate","pfx","key","passphrase","cert","ca","ciphers","rejectUnauthorized","localAddress","protocolVersion","origin","maxPayload","family","checkServerIdentity");this.opts.extraHeaders&&(r.headers=this.opts.extraHeaders);try{this.ws=rr&&!ir?n?new vt(t,n):new vt(t):new vt(t,n,r)}catch(i){return this.emitReserved("error",i)}this.ws.binaryType=this.socket.binaryType||Bs,this.addEventListeners()}addEventListeners(){this.ws.onopen=()=>{this.opts.autoUnref&&this.ws._socket.unref(),this.onOpen()},this.ws.onclose=t=>this.onClose({description:"websocket connection closed",context:t}),this.ws.onmessage=t=>this.onData(t.data),this.ws.onerror=t=>this.onError("websocket error",t)}write(t){this.writable=!1;for(let n=0;n<t.length;n++){const r=t[n],i=n===t.length-1;Or(r,this.supportsBinary,o=>{const s={};try{rr&&this.ws.send(o)}catch{}i&&Es(()=>{this.writable=!0,this.emitReserved("drain")},this.setTimeoutFn)})}}doClose(){typeof this.ws!="undefined"&&(this.ws.close(),this.ws=null)}uri(){let t=this.query||{};const n=this.opts.secure?"wss":"ws";let r="";this.opts.port&&(n==="wss"&&Number(this.opts.port)!==443||n==="ws"&&Number(this.opts.port)!==80)&&(r=":"+this.opts.port),this.opts.timestampRequests&&(t[this.opts.timestampParam]=Fr()),this.supportsBinary||(t.b64=1);const i=Rr(t),o=this.opts.hostname.indexOf(":")!==-1;return n+"://"+(o?"["+this.opts.hostname+"]":this.opts.hostname)+r+this.opts.path+(i.length?"?"+i:"")}check(){return!!vt}}const Us={websocket:Ps,polling:As},Ms=/^(?:(?![^:@]+:[^:@\/]*@)(http|https|ws|wss):\/\/)?((?:(([^:@]*)(?::([^:@]*))?)?@)?((?:[a-f0-9]{0,4}:){2,7}[a-f0-9]{0,4}|[^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/,Fs=["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"];function un(e){const t=e,n=e.indexOf("["),r=e.indexOf("]");n!=-1&&r!=-1&&(e=e.substring(0,n)+e.substring(n,r).replace(/:/g,";")+e.substring(r,e.length));let i=Ms.exec(e||""),o={},s=14;for(;s--;)o[Fs[s]]=i[s]||"";return n!=-1&&r!=-1&&(o.source=t,o.host=o.host.substring(1,o.host.length-1).replace(/;/g,":"),o.authority=o.authority.replace("[","").replace("]","").replace(/;/g,":"),o.ipv6uri=!0),o.pathNames=Rs(o,o.path),o.queryKey=qs(o,o.query),o}function Rs(e,t){const n=/\/{2,9}/g,r=t.replace(n,"/").split("/");return(t.substr(0,1)=="/"||t.length===0)&&r.splice(0,1),t.substr(t.length-1,1)=="/"&&r.splice(r.length-1,1),r}function qs(e,t){const n={};return t.replace(/(?:^|&)([^&=]*)=?([^&]*)/g,function(r,i,o){i&&(n[i]=o)}),n}class Ae extends V{constructor(t,n={}){super(),t&&typeof t=="object"&&(n=t,t=null),t?(t=un(t),n.hostname=t.host,n.secure=t.protocol==="https"||t.protocol==="wss",n.port=t.port,t.query&&(n.query=t.query)):n.host&&(n.hostname=un(n.host).host),qt(this,n),this.secure=n.secure!=null?n.secure:typeof location!="undefined"&&location.protocol==="https:",n.hostname&&!n.port&&(n.port=this.secure?"443":"80"),this.hostname=n.hostname||(typeof location!="undefined"?location.hostname:"localhost"),this.port=n.port||(typeof location!="undefined"&&location.port?location.port:this.secure?"443":"80"),this.transports=n.transports||["polling","websocket"],this.readyState="",this.writeBuffer=[],this.prevBufferLen=0,this.opts=Object.assign({path:"/engine.io",agent:!1,withCredentials:!1,upgrade:!0,timestampParam:"t",rememberUpgrade:!1,rejectUnauthorized:!0,perMessageDeflate:{threshold:1024},transportOptions:{},closeOnBeforeunload:!0},n),this.opts.path=this.opts.path.replace(/\/$/,"")+"/",typeof this.opts.query=="string"&&(this.opts.query=Is(this.opts.query)),this.id=null,this.upgrades=null,this.pingInterval=null,this.pingTimeout=null,this.pingTimeoutTimer=null,typeof addEventListener=="function"&&(this.opts.closeOnBeforeunload&&addEventListener("beforeunload",()=>{this.transport&&(this.transport.removeAllListeners(),this.transport.close())},!1),this.hostname!=="localhost"&&(this.offlineEventListener=()=>{this.onClose("transport close",{description:"network connection lost"})},addEventListener("offline",this.offlineEventListener,!1))),this.open()}createTransport(t){const n=Object.assign({},this.opts.query);n.EIO=Br,n.transport=t,this.id&&(n.sid=this.id);const r=Object.assign({},this.opts.transportOptions[t],this.opts,{query:n,socket:this,hostname:this.hostname,secure:this.secure,port:this.port});return new Us[t](r)}open(){let t;if(this.opts.rememberUpgrade&&Ae.priorWebsocketSuccess&&this.transports.indexOf("websocket")!==-1)t="websocket";else if(this.transports.length===0){this.setTimeoutFn(()=>{this.emitReserved("error","No transports available")},0);return}else t=this.transports[0];this.readyState="opening";try{t=this.createTransport(t)}catch{this.transports.shift(),this.open();return}t.open(),this.setTransport(t)}setTransport(t){this.transport&&this.transport.removeAllListeners(),this.transport=t,t.on("drain",this.onDrain.bind(this)).on("packet",this.onPacket.bind(this)).on("error",this.onError.bind(this)).on("close",n=>this.onClose("transport close",n))}probe(t){let n=this.createTransport(t),r=!1;Ae.priorWebsocketSuccess=!1;const i=()=>{r||(n.send([{type:"ping",data:"probe"}]),n.once("packet",f=>{if(!r)if(f.type==="pong"&&f.data==="probe"){if(this.upgrading=!0,this.emitReserved("upgrading",n),!n)return;Ae.priorWebsocketSuccess=n.name==="websocket",this.transport.pause(()=>{r||this.readyState!=="closed"&&(h(),this.setTransport(n),n.send([{type:"upgrade"}]),this.emitReserved("upgrade",n),n=null,this.upgrading=!1,this.flush())})}else{const l=new Error("probe error");l.transport=n.name,this.emitReserved("upgradeError",l)}}))};function o(){r||(r=!0,h(),n.close(),n=null)}const s=f=>{const l=new Error("probe error: "+f);l.transport=n.name,o(),this.emitReserved("upgradeError",l)};function c(){s("transport closed")}function u(){s("socket closed")}function a(f){n&&f.name!==n.name&&o()}const h=()=>{n.removeListener("open",i),n.removeListener("error",s),n.removeListener("close",c),this.off("close",u),this.off("upgrading",a)};n.once("open",i),n.once("error",s),n.once("close",c),this.once("close",u),this.once("upgrading",a),n.open()}onOpen(){if(this.readyState="open",Ae.priorWebsocketSuccess=this.transport.name==="websocket",this.emitReserved("open"),this.flush(),this.readyState==="open"&&this.opts.upgrade&&this.transport.pause){let t=0;const n=this.upgrades.length;for(;t<n;t++)this.probe(this.upgrades[t])}}onPacket(t){if(this.readyState==="opening"||this.readyState==="open"||this.readyState==="closing")switch(this.emitReserved("packet",t),this.emitReserved("heartbeat"),t.type){case"open":this.onHandshake(JSON.parse(t.data));break;case"ping":this.resetPingTimeout(),this.sendPacket("pong"),this.emitReserved("ping"),this.emitReserved("pong");break;case"error":const n=new Error("server error");n.code=t.data,this.onError(n);break;case"message":this.emitReserved("data",t.data),this.emitReserved("message",t.data);break}}onHandshake(t){this.emitReserved("handshake",t),this.id=t.sid,this.transport.query.sid=t.sid,this.upgrades=this.filterUpgrades(t.upgrades),this.pingInterval=t.pingInterval,this.pingTimeout=t.pingTimeout,this.maxPayload=t.maxPayload,this.onOpen(),this.readyState!=="closed"&&this.resetPingTimeout()}resetPingTimeout(){this.clearTimeoutFn(this.pingTimeoutTimer),this.pingTimeoutTimer=this.setTimeoutFn(()=>{this.onClose("ping timeout")},this.pingInterval+this.pingTimeout),this.opts.autoUnref&&this.pingTimeoutTimer.unref()}onDrain(){this.writeBuffer.splice(0,this.prevBufferLen),this.prevBufferLen=0,this.writeBuffer.length===0?this.emitReserved("drain"):this.flush()}flush(){if(this.readyState!=="closed"&&this.transport.writable&&!this.upgrading&&this.writeBuffer.length){const t=this.getWritablePackets();this.transport.send(t),this.prevBufferLen=t.length,this.emitReserved("flush")}}getWritablePackets(){if(!(this.maxPayload&&this.transport.name==="polling"&&this.writeBuffer.length>1))return this.writeBuffer;let n=1;for(let r=0;r<this.writeBuffer.length;r++){const i=this.writeBuffer[r].data;if(i&&(n+=ws(i)),r>0&&n>this.maxPayload)return this.writeBuffer.slice(0,r);n+=2}return this.writeBuffer}write(t,n,r){return this.sendPacket("message",t,n,r),this}send(t,n,r){return this.sendPacket("message",t,n,r),this}sendPacket(t,n,r,i){if(typeof n=="function"&&(i=n,n=void 0),typeof r=="function"&&(i=r,r=null),this.readyState==="closing"||this.readyState==="closed")return;r=r||{},r.compress=r.compress!==!1;const o={type:t,data:n,options:r};this.emitReserved("packetCreate",o),this.writeBuffer.push(o),i&&this.once("flush",i),this.flush()}close(){const t=()=>{this.onClose("forced close"),this.transport.close()},n=()=>{this.off("upgrade",n),this.off("upgradeError",n),t()},r=()=>{this.once("upgrade",n),this.once("upgradeError",n)};return(this.readyState==="opening"||this.readyState==="open")&&(this.readyState="closing",this.writeBuffer.length?this.once("drain",()=>{this.upgrading?r():t()}):this.upgrading?r():t()),this}onError(t){Ae.priorWebsocketSuccess=!1,this.emitReserved("error",t),this.onClose("transport error",t)}onClose(t,n){(this.readyState==="opening"||this.readyState==="open"||this.readyState==="closing")&&(this.clearTimeoutFn(this.pingTimeoutTimer),this.transport.removeAllListeners("close"),this.transport.close(),this.transport.removeAllListeners(),typeof removeEventListener=="function"&&removeEventListener("offline",this.offlineEventListener,!1),this.readyState="closed",this.id=null,this.emitReserved("close",t,n),this.writeBuffer=[],this.prevBufferLen=0)}filterUpgrades(t){const n=[];let r=0;const i=t.length;for(;r<i;r++)~this.transports.indexOf(t[r])&&n.push(t[r]);return n}}Ae.protocol=Br;function Ds(e,t="",n){let r=e;n=n||typeof location!="undefined"&&location,e==null&&(e=n.protocol+"//"+n.host),typeof e=="string"&&(e.charAt(0)==="/"&&(e.charAt(1)==="/"?e=n.protocol+e:e=n.host+e),/^(https?|wss?):\/\//.test(e)||(typeof n!="undefined"?e=n.protocol+"//"+e:e="https://"+e),r=un(e)),r.port||(/^(http|ws)$/.test(r.protocol)?r.port="80":/^(http|ws)s$/.test(r.protocol)&&(r.port="443")),r.path=r.path||"/";const o=r.host.indexOf(":")!==-1?"["+r.host+"]":r.host;return r.id=r.protocol+"://"+o+":"+r.port+t,r.href=r.protocol+"://"+o+(n&&n.port===r.port?"":":"+r.port),r}const js=typeof ArrayBuffer=="function",Ls=e=>typeof ArrayBuffer.isView=="function"?ArrayBuffer.isView(e):e.buffer instanceof ArrayBuffer,jr=Object.prototype.toString,Vs=typeof Blob=="function"||typeof Blob!="undefined"&&jr.call(Blob)==="[object BlobConstructor]",Ks=typeof File=="function"||typeof File!="undefined"&&jr.call(File)==="[object FileConstructor]";function kn(e){return js&&(e instanceof ArrayBuffer||Ls(e))||Vs&&e instanceof Blob||Ks&&e instanceof File}function xt(e,t){if(!e||typeof e!="object")return!1;if(Array.isArray(e)){for(let n=0,r=e.length;n<r;n++)if(xt(e[n]))return!0;return!1}if(kn(e))return!0;if(e.toJSON&&typeof e.toJSON=="function"&&arguments.length===1)return xt(e.toJSON(),!0);for(const n in e)if(Object.prototype.hasOwnProperty.call(e,n)&&xt(e[n]))return!0;return!1}function $s(e){const t=[],n=e.data,r=e;return r.data=ln(n,t),r.attachments=t.length,{packet:r,buffers:t}}function ln(e,t){if(!e)return e;if(kn(e)){const n={_placeholder:!0,num:t.length};return t.push(e),n}else if(Array.isArray(e)){const n=new Array(e.length);for(let r=0;r<e.length;r++)n[r]=ln(e[r],t);return n}else if(typeof e=="object"&&!(e instanceof Date)){const n={};for(const r in e)Object.prototype.hasOwnProperty.call(e,r)&&(n[r]=ln(e[r],t));return n}return e}function Hs(e,t){return e.data=fn(e.data,t),e.attachments=void 0,e}function fn(e,t){if(!e)return e;if(e&&e._placeholder)return t[e.num];if(Array.isArray(e))for(let n=0;n<e.length;n++)e[n]=fn(e[n],t);else if(typeof e=="object")for(const n in e)Object.prototype.hasOwnProperty.call(e,n)&&(e[n]=fn(e[n],t));return e}const zs=5;var N;(function(e){e[e.CONNECT=0]="CONNECT",e[e.DISCONNECT=1]="DISCONNECT",e[e.EVENT=2]="EVENT",e[e.ACK=3]="ACK",e[e.CONNECT_ERROR=4]="CONNECT_ERROR",e[e.BINARY_EVENT=5]="BINARY_EVENT",e[e.BINARY_ACK=6]="BINARY_ACK"})(N||(N={}));class Js{constructor(t){this.replacer=t}encode(t){return(t.type===N.EVENT||t.type===N.ACK)&&xt(t)?(t.type=t.type===N.EVENT?N.BINARY_EVENT:N.BINARY_ACK,this.encodeAsBinary(t)):[this.encodeAsString(t)]}encodeAsString(t){let n=""+t.type;return(t.type===N.BINARY_EVENT||t.type===N.BINARY_ACK)&&(n+=t.attachments+"-"),t.nsp&&t.nsp!=="/"&&(n+=t.nsp+","),t.id!=null&&(n+=t.id),t.data!=null&&(n+=JSON.stringify(t.data,this.replacer)),n}encodeAsBinary(t){const n=$s(t),r=this.encodeAsString(n.packet),i=n.buffers;return i.unshift(r),i}}class wn extends V{constructor(t){super(),this.reviver=t}add(t){let n;if(typeof t=="string")n=this.decodeString(t),n.type===N.BINARY_EVENT||n.type===N.BINARY_ACK?(this.reconstructor=new Gs(n),n.attachments===0&&super.emitReserved("decoded",n)):super.emitReserved("decoded",n);else if(kn(t)||t.base64)if(this.reconstructor)n=this.reconstructor.takeBinaryData(t),n&&(this.reconstructor=null,super.emitReserved("decoded",n));else throw new Error("got binary data when not reconstructing a packet");else throw new Error("Unknown type: "+t)}decodeString(t){let n=0;const r={type:Number(t.charAt(0))};if(N[r.type]===void 0)throw new Error("unknown packet type "+r.type);if(r.type===N.BINARY_EVENT||r.type===N.BINARY_ACK){const o=n+1;for(;t.charAt(++n)!=="-"&&n!=t.length;);const s=t.substring(o,n);if(s!=Number(s)||t.charAt(n)!=="-")throw new Error("Illegal attachments");r.attachments=Number(s)}if(t.charAt(n+1)==="/"){const o=n+1;for(;++n&&!(t.charAt(n)===","||n===t.length););r.nsp=t.substring(o,n)}else r.nsp="/";const i=t.charAt(n+1);if(i!==""&&Number(i)==i){const o=n+1;for(;++n;){const s=t.charAt(n);if(s==null||Number(s)!=s){--n;break}if(n===t.length)break}r.id=Number(t.substring(o,n+1))}if(t.charAt(++n)){const o=this.tryParse(t.substr(n));if(wn.isPayloadValid(r.type,o))r.data=o;else throw new Error("invalid payload")}return r}tryParse(t){try{return JSON.parse(t,this.reviver)}catch{return!1}}static isPayloadValid(t,n){switch(t){case N.CONNECT:return typeof n=="object";case N.DISCONNECT:return n===void 0;case N.CONNECT_ERROR:return typeof n=="string"||typeof n=="object";case N.EVENT:case N.BINARY_EVENT:return Array.isArray(n)&&n.length>0;case N.ACK:case N.BINARY_ACK:return Array.isArray(n)}}destroy(){this.reconstructor&&this.reconstructor.finishedReconstruction()}}class Gs{constructor(t){this.packet=t,this.buffers=[],this.reconPack=t}takeBinaryData(t){if(this.buffers.push(t),this.buffers.length===this.reconPack.attachments){const n=Hs(this.reconPack,this.buffers);return this.finishedReconstruction(),n}return null}finishedReconstruction(){this.reconPack=null,this.buffers=[]}}var Ws=Object.freeze(Object.defineProperty({__proto__:null,protocol:zs,get PacketType(){return N},Encoder:Js,Decoder:wn},Symbol.toStringTag,{value:"Module"}));function ae(e,t,n){return e.on(t,n),function(){e.off(t,n)}}const Ys=Object.freeze({connect:1,connect_error:1,disconnect:1,disconnecting:1,newListener:1,removeListener:1});class Lr extends V{constructor(t,n,r){super(),this.connected=!1,this.receiveBuffer=[],this.sendBuffer=[],this.ids=0,this.acks={},this.flags={},this.io=t,this.nsp=n,r&&r.auth&&(this.auth=r.auth),this.io._autoConnect&&this.open()}get disconnected(){return!this.connected}subEvents(){if(this.subs)return;const t=this.io;this.subs=[ae(t,"open",this.onopen.bind(this)),ae(t,"packet",this.onpacket.bind(this)),ae(t,"error",this.onerror.bind(this)),ae(t,"close",this.onclose.bind(this))]}get active(){return!!this.subs}connect(){return this.connected?this:(this.subEvents(),this.io._reconnecting||this.io.open(),this.io._readyState==="open"&&this.onopen(),this)}open(){return this.connect()}send(...t){return t.unshift("message"),this.emit.apply(this,t),this}emit(t,...n){if(Ys.hasOwnProperty(t))throw new Error('"'+t+'" is a reserved event name');n.unshift(t);const r={type:N.EVENT,data:n};if(r.options={},r.options.compress=this.flags.compress!==!1,typeof n[n.length-1]=="function"){const s=this.ids++,c=n.pop();this._registerAckCallback(s,c),r.id=s}const i=this.io.engine&&this.io.engine.transport&&this.io.engine.transport.writable;return this.flags.volatile&&(!i||!this.connected)||(this.connected?(this.notifyOutgoingListeners(r),this.packet(r)):this.sendBuffer.push(r)),this.flags={},this}_registerAckCallback(t,n){const r=this.flags.timeout;if(r===void 0){this.acks[t]=n;return}const i=this.io.setTimeoutFn(()=>{delete this.acks[t];for(let o=0;o<this.sendBuffer.length;o++)this.sendBuffer[o].id===t&&this.sendBuffer.splice(o,1);n.call(this,new Error("operation has timed out"))},r);this.acks[t]=(...o)=>{this.io.clearTimeoutFn(i),n.apply(this,[null,...o])}}packet(t){t.nsp=this.nsp,this.io._packet(t)}onopen(){typeof this.auth=="function"?this.auth(t=>{this.packet({type:N.CONNECT,data:t})}):this.packet({type:N.CONNECT,data:this.auth})}onerror(t){this.connected||this.emitReserved("connect_error",t)}onclose(t,n){this.connected=!1,delete this.id,this.emitReserved("disconnect",t,n)}onpacket(t){if(t.nsp===this.nsp)switch(t.type){case N.CONNECT:if(t.data&&t.data.sid){const i=t.data.sid;this.onconnect(i)}else this.emitReserved("connect_error",new Error("It seems you are trying to reach a Socket.IO server in v2.x with a v3.x client, but they are not compatible (more information here: https://socket.io/docs/v3/migrating-from-2-x-to-3-0/)"));break;case N.EVENT:case N.BINARY_EVENT:this.onevent(t);break;case N.ACK:case N.BINARY_ACK:this.onack(t);break;case N.DISCONNECT:this.ondisconnect();break;case N.CONNECT_ERROR:this.destroy();const r=new Error(t.data.message);r.data=t.data.data,this.emitReserved("connect_error",r);break}}onevent(t){const n=t.data||[];t.id!=null&&n.push(this.ack(t.id)),this.connected?this.emitEvent(n):this.receiveBuffer.push(Object.freeze(n))}emitEvent(t){if(this._anyListeners&&this._anyListeners.length){const n=this._anyListeners.slice();for(const r of n)r.apply(this,t)}super.emit.apply(this,t)}ack(t){const n=this;let r=!1;return function(...i){r||(r=!0,n.packet({type:N.ACK,id:t,data:i}))}}onack(t){const n=this.acks[t.id];typeof n=="function"&&(n.apply(this,t.data),delete this.acks[t.id])}onconnect(t){this.id=t,this.connected=!0,this.emitBuffered(),this.emitReserved("connect")}emitBuffered(){this.receiveBuffer.forEach(t=>this.emitEvent(t)),this.receiveBuffer=[],this.sendBuffer.forEach(t=>{this.notifyOutgoingListeners(t),this.packet(t)}),this.sendBuffer=[]}ondisconnect(){this.destroy(),this.onclose("io server disconnect")}destroy(){this.subs&&(this.subs.forEach(t=>t()),this.subs=void 0),this.io._destroy(this)}disconnect(){return this.connected&&this.packet({type:N.DISCONNECT}),this.destroy(),this.connected&&this.onclose("io client disconnect"),this}close(){return this.disconnect()}compress(t){return this.flags.compress=t,this}get volatile(){return this.flags.volatile=!0,this}timeout(t){return this.flags.timeout=t,this}onAny(t){return this._anyListeners=this._anyListeners||[],this._anyListeners.push(t),this}prependAny(t){return this._anyListeners=this._anyListeners||[],this._anyListeners.unshift(t),this}offAny(t){if(!this._anyListeners)return this;if(t){const n=this._anyListeners;for(let r=0;r<n.length;r++)if(t===n[r])return n.splice(r,1),this}else this._anyListeners=[];return this}listenersAny(){return this._anyListeners||[]}onAnyOutgoing(t){return this._anyOutgoingListeners=this._anyOutgoingListeners||[],this._anyOutgoingListeners.push(t),this}prependAnyOutgoing(t){return this._anyOutgoingListeners=this._anyOutgoingListeners||[],this._anyOutgoingListeners.unshift(t),this}offAnyOutgoing(t){if(!this._anyOutgoingListeners)return this;if(t){const n=this._anyOutgoingListeners;for(let r=0;r<n.length;r++)if(t===n[r])return n.splice(r,1),this}else this._anyOutgoingListeners=[];return this}listenersAnyOutgoing(){return this._anyOutgoingListeners||[]}notifyOutgoingListeners(t){if(this._anyOutgoingListeners&&this._anyOutgoingListeners.length){const n=this._anyOutgoingListeners.slice();for(const r of n)r.apply(this,t.data)}}}function Je(e){e=e||{},this.ms=e.min||100,this.max=e.max||1e4,this.factor=e.factor||2,this.jitter=e.jitter>0&&e.jitter<=1?e.jitter:0,this.attempts=0}Je.prototype.duration=function(){var e=this.ms*Math.pow(this.factor,this.attempts++);if(this.jitter){var t=Math.random(),n=Math.floor(t*this.jitter*e);e=(Math.floor(t*10)&1)==0?e-n:e+n}return Math.min(e,this.max)|0};Je.prototype.reset=function(){this.attempts=0};Je.prototype.setMin=function(e){this.ms=e};Je.prototype.setMax=function(e){this.max=e};Je.prototype.setJitter=function(e){this.jitter=e};class hn extends V{constructor(t,n){var r;super(),this.nsps={},this.subs=[],t&&typeof t=="object"&&(n=t,t=void 0),n=n||{},n.path=n.path||"/socket.io",this.opts=n,qt(this,n),this.reconnection(n.reconnection!==!1),this.reconnectionAttempts(n.reconnectionAttempts||1/0),this.reconnectionDelay(n.reconnectionDelay||1e3),this.reconnectionDelayMax(n.reconnectionDelayMax||5e3),this.randomizationFactor((r=n.randomizationFactor)!==null&&r!==void 0?r:.5),this.backoff=new Je({min:this.reconnectionDelay(),max:this.reconnectionDelayMax(),jitter:this.randomizationFactor()}),this.timeout(n.timeout==null?2e4:n.timeout),this._readyState="closed",this.uri=t;const i=n.parser||Ws;this.encoder=new i.Encoder,this.decoder=new i.Decoder,this._autoConnect=n.autoConnect!==!1,this._autoConnect&&this.open()}reconnection(t){return arguments.length?(this._reconnection=!!t,this):this._reconnection}reconnectionAttempts(t){return t===void 0?this._reconnectionAttempts:(this._reconnectionAttempts=t,this)}reconnectionDelay(t){var n;return t===void 0?this._reconnectionDelay:(this._reconnectionDelay=t,(n=this.backoff)===null||n===void 0||n.setMin(t),this)}randomizationFactor(t){var n;return t===void 0?this._randomizationFactor:(this._randomizationFactor=t,(n=this.backoff)===null||n===void 0||n.setJitter(t),this)}reconnectionDelayMax(t){var n;return t===void 0?this._reconnectionDelayMax:(this._reconnectionDelayMax=t,(n=this.backoff)===null||n===void 0||n.setMax(t),this)}timeout(t){return arguments.length?(this._timeout=t,this):this._timeout}maybeReconnectOnOpen(){!this._reconnecting&&this._reconnection&&this.backoff.attempts===0&&this.reconnect()}open(t){if(~this._readyState.indexOf("open"))return this;this.engine=new Ae(this.uri,this.opts);const n=this.engine,r=this;this._readyState="opening",this.skipReconnect=!1;const i=ae(n,"open",function(){r.onopen(),t&&t()}),o=ae(n,"error",s=>{r.cleanup(),r._readyState="closed",this.emitReserved("error",s),t?t(s):r.maybeReconnectOnOpen()});if(this._timeout!==!1){const s=this._timeout;s===0&&i();const c=this.setTimeoutFn(()=>{i(),n.close(),n.emit("error",new Error("timeout"))},s);this.opts.autoUnref&&c.unref(),this.subs.push(function(){clearTimeout(c)})}return this.subs.push(i),this.subs.push(o),this}connect(t){return this.open(t)}onopen(){this.cleanup(),this._readyState="open",this.emitReserved("open");const t=this.engine;this.subs.push(ae(t,"ping",this.onping.bind(this)),ae(t,"data",this.ondata.bind(this)),ae(t,"error",this.onerror.bind(this)),ae(t,"close",this.onclose.bind(this)),ae(this.decoder,"decoded",this.ondecoded.bind(this)))}onping(){this.emitReserved("ping")}ondata(t){this.decoder.add(t)}ondecoded(t){this.emitReserved("packet",t)}onerror(t){this.emitReserved("error",t)}socket(t,n){let r=this.nsps[t];return r||(r=new Lr(this,t,n),this.nsps[t]=r),r}_destroy(t){const n=Object.keys(this.nsps);for(const r of n)if(this.nsps[r].active)return;this._close()}_packet(t){const n=this.encoder.encode(t);for(let r=0;r<n.length;r++)this.engine.write(n[r],t.options)}cleanup(){this.subs.forEach(t=>t()),this.subs.length=0,this.decoder.destroy()}_close(){this.skipReconnect=!0,this._reconnecting=!1,this.onclose("forced close"),this.engine&&this.engine.close()}disconnect(){return this._close()}onclose(t,n){this.cleanup(),this.backoff.reset(),this._readyState="closed",this.emitReserved("close",t,n),this._reconnection&&!this.skipReconnect&&this.reconnect()}reconnect(){if(this._reconnecting||this.skipReconnect)return this;const t=this;if(this.backoff.attempts>=this._reconnectionAttempts)this.backoff.reset(),this.emitReserved("reconnect_failed"),this._reconnecting=!1;else{const n=this.backoff.duration();this._reconnecting=!0;const r=this.setTimeoutFn(()=>{t.skipReconnect||(this.emitReserved("reconnect_attempt",t.backoff.attempts),!t.skipReconnect&&t.open(i=>{i?(t._reconnecting=!1,t.reconnect(),this.emitReserved("reconnect_error",i)):t.onreconnect()}))},n);this.opts.autoUnref&&r.unref(),this.subs.push(function(){clearTimeout(r)})}}onreconnect(){const t=this.backoff.attempts;this._reconnecting=!1,this.backoff.reset(),this.emitReserved("reconnect",t)}}const We={};function St(e,t){typeof e=="object"&&(t=e,e=void 0),t=t||{};const n=Ds(e,t.path||"/socket.io"),r=n.source,i=n.id,o=n.path,s=We[i]&&o in We[i].nsps,c=t.forceNew||t["force new connection"]||t.multiplex===!1||s;let u;return c?u=new hn(r,t):(We[i]||(We[i]=new hn(r,t)),u=We[i]),n.query&&!t.query&&(t.query=n.queryKey),u.socket(n.path,t)}Object.assign(St,{Manager:hn,Socket:Lr,io:St,connect:St});var Vr={exports:{}},Kr={exports:{}};function Xs(e){return e>64&&e<91?e-65:e>96&&e<123?e-71:e>47&&e<58?e+4:e===43?62:e===47?63:0}function Qs(e,t){for(var n=e.replace(/[^A-Za-z0-9\+\/]/g,""),r=n.length,i=t?Math.ceil((r*3+1>>2)/t)*t:r*3+1>>2,o=new Uint8Array(i),s,c,u=0,a=0,h=0;h<r;h++)if(c=h&3,u|=Xs(n.charCodeAt(h))<<18-6*c,c===3||r-h===1){for(s=0;s<3&&a<i;s++,a++)o[a]=u>>>(16>>>s&24)&255;u=0}return o}var Zs={decode:Qs},eo=function(e,t){return new Promise(function(n,r){var i=new XMLHttpRequest;t&&(i.responseType=t),i.open("GET",e),i.onload=function(){i.status===200?n(i.response):r(Error(i.statusText))},i.onerror=function(){r(Error("Network Error"))},i.send()})};(function(e){var t=Zs,n=eo;function r(w){return function(_){return typeof _=="string"&&w.test(_)}}function i(w,_){return typeof w=="string"?w+_:typeof w=="function"?w(_):_}function o(w,_,A,E){var ee=s(_)?c:u(_)?a:h(_)?f:l(_)?p:d(_)?y:m(_)?C:j(_)?U:T(_)?I:null,J=A||{};return ee?ee(w,_,J):E?Promise.resolve(E):Promise.reject("Source not valid ("+_+")")}o.fetch=n;function s(w){return w instanceof ArrayBuffer}function c(w,_,A){return new Promise(function(E,ee){w.decodeAudioData(_,function(J){E(J)},function(){ee("Can't decode audio data ("+_.slice(0,30)+"...)")})})}var u=r(/\.(mp3|wav|ogg)(\?.*)?$/i);function a(w,_,A){var E=i(A.from,_);return o(w,o.fetch(E,"arraybuffer"),A)}function h(w){return w&&typeof w.then=="function"}function f(w,_,A){return _.then(function(E){return o(w,E,A)})}var l=Array.isArray;function p(w,_,A){return Promise.all(_.map(function(E){return o(w,E,A,E)}))}function d(w){return w&&typeof w=="object"}function y(w,_,A){var E={},ee=Object.keys(_).map(function(J){if(A.only&&A.only.indexOf(J)===-1)return null;var b=_[J];return o(w,b,A,b).then(function(x){E[J]=x})});return Promise.all(ee).then(function(){return E})}var m=r(/\.json(\?.*)?$/i);function C(w,_,A){var E=i(A.from,_);return o(w,o.fetch(E,"text").then(JSON.parse),A)}var j=r(/^data:audio/);function U(w,_,A){var E=_.indexOf(",");return o(w,t.decode(_.slice(E+1)).buffer,A)}var T=r(/\.js(\?.*)?$/i);function I(w,_,A){var E=i(A.from,_);return o(w,o.fetch(E,"text").then(X),A)}function X(w){var _=w.indexOf("MIDI.Soundfont.");if(_<0)throw Error("Invalid MIDI.js Soundfont format");_=w.indexOf("=",_)+2;var A=w.lastIndexOf(",");return JSON.parse(w.slice(_,A)+"}")}e.exports&&(e.exports=o),typeof window!="undefined"&&(window.loadAudio=o)})(Kr);var $r={exports:{}},to=no;function no(e){var t=e.createGain(),n=t._voltage=so(e),r=Ke(n),i=Ke(n),o=Ke(n);return t._startAmount=Ke(i),t._endAmount=Ke(o),t._multiplier=Ke(r),t._multiplier.connect(t),t._startAmount.connect(t),t._endAmount.connect(t),t.value=r.gain,t.startValue=i.gain,t.endValue=o.gain,t.startValue.value=0,t.endValue.value=0,Object.defineProperties(t,ro),t}var ro={attack:{value:0,writable:!0},decay:{value:0,writable:!0},sustain:{value:1,writable:!0},release:{value:0,writable:!0},getReleaseDuration:{value:function(){return this.release}},start:{value:function(e){var t=this._multiplier.gain,n=this._startAmount.gain,r=this._endAmount.gain;this._voltage.start(e),this._decayFrom=this._decayFrom=e+this.attack,this._startedAt=e;var i=this.sustain;t.cancelScheduledValues(e),n.cancelScheduledValues(e),r.cancelScheduledValues(e),r.setValueAtTime(0,e),this.attack?(t.setValueAtTime(0,e),t.linearRampToValueAtTime(1,e+this.attack),n.setValueAtTime(1,e),n.linearRampToValueAtTime(0,e+this.attack)):(t.setValueAtTime(1,e),n.setValueAtTime(0,e)),this.decay&&t.setTargetAtTime(i,this._decayFrom,sr(this.decay))}},stop:{value:function(e,t){t&&(e=e-this.release);var n=e+this.release;if(this.release){var r=this._multiplier.gain,i=this._startAmount.gain,o=this._endAmount.gain;r.cancelScheduledValues(e),i.cancelScheduledValues(e),o.cancelScheduledValues(e);var s=sr(this.release);if(this.attack&&e<this._decayFrom){var c=oo(0,1,this._startedAt,this._decayFrom,e);r.linearRampToValueAtTime(c,e),i.linearRampToValueAtTime(1-c,e),i.setTargetAtTime(0,e,s)}o.setTargetAtTime(1,e,s),r.setTargetAtTime(0,e,s)}return this._voltage.stop(n),n}},onended:{get:function(){return this._voltage.onended},set:function(e){this._voltage.onended=e}}},io=new Float32Array([1,1]);function so(e){var t=e.createBufferSource(),n=e.createBuffer(1,2,e.sampleRate);return n.getChannelData(0).set(io),t.buffer=n,t.loop=!0,t}function Ke(e){var t=e.context.createGain();return e.connect(t),t}function sr(e){return Math.log(e+1)/Math.log(100)}function oo(e,t,n,r,i){var o=t-e,s=r-n,c=i-n,u=c/s,a=e+u*o;return a<=e&&(a=e),a>=t&&(a=t),a}var ao=to,co={},uo={gain:1,attack:.01,decay:.1,sustain:.9,release:.3,loop:!1,cents:0,loopStart:0,loopEnd:0};function lo(e,t,n){var r=!1,i=0,o={},s=e.createGain();s.gain.value=1;var c=Object.assign({},uo,n),u={context:e,out:s,opts:c};return t instanceof AudioBuffer?u.buffer=t:u.buffers=t,u.start=function(f,l,p){if(u.buffer&&f!==null)return u.start(null,f,l);var d=f?u.buffers[f]:u.buffer;if(d){if(!r){console.warn("SamplePlayer not connected to any node.");return}}else{console.warn("Buffer "+f+" not found.");return}var y=p||co;l=Math.max(e.currentTime,l||0),u.emit("start",l,f,y);var m=h(f,d,y);return m.id=a(f,m),m.env.start(l),m.source.start(l),u.emit("started",l,m.id,m),y.duration&&m.stop(l+y.duration),m},u.play=function(f,l,p){return u.start(f,l,p)},u.stop=function(f,l){var p;return l=l||Object.keys(o),l.map(function(d){return p=o[d],p?(p.stop(f),p.id):null})},u.connect=function(f){return r=!0,s.connect(f),u},u.emit=function(f,l,p,d){u.onevent&&u.onevent(f,l,p,d);var y=u["on"+f];y&&y(l,p,d)},u;function a(f,l){return l.id=i++,o[l.id]=l,l.source.onended=function(){var p=e.currentTime;l.source.disconnect(),l.env.disconnect(),l.disconnect(),u.emit("ended",p,l.id,l)},l.id}function h(f,l,p){var d=e.createGain();return d.gain.value=0,d.connect(s),d.env=ho(e,p,c),d.env.connect(d.gain),d.source=e.createBufferSource(),d.source.buffer=l,d.source.connect(d),d.source.loop=p.loop||c.loop,d.source.playbackRate.value=po(p.cents||c.cents),d.source.loopStart=p.loopStart||c.loopStart,d.source.loopEnd=p.loopEnd||c.loopEnd,d.stop=function(y){var m=y||e.currentTime;u.emit("stop",m,f);var C=d.env.stop(m);d.source.stop(C)},d}}function or(e){return typeof e=="number"}var fo=["attack","decay","sustain","release"];function ho(e,t,n){var r=ao(e),i=t.adsr||n.adsr;return fo.forEach(function(o,s){i?r[o]=i[s]:r[o]=t[o]||n[o]}),r.value.value=or(t.gain)?t.gain:or(n.gain)?n.gain:1,r}function po(e){return e?Math.pow(2,e/1200):1}var mo=lo,yo=function(e){return e.on=function(t,n){if(arguments.length===1&&typeof t=="function")return e.on("event",t);var r="on"+t,i=e[r];return e[r]=i?go(i,n):n,e},e};function go(e,t){return function(n,r,i,o){e(n,r,i,o),t(n,r,i,o)}}var Hr=/^([a-gA-G])(#{1,}|b{1,}|x{1,}|)(-?\d*)\s*(.*)\s*$/;function bo(){return Hr}var vo=[0,2,4,5,7,9,11];function zr(e,t,n){if(typeof e!="string")return null;var r=Hr.exec(e);if(!r||!t&&r[4])return null;var i={letter:r[1].toUpperCase(),acc:r[2].replace(/x/g,"##")};return i.pc=i.letter+i.acc,i.step=(i.letter.charCodeAt(0)+3)%7,i.alt=i.acc[0]==="b"?-i.acc.length:i.acc.length,i.chroma=vo[i.step]+i.alt,r[3]&&(i.oct=+r[3],i.midi=i.chroma+12*(i.oct+1),i.freq=Jr(i.midi,n)),t&&(i.tonicOf=r[4]),i}function Jr(e,t){return Math.pow(2,(e-69)/12)*(t||440)}var Gr={parse:zr,regex:bo,midiToFreq:Jr},_o=["letter","acc","pc","step","alt","chroma","oct","midi","freq"];_o.forEach(function(e){Gr[e]=function(t){var n=zr(t);return n&&typeof n[e]!="undefined"?n[e]:null}});var ko=Gr,wo=ko,To=function(e){return e!==null&&e!==[]&&e>=0&&e<129},xo=function(e){return To(e)?+e:wo.midi(e)},So=function(e){if(e.buffers){var t=e.opts.map,n=typeof t=="function"?t:xo,r=function(o){return o?n(o)||o:null};e.buffers=Io(e.buffers,r);var i=e.start;e.start=function(o,s,c){var u=r(o),a=u%1;return a&&(u=Math.floor(u),c=Object.assign(c||{},{cents:Math.floor(a*100)})),i(u,s,c)}}return e};function Io(e,t){return Object.keys(e).reduce(function(n,r){return n[t(r)]=e[r],n},{})}var Co=Array.isArray,Oo=function(e){return e&&typeof e=="object"},No={},Ao=function(e){return e.schedule=function(t,n){var r=e.context.currentTime,i=t<r?r:t;e.emit("schedule",i,n);var o,s,c,u;return n.map(function(a){if(a)Co(a)?(o=a[0],s=a[1]):(o=a.time,s=a);else return null;return Oo(s)?(c=s.name||s.key||s.note||s.midi||null,u=s):(c=s,u=No),e.start(c,i+(o||0),u)})},e},Wr={exports:{}};(function(e,t){(function(n){e.exports=n()})(function(){return function n(r,i,o){function s(a,h){if(!i[a]){if(!r[a]){var f=typeof pt=="function"&&pt;if(!h&&f)return f(a,!0);if(c)return c(a,!0);var l=new Error("Cannot find module '"+a+"'");throw l.code="MODULE_NOT_FOUND",l}var p=i[a]={exports:{}};r[a][0].call(p.exports,function(d){var y=r[a][1][d];return s(y||d)},p,p.exports,n,r,i,o)}return i[a].exports}for(var c=typeof pt=="function"&&pt,u=0;u<o.length;u++)s(o[u]);return s}({1:[function(n,r,i){Object.defineProperty(i,"__esModule",{value:!0}),i.default=function(o){function s(c){if(this._event=c,this._data=c.data,this.receivedTime=c.receivedTime,this._data&&this._data.length<2){console.warn("Illegal MIDI message of length",this._data.length);return}switch(this._messageCode=c.data[0]&240,this.channel=c.data[0]&15,this._messageCode){case 128:this.messageType="noteoff",this.key=c.data[1]&127,this.velocity=c.data[2]&127;break;case 144:this.messageType="noteon",this.key=c.data[1]&127,this.velocity=c.data[2]&127;break;case 160:this.messageType="keypressure",this.key=c.data[1]&127,this.pressure=c.data[2]&127;break;case 176:this.messageType="controlchange",this.controllerNumber=c.data[1]&127,this.controllerValue=c.data[2]&127,this.controllerNumber===120&&this.controllerValue===0?this.channelModeMessage="allsoundoff":this.controllerNumber===121?this.channelModeMessage="resetallcontrollers":this.controllerNumber===122?this.controllerValue===0?this.channelModeMessage="localcontroloff":this.channelModeMessage="localcontrolon":this.controllerNumber===123&&this.controllerValue===0?this.channelModeMessage="allnotesoff":this.controllerNumber===124&&this.controllerValue===0?this.channelModeMessage="omnimodeoff":this.controllerNumber===125&&this.controllerValue===0?this.channelModeMessage="omnimodeon":this.controllerNumber===126?this.channelModeMessage="monomodeon":this.controllerNumber===127&&(this.channelModeMessage="polymodeon");break;case 192:this.messageType="programchange",this.program=c.data[1];break;case 208:this.messageType="channelpressure",this.pressure=c.data[1]&127;break;case 224:this.messageType="pitchbendchange";var u=c.data[2]&127,a=c.data[1]&127;this.pitchBend=(u<<8)+a;break}}return new s(o)},r.exports=i.default},{}]},{},[1])(1)})})(Wr);var Eo=Wr.exports,Bo=function(e){return e.listenToMidi=function(t,n){var r={},i=n||{},o=i.gain||function(s){return s/127};return t.onmidimessage=function(s){var c=s.messageType?s:Eo(s);if(c.messageType==="noteon"&&c.velocity===0&&(c.messageType="noteoff"),!(i.channel&&c.channel!==i.channel))switch(c.messageType){case"noteon":r[c.key]=e.play(c.key,0,{gain:o(c.velocity)});break;case"noteoff":r[c.key]&&(r[c.key].stop(),delete r[c.key]);break}},e},e};(function(e){var t=mo,n=yo,r=So,i=Ao,o=Bo;function s(c,u,a){return o(i(r(n(t(c,u,a)))))}e.exports&&(e.exports=s),typeof window!="undefined"&&(window.SamplePlayer=s)})($r);function ar(e,t){return Array(t+1).join(e)}function Tn(e){return typeof e=="number"}function Po(e){return typeof e=="string"}function Uo(e){return typeof e!="undefined"}function Yr(e,t){return Math.pow(2,(e-69)/12)*(t||440)}var Xr=/^([a-gA-G])(#{1,}|b{1,}|x{1,}|)(-?\d*)\s*(.*)\s*$/;function Mo(){return Xr}var Fo=[0,2,4,5,7,9,11];function Ie(e,t,n){if(typeof e!="string")return null;var r=Xr.exec(e);if(!r||!t&&r[4])return null;var i={letter:r[1].toUpperCase(),acc:r[2].replace(/x/g,"##")};i.pc=i.letter+i.acc,i.step=(i.letter.charCodeAt(0)+3)%7,i.alt=i.acc[0]==="b"?-i.acc.length:i.acc.length;var o=Fo[i.step]+i.alt;return i.chroma=o<0?12+o:o%12,r[3]&&(i.oct=+r[3],i.midi=o+12*(i.oct+1),i.freq=Yr(i.midi,n)),t&&(i.tonicOf=r[4]),i}var Ro="CDEFGAB";function qo(e){return Tn(e)?e<0?ar("b",-e):ar("#",e):""}function Do(e){return Tn(e)?""+e:""}function Qr(e,t,n){return e===null||typeof e=="undefined"?null:e.step?Qr(e.step,e.alt,e.oct):e<0||e>6?null:Ro.charAt(e)+qo(t)+Do(n)}function Zr(e){if((Tn(e)||Po(e))&&e>=0&&e<128)return+e;var t=Ie(e);return t&&Uo(t.midi)?t.midi:null}function jo(e,t){var n=Zr(e);return n===null?null:Yr(n,t)}function Lo(e){return(Ie(e)||{}).letter}function Vo(e){return(Ie(e)||{}).acc}function Ko(e){return(Ie(e)||{}).pc}function $o(e){return(Ie(e)||{}).step}function Ho(e){return(Ie(e)||{}).alt}function zo(e){return(Ie(e)||{}).chroma}function Jo(e){return(Ie(e)||{}).oct}var Go=Object.freeze(Object.defineProperty({__proto__:null,regex:Mo,parse:Ie,build:Qr,midi:Zr,freq:jo,letter:Lo,acc:Vo,pc:Ko,step:$o,alt:Ho,chroma:zo,oct:Jo},Symbol.toStringTag,{value:"Module"})),Wo=Tr(Go),dn=Wo;function ye(e,t){if(console.warn("new Soundfont() is deprected"),console.log("Please use Soundfont.instrument() instead of new Soundfont().instrument()"),!(this instanceof ye))return new ye(e);this.nameToUrl=t||ye.nameToUrl,this.ctx=e,this.instruments={},this.promises=[]}ye.prototype.onready=function(e){console.warn("deprecated API"),console.log("Please use Promise.all(Soundfont.instrument(), Soundfont.instrument()).then() instead of new Soundfont().onready()"),Promise.all(this.promises).then(e)};ye.prototype.instrument=function(e,t){console.warn("new Soundfont().instrument() is deprecated."),console.log("Please use Soundfont.instrument() instead.");var n=this.ctx;if(e=e||"default",e in this.instruments)return this.instruments[e];var r={name:e,play:Xo(n,t)};if(this.instruments[e]=r,e!=="default"){var i=ye.instrument(n,e,t).then(function(o){return r.play=o.play,r});this.promises.push(i),r.onready=function(o){console.warn("onready is deprecated. Use Soundfont.instrument().then()"),i.then(o)}}else r.onready=function(o){console.warn("onready is deprecated. Use Soundfont.instrument().then()"),o()};return r};function Yo(e,t,n){return console.warn("Soundfont.loadBuffers is deprecate."),console.log("Use Soundfont.instrument(..) and get buffers properties from the result."),ye.instrument(e,t,n).then(function(r){return r.buffers})}ye.loadBuffers=Yo;function Xo(e,t){return t=t||{},function(n,r,i,o){console.warn("The oscillator player is deprecated."),console.log("Starting with version 0.9.0 you will have to wait until the soundfont is loaded to play sounds.");var s=n>0&&n<129?+n:dn.midi(n),c=s?dn.midiToFreq(s,440):null;if(!!c){i=i||.2,o=o||{};var u=o.destination||t.destination||e.destination,a=o.vcoType||t.vcoType||"sine",h=o.gain||t.gain||.4,f=e.createOscillator();f.type=a,f.frequency.value=c;var l=e.createGain();return l.gain.value=h,f.connect(l),l.connect(u),f.start(r),i>0&&f.stop(r+i),f}}}ye.noteToMidi=dn.midi;var Qo=ye;(function(e){var t=Kr.exports,n=$r.exports;function r(c,u,a){if(arguments.length===1)return function(d,y){return r(c,d,y)};var h=a||{},f=h.isSoundfontURL||i,l=h.nameToUrl||o,p=f(u)?u:l(u,h.soundfont,h.format);return t(c,p,{only:h.only||h.notes}).then(function(d){var y=n(c,d,h).connect(h.destination?h.destination:c.destination);return y.url=p,y.name=u,y})}function i(c){return/\.js(\?.*)?$/i.test(c)}function o(c,u,a){return a=a==="ogg"?a:"mp3",u=u==="FluidR3_GM"?u:"MusyngKite","https://gleitz.github.io/midi-js-soundfonts/"+u+"/"+c+"-"+a+".js"}var s=Qo;s.instrument=r,s.nameToUrl=o,e.exports&&(e.exports=s),typeof window!="undefined"&&(window.Soundfont=s)})(Vr);const ei=window.AudioContext||window.webkitAudioContext;ei||alert("Your browser does not seem to support the Web Audio API!");const Zo=new ei,Gt={};function ti(e){return Gt[e]||(Gt[e]=Vr.exports.instrument(Zo,e)),Gt[e]}const ni=te(),At=te("acoustic_grand_piano"),ze=te(new Map),xn=te(!1),Se=new Map,Dt={audioNodeMap:new Map,colorHue:"220"};Se.set("0",Dt);let q,Sn,In;async function Cn(e,t){let n=await ti(e),r=Se.get(t);r&&(r.instrument=n)}function cr({socketID:e,colorHue:t,instrumentName:n}){Se.set(e,{audioNodeMap:e===q.id?Dt.audioNodeMap:new Map,colorHue:t}),ze.set(pe(ze).set(e,t)),n&&Cn(n,e)}function Wt(){q.removeAllListeners(),q=null,xn.set(!1)}function ea(e,t){Sn=e,In=t}function Yt(e){const t=new Promise((n,r)=>{q=St("https://calbabreaker-piano-backend.herokuapp.com",{query:{roomName:e,instrumentName:pe(At)},path:{}.VITE_BACKEND_PATH}),q.on("connect_error",()=>{Wt(),r("Failed to connect to server!")}),q.on("connect_timeout",()=>{Wt(),r("Timed out while connecting to server!")}),q.on("connect",()=>{xn.set(!0),Se.delete("0"),pe(ze).clear(),n(),history.replaceState({},`Play Piano! - ${e}`,`?room=${e}`)}),q.on("disconnect",()=>{Se.clear(),Se.set("0",Dt),Wt(),history.replaceState({},"Play Piano!",location.pathname)}),q.on("play_note",o=>{Sn(o)}),q.on("stop_note",o=>{In(o)}),q.on("instrument_change",o=>{const{instrumentName:s,socketID:c}=o;Cn(s,c)}),q.on("client_connect",o=>{cr(o)}),q.on("client_list_recieve",o=>{const s=o;for(let c of s)cr(c)}),q.on("client_disconnect",o=>{const s=pe(ze);s.delete(o),ze.set(s),Se.delete(o)})});ni.set(t)}function ta(e,t){const n={note:e,volume:t};q?q.emit("play_note",n):Sn(n)}function Xt(e,t){const n={note:e,sustain:t};q?q.emit("stop_note",n):In(n)}At.subscribe(e=>{q?q.emit("instrument_change",{instrumentName:e}):Cn(e,"0")});const{window:ur}=bi;function lr(e,t,n){const r=e.slice();return r[39]=t[n][0],r[40]=t[n][1],r}function fr(e,t,n){const r=e.slice();return r[44]=t[n],r}function hr(e){let t,n=e[44]+"",r,i;return{c(){t=k("option"),r=ce(n),t.__value=i=e[44],t.value=t.__value},m(o,s){D(o,t,s),g(t,r)},p:B,d(o){o&&M(t)}}}function na(e){return{c:B,m:B,d:B}}function ra(e){return{c:B,m:B,d:B}}function ia(e){let t;return{c(){t=ce("loading...")},m(n,r){D(n,t,r)},d(n){n&&M(t)}}}function sa(e){let t,n,r;return{c(){t=k("button"),t.textContent="Play"},m(i,o){D(i,t,o),n||(r=O(t,"click",e[25]),n=!0)},p:B,d(i){i&&M(t),n=!1,r()}}}function oa(e){let t,n,r;return{c(){t=k("button"),t.textContent="Pause"},m(i,o){D(i,t,o),n||(r=O(t,"click",e[24]),n=!0)},p:B,d(i){i&&M(t),n=!1,r()}}}function aa(e){let t,n,r;return{c(){t=k("button"),t.textContent="Join"},m(i,o){D(i,t,o),n||(r=O(t,"click",e[35]),n=!0)},p:B,d(i){i&&M(t),n=!1,r()}}}function ca(e){let t,n,r;return{c(){t=k("button"),t.textContent="Leave"},m(i,o){D(i,t,o),n||(r=O(t,"click",e[34]),n=!0)},p:B,d(i){i&&M(t),n=!1,r()}}}function ua(e){let t,n=e[43]+"",r;return{c(){t=k("span"),r=ce(n),v(t,"class","error svelte-1ufj93m")},m(i,o){D(i,t,o),g(t,r)},p(i,o){o[0]&4096&&n!==(n=i[43]+"")&&Qt(r,n)},d(i){i&&M(t)}}}function la(e){let t,n=e[11]&&dr(e);return{c(){n&&n.c(),t=yn()},m(r,i){n&&n.m(r,i),D(r,t,i)},p(r,i){r[11]?n?n.p(r,i):(n=dr(r),n.c(),n.m(t.parentNode,t)):n&&(n.d(1),n=null)},d(r){n&&n.d(r),r&&M(t)}}}function dr(e){let t,n,r,i,o,s,c=Array.from(e[13].entries()),u=[];for(let a=0;a<c.length;a+=1)u[a]=mr(lr(e,c,a));return{c(){t=k("span"),t.textContent="Connected!",n=k("br"),r=P(),i=k("span"),i.textContent="People:",o=P();for(let a=0;a<u.length;a+=1)u[a].c();s=yn()},m(a,h){D(a,t,h),D(a,n,h),D(a,r,h),D(a,i,h),D(a,o,h);for(let f=0;f<u.length;f+=1)u[f].m(a,h);D(a,s,h)},p(a,h){if(h[0]&8192){c=Array.from(a[13].entries());let f;for(f=0;f<c.length;f+=1){const l=lr(a,c,f);u[f]?u[f].p(l,h):(u[f]=mr(l),u[f].c(),u[f].m(s.parentNode,s))}for(;f<u.length;f+=1)u[f].d(1);u.length=c.length}},d(a){a&&M(t),a&&M(n),a&&M(r),a&&M(i),a&&M(o),mn(u,a),a&&M(s)}}}function pr(e){let t;return{c(){t=k("span"),t.textContent="(you)",wr(t,"margin-right","0.5rem")},m(n,r){D(n,t,r)},d(n){n&&M(t)}}}function mr(e){let t,n,r,i,o=e[39]===q.id&&pr();return{c(){t=k("div"),r=P(),o&&o.c(),i=yn(),v(t,"class","icon svelte-1ufj93m"),v(t,"style",n=`--color-hue: ${e[40]}`)},m(s,c){D(s,t,c),D(s,r,c),o&&o.m(s,c),D(s,i,c)},p(s,c){c[0]&8192&&n!==(n=`--color-hue: ${s[40]}`)&&v(t,"style",n),s[39]===q.id?o||(o=pr(),o.c(),o.m(i.parentNode,i)):o&&(o.d(1),o=null)},d(s){s&&M(t),s&&M(r),o&&o.d(s),s&&M(i)}}}function fa(e){let t;return{c(){t=k("span"),t.textContent="Connecting..."},m(n,r){D(n,t,r)},p:B,d(n){n&&M(t)}}}function ha(e){let t,n,r,i,o,s,c,u,a,h,f,l,p,d,y,m,C,j,U,T,I,X,w,_,A,E,ee,J,b,x,F,ue,be,ve,_e,nt,le,Ce,qe,rt,Ue,it,ke,Ge,De,S,L,On,ie,Nn,we,An,En,Bn,G,Pn,st=e[8].toFixed(1)+"",jt,Un,ot=e[10].toFixed(1)+"",Lt,Mn,Fn,se,at,Rn,fe,qn,Vt,ct,Kt,Dn,je=Jn,Q=[];for(let K=0;K<je.length;K+=1)Q[K]=hr(fr(e,je,K));let oe={ctx:e,current:null,token:null,hasCatch:!1,pending:ia,then:ra,catch:na};dt(E=e[2],oe);function jn(K,R){return K[7]?oa:sa}let ut=jn(e),he=ut(e);function Ln(K,R){return K[11]?ca:aa}let lt=Ln(e),de=lt(e),ne={ctx:e,current:null,token:null,hasCatch:!0,pending:fa,then:la,catch:ua,error:43};return dt(ct=e[12],ne),{c(){t=k("div"),n=k("div"),r=k("div"),i=k("div"),o=k("span"),o.textContent="Sustain:",s=P(),c=k("input"),u=P(),a=k("div"),h=k("span"),h.textContent="Octave Shift:",f=P(),l=k("input"),p=P(),d=k("div"),y=k("span"),y.textContent="Volume:",m=P(),C=k("input"),j=P(),U=k("input"),T=P(),I=k("div"),X=k("span"),X.textContent="Instrument:",w=P(),_=k("select");for(let K=0;K<Q.length;K+=1)Q[K].c();A=P(),oe.block.c(),ee=P(),J=k("span"),J.textContent="Size:",b=P(),x=k("select"),F=k("option"),F.textContent="Full size (88 keys)",ue=k("option"),ue.textContent="Half size (61 keys)",be=k("option"),be.textContent="Quater Size (37 keys)",ve=k("option"),ve.textContent="2 Octaves (24 keys)",_e=k("option"),_e.textContent="1 Octave (12 keys)",nt=P(),le=k("div"),Ce=k("div"),qe=k("p"),qe.textContent="Play a midi:",rt=P(),Ue=k("input"),it=P(),ke=k("div"),he.c(),Ge=P(),De=k("button"),De.textContent="Restart",S=P(),L=k("div"),On=ce("Speed:"),ie=k("input"),Nn=P(),we=k("input"),An=ce("times"),En=k("br"),Bn=P(),G=k("input"),Pn=P(),jt=ce(st),Un=ce("/"),Lt=ce(ot),Mn=ce(" seconds"),Fn=P(),se=k("div"),at=k("p"),at.textContent="Join a room:",Rn=P(),fe=k("input"),qn=P(),de.c(),Vt=P(),ne.block.c(),v(c,"type","checkbox"),v(c,"class","svelte-1ufj93m"),v(i,"title","Shortcut: space"),v(i,"class","svelte-1ufj93m"),v(l,"type","number"),v(l,"min","-3"),v(l,"max","3"),v(l,"class","svelte-1ufj93m"),v(a,"title","Shortcut: left ctrl +, left alt or right ctrl -"),v(a,"class","svelte-1ufj93m"),v(C,"type","range"),v(C,"min","0"),v(C,"max","50"),v(C,"step","0.1"),v(C,"class","svelte-1ufj93m"),v(U,"type","number"),v(U,"class","svelte-1ufj93m"),v(d,"class","svelte-1ufj93m"),e[0]===void 0&&Ct(()=>e[21].call(_)),v(I,"class","svelte-1ufj93m"),v(F,"data-range","A0,C8"),F.__value="Full size (88 keys)",F.value=F.__value,v(ue,"data-range","C2,C7"),ue.selected=!0,ue.__value="Half size (61 keys)",ue.value=ue.__value,v(be,"data-range","C3,C6"),be.__value="Quater Size (37 keys)",be.value=be.__value,v(ve,"data-range","C4,B5"),ve.__value="2 Octaves (24 keys)",ve.value=ve.__value,v(_e,"data-range","C4,B4"),_e.__value="1 Octave (12 keys)",_e.value=_e.__value,v(r,"class","svelte-1ufj93m"),v(qe,"class","svelte-1ufj93m"),v(Ue,"type","file"),v(Ue,"class","svelte-1ufj93m"),v(Ce,"class","svelte-1ufj93m"),v(ke,"class","svelte-1ufj93m"),v(ie,"type","range"),v(ie,"min","0.01"),v(ie,"max","4"),v(ie,"step","0.01"),v(ie,"class","svelte-1ufj93m"),v(we,"type","number"),v(we,"min","0.01"),v(we,"class","svelte-1ufj93m"),v(G,"type","range"),v(G,"min","0"),v(G,"max",e[10]),v(G,"step","0.1"),wr(G,"width","18rem"),v(G,"class","svelte-1ufj93m"),v(L,"class","svelte-1ufj93m"),v(le,"class","svelte-1ufj93m"),v(n,"class","row svelte-1ufj93m"),v(at,"class","svelte-1ufj93m"),v(fe,"type","text"),v(fe,"placeholder","Room name"),v(fe,"class","svelte-1ufj93m"),v(t,"class","control-panel svelte-1ufj93m")},m(K,R){D(K,t,R),g(t,n),g(n,r),g(r,i),g(i,o),g(i,s),g(i,c),c.checked=e[3],g(r,u),g(r,a),g(a,h),g(a,f),g(a,l),Z(l,e[4]),g(r,p),g(r,d),g(d,y),g(d,m),g(d,C),Z(C,e[5]),g(d,j),g(d,U),Z(U,e[5]),g(r,T),g(r,I),g(I,X),g(I,w),g(I,_);for(let H=0;H<Q.length;H+=1)Q[H].m(_,null);$n(_,e[0]),g(I,A),oe.block.m(I,oe.anchor=null),oe.mount=()=>I,oe.anchor=null,g(r,ee),g(r,J),g(r,b),g(r,x),g(x,F),g(x,ue),g(x,be),g(x,ve),g(x,_e),g(n,nt),g(n,le),g(le,Ce),g(Ce,qe),g(Ce,rt),g(Ce,Ue),g(le,it),g(le,ke),he.m(ke,null),g(ke,Ge),g(ke,De),g(le,S),g(le,L),g(L,On),g(L,ie),Z(ie,e[9]),g(L,Nn),g(L,we),Z(we,e[9]),g(L,An),g(L,En),g(L,Bn),g(L,G),Z(G,e[8]),g(L,Pn),g(L,jt),g(L,Un),g(L,Lt),g(L,Mn),g(t,Fn),g(t,se),g(se,at),g(se,Rn),g(se,fe),Z(fe,e[1]),g(se,qn),de.m(se,null),g(se,Vt),ne.block.m(se,ne.anchor=null),ne.mount=()=>se,ne.anchor=null,Kt||(Dn=[O(ur,"keydown",e[15]),O(ur,"keyup",e[16]),O(c,"change",e[17]),O(l,"input",e[18]),O(C,"change",e[19]),O(C,"input",e[19]),O(U,"input",e[20]),O(_,"change",e[21]),O(x,"change",e[22]),oi(e[14].call(null,x)),O(Ue,"change",e[23]),O(De,"click",e[26]),O(ie,"change",e[27]),O(ie,"input",e[27]),O(we,"input",e[28]),O(G,"change",e[29]),O(G,"input",e[29]),O(G,"mousedown",e[30]),O(G,"mouseup",e[31]),O(fe,"input",e[32]),O(fe,"keydown",e[33])],Kt=!0)},p(K,R){if(e=K,R[0]&8&&(c.checked=e[3]),R[0]&16&&Te(l.value)!==e[4]&&Z(l,e[4]),R[0]&32&&Z(C,e[5]),R[0]&32&&Te(U.value)!==e[5]&&Z(U,e[5]),R&0){je=Jn;let H;for(H=0;H<je.length;H+=1){const Vn=fr(e,je,H);Q[H]?Q[H].p(Vn,R):(Q[H]=hr(Vn),Q[H].c(),Q[H].m(_,null))}for(;H<Q.length;H+=1)Q[H].d(1);Q.length=je.length}R[0]&1&&$n(_,e[0]),oe.ctx=e,R[0]&4&&E!==(E=e[2])&&dt(E,oe),ut===(ut=jn(e))&&he?he.p(e,R):(he.d(1),he=ut(e),he&&(he.c(),he.m(ke,Ge))),R[0]&512&&Z(ie,e[9]),R[0]&512&&Te(we.value)!==e[9]&&Z(we,e[9]),R[0]&1024&&v(G,"max",e[10]),R[0]&256&&Z(G,e[8]),R[0]&256&&st!==(st=e[8].toFixed(1)+"")&&Qt(jt,st),R[0]&1024&&ot!==(ot=e[10].toFixed(1)+"")&&Qt(Lt,ot),R[0]&2&&fe.value!==e[1]&&Z(fe,e[1]),lt===(lt=Ln(e))&&de?de.p(e,R):(de.d(1),de=lt(e),de&&(de.c(),de.m(se,Vt))),ne.ctx=e,R[0]&4096&&ct!==(ct=e[12])&&dt(ct,ne)||gi(ne,e,R)},i:B,o:B,d(K){K&&M(t),mn(Q,K),oe.block.d(),oe.token=null,oe=null,he.d(),de.d(),ne.block.d(),ne.token=null,ne=null,Kt=!1,Pe(Dn)}}}const Ne=te(0),He=te(!1),It=te(25),pn=te(["C0","C0"]);function da(e,t,n){let r,i,o=B,s,c=B,u,a=B,h,f,l=B,p,d,y,m,C,j,U,T;z(e,He,S=>n(3,i=S)),z(e,Ne,S=>n(4,s=S)),z(e,pn,S=>n(36,u=S)),z(e,At,S=>n(0,h=S)),z(e,It,S=>n(5,f=S)),z(e,an,S=>n(6,p=S)),z(e,re,S=>n(7,d=S)),z(e,Fe,S=>n(8,y=S)),z(e,Ze,S=>n(9,m=S)),z(e,wt,S=>n(10,C=S)),z(e,xn,S=>n(11,j=S)),z(e,ni,S=>n(12,U=S)),z(e,ze,S=>n(13,T=S)),e.$$.on_destroy.push(()=>o()),e.$$.on_destroy.push(()=>c()),e.$$.on_destroy.push(()=>a()),e.$$.on_destroy.push(()=>l());let I="";const w=new URLSearchParams(window.location.search).get("room");w&&(I=w,Yt(I));function _(S){const L=S.children[S.selectedIndex];W(pn,u=L.dataset.range.split(","),u)}function A(S){S.code==="Space"&&W(He,i=!0,i),S.code==="ControlLeft"?W(Ne,s-=1,s):(S.code==="AltLeft"||S.code=="ControlRight")&&W(Ne,s+=1,s),s<-3?W(Ne,s=3,s):s>3&&W(Ne,s=-3,s)}function E(S){S.code==="Space"&&W(He,i=!1,i)}function ee(){i=this.checked,He.set(i)}function J(){s=Te(this.value),Ne.set(s)}function b(){f=Te(this.value),It.set(f)}function x(){f=Te(this.value),It.set(f)}function F(){h=ui(this),At.set(h)}const ue=S=>_(S.currentTarget),be=S=>{var L;return W(an,p=(L=S.currentTarget.files)==null?void 0:L[0],p)},ve=()=>W(re,d=!1,d),_e=()=>W(re,d=!0,d),nt=()=>{W(re,d=!1,d),W(Fe,y=0,y),setTimeout(()=>{W(re,d=!0,d)},100)};function le(){m=Te(this.value),Ze.set(m)}function Ce(){m=Te(this.value),Ze.set(m)}function qe(){y=Te(this.value),Fe.set(y)}const rt=()=>W(re,d=!1,d),Ue=()=>W(re,d=!0,d);function it(){I=this.value,n(1,I)}const ke=S=>{S.code==="Enter"&&Yt(I)},Ge=()=>q.disconnect(),De=()=>Yt(I);return e.$$.update=()=>{e.$$.dirty[0]&1&&n(2,r=ti(h))},[h,I,r,i,s,f,p,d,y,m,C,j,U,T,_,A,E,ee,J,b,x,F,ue,be,ve,_e,nt,le,Ce,qe,rt,Ue,it,ke,Ge,De]}class pa extends vn{constructor(t){super(),bn(this,t,da,ha,Et,{},null,[-1,-1])}}function yr(e,t,n){const r=e.slice();return r[26]=t[n][0],r[27]=t[n][1].white,r[28]=t[n][1].pressedColor,r[29]=t[n][1].ghost,r}function gr(e){let t,n,r,i,o;function s(...h){return e[14](e[26],...h)}function c(){return e[15](e[26])}function u(){return e[16](e[26])}function a(){return e[17](e[26])}return{c(){t=k("div"),v(t,"class",n="key "+(e[27]?"white":"black")+" svelte-yqi7mq"),v(t,"style",r=`--color-hue: ${e[28]}`),ft(t,"pressed",e[28]!==null),ft(t,"ghost",e[29]&&e[28]===null)},m(h,f){D(h,t,f),i||(o=[O(t,"pointerdown",s),O(t,"pointerenter",c),O(t,"pointerleave",u),O(t,"pointerup",a)],i=!0)},p(h,f){e=h,f[0]&4&&n!==(n="key "+(e[27]?"white":"black")+" svelte-yqi7mq")&&v(t,"class",n),f[0]&4&&r!==(r=`--color-hue: ${e[28]}`)&&v(t,"style",r),f[0]&4&&ft(t,"pressed",e[28]!==null),f[0]&4&&ft(t,"ghost",e[29]&&e[28]===null)},d(h){h&&M(t),i=!1,Pe(o)}}}function ma(e){let t,n,r,i,o,s=Object.entries(e[2]),c=[];for(let u=0;u<s.length;u+=1)c[u]=gr(yr(e,s,u));return{c(){t=k("div"),n=k("div");for(let u=0;u<c.length;u+=1)c[u].c();v(n,"class","piano svelte-yqi7mq"),v(n,"style",r=`--white-keys: ${e[0]}`),v(t,"class","piano-container svelte-yqi7mq")},m(u,a){D(u,t,a),g(t,n);for(let h=0;h<c.length;h+=1)c[h].m(n,null);e[18](t),i||(o=[O(window,"resize",e[10]),O(window,"load",e[11]),O(window,"keyup",e[8]),O(window,"keydown",e[7]),O(window,"pointerdown",e[12]),O(window,"pointerup",e[13]),O(n,"touchend",ai(e[9]))],i=!0)},p(u,a){if(a[0]&54){s=Object.entries(u[2]);let h;for(h=0;h<s.length;h+=1){const f=yr(u,s,h);c[h]?c[h].p(f,a):(c[h]=gr(f),c[h].c(),c[h].m(n,null))}for(;h<c.length;h+=1)c[h].d(1);c.length=s.length}a[0]&1&&r!==(r=`--white-keys: ${u[0]}`)&&v(n,"style",r)},i:B,o:B,d(u){u&&M(t),mn(c,u),e[18](null),i=!1,Pe(o)}}}function br(e,t){t.get(e)&&(t.get(e).stop(),t.delete(e))}function ya(e,t,n){let r,i,o;z(e,He,b=>n(19,r=b)),z(e,It,b=>n(20,i=b)),z(e,Ne,b=>n(21,o=b));let s=!1,c,u,a,h=new Map;pn.subscribe(b=>{const x=as(b[0],b[1]);n(2,c=x.noteMap),n(0,u=x.whiteKeys)});function f(b){var F;const x=Se.get((F=b.socketID)!=null?F:"0");c[b.note]&&n(2,c[b.note].pressedColor=x.colorHue,c),x.instrument&&(br(b.note,x.audioNodeMap),x.audioNodeMap.set(b.note,x.instrument.play(b.note,void 0,{gain:b.volume})))}function l(b){var F;const x=Se.get((F=b.socketID)!=null?F:"0");c[b.note]&&n(2,c[b.note].pressedColor=null,c),b.sustain||br(b.note,x.audioNodeMap)}ea(f,l);function p(b){const x=sn(b)+o;return on(b)+x}function d(b,x){const F=p(b);h.get(F)||(c[b]&&n(2,c[b].ghost=!0,c),h.set(F,!0),ta(F,i*x))}function y(b){const x=p(b);c[b]&&n(2,c[b].ghost=!1,c),h.get(x)&&(h.delete(x),Xt(x,r))}cs(d,y),He.subscribe(b=>{if(!b)for(const x of Dt.audioNodeMap.keys())h.get(x)||Xt(x,!1)}),Ne.subscribe(()=>{for(const b of h.keys())Xt(b,r)});function m(b=u){if(!a)return;const x=a.clientHeight/6,F=a.offsetWidth/b;a.style.setProperty("--white-key-width",`${Math.min(F,x)}px`)}function C(b){const x=Yn[b.code],F=b.target;x&&F.tagName!=="INPUT"&&(b.preventDefault(),d(x,.5))}function j(b){const x=Yn[b.code];x&&y(x)}function U(b){fi.call(this,e,b)}const T=()=>m(),I=()=>m(),X=()=>n(1,s=!0),w=()=>n(1,s=!1),_=(b,x)=>{x.currentTarget.releasePointerCapture(x.pointerId),d(b,.5)},A=b=>{s&&d(b,.5)},E=b=>y(b),ee=b=>y(b);function J(b){Zt[b?"unshift":"push"](()=>{a=b,n(3,a)})}return e.$$.update=()=>{e.$$.dirty[0]&1&&m(u)},[u,s,c,a,d,y,m,C,j,U,T,I,X,w,_,A,E,ee,J]}class ga extends vn{constructor(t){super(),bn(this,t,ya,ma,Et,{},null,[-1,-1])}}function ba(e){let t,n,r,i,o;return n=new pa({}),i=new ga({}),{c(){t=k("main"),zn(n.$$.fragment),r=P(),zn(i.$$.fragment),v(t,"class","svelte-ieeeet")},m(s,c){D(s,t,c),nn(n,t,null),g(t,r),nn(i,t,null),o=!0},p:B,i(s){o||(Ot(n.$$.fragment,s),Ot(i.$$.fragment,s),o=!0)},o(s){tn(n.$$.fragment,s),tn(i.$$.fragment,s),o=!1},d(s){s&&M(t),rn(n),rn(i)}}}class va extends vn{constructor(t){super(),bn(this,t,null,ba,Et,{})}}new va({target:document.body});

var Rn=Object.defineProperty;var Vn=(t,e,n)=>e in t?Rn(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n;var A=(t,e,n)=>Vn(t,typeof e!="symbol"?e+"":e,n);(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))r(i);new MutationObserver(i=>{for(const s of i)if(s.type==="childList")for(const o of s.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&r(o)}).observe(document,{childList:!0,subtree:!0});function n(i){const s={};return i.integrity&&(s.integrity=i.integrity),i.referrerPolicy&&(s.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?s.credentials="include":i.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function r(i){if(i.ep)return;i.ep=!0;const s=n(i);fetch(i.href,s)}})();function G(){}function Ln(t){return!!t&&(typeof t=="object"||typeof t=="function")&&typeof t.then=="function"}function cn(t){return t()}function Bt(){return Object.create(null)}function pe(t){t.forEach(cn)}function ln(t){return typeof t=="function"}function Pe(t,e){return t!=t?e==e:t!==e||t&&typeof t=="object"||typeof t=="function"}let je;function un(t,e){return t===e?!0:(je||(je=document.createElement("a")),je.href=e,t===je.href)}function zn(t){return Object.keys(t).length===0}function fn(t,...e){if(t==null){for(const r of e)r(void 0);return G}const n=t.subscribe(...e);return n.unsubscribe?()=>n.unsubscribe():n}function ee(t){let e;return fn(t,n=>e=n)(),e}function J(t,e,n){t.$$.on_destroy.push(fn(e,n))}function ae(t,e,n){return t.set(n),e}function y(t,e){t.appendChild(e)}function D(t,e,n){t.insertBefore(e,n||null)}function B(t){t.parentNode&&t.parentNode.removeChild(t)}function Ye(t,e){for(let n=0;n<t.length;n+=1)t[n]&&t[n].d(e)}function b(t){return document.createElement(t)}function oe(t){return document.createTextNode(t)}function N(){return oe(" ")}function hn(){return oe("")}function P(t,e,n,r){return t.addEventListener(e,n,r),()=>t.removeEventListener(e,n,r)}function Hn(t){return function(e){return e.preventDefault(),t.call(this,e)}}function k(t,e,n){n==null?t.removeAttribute(e):t.getAttribute(e)!==n&&t.setAttribute(e,n)}function de(t){return t===""?null:+t}function Kn(t){return Array.from(t.childNodes)}function $e(t,e){e=""+e,t.data!==e&&(t.data=e)}function q(t,e){t.value=e??""}function Ue(t,e,n,r){n==null?t.style.removeProperty(e):t.style.setProperty(e,n,"")}function ye(t,e,n){for(let r=0;r<t.options.length;r+=1){const i=t.options[r];if(i.__value===e){i.selected=!0;return}}(!n||e!==void 0)&&(t.selectedIndex=-1)}function Je(t){const e=t.querySelector(":checked");return e&&e.__value}function Dt(t,e,n){t.classList.toggle(e,!!n)}let Ze;function ge(t){Ze=t}function dn(){if(!Ze)throw new Error("Function called outside component initialization");return Ze}function pn(t){dn().$$.on_mount.push(t)}function qn(t,e){const n=t.$$.callbacks[e.type];n&&n.slice().forEach(r=>r.call(this,e))}const Fe=[],It=[];let Oe=[];const Ot=[],Gn=Promise.resolve();let Ut=!1;function Wn(){Ut||(Ut=!0,Gn.then(Et))}function xe(t){Oe.push(t)}const yt=new Set;let Ee=0;function Et(){if(Ee!==0)return;const t=Ze;do{try{for(;Ee<Fe.length;){const e=Fe[Ee];Ee++,ge(e),Jn(e.$$)}}catch(e){throw Fe.length=0,Ee=0,e}for(ge(null),Fe.length=0,Ee=0;It.length;)It.pop()();for(let e=0;e<Oe.length;e+=1){const n=Oe[e];yt.has(n)||(yt.add(n),n())}Oe.length=0}while(Fe.length);for(;Ot.length;)Ot.pop()();Ut=!1,yt.clear(),ge(t)}function Jn(t){if(t.fragment!==null){t.update(),pe(t.before_update);const e=t.dirty;t.dirty=[-1],t.fragment&&t.fragment.p(t.ctx,e),t.after_update.forEach(xe)}}function Xn(t){const e=[],n=[];Oe.forEach(r=>t.indexOf(r)===-1?e.push(r):n.push(r)),n.forEach(r=>r()),Oe=e}const st=new Set;let Ie;function Yn(){Ie={r:0,c:[],p:Ie}}function $n(){Ie.r||pe(Ie.c),Ie=Ie.p}function Se(t,e){t&&t.i&&(st.delete(t),t.i(e))}function Re(t,e,n,r){if(t&&t.o){if(st.has(t))return;st.add(t),Ie.c.push(()=>{st.delete(t),r&&(n&&t.d(1),r())}),t.o(e)}else r&&r()}function Rt(t,e){const n=e.token={};function r(i,s,o,a){if(e.token!==n)return;e.resolved=a;let u=e.ctx;o!==void 0&&(u=u.slice(),u[o]=a);const c=i&&(e.current=i)(u);let p=!1;e.block&&(e.blocks?e.blocks.forEach((h,l)=>{l!==s&&h&&(Yn(),Re(h,1,1,()=>{e.blocks[l]===h&&(e.blocks[l]=null)}),$n())}):e.block.d(1),c.c(),Se(c,1),c.m(e.mount(),e.anchor),p=!0),e.block=c,e.blocks&&(e.blocks[s]=c),p&&Et()}if(Ln(t)){const i=dn();if(t.then(s=>{ge(i),r(e.then,1,e.value,s),ge(null)},s=>{if(ge(i),r(e.catch,2,e.error,s),ge(null),!e.hasCatch)throw s}),e.current!==e.pending)return r(e.pending,0),!0}else{if(e.current!==e.then)return r(e.then,1,e.value,t),!0;e.resolved=t}}function be(t){return(t==null?void 0:t.length)!==void 0?t:Array.from(t)}function Xe(t){t&&t.c()}function Ve(t,e,n){const{fragment:r,after_update:i}=t.$$;r&&r.m(e,n),xe(()=>{const s=t.$$.on_mount.map(cn).filter(ln);t.$$.on_destroy?t.$$.on_destroy.push(...s):pe(s),t.$$.on_mount=[]}),i.forEach(xe)}function Le(t,e){const n=t.$$;n.fragment!==null&&(Xn(n.after_update),pe(n.on_destroy),n.fragment&&n.fragment.d(e),n.on_destroy=n.fragment=null,n.ctx=[])}function Zn(t,e){t.$$.dirty[0]===-1&&(Fe.push(t),Wn(),t.$$.dirty.fill(0)),t.$$.dirty[e/31|0]|=1<<e%31}function He(t,e,n,r,i,s,o=null,a=[-1]){const u=Ze;ge(t);const c=t.$$={fragment:null,ctx:[],props:s,update:G,not_equal:i,bound:Bt(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(e.context||(u?u.$$.context:[])),callbacks:Bt(),dirty:a,skip_bound:!1,root:e.target||u.$$.root};o&&o(c.root);let p=!1;if(c.ctx=n?n(t,e.props||{},(h,l,...f)=>{const d=f.length?f[0]:l;return c.ctx&&i(c.ctx[h],c.ctx[h]=d)&&(!c.skip_bound&&c.bound[h]&&c.bound[h](d),p&&Zn(t,h)),l}):[],c.update(),p=!0,pe(c.before_update),c.fragment=r?r(c.ctx):!1,e.target){if(e.hydrate){const h=Kn(e.target);c.fragment&&c.fragment.l(h),h.forEach(B)}else c.fragment&&c.fragment.c();e.intro&&Se(t.$$.fragment),Ve(t,e.target,e.anchor),Et()}ge(u)}class Ke{constructor(){A(this,"$$");A(this,"$$set")}$destroy(){Le(this,1),this.$destroy=G}$on(e,n){if(!ln(n))return G;const r=this.$$.callbacks[e]||(this.$$.callbacks[e]=[]);return r.push(n),()=>{const i=r.indexOf(n);i!==-1&&r.splice(i,1)}}$set(e){this.$$set&&!zn(e)&&(this.$$.skip_bound=!0,this.$$set(e),this.$$.skip_bound=!1)}}const Qn="4";typeof window<"u"&&(window.__svelte||(window.__svelte={v:new Set})).v.add(Qn);var Be=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function mn(t){if(t.__esModule)return t;var e=t.default;if(typeof e=="function"){var n=function r(){return this instanceof r?Reflect.construct(e,arguments,this.constructor):e.apply(this,arguments)};n.prototype=e.prototype}else n={};return Object.defineProperty(n,"__esModule",{value:!0}),Object.keys(t).forEach(function(r){var i=Object.getOwnPropertyDescriptor(t,r);Object.defineProperty(n,r,i.get?i:{enumerable:!0,get:function(){return t[r]}})}),n}var St={},ft={};function jn(t){var e=new le(t),n=e.readChunk();if(n.id!="MThd")throw"Bad MIDI file.  Expected 'MHdr', got: '"+n.id+"'";for(var r=er(n.data),i=[],s=0;!e.eof()&&s<r.numTracks;s++){var o=e.readChunk();if(o.id!="MTrk")throw"Bad MIDI file.  Expected 'MTrk', got: '"+o.id+"'";var a=tr(o.data);i.push(a)}return{header:r,tracks:i}}function er(t){var e=new le(t),n=e.readUInt16(),r=e.readUInt16(),i={format:n,numTracks:r},s=e.readUInt16();return s&32768?(i.framesPerSecond=256-(s>>8),i.ticksPerFrame=s&255):i.ticksPerBeat=s,i}function tr(t){for(var e=new le(t),n=[];!e.eof();){var r=s();n.push(r)}return n;var i;function s(){var o={};o.deltaTime=e.readVarInt();var a=e.readUInt8();if((a&240)===240)if(a===255){o.meta=!0;var u=e.readUInt8(),c=e.readVarInt();switch(u){case 0:if(o.type="sequenceNumber",c!==2)throw"Expected length for sequenceNumber event is 2, got "+c;return o.number=e.readUInt16(),o;case 1:return o.type="text",o.text=e.readString(c),o;case 2:return o.type="copyrightNotice",o.text=e.readString(c),o;case 3:return o.type="trackName",o.text=e.readString(c),o;case 4:return o.type="instrumentName",o.text=e.readString(c),o;case 5:return o.type="lyrics",o.text=e.readString(c),o;case 6:return o.type="marker",o.text=e.readString(c),o;case 7:return o.type="cuePoint",o.text=e.readString(c),o;case 32:if(o.type="channelPrefix",c!=1)throw"Expected length for channelPrefix event is 1, got "+c;return o.channel=e.readUInt8(),o;case 33:if(o.type="portPrefix",c!=1)throw"Expected length for portPrefix event is 1, got "+c;return o.port=e.readUInt8(),o;case 47:if(o.type="endOfTrack",c!=0)throw"Expected length for endOfTrack event is 0, got "+c;return o;case 81:if(o.type="setTempo",c!=3)throw"Expected length for setTempo event is 3, got "+c;return o.microsecondsPerBeat=e.readUInt24(),o;case 84:if(o.type="smpteOffset",c!=5)throw"Expected length for smpteOffset event is 5, got "+c;var p=e.readUInt8(),h={0:24,32:25,64:29,96:30};return o.frameRate=h[p&96],o.hour=p&31,o.min=e.readUInt8(),o.sec=e.readUInt8(),o.frame=e.readUInt8(),o.subFrame=e.readUInt8(),o;case 88:if(o.type="timeSignature",c!=2&&c!=4)throw"Expected length for timeSignature event is 4 or 2, got "+c;return o.numerator=e.readUInt8(),o.denominator=1<<e.readUInt8(),c===4?(o.metronome=e.readUInt8(),o.thirtyseconds=e.readUInt8()):(o.metronome=36,o.thirtyseconds=8),o;case 89:if(o.type="keySignature",c!=2)throw"Expected length for keySignature event is 2, got "+c;return o.key=e.readInt8(),o.scale=e.readUInt8(),o;case 127:return o.type="sequencerSpecific",o.data=e.readBytes(c),o;default:return o.type="unknownMeta",o.data=e.readBytes(c),o.metatypeByte=u,o}}else if(a==240){o.type="sysEx";var c=e.readVarInt();return o.data=e.readBytes(c),o}else if(a==247){o.type="endSysEx";var c=e.readVarInt();return o.data=e.readBytes(c),o}else throw"Unrecognised MIDI event type byte: "+a;else{var l;if(a&128)l=e.readUInt8(),i=a;else{if(i===null)throw"Running status byte encountered before status byte";l=a,a=i,o.running=!0}var f=a>>4;switch(o.channel=a&15,f){case 8:return o.type="noteOff",o.noteNumber=l,o.velocity=e.readUInt8(),o;case 9:var d=e.readUInt8();return o.type=d===0?"noteOff":"noteOn",o.noteNumber=l,o.velocity=d,d===0&&(o.byte9=!0),o;case 10:return o.type="noteAftertouch",o.noteNumber=l,o.amount=e.readUInt8(),o;case 11:return o.type="controller",o.controllerType=l,o.value=e.readUInt8(),o;case 12:return o.type="programChange",o.programNumber=l,o;case 13:return o.type="channelAftertouch",o.amount=l,o;case 14:return o.type="pitchBend",o.value=l+(e.readUInt8()<<7)-8192,o;default:throw"Unrecognised MIDI event type: "+f}}}}function le(t){this.buffer=t,this.bufferLen=this.buffer.length,this.pos=0}le.prototype.eof=function(){return this.pos>=this.bufferLen};le.prototype.readUInt8=function(){var t=this.buffer[this.pos];return this.pos+=1,t};le.prototype.readInt8=function(){var t=this.readUInt8();return t&128?t-256:t};le.prototype.readUInt16=function(){var t=this.readUInt8(),e=this.readUInt8();return(t<<8)+e};le.prototype.readInt16=function(){var t=this.readUInt16();return t&32768?t-65536:t};le.prototype.readUInt24=function(){var t=this.readUInt8(),e=this.readUInt8(),n=this.readUInt8();return(t<<16)+(e<<8)+n};le.prototype.readInt24=function(){var t=this.readUInt24();return t&8388608?t-16777216:t};le.prototype.readUInt32=function(){var t=this.readUInt8(),e=this.readUInt8(),n=this.readUInt8(),r=this.readUInt8();return(t<<24)+(e<<16)+(n<<8)+r};le.prototype.readBytes=function(t){var e=this.buffer.slice(this.pos,this.pos+t);return this.pos+=t,e};le.prototype.readString=function(t){var e=this.readBytes(t);return String.fromCharCode.apply(null,e)};le.prototype.readVarInt=function(){for(var t=0;!this.eof();){var e=this.readUInt8();if(e&128)t+=e&127,t<<=7;else return t+e}return t};le.prototype.readChunk=function(){var t=this.readString(4),e=this.readUInt32(),n=this.readBytes(e);return{id:t,length:e,data:n}};var nr=jn;function rr(t,e){if(typeof t!="object")throw"Invalid MIDI data";e=e||{};var n=t.header||{},r=t.tracks||[],i,s=r.length,o=new te;for(ir(o,n,s),i=0;i<s;i++)or(o,r[i],e);return o.buffer}function ir(t,e,n){var r=e.format==null?1:e.format,i=128;e.timeDivision?i=e.timeDivision:e.ticksPerFrame&&e.framesPerSecond?i=-(e.framesPerSecond&255)<<8|e.ticksPerFrame&255:e.ticksPerBeat&&(i=e.ticksPerBeat&32767);var s=new te;s.writeUInt16(r),s.writeUInt16(n),s.writeUInt16(i),t.writeChunk("MThd",s.buffer)}function or(t,e,n){var r=new te,i,s=e.length,o=null;for(i=0;i<s;i++)(n.running===!1||!n.running&&!e[i].running)&&(o=null),o=sr(r,e[i],o,n.useByte9ForNoteOff);t.writeChunk("MTrk",r.buffer)}function sr(t,e,n,r){var i=e.type,s=e.deltaTime,o=e.text||"",a=e.data||[],u=null;switch(t.writeVarInt(s),i){case"sequenceNumber":t.writeUInt8(255),t.writeUInt8(0),t.writeVarInt(2),t.writeUInt16(e.number);break;case"text":t.writeUInt8(255),t.writeUInt8(1),t.writeVarInt(o.length),t.writeString(o);break;case"copyrightNotice":t.writeUInt8(255),t.writeUInt8(2),t.writeVarInt(o.length),t.writeString(o);break;case"trackName":t.writeUInt8(255),t.writeUInt8(3),t.writeVarInt(o.length),t.writeString(o);break;case"instrumentName":t.writeUInt8(255),t.writeUInt8(4),t.writeVarInt(o.length),t.writeString(o);break;case"lyrics":t.writeUInt8(255),t.writeUInt8(5),t.writeVarInt(o.length),t.writeString(o);break;case"marker":t.writeUInt8(255),t.writeUInt8(6),t.writeVarInt(o.length),t.writeString(o);break;case"cuePoint":t.writeUInt8(255),t.writeUInt8(7),t.writeVarInt(o.length),t.writeString(o);break;case"channelPrefix":t.writeUInt8(255),t.writeUInt8(32),t.writeVarInt(1),t.writeUInt8(e.channel);break;case"portPrefix":t.writeUInt8(255),t.writeUInt8(33),t.writeVarInt(1),t.writeUInt8(e.port);break;case"endOfTrack":t.writeUInt8(255),t.writeUInt8(47),t.writeVarInt(0);break;case"setTempo":t.writeUInt8(255),t.writeUInt8(81),t.writeVarInt(3),t.writeUInt24(e.microsecondsPerBeat);break;case"smpteOffset":t.writeUInt8(255),t.writeUInt8(84),t.writeVarInt(5);var c={24:0,25:32,29:64,30:96},p=e.hour&31|c[e.frameRate];t.writeUInt8(p),t.writeUInt8(e.min),t.writeUInt8(e.sec),t.writeUInt8(e.frame),t.writeUInt8(e.subFrame);break;case"timeSignature":t.writeUInt8(255),t.writeUInt8(88),t.writeVarInt(4),t.writeUInt8(e.numerator);var h=Math.floor(Math.log(e.denominator)/Math.LN2)&255;t.writeUInt8(h),t.writeUInt8(e.metronome),t.writeUInt8(e.thirtyseconds||8);break;case"keySignature":t.writeUInt8(255),t.writeUInt8(89),t.writeVarInt(2),t.writeInt8(e.key),t.writeUInt8(e.scale);break;case"sequencerSpecific":t.writeUInt8(255),t.writeUInt8(127),t.writeVarInt(a.length),t.writeBytes(a);break;case"unknownMeta":e.metatypeByte!=null&&(t.writeUInt8(255),t.writeUInt8(e.metatypeByte),t.writeVarInt(a.length),t.writeBytes(a));break;case"sysEx":t.writeUInt8(240),t.writeVarInt(a.length),t.writeBytes(a);break;case"endSysEx":t.writeUInt8(247),t.writeVarInt(a.length),t.writeBytes(a);break;case"noteOff":var l=r!==!1&&e.byte9||r&&e.velocity==0?144:128;u=l|e.channel,u!==n&&t.writeUInt8(u),t.writeUInt8(e.noteNumber),t.writeUInt8(e.velocity);break;case"noteOn":u=144|e.channel,u!==n&&t.writeUInt8(u),t.writeUInt8(e.noteNumber),t.writeUInt8(e.velocity);break;case"noteAftertouch":u=160|e.channel,u!==n&&t.writeUInt8(u),t.writeUInt8(e.noteNumber),t.writeUInt8(e.amount);break;case"controller":u=176|e.channel,u!==n&&t.writeUInt8(u),t.writeUInt8(e.controllerType),t.writeUInt8(e.value);break;case"programChange":u=192|e.channel,u!==n&&t.writeUInt8(u),t.writeUInt8(e.programNumber);break;case"channelAftertouch":u=208|e.channel,u!==n&&t.writeUInt8(u),t.writeUInt8(e.amount);break;case"pitchBend":u=224|e.channel,u!==n&&t.writeUInt8(u);var f=8192+e.value,d=f&127,m=f>>7&127;t.writeUInt8(d),t.writeUInt8(m);break;default:throw"Unrecognized event type: "+i}return u}function te(){this.buffer=[]}te.prototype.writeUInt8=function(t){this.buffer.push(t&255)};te.prototype.writeInt8=te.prototype.writeUInt8;te.prototype.writeUInt16=function(t){var e=t>>8&255,n=t&255;this.writeUInt8(e),this.writeUInt8(n)};te.prototype.writeInt16=te.prototype.writeUInt16;te.prototype.writeUInt24=function(t){var e=t>>16&255,n=t>>8&255,r=t&255;this.writeUInt8(e),this.writeUInt8(n),this.writeUInt8(r)};te.prototype.writeInt24=te.prototype.writeUInt24;te.prototype.writeUInt32=function(t){var e=t>>24&255,n=t>>16&255,r=t>>8&255,i=t&255;this.writeUInt8(e),this.writeUInt8(n),this.writeUInt8(r),this.writeUInt8(i)};te.prototype.writeInt32=te.prototype.writeUInt32;te.prototype.writeBytes=function(t){this.buffer=this.buffer.concat(Array.prototype.slice.call(t,0))};te.prototype.writeString=function(t){var e,n=t.length,r=[];for(e=0;e<n;e++)r.push(t.codePointAt(e));this.writeBytes(r)};te.prototype.writeVarInt=function(t){if(t<0)throw"Cannot write negative variable-length integer";if(t<=127)this.writeUInt8(t);else{var e=t,n=[];for(n.push(e&127),e>>=7;e;){var r=e&127|128;n.push(r),e>>=7}this.writeBytes(n.reverse())}};te.prototype.writeChunk=function(t,e){this.writeString(t),this.writeUInt32(e.length),this.writeBytes(e)};var ar=rr;ft.parseMidi=nr;ft.writeMidi=ar;var at={},Ce={};Object.defineProperty(Ce,"__esModule",{value:!0});Ce.insert=Ce.search=void 0;function vn(t,e,n){n===void 0&&(n="ticks");var r=0,i=t.length,s=i;if(i>0&&t[i-1][n]<=e)return i-1;for(;r<s;){var o=Math.floor(r+(s-r)/2),a=t[o],u=t[o+1];if(a[n]===e){for(var c=o;c<t.length;c++){var p=t[c];p[n]===e&&(o=c)}return o}else{if(a[n]<e&&u[n]>e)return o;a[n]>e?s=o:a[n]<e&&(r=o+1)}}return-1}Ce.search=vn;function cr(t,e,n){if(n===void 0&&(n="ticks"),t.length){var r=vn(t,e[n],n);t.splice(r+1,0,e)}else t.push(e)}Ce.insert=cr;(function(t){Object.defineProperty(t,"__esModule",{value:!0}),t.Header=t.keySignatureKeys=void 0;var e=Ce,n=new WeakMap;t.keySignatureKeys=["Cb","Gb","Db","Ab","Eb","Bb","F","C","G","D","A","E","B","F#","C#"];var r=function(){function i(s){var o=this;if(this.tempos=[],this.timeSignatures=[],this.keySignatures=[],this.meta=[],this.name="",n.set(this,480),s){n.set(this,s.header.ticksPerBeat),s.tracks.forEach(function(u){u.forEach(function(c){c.meta&&(c.type==="timeSignature"?o.timeSignatures.push({ticks:c.absoluteTime,timeSignature:[c.numerator,c.denominator]}):c.type==="setTempo"?o.tempos.push({bpm:6e7/c.microsecondsPerBeat,ticks:c.absoluteTime}):c.type==="keySignature"&&o.keySignatures.push({key:t.keySignatureKeys[c.key+7],scale:c.scale===0?"major":"minor",ticks:c.absoluteTime}))})});var a=0;s.tracks[0].forEach(function(u){a+=u.deltaTime,u.meta&&(u.type==="trackName"?o.name=u.text:(u.type==="text"||u.type==="cuePoint"||u.type==="marker"||u.type==="lyrics")&&o.meta.push({text:u.text,ticks:a,type:u.type}))}),this.update()}}return i.prototype.update=function(){var s=this,o=0,a=0;this.tempos.sort(function(u,c){return u.ticks-c.ticks}),this.tempos.forEach(function(u,c){var p=c>0?s.tempos[c-1].bpm:s.tempos[0].bpm,h=u.ticks/s.ppq-a,l=60/p*h;u.time=l+o,o=u.time,a+=h}),this.timeSignatures.sort(function(u,c){return u.ticks-c.ticks}),this.timeSignatures.forEach(function(u,c){var p=c>0?s.timeSignatures[c-1]:s.timeSignatures[0],h=(u.ticks-p.ticks)/s.ppq,l=h/p.timeSignature[0]/(p.timeSignature[1]/4);p.measures=p.measures||0,u.measures=l+p.measures})},i.prototype.ticksToSeconds=function(s){var o=(0,e.search)(this.tempos,s);if(o!==-1){var a=this.tempos[o],u=a.time,c=(s-a.ticks)/this.ppq;return u+60/a.bpm*c}else{var p=s/this.ppq;return 60/120*p}},i.prototype.ticksToMeasures=function(s){var o=(0,e.search)(this.timeSignatures,s);if(o!==-1){var a=this.timeSignatures[o],u=(s-a.ticks)/this.ppq;return a.measures+u/(a.timeSignature[0]/a.timeSignature[1])/4}else return s/this.ppq/4},Object.defineProperty(i.prototype,"ppq",{get:function(){return n.get(this)},enumerable:!1,configurable:!0}),i.prototype.secondsToTicks=function(s){var o=(0,e.search)(this.tempos,s,"time");if(o!==-1){var a=this.tempos[o],u=a.time,c=s-u,p=c/(60/a.bpm);return Math.round(a.ticks+p*this.ppq)}else{var h=s/.5;return Math.round(h*this.ppq)}},i.prototype.toJSON=function(){return{keySignatures:this.keySignatures,meta:this.meta,name:this.name,ppq:this.ppq,tempos:this.tempos.map(function(s){return{bpm:s.bpm,ticks:s.ticks}}),timeSignatures:this.timeSignatures}},i.prototype.fromJSON=function(s){this.name=s.name,this.tempos=s.tempos.map(function(o){return Object.assign({},o)}),this.timeSignatures=s.timeSignatures.map(function(o){return Object.assign({},o)}),this.keySignatures=s.keySignatures.map(function(o){return Object.assign({},o)}),this.meta=s.meta.map(function(o){return Object.assign({},o)}),n.set(this,s.ppq),this.update()},i.prototype.setTempo=function(s){this.tempos=[{bpm:s,ticks:0}],this.update()},i}();t.Header=r})(at);var Qe={},Mt={};(function(t){Object.defineProperty(t,"__esModule",{value:!0}),t.ControlChange=t.controlChangeIds=t.controlChangeNames=void 0,t.controlChangeNames={1:"modulationWheel",2:"breath",4:"footController",5:"portamentoTime",7:"volume",8:"balance",10:"pan",64:"sustain",65:"portamentoTime",66:"sostenuto",67:"softPedal",68:"legatoFootswitch",84:"portamentoControl"},t.controlChangeIds=Object.keys(t.controlChangeNames).reduce(function(i,s){return i[t.controlChangeNames[s]]=s,i},{});var e=new WeakMap,n=new WeakMap,r=function(){function i(s,o){e.set(this,o),n.set(this,s.controllerType),this.ticks=s.absoluteTime,this.value=s.value}return Object.defineProperty(i.prototype,"number",{get:function(){return n.get(this)},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"name",{get:function(){return t.controlChangeNames[this.number]?t.controlChangeNames[this.number]:null},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"time",{get:function(){var s=e.get(this);return s.ticksToSeconds(this.ticks)},set:function(s){var o=e.get(this);this.ticks=o.secondsToTicks(s)},enumerable:!1,configurable:!0}),i.prototype.toJSON=function(){return{number:this.number,ticks:this.ticks,time:this.time,value:this.value}},i}();t.ControlChange=r})(Mt);var ht={};Object.defineProperty(ht,"__esModule",{value:!0});ht.createControlChanges=void 0;var et=Mt;function lr(){return new Proxy({},{get:function(t,e){if(t[e])return t[e];if(et.controlChangeIds.hasOwnProperty(e))return t[et.controlChangeIds[e]]},set:function(t,e,n){return et.controlChangeIds.hasOwnProperty(e)?t[et.controlChangeIds[e]]=n:t[e]=n,!0}})}ht.createControlChanges=lr;var dt={};Object.defineProperty(dt,"__esModule",{value:!0});dt.PitchBend=void 0;var gt=new WeakMap,ur=function(){function t(e,n){gt.set(this,n),this.ticks=e.absoluteTime,this.value=e.value}return Object.defineProperty(t.prototype,"time",{get:function(){var e=gt.get(this);return e.ticksToSeconds(this.ticks)},set:function(e){var n=gt.get(this);this.ticks=n.secondsToTicks(e)},enumerable:!1,configurable:!0}),t.prototype.toJSON=function(){return{ticks:this.ticks,time:this.time,value:this.value}},t}();dt.PitchBend=ur;var pt={},Te={};Object.defineProperty(Te,"__esModule",{value:!0});Te.DrumKitByPatchID=Te.InstrumentFamilyByID=Te.instrumentByPatchID=void 0;Te.instrumentByPatchID=["acoustic grand piano","bright acoustic piano","electric grand piano","honky-tonk piano","electric piano 1","electric piano 2","harpsichord","clavi","celesta","glockenspiel","music box","vibraphone","marimba","xylophone","tubular bells","dulcimer","drawbar organ","percussive organ","rock organ","church organ","reed organ","accordion","harmonica","tango accordion","acoustic guitar (nylon)","acoustic guitar (steel)","electric guitar (jazz)","electric guitar (clean)","electric guitar (muted)","overdriven guitar","distortion guitar","guitar harmonics","acoustic bass","electric bass (finger)","electric bass (pick)","fretless bass","slap bass 1","slap bass 2","synth bass 1","synth bass 2","violin","viola","cello","contrabass","tremolo strings","pizzicato strings","orchestral harp","timpani","string ensemble 1","string ensemble 2","synthstrings 1","synthstrings 2","choir aahs","voice oohs","synth voice","orchestra hit","trumpet","trombone","tuba","muted trumpet","french horn","brass section","synthbrass 1","synthbrass 2","soprano sax","alto sax","tenor sax","baritone sax","oboe","english horn","bassoon","clarinet","piccolo","flute","recorder","pan flute","blown bottle","shakuhachi","whistle","ocarina","lead 1 (square)","lead 2 (sawtooth)","lead 3 (calliope)","lead 4 (chiff)","lead 5 (charang)","lead 6 (voice)","lead 7 (fifths)","lead 8 (bass + lead)","pad 1 (new age)","pad 2 (warm)","pad 3 (polysynth)","pad 4 (choir)","pad 5 (bowed)","pad 6 (metallic)","pad 7 (halo)","pad 8 (sweep)","fx 1 (rain)","fx 2 (soundtrack)","fx 3 (crystal)","fx 4 (atmosphere)","fx 5 (brightness)","fx 6 (goblins)","fx 7 (echoes)","fx 8 (sci-fi)","sitar","banjo","shamisen","koto","kalimba","bag pipe","fiddle","shanai","tinkle bell","agogo","steel drums","woodblock","taiko drum","melodic tom","synth drum","reverse cymbal","guitar fret noise","breath noise","seashore","bird tweet","telephone ring","helicopter","applause","gunshot"];Te.InstrumentFamilyByID=["piano","chromatic percussion","organ","guitar","bass","strings","ensemble","brass","reed","pipe","synth lead","synth pad","synth effects","world","percussive","sound effects"];Te.DrumKitByPatchID={0:"standard kit",8:"room kit",16:"power kit",24:"electronic kit",25:"tr-808 kit",32:"jazz kit",40:"brush kit",48:"orchestra kit",56:"sound fx kit"};Object.defineProperty(pt,"__esModule",{value:!0});pt.Instrument=void 0;var tt=Te,Vt=new WeakMap,fr=function(){function t(e,n){if(this.number=0,Vt.set(this,n),this.number=0,e){var r=e.find(function(i){return i.type==="programChange"});r&&(this.number=r.programNumber)}}return Object.defineProperty(t.prototype,"name",{get:function(){return this.percussion?tt.DrumKitByPatchID[this.number]:tt.instrumentByPatchID[this.number]},set:function(e){var n=tt.instrumentByPatchID.indexOf(e);n!==-1&&(this.number=n)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"family",{get:function(){return this.percussion?"drums":tt.InstrumentFamilyByID[Math.floor(this.number/8)]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"percussion",{get:function(){var e=Vt.get(this);return e.channel===9},enumerable:!1,configurable:!0}),t.prototype.toJSON=function(){return{family:this.family,number:this.number,name:this.name}},t.prototype.fromJSON=function(e){this.number=e.number},t}();pt.Instrument=fr;var mt={};Object.defineProperty(mt,"__esModule",{value:!0});mt.Note=void 0;function hr(t){var e=Math.floor(t/12)-1;return yn(t)+e.toString()}function yn(t){var e=["C","C#","D","D#","E","F","F#","G","G#","A","A#","B"],n=t%12;return e[n]}function dr(t){var e=["C","C#","D","D#","E","F","F#","G","G#","A","A#","B"];return e.indexOf(t)}var pr=function(){var t=/^([a-g]{1}(?:b|#|x|bb)?)(-?[0-9]+)/i,e={cbb:-2,cb:-1,c:0,"c#":1,cx:2,dbb:0,db:1,d:2,"d#":3,dx:4,ebb:2,eb:3,e:4,"e#":5,ex:6,fbb:3,fb:4,f:5,"f#":6,fx:7,gbb:5,gb:6,g:7,"g#":8,gx:9,abb:7,ab:8,a:9,"a#":10,ax:11,bbb:9,bb:10,b:11,"b#":12,bx:13};return function(n){var r=t.exec(n),i=r[1],s=r[2],o=e[i.toLowerCase()];return o+(parseInt(s,10)+1)*12}}(),Me=new WeakMap,mr=function(){function t(e,n,r){Me.set(this,r),this.midi=e.midi,this.velocity=e.velocity,this.noteOffVelocity=n.velocity,this.ticks=e.ticks,this.durationTicks=n.ticks-e.ticks}return Object.defineProperty(t.prototype,"name",{get:function(){return hr(this.midi)},set:function(e){this.midi=pr(e)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"octave",{get:function(){return Math.floor(this.midi/12)-1},set:function(e){var n=e-this.octave;this.midi+=n*12},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"pitch",{get:function(){return yn(this.midi)},set:function(e){this.midi=12*(this.octave+1)+dr(e)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"duration",{get:function(){var e=Me.get(this);return e.ticksToSeconds(this.ticks+this.durationTicks)-e.ticksToSeconds(this.ticks)},set:function(e){var n=Me.get(this),r=n.secondsToTicks(this.time+e);this.durationTicks=r-this.ticks},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"time",{get:function(){var e=Me.get(this);return e.ticksToSeconds(this.ticks)},set:function(e){var n=Me.get(this);this.ticks=n.secondsToTicks(e)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"bars",{get:function(){var e=Me.get(this);return e.ticksToMeasures(this.ticks)},enumerable:!1,configurable:!0}),t.prototype.toJSON=function(){return{duration:this.duration,durationTicks:this.durationTicks,midi:this.midi,name:this.name,ticks:this.ticks,time:this.time,velocity:this.velocity}},t}();mt.Note=mr;Object.defineProperty(Qe,"__esModule",{value:!0});Qe.Track=void 0;var bt=Ce,vr=Mt,yr=ht,gr=dt,Lt=pt,br=mt,nt=new WeakMap,_r=function(){function t(e,n){var r=this;if(this.name="",this.notes=[],this.controlChanges=(0,yr.createControlChanges)(),this.pitchBends=[],nt.set(this,n),e){var i=e.find(function(l){return l.type==="trackName"});this.name=i?i.text:""}if(this.instrument=new Lt.Instrument(e,this),this.channel=0,e){for(var s=e.filter(function(l){return l.type==="noteOn"}),o=e.filter(function(l){return l.type==="noteOff"}),a=function(){var l=s.shift();u.channel=l.channel;var f=o.findIndex(function(m){return m.noteNumber===l.noteNumber&&m.absoluteTime>=l.absoluteTime});if(f!==-1){var d=o.splice(f,1)[0];u.addNote({durationTicks:d.absoluteTime-l.absoluteTime,midi:l.noteNumber,noteOffVelocity:d.velocity/127,ticks:l.absoluteTime,velocity:l.velocity/127})}},u=this;s.length;)a();var c=e.filter(function(l){return l.type==="controller"});c.forEach(function(l){r.addCC({number:l.controllerType,ticks:l.absoluteTime,value:l.value/127})});var p=e.filter(function(l){return l.type==="pitchBend"});p.forEach(function(l){r.addPitchBend({ticks:l.absoluteTime,value:l.value/Math.pow(2,13)})});var h=e.find(function(l){return l.type==="endOfTrack"});this.endOfTrackTicks=h!==void 0?h.absoluteTime:void 0}}return t.prototype.addNote=function(e){var n=nt.get(this),r=new br.Note({midi:0,ticks:0,velocity:1},{ticks:0,velocity:0},n);return Object.assign(r,e),(0,bt.insert)(this.notes,r,"ticks"),this},t.prototype.addCC=function(e){var n=nt.get(this),r=new vr.ControlChange({controllerType:e.number},n);return delete e.number,Object.assign(r,e),Array.isArray(this.controlChanges[r.number])||(this.controlChanges[r.number]=[]),(0,bt.insert)(this.controlChanges[r.number],r,"ticks"),this},t.prototype.addPitchBend=function(e){var n=nt.get(this),r=new gr.PitchBend({},n);return Object.assign(r,e),(0,bt.insert)(this.pitchBends,r,"ticks"),this},Object.defineProperty(t.prototype,"duration",{get:function(){if(!this.notes.length)return 0;for(var e=this.notes[this.notes.length-1].time+this.notes[this.notes.length-1].duration,n=0;n<this.notes.length-1;n++){var r=this.notes[n].time+this.notes[n].duration;e<r&&(e=r)}return e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"durationTicks",{get:function(){if(!this.notes.length)return 0;for(var e=this.notes[this.notes.length-1].ticks+this.notes[this.notes.length-1].durationTicks,n=0;n<this.notes.length-1;n++){var r=this.notes[n].ticks+this.notes[n].durationTicks;e<r&&(e=r)}return e},enumerable:!1,configurable:!0}),t.prototype.fromJSON=function(e){var n=this;this.name=e.name,this.channel=e.channel,this.instrument=new Lt.Instrument(void 0,this),this.instrument.fromJSON(e.instrument),e.endOfTrackTicks!==void 0&&(this.endOfTrackTicks=e.endOfTrackTicks);for(var r in e.controlChanges)e.controlChanges[r]&&e.controlChanges[r].forEach(function(i){n.addCC({number:i.number,ticks:i.ticks,value:i.value})});e.notes.forEach(function(i){n.addNote({durationTicks:i.durationTicks,midi:i.midi,ticks:i.ticks,velocity:i.velocity})})},t.prototype.toJSON=function(){for(var e={},n=0;n<127;n++)this.controlChanges.hasOwnProperty(n)&&(e[n]=this.controlChanges[n].map(function(i){return i.toJSON()}));var r={channel:this.channel,controlChanges:e,pitchBends:this.pitchBends.map(function(i){return i.toJSON()}),instrument:this.instrument.toJSON(),name:this.name,notes:this.notes.map(function(i){return i.toJSON()})};return this.endOfTrackTicks!==void 0&&(r.endOfTrackTicks=this.endOfTrackTicks),r},t}();Qe.Track=_r;var vt={};function wr(t){var e=[];return gn(t,e),e}function gn(t,e){for(var n=0;n<t.length;n++){var r=t[n];Array.isArray(r)?gn(r,e):e.push(r)}}const kr=Object.freeze(Object.defineProperty({__proto__:null,flatten:wr},Symbol.toStringTag,{value:"Module"})),xr=mn(kr);var ke=Be&&Be.__spreadArray||function(t,e,n){if(n||arguments.length===2)for(var r=0,i=e.length,s;r<i;r++)(s||!(r in e))&&(s||(s=Array.prototype.slice.call(e,0,r)),s[r]=e[r]);return t.concat(s||Array.prototype.slice.call(e))};Object.defineProperty(vt,"__esModule",{value:!0});vt.encode=void 0;var Tr=ft,Ir=at,Ur=xr;function Sr(t,e){return[{absoluteTime:t.ticks,channel:e,deltaTime:0,noteNumber:t.midi,type:"noteOn",velocity:Math.floor(t.velocity*127)},{absoluteTime:t.ticks+t.durationTicks,channel:e,deltaTime:0,noteNumber:t.midi,type:"noteOff",velocity:Math.floor(t.noteOffVelocity*127)}]}function Cr(t){return(0,Ur.flatten)(t.notes.map(function(e){return Sr(e,t.channel)}))}function Pr(t,e){return{absoluteTime:t.ticks,channel:e,controllerType:t.number,deltaTime:0,type:"controller",value:Math.floor(t.value*127)}}function Er(t){for(var e=[],n=0;n<127;n++)t.controlChanges.hasOwnProperty(n)&&t.controlChanges[n].forEach(function(r){e.push(Pr(r,t.channel))});return e}function Mr(t,e){return{absoluteTime:t.ticks,channel:e,deltaTime:0,type:"pitchBend",value:t.value}}function Ar(t){var e=[];return t.pitchBends.forEach(function(n){e.push(Mr(n,t.channel))}),e}function Nr(t){return{absoluteTime:0,channel:t.channel,deltaTime:0,programNumber:t.instrument.number,type:"programChange"}}function Fr(t){return{absoluteTime:0,deltaTime:0,meta:!0,text:t,type:"trackName"}}function Br(t){return{absoluteTime:t.ticks,deltaTime:0,meta:!0,microsecondsPerBeat:Math.floor(6e7/t.bpm),type:"setTempo"}}function Dr(t){return{absoluteTime:t.ticks,deltaTime:0,denominator:t.timeSignature[1],meta:!0,metronome:24,numerator:t.timeSignature[0],thirtyseconds:8,type:"timeSignature"}}function Or(t){var e=Ir.keySignatureKeys.indexOf(t.key);return{absoluteTime:t.ticks,deltaTime:0,key:e+7,meta:!0,scale:t.scale==="major"?0:1,type:"keySignature"}}function Rr(t){return{absoluteTime:t.ticks,deltaTime:0,meta:!0,text:t.text,type:t.type}}function Vr(t){var e={header:{format:1,numTracks:t.tracks.length+1,ticksPerBeat:t.header.ppq},tracks:ke([ke(ke(ke(ke([{absoluteTime:0,deltaTime:0,meta:!0,text:t.header.name,type:"trackName"}],t.header.keySignatures.map(function(n){return Or(n)}),!0),t.header.meta.map(function(n){return Rr(n)}),!0),t.header.tempos.map(function(n){return Br(n)}),!0),t.header.timeSignatures.map(function(n){return Dr(n)}),!0)],t.tracks.map(function(n){return ke(ke(ke([Fr(n.name),Nr(n)],Cr(n),!0),Er(n),!0),Ar(n),!0)}),!0)};return e.tracks=e.tracks.map(function(n){n=n.sort(function(i,s){return i.absoluteTime-s.absoluteTime});var r=0;return n.forEach(function(i){i.deltaTime=i.absoluteTime-r,r=i.absoluteTime,delete i.absoluteTime}),n.push({deltaTime:0,meta:!0,type:"endOfTrack"}),n}),new Uint8Array((0,Tr.writeMidi)(e))}vt.encode=Vr;(function(t){var e=Be&&Be.__awaiter||function(h,l,f,d){function m(v){return v instanceof f?v:new f(function(_){_(v)})}return new(f||(f=Promise))(function(v,_){function M(U){try{T(d.next(U))}catch(z){_(z)}}function L(U){try{T(d.throw(U))}catch(z){_(z)}}function T(U){U.done?v(U.value):m(U.value).then(M,L)}T((d=d.apply(h,l||[])).next())})},n=Be&&Be.__generator||function(h,l){var f={label:0,sent:function(){if(v[0]&1)throw v[1];return v[1]},trys:[],ops:[]},d,m,v,_;return _={next:M(0),throw:M(1),return:M(2)},typeof Symbol=="function"&&(_[Symbol.iterator]=function(){return this}),_;function M(T){return function(U){return L([T,U])}}function L(T){if(d)throw new TypeError("Generator is already executing.");for(;f;)try{if(d=1,m&&(v=T[0]&2?m.return:T[0]?m.throw||((v=m.return)&&v.call(m),0):m.next)&&!(v=v.call(m,T[1])).done)return v;switch(m=0,v&&(T=[T[0]&2,v.value]),T[0]){case 0:case 1:v=T;break;case 4:return f.label++,{value:T[1],done:!1};case 5:f.label++,m=T[1],T=[0];continue;case 7:T=f.ops.pop(),f.trys.pop();continue;default:if(v=f.trys,!(v=v.length>0&&v[v.length-1])&&(T[0]===6||T[0]===2)){f=0;continue}if(T[0]===3&&(!v||T[1]>v[0]&&T[1]<v[3])){f.label=T[1];break}if(T[0]===6&&f.label<v[1]){f.label=v[1],v=T;break}if(v&&f.label<v[2]){f.label=v[2],f.ops.push(T);break}v[2]&&f.ops.pop(),f.trys.pop();continue}T=l.call(h,f)}catch(U){T=[6,U],m=0}finally{d=v=0}if(T[0]&5)throw T[1];return{value:T[0]?T[1]:void 0,done:!0}}};Object.defineProperty(t,"__esModule",{value:!0}),t.Header=t.Track=t.Midi=void 0;var r=ft,i=at,s=Qe,o=vt,a=function(){function h(l){var f=this,d=null;if(l){var m=l instanceof ArrayBuffer?new Uint8Array(l):l;d=(0,r.parseMidi)(m),d.tracks.forEach(function(v){var _=0;v.forEach(function(M){_+=M.deltaTime,M.absoluteTime=_})}),d.tracks=p(d.tracks)}this.header=new i.Header(d),this.tracks=[],l&&(this.tracks=d.tracks.map(function(v){return new s.Track(v,f.header)}),d.header.format===1&&this.tracks[0].duration===0&&this.tracks.shift())}return h.fromUrl=function(l){return e(this,void 0,void 0,function(){var f,d;return n(this,function(m){switch(m.label){case 0:return[4,fetch(l)];case 1:return f=m.sent(),f.ok?[4,f.arrayBuffer()]:[3,3];case 2:return d=m.sent(),[2,new h(d)];case 3:throw new Error("Could not load '".concat(l,"'"))}})})},Object.defineProperty(h.prototype,"name",{get:function(){return this.header.name},set:function(l){this.header.name=l},enumerable:!1,configurable:!0}),Object.defineProperty(h.prototype,"duration",{get:function(){var l=this.tracks.map(function(f){return f.duration});return Math.max.apply(Math,l)},enumerable:!1,configurable:!0}),Object.defineProperty(h.prototype,"durationTicks",{get:function(){var l=this.tracks.map(function(f){return f.durationTicks});return Math.max.apply(Math,l)},enumerable:!1,configurable:!0}),h.prototype.addTrack=function(){var l=new s.Track(void 0,this.header);return this.tracks.push(l),l},h.prototype.toArray=function(){return(0,o.encode)(this)},h.prototype.toJSON=function(){return{header:this.header.toJSON(),tracks:this.tracks.map(function(l){return l.toJSON()})}},h.prototype.fromJSON=function(l){var f=this;this.header=new i.Header,this.header.fromJSON(l.header),this.tracks=l.tracks.map(function(d){var m=new s.Track(void 0,f.header);return m.fromJSON(d),m})},h.prototype.clone=function(){var l=new h;return l.fromJSON(this.toJSON()),l},h}();t.Midi=a;var u=Qe;Object.defineProperty(t,"Track",{enumerable:!0,get:function(){return u.Track}});var c=at;Object.defineProperty(t,"Header",{enumerable:!0,get:function(){return c.Header}});function p(h){for(var l=[],f=0;f<h.length;f++)for(var d=l.length,m=new Map,v=Array(16).fill(0),_=0,M=h[f];_<M.length;_++){var L=M[_],T=d,U=L.channel;if(U!==void 0){L.type==="programChange"&&(v[U]=L.programNumber);var z=v[U],x="".concat(z," ").concat(U);m.has(x)?T=m.get(x):(T=d+m.size,m.set(x,T))}l[T]||l.push([]),l[T].push(L)}return l}})(St);const Ae=[];function ie(t,e=G){let n;const r=new Set;function i(a){if(Pe(t,a)&&(t=a,n)){const u=!Ae.length;for(const c of r)c[1](),Ae.push(c,t);if(u){for(let c=0;c<Ae.length;c+=2)Ae[c][0](Ae[c+1]);Ae.length=0}}}function s(a){i(a(t))}function o(a,u=G){const c=[a,u];return r.add(c),r.size===1&&(n=e(i,s)||G),a(t),()=>{r.delete(c),r.size===0&&n&&(n(),n=null)}}return{set:i,update:s,subscribe:o}}const De=["C","C#","D","D#","E","F","F#","G","G#","A","A#","B"],zt={Backquote:"A#2",Tab:"B2",KeyQ:"C3",Digit2:"C#3",KeyW:"D3",Digit3:"D#3",KeyE:"E3",KeyR:"F3",Digit5:"F#3",KeyT:"G3",Digit6:"G#3",KeyY:"A3",Digit7:"A#3",KeyU:"B3",KeyI:"C4",Digit9:"C#4",KeyO:"D4",Digit0:"D#4",KeyP:"E4",BracketLeft:"F4",Equal:"F#4",BracketRight:"G4",Backspace:"G#4",Backslash:"A4",CapsLock:"A#4",Escape:"A#4",ShiftLeft:"B4",KeyZ:"C5",KeyS:"C#5",KeyX:"D5",KeyD:"D#5",KeyC:"E5",KeyV:"F5",KeyG:"F#5",KeyB:"G5",KeyH:"G#5",KeyN:"A5",KeyJ:"A#5",KeyM:"B5",Comma:"C6",KeyL:"C#6",Period:"D6",Semicolon:"D#6",Slash:"E6",ShiftRight:"F6",Enter:"F#6"},Lr={"A#2":"`",B2:"↹",C3:"Q","C#3":"2",D3:"W","D#3":"3",E3:"E",F3:"R","F#3":"5",G3:"T","G#3":"6",A3:"Y","A#3":"7",B3:"U",C4:"I","C#4":"9",D4:"O","D#4":"0",E4:"P",F4:"[","F#4":"=",G4:"]","G#4":"⌫",A4:"\\","A#4":"⇪",B4:"⇧",C5:"Z","C#5":"S",D5:"X","D#5":"D",E5:"C",F5:"V","F#5":"G",G5:"B","G#5":"H",A5:"N","A#5":"J",B5:"M",C6:",","C#6":"L",D6:".","D#6":";",E6:"/",F6:"⇧","F#6":"↩"};function Ct(t){return parseInt(t.charAt(t.length-1))}function ct(t){return t.substring(0,t.length-1)}function qe(t){const e=Math.floor(t/12)-1;return De[t%12]+e}function lt(t){const e=De.indexOf(ct(t));return(Ct(t)+1)*12+e}function zr(t){const[e,n]=t.split(","),r=Ct(n),i=Ct(e),s=De.indexOf(ct(e)),o=De.indexOf(ct(n)),a={};let u=0,c=s;for(let p=i;p<=r;p++){for(;c<De.length&&!(p===r&&c>o);){const h=De[c],l=h.length===1;a[h+p]={isWhite:l,pressedColor:null},l&&u++,c++}c=0}return[a,u]}var bn={exports:{}},_n={exports:{}};function Hr(t){return t>64&&t<91?t-65:t>96&&t<123?t-71:t>47&&t<58?t+4:t===43?62:t===47?63:0}function Kr(t,e){for(var n=t.replace(/[^A-Za-z0-9\+\/]/g,""),r=n.length,i=e?Math.ceil((r*3+1>>2)/e)*e:r*3+1>>2,s=new Uint8Array(i),o,a,u=0,c=0,p=0;p<r;p++)if(a=p&3,u|=Hr(n.charCodeAt(p))<<18-6*a,a===3||r-p===1){for(o=0;o<3&&c<i;o++,c++)s[c]=u>>>(16>>>o&24)&255;u=0}return s}var qr={decode:Kr},Gr=function(t,e){return new Promise(function(n,r){var i=new XMLHttpRequest;e&&(i.responseType=e),i.open("GET",t),i.onload=function(){i.status===200?n(i.response):r(Error(i.statusText))},i.onerror=function(){r(Error("Network Error"))},i.send()})};(function(t){var e=qr,n=Gr;function r(x){return function(w){return typeof w=="string"&&x.test(w)}}function i(x,w){return typeof x=="string"?x+w:typeof x=="function"?x(w):w}function s(x,w,E,S){var $=o(w)?a:u(w)?c:p(w)?h:l(w)?f:d(w)?m:v(w)?_:M(w)?L:T(w)?U:null,H=E||{};return $?$(x,w,H):S?Promise.resolve(S):Promise.reject("Source not valid ("+w+")")}s.fetch=n;function o(x){return x instanceof ArrayBuffer}function a(x,w,E){return new Promise(function(S,$){x.decodeAudioData(w,function(H){S(H)},function(){$("Can't decode audio data ("+w.slice(0,30)+"...)")})})}var u=r(/\.(mp3|wav|ogg)(\?.*)?$/i);function c(x,w,E){var S=i(E.from,w);return s(x,s.fetch(S,"arraybuffer"),E)}function p(x){return x&&typeof x.then=="function"}function h(x,w,E){return w.then(function(S){return s(x,S,E)})}var l=Array.isArray;function f(x,w,E){return Promise.all(w.map(function(S){return s(x,S,E,S)}))}function d(x){return x&&typeof x=="object"}function m(x,w,E){var S={},$=Object.keys(w).map(function(H){if(E.only&&E.only.indexOf(H)===-1)return null;var se=w[H];return s(x,se,E,se).then(function(F){S[H]=F})});return Promise.all($).then(function(){return S})}var v=r(/\.json(\?.*)?$/i);function _(x,w,E){var S=i(E.from,w);return s(x,s.fetch(S,"text").then(JSON.parse),E)}var M=r(/^data:audio/);function L(x,w,E){var S=w.indexOf(",");return s(x,e.decode(w.slice(S+1)).buffer,E)}var T=r(/\.js(\?.*)?$/i);function U(x,w,E){var S=i(E.from,w);return s(x,s.fetch(S,"text").then(z),E)}function z(x){var w=x.indexOf("MIDI.Soundfont.");if(w<0)throw Error("Invalid MIDI.js Soundfont format");w=x.indexOf("=",w)+2;var E=x.lastIndexOf(",");return JSON.parse(x.slice(w,E)+"}")}t.exports&&(t.exports=s),typeof window<"u"&&(window.loadAudio=s)})(_n);var Wr=_n.exports,wn={exports:{}},Jr=Xr;function Xr(t){var e=t.createGain(),n=e._voltage=Zr(t),r=Ne(n),i=Ne(n),s=Ne(n);return e._startAmount=Ne(i),e._endAmount=Ne(s),e._multiplier=Ne(r),e._multiplier.connect(e),e._startAmount.connect(e),e._endAmount.connect(e),e.value=r.gain,e.startValue=i.gain,e.endValue=s.gain,e.startValue.value=0,e.endValue.value=0,Object.defineProperties(e,Yr),e}var Yr={attack:{value:0,writable:!0},decay:{value:0,writable:!0},sustain:{value:1,writable:!0},release:{value:0,writable:!0},getReleaseDuration:{value:function(){return this.release}},start:{value:function(t){var e=this._multiplier.gain,n=this._startAmount.gain,r=this._endAmount.gain;this._voltage.start(t),this._decayFrom=this._decayFrom=t+this.attack,this._startedAt=t;var i=this.sustain;e.cancelScheduledValues(t),n.cancelScheduledValues(t),r.cancelScheduledValues(t),r.setValueAtTime(0,t),this.attack?(e.setValueAtTime(0,t),e.linearRampToValueAtTime(1,t+this.attack),n.setValueAtTime(1,t),n.linearRampToValueAtTime(0,t+this.attack)):(e.setValueAtTime(1,t),n.setValueAtTime(0,t)),this.decay&&e.setTargetAtTime(i,this._decayFrom,Ht(this.decay))}},stop:{value:function(t,e){e&&(t=t-this.release);var n=t+this.release;if(this.release){var r=this._multiplier.gain,i=this._startAmount.gain,s=this._endAmount.gain;r.cancelScheduledValues(t),i.cancelScheduledValues(t),s.cancelScheduledValues(t);var o=Ht(this.release);if(this.attack&&t<this._decayFrom){var a=Qr(0,1,this._startedAt,this._decayFrom,t);r.linearRampToValueAtTime(a,t),i.linearRampToValueAtTime(1-a,t),i.setTargetAtTime(0,t,o)}s.setTargetAtTime(1,t,o),r.setTargetAtTime(0,t,o)}return this._voltage.stop(n),n}},onended:{get:function(){return this._voltage.onended},set:function(t){this._voltage.onended=t}}},$r=new Float32Array([1,1]);function Zr(t){var e=t.createBufferSource(),n=t.createBuffer(1,2,t.sampleRate);return n.getChannelData(0).set($r),e.buffer=n,e.loop=!0,e}function Ne(t){var e=t.context.createGain();return t.connect(e),e}function Ht(t){return Math.log(t+1)/Math.log(100)}function Qr(t,e,n,r,i){var s=e-t,o=r-n,a=i-n,u=a/o,c=t+u*s;return c<=t&&(c=t),c>=e&&(c=e),c}var jr=Jr,ei={},ti={gain:1,attack:.01,decay:.1,sustain:.9,release:.3,loop:!1,cents:0,loopStart:0,loopEnd:0};function ni(t,e,n){var r=!1,i=0,s={},o=t.createGain();o.gain.value=1;var a=Object.assign({},ti,n),u={context:t,out:o,opts:a};return e instanceof AudioBuffer?u.buffer=e:u.buffers=e,u.start=function(h,l,f){if(u.buffer&&h!==null)return u.start(null,h,l);var d=h?u.buffers[h]:u.buffer;if(d){if(!r){console.warn("SamplePlayer not connected to any node.");return}}else{console.warn("Buffer "+h+" not found.");return}var m=f||ei;l=Math.max(t.currentTime,l||0),u.emit("start",l,h,m);var v=p(h,d,m);return v.id=c(h,v),v.env.start(l),v.source.start(l),u.emit("started",l,v.id,v),m.duration&&v.stop(l+m.duration),v},u.play=function(h,l,f){return u.start(h,l,f)},u.stop=function(h,l){var f;return l=l||Object.keys(s),l.map(function(d){return f=s[d],f?(f.stop(h),f.id):null})},u.connect=function(h){return r=!0,o.connect(h),u},u.emit=function(h,l,f,d){u.onevent&&u.onevent(h,l,f,d);var m=u["on"+h];m&&m(l,f,d)},u;function c(h,l){return l.id=i++,s[l.id]=l,l.source.onended=function(){var f=t.currentTime;l.source.disconnect(),l.env.disconnect(),l.disconnect(),u.emit("ended",f,l.id,l)},l.id}function p(h,l,f){var d=t.createGain();return d.gain.value=0,d.connect(o),d.env=ii(t,f,a),d.env.connect(d.gain),d.source=t.createBufferSource(),d.source.buffer=l,d.source.connect(d),d.source.loop=f.loop||a.loop,d.source.playbackRate.value=oi(f.cents||a.cents),d.source.loopStart=f.loopStart||a.loopStart,d.source.loopEnd=f.loopEnd||a.loopEnd,d.stop=function(m){var v=m||t.currentTime;u.emit("stop",v,h);var _=d.env.stop(v);d.source.stop(_)},d}}function Kt(t){return typeof t=="number"}var ri=["attack","decay","sustain","release"];function ii(t,e,n){var r=jr(t),i=e.adsr||n.adsr;return ri.forEach(function(s,o){i?r[s]=i[o]:r[s]=e[s]||n[s]}),r.value.value=Kt(e.gain)?e.gain:Kt(n.gain)?n.gain:1,r}function oi(t){return t?Math.pow(2,t/1200):1}var si=ni,ai=function(t){return t.on=function(e,n){if(arguments.length===1&&typeof e=="function")return t.on("event",e);var r="on"+e,i=t[r];return t[r]=i?ci(i,n):n,t},t};function ci(t,e){return function(n,r,i,s){t(n,r,i,s),e(n,r,i,s)}}var kn=/^([a-gA-G])(#{1,}|b{1,}|x{1,}|)(-?\d*)\s*(.*)\s*$/;function li(){return kn}var ui=[0,2,4,5,7,9,11];function xn(t,e,n){if(typeof t!="string")return null;var r=kn.exec(t);if(!r||!e&&r[4])return null;var i={letter:r[1].toUpperCase(),acc:r[2].replace(/x/g,"##")};return i.pc=i.letter+i.acc,i.step=(i.letter.charCodeAt(0)+3)%7,i.alt=i.acc[0]==="b"?-i.acc.length:i.acc.length,i.chroma=ui[i.step]+i.alt,r[3]&&(i.oct=+r[3],i.midi=i.chroma+12*(i.oct+1),i.freq=Tn(i.midi,n)),e&&(i.tonicOf=r[4]),i}function Tn(t,e){return Math.pow(2,(t-69)/12)*(e||440)}var In={parse:xn,regex:li,midiToFreq:Tn},fi=["letter","acc","pc","step","alt","chroma","oct","midi","freq"];fi.forEach(function(t){In[t]=function(e){var n=xn(e);return n&&typeof n[t]<"u"?n[t]:null}});var hi=In,di=hi,pi=function(t){return t!==null&&t!==[]&&t>=0&&t<129},mi=function(t){return pi(t)?+t:di.midi(t)},vi=function(t){if(t.buffers){var e=t.opts.map,n=typeof e=="function"?e:mi,r=function(s){return s?n(s)||s:null};t.buffers=yi(t.buffers,r);var i=t.start;t.start=function(s,o,a){var u=r(s),c=u%1;return c&&(u=Math.floor(u),a=Object.assign(a||{},{cents:Math.floor(c*100)})),i(u,o,a)}}return t};function yi(t,e){return Object.keys(t).reduce(function(n,r){return n[e(r)]=t[r],n},{})}var gi=Array.isArray,bi=function(t){return t&&typeof t=="object"},_i={},wi=function(t){return t.schedule=function(e,n){var r=t.context.currentTime,i=e<r?r:e;t.emit("schedule",i,n);var s,o,a,u;return n.map(function(c){if(c)gi(c)?(s=c[0],o=c[1]):(s=c.time,o=c);else return null;return bi(o)?(a=o.name||o.key||o.note||o.midi||null,u=o):(a=o,u=_i),t.start(a,i+(s||0),u)})},t};function rt(t){throw new Error('Could not dynamically require "'+t+'". Please configure the dynamicRequireTargets or/and ignoreDynamicRequires option of @rollup/plugin-commonjs appropriately for this require call to work.')}var Un={exports:{}};(function(t,e){(function(n){t.exports=n()})(function(){return function n(r,i,s){function o(c,p){if(!i[c]){if(!r[c]){var h=typeof rt=="function"&&rt;if(!p&&h)return h(c,!0);if(a)return a(c,!0);var l=new Error("Cannot find module '"+c+"'");throw l.code="MODULE_NOT_FOUND",l}var f=i[c]={exports:{}};r[c][0].call(f.exports,function(d){var m=r[c][1][d];return o(m||d)},f,f.exports,n,r,i,s)}return i[c].exports}for(var a=typeof rt=="function"&&rt,u=0;u<s.length;u++)o(s[u]);return o}({1:[function(n,r,i){Object.defineProperty(i,"__esModule",{value:!0}),i.default=function(s){function o(a){if(this._event=a,this._data=a.data,this.receivedTime=a.receivedTime,this._data&&this._data.length<2){console.warn("Illegal MIDI message of length",this._data.length);return}switch(this._messageCode=a.data[0]&240,this.channel=a.data[0]&15,this._messageCode){case 128:this.messageType="noteoff",this.key=a.data[1]&127,this.velocity=a.data[2]&127;break;case 144:this.messageType="noteon",this.key=a.data[1]&127,this.velocity=a.data[2]&127;break;case 160:this.messageType="keypressure",this.key=a.data[1]&127,this.pressure=a.data[2]&127;break;case 176:this.messageType="controlchange",this.controllerNumber=a.data[1]&127,this.controllerValue=a.data[2]&127,this.controllerNumber===120&&this.controllerValue===0?this.channelModeMessage="allsoundoff":this.controllerNumber===121?this.channelModeMessage="resetallcontrollers":this.controllerNumber===122?this.controllerValue===0?this.channelModeMessage="localcontroloff":this.channelModeMessage="localcontrolon":this.controllerNumber===123&&this.controllerValue===0?this.channelModeMessage="allnotesoff":this.controllerNumber===124&&this.controllerValue===0?this.channelModeMessage="omnimodeoff":this.controllerNumber===125&&this.controllerValue===0?this.channelModeMessage="omnimodeon":this.controllerNumber===126?this.channelModeMessage="monomodeon":this.controllerNumber===127&&(this.channelModeMessage="polymodeon");break;case 192:this.messageType="programchange",this.program=a.data[1];break;case 208:this.messageType="channelpressure",this.pressure=a.data[1]&127;break;case 224:this.messageType="pitchbendchange";var u=a.data[2]&127,c=a.data[1]&127;this.pitchBend=(u<<8)+c;break}}return new o(s)},r.exports=i.default},{}]},{},[1])(1)})})(Un);var ki=Un.exports,xi=ki,Ti=function(t){return t.listenToMidi=function(e,n){var r={},i=n||{},s=i.gain||function(o){return o/127};return e.onmidimessage=function(o){var a=o.messageType?o:xi(o);if(a.messageType==="noteon"&&a.velocity===0&&(a.messageType="noteoff"),!(i.channel&&a.channel!==i.channel))switch(a.messageType){case"noteon":r[a.key]=t.play(a.key,0,{gain:s(a.velocity)});break;case"noteoff":r[a.key]&&(r[a.key].stop(),delete r[a.key]);break}},t},t};(function(t){var e=si,n=ai,r=vi,i=wi,s=Ti;function o(a,u,c){return s(i(r(n(e(a,u,c)))))}t.exports&&(t.exports=o),typeof window<"u"&&(window.SamplePlayer=o)})(wn);var Ii=wn.exports;function qt(t,e){return Array(e+1).join(t)}function At(t){return typeof t=="number"}function Ui(t){return typeof t=="string"}function Si(t){return typeof t<"u"}function Sn(t,e){return Math.pow(2,(t-69)/12)*(e||440)}var Cn=/^([a-gA-G])(#{1,}|b{1,}|x{1,}|)(-?\d*)\s*(.*)\s*$/;function Ci(){return Cn}var Pi=[0,2,4,5,7,9,11];function _e(t,e,n){if(typeof t!="string")return null;var r=Cn.exec(t);if(!r||!e&&r[4])return null;var i={letter:r[1].toUpperCase(),acc:r[2].replace(/x/g,"##")};i.pc=i.letter+i.acc,i.step=(i.letter.charCodeAt(0)+3)%7,i.alt=i.acc[0]==="b"?-i.acc.length:i.acc.length;var s=Pi[i.step]+i.alt;return i.chroma=s<0?12+s:s%12,r[3]&&(i.oct=+r[3],i.midi=s+12*(i.oct+1),i.freq=Sn(i.midi,n)),e&&(i.tonicOf=r[4]),i}var Ei="CDEFGAB";function Mi(t){return At(t)?t<0?qt("b",-t):qt("#",t):""}function Ai(t){return At(t)?""+t:""}function Pn(t,e,n){return t===null||typeof t>"u"?null:t.step?Pn(t.step,t.alt,t.oct):t<0||t>6?null:Ei.charAt(t)+Mi(e)+Ai(n)}function En(t){if((At(t)||Ui(t))&&t>=0&&t<128)return+t;var e=_e(t);return e&&Si(e.midi)?e.midi:null}function Ni(t,e){var n=En(t);return n===null?null:Sn(n,e)}function Fi(t){return(_e(t)||{}).letter}function Bi(t){return(_e(t)||{}).acc}function Di(t){return(_e(t)||{}).pc}function Oi(t){return(_e(t)||{}).step}function Ri(t){return(_e(t)||{}).alt}function Vi(t){return(_e(t)||{}).chroma}function Li(t){return(_e(t)||{}).oct}const zi=Object.freeze(Object.defineProperty({__proto__:null,acc:Bi,alt:Ri,build:Pn,chroma:Vi,freq:Ni,letter:Fi,midi:En,oct:Li,parse:_e,pc:Di,regex:Ci,step:Oi},Symbol.toStringTag,{value:"Module"})),Hi=mn(zi);var _t,Gt;function Ki(){if(Gt)return _t;Gt=1;var t=Hi;function e(i,s){if(console.warn("new Soundfont() is deprected"),console.log("Please use Soundfont.instrument() instead of new Soundfont().instrument()"),!(this instanceof e))return new e(i);this.nameToUrl=s||e.nameToUrl,this.ctx=i,this.instruments={},this.promises=[]}e.prototype.onready=function(i){console.warn("deprecated API"),console.log("Please use Promise.all(Soundfont.instrument(), Soundfont.instrument()).then() instead of new Soundfont().onready()"),Promise.all(this.promises).then(i)},e.prototype.instrument=function(i,s){console.warn("new Soundfont().instrument() is deprecated."),console.log("Please use Soundfont.instrument() instead.");var o=this.ctx;if(i=i||"default",i in this.instruments)return this.instruments[i];var a={name:i,play:r(o,s)};if(this.instruments[i]=a,i!=="default"){var u=e.instrument(o,i,s).then(function(c){return a.play=c.play,a});this.promises.push(u),a.onready=function(c){console.warn("onready is deprecated. Use Soundfont.instrument().then()"),u.then(c)}}else a.onready=function(c){console.warn("onready is deprecated. Use Soundfont.instrument().then()"),c()};return a};function n(i,s,o){return console.warn("Soundfont.loadBuffers is deprecate."),console.log("Use Soundfont.instrument(..) and get buffers properties from the result."),e.instrument(i,s,o).then(function(a){return a.buffers})}e.loadBuffers=n;function r(i,s){return s=s||{},function(o,a,u,c){console.warn("The oscillator player is deprecated."),console.log("Starting with version 0.9.0 you will have to wait until the soundfont is loaded to play sounds.");var p=o>0&&o<129?+o:t.midi(o),h=p?t.midiToFreq(p,440):null;if(h){u=u||.2,c=c||{};var l=c.destination||s.destination||i.destination,f=c.vcoType||s.vcoType||"sine",d=c.gain||s.gain||.4,m=i.createOscillator();m.type=f,m.frequency.value=h;var v=i.createGain();return v.gain.value=d,m.connect(v),v.connect(l),m.start(a),u>0&&m.stop(a+u),m}}}return e.noteToMidi=t.midi,_t=e,_t}(function(t){var e=Wr,n=Ii;function r(a,u,c){if(arguments.length===1)return function(d,m){return r(a,d,m)};var p=c||{},h=p.isSoundfontURL||i,l=p.nameToUrl||s,f=h(u)?u:l(u,p.soundfont,p.format);return e(a,f,{only:p.only||p.notes}).then(function(d){var m=n(a,d,p).connect(p.destination?p.destination:a.destination);return m.url=f,m.name=u,m})}function i(a){return/\.js(\?.*)?$/i.test(a)}function s(a,u,c){return c=c==="ogg"?c:"mp3",u=u==="FluidR3_GM"?u:"MusyngKite","https://gleitz.github.io/midi-js-soundfonts/"+u+"/"+a+"-"+c+".js"}var o=Ki();o.instrument=r,o.nameToUrl=s,t.exports&&(t.exports=o),typeof window<"u"&&(window.Soundfont=o)})(bn);var qi=bn.exports;const Mn=window.AudioContext||window.webkitAudioContext,Gi=new Mn;Mn||alert("Your browser does not seem to support the Web Audio API!");const wt={};function Wi(t){return wt[t]||(wt[t]=qi.instrument(Gi,t)),wt[t]}function Ji(t,e){if(!t||t.length==0)return 0;let n=0,r=t.length-1;for(;n!=r;){const i=Math.ceil((n+r)/2);e(t[i])>=0?r=i-1:n=i}return r}function Xi(t,e){t[e]=t[t.length-1],t.pop()}function An(t){return t.split("_").map(r=>r.charAt(0).toUpperCase()+r.slice(1)).join(" ")}class Yi{constructor(){A(this,"isPlaying",ie(!1));A(this,"currentTime",ie(0));A(this,"totalTime",ie(0));A(this,"speed",ie(1));A(this,"isRecording",ie(!1));A(this,"selectedTrack",ie(0));A(this,"data",new St.Midi);A(this,"tracks",ie(this.data.tracks));A(this,"shouldPlaySolo",ie(!1));A(this,"lastStartFunc",()=>{});A(this,"tracksIndexUpTo",[]);A(this,"loopIntervalID",null);A(this,"playingHeldNotes",[]);A(this,"recordingHeldNotes",new Map);A(this,"recoringMidiData",null);A(this,"midiLastStartTime",0);A(this,"onPlayNote");A(this,"onStopNote");this.tracks.subscribe(e=>{const n=e.length==0?0:this.data.duration;this.totalTime.set(n),this.currentTime.set(Math.min(n,ee(this.currentTime)))})}startPlaying(){this.recalcPlayIndex(),this.startLoop(e=>{this.onPlayUpdate(e),e>ee(this.totalTime)&&(this.stop(),this.lastStartFunc=()=>{},this.currentTime.set(0))}),this.isPlaying.set(!0),this.lastStartFunc=this.startPlaying.bind(this),this.midiLastStartTime=ee(this.currentTime)}startRecording(){this.data.tracks.length==0&&this.addTrack(),this.data.tracks[ee(this.selectedTrack)].notes=[],this.recoringMidiData=this.data.clone(),this.recalcPlayIndex(),this.isRecording.set(!0),this.lastStartFunc=this.startRecording.bind(this),this.midiLastStartTime=ee(this.currentTime)}stop(){clearInterval(this.loopIntervalID),this.loopIntervalID=null,this.playingHeldNotes.forEach(e=>this.onStopNote(e.name)),this.playingHeldNotes=[],this.isPlaying.set(!1),this.recoringMidiData&&(this.data=this.recoringMidiData,this.recoringMidiData=null,this.tracks.set(this.data.tracks)),this.isRecording.set(!1),this.recordingHeldNotes.clear()}recordPlayNote(e,n){if(!ee(this.isRecording))return;this.loopIntervalID===null&&this.startLoop(i=>{this.onPlayUpdate(i),i>ee(this.totalTime)&&this.totalTime.set(i)});const r=lt(e);this.recordingHeldNotes.set(r,{midi:r,velocity:n,time:ee(this.currentTime)})}recordStopNote(e){if(!ee(this.isRecording))return;const n=lt(e),r=this.recordingHeldNotes.get(n);r&&(r.duration=ee(this.currentTime)-r.time,this.recoringMidiData.tracks[ee(this.selectedTrack)].addNote(r),this.recordingHeldNotes.delete(n))}addTrack(){const e=this.data.addTrack();this.selectedTrack.set(this.data.tracks.length-1),this.tracks.set(this.data.tracks);const n=prompt("Enter the track name: ");n&&(e.name=n)}deleteTrack(){const e=ee(this.selectedTrack);this.data.tracks.splice(e,1),this.selectedTrack.set(Math.min(this.data.tracks.length-1,e)),this.tracks.set(this.data.tracks)}saveFile(){const e=new Blob([this.data.toArray()],{type:"application/octet-stream"}),n=URL.createObjectURL(e),r=document.createElement("a");r.href=n,r.download="record.midi",document.body.appendChild(r),r.click(),document.body.removeChild(r),URL.revokeObjectURL(n)}setFile(e){if(!e)return;const n=new FileReader;n.onload=()=>{this.data=new St.Midi(n.result),this.tracks.set(this.data.tracks),this.selectedTrack.set(0)},n.readAsArrayBuffer(e)}stopAndReseek(){this.stop(),this.lastStartFunc=()=>{},this.currentTime.set(this.midiLastStartTime)}recalcPlayIndex(){this.data.tracks.forEach((e,n)=>{const r=ee(this.currentTime);this.tracksIndexUpTo[n]=Ji(e.notes,i=>i.time-r)})}startLoop(e){let n=performance.now();this.loopIntervalID=setInterval(()=>{const r=performance.now(),s=(r-n)/1e3*ee(this.speed),o=ee(this.currentTime)+s;this.currentTime.set(o),e(o),n=r},10)}onPlayUpdate(e){if(this.playingHeldNotes.forEach((n,r)=>{e>n.time+n.duration&&(this.onStopNote(n.name),Xi(this.playingHeldNotes,r))}),ee(this.shouldPlaySolo)){const n=ee(this.selectedTrack);this.checkTracksPlayNotes(e,n)}else for(let n=0;n<this.data.tracks.length;n++)this.checkTracksPlayNotes(e,n)}checkTracksPlayNotes(e,n){const r=this.data.tracks[n];for(;;){const i=r.notes[this.tracksIndexUpTo[n]];if(!i||e<i.time)break;i.time+i.duration>e&&(this.onPlayNote(i.name,i.velocity),this.playingHeldNotes.push(i)),this.tracksIndexUpTo[n]++}}}function Wt(t,e,n){const r=t.slice();return r[39]=e[n][0],r[40]=e[n][1].isWhite,r[41]=e[n][1].pressedColor,r}function Jt(t){let e,n=t[18](t[39],t[6],t[5],t[4])+"",r,i,s,o,a;function u(...l){return t[27](t[39],...l)}function c(){return t[28](t[39])}function p(){return t[29](t[39])}function h(){return t[30](t[39])}return{c(){e=b("div"),r=oe(n),i=N(),k(e,"class",s="key "+(t[40]?"white":"black")+" svelte-1569eu9"),Ue(e,"--color-hue",t[41]),Dt(e,"pressed",t[41]!==null)},m(l,f){D(l,e,f),y(e,r),y(e,i),o||(a=[P(e,"pointerdown",u),P(e,"pointerenter",c),P(e,"pointerleave",p),P(e,"pointerup",h)],o=!0)},p(l,f){t=l,f[0]&120&&n!==(n=t[18](t[39],t[6],t[5],t[4])+"")&&$e(r,n),f[0]&8&&s!==(s="key "+(t[40]?"white":"black")+" svelte-1569eu9")&&k(e,"class",s),f[0]&8&&Ue(e,"--color-hue",t[41]),f[0]&8&&Dt(e,"pressed",t[41]!==null)},d(l){l&&B(e),o=!1,pe(a)}}}function $i(t){let e,n,r,i,s=be(Object.entries(t[3])),o=[];for(let a=0;a<s.length;a+=1)o[a]=Jt(Wt(t,s,a));return{c(){e=b("div"),n=b("div");for(let a=0;a<o.length;a+=1)o[a].c();k(n,"class","piano svelte-1569eu9"),k(e,"class","piano-container svelte-1569eu9")},m(a,u){D(a,e,u),y(e,n);for(let c=0;c<o.length;c+=1)o[c]&&o[c].m(n,null);t[31](e),r||(i=[P(window,"resize",t[24]),P(window,"keyup",t[17]),P(window,"keydown",t[16]),P(window,"pointerdown",t[25]),P(window,"pointerup",t[26]),P(n,"touchstart",Hn(t[23]))],r=!0)},p(a,u){if(u[0]&286842){s=be(Object.entries(a[3]));let c;for(c=0;c<s.length;c+=1){const p=Wt(a,s,c);o[c]?o[c].p(p,u):(o[c]=Jt(p),o[c].c(),o[c].m(n,null))}for(;c<o.length;c+=1)o[c].d(1);o.length=s.length}},i:G,o:G,d(a){a&&B(e),Ye(o,a),t[31](null),r=!1,pe(i)}}}function Zi(t,e,n){let r,i,s,o,a,u,c,p,h=!1,l,f=new Map,{pianoControlsData:d}=e,{noteRange:m,sustain:v,noteShift:_,octaveShift:M,volume:L,labelType:T}=d;J(t,m,g=>n(22,c=g)),J(t,v,g=>n(32,s=g)),J(t,_,g=>n(5,u=g)),J(t,M,g=>n(4,a=g)),J(t,L,g=>n(33,o=g)),J(t,T,g=>n(6,p=g));let{midiPlayer:U}=e;U.onPlayNote=w,U.onStopNote=E;let{socketPlayer:z}=e;z.onPlayNote=(g,C,X)=>{r[g]&&n(3,r[g].pressedColor=String(X.colorHue),r),X.playAudio(g,C)},z.onStopNote=(g,C,X)=>{r[g]&&n(3,r[g].pressedColor=null,r),C||X.stopAudio(g)};function x(g){const C=lt(g)+u+a*12;return qe(C)}function w(g,C=.5,X=!0){const Z=x(g);if(f.has(Z))if(X)E(g);else return;f.set(Z,!0),z.playNote(Z,o*C),this!==U&&U.recordPlayNote(g,C)}function E(g){const C=x(g);f.has(C)&&(f.delete(C),z.stopNote(C,s),this!==U&&U.recordStopNote(g))}v.subscribe(g=>{if(!g)for(const C of z.localClient.audioNodeMap.keys())f.get(C)||z.stopNote(C,!1)});function S(){for(const g of f.keys())z.stopNote(g,s)}M.subscribe(S),_.subscribe(S);function $(g){if(l){const C=l.clientHeight/6,X=l.offsetWidth/g;l.style.setProperty("--white-key-width",`${Math.min(X,C)}px`)}}function H(g){const C=zt[g.code],X=g.target;C&&X.tagName!=="INPUT"&&(g.preventDefault(),w(C,void 0,!1))}function se(g){const C=zt[g.code];C&&E(C)}function F(g,C,X,Z){if(C=="notes")return ct(g);if(C=="keybinds"){const W=lt(g)-X-Z*12;return Lr[qe(W)]??""}else return""}function ne(g){const[C,X,Z]=g.data;C>=144&&C<=159?Z==0?E(qe(X)):w(qe(X),Z/127):C>=128&&C<=143&&E(qe(X))}function j(g){g.inputs.forEach(C=>{C.onmidimessage=ne})}pn(()=>{$(i),navigator.requestMIDIAccess().then(g=>{j(g),g.onstatechange=()=>{j(g)}})});function K(g){qn.call(this,t,g)}const fe=()=>$(i),re=g=>{var C;g.button===0&&((C=g.target)==null?void 0:C.tagName)!=="SELECT"&&n(1,h=!0)},ce=()=>n(1,h=!1),me=(g,C)=>{C.currentTarget.releasePointerCapture(C.pointerId),w(g)},O=g=>{h&&w(g)},ue=g=>{h&&E(g)},we=g=>E(g);function he(g){It[g?"unshift":"push"](()=>{l=g,n(2,l)})}return t.$$set=g=>{"pianoControlsData"in g&&n(21,d=g.pianoControlsData),"midiPlayer"in g&&n(19,U=g.midiPlayer),"socketPlayer"in g&&n(20,z=g.socketPlayer)},t.$$.update=()=>{t.$$.dirty[0]&4194304&&n(3,[r,i]=zr(c),r,(n(0,i),n(22,c))),t.$$.dirty[0]&1&&$(i)},[i,h,l,r,a,u,p,m,v,_,M,L,T,w,E,$,H,se,F,U,z,d,c,K,fe,re,ce,me,O,ue,we,he]}class Qi extends Ke{constructor(e){super(),He(this,e,Zi,$i,Pe,{pianoControlsData:21,midiPlayer:19,socketPlayer:20},null,[-1,-1])}}function Xt(t,e,n){const r=t.slice();return r[35]=e[n],r[37]=n,r}function ji(t){let e,n,r,i,s;return{c(){e=b("button"),n=oe("Play"),e.disabled=r=t[3].length==0},m(o,a){D(o,e,a),y(e,n),i||(s=P(e,"click",t[21]),i=!0)},p(o,a){a[0]&8&&r!==(r=o[3].length==0)&&(e.disabled=r)},d(o){o&&B(e),i=!1,s()}}}function eo(t){let e,n,r;return{c(){e=b("button"),e.textContent="Stop"},m(i,s){D(i,e,s),n||(r=P(e,"click",t[20]),n=!0)},p:G,d(i){i&&B(e),n=!1,r()}}}function Yt(t){let e,n,r,i,s;return{c(){e=b("select"),n=b("option"),n.textContent="all tracks",r=b("option"),r.textContent="single track",n.__value=!1,q(n,n.__value),r.__value=!0,q(r,r.__value),t[5]===void 0&&xe(()=>t[23].call(e))},m(o,a){D(o,e,a),y(e,n),y(e,r),ye(e,t[5],!0),i||(s=P(e,"change",t[23]),i=!0)},p(o,a){a[0]&32&&ye(e,o[5])},d(o){o&&B(e),i=!1,s()}}}function $t(t){let e,n,r,i,s,o,a,u,c,p=be(t[3]),h=[];for(let l=0;l<p.length;l+=1)h[l]=Zt(Xt(t,p,l));return{c(){e=b("select");for(let l=0;l<h.length;l+=1)h[l].c();n=N(),r=b("button"),i=oe("Add Track"),s=N(),o=b("button"),a=oe("Delete Track"),e.disabled=t[1],t[6]===void 0&&xe(()=>t[26].call(e)),r.disabled=t[1],o.disabled=t[1]},m(l,f){D(l,e,f);for(let d=0;d<h.length;d+=1)h[d]&&h[d].m(e,null);ye(e,t[6],!0),D(l,n,f),D(l,r,f),y(r,i),D(l,s,f),D(l,o,f),y(o,a),u||(c=[P(e,"change",t[26]),P(r,"click",t[27]),P(o,"click",t[28])],u=!0)},p(l,f){if(f[0]&8){p=be(l[3]);let d;for(d=0;d<p.length;d+=1){const m=Xt(l,p,d);h[d]?h[d].p(m,f):(h[d]=Zt(m),h[d].c(),h[d].m(e,null))}for(;d<h.length;d+=1)h[d].d(1);h.length=p.length}f[0]&2&&(e.disabled=l[1]),f[0]&64&&ye(e,l[6]),f[0]&2&&(r.disabled=l[1]),f[0]&2&&(o.disabled=l[1])},d(l){l&&(B(e),B(n),B(r),B(s),B(o)),Ye(h,l),u=!1,pe(c)}}}function Zt(t){let e,n=(t[35].name||`[Track ${t[37]}]`)+"",r;return{c(){e=b("option"),r=oe(n),e.__value=t[37],q(e,e.__value)},m(i,s){D(i,e,s),y(e,r)},p(i,s){s[0]&8&&n!==(n=(i[35].name||`[Track ${i[37]}]`)+"")&&$e(r,n)},d(i){i&&B(e)}}}function to(t){let e,n,r,i,s,o,a,u,c,p,h,l,f,d,m,v,_,M,L,T,U,z,x,w,E,S,$,H,se,F,ne,j,K,fe,re,ce=t[4].toFixed(1)+"",me,O,ue=t[8].toFixed(1)+"",we,he,g,C;function X(I,R){return I[2]?eo:ji}let Z=X(t),W=Z(t),Q=t[3].length>0&&Yt(t),V=t[3].length>0&&$t(t);return{c(){e=b("div"),n=b("p"),n.textContent="Play midi:",r=N(),i=b("div"),s=b("input"),o=N(),a=b("div"),W.c(),u=N(),c=b("button"),p=oe("Restart"),l=N(),Q&&Q.c(),f=N(),d=b("div"),m=b("button"),v=oe("Record"),_=N(),M=b("button"),L=oe("Save"),U=N(),V&&V.c(),z=N(),x=b("div"),w=b("span"),w.textContent="Speed",E=N(),S=b("input"),$=N(),H=b("input"),se=N(),F=b("span"),F.textContent="times",ne=N(),j=b("div"),K=b("input"),fe=N(),re=b("span"),me=oe(ce),O=oe("/"),we=oe(ue),he=oe(" seconds"),k(s,"type","file"),k(s,"accept",".midi,.mid"),s.disabled=t[2],k(i,"class","svelte-1owab3p"),c.disabled=h=t[3].length==0,k(a,"class","svelte-1owab3p"),m.disabled=t[2],M.disabled=T=t[3].length==0||t[2],k(d,"class","svelte-1owab3p"),k(w,"class","svelte-1owab3p"),k(S,"type","range"),k(S,"min","0.01"),k(S,"max","4"),k(S,"step","0.01"),k(S,"title","Double click to set speed to normal"),k(H,"type","number"),k(H,"min","0.01"),k(F,"class","svelte-1owab3p"),Ue(x,"display","flex"),k(x,"class","svelte-1owab3p"),k(K,"type","range"),k(K,"min","0"),k(K,"max",t[8]),k(K,"step","0.1"),Ue(K,"width","18rem"),K.disabled=t[1],k(re,"class","svelte-1owab3p"),Ue(j,"display","flex"),k(j,"class","svelte-1owab3p"),k(e,"class","svelte-1owab3p")},m(I,R){D(I,e,R),y(e,n),y(e,r),y(e,i),y(i,s),y(e,o),y(e,a),W.m(a,null),y(a,u),y(a,c),y(c,p),y(a,l),Q&&Q.m(a,null),y(e,f),y(e,d),y(d,m),y(m,v),y(d,_),y(d,M),y(M,L),y(d,U),V&&V.m(d,null),y(e,z),y(e,x),y(x,w),y(x,E),y(x,S),q(S,t[7]),y(x,$),y(x,H),q(H,t[7]),y(x,se),y(x,F),y(e,ne),y(e,j),y(j,K),q(K,t[4]),y(j,fe),y(j,re),y(re,me),y(re,O),y(re,we),y(re,he),g||(C=[P(s,"change",t[19]),P(c,"click",t[22]),P(m,"click",t[24]),P(M,"click",t[25]),P(S,"change",t[29]),P(S,"input",t[29]),P(S,"click",t[30]),P(H,"input",t[31]),P(K,"change",t[32]),P(K,"input",t[32]),P(K,"mousedown",t[33]),P(K,"mouseup",t[34])],g=!0)},p(I,R){R[0]&4&&(s.disabled=I[2]),Z===(Z=X(I))&&W?W.p(I,R):(W.d(1),W=Z(I),W&&(W.c(),W.m(a,u))),R[0]&8&&h!==(h=I[3].length==0)&&(c.disabled=h),I[3].length>0?Q?Q.p(I,R):(Q=Yt(I),Q.c(),Q.m(a,null)):Q&&(Q.d(1),Q=null),R[0]&4&&(m.disabled=I[2]),R[0]&12&&T!==(T=I[3].length==0||I[2])&&(M.disabled=T),I[3].length>0?V?V.p(I,R):(V=$t(I),V.c(),V.m(d,null)):V&&(V.d(1),V=null),R[0]&128&&q(S,I[7]),R[0]&128&&de(H.value)!==I[7]&&q(H,I[7]),R[0]&256&&k(K,"max",I[8]),R[0]&2&&(K.disabled=I[1]),R[0]&16&&q(K,I[4]),R[0]&16&&ce!==(ce=I[4].toFixed(1)+"")&&$e(me,ce),R[0]&256&&ue!==(ue=I[8].toFixed(1)+"")&&$e(we,ue)},i:G,o:G,d(I){I&&B(e),W.d(),Q&&Q.d(),V&&V.d(),g=!1,pe(C)}}}function no(t,e,n){let r,i,s,o,a,u,c,p,h,{midiPlayer:l}=e,{isPlaying:f,isRecording:d,currentTime:m,speed:v,totalTime:_,selectedTrack:M,tracks:L,shouldPlaySolo:T}=l;J(t,f,O=>n(18,s=O)),J(t,d,O=>n(1,i=O)),J(t,m,O=>n(4,a=O)),J(t,v,O=>n(7,p=O)),J(t,_,O=>n(8,h=O)),J(t,M,O=>n(6,c=O)),J(t,L,O=>n(3,o=O)),J(t,T,O=>n(5,u=O));function U(){l.startRecording(),localStorage.getItem("hasRecordedBefore")||(alert("Play any key to start recording. Recording WILL override the selected track."),localStorage.setItem("hasRecordedBefore","true"))}const z=O=>{var ue;return l.setFile((ue=O.currentTarget.files)==null?void 0:ue[0])},x=()=>l.stopAndReseek(),w=()=>l.startPlaying(),E=()=>{ae(m,a=0,a),l.stop(),l.lastStartFunc()};function S(){u=Je(this),T.set(u)}const $=()=>U(),H=()=>l.saveFile();function se(){c=Je(this),M.set(c)}const F=()=>l.addTrack(),ne=()=>l.deleteTrack();function j(){p=de(this.value),v.set(p)}const K=O=>{O.detail==2&&ae(v,p=1,p)};function fe(){p=de(this.value),v.set(p)}function re(){a=de(this.value),m.set(a)}const ce=()=>l.stop(),me=()=>l.lastStartFunc();return t.$$set=O=>{"midiPlayer"in O&&n(0,l=O.midiPlayer)},t.$$.update=()=>{t.$$.dirty[0]&262146&&n(2,r=s||i)},[l,i,r,o,a,u,c,p,h,f,d,m,v,_,M,L,T,U,s,z,x,w,E,S,$,H,se,F,ne,j,K,fe,re,ce,me]}class ro extends Ke{constructor(e){super(),He(this,e,no,to,Pe,{midiPlayer:0},null,[-1,-1])}}const io=["accordion","acoustic_bass","acoustic_grand_piano","acoustic_guitar_nylon","acoustic_guitar_steel","agogo","alto_sax","applause","bagpipe","banjo","baritone_sax","bassoon","bird_tweet","blown_bottle","brass_section","breath_noise","bright_acoustic_piano","celesta","cello","choir_aahs","church_organ","clarinet","clavinet","contrabass","distortion_guitar","drawbar_organ","dulcimer","electric_bass_finger","electric_bass_pick","electric_grand_piano","electric_guitar_clean","electric_guitar_jazz","electric_guitar_muted","electric_piano_1","electric_piano_2","english_horn","fiddle","flute","french_horn","fretless_bass","fx_1_rain","fx_2_soundtrack","fx_3_crystal","fx_4_atmosphere","fx_5_brightness","fx_6_goblins","fx_7_echoes","fx_8_scifi","glockenspiel","guitar_fret_noise","guitar_harmonics","gunshot","harmonica","harpsichord","helicopter","honkytonk_piano","kalimba","koto","lead_1_square","lead_2_sawtooth","lead_3_calliope","lead_4_chiff","lead_5_charang","lead_6_voice","lead_7_fifths","lead_8_bass__lead","marimba","melodic_tom","music_box","muted_trumpet","oboe","ocarina","orchestra_hit","orchestral_harp","overdriven_guitar","pad_1_new_age","pad_2_warm","pad_3_polysynth","pad_4_choir","pad_5_bowed","pad_6_metallic","pad_7_halo","pad_8_sweep","pan_flute","percussive_organ","piccolo","pizzicato_strings","recorder","reed_organ","reverse_cymbal","rock_organ","seashore","shakuhachi","shamisen","shanai","sitar","slap_bass_1","slap_bass_2","soprano_sax","steel_drums","string_ensemble_1","string_ensemble_2","synth_bass_1","synth_bass_2","synth_brass_1","synth_brass_2","synth_choir","synth_drum","synth_strings_1","synth_strings_2","taiko_drum","tango_accordion","telephone_ring","tenor_sax","timpani","tinkle_bell","tremolo_strings","trombone","trumpet","tuba","tubular_bells","vibraphone","viola","violin","voice_oohs","whistle","woodblock","xylophone"],Nn="data:image/svg+xml,%3c!--%20Taken%20from%20https://github.com/n3r4zzurr0/svg-spinners%20--%3e%3csvg%20width='24'%20height='24'%20stroke='%23fff'%20viewBox='0%200%2024%2024'%20xmlns='http://www.w3.org/2000/svg'%3e%3cstyle%3e.spinner_V8m1{transform-origin:center;animation:spinner_zKoa%202s%20linear%20infinite}.spinner_V8m1%20circle{stroke-linecap:round;animation:spinner_YpZS%201.5s%20ease-in-out%20infinite}@keyframes%20spinner_zKoa{100%25{transform:rotate(360deg)}}@keyframes%20spinner_YpZS{0%25{stroke-dasharray:0%20150;stroke-dashoffset:0}47.5%25{stroke-dasharray:42%20150;stroke-dashoffset:-16}95%25,100%25{stroke-dasharray:42%20150;stroke-dashoffset:-59}}%3c/style%3e%3cg%20class='spinner_V8m1'%3e%3ccircle%20cx='12'%20cy='12'%20r='9.5'%20fill='none'%20stroke-width='3'%3e%3c/circle%3e%3c/g%3e%3c/svg%3e";function Qt(t,e,n){const r=t.slice();return r[27]=e[n],r}function oo(t,e,n){const r=t.slice();return r[30]=e[n],r}function so(t){let e;return{c(){e=b("option"),e.textContent=`${An(t[30])}`,e.__value=t[30],q(e,e.__value)},m(n,r){D(n,e,r)},p:G,d(n){n&&B(e)}}}function ao(t){return{c:G,m:G,d:G}}function co(t){return{c:G,m:G,d:G}}function lo(t){let e,n;return{c(){e=b("img"),un(e.src,n=Nn)||k(e,"src",n),k(e,"alt","spinner")},m(r,i){D(r,e,i)},d(r){r&&B(e)}}}function jt(t){let e,n=An(t[27])+"",r;return{c(){e=b("option"),r=oe(n),e.__value=t[27],q(e,e.__value)},m(i,s){D(i,e,s),y(e,r)},p:G,d(i){i&&B(e)}}}function uo(t){let e,n,r,i,s,o,a,u,c,p,h,l,f,d,m,v,_,M,L,T,U,z,x,w,E,S,$,H,se,F,ne,j,K,fe,re,ce,me,O,ue,we,he,g,C,X=be(io),Z=[];for(let I=0;I<X.length;I+=1)Z[I]=so(oo(t,X,I));let W={ctx:t,current:null,token:null,hasCatch:!1,pending:lo,then:co,catch:ao};Rt(S=t[1],W);let Q=be(en),V=[];for(let I=0;I<Q.length;I+=1)V[I]=jt(Qt(t,Q,I));return{c(){e=b("div"),n=b("div"),r=b("span"),r.textContent="Sustain",i=N(),s=b("input"),o=N(),a=b("div"),u=b("span"),u.textContent="Tranpose",c=N(),p=b("input"),h=N(),l=b("input"),f=N(),d=b("div"),m=b("span"),m.textContent="Volume",v=N(),_=b("input"),M=N(),L=b("input"),T=N(),U=b("div"),z=b("span"),z.textContent="Instrument",x=N(),w=b("select");for(let I=0;I<Z.length;I+=1)Z[I].c();E=N(),W.block.c(),$=N(),H=b("div"),se=b("span"),se.textContent="Size",F=N(),ne=b("select"),j=b("option"),j.textContent="Full size (88 keys)",K=b("option"),K.textContent="Half size (61 keys)",fe=b("option"),fe.textContent="Quater Size (37 keys)",re=b("option"),re.textContent="2 Octaves (24 keys)",ce=b("option"),ce.textContent="1 Octave (12 keys)",me=N(),O=b("div"),ue=b("span"),ue.textContent="Labels",we=N(),he=b("select");for(let I=0;I<V.length;I+=1)V[I].c();k(r,"class","svelte-1ue5508"),k(s,"type","checkbox"),k(n,"title","Shortcut: space"),k(n,"class","svelte-1ue5508"),k(u,"title","Double click to reset"),k(u,"class","svelte-1ue5508"),k(p,"title","Note shift (shortcut: left ctrl + left alt)"),k(p,"type","number"),k(l,"title","Octave shift (shortcut: right alt + right ctrl)"),k(l,"type","number"),k(a,"class","svelte-1ue5508"),k(m,"class","svelte-1ue5508"),k(_,"type","range"),k(_,"min","0"),k(_,"max","10"),k(_,"step","0.1"),Ue(_,"width","8rem"),k(L,"type","number"),k(d,"class","svelte-1ue5508"),k(z,"class","svelte-1ue5508"),t[0]===void 0&&xe(()=>t[24].call(w)),k(U,"class","svelte-1ue5508"),k(se,"class","svelte-1ue5508"),j.__value="A0,C8",q(j,j.__value),K.__value="C2,C7",q(K,K.__value),fe.__value="C3,C6",q(fe,fe.__value),re.__value="C4,B5",q(re,re.__value),ce.__value="C4,B4",q(ce,ce.__value),t[6]===void 0&&xe(()=>t[25].call(ne)),k(H,"class","svelte-1ue5508"),k(ue,"class","svelte-1ue5508"),t[7]===void 0&&xe(()=>t[26].call(he)),k(O,"class","svelte-1ue5508"),k(e,"class","option-list svelte-1ue5508")},m(I,R){D(I,e,R),y(e,n),y(n,r),y(n,i),y(n,s),s.checked=t[2],y(e,o),y(e,a),y(a,u),y(a,c),y(a,p),q(p,t[4]),y(a,h),y(a,l),q(l,t[3]),y(e,f),y(e,d),y(d,m),y(d,v),y(d,_),q(_,t[5]),y(d,M),y(d,L),q(L,t[5]),y(e,T),y(e,U),y(U,z),y(U,x),y(U,w);for(let Y=0;Y<Z.length;Y+=1)Z[Y]&&Z[Y].m(w,null);ye(w,t[0],!0),y(U,E),W.block.m(U,W.anchor=null),W.mount=()=>U,W.anchor=null,y(e,$),y(e,H),y(H,se),y(H,F),y(H,ne),y(ne,j),y(ne,K),y(ne,fe),y(ne,re),y(ne,ce),ye(ne,t[6],!0),y(e,me),y(e,O),y(O,ue),y(O,we),y(O,he);for(let Y=0;Y<V.length;Y+=1)V[Y]&&V[Y].m(he,null);ye(he,t[7],!0),g||(C=[P(window,"keydown",t[14]),P(window,"keyup",t[15]),P(s,"change",t[18]),P(u,"click",t[19]),P(p,"input",t[20]),P(l,"input",t[21]),P(_,"change",t[22]),P(_,"input",t[22]),P(L,"input",t[23]),P(w,"change",t[24]),P(ne,"change",t[25]),P(he,"change",t[26])],g=!0)},p(I,R){if(t=I,R[0]&4&&(s.checked=t[2]),R[0]&16&&de(p.value)!==t[4]&&q(p,t[4]),R[0]&8&&de(l.value)!==t[3]&&q(l,t[3]),R[0]&32&&q(_,t[5]),R[0]&32&&de(L.value)!==t[5]&&q(L,t[5]),R[0]&1&&ye(w,t[0]),W.ctx=t,R[0]&2&&S!==(S=t[1])&&Rt(S,W),R[0]&64&&ye(ne,t[6]),R&0){Q=be(en);let Y;for(Y=0;Y<Q.length;Y+=1){const Ft=Qt(t,Q,Y);V[Y]?V[Y].p(Ft,R):(V[Y]=jt(Ft),V[Y].c(),V[Y].m(he,null))}for(;Y<V.length;Y+=1)V[Y].d(1);V.length=Q.length}R[0]&128&&ye(he,t[7])},i:G,o:G,d(I){I&&B(e),Ye(Z,I),W.block.d(),W.token=null,W=null,Ye(V,I),g=!1,pe(C)}}}const en=["none","notes","keybinds"];class fo{constructor(){A(this,"octaveShift",ie(0));A(this,"noteShift",ie(0));A(this,"sustain",ie(!1));A(this,"volume",ie(5));A(this,"noteRange",ie("C2,C7"));A(this,"labelType",ie("keybinds"))}}function ho(t,e,n){let r,i,s,o,a,u,c,{pianoControlsData:p}=e,{socketPlayer:h}=e,l="acoustic_grand_piano",{noteRange:f,sustain:d,noteShift:m,octaveShift:v,volume:_,labelType:M}=p;J(t,f,F=>n(6,u=F)),J(t,d,F=>n(2,i=F)),J(t,m,F=>n(4,o=F)),J(t,v,F=>n(3,s=F)),J(t,_,F=>n(5,a=F)),J(t,M,F=>n(7,c=F));function L(F){if(F.target.tagName!=="INPUT")switch(F.code){case"Space":ae(d,i=!0,i);break;case"ControlLeft":ae(m,o-=1,o);break;case"AltLeft":ae(m,o+=1,o);break;case"AltRight":ae(v,s-=1,s);break;case"ControlRight":ae(v,s+=1,s);break}}m.subscribe(()=>{o>=12?(ae(v,s+=1,s),ae(m,o=0,o)):o<=-12&&(ae(v,s-=1,s),ae(m,o=0,o))}),v.subscribe(()=>{s<-3?ae(v,s=3,s):s>3&&ae(v,s=-3,s)});function T(F){F.code==="Space"&&ae(d,i=!1,i)}function U(){i=this.checked,d.set(i)}const z=F=>{F.detail==2&&(ae(m,o=0,o),ae(v,s=0,s))};function x(){o=de(this.value),m.set(o)}function w(){s=de(this.value),v.set(s)}function E(){a=de(this.value),_.set(a)}function S(){a=de(this.value),_.set(a)}function $(){l=Je(this),n(0,l)}function H(){u=Je(this),f.set(u)}function se(){c=Je(this),M.set(c)}return t.$$set=F=>{"pianoControlsData"in F&&n(16,p=F.pianoControlsData),"socketPlayer"in F&&n(17,h=F.socketPlayer)},t.$$.update=()=>{t.$$.dirty[0]&131073&&n(1,r=h.changeInstrument(l))},[l,r,i,s,o,a,u,c,f,d,m,v,_,M,L,T,p,h,U,z,x,w,E,S,$,H,se]}class po extends Ke{constructor(e){super(),He(this,e,ho,uo,Pe,{pianoControlsData:16,socketPlayer:17},null,[-1,-1])}}function mo(t){for(var e=t.length,n=0,r=0;r<e;){var i=t.charCodeAt(r++);if(i&4294967168)if(!(i&4294965248))n+=2;else{if(i>=55296&&i<=56319&&r<e){var s=t.charCodeAt(r);(s&64512)===56320&&(++r,i=((i&1023)<<10)+(s&1023)+65536)}i&4294901760?n+=4:n+=3}else{n++;continue}}return n}function vo(t,e,n){for(var r=t.length,i=n,s=0;s<r;){var o=t.charCodeAt(s++);if(o&4294967168)if(!(o&4294965248))e[i++]=o>>6&31|192;else{if(o>=55296&&o<=56319&&s<r){var a=t.charCodeAt(s);(a&64512)===56320&&(++s,o=((o&1023)<<10)+(a&1023)+65536)}o&4294901760?(e[i++]=o>>18&7|240,e[i++]=o>>12&63|128,e[i++]=o>>6&63|128):(e[i++]=o>>12&15|224,e[i++]=o>>6&63|128)}else{e[i++]=o;continue}e[i++]=o&63|128}}var yo=new TextEncoder,go=50;function bo(t,e,n){yo.encodeInto(t,e.subarray(n))}function _o(t,e,n){t.length>go?bo(t,e,n):vo(t,e,n)}var wo=4096;function Fn(t,e,n){for(var r=e,i=r+n,s=[],o="";r<i;){var a=t[r++];if(!(a&128))s.push(a);else if((a&224)===192){var u=t[r++]&63;s.push((a&31)<<6|u)}else if((a&240)===224){var u=t[r++]&63,c=t[r++]&63;s.push((a&31)<<12|u<<6|c)}else if((a&248)===240){var u=t[r++]&63,c=t[r++]&63,p=t[r++]&63,h=(a&7)<<18|u<<12|c<<6|p;h>65535&&(h-=65536,s.push(h>>>10&1023|55296),h=56320|h&1023),s.push(h)}else s.push(a);s.length>=wo&&(o+=String.fromCharCode.apply(String,s),s.length=0)}return s.length>0&&(o+=String.fromCharCode.apply(String,s)),o}var ko=new TextDecoder,xo=200;function To(t,e,n){var r=t.subarray(e,e+n);return ko.decode(r)}function Io(t,e,n){return n>xo?To(t,e,n):Fn(t,e,n)}var it=function(){function t(e,n){this.type=e,this.data=n}return t}(),Uo=function(){var t=function(e,n){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,i){r.__proto__=i}||function(r,i){for(var s in i)Object.prototype.hasOwnProperty.call(i,s)&&(r[s]=i[s])},t(e,n)};return function(e,n){if(typeof n!="function"&&n!==null)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");t(e,n);function r(){this.constructor=e}e.prototype=n===null?Object.create(n):(r.prototype=n.prototype,new r)}}(),ve=function(t){Uo(e,t);function e(n){var r=t.call(this,n)||this,i=Object.create(e.prototype);return Object.setPrototypeOf(r,i),Object.defineProperty(r,"name",{configurable:!0,enumerable:!1,value:e.name}),r}return e}(Error),Ge=4294967295;function So(t,e,n){var r=n/4294967296,i=n;t.setUint32(e,r),t.setUint32(e+4,i)}function Bn(t,e,n){var r=Math.floor(n/4294967296),i=n;t.setUint32(e,r),t.setUint32(e+4,i)}function Dn(t,e){var n=t.getInt32(e),r=t.getUint32(e+4);return n*4294967296+r}function Co(t,e){var n=t.getUint32(e),r=t.getUint32(e+4);return n*4294967296+r}var Po=-1,Eo=4294967296-1,Mo=17179869184-1;function Ao(t){var e=t.sec,n=t.nsec;if(e>=0&&n>=0&&e<=Mo)if(n===0&&e<=Eo){var r=new Uint8Array(4),i=new DataView(r.buffer);return i.setUint32(0,e),r}else{var s=e/4294967296,o=e&4294967295,r=new Uint8Array(8),i=new DataView(r.buffer);return i.setUint32(0,n<<2|s&3),i.setUint32(4,o),r}else{var r=new Uint8Array(12),i=new DataView(r.buffer);return i.setUint32(0,n),Bn(i,4,e),r}}function No(t){var e=t.getTime(),n=Math.floor(e/1e3),r=(e-n*1e3)*1e6,i=Math.floor(r/1e9);return{sec:n+i,nsec:r-i*1e9}}function Fo(t){if(t instanceof Date){var e=No(t);return Ao(e)}else return null}function Bo(t){var e=new DataView(t.buffer,t.byteOffset,t.byteLength);switch(t.byteLength){case 4:{var n=e.getUint32(0),r=0;return{sec:n,nsec:r}}case 8:{var i=e.getUint32(0),s=e.getUint32(4),n=(i&3)*4294967296+s,r=i>>>2;return{sec:n,nsec:r}}case 12:{var n=Dn(e,4),r=e.getUint32(0);return{sec:n,nsec:r}}default:throw new ve("Unrecognized data size for timestamp (expected 4, 8, or 12): ".concat(t.length))}}function Do(t){var e=Bo(t);return new Date(e.sec*1e3+e.nsec/1e6)}var Oo={type:Po,encode:Fo,decode:Do},On=function(){function t(){this.builtInEncoders=[],this.builtInDecoders=[],this.encoders=[],this.decoders=[],this.register(Oo)}return t.prototype.register=function(e){var n=e.type,r=e.encode,i=e.decode;if(n>=0)this.encoders[n]=r,this.decoders[n]=i;else{var s=1+n;this.builtInEncoders[s]=r,this.builtInDecoders[s]=i}},t.prototype.tryToEncode=function(e,n){for(var r=0;r<this.builtInEncoders.length;r++){var i=this.builtInEncoders[r];if(i!=null){var s=i(e,n);if(s!=null){var o=-1-r;return new it(o,s)}}}for(var r=0;r<this.encoders.length;r++){var i=this.encoders[r];if(i!=null){var s=i(e,n);if(s!=null){var o=r;return new it(o,s)}}}return e instanceof it?e:null},t.prototype.decode=function(e,n,r){var i=n<0?this.builtInDecoders[-1-n]:this.decoders[n];return i?i(e,n,r):new it(n,e)},t.defaultCodec=new t,t}();function ut(t){return t instanceof Uint8Array?t:ArrayBuffer.isView(t)?new Uint8Array(t.buffer,t.byteOffset,t.byteLength):t instanceof ArrayBuffer?new Uint8Array(t):Uint8Array.from(t)}function Ro(t){if(t instanceof ArrayBuffer)return new DataView(t);var e=ut(t);return new DataView(e.buffer,e.byteOffset,e.byteLength)}var Vo=100,Lo=2048,zo=function(){function t(e){var n,r,i,s,o,a,u,c;this.extensionCodec=(n=e==null?void 0:e.extensionCodec)!==null&&n!==void 0?n:On.defaultCodec,this.context=e==null?void 0:e.context,this.useBigInt64=(r=e==null?void 0:e.useBigInt64)!==null&&r!==void 0?r:!1,this.maxDepth=(i=e==null?void 0:e.maxDepth)!==null&&i!==void 0?i:Vo,this.initialBufferSize=(s=e==null?void 0:e.initialBufferSize)!==null&&s!==void 0?s:Lo,this.sortKeys=(o=e==null?void 0:e.sortKeys)!==null&&o!==void 0?o:!1,this.forceFloat32=(a=e==null?void 0:e.forceFloat32)!==null&&a!==void 0?a:!1,this.ignoreUndefined=(u=e==null?void 0:e.ignoreUndefined)!==null&&u!==void 0?u:!1,this.forceIntegerToFloat=(c=e==null?void 0:e.forceIntegerToFloat)!==null&&c!==void 0?c:!1,this.pos=0,this.view=new DataView(new ArrayBuffer(this.initialBufferSize)),this.bytes=new Uint8Array(this.view.buffer)}return t.prototype.reinitializeState=function(){this.pos=0},t.prototype.encodeSharedRef=function(e){return this.reinitializeState(),this.doEncode(e,1),this.bytes.subarray(0,this.pos)},t.prototype.encode=function(e){return this.reinitializeState(),this.doEncode(e,1),this.bytes.slice(0,this.pos)},t.prototype.doEncode=function(e,n){if(n>this.maxDepth)throw new Error("Too deep objects in depth ".concat(n));e==null?this.encodeNil():typeof e=="boolean"?this.encodeBoolean(e):typeof e=="number"?this.forceIntegerToFloat?this.encodeNumberAsFloat(e):this.encodeNumber(e):typeof e=="string"?this.encodeString(e):this.useBigInt64&&typeof e=="bigint"?this.encodeBigInt64(e):this.encodeObject(e,n)},t.prototype.ensureBufferSizeToWrite=function(e){var n=this.pos+e;this.view.byteLength<n&&this.resizeBuffer(n*2)},t.prototype.resizeBuffer=function(e){var n=new ArrayBuffer(e),r=new Uint8Array(n),i=new DataView(n);r.set(this.bytes),this.view=i,this.bytes=r},t.prototype.encodeNil=function(){this.writeU8(192)},t.prototype.encodeBoolean=function(e){e===!1?this.writeU8(194):this.writeU8(195)},t.prototype.encodeNumber=function(e){!this.forceIntegerToFloat&&Number.isSafeInteger(e)?e>=0?e<128?this.writeU8(e):e<256?(this.writeU8(204),this.writeU8(e)):e<65536?(this.writeU8(205),this.writeU16(e)):e<4294967296?(this.writeU8(206),this.writeU32(e)):this.useBigInt64?this.encodeNumberAsFloat(e):(this.writeU8(207),this.writeU64(e)):e>=-32?this.writeU8(224|e+32):e>=-128?(this.writeU8(208),this.writeI8(e)):e>=-32768?(this.writeU8(209),this.writeI16(e)):e>=-2147483648?(this.writeU8(210),this.writeI32(e)):this.useBigInt64?this.encodeNumberAsFloat(e):(this.writeU8(211),this.writeI64(e)):this.encodeNumberAsFloat(e)},t.prototype.encodeNumberAsFloat=function(e){this.forceFloat32?(this.writeU8(202),this.writeF32(e)):(this.writeU8(203),this.writeF64(e))},t.prototype.encodeBigInt64=function(e){e>=BigInt(0)?(this.writeU8(207),this.writeBigUint64(e)):(this.writeU8(211),this.writeBigInt64(e))},t.prototype.writeStringHeader=function(e){if(e<32)this.writeU8(160+e);else if(e<256)this.writeU8(217),this.writeU8(e);else if(e<65536)this.writeU8(218),this.writeU16(e);else if(e<4294967296)this.writeU8(219),this.writeU32(e);else throw new Error("Too long string: ".concat(e," bytes in UTF-8"))},t.prototype.encodeString=function(e){var n=5,r=mo(e);this.ensureBufferSizeToWrite(n+r),this.writeStringHeader(r),_o(e,this.bytes,this.pos),this.pos+=r},t.prototype.encodeObject=function(e,n){var r=this.extensionCodec.tryToEncode(e,this.context);if(r!=null)this.encodeExtension(r);else if(Array.isArray(e))this.encodeArray(e,n);else if(ArrayBuffer.isView(e))this.encodeBinary(e);else if(typeof e=="object")this.encodeMap(e,n);else throw new Error("Unrecognized object: ".concat(Object.prototype.toString.apply(e)))},t.prototype.encodeBinary=function(e){var n=e.byteLength;if(n<256)this.writeU8(196),this.writeU8(n);else if(n<65536)this.writeU8(197),this.writeU16(n);else if(n<4294967296)this.writeU8(198),this.writeU32(n);else throw new Error("Too large binary: ".concat(n));var r=ut(e);this.writeU8a(r)},t.prototype.encodeArray=function(e,n){var r=e.length;if(r<16)this.writeU8(144+r);else if(r<65536)this.writeU8(220),this.writeU16(r);else if(r<4294967296)this.writeU8(221),this.writeU32(r);else throw new Error("Too large array: ".concat(r));for(var i=0,s=e;i<s.length;i++){var o=s[i];this.doEncode(o,n+1)}},t.prototype.countWithoutUndefined=function(e,n){for(var r=0,i=0,s=n;i<s.length;i++){var o=s[i];e[o]!==void 0&&r++}return r},t.prototype.encodeMap=function(e,n){var r=Object.keys(e);this.sortKeys&&r.sort();var i=this.ignoreUndefined?this.countWithoutUndefined(e,r):r.length;if(i<16)this.writeU8(128+i);else if(i<65536)this.writeU8(222),this.writeU16(i);else if(i<4294967296)this.writeU8(223),this.writeU32(i);else throw new Error("Too large map object: ".concat(i));for(var s=0,o=r;s<o.length;s++){var a=o[s],u=e[a];this.ignoreUndefined&&u===void 0||(this.encodeString(a),this.doEncode(u,n+1))}},t.prototype.encodeExtension=function(e){var n=e.data.length;if(n===1)this.writeU8(212);else if(n===2)this.writeU8(213);else if(n===4)this.writeU8(214);else if(n===8)this.writeU8(215);else if(n===16)this.writeU8(216);else if(n<256)this.writeU8(199),this.writeU8(n);else if(n<65536)this.writeU8(200),this.writeU16(n);else if(n<4294967296)this.writeU8(201),this.writeU32(n);else throw new Error("Too large extension object: ".concat(n));this.writeI8(e.type),this.writeU8a(e.data)},t.prototype.writeU8=function(e){this.ensureBufferSizeToWrite(1),this.view.setUint8(this.pos,e),this.pos++},t.prototype.writeU8a=function(e){var n=e.length;this.ensureBufferSizeToWrite(n),this.bytes.set(e,this.pos),this.pos+=n},t.prototype.writeI8=function(e){this.ensureBufferSizeToWrite(1),this.view.setInt8(this.pos,e),this.pos++},t.prototype.writeU16=function(e){this.ensureBufferSizeToWrite(2),this.view.setUint16(this.pos,e),this.pos+=2},t.prototype.writeI16=function(e){this.ensureBufferSizeToWrite(2),this.view.setInt16(this.pos,e),this.pos+=2},t.prototype.writeU32=function(e){this.ensureBufferSizeToWrite(4),this.view.setUint32(this.pos,e),this.pos+=4},t.prototype.writeI32=function(e){this.ensureBufferSizeToWrite(4),this.view.setInt32(this.pos,e),this.pos+=4},t.prototype.writeF32=function(e){this.ensureBufferSizeToWrite(4),this.view.setFloat32(this.pos,e),this.pos+=4},t.prototype.writeF64=function(e){this.ensureBufferSizeToWrite(8),this.view.setFloat64(this.pos,e),this.pos+=8},t.prototype.writeU64=function(e){this.ensureBufferSizeToWrite(8),So(this.view,this.pos,e),this.pos+=8},t.prototype.writeI64=function(e){this.ensureBufferSizeToWrite(8),Bn(this.view,this.pos,e),this.pos+=8},t.prototype.writeBigUint64=function(e){this.ensureBufferSizeToWrite(8),this.view.setBigUint64(this.pos,e),this.pos+=8},t.prototype.writeBigInt64=function(e){this.ensureBufferSizeToWrite(8),this.view.setBigInt64(this.pos,e),this.pos+=8},t}();function Ho(t,e){var n=new zo(e);return n.encodeSharedRef(t)}function kt(t){return"".concat(t<0?"-":"","0x").concat(Math.abs(t).toString(16).padStart(2,"0"))}var Ko=16,qo=16,Go=function(){function t(e,n){e===void 0&&(e=Ko),n===void 0&&(n=qo),this.maxKeyLength=e,this.maxLengthPerKey=n,this.hit=0,this.miss=0,this.caches=[];for(var r=0;r<this.maxKeyLength;r++)this.caches.push([])}return t.prototype.canBeCached=function(e){return e>0&&e<=this.maxKeyLength},t.prototype.find=function(e,n,r){var i=this.caches[r-1];e:for(var s=0,o=i;s<o.length;s++){for(var a=o[s],u=a.bytes,c=0;c<r;c++)if(u[c]!==e[n+c])continue e;return a.str}return null},t.prototype.store=function(e,n){var r=this.caches[e.length-1],i={bytes:e,str:n};r.length>=this.maxLengthPerKey?r[Math.random()*r.length|0]=i:r.push(i)},t.prototype.decode=function(e,n,r){var i=this.find(e,n,r);if(i!=null)return this.hit++,i;this.miss++;var s=Fn(e,n,r),o=Uint8Array.prototype.slice.call(e,n,n+r);return this.store(o,s),s},t}(),Wo=function(t,e,n,r){function i(s){return s instanceof n?s:new n(function(o){o(s)})}return new(n||(n=Promise))(function(s,o){function a(p){try{c(r.next(p))}catch(h){o(h)}}function u(p){try{c(r.throw(p))}catch(h){o(h)}}function c(p){p.done?s(p.value):i(p.value).then(a,u)}c((r=r.apply(t,e||[])).next())})},xt=function(t,e){var n={label:0,sent:function(){if(s[0]&1)throw s[1];return s[1]},trys:[],ops:[]},r,i,s,o;return o={next:a(0),throw:a(1),return:a(2)},typeof Symbol=="function"&&(o[Symbol.iterator]=function(){return this}),o;function a(c){return function(p){return u([c,p])}}function u(c){if(r)throw new TypeError("Generator is already executing.");for(;o&&(o=0,c[0]&&(n=0)),n;)try{if(r=1,i&&(s=c[0]&2?i.return:c[0]?i.throw||((s=i.return)&&s.call(i),0):i.next)&&!(s=s.call(i,c[1])).done)return s;switch(i=0,s&&(c=[c[0]&2,s.value]),c[0]){case 0:case 1:s=c;break;case 4:return n.label++,{value:c[1],done:!1};case 5:n.label++,i=c[1],c=[0];continue;case 7:c=n.ops.pop(),n.trys.pop();continue;default:if(s=n.trys,!(s=s.length>0&&s[s.length-1])&&(c[0]===6||c[0]===2)){n=0;continue}if(c[0]===3&&(!s||c[1]>s[0]&&c[1]<s[3])){n.label=c[1];break}if(c[0]===6&&n.label<s[1]){n.label=s[1],s=c;break}if(s&&n.label<s[2]){n.label=s[2],n.ops.push(c);break}s[2]&&n.ops.pop(),n.trys.pop();continue}c=e.call(t,n)}catch(p){c=[6,p],i=0}finally{r=s=0}if(c[0]&5)throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}},tn=function(t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var e=t[Symbol.asyncIterator],n;return e?e.call(t):(t=typeof __values=="function"?__values(t):t[Symbol.iterator](),n={},r("next"),r("throw"),r("return"),n[Symbol.asyncIterator]=function(){return this},n);function r(s){n[s]=t[s]&&function(o){return new Promise(function(a,u){o=t[s](o),i(a,u,o.done,o.value)})}}function i(s,o,a,u){Promise.resolve(u).then(function(c){s({value:c,done:a})},o)}},ze=function(t){return this instanceof ze?(this.v=t,this):new ze(t)},Jo=function(t,e,n){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var r=n.apply(t,e||[]),i,s=[];return i={},o("next"),o("throw"),o("return"),i[Symbol.asyncIterator]=function(){return this},i;function o(l){r[l]&&(i[l]=function(f){return new Promise(function(d,m){s.push([l,f,d,m])>1||a(l,f)})})}function a(l,f){try{u(r[l](f))}catch(d){h(s[0][3],d)}}function u(l){l.value instanceof ze?Promise.resolve(l.value.v).then(c,p):h(s[0][2],l)}function c(l){a("next",l)}function p(l){a("throw",l)}function h(l,f){l(f),s.shift(),s.length&&a(s[0][0],s[0][1])}},nn="array",ot="map_key",Xo="map_value",Yo=function(t){return typeof t=="string"||typeof t=="number"},We=-1,Nt=new DataView(new ArrayBuffer(0)),$o=new Uint8Array(Nt.buffer);try{Nt.getInt8(0)}catch(t){if(!(t instanceof RangeError))throw new Error("This module is not supported in the current JavaScript engine because DataView does not throw RangeError on out-of-bounds access")}var Pt=RangeError,rn=new Pt("Insufficient data"),Zo=new Go,Qo=function(){function t(e){var n,r,i,s,o,a,u;this.totalPos=0,this.pos=0,this.view=Nt,this.bytes=$o,this.headByte=We,this.stack=[],this.extensionCodec=(n=e==null?void 0:e.extensionCodec)!==null&&n!==void 0?n:On.defaultCodec,this.context=e==null?void 0:e.context,this.useBigInt64=(r=e==null?void 0:e.useBigInt64)!==null&&r!==void 0?r:!1,this.maxStrLength=(i=e==null?void 0:e.maxStrLength)!==null&&i!==void 0?i:Ge,this.maxBinLength=(s=e==null?void 0:e.maxBinLength)!==null&&s!==void 0?s:Ge,this.maxArrayLength=(o=e==null?void 0:e.maxArrayLength)!==null&&o!==void 0?o:Ge,this.maxMapLength=(a=e==null?void 0:e.maxMapLength)!==null&&a!==void 0?a:Ge,this.maxExtLength=(u=e==null?void 0:e.maxExtLength)!==null&&u!==void 0?u:Ge,this.keyDecoder=(e==null?void 0:e.keyDecoder)!==void 0?e.keyDecoder:Zo}return t.prototype.reinitializeState=function(){this.totalPos=0,this.headByte=We,this.stack.length=0},t.prototype.setBuffer=function(e){this.bytes=ut(e),this.view=Ro(this.bytes),this.pos=0},t.prototype.appendBuffer=function(e){if(this.headByte===We&&!this.hasRemaining(1))this.setBuffer(e);else{var n=this.bytes.subarray(this.pos),r=ut(e),i=new Uint8Array(n.length+r.length);i.set(n),i.set(r,n.length),this.setBuffer(i)}},t.prototype.hasRemaining=function(e){return this.view.byteLength-this.pos>=e},t.prototype.createExtraByteError=function(e){var n=this,r=n.view,i=n.pos;return new RangeError("Extra ".concat(r.byteLength-i," of ").concat(r.byteLength," byte(s) found at buffer[").concat(e,"]"))},t.prototype.decode=function(e){this.reinitializeState(),this.setBuffer(e);var n=this.doDecodeSync();if(this.hasRemaining(1))throw this.createExtraByteError(this.pos);return n},t.prototype.decodeMulti=function(e){return xt(this,function(n){switch(n.label){case 0:this.reinitializeState(),this.setBuffer(e),n.label=1;case 1:return this.hasRemaining(1)?[4,this.doDecodeSync()]:[3,3];case 2:return n.sent(),[3,1];case 3:return[2]}})},t.prototype.decodeAsync=function(e){var n,r,i,s,o,a,u;return Wo(this,void 0,void 0,function(){var c,p,h,l,f,d,m,v;return xt(this,function(_){switch(_.label){case 0:c=!1,_.label=1;case 1:_.trys.push([1,6,7,12]),n=!0,r=tn(e),_.label=2;case 2:return[4,r.next()];case 3:if(i=_.sent(),s=i.done,!!s)return[3,5];u=i.value,n=!1;try{if(h=u,c)throw this.createExtraByteError(this.totalPos);this.appendBuffer(h);try{p=this.doDecodeSync(),c=!0}catch(M){if(!(M instanceof Pt))throw M}this.totalPos+=this.pos}finally{n=!0}_.label=4;case 4:return[3,2];case 5:return[3,12];case 6:return l=_.sent(),o={error:l},[3,12];case 7:return _.trys.push([7,,10,11]),!n&&!s&&(a=r.return)?[4,a.call(r)]:[3,9];case 8:_.sent(),_.label=9;case 9:return[3,11];case 10:if(o)throw o.error;return[7];case 11:return[7];case 12:if(c){if(this.hasRemaining(1))throw this.createExtraByteError(this.totalPos);return[2,p]}throw f=this,d=f.headByte,m=f.pos,v=f.totalPos,new RangeError("Insufficient data in parsing ".concat(kt(d)," at ").concat(v," (").concat(m," in the current buffer)"))}})})},t.prototype.decodeArrayStream=function(e){return this.decodeMultiAsync(e,!0)},t.prototype.decodeStream=function(e){return this.decodeMultiAsync(e,!1)},t.prototype.decodeMultiAsync=function(e,n){return Jo(this,arguments,function(){var i,s,o,a,u,c,p,h,l,f,d,m;return xt(this,function(v){switch(v.label){case 0:i=n,s=-1,v.label=1;case 1:v.trys.push([1,15,16,21]),o=!0,a=tn(e),v.label=2;case 2:return[4,ze(a.next())];case 3:if(u=v.sent(),l=u.done,!!l)return[3,14];m=u.value,o=!1,v.label=4;case 4:if(v.trys.push([4,,12,13]),c=m,n&&s===0)throw this.createExtraByteError(this.totalPos);this.appendBuffer(c),i&&(s=this.readArraySize(),i=!1,this.complete()),v.label=5;case 5:v.trys.push([5,10,,11]),v.label=6;case 6:return[4,ze(this.doDecodeSync())];case 7:return[4,v.sent()];case 8:return v.sent(),--s===0?[3,9]:[3,6];case 9:return[3,11];case 10:if(p=v.sent(),!(p instanceof Pt))throw p;return[3,11];case 11:return this.totalPos+=this.pos,[3,13];case 12:return o=!0,[7];case 13:return[3,2];case 14:return[3,21];case 15:return h=v.sent(),f={error:h},[3,21];case 16:return v.trys.push([16,,19,20]),!o&&!l&&(d=a.return)?[4,ze(d.call(a))]:[3,18];case 17:v.sent(),v.label=18;case 18:return[3,20];case 19:if(f)throw f.error;return[7];case 20:return[7];case 21:return[2]}})})},t.prototype.doDecodeSync=function(){e:for(;;){var e=this.readHeadByte(),n=void 0;if(e>=224)n=e-256;else if(e<192)if(e<128)n=e;else if(e<144){var r=e-128;if(r!==0){this.pushMapState(r),this.complete();continue e}else n={}}else if(e<160){var r=e-144;if(r!==0){this.pushArrayState(r),this.complete();continue e}else n=[]}else{var i=e-160;n=this.decodeUtf8String(i,0)}else if(e===192)n=null;else if(e===194)n=!1;else if(e===195)n=!0;else if(e===202)n=this.readF32();else if(e===203)n=this.readF64();else if(e===204)n=this.readU8();else if(e===205)n=this.readU16();else if(e===206)n=this.readU32();else if(e===207)this.useBigInt64?n=this.readU64AsBigInt():n=this.readU64();else if(e===208)n=this.readI8();else if(e===209)n=this.readI16();else if(e===210)n=this.readI32();else if(e===211)this.useBigInt64?n=this.readI64AsBigInt():n=this.readI64();else if(e===217){var i=this.lookU8();n=this.decodeUtf8String(i,1)}else if(e===218){var i=this.lookU16();n=this.decodeUtf8String(i,2)}else if(e===219){var i=this.lookU32();n=this.decodeUtf8String(i,4)}else if(e===220){var r=this.readU16();if(r!==0){this.pushArrayState(r),this.complete();continue e}else n=[]}else if(e===221){var r=this.readU32();if(r!==0){this.pushArrayState(r),this.complete();continue e}else n=[]}else if(e===222){var r=this.readU16();if(r!==0){this.pushMapState(r),this.complete();continue e}else n={}}else if(e===223){var r=this.readU32();if(r!==0){this.pushMapState(r),this.complete();continue e}else n={}}else if(e===196){var r=this.lookU8();n=this.decodeBinary(r,1)}else if(e===197){var r=this.lookU16();n=this.decodeBinary(r,2)}else if(e===198){var r=this.lookU32();n=this.decodeBinary(r,4)}else if(e===212)n=this.decodeExtension(1,0);else if(e===213)n=this.decodeExtension(2,0);else if(e===214)n=this.decodeExtension(4,0);else if(e===215)n=this.decodeExtension(8,0);else if(e===216)n=this.decodeExtension(16,0);else if(e===199){var r=this.lookU8();n=this.decodeExtension(r,1)}else if(e===200){var r=this.lookU16();n=this.decodeExtension(r,2)}else if(e===201){var r=this.lookU32();n=this.decodeExtension(r,4)}else throw new ve("Unrecognized type byte: ".concat(kt(e)));this.complete();for(var s=this.stack;s.length>0;){var o=s[s.length-1];if(o.type===nn)if(o.array[o.position]=n,o.position++,o.position===o.size)s.pop(),n=o.array;else continue e;else if(o.type===ot){if(!Yo(n))throw new ve("The type of key must be string or number but "+typeof n);if(n==="__proto__")throw new ve("The key __proto__ is not allowed");o.key=n,o.type=Xo;continue e}else if(o.map[o.key]=n,o.readCount++,o.readCount===o.size)s.pop(),n=o.map;else{o.key=null,o.type=ot;continue e}}return n}},t.prototype.readHeadByte=function(){return this.headByte===We&&(this.headByte=this.readU8()),this.headByte},t.prototype.complete=function(){this.headByte=We},t.prototype.readArraySize=function(){var e=this.readHeadByte();switch(e){case 220:return this.readU16();case 221:return this.readU32();default:{if(e<160)return e-144;throw new ve("Unrecognized array type byte: ".concat(kt(e)))}}},t.prototype.pushMapState=function(e){if(e>this.maxMapLength)throw new ve("Max length exceeded: map length (".concat(e,") > maxMapLengthLength (").concat(this.maxMapLength,")"));this.stack.push({type:ot,size:e,key:null,readCount:0,map:{}})},t.prototype.pushArrayState=function(e){if(e>this.maxArrayLength)throw new ve("Max length exceeded: array length (".concat(e,") > maxArrayLength (").concat(this.maxArrayLength,")"));this.stack.push({type:nn,size:e,array:new Array(e),position:0})},t.prototype.decodeUtf8String=function(e,n){var r;if(e>this.maxStrLength)throw new ve("Max length exceeded: UTF-8 byte length (".concat(e,") > maxStrLength (").concat(this.maxStrLength,")"));if(this.bytes.byteLength<this.pos+n+e)throw rn;var i=this.pos+n,s;return this.stateIsMapKey()&&(!((r=this.keyDecoder)===null||r===void 0)&&r.canBeCached(e))?s=this.keyDecoder.decode(this.bytes,i,e):s=Io(this.bytes,i,e),this.pos+=n+e,s},t.prototype.stateIsMapKey=function(){if(this.stack.length>0){var e=this.stack[this.stack.length-1];return e.type===ot}return!1},t.prototype.decodeBinary=function(e,n){if(e>this.maxBinLength)throw new ve("Max length exceeded: bin length (".concat(e,") > maxBinLength (").concat(this.maxBinLength,")"));if(!this.hasRemaining(e+n))throw rn;var r=this.pos+n,i=this.bytes.subarray(r,r+e);return this.pos+=n+e,i},t.prototype.decodeExtension=function(e,n){if(e>this.maxExtLength)throw new ve("Max length exceeded: ext length (".concat(e,") > maxExtLength (").concat(this.maxExtLength,")"));var r=this.view.getInt8(this.pos+n),i=this.decodeBinary(e,n+1);return this.extensionCodec.decode(i,r,this.context)},t.prototype.lookU8=function(){return this.view.getUint8(this.pos)},t.prototype.lookU16=function(){return this.view.getUint16(this.pos)},t.prototype.lookU32=function(){return this.view.getUint32(this.pos)},t.prototype.readU8=function(){var e=this.view.getUint8(this.pos);return this.pos++,e},t.prototype.readI8=function(){var e=this.view.getInt8(this.pos);return this.pos++,e},t.prototype.readU16=function(){var e=this.view.getUint16(this.pos);return this.pos+=2,e},t.prototype.readI16=function(){var e=this.view.getInt16(this.pos);return this.pos+=2,e},t.prototype.readU32=function(){var e=this.view.getUint32(this.pos);return this.pos+=4,e},t.prototype.readI32=function(){var e=this.view.getInt32(this.pos);return this.pos+=4,e},t.prototype.readU64=function(){var e=Co(this.view,this.pos);return this.pos+=8,e},t.prototype.readI64=function(){var e=Dn(this.view,this.pos);return this.pos+=8,e},t.prototype.readU64AsBigInt=function(){var e=this.view.getBigUint64(this.pos);return this.pos+=8,e},t.prototype.readI64AsBigInt=function(){var e=this.view.getBigInt64(this.pos);return this.pos+=8,e},t.prototype.readF32=function(){var e=this.view.getFloat32(this.pos);return this.pos+=4,e},t.prototype.readF64=function(){var e=this.view.getFloat64(this.pos);return this.pos+=8,e},t}();function jo(t,e){var n=new Qo(e);return n.decode(t)}var es={BASE_URL:"./",DEV:!1,MODE:"production",PROD:!0,SSR:!1,VITE_BACKEND_HOST:"piano-backend.onrender.com"};class Tt{constructor(e){A(this,"audioNodeMap",new Map);A(this,"instrument");A(this,"instrumentName");A(this,"colorHue");A(this,"socketID");this.colorHue=e.color_hue,this.socketID=e.id,this.setInstrument(e.instrument_name)}async setInstrument(e){this.instrumentName=e,this.instrument=await Wi(e)}stopAudio(e){const n=this.audioNodeMap.get(e);n&&(n.stop(),this.audioNodeMap.delete(e))}playAudio(e,n){this.instrument&&(this.stopAudio(e),this.audioNodeMap.set(e,this.instrument.play(e,void 0,{gain:n})))}}class ts{constructor(){A(this,"connecting",ie(!1));A(this,"connectError",ie(""));A(this,"connectedColorHues",ie(new Map));A(this,"connected",ie(!1));A(this,"clientMap",new Map);A(this,"localClient",new Tt({color_hue:220,id:0,instrument_name:"acoustic_grand_piano"}));A(this,"socket",null);A(this,"onPlayNote");A(this,"onStopNote")}connect(e,n=6){if(e.length>100)return this.connectError.set("Room name to long!");const r="piano-backend.onrender.com",i=location.protocol==="https:"?"wss":"ws",s=es.VITE_BACKEND_PATH??"",o=`room_name=${e}&instrument_name=${this.localClient.instrumentName}`;this.socket=new WebSocket(`${i}://${r}/${s}?${o}`),this.socket.binaryType="arraybuffer",this.socket.onopen=()=>{console.log("Connected to websocket"),this.connecting.set(!1),this.connected.set(!0),history.replaceState({},"",`?room=${e}`),document.title=`Room ${e} - Play Piano!`},this.socket.onclose=()=>{history.replaceState({},"",location.pathname),document.title="Play Piano!",this.clean(),ee(this.connected)&&(console.log("Trying to reconnect"),this.connect(e),this.connected.set(!1))},this.socket.onerror=()=>{console.log(`Failed to connect, reconnecting ${n} attempts left`),setTimeout(()=>{n==0?(this.connectError.set("Failed to connect to websocket server"),this.disconnect()):this.connect(e,n-1)},1e3)},this.socket.onmessage=async a=>{if(a.data instanceof ArrayBuffer){const u=jo(new Uint8Array(a.data));console.log(u),u&&this.handleMessage(u)}},this.connectError.set(""),this.connecting.set(!0)}disconnect(){this.connected.set(!1),this.connecting.set(!1),this.socket&&this.socket.close()}handleMessage(e){switch(e.type){case"Error":this.connectError.set(e.error);break;case"PlayNote":this.onPlayNote(e.note,e.volume,this.getClient(e.id));break;case"StopNote":this.onStopNote(e.note,e.sustain,this.getClient(e.id));break;case"InstrumentChange":this.getClient(e.id).setInstrument(e.instrument_name);break;case"ClientConnect":this.addClient(new Tt(e));break;case"ReceiveInfo":{for(const i of e.client_list)this.addClient(new Tt(i));const r=e.created_client;this.localClient.colorHue=r.color_hue,this.localClient.socketID=e.created_client.id,this.addClient(this.localClient);break}case"ClientDisconnect":this.connectedColorHues.update(r=>(r.delete(e.id),r));const n=this.getClient(e.id);n&&(this.cleanClient(n),this.clientMap.delete(e.id));break}}getClient(e){return this.clientMap.get(e)}playNote(e,n){this.onPlayNote(e,n,this.localClient),this.sendMessage("PlayNote",{note:e,volume:n})}stopNote(e,n){this.onStopNote(e,n,this.localClient),this.sendMessage("StopNote",{note:e,sustain:n})}sendMessage(e,n){this.clientMap.size!=1&&this.socket&&ee(this.connected)&&this.socket.send(Ho({type:e,...n}))}async changeInstrument(e){this.sendMessage("InstrumentChange",{instrument_name:e}),await this.localClient.setInstrument(e)}addClient(e){this.connectedColorHues.update(n=>(n.set(e.socketID,e.colorHue),n)),this.clientMap.set(e.socketID,e)}clean(){for(const e of this.clientMap.values())this.cleanClient(e);this.socket=null,this.clientMap.clear(),this.localClient.colorHue=220,this.localClient.socketID=0,this.connectedColorHues.update(e=>(e.clear(),e))}cleanClient(e){for(const n of e.audioNodeMap.keys())this.onStopNote(n,!1,e)}}function on(t,e,n){const r=t.slice();return r[14]=e[n][0],r[15]=e[n][1],r}function ns(t){let e,n,r,i;return{c(){e=b("button"),n=oe("Join"),e.disabled=t[3]},m(s,o){D(s,e,o),y(e,n),r||(i=P(e,"click",t[13]),r=!0)},p(s,o){o&8&&(e.disabled=s[3])},d(s){s&&B(e),r=!1,i()}}}function rs(t){let e,n,r,i,s,o,a,u,c,p,h=be(Array.from(t[4].entries())),l=[];for(let f=0;f<h.length;f+=1)l[f]=an(on(t,h,f));return{c(){e=b("button"),e.textContent="Leave",n=N(),r=b("span"),r.textContent="Connected!",i=b("br"),s=N(),o=b("span"),o.textContent="People:",a=N();for(let f=0;f<l.length;f+=1)l[f].c();u=hn()},m(f,d){D(f,e,d),D(f,n,d),D(f,r,d),D(f,i,d),D(f,s,d),D(f,o,d),D(f,a,d);for(let m=0;m<l.length;m+=1)l[m]&&l[m].m(f,d);D(f,u,d),c||(p=P(e,"click",t[12]),c=!0)},p(f,d){if(d&17){h=be(Array.from(f[4].entries()));let m;for(m=0;m<h.length;m+=1){const v=on(f,h,m);l[m]?l[m].p(v,d):(l[m]=an(v),l[m].c(),l[m].m(u.parentNode,u))}for(;m<l.length;m+=1)l[m].d(1);l.length=h.length}},d(f){f&&(B(e),B(n),B(r),B(i),B(s),B(o),B(a),B(u)),Ye(l,f),c=!1,p()}}}function sn(t){let e;return{c(){e=b("span"),e.textContent="(you)",Ue(e,"margin-right","0.5rem")},m(n,r){D(n,e,r)},d(n){n&&B(e)}}}function an(t){let e,n,r,i,s=t[14]===t[0].localClient.socketID&&sn();return{c(){e=b("div"),r=N(),s&&s.c(),i=hn(),k(e,"class","icon svelte-ye3hvw"),k(e,"style",n=`--color-hue: ${t[15]}`)},m(o,a){D(o,e,a),D(o,r,a),s&&s.m(o,a),D(o,i,a)},p(o,a){a&16&&n!==(n=`--color-hue: ${o[15]}`)&&k(e,"style",n),o[14]===o[0].localClient.socketID?s||(s=sn(),s.c(),s.m(i.parentNode,i)):s&&(s.d(1),s=null)},d(o){o&&(B(e),B(r),B(i)),s&&s.d(o)}}}function is(t){let e,n,r,i;return{c(){e=b("span"),e.textContent="Connecting...",n=N(),r=b("img"),un(r.src,i=Nn)||k(r,"src",i),k(r,"alt","spinner")},m(s,o){D(s,e,o),D(s,n,o),D(s,r,o)},p:G,d(s){s&&(B(e),B(n),B(r))}}}function os(t){let e,n;return{c(){e=b("span"),n=oe(t[5]),k(e,"class","error svelte-ye3hvw")},m(r,i){D(r,e,i),y(e,n)},p(r,i){i&32&&$e(n,r[5])},d(r){r&&B(e)}}}function ss(t){let e,n,r,i,s,o,a,u;function c(m,v){return m[2]?rs:ns}let p=c(t),h=p(t);function l(m,v){if(m[5])return os;if(m[3])return is}let f=l(t),d=f&&f(t);return{c(){e=b("div"),n=b("p"),n.textContent="Join a room:",r=N(),i=b("input"),s=N(),h.c(),o=N(),d&&d.c(),k(i,"type","text"),k(i,"placeholder","Room name")},m(m,v){D(m,e,v),y(e,n),y(e,r),y(e,i),q(i,t[1]),y(e,s),h.m(e,null),y(e,o),d&&d.m(e,null),a||(u=[P(i,"input",t[10]),P(i,"keydown",t[11])],a=!0)},p(m,[v]){v&2&&i.value!==m[1]&&q(i,m[1]),p===(p=c(m))&&h?h.p(m,v):(h.d(1),h=p(m),h&&(h.c(),h.m(e,o))),f===(f=l(m))&&d?d.p(m,v):(d&&d.d(1),d=f&&f(m),d&&(d.c(),d.m(e,null)))},i:G,o:G,d(m){m&&B(e),h.d(),d&&d.d(),a=!1,pe(u)}}}function as(t,e,n){let r,i,s,o,{socketPlayer:a}=e,u="",{connected:c,connecting:p,connectError:h,connectedColorHues:l}=a;J(t,c,_=>n(2,r=_)),J(t,p,_=>n(3,i=_)),J(t,h,_=>n(5,o=_)),J(t,l,_=>n(4,s=_)),pn(()=>{const M=new URLSearchParams(location.search).get("room");M!=null&&(n(1,u=M),a.connect(u))});function f(){u=this.value,n(1,u)}const d=_=>{_.code==="Enter"&&!r&&!i&&a.connect(u)},m=()=>a.disconnect(),v=()=>a.connect(u);return t.$$set=_=>{"socketPlayer"in _&&n(0,a=_.socketPlayer)},[a,u,r,i,s,o,c,p,h,l,f,d,m,v]}class cs extends Ke{constructor(e){super(),He(this,e,as,ss,Pe,{socketPlayer:0})}}function ls(t){let e,n,r,i,s,o,a,u;return r=new po({props:{pianoControlsData:t[0],socketPlayer:t[2]}}),s=new ro({props:{midiPlayer:t[1]}}),a=new cs({props:{socketPlayer:t[2]}}),{c(){e=b("div"),n=b("div"),Xe(r.$$.fragment),i=N(),Xe(s.$$.fragment),o=N(),Xe(a.$$.fragment),k(n,"class","row svelte-b9289n"),k(e,"class","control-panel svelte-b9289n")},m(c,p){D(c,e,p),y(e,n),Ve(r,n,null),y(n,i),Ve(s,n,null),y(e,o),Ve(a,e,null),u=!0},p(c,[p]){const h={};p&1&&(h.pianoControlsData=c[0]),p&4&&(h.socketPlayer=c[2]),r.$set(h);const l={};p&2&&(l.midiPlayer=c[1]),s.$set(l);const f={};p&4&&(f.socketPlayer=c[2]),a.$set(f)},i(c){u||(Se(r.$$.fragment,c),Se(s.$$.fragment,c),Se(a.$$.fragment,c),u=!0)},o(c){Re(r.$$.fragment,c),Re(s.$$.fragment,c),Re(a.$$.fragment,c),u=!1},d(c){c&&B(e),Le(r),Le(s),Le(a)}}}function us(t,e,n){let{pianoControlsData:r}=e,{midiPlayer:i}=e,{socketPlayer:s}=e;return t.$$set=o=>{"pianoControlsData"in o&&n(0,r=o.pianoControlsData),"midiPlayer"in o&&n(1,i=o.midiPlayer),"socketPlayer"in o&&n(2,s=o.socketPlayer)},[r,i,s]}class fs extends Ke{constructor(e){super(),He(this,e,us,ls,Pe,{pianoControlsData:0,midiPlayer:1,socketPlayer:2})}}function hs(t){let e,n,r,i,s;return n=new fs({props:{pianoControlsData:t[0],midiPlayer:t[1],socketPlayer:t[2]}}),i=new Qi({props:{pianoControlsData:t[0],midiPlayer:t[1],socketPlayer:t[2]}}),{c(){e=b("main"),Xe(n.$$.fragment),r=N(),Xe(i.$$.fragment)},m(o,a){D(o,e,a),Ve(n,e,null),y(e,r),Ve(i,e,null),s=!0},p:G,i(o){s||(Se(n.$$.fragment,o),Se(i.$$.fragment,o),s=!0)},o(o){Re(n.$$.fragment,o),Re(i.$$.fragment,o),s=!1},d(o){o&&B(e),Le(n),Le(i)}}}function ds(t){const e=new fo,n=new Yi,r=new ts;return[e,n,r]}class ps extends Ke{constructor(e){super(),He(this,e,ds,hs,Pe,{})}}new ps({target:document.body});

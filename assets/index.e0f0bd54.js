import{g as le,w as z,M as sn,l as an,a as rn,S as et,i as tt,s as nt,e as h,t as _e,b as K,c as a,n as P,d as S,h as Ge,f as k,j as u,k as cn,m as It,o as B,p as qt,q as v,r as un,u as x,v as ot,x as _n,y as lt,z as st,A as D,B as fn,C as R,D as pn,E as it,F as Je,G as dn,H as hn,I as mn,J as Lt,K as zt,L as Rt,N as Ht,O as Gt}from"./vendor.90408fa6.js";const gn=function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const l of document.querySelectorAll('link[rel="modulepreload"]'))o(l);new MutationObserver(l=>{for(const s of l)if(s.type==="childList")for(const r of s.addedNodes)r.tagName==="LINK"&&r.rel==="modulepreload"&&o(r)}).observe(document,{childList:!0,subtree:!0});function n(l){const s={};return l.integrity&&(s.integrity=l.integrity),l.referrerpolicy&&(s.referrerPolicy=l.referrerpolicy),l.crossorigin==="use-credentials"?s.credentials="include":l.crossorigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function o(l){if(l.ep)return;l.ep=!0;const s=n(l);fetch(l.href,s)}};gn();const Jt=["accordion","acoustic_bass","acoustic_grand_piano","acoustic_guitar_nylon","acoustic_guitar_steel","agogo","alto_sax","applause","bagpipe","banjo","baritone_sax","bassoon","bird_tweet","blown_bottle","brass_section","breath_noise","bright_acoustic_piano","celesta","cello","choir_aahs","church_organ","clarinet","clavinet","contrabass","distortion_guitar","drawbar_organ","dulcimer","electric_bass_finger","electric_bass_pick","electric_grand_piano","electric_guitar_clean","electric_guitar_jazz","electric_guitar_muted","electric_piano_1","electric_piano_2","english_horn","fiddle","flute","french_horn","fretless_bass","fx_1_rain","fx_2_soundtrack","fx_3_crystal","fx_4_atmosphere","fx_5_brightness","fx_6_goblins","fx_7_echoes","fx_8_scifi","glockenspiel","guitar_fret_noise","guitar_harmonics","gunshot","harmonica","harpsichord","helicopter","honkytonk_piano","kalimba","koto","lead_1_square","lead_2_sawtooth","lead_3_calliope","lead_4_chiff","lead_5_charang","lead_6_voice","lead_7_fifths","lead_8_bass__lead","marimba","melodic_tom","music_box","muted_trumpet","oboe","ocarina","orchestra_hit","orchestral_harp","overdriven_guitar","pad_1_new_age","pad_2_warm","pad_3_polysynth","pad_4_choir","pad_5_bowed","pad_6_metallic","pad_7_halo","pad_8_sweep","pan_flute","percussive_organ","piccolo","pizzicato_strings","recorder","reed_organ","reverse_cymbal","rock_organ","seashore","shakuhachi","shamisen","shanai","sitar","slap_bass_1","slap_bass_2","soprano_sax","steel_drums","string_ensemble_1","string_ensemble_2","synth_bass_1","synth_bass_2","synth_brass_1","synth_brass_2","synth_choir","synth_drum","synth_strings_1","synth_strings_2","taiko_drum","tango_accordion","telephone_ring","tenor_sax","timpani","tinkle_bell","tremolo_strings","trombone","trumpet","tuba","tubular_bells","vibraphone","viola","violin","voice_oohs","whistle","woodblock","xylophone"],se=["C","C#","D","D#","E","E#","F","F#","G","G#","A","A#","B","B#"],Wt={Backquote:"A#2",Tab:"B2",KeyQ:"C3",Digit2:"C#3",KeyW:"D3",Digit3:"D#3",KeyE:"E3",Key4:"E#3",KeyR:"F3",Digit5:"F#3",KeyT:"G3",Digit6:"G#3",KeyY:"A3",Digit7:"A#3",KeyU:"B3",Key8:"B#8",KeyI:"C4",Digit9:"C#4",KeyO:"D4",Digit0:"D#4",KeyP:"E4",Minus:"E#4",BracketLeft:"F4",Equal:"F#4",BracketRight:"G4",Backspace:"G#4",Backslash:"A4",CapsLock:"A#4",ShiftLeft:"B4",KeyA:"B#4",KeyZ:"C5",KeyS:"C#5",KeyX:"D5",KeyD:"D#5",KeyC:"E5",KeyF:"E#5",KeyV:"F5",KeyG:"F#5",KeyB:"G5",KeyH:"G#5",KeyN:"A5",KeyJ:"A#5",KeyM:"B5",KeyK:"B#5",Comma:"C6",KeyL:"C#6",Period:"D6",Semicolon:"D#6",Slash:"E6",Quote:"E#6",ShiftRight:"F6",Enter:"F#6"};function at(e){return parseInt(e.charAt(e.length-1))}function rt(e){return e.substring(0,e.length-1)}function ct(e){const t=Math.floor(e/12)-1;return se[e%12]+t}function bn(e,t){const n=at(t),o=at(e),l=se.indexOf(rt(e)),s=se.indexOf(rt(t)),r={};let p=0;const f=["E#","B#"];for(let c=o;c<=n;c++){let i=c===o?l:0;for(;i<se.length&&!(c===n&&i>s);){const b=se[i];if(!f.includes(b)){const w=b.length===1;r[b+c]={white:w,pressedColor:null,ghost:!1},w&&p++}i++}}return{noteMap:r,whiteKeys:p}}const W=z(!1),Ce=z(0),We=z(0),ut=z(),De=z(1);async function yn(e,t){let n=[],o=null;function l(c){o=new sn(c),o.tracks=o.tracks.filter(d=>d.notes.length!==0);let i=0;o.tracks.forEach(d=>{const b=d.notes[d.notes.length-1],w=b.time+b.duration;w>i&&(i=w)}),We.set(i)}ut.subscribe(c=>{if(W.set(!1),We.set(0),Ce.set(0),!c){o=null;return}const i=new FileReader;i.onload=()=>l(i.result),i.readAsArrayBuffer(c)});function s(c){const i=le(Ce)+c;Ce.set(i),o.tracks.forEach((d,b)=>{const w=d.notes[n[b]];if(!w)return;i-w.time>0&&(e(w.name,w.velocity),setTimeout(()=>t(w.name),w.duration*1e3/le(De)),n[b]++)}),i>le(We)&&W.set(!1)}W.subscribe(c=>{if(!c)return;if(!o)return W.set(!1),alert("No MIDI file selected!");o.tracks.forEach((b,w)=>{let q=0,j=b.notes.length-1;for(;q!=j;){const y=Math.ceil((q+j)/2);b.notes[y].time>le(Ce)?j=y-1:q=y}n[w]=q});let i=performance.now();const d=()=>{if(!le(W))return;const b=performance.now(),w=b-i;i=b,s(w/1e3*le(De)),requestAnimationFrame(d)};d()});function r(c){const[i,d,b]=c.data;i>143&&i<160?b==0?t(ct(d)):e(ct(d),b/127):i>127&&i<144&&t(ct(d))}const p=await navigator.requestMIDIAccess();function f(){p.inputs.forEach(c=>{c.onmidimessage=r})}f(),p.onstatechange=()=>{f()}}const Qt=window.AudioContext||window.webkitAudioContext;Qt||alert("Your browser does not seem to support the Web Audio API!");const vn=new Qt,_t={};function Ut(e){return _t[e]||(_t[e]=an.exports.instrument(vn,e)),_t[e]}const Vt=z(),Qe=z("acoustic_grand_piano"),Pe=z(new Map),ft=z(!1),fe=new Map,Ue={audioNodeMap:new Map,colorHue:"220"};fe.set("0",Ue);let A,pt,dt;async function ht(e,t){let n=await Ut(e),o=fe.get(t);o&&(o.instrument=n)}function Yt({socketID:e,colorHue:t,instrumentName:n}){fe.set(e,{audioNodeMap:e===A.id?Ue.audioNodeMap:new Map,colorHue:t}),Pe.set(le(Pe).set(e,t)),n&&ht(n,e)}function mt(){A.removeAllListeners(),A=null,ft.set(!1)}function kn(e,t){pt=e,dt=t}function gt(e){const t=new Promise((n,o)=>{A=rn("https://calbabreaker-piano-backend.herokuapp.com",{query:{roomName:e,instrumentName:le(Qe)},path:{}.VITE_BACKEND_PATH}),A.on("connect_error",()=>{mt(),o("Failed to connect to server!")}),A.on("connect_timeout",()=>{mt(),o("Timed out while connecting to server!")}),A.on("connect",()=>{ft.set(!0),fe.delete("0"),le(Pe).clear(),n(),history.replaceState({},`Play Piano! - ${e}`,`?room=${e}`)}),A.on("disconnect",()=>{fe.clear(),fe.set("0",Ue),mt(),history.replaceState({},"Play Piano!",location.pathname)}),A.on("play_note",s=>{pt(s)}),A.on("stop_note",s=>{dt(s)}),A.on("instrument_change",s=>{const{instrumentName:r,socketID:p}=s;ht(r,p)}),A.on("client_connect",s=>{Yt(s)}),A.on("client_list_recieve",s=>{const r=s;for(let p of r)Yt(p)}),A.on("client_disconnect",s=>{const r=le(Pe);r.delete(s),Pe.set(r),fe.delete(s)})});Vt.set(t)}function wn(e,t){const n={note:e,volume:t};A?A.emit("play_note",n):pt(n)}function bt(e,t){const n={note:e,sustain:t};A?A.emit("stop_note",n):dt(n)}Qe.subscribe(e=>{A?A.emit("instrument_change",{instrumentName:e}):ht(e,"0")});const{window:Cn}=fn;function Xt(e,t,n){const o=e.slice();return o[40]=t[n][0],o[41]=t[n][1],o}function Zt(e,t,n){const o=e.slice();return o[45]=t[n],o}function xt(e){let t,n=e[45]+"",o,l;return{c(){t=h("option"),o=_e(n),t.__value=l=e[45],t.value=t.__value},m(s,r){K(s,t,r),a(t,o)},p:P,d(s){s&&S(t)}}}function Nn(e){return{c:P,m:P,d:P}}function Kn(e){return{c:P,m:P,d:P}}function Sn(e){let t;return{c(){t=_e("loading...")},m(n,o){K(n,t,o)},d(n){n&&S(t)}}}function An(e){let t,n,o;return{c(){t=h("button"),t.textContent="Play"},m(l,s){K(l,t,s),n||(o=v(t,"click",e[26]),n=!0)},p:P,d(l){l&&S(t),n=!1,o()}}}function Pn(e){let t,n,o;return{c(){t=h("button"),t.textContent="Pause"},m(l,s){K(l,t,s),n||(o=v(t,"click",e[25]),n=!0)},p:P,d(l){l&&S(t),n=!1,o()}}}function En(e){let t,n,o;return{c(){t=h("button"),t.textContent="Join"},m(l,s){K(l,t,s),n||(o=v(t,"click",e[36]),n=!0)},p:P,d(l){l&&S(t),n=!1,o()}}}function Dn(e){let t,n,o;return{c(){t=h("button"),t.textContent="Leave"},m(l,s){K(l,t,s),n||(o=v(t,"click",e[35]),n=!0)},p:P,d(l){l&&S(t),n=!1,o()}}}function jn(e){let t,n=e[44]+"",o;return{c(){t=h("span"),o=_e(n),u(t,"class","error svelte-1ufj93m")},m(l,s){K(l,t,s),a(t,o)},p(l,s){s[0]&8192&&n!==(n=l[44]+"")&&ot(o,n)},d(l){l&&S(t)}}}function Mn(e){let t,n=e[12]&&$t(e);return{c(){n&&n.c(),t=it()},m(o,l){n&&n.m(o,l),K(o,t,l)},p(o,l){o[12]?n?n.p(o,l):(n=$t(o),n.c(),n.m(t.parentNode,t)):n&&(n.d(1),n=null)},d(o){n&&n.d(o),o&&S(t)}}}function $t(e){let t,n,o,l,s,r,p=Array.from(e[14].entries()),f=[];for(let c=0;c<p.length;c+=1)f[c]=tn(Xt(e,p,c));return{c(){t=h("span"),t.textContent="Connected!",n=h("br"),o=k(),l=h("span"),l.textContent="People:",s=k();for(let c=0;c<f.length;c+=1)f[c].c();r=it()},m(c,i){K(c,t,i),K(c,n,i),K(c,o,i),K(c,l,i),K(c,s,i);for(let d=0;d<f.length;d+=1)f[d].m(c,i);K(c,r,i)},p(c,i){if(i[0]&16384){p=Array.from(c[14].entries());let d;for(d=0;d<p.length;d+=1){const b=Xt(c,p,d);f[d]?f[d].p(b,i):(f[d]=tn(b),f[d].c(),f[d].m(r.parentNode,r))}for(;d<f.length;d+=1)f[d].d(1);f.length=p.length}},d(c){c&&S(t),c&&S(n),c&&S(o),c&&S(l),c&&S(s),lt(f,c),c&&S(r)}}}function en(e){let t;return{c(){t=h("span"),t.textContent="(you)",It(t,"margin-right","0.5rem")},m(n,o){K(n,t,o)},d(n){n&&S(t)}}}function tn(e){let t,n,o,l,s=e[40]===A.id&&en();return{c(){t=h("div"),o=k(),s&&s.c(),l=it(),u(t,"class","icon svelte-1ufj93m"),u(t,"style",n=`--color-hue: ${e[41]}`)},m(r,p){K(r,t,p),K(r,o,p),s&&s.m(r,p),K(r,l,p)},p(r,p){p[0]&16384&&n!==(n=`--color-hue: ${r[41]}`)&&u(t,"style",n),r[40]===A.id?s||(s=en(),s.c(),s.m(l.parentNode,l)):s&&(s.d(1),s=null)},d(r){r&&S(t),r&&S(o),s&&s.d(r),r&&S(l)}}}function Fn(e){let t;return{c(){t=h("span"),t.textContent="Connecting..."},m(n,o){K(n,t,o)},p:P,d(n){n&&S(t)}}}function Tn(e){let t,n,o,l,s,r,p,f,c,i,d,b,w,q,j,y,O,Q,me,pe,ge,M,G,U,be,ye,Ne,H,ve,_,g,C,Ke,Me,Ee,Fe,V,ie,$,ae,re,ce,Te,ee,de,Se,Be,m,ke,we,Ye,Oe,kt,F,wt,Y,Ct,ue,Nt,Kt,St,I,At,Ie=e[9].toFixed(1)+"",Xe,Pt,qe=e[11].toFixed(1)+"",Ze,Et,Dt,X,Le,jt,te,Mt,xe,ze,$e,Ft,Ae=Jt,L=[];for(let E=0;E<Ae.length;E+=1)L[E]=xt(Zt(e,Ae,E));let Z={ctx:e,current:null,token:null,hasCatch:!1,pending:Sn,then:Kn,catch:Nn};Ge(Ke=e[2],Z);function Tt(E,N){return E[8]?Pn:An}let Re=Tt(e),ne=Re(e);function Bt(E,N){return E[12]?Dn:En}let He=Bt(e),oe=He(e),J={ctx:e,current:null,token:null,hasCatch:!0,pending:Fn,then:Mn,catch:jn,error:44};return Ge(ze=e[13],J),{c(){t=h("div"),n=h("div"),o=h("div"),l=h("div"),s=h("span"),s.textContent="Sustain:",r=k(),p=h("input"),f=k(),c=h("div"),i=h("span"),i.textContent="Octave Shift:",d=k(),b=h("input"),w=k(),q=h("span"),q.textContent="Note Shift:",j=k(),y=h("input"),O=k(),Q=h("br"),me=k(),pe=h("span"),pe.textContent="Volume:",ge=k(),M=h("input"),G=k(),U=h("input"),be=k(),ye=h("br"),Ne=k(),H=h("div"),ve=h("span"),ve.textContent="Instrument:",_=k(),g=h("select");for(let E=0;E<L.length;E+=1)L[E].c();C=k(),Z.block.c(),Me=k(),Ee=h("span"),Ee.textContent="Size:",Fe=k(),V=h("select"),ie=h("option"),ie.textContent="Full size (88 keys)",$=h("option"),$.textContent="Half size (61 keys)",ae=h("option"),ae.textContent="Quater Size (37 keys)",re=h("option"),re.textContent="2 Octaves (24 keys)",ce=h("option"),ce.textContent="1 Octave (12 keys)",Te=k(),ee=h("div"),de=h("div"),Se=h("p"),Se.textContent="Play a midi:",Be=k(),m=h("input"),ke=k(),we=h("div"),ne.c(),Ye=k(),Oe=h("button"),Oe.textContent="Restart",kt=k(),F=h("div"),wt=_e("Speed:"),Y=h("input"),Ct=k(),ue=h("input"),Nt=_e("times"),Kt=h("br"),St=k(),I=h("input"),At=k(),Xe=_e(Ie),Pt=_e("/"),Ze=_e(qe),Et=_e(" seconds"),Dt=k(),X=h("div"),Le=h("p"),Le.textContent="Join a room:",jt=k(),te=h("input"),Mt=k(),oe.c(),xe=k(),J.block.c(),u(p,"type","checkbox"),u(p,"class","svelte-1ufj93m"),u(l,"title","Shortcut: space"),u(l,"class","svelte-1ufj93m"),u(b,"type","number"),u(b,"min","-3"),u(b,"max","3"),u(b,"class","svelte-1ufj93m"),u(c,"title","Shortcut: left ctrl +, left alt or right ctrl -"),u(c,"class","svelte-1ufj93m"),u(y,"type","number"),u(y,"min","-12"),u(y,"max","12"),u(y,"class","svelte-1ufj93m"),u(M,"type","range"),u(M,"min","0"),u(M,"max","50"),u(M,"step","0.1"),u(M,"class","svelte-1ufj93m"),u(U,"type","number"),u(U,"class","svelte-1ufj93m"),e[0]===void 0&&cn(()=>e[22].call(g)),u(H,"class","svelte-1ufj93m"),u(ie,"data-range","A0,C8"),ie.__value="Full size (88 keys)",ie.value=ie.__value,u($,"data-range","C2,C7"),$.selected=!0,$.__value="Half size (61 keys)",$.value=$.__value,u(ae,"data-range","C3,C6"),ae.__value="Quater Size (37 keys)",ae.value=ae.__value,u(re,"data-range","C4,B5"),re.__value="2 Octaves (24 keys)",re.value=re.__value,u(ce,"data-range","C4,B4"),ce.__value="1 Octave (12 keys)",ce.value=ce.__value,u(o,"class","svelte-1ufj93m"),u(Se,"class","svelte-1ufj93m"),u(m,"type","file"),u(m,"class","svelte-1ufj93m"),u(de,"class","svelte-1ufj93m"),u(we,"class","svelte-1ufj93m"),u(Y,"type","range"),u(Y,"min","0.01"),u(Y,"max","4"),u(Y,"step","0.01"),u(Y,"class","svelte-1ufj93m"),u(ue,"type","number"),u(ue,"min","0.01"),u(ue,"class","svelte-1ufj93m"),u(I,"type","range"),u(I,"min","0"),u(I,"max",e[11]),u(I,"step","0.1"),It(I,"width","18rem"),u(I,"class","svelte-1ufj93m"),u(F,"class","svelte-1ufj93m"),u(ee,"class","svelte-1ufj93m"),u(n,"class","row svelte-1ufj93m"),u(Le,"class","svelte-1ufj93m"),u(te,"type","text"),u(te,"placeholder","Room name"),u(te,"class","svelte-1ufj93m"),u(t,"class","control-panel svelte-1ufj93m")},m(E,N){K(E,t,N),a(t,n),a(n,o),a(o,l),a(l,s),a(l,r),a(l,p),p.checked=e[4],a(o,f),a(o,c),a(c,i),a(c,d),a(c,b),B(b,e[3]),a(o,w),a(o,q),a(o,j),a(o,y),B(y,e[5]),a(o,O),a(o,Q),a(o,me),a(o,pe),a(o,ge),a(o,M),B(M,e[6]),a(o,G),a(o,U),B(U,e[6]),a(o,be),a(o,ye),a(o,Ne),a(o,H),a(H,ve),a(H,_),a(H,g);for(let T=0;T<L.length;T+=1)L[T].m(g,null);qt(g,e[0]),a(H,C),Z.block.m(H,Z.anchor=null),Z.mount=()=>H,Z.anchor=null,a(o,Me),a(o,Ee),a(o,Fe),a(o,V),a(V,ie),a(V,$),a(V,ae),a(V,re),a(V,ce),a(n,Te),a(n,ee),a(ee,de),a(de,Se),a(de,Be),a(de,m),a(ee,ke),a(ee,we),ne.m(we,null),a(we,Ye),a(we,Oe),a(ee,kt),a(ee,F),a(F,wt),a(F,Y),B(Y,e[10]),a(F,Ct),a(F,ue),B(ue,e[10]),a(F,Nt),a(F,Kt),a(F,St),a(F,I),B(I,e[9]),a(F,At),a(F,Xe),a(F,Pt),a(F,Ze),a(F,Et),a(t,Dt),a(t,X),a(X,Le),a(X,jt),a(X,te),B(te,e[1]),a(X,Mt),oe.m(X,null),a(X,xe),J.block.m(X,J.anchor=null),J.mount=()=>X,J.anchor=null,$e||(Ft=[v(Cn,"keydown",e[16]),v(p,"change",e[17]),v(b,"input",e[18]),v(y,"input",e[19]),v(M,"change",e[20]),v(M,"input",e[20]),v(U,"input",e[21]),v(g,"change",e[22]),v(V,"change",e[23]),un(e[15].call(null,V)),v(m,"change",e[24]),v(Oe,"click",e[27]),v(Y,"change",e[28]),v(Y,"input",e[28]),v(ue,"input",e[29]),v(I,"change",e[30]),v(I,"input",e[30]),v(I,"mousedown",e[31]),v(I,"mouseup",e[32]),v(te,"input",e[33]),v(te,"keydown",e[34])],$e=!0)},p(E,N){if(e=E,N[0]&16&&(p.checked=e[4]),N[0]&8&&x(b.value)!==e[3]&&B(b,e[3]),N[0]&32&&x(y.value)!==e[5]&&B(y,e[5]),N[0]&64&&B(M,e[6]),N[0]&64&&x(U.value)!==e[6]&&B(U,e[6]),N&0){Ae=Jt;let T;for(T=0;T<Ae.length;T+=1){const Ot=Zt(e,Ae,T);L[T]?L[T].p(Ot,N):(L[T]=xt(Ot),L[T].c(),L[T].m(g,null))}for(;T<L.length;T+=1)L[T].d(1);L.length=Ae.length}N[0]&1&&qt(g,e[0]),Z.ctx=e,N[0]&4&&Ke!==(Ke=e[2])&&Ge(Ke,Z),Re===(Re=Tt(e))&&ne?ne.p(e,N):(ne.d(1),ne=Re(e),ne&&(ne.c(),ne.m(we,Ye))),N[0]&1024&&B(Y,e[10]),N[0]&1024&&x(ue.value)!==e[10]&&B(ue,e[10]),N[0]&2048&&u(I,"max",e[11]),N[0]&512&&B(I,e[9]),N[0]&512&&Ie!==(Ie=e[9].toFixed(1)+"")&&ot(Xe,Ie),N[0]&2048&&qe!==(qe=e[11].toFixed(1)+"")&&ot(Ze,qe),N[0]&2&&te.value!==e[1]&&B(te,e[1]),He===(He=Bt(e))&&oe?oe.p(e,N):(oe.d(1),oe=He(e),oe&&(oe.c(),oe.m(X,xe))),J.ctx=e,N[0]&8192&&ze!==(ze=e[13])&&Ge(ze,J)||_n(J,e,N)},i:P,o:P,d(E){E&&S(t),lt(L,E),Z.block.d(),Z.token=null,Z=null,ne.d(),oe.d(),J.block.d(),J.token=null,J=null,$e=!1,st(Ft)}}}const he=z(0),yt=z(0),je=z(!1),Ve=z(25),vt=z(["C0","C0"]);function Bn(e,t,n){let o,l,s=P,r,p=P,f,c=P,i,d,b=P,w,q=P,j,y,O,Q,me,pe,ge,M;D(e,he,m=>n(3,l=m)),D(e,je,m=>n(4,r=m)),D(e,vt,m=>n(37,f=m)),D(e,Qe,m=>n(0,i=m)),D(e,yt,m=>n(5,d=m)),D(e,Ve,m=>n(6,w=m)),D(e,ut,m=>n(7,j=m)),D(e,W,m=>n(8,y=m)),D(e,Ce,m=>n(9,O=m)),D(e,De,m=>n(10,Q=m)),D(e,We,m=>n(11,me=m)),D(e,ft,m=>n(12,pe=m)),D(e,Vt,m=>n(13,ge=m)),D(e,Pe,m=>n(14,M=m)),e.$$.on_destroy.push(()=>s()),e.$$.on_destroy.push(()=>p()),e.$$.on_destroy.push(()=>c()),e.$$.on_destroy.push(()=>b()),e.$$.on_destroy.push(()=>q());let G="";const be=new URLSearchParams(window.location.search).get("room");be&&(G=be,gt(G));function ye(m){const ke=m.children[m.selectedIndex];R(vt,f=ke.dataset.range.split(","),f)}function Ne(m){m.code==="Space"&&R(je,r=!r,r),m.code==="ControlLeft"?R(he,l-=1,l):(m.code==="AltLeft"||m.code=="ControlRight")&&R(he,l+=1,l),l<-3?R(he,l=3,l):l>3&&R(he,l=-3,l)}function H(){r=this.checked,je.set(r)}function ve(){l=x(this.value),he.set(l)}function _(){d=x(this.value),yt.set(d)}function g(){w=x(this.value),Ve.set(w)}function C(){w=x(this.value),Ve.set(w)}function Ke(){i=pn(this),Qe.set(i)}const Me=m=>ye(m.currentTarget),Ee=m=>{var ke;return R(ut,j=(ke=m.currentTarget.files)==null?void 0:ke[0],j)},Fe=()=>R(W,y=!1,y),V=()=>R(W,y=!0,y),ie=()=>{R(W,y=!1,y),R(Ce,O=0,O),setTimeout(()=>{R(W,y=!0,y)},100)};function $(){Q=x(this.value),De.set(Q)}function ae(){Q=x(this.value),De.set(Q)}function re(){O=x(this.value),Ce.set(O)}const ce=()=>R(W,y=!1,y),Te=()=>R(W,y=!0,y);function ee(){G=this.value,n(1,G)}const de=m=>{m.code==="Enter"&&gt(G)},Se=()=>A.disconnect(),Be=()=>gt(G);return e.$$.update=()=>{e.$$.dirty[0]&1&&n(2,o=Ut(i))},[i,G,o,l,r,d,w,j,y,O,Q,me,pe,ge,M,ye,Ne,H,ve,_,g,C,Ke,Me,Ee,Fe,V,ie,$,ae,re,ce,Te,ee,de,Se,Be]}class On extends et{constructor(t){super();tt(this,t,Bn,Tn,nt,{},null,[-1,-1])}}function nn(e,t,n){const o=e.slice();return o[27]=t[n][0],o[28]=t[n][1].white,o[29]=t[n][1].pressedColor,o[30]=t[n][1].ghost,o}function on(e){let t,n,o,l,s;function r(...i){return e[14](e[27],...i)}function p(){return e[15](e[27])}function f(){return e[16](e[27])}function c(){return e[17](e[27])}return{c(){t=h("div"),u(t,"class",n="key "+(e[28]?"white":"black")+" svelte-yqi7mq"),u(t,"style",o=`--color-hue: ${e[29]}`),Je(t,"pressed",e[29]!==null),Je(t,"ghost",e[30]&&e[29]===null)},m(i,d){K(i,t,d),l||(s=[v(t,"pointerdown",r),v(t,"pointerenter",p),v(t,"pointerleave",f),v(t,"pointerup",c)],l=!0)},p(i,d){e=i,d[0]&4&&n!==(n="key "+(e[28]?"white":"black")+" svelte-yqi7mq")&&u(t,"class",n),d[0]&4&&o!==(o=`--color-hue: ${e[29]}`)&&u(t,"style",o),d[0]&4&&Je(t,"pressed",e[29]!==null),d[0]&4&&Je(t,"ghost",e[30]&&e[29]===null)},d(i){i&&S(t),l=!1,st(s)}}}function In(e){let t,n,o,l,s,r=Object.entries(e[2]),p=[];for(let f=0;f<r.length;f+=1)p[f]=on(nn(e,r,f));return{c(){t=h("div"),n=h("div");for(let f=0;f<p.length;f+=1)p[f].c();u(n,"class","piano svelte-yqi7mq"),u(n,"style",o=`--white-keys: ${e[0]}`),u(t,"class","piano-container svelte-yqi7mq")},m(f,c){K(f,t,c),a(t,n);for(let i=0;i<p.length;i+=1)p[i].m(n,null);e[18](t),l||(s=[v(window,"resize",e[10]),v(window,"load",e[11]),v(window,"keyup",e[8]),v(window,"keydown",e[7]),v(window,"pointerdown",e[12]),v(window,"pointerup",e[13]),v(n,"touchend",dn(e[9]))],l=!0)},p(f,c){if(c[0]&54){r=Object.entries(f[2]);let i;for(i=0;i<r.length;i+=1){const d=nn(f,r,i);p[i]?p[i].p(d,c):(p[i]=on(d),p[i].c(),p[i].m(n,null))}for(;i<p.length;i+=1)p[i].d(1);p.length=r.length}c[0]&1&&o!==(o=`--white-keys: ${f[0]}`)&&u(n,"style",o)},i:P,o:P,d(f){f&&S(t),lt(p,f),e[18](null),l=!1,st(s)}}}function ln(e,t){t.get(e)&&(t.get(e).stop(),t.delete(e))}function qn(e,t,n){let o,l,s,r;D(e,je,_=>n(19,o=_)),D(e,Ve,_=>n(20,l=_)),D(e,yt,_=>n(21,s=_)),D(e,he,_=>n(22,r=_));let p=!1,f,c,i,d=new Map;vt.subscribe(_=>{const g=bn(_[0],_[1]);n(2,f=g.noteMap),n(0,c=g.whiteKeys)});function b(_){var C;const g=fe.get((C=_.socketID)!=null?C:"0");f[_.note]&&n(2,f[_.note].pressedColor=g.colorHue,f),!!g.instrument&&(ln(_.note,g.audioNodeMap),g.audioNodeMap.set(_.note,g.instrument.play(_.note,void 0,{gain:_.volume})))}function w(_){var C;const g=fe.get((C=_.socketID)!=null?C:"0");f[_.note]&&n(2,f[_.note].pressedColor=null,f),_.sustain||ln(_.note,g.audioNodeMap)}kn(b,w);function q(_){let g=at(_)+r,C=se.indexOf(rt(_));return C+=s,C>=se.length&&(g+=Math.floor(C/se.length),C=C%se.length),se[C]+g}function j(_,g){const C=q(_);d.get(C)||(f[_]&&n(2,f[_].ghost=!0,f),d.set(C,!0),wn(C,l*g))}function y(_){const g=q(_);f[_]&&n(2,f[_].ghost=!1,f),!!d.get(g)&&(d.delete(g),bt(g,o))}yn(j,y),je.subscribe(_=>{if(!_)for(const g of Ue.audioNodeMap.keys())d.get(g)||bt(g,!1)}),he.subscribe(()=>{for(const _ of d.keys())bt(_,o)});function O(_=c){if(!i)return;const g=i.clientHeight/6,C=i.offsetWidth/_;i.style.setProperty("--white-key-width",`${Math.min(C,g)}px`)}function Q(_){const g=Wt[_.code],C=_.target;g&&C.tagName!=="INPUT"&&(_.preventDefault(),j(g,.5))}function me(_){const g=Wt[_.code];g&&y(g)}function pe(_){hn.call(this,e,_)}const ge=()=>O(),M=()=>O(),G=()=>n(1,p=!0),U=()=>n(1,p=!1),be=(_,g)=>{g.currentTarget.releasePointerCapture(g.pointerId),j(_,.5)},ye=_=>{p&&j(_,.5)},Ne=_=>y(_),H=_=>y(_);function ve(_){mn[_?"unshift":"push"](()=>{i=_,n(3,i)})}return e.$$.update=()=>{e.$$.dirty[0]&1&&O(c)},[c,p,f,i,j,y,O,Q,me,pe,ge,M,G,U,be,ye,Ne,H,ve]}class Ln extends et{constructor(t){super();tt(this,t,qn,In,nt,{},null,[-1,-1])}}function zn(e){let t,n,o,l,s;return n=new On({}),l=new Ln({}),{c(){t=h("main"),Lt(n.$$.fragment),o=k(),Lt(l.$$.fragment),u(t,"class","svelte-ieeeet")},m(r,p){K(r,t,p),zt(n,t,null),a(t,o),zt(l,t,null),s=!0},p:P,i(r){s||(Rt(n.$$.fragment,r),Rt(l.$$.fragment,r),s=!0)},o(r){Ht(n.$$.fragment,r),Ht(l.$$.fragment,r),s=!1},d(r){r&&S(t),Gt(n),Gt(l)}}}class Rn extends et{constructor(t){super();tt(this,t,null,zn,nt,{})}}new Rn({target:document.body});

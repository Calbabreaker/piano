var si=Object.defineProperty;var oi=(t,e,n)=>e in t?si(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n;var U=(t,e,n)=>(oi(t,typeof e!="symbol"?e+"":e,n),n);(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))r(i);new MutationObserver(i=>{for(const s of i)if(s.type==="childList")for(const o of s.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&r(o)}).observe(document,{childList:!0,subtree:!0});function n(i){const s={};return i.integrity&&(s.integrity=i.integrity),i.referrerPolicy&&(s.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?s.credentials="include":i.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function r(i){if(i.ep)return;i.ep=!0;const s=n(i);fetch(i.href,s)}})();function D(){}function ai(t){return!!t&&(typeof t=="object"||typeof t=="function")&&typeof t.then=="function"}function _r(t){return t()}function jn(){return Object.create(null)}function Re(t){t.forEach(_r)}function bn(t){return typeof t=="function"}function Vt(t,e){return t!=t?e==e:t!==e||t&&typeof t=="object"||typeof t=="function"}let It;function kr(t,e){return It||(It=document.createElement("a")),It.href=e,t===It.href}function ci(t){return Object.keys(t).length===0}function wr(t,...e){if(t==null){for(const r of e)r(void 0);return D}const n=t.subscribe(...e);return n.unsubscribe?()=>n.unsubscribe():n}function Se(t){let e;return wr(t,n=>e=n)(),e}function z(t,e,n){t.$$.on_destroy.push(wr(e,n))}function Q(t,e,n){return t.set(n),e}function ui(t){return t&&bn(t.destroy)?t.destroy:D}function y(t,e){t.appendChild(e)}function q(t,e,n){t.insertBefore(e,n||null)}function R(t){t.parentNode&&t.parentNode.removeChild(t)}function vn(t,e){for(let n=0;n<t.length;n+=1)t[n]&&t[n].d(e)}function _(t){return document.createElement(t)}function be(t){return document.createTextNode(t)}function A(){return be(" ")}function Tr(){return be("")}function N(t,e,n,r){return t.addEventListener(e,n,r),()=>t.removeEventListener(e,n,r)}function li(t){return function(e){return e.preventDefault(),t.call(this,e)}}function b(t,e,n){n==null?t.removeAttribute(e):t.getAttribute(e)!==n&&t.setAttribute(e,n)}function Ee(t){return t===""?null:+t}function hi(t){return Array.from(t.childNodes)}function Rt(t,e){e=""+e,t.data!==e&&(t.data=e)}function j(t,e){t.value=e??""}function Ze(t,e,n,r){n==null?t.style.removeProperty(e):t.style.setProperty(e,n,r?"important":"")}function Ct(t,e,n){for(let r=0;r<t.options.length;r+=1){const i=t.options[r];if(i.__value===e){i.selected=!0;return}}(!n||e!==void 0)&&(t.selectedIndex=-1)}function Kn(t){const e=t.querySelector(":checked");return e&&e.__value}function Hn(t,e,n){t.classList.toggle(e,!!n)}let ut;function Ne(t){ut=t}function Sr(){if(!ut)throw new Error("Function called outside component initialization");return ut}function fi(t){Sr().$$.on_mount.push(t)}function di(t,e){const n=t.$$.callbacks[e.type];n&&n.slice().forEach(r=>r.call(this,e))}const Xe=[],cn=[];let et=[];const Jn=[],pi=Promise.resolve();let un=!1;function mi(){un||(un=!0,pi.then(_n))}function lt(t){et.push(t)}const Zt=new Set;let ze=0;function _n(){if(ze!==0)return;const t=ut;do{try{for(;ze<Xe.length;){const e=Xe[ze];ze++,Ne(e),yi(e.$$)}}catch(e){throw Xe.length=0,ze=0,e}for(Ne(null),Xe.length=0,ze=0;cn.length;)cn.pop()();for(let e=0;e<et.length;e+=1){const n=et[e];Zt.has(n)||(Zt.add(n),n())}et.length=0}while(Xe.length);for(;Jn.length;)Jn.pop()();un=!1,Zt.clear(),Ne(t)}function yi(t){if(t.fragment!==null){t.update(),Re(t.before_update);const e=t.dirty;t.dirty=[-1],t.fragment&&t.fragment.p(t.ctx,e),t.after_update.forEach(lt)}}function gi(t){const e=[],n=[];et.forEach(r=>t.indexOf(r)===-1?e.push(r):n.push(r)),n.forEach(r=>r()),et=e}const Bt=new Set;let Le;function bi(){Le={r:0,c:[],p:Le}}function vi(){Le.r||Re(Le.c),Le=Le.p}function Dt(t,e){t&&t.i&&(Bt.delete(t),t.i(e))}function ln(t,e,n,r){if(t&&t.o){if(Bt.has(t))return;Bt.add(t),Le.c.push(()=>{Bt.delete(t),r&&(n&&t.d(1),r())}),t.o(e)}else r&&r()}function zn(t,e){const n=e.token={};function r(i,s,o,a){if(e.token!==n)return;e.resolved=a;let u=e.ctx;o!==void 0&&(u=u.slice(),u[o]=a);const c=i&&(e.current=i)(u);let p=!1;e.block&&(e.blocks?e.blocks.forEach((f,l)=>{l!==s&&f&&(bi(),ln(f,1,1,()=>{e.blocks[l]===f&&(e.blocks[l]=null)}),vi())}):e.block.d(1),c.c(),Dt(c,1),c.m(e.mount(),e.anchor),p=!0),e.block=c,e.blocks&&(e.blocks[s]=c),p&&_n()}if(ai(t)){const i=Sr();if(t.then(s=>{Ne(i),r(e.then,1,e.value,s),Ne(null)},s=>{if(Ne(i),r(e.catch,2,e.error,s),Ne(null),!e.hasCatch)throw s}),e.current!==e.pending)return r(e.pending,0),!0}else{if(e.current!==e.then)return r(e.then,1,e.value,t),!0;e.resolved=t}}function _i(t,e,n){const r=e.slice(),{resolved:i}=t;t.current===t.then&&(r[t.value]=i),t.current===t.catch&&(r[t.error]=i),t.block.p(r,n)}function tt(t){return(t==null?void 0:t.length)!==void 0?t:Array.from(t)}function Gn(t){t&&t.c()}function hn(t,e,n){const{fragment:r,after_update:i}=t.$$;r&&r.m(e,n),lt(()=>{const s=t.$$.on_mount.map(_r).filter(bn);t.$$.on_destroy?t.$$.on_destroy.push(...s):Re(s),t.$$.on_mount=[]}),i.forEach(lt)}function fn(t,e){const n=t.$$;n.fragment!==null&&(gi(n.after_update),Re(n.on_destroy),n.fragment&&n.fragment.d(e),n.on_destroy=n.fragment=null,n.ctx=[])}function ki(t,e){t.$$.dirty[0]===-1&&(Xe.push(t),mi(),t.$$.dirty.fill(0)),t.$$.dirty[e/31|0]|=1<<e%31}function kn(t,e,n,r,i,s,o,a=[-1]){const u=ut;Ne(t);const c=t.$$={fragment:null,ctx:[],props:s,update:D,not_equal:i,bound:jn(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(e.context||(u?u.$$.context:[])),callbacks:jn(),dirty:a,skip_bound:!1,root:e.target||u.$$.root};o&&o(c.root);let p=!1;if(c.ctx=n?n(t,e.props||{},(f,l,...h)=>{const d=h.length?h[0]:l;return c.ctx&&i(c.ctx[f],c.ctx[f]=d)&&(!c.skip_bound&&c.bound[f]&&c.bound[f](d),p&&ki(t,f)),l}):[],c.update(),p=!0,Re(c.before_update),c.fragment=r?r(c.ctx):!1,e.target){if(e.hydrate){const f=hi(e.target);c.fragment&&c.fragment.l(f),f.forEach(R)}else c.fragment&&c.fragment.c();e.intro&&Dt(t.$$.fragment),hn(t,e.target,e.anchor),_n()}Ne(u)}class wn{constructor(){U(this,"$$");U(this,"$$set")}$destroy(){fn(this,1),this.$destroy=D}$on(e,n){if(!bn(n))return D;const r=this.$$.callbacks[e]||(this.$$.callbacks[e]=[]);return r.push(n),()=>{const i=r.indexOf(n);i!==-1&&r.splice(i,1)}}$set(e){this.$$set&&!ci(e)&&(this.$$.skip_bound=!0,this.$$set(e),this.$$.skip_bound=!1)}}const wi="4";typeof window<"u"&&(window.__svelte||(window.__svelte={v:new Set})).v.add(wi);const Ge=[];function te(t,e=D){let n;const r=new Set;function i(a){if(Vt(t,a)&&(t=a,n)){const u=!Ge.length;for(const c of r)c[1](),Ge.push(c,t);if(u){for(let c=0;c<Ge.length;c+=2)Ge[c][0](Ge[c+1]);Ge.length=0}}}function s(a){i(a(t))}function o(a,u=D){const c=[a,u];return r.add(c),r.size===1&&(n=e(i,s)||D),a(t),()=>{r.delete(c),r.size===0&&n&&(n(),n=null)}}return{set:i,update:s,subscribe:o}}const Wn=["accordion","acoustic_bass","acoustic_grand_piano","acoustic_guitar_nylon","acoustic_guitar_steel","agogo","alto_sax","applause","bagpipe","banjo","baritone_sax","bassoon","bird_tweet","blown_bottle","brass_section","breath_noise","bright_acoustic_piano","celesta","cello","choir_aahs","church_organ","clarinet","clavinet","contrabass","distortion_guitar","drawbar_organ","dulcimer","electric_bass_finger","electric_bass_pick","electric_grand_piano","electric_guitar_clean","electric_guitar_jazz","electric_guitar_muted","electric_piano_1","electric_piano_2","english_horn","fiddle","flute","french_horn","fretless_bass","fx_1_rain","fx_2_soundtrack","fx_3_crystal","fx_4_atmosphere","fx_5_brightness","fx_6_goblins","fx_7_echoes","fx_8_scifi","glockenspiel","guitar_fret_noise","guitar_harmonics","gunshot","harmonica","harpsichord","helicopter","honkytonk_piano","kalimba","koto","lead_1_square","lead_2_sawtooth","lead_3_calliope","lead_4_chiff","lead_5_charang","lead_6_voice","lead_7_fifths","lead_8_bass__lead","marimba","melodic_tom","music_box","muted_trumpet","oboe","ocarina","orchestra_hit","orchestral_harp","overdriven_guitar","pad_1_new_age","pad_2_warm","pad_3_polysynth","pad_4_choir","pad_5_bowed","pad_6_metallic","pad_7_halo","pad_8_sweep","pan_flute","percussive_organ","piccolo","pizzicato_strings","recorder","reed_organ","reverse_cymbal","rock_organ","seashore","shakuhachi","shamisen","shanai","sitar","slap_bass_1","slap_bass_2","soprano_sax","steel_drums","string_ensemble_1","string_ensemble_2","synth_bass_1","synth_bass_2","synth_brass_1","synth_brass_2","synth_choir","synth_drum","synth_strings_1","synth_strings_2","taiko_drum","tango_accordion","telephone_ring","tenor_sax","timpani","tinkle_bell","tremolo_strings","trombone","trumpet","tuba","tubular_bells","vibraphone","viola","violin","voice_oohs","whistle","woodblock","xylophone"];var $e=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function Ir(t){if(t.__esModule)return t;var e=t.default;if(typeof e=="function"){var n=function r(){if(this instanceof r){var i=[null];i.push.apply(i,arguments);var s=Function.bind.apply(e,i);return new s}return e.apply(this,arguments)};n.prototype=e.prototype}else n={};return Object.defineProperty(n,"__esModule",{value:!0}),Object.keys(t).forEach(function(r){var i=Object.getOwnPropertyDescriptor(t,r);Object.defineProperty(n,r,i.get?i:{enumerable:!0,get:function(){return t[r]}})}),n}var Cr={},jt={};function Ti(t){var e=new ne(t),n=e.readChunk();if(n.id!="MThd")throw"Bad MIDI file.  Expected 'MHdr', got: '"+n.id+"'";for(var r=Si(n.data),i=[],s=0;!e.eof()&&s<r.numTracks;s++){var o=e.readChunk();if(o.id!="MTrk")throw"Bad MIDI file.  Expected 'MTrk', got: '"+o.id+"'";var a=Ii(o.data);i.push(a)}return{header:r,tracks:i}}function Si(t){var e=new ne(t),n=e.readUInt16(),r=e.readUInt16(),i={format:n,numTracks:r},s=e.readUInt16();return s&32768?(i.framesPerSecond=256-(s>>8),i.ticksPerFrame=s&255):i.ticksPerBeat=s,i}function Ii(t){for(var e=new ne(t),n=[];!e.eof();){var r=s();n.push(r)}return n;var i;function s(){var o={};o.deltaTime=e.readVarInt();var a=e.readUInt8();if((a&240)===240)if(a===255){o.meta=!0;var u=e.readUInt8(),c=e.readVarInt();switch(u){case 0:if(o.type="sequenceNumber",c!==2)throw"Expected length for sequenceNumber event is 2, got "+c;return o.number=e.readUInt16(),o;case 1:return o.type="text",o.text=e.readString(c),o;case 2:return o.type="copyrightNotice",o.text=e.readString(c),o;case 3:return o.type="trackName",o.text=e.readString(c),o;case 4:return o.type="instrumentName",o.text=e.readString(c),o;case 5:return o.type="lyrics",o.text=e.readString(c),o;case 6:return o.type="marker",o.text=e.readString(c),o;case 7:return o.type="cuePoint",o.text=e.readString(c),o;case 32:if(o.type="channelPrefix",c!=1)throw"Expected length for channelPrefix event is 1, got "+c;return o.channel=e.readUInt8(),o;case 33:if(o.type="portPrefix",c!=1)throw"Expected length for portPrefix event is 1, got "+c;return o.port=e.readUInt8(),o;case 47:if(o.type="endOfTrack",c!=0)throw"Expected length for endOfTrack event is 0, got "+c;return o;case 81:if(o.type="setTempo",c!=3)throw"Expected length for setTempo event is 3, got "+c;return o.microsecondsPerBeat=e.readUInt24(),o;case 84:if(o.type="smpteOffset",c!=5)throw"Expected length for smpteOffset event is 5, got "+c;var p=e.readUInt8(),f={0:24,32:25,64:29,96:30};return o.frameRate=f[p&96],o.hour=p&31,o.min=e.readUInt8(),o.sec=e.readUInt8(),o.frame=e.readUInt8(),o.subFrame=e.readUInt8(),o;case 88:if(o.type="timeSignature",c!=2&&c!=4)throw"Expected length for timeSignature event is 4 or 2, got "+c;return o.numerator=e.readUInt8(),o.denominator=1<<e.readUInt8(),c===4?(o.metronome=e.readUInt8(),o.thirtyseconds=e.readUInt8()):(o.metronome=36,o.thirtyseconds=8),o;case 89:if(o.type="keySignature",c!=2)throw"Expected length for keySignature event is 2, got "+c;return o.key=e.readInt8(),o.scale=e.readUInt8(),o;case 127:return o.type="sequencerSpecific",o.data=e.readBytes(c),o;default:return o.type="unknownMeta",o.data=e.readBytes(c),o.metatypeByte=u,o}}else if(a==240){o.type="sysEx";var c=e.readVarInt();return o.data=e.readBytes(c),o}else if(a==247){o.type="endSysEx";var c=e.readVarInt();return o.data=e.readBytes(c),o}else throw"Unrecognised MIDI event type byte: "+a;else{var l;if(a&128)l=e.readUInt8(),i=a;else{if(i===null)throw"Running status byte encountered before status byte";l=a,a=i,o.running=!0}var h=a>>4;switch(o.channel=a&15,h){case 8:return o.type="noteOff",o.noteNumber=l,o.velocity=e.readUInt8(),o;case 9:var d=e.readUInt8();return o.type=d===0?"noteOff":"noteOn",o.noteNumber=l,o.velocity=d,d===0&&(o.byte9=!0),o;case 10:return o.type="noteAftertouch",o.noteNumber=l,o.amount=e.readUInt8(),o;case 11:return o.type="controller",o.controllerType=l,o.value=e.readUInt8(),o;case 12:return o.type="programChange",o.programNumber=l,o;case 13:return o.type="channelAftertouch",o.amount=l,o;case 14:return o.type="pitchBend",o.value=l+(e.readUInt8()<<7)-8192,o;default:throw"Unrecognised MIDI event type: "+h}}}}function ne(t){this.buffer=t,this.bufferLen=this.buffer.length,this.pos=0}ne.prototype.eof=function(){return this.pos>=this.bufferLen};ne.prototype.readUInt8=function(){var t=this.buffer[this.pos];return this.pos+=1,t};ne.prototype.readInt8=function(){var t=this.readUInt8();return t&128?t-256:t};ne.prototype.readUInt16=function(){var t=this.readUInt8(),e=this.readUInt8();return(t<<8)+e};ne.prototype.readInt16=function(){var t=this.readUInt16();return t&32768?t-65536:t};ne.prototype.readUInt24=function(){var t=this.readUInt8(),e=this.readUInt8(),n=this.readUInt8();return(t<<16)+(e<<8)+n};ne.prototype.readInt24=function(){var t=this.readUInt24();return t&8388608?t-16777216:t};ne.prototype.readUInt32=function(){var t=this.readUInt8(),e=this.readUInt8(),n=this.readUInt8(),r=this.readUInt8();return(t<<24)+(e<<16)+(n<<8)+r};ne.prototype.readBytes=function(t){var e=this.buffer.slice(this.pos,this.pos+t);return this.pos+=t,e};ne.prototype.readString=function(t){var e=this.readBytes(t);return String.fromCharCode.apply(null,e)};ne.prototype.readVarInt=function(){for(var t=0;!this.eof();){var e=this.readUInt8();if(e&128)t+=e&127,t<<=7;else return t+e}return t};ne.prototype.readChunk=function(){var t=this.readString(4),e=this.readUInt32(),n=this.readBytes(e);return{id:t,length:e,data:n}};var Ci=Ti;function xi(t,e){if(typeof t!="object")throw"Invalid MIDI data";e=e||{};var n=t.header||{},r=t.tracks||[],i,s=r.length,o=new G;for(Ei(o,n,s),i=0;i<s;i++)Ni(o,r[i],e);return o.buffer}function Ei(t,e,n){var r=e.format==null?1:e.format,i=128;e.timeDivision?i=e.timeDivision:e.ticksPerFrame&&e.framesPerSecond?i=-(e.framesPerSecond&255)<<8|e.ticksPerFrame&255:e.ticksPerBeat&&(i=e.ticksPerBeat&32767);var s=new G;s.writeUInt16(r),s.writeUInt16(n),s.writeUInt16(i),t.writeChunk("MThd",s.buffer)}function Ni(t,e,n){var r=new G,i,s=e.length,o=null;for(i=0;i<s;i++)(n.running===!1||!n.running&&!e[i].running)&&(o=null),o=Oi(r,e[i],o,n.useByte9ForNoteOff);t.writeChunk("MTrk",r.buffer)}function Oi(t,e,n,r){var i=e.type,s=e.deltaTime,o=e.text||"",a=e.data||[],u=null;switch(t.writeVarInt(s),i){case"sequenceNumber":t.writeUInt8(255),t.writeUInt8(0),t.writeVarInt(2),t.writeUInt16(e.number);break;case"text":t.writeUInt8(255),t.writeUInt8(1),t.writeVarInt(o.length),t.writeString(o);break;case"copyrightNotice":t.writeUInt8(255),t.writeUInt8(2),t.writeVarInt(o.length),t.writeString(o);break;case"trackName":t.writeUInt8(255),t.writeUInt8(3),t.writeVarInt(o.length),t.writeString(o);break;case"instrumentName":t.writeUInt8(255),t.writeUInt8(4),t.writeVarInt(o.length),t.writeString(o);break;case"lyrics":t.writeUInt8(255),t.writeUInt8(5),t.writeVarInt(o.length),t.writeString(o);break;case"marker":t.writeUInt8(255),t.writeUInt8(6),t.writeVarInt(o.length),t.writeString(o);break;case"cuePoint":t.writeUInt8(255),t.writeUInt8(7),t.writeVarInt(o.length),t.writeString(o);break;case"channelPrefix":t.writeUInt8(255),t.writeUInt8(32),t.writeVarInt(1),t.writeUInt8(e.channel);break;case"portPrefix":t.writeUInt8(255),t.writeUInt8(33),t.writeVarInt(1),t.writeUInt8(e.port);break;case"endOfTrack":t.writeUInt8(255),t.writeUInt8(47),t.writeVarInt(0);break;case"setTempo":t.writeUInt8(255),t.writeUInt8(81),t.writeVarInt(3),t.writeUInt24(e.microsecondsPerBeat);break;case"smpteOffset":t.writeUInt8(255),t.writeUInt8(84),t.writeVarInt(5);var c={24:0,25:32,29:64,30:96},p=e.hour&31|c[e.frameRate];t.writeUInt8(p),t.writeUInt8(e.min),t.writeUInt8(e.sec),t.writeUInt8(e.frame),t.writeUInt8(e.subFrame);break;case"timeSignature":t.writeUInt8(255),t.writeUInt8(88),t.writeVarInt(4),t.writeUInt8(e.numerator);var f=Math.floor(Math.log(e.denominator)/Math.LN2)&255;t.writeUInt8(f),t.writeUInt8(e.metronome),t.writeUInt8(e.thirtyseconds||8);break;case"keySignature":t.writeUInt8(255),t.writeUInt8(89),t.writeVarInt(2),t.writeInt8(e.key),t.writeUInt8(e.scale);break;case"sequencerSpecific":t.writeUInt8(255),t.writeUInt8(127),t.writeVarInt(a.length),t.writeBytes(a);break;case"unknownMeta":e.metatypeByte!=null&&(t.writeUInt8(255),t.writeUInt8(e.metatypeByte),t.writeVarInt(a.length),t.writeBytes(a));break;case"sysEx":t.writeUInt8(240),t.writeVarInt(a.length),t.writeBytes(a);break;case"endSysEx":t.writeUInt8(247),t.writeVarInt(a.length),t.writeBytes(a);break;case"noteOff":var l=r!==!1&&e.byte9||r&&e.velocity==0?144:128;u=l|e.channel,u!==n&&t.writeUInt8(u),t.writeUInt8(e.noteNumber),t.writeUInt8(e.velocity);break;case"noteOn":u=144|e.channel,u!==n&&t.writeUInt8(u),t.writeUInt8(e.noteNumber),t.writeUInt8(e.velocity);break;case"noteAftertouch":u=160|e.channel,u!==n&&t.writeUInt8(u),t.writeUInt8(e.noteNumber),t.writeUInt8(e.amount);break;case"controller":u=176|e.channel,u!==n&&t.writeUInt8(u),t.writeUInt8(e.controllerType),t.writeUInt8(e.value);break;case"programChange":u=192|e.channel,u!==n&&t.writeUInt8(u),t.writeUInt8(e.programNumber);break;case"channelAftertouch":u=208|e.channel,u!==n&&t.writeUInt8(u),t.writeUInt8(e.amount);break;case"pitchBend":u=224|e.channel,u!==n&&t.writeUInt8(u);var h=8192+e.value,d=h&127,m=h>>7&127;t.writeUInt8(d),t.writeUInt8(m);break;default:throw"Unrecognized event type: "+i}return u}function G(){this.buffer=[]}G.prototype.writeUInt8=function(t){this.buffer.push(t&255)};G.prototype.writeInt8=G.prototype.writeUInt8;G.prototype.writeUInt16=function(t){var e=t>>8&255,n=t&255;this.writeUInt8(e),this.writeUInt8(n)};G.prototype.writeInt16=G.prototype.writeUInt16;G.prototype.writeUInt24=function(t){var e=t>>16&255,n=t>>8&255,r=t&255;this.writeUInt8(e),this.writeUInt8(n),this.writeUInt8(r)};G.prototype.writeInt24=G.prototype.writeUInt24;G.prototype.writeUInt32=function(t){var e=t>>24&255,n=t>>16&255,r=t>>8&255,i=t&255;this.writeUInt8(e),this.writeUInt8(n),this.writeUInt8(r),this.writeUInt8(i)};G.prototype.writeInt32=G.prototype.writeUInt32;G.prototype.writeBytes=function(t){this.buffer=this.buffer.concat(Array.prototype.slice.call(t,0))};G.prototype.writeString=function(t){var e,n=t.length,r=[];for(e=0;e<n;e++)r.push(t.codePointAt(e));this.writeBytes(r)};G.prototype.writeVarInt=function(t){if(t<0)throw"Cannot write negative variable-length integer";if(t<=127)this.writeUInt8(t);else{var e=t,n=[];for(n.push(e&127),e>>=7;e;){var r=e&127|128;n.push(r),e>>=7}this.writeBytes(n.reverse())}};G.prototype.writeChunk=function(t,e){this.writeString(t),this.writeUInt32(e.length),this.writeBytes(e)};var Pi=xi;jt.parseMidi=Ci;jt.writeMidi=Pi;var Lt={},qe={};Object.defineProperty(qe,"__esModule",{value:!0});qe.insert=qe.search=void 0;function xr(t,e,n){n===void 0&&(n="ticks");var r=0,i=t.length,s=i;if(i>0&&t[i-1][n]<=e)return i-1;for(;r<s;){var o=Math.floor(r+(s-r)/2),a=t[o],u=t[o+1];if(a[n]===e){for(var c=o;c<t.length;c++){var p=t[c];p[n]===e&&(o=c)}return o}else{if(a[n]<e&&u[n]>e)return o;a[n]>e?s=o:a[n]<e&&(r=o+1)}}return-1}qe.search=xr;function Ai(t,e,n){if(n===void 0&&(n="ticks"),t.length){var r=xr(t,e[n],n);t.splice(r+1,0,e)}else t.push(e)}qe.insert=Ai;(function(t){Object.defineProperty(t,"__esModule",{value:!0}),t.Header=t.keySignatureKeys=void 0;var e=qe,n=new WeakMap;t.keySignatureKeys=["Cb","Gb","Db","Ab","Eb","Bb","F","C","G","D","A","E","B","F#","C#"];var r=function(){function i(s){var o=this;if(this.tempos=[],this.timeSignatures=[],this.keySignatures=[],this.meta=[],this.name="",n.set(this,480),s){n.set(this,s.header.ticksPerBeat),s.tracks.forEach(function(u){u.forEach(function(c){c.meta&&(c.type==="timeSignature"?o.timeSignatures.push({ticks:c.absoluteTime,timeSignature:[c.numerator,c.denominator]}):c.type==="setTempo"?o.tempos.push({bpm:6e7/c.microsecondsPerBeat,ticks:c.absoluteTime}):c.type==="keySignature"&&o.keySignatures.push({key:t.keySignatureKeys[c.key+7],scale:c.scale===0?"major":"minor",ticks:c.absoluteTime}))})});var a=0;s.tracks[0].forEach(function(u){a+=u.deltaTime,u.meta&&(u.type==="trackName"?o.name=u.text:(u.type==="text"||u.type==="cuePoint"||u.type==="marker"||u.type==="lyrics")&&o.meta.push({text:u.text,ticks:a,type:u.type}))}),this.update()}}return i.prototype.update=function(){var s=this,o=0,a=0;this.tempos.sort(function(u,c){return u.ticks-c.ticks}),this.tempos.forEach(function(u,c){var p=c>0?s.tempos[c-1].bpm:s.tempos[0].bpm,f=u.ticks/s.ppq-a,l=60/p*f;u.time=l+o,o=u.time,a+=f}),this.timeSignatures.sort(function(u,c){return u.ticks-c.ticks}),this.timeSignatures.forEach(function(u,c){var p=c>0?s.timeSignatures[c-1]:s.timeSignatures[0],f=(u.ticks-p.ticks)/s.ppq,l=f/p.timeSignature[0]/(p.timeSignature[1]/4);p.measures=p.measures||0,u.measures=l+p.measures})},i.prototype.ticksToSeconds=function(s){var o=(0,e.search)(this.tempos,s);if(o!==-1){var a=this.tempos[o],u=a.time,c=(s-a.ticks)/this.ppq;return u+60/a.bpm*c}else{var p=s/this.ppq;return 60/120*p}},i.prototype.ticksToMeasures=function(s){var o=(0,e.search)(this.timeSignatures,s);if(o!==-1){var a=this.timeSignatures[o],u=(s-a.ticks)/this.ppq;return a.measures+u/(a.timeSignature[0]/a.timeSignature[1])/4}else return s/this.ppq/4},Object.defineProperty(i.prototype,"ppq",{get:function(){return n.get(this)},enumerable:!1,configurable:!0}),i.prototype.secondsToTicks=function(s){var o=(0,e.search)(this.tempos,s,"time");if(o!==-1){var a=this.tempos[o],u=a.time,c=s-u,p=c/(60/a.bpm);return Math.round(a.ticks+p*this.ppq)}else{var f=s/.5;return Math.round(f*this.ppq)}},i.prototype.toJSON=function(){return{keySignatures:this.keySignatures,meta:this.meta,name:this.name,ppq:this.ppq,tempos:this.tempos.map(function(s){return{bpm:s.bpm,ticks:s.ticks}}),timeSignatures:this.timeSignatures}},i.prototype.fromJSON=function(s){this.name=s.name,this.tempos=s.tempos.map(function(o){return Object.assign({},o)}),this.timeSignatures=s.timeSignatures.map(function(o){return Object.assign({},o)}),this.keySignatures=s.keySignatures.map(function(o){return Object.assign({},o)}),this.meta=s.meta.map(function(o){return Object.assign({},o)}),n.set(this,s.ppq),this.update()},i.prototype.setTempo=function(s){this.tempos=[{bpm:s,ticks:0}],this.update()},i}();t.Header=r})(Lt);var ht={},Tn={};(function(t){Object.defineProperty(t,"__esModule",{value:!0}),t.ControlChange=t.controlChangeIds=t.controlChangeNames=void 0,t.controlChangeNames={1:"modulationWheel",2:"breath",4:"footController",5:"portamentoTime",7:"volume",8:"balance",10:"pan",64:"sustain",65:"portamentoTime",66:"sostenuto",67:"softPedal",68:"legatoFootswitch",84:"portamentoControl"},t.controlChangeIds=Object.keys(t.controlChangeNames).reduce(function(i,s){return i[t.controlChangeNames[s]]=s,i},{});var e=new WeakMap,n=new WeakMap,r=function(){function i(s,o){e.set(this,o),n.set(this,s.controllerType),this.ticks=s.absoluteTime,this.value=s.value}return Object.defineProperty(i.prototype,"number",{get:function(){return n.get(this)},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"name",{get:function(){return t.controlChangeNames[this.number]?t.controlChangeNames[this.number]:null},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"time",{get:function(){var s=e.get(this);return s.ticksToSeconds(this.ticks)},set:function(s){var o=e.get(this);this.ticks=o.secondsToTicks(s)},enumerable:!1,configurable:!0}),i.prototype.toJSON=function(){return{number:this.number,ticks:this.ticks,time:this.time,value:this.value}},i}();t.ControlChange=r})(Tn);var Kt={};Object.defineProperty(Kt,"__esModule",{value:!0});Kt.createControlChanges=void 0;var xt=Tn;function Bi(){return new Proxy({},{get:function(t,e){if(t[e])return t[e];if(xt.controlChangeIds.hasOwnProperty(e))return t[xt.controlChangeIds[e]]},set:function(t,e,n){return xt.controlChangeIds.hasOwnProperty(e)?t[xt.controlChangeIds[e]]=n:t[e]=n,!0}})}Kt.createControlChanges=Bi;var Ht={};Object.defineProperty(Ht,"__esModule",{value:!0});Ht.PitchBend=void 0;var en=new WeakMap,Ui=function(){function t(e,n){en.set(this,n),this.ticks=e.absoluteTime,this.value=e.value}return Object.defineProperty(t.prototype,"time",{get:function(){var e=en.get(this);return e.ticksToSeconds(this.ticks)},set:function(e){var n=en.get(this);this.ticks=n.secondsToTicks(e)},enumerable:!1,configurable:!0}),t.prototype.toJSON=function(){return{ticks:this.ticks,time:this.time,value:this.value}},t}();Ht.PitchBend=Ui;var Jt={},Fe={};Object.defineProperty(Fe,"__esModule",{value:!0});Fe.DrumKitByPatchID=Fe.InstrumentFamilyByID=Fe.instrumentByPatchID=void 0;Fe.instrumentByPatchID=["acoustic grand piano","bright acoustic piano","electric grand piano","honky-tonk piano","electric piano 1","electric piano 2","harpsichord","clavi","celesta","glockenspiel","music box","vibraphone","marimba","xylophone","tubular bells","dulcimer","drawbar organ","percussive organ","rock organ","church organ","reed organ","accordion","harmonica","tango accordion","acoustic guitar (nylon)","acoustic guitar (steel)","electric guitar (jazz)","electric guitar (clean)","electric guitar (muted)","overdriven guitar","distortion guitar","guitar harmonics","acoustic bass","electric bass (finger)","electric bass (pick)","fretless bass","slap bass 1","slap bass 2","synth bass 1","synth bass 2","violin","viola","cello","contrabass","tremolo strings","pizzicato strings","orchestral harp","timpani","string ensemble 1","string ensemble 2","synthstrings 1","synthstrings 2","choir aahs","voice oohs","synth voice","orchestra hit","trumpet","trombone","tuba","muted trumpet","french horn","brass section","synthbrass 1","synthbrass 2","soprano sax","alto sax","tenor sax","baritone sax","oboe","english horn","bassoon","clarinet","piccolo","flute","recorder","pan flute","blown bottle","shakuhachi","whistle","ocarina","lead 1 (square)","lead 2 (sawtooth)","lead 3 (calliope)","lead 4 (chiff)","lead 5 (charang)","lead 6 (voice)","lead 7 (fifths)","lead 8 (bass + lead)","pad 1 (new age)","pad 2 (warm)","pad 3 (polysynth)","pad 4 (choir)","pad 5 (bowed)","pad 6 (metallic)","pad 7 (halo)","pad 8 (sweep)","fx 1 (rain)","fx 2 (soundtrack)","fx 3 (crystal)","fx 4 (atmosphere)","fx 5 (brightness)","fx 6 (goblins)","fx 7 (echoes)","fx 8 (sci-fi)","sitar","banjo","shamisen","koto","kalimba","bag pipe","fiddle","shanai","tinkle bell","agogo","steel drums","woodblock","taiko drum","melodic tom","synth drum","reverse cymbal","guitar fret noise","breath noise","seashore","bird tweet","telephone ring","helicopter","applause","gunshot"];Fe.InstrumentFamilyByID=["piano","chromatic percussion","organ","guitar","bass","strings","ensemble","brass","reed","pipe","synth lead","synth pad","synth effects","world","percussive","sound effects"];Fe.DrumKitByPatchID={0:"standard kit",8:"room kit",16:"power kit",24:"electronic kit",25:"tr-808 kit",32:"jazz kit",40:"brush kit",48:"orchestra kit",56:"sound fx kit"};Object.defineProperty(Jt,"__esModule",{value:!0});Jt.Instrument=void 0;var Et=Fe,Yn=new WeakMap,Mi=function(){function t(e,n){if(this.number=0,Yn.set(this,n),this.number=0,e){var r=e.find(function(i){return i.type==="programChange"});r&&(this.number=r.programNumber)}}return Object.defineProperty(t.prototype,"name",{get:function(){return this.percussion?Et.DrumKitByPatchID[this.number]:Et.instrumentByPatchID[this.number]},set:function(e){var n=Et.instrumentByPatchID.indexOf(e);n!==-1&&(this.number=n)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"family",{get:function(){return this.percussion?"drums":Et.InstrumentFamilyByID[Math.floor(this.number/8)]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"percussion",{get:function(){var e=Yn.get(this);return e.channel===9},enumerable:!1,configurable:!0}),t.prototype.toJSON=function(){return{family:this.family,number:this.number,name:this.name}},t.prototype.fromJSON=function(e){this.number=e.number},t}();Jt.Instrument=Mi;var zt={};Object.defineProperty(zt,"__esModule",{value:!0});zt.Note=void 0;function Fi(t){var e=Math.floor(t/12)-1;return Er(t)+e.toString()}function Er(t){var e=["C","C#","D","D#","E","F","F#","G","G#","A","A#","B"],n=t%12;return e[n]}function Ri(t){var e=["C","C#","D","D#","E","F","F#","G","G#","A","A#","B"];return e.indexOf(t)}var Di=function(){var t=/^([a-g]{1}(?:b|#|x|bb)?)(-?[0-9]+)/i,e={cbb:-2,cb:-1,c:0,"c#":1,cx:2,dbb:0,db:1,d:2,"d#":3,dx:4,ebb:2,eb:3,e:4,"e#":5,ex:6,fbb:3,fb:4,f:5,"f#":6,fx:7,gbb:5,gb:6,g:7,"g#":8,gx:9,abb:7,ab:8,a:9,"a#":10,ax:11,bbb:9,bb:10,b:11,"b#":12,bx:13};return function(n){var r=t.exec(n),i=r[1],s=r[2],o=e[i.toLowerCase()];return o+(parseInt(s,10)+1)*12}}(),We=new WeakMap,Li=function(){function t(e,n,r){We.set(this,r),this.midi=e.midi,this.velocity=e.velocity,this.noteOffVelocity=n.velocity,this.ticks=e.ticks,this.durationTicks=n.ticks-e.ticks}return Object.defineProperty(t.prototype,"name",{get:function(){return Fi(this.midi)},set:function(e){this.midi=Di(e)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"octave",{get:function(){return Math.floor(this.midi/12)-1},set:function(e){var n=e-this.octave;this.midi+=n*12},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"pitch",{get:function(){return Er(this.midi)},set:function(e){this.midi=12*(this.octave+1)+Ri(e)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"duration",{get:function(){var e=We.get(this);return e.ticksToSeconds(this.ticks+this.durationTicks)-e.ticksToSeconds(this.ticks)},set:function(e){var n=We.get(this),r=n.secondsToTicks(this.time+e);this.durationTicks=r-this.ticks},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"time",{get:function(){var e=We.get(this);return e.ticksToSeconds(this.ticks)},set:function(e){var n=We.get(this);this.ticks=n.secondsToTicks(e)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"bars",{get:function(){var e=We.get(this);return e.ticksToMeasures(this.ticks)},enumerable:!1,configurable:!0}),t.prototype.toJSON=function(){return{duration:this.duration,durationTicks:this.durationTicks,midi:this.midi,name:this.name,ticks:this.ticks,time:this.time,velocity:this.velocity}},t}();zt.Note=Li;Object.defineProperty(ht,"__esModule",{value:!0});ht.Track=void 0;var tn=qe,qi=Tn,Vi=Kt,ji=Ht,Xn=Jt,Ki=zt,Nt=new WeakMap,Hi=function(){function t(e,n){var r=this;if(this.name="",this.notes=[],this.controlChanges=(0,Vi.createControlChanges)(),this.pitchBends=[],Nt.set(this,n),e){var i=e.find(function(l){return l.type==="trackName"});this.name=i?i.text:""}if(this.instrument=new Xn.Instrument(e,this),this.channel=0,e){for(var s=e.filter(function(l){return l.type==="noteOn"}),o=e.filter(function(l){return l.type==="noteOff"}),a=function(){var l=s.shift();u.channel=l.channel;var h=o.findIndex(function(m){return m.noteNumber===l.noteNumber&&m.absoluteTime>=l.absoluteTime});if(h!==-1){var d=o.splice(h,1)[0];u.addNote({durationTicks:d.absoluteTime-l.absoluteTime,midi:l.noteNumber,noteOffVelocity:d.velocity/127,ticks:l.absoluteTime,velocity:l.velocity/127})}},u=this;s.length;)a();var c=e.filter(function(l){return l.type==="controller"});c.forEach(function(l){r.addCC({number:l.controllerType,ticks:l.absoluteTime,value:l.value/127})});var p=e.filter(function(l){return l.type==="pitchBend"});p.forEach(function(l){r.addPitchBend({ticks:l.absoluteTime,value:l.value/Math.pow(2,13)})});var f=e.find(function(l){return l.type==="endOfTrack"});this.endOfTrackTicks=f!==void 0?f.absoluteTime:void 0}}return t.prototype.addNote=function(e){var n=Nt.get(this),r=new Ki.Note({midi:0,ticks:0,velocity:1},{ticks:0,velocity:0},n);return Object.assign(r,e),(0,tn.insert)(this.notes,r,"ticks"),this},t.prototype.addCC=function(e){var n=Nt.get(this),r=new qi.ControlChange({controllerType:e.number},n);return delete e.number,Object.assign(r,e),Array.isArray(this.controlChanges[r.number])||(this.controlChanges[r.number]=[]),(0,tn.insert)(this.controlChanges[r.number],r,"ticks"),this},t.prototype.addPitchBend=function(e){var n=Nt.get(this),r=new ji.PitchBend({},n);return Object.assign(r,e),(0,tn.insert)(this.pitchBends,r,"ticks"),this},Object.defineProperty(t.prototype,"duration",{get:function(){if(!this.notes.length)return 0;for(var e=this.notes[this.notes.length-1].time+this.notes[this.notes.length-1].duration,n=0;n<this.notes.length-1;n++){var r=this.notes[n].time+this.notes[n].duration;e<r&&(e=r)}return e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"durationTicks",{get:function(){if(!this.notes.length)return 0;for(var e=this.notes[this.notes.length-1].ticks+this.notes[this.notes.length-1].durationTicks,n=0;n<this.notes.length-1;n++){var r=this.notes[n].ticks+this.notes[n].durationTicks;e<r&&(e=r)}return e},enumerable:!1,configurable:!0}),t.prototype.fromJSON=function(e){var n=this;this.name=e.name,this.channel=e.channel,this.instrument=new Xn.Instrument(void 0,this),this.instrument.fromJSON(e.instrument),e.endOfTrackTicks!==void 0&&(this.endOfTrackTicks=e.endOfTrackTicks);for(var r in e.controlChanges)e.controlChanges[r]&&e.controlChanges[r].forEach(function(i){n.addCC({number:i.number,ticks:i.ticks,value:i.value})});e.notes.forEach(function(i){n.addNote({durationTicks:i.durationTicks,midi:i.midi,ticks:i.ticks,velocity:i.velocity})})},t.prototype.toJSON=function(){for(var e={},n=0;n<127;n++)this.controlChanges.hasOwnProperty(n)&&(e[n]=this.controlChanges[n].map(function(i){return i.toJSON()}));var r={channel:this.channel,controlChanges:e,pitchBends:this.pitchBends.map(function(i){return i.toJSON()}),instrument:this.instrument.toJSON(),name:this.name,notes:this.notes.map(function(i){return i.toJSON()})};return this.endOfTrackTicks!==void 0&&(r.endOfTrackTicks=this.endOfTrackTicks),r},t}();ht.Track=Hi;var Gt={};function Ji(t){var e=[];return Nr(t,e),e}function Nr(t,e){for(var n=0;n<t.length;n++){var r=t[n];Array.isArray(r)?Nr(r,e):e.push(r)}}const zi=Object.freeze(Object.defineProperty({__proto__:null,flatten:Ji},Symbol.toStringTag,{value:"Module"})),Gi=Ir(zi);var Me=$e&&$e.__spreadArray||function(t,e,n){if(n||arguments.length===2)for(var r=0,i=e.length,s;r<i;r++)(s||!(r in e))&&(s||(s=Array.prototype.slice.call(e,0,r)),s[r]=e[r]);return t.concat(s||Array.prototype.slice.call(e))};Object.defineProperty(Gt,"__esModule",{value:!0});Gt.encode=void 0;var Wi=jt,Yi=Lt,Xi=Gi;function Qi(t,e){return[{absoluteTime:t.ticks,channel:e,deltaTime:0,noteNumber:t.midi,type:"noteOn",velocity:Math.floor(t.velocity*127)},{absoluteTime:t.ticks+t.durationTicks,channel:e,deltaTime:0,noteNumber:t.midi,type:"noteOff",velocity:Math.floor(t.noteOffVelocity*127)}]}function $i(t){return(0,Xi.flatten)(t.notes.map(function(e){return Qi(e,t.channel)}))}function Zi(t,e){return{absoluteTime:t.ticks,channel:e,controllerType:t.number,deltaTime:0,type:"controller",value:Math.floor(t.value*127)}}function es(t){for(var e=[],n=0;n<127;n++)t.controlChanges.hasOwnProperty(n)&&t.controlChanges[n].forEach(function(r){e.push(Zi(r,t.channel))});return e}function ts(t,e){return{absoluteTime:t.ticks,channel:e,deltaTime:0,type:"pitchBend",value:t.value}}function ns(t){var e=[];return t.pitchBends.forEach(function(n){e.push(ts(n,t.channel))}),e}function rs(t){return{absoluteTime:0,channel:t.channel,deltaTime:0,programNumber:t.instrument.number,type:"programChange"}}function is(t){return{absoluteTime:0,deltaTime:0,meta:!0,text:t,type:"trackName"}}function ss(t){return{absoluteTime:t.ticks,deltaTime:0,meta:!0,microsecondsPerBeat:Math.floor(6e7/t.bpm),type:"setTempo"}}function os(t){return{absoluteTime:t.ticks,deltaTime:0,denominator:t.timeSignature[1],meta:!0,metronome:24,numerator:t.timeSignature[0],thirtyseconds:8,type:"timeSignature"}}function as(t){var e=Yi.keySignatureKeys.indexOf(t.key);return{absoluteTime:t.ticks,deltaTime:0,key:e+7,meta:!0,scale:t.scale==="major"?0:1,type:"keySignature"}}function cs(t){return{absoluteTime:t.ticks,deltaTime:0,meta:!0,text:t.text,type:t.type}}function us(t){var e={header:{format:1,numTracks:t.tracks.length+1,ticksPerBeat:t.header.ppq},tracks:Me([Me(Me(Me(Me([{absoluteTime:0,deltaTime:0,meta:!0,text:t.header.name,type:"trackName"}],t.header.keySignatures.map(function(n){return as(n)}),!0),t.header.meta.map(function(n){return cs(n)}),!0),t.header.tempos.map(function(n){return ss(n)}),!0),t.header.timeSignatures.map(function(n){return os(n)}),!0)],t.tracks.map(function(n){return Me(Me(Me([is(n.name),rs(n)],$i(n),!0),es(n),!0),ns(n),!0)}),!0)};return e.tracks=e.tracks.map(function(n){n=n.sort(function(i,s){return i.absoluteTime-s.absoluteTime});var r=0;return n.forEach(function(i){i.deltaTime=i.absoluteTime-r,r=i.absoluteTime,delete i.absoluteTime}),n.push({deltaTime:0,meta:!0,type:"endOfTrack"}),n}),new Uint8Array((0,Wi.writeMidi)(e))}Gt.encode=us;(function(t){var e=$e&&$e.__awaiter||function(f,l,h,d){function m(v){return v instanceof h?v:new h(function(I){I(v)})}return new(h||(h=Promise))(function(v,I){function V(C){try{S(d.next(C))}catch(M){I(M)}}function x(C){try{S(d.throw(C))}catch(M){I(M)}}function S(C){C.done?v(C.value):m(C.value).then(V,x)}S((d=d.apply(f,l||[])).next())})},n=$e&&$e.__generator||function(f,l){var h={label:0,sent:function(){if(v[0]&1)throw v[1];return v[1]},trys:[],ops:[]},d,m,v,I;return I={next:V(0),throw:V(1),return:V(2)},typeof Symbol=="function"&&(I[Symbol.iterator]=function(){return this}),I;function V(S){return function(C){return x([S,C])}}function x(S){if(d)throw new TypeError("Generator is already executing.");for(;h;)try{if(d=1,m&&(v=S[0]&2?m.return:S[0]?m.throw||((v=m.return)&&v.call(m),0):m.next)&&!(v=v.call(m,S[1])).done)return v;switch(m=0,v&&(S=[S[0]&2,v.value]),S[0]){case 0:case 1:v=S;break;case 4:return h.label++,{value:S[1],done:!1};case 5:h.label++,m=S[1],S=[0];continue;case 7:S=h.ops.pop(),h.trys.pop();continue;default:if(v=h.trys,!(v=v.length>0&&v[v.length-1])&&(S[0]===6||S[0]===2)){h=0;continue}if(S[0]===3&&(!v||S[1]>v[0]&&S[1]<v[3])){h.label=S[1];break}if(S[0]===6&&h.label<v[1]){h.label=v[1],v=S;break}if(v&&h.label<v[2]){h.label=v[2],h.ops.push(S);break}v[2]&&h.ops.pop(),h.trys.pop();continue}S=l.call(f,h)}catch(C){S=[6,C],m=0}finally{d=v=0}if(S[0]&5)throw S[1];return{value:S[0]?S[1]:void 0,done:!0}}};Object.defineProperty(t,"__esModule",{value:!0}),t.Header=t.Track=t.Midi=void 0;var r=jt,i=Lt,s=ht,o=Gt,a=function(){function f(l){var h=this,d=null;if(l){var m=l instanceof ArrayBuffer?new Uint8Array(l):l;d=(0,r.parseMidi)(m),d.tracks.forEach(function(v){var I=0;v.forEach(function(V){I+=V.deltaTime,V.absoluteTime=I})}),d.tracks=p(d.tracks)}this.header=new i.Header(d),this.tracks=[],l&&(this.tracks=d.tracks.map(function(v){return new s.Track(v,h.header)}),d.header.format===1&&this.tracks[0].duration===0&&this.tracks.shift())}return f.fromUrl=function(l){return e(this,void 0,void 0,function(){var h,d;return n(this,function(m){switch(m.label){case 0:return[4,fetch(l)];case 1:return h=m.sent(),h.ok?[4,h.arrayBuffer()]:[3,3];case 2:return d=m.sent(),[2,new f(d)];case 3:throw new Error("Could not load '".concat(l,"'"))}})})},Object.defineProperty(f.prototype,"name",{get:function(){return this.header.name},set:function(l){this.header.name=l},enumerable:!1,configurable:!0}),Object.defineProperty(f.prototype,"duration",{get:function(){var l=this.tracks.map(function(h){return h.duration});return Math.max.apply(Math,l)},enumerable:!1,configurable:!0}),Object.defineProperty(f.prototype,"durationTicks",{get:function(){var l=this.tracks.map(function(h){return h.durationTicks});return Math.max.apply(Math,l)},enumerable:!1,configurable:!0}),f.prototype.addTrack=function(){var l=new s.Track(void 0,this.header);return this.tracks.push(l),l},f.prototype.toArray=function(){return(0,o.encode)(this)},f.prototype.toJSON=function(){return{header:this.header.toJSON(),tracks:this.tracks.map(function(l){return l.toJSON()})}},f.prototype.fromJSON=function(l){var h=this;this.header=new i.Header,this.header.fromJSON(l.header),this.tracks=l.tracks.map(function(d){var m=new s.Track(void 0,h.header);return m.fromJSON(d),m})},f.prototype.clone=function(){var l=new f;return l.fromJSON(this.toJSON()),l},f}();t.Midi=a;var u=ht;Object.defineProperty(t,"Track",{enumerable:!0,get:function(){return u.Track}});var c=Lt;Object.defineProperty(t,"Header",{enumerable:!0,get:function(){return c.Header}});function p(f){for(var l=[],h=0;h<f.length;h++)for(var d=l.length,m=new Map,v=Array(16).fill(0),I=0,V=f[h];I<V.length;I++){var x=V[I],S=d,C=x.channel;if(C!==void 0){x.type==="programChange"&&(v[C]=x.programNumber);var M=v[C],T="".concat(M," ").concat(C);m.has(T)?S=m.get(T):(S=d+m.size,m.set(T,S))}l[S]||l.push([]),l[S].push(x)}return l}})(Cr);const ot=["C","C#","D","D#","E","F","F#","G","G#","A","A#","B"],Qn={Backquote:"A#2",Tab:"B2",KeyQ:"C3",Digit2:"C#3",KeyW:"D3",Digit3:"D#3",KeyE:"E3",KeyR:"F3",Digit5:"F#3",KeyT:"G3",Digit6:"G#3",KeyY:"A3",Digit7:"A#3",KeyU:"B3",KeyI:"C4",Digit9:"C#4",KeyO:"D4",Digit0:"D#4",KeyP:"E4",BracketLeft:"F4",Equal:"F#4",BracketRight:"G4",Backspace:"G#4",Backslash:"A4",CapsLock:"A#4",ShiftLeft:"B4",KeyZ:"C5",KeyS:"C#5",KeyX:"D5",KeyD:"D#5",KeyC:"E5",KeyV:"F5",KeyG:"F#5",KeyB:"G5",KeyH:"G#5",KeyN:"A5",KeyJ:"A#5",KeyM:"B5",Comma:"C6",KeyL:"C#6",Period:"D6",Semicolon:"D#6",Slash:"E6",ShiftRight:"F6",Enter:"F#6"},ls={"A#2":"`",B2:"↹",C3:"Q","C#3":"2",D3:"W","D#3":"3",E3:"E",F3:"R","F#3":"5",G3:"T","G#3":"6",A3:"Y","A#3":"7",B3:"U",C4:"I","C#4":"9",D4:"O","D#4":"0",E4:"P",F4:"[","F#4":"=",G4:"]","G#4":"⌫",A4:"\\","A#4":"⇪",B4:"⇧",C5:"Z","C#5":"S",D5:"X","D#5":"D",E5:"C",F5:"V","F#5":"G",G5:"B","G#5":"H",A5:"N","A#5":"J",B5:"M",C6:",","C#6":"L",D6:".","D#6":";",E6:"/",F6:"⇧","F#6":"↩"};function qt(t){return parseInt(t.charAt(t.length-1))}function ct(t){return t.substring(0,t.length-1)}function nn(t){const e=Math.floor(t/12)-1;return ot[t%12]+e}function hs(t,e){const n=qt(e),r=qt(t),i=ot.indexOf(ct(t)),s=ot.indexOf(ct(e)),o={};let a=0,u=i;for(let c=r;c<=n;c++){for(;u<ot.length&&!(c===n&&u>s);){const p=ot[u],f=p.length===1;o[p+c]={isWhite:f,pressedColor:null},f&&a++,u++}u=0}return[o,a]}var Or={exports:{}},Pr={exports:{}};function fs(t){return t>64&&t<91?t-65:t>96&&t<123?t-71:t>47&&t<58?t+4:t===43?62:t===47?63:0}function ds(t,e){for(var n=t.replace(/[^A-Za-z0-9\+\/]/g,""),r=n.length,i=e?Math.ceil((r*3+1>>2)/e)*e:r*3+1>>2,s=new Uint8Array(i),o,a,u=0,c=0,p=0;p<r;p++)if(a=p&3,u|=fs(n.charCodeAt(p))<<18-6*a,a===3||r-p===1){for(o=0;o<3&&c<i;o++,c++)s[c]=u>>>(16>>>o&24)&255;u=0}return s}var ps={decode:ds},ms=function(t,e){return new Promise(function(n,r){var i=new XMLHttpRequest;e&&(i.responseType=e),i.open("GET",t),i.onload=function(){i.status===200?n(i.response):r(Error(i.statusText))},i.onerror=function(){r(Error("Network Error"))},i.send()})};(function(t){var e=ps,n=ms;function r(T){return function(w){return typeof w=="string"&&T.test(w)}}function i(T,w){return typeof T=="string"?T+w:typeof T=="function"?T(w):w}function s(T,w,E,B){var $=o(w)?a:u(w)?c:p(w)?f:l(w)?h:d(w)?m:v(w)?I:V(w)?x:S(w)?C:null,H=E||{};return $?$(T,w,H):B?Promise.resolve(B):Promise.reject("Source not valid ("+w+")")}s.fetch=n;function o(T){return T instanceof ArrayBuffer}function a(T,w,E){return new Promise(function(B,$){T.decodeAudioData(w,function(H){B(H)},function(){$("Can't decode audio data ("+w.slice(0,30)+"...)")})})}var u=r(/\.(mp3|wav|ogg)(\?.*)?$/i);function c(T,w,E){var B=i(E.from,w);return s(T,s.fetch(B,"arraybuffer"),E)}function p(T){return T&&typeof T.then=="function"}function f(T,w,E){return w.then(function(B){return s(T,B,E)})}var l=Array.isArray;function h(T,w,E){return Promise.all(w.map(function(B){return s(T,B,E,B)}))}function d(T){return T&&typeof T=="object"}function m(T,w,E){var B={},$=Object.keys(w).map(function(H){if(E.only&&E.only.indexOf(H)===-1)return null;var W=w[H];return s(T,W,E,W).then(function(de){B[H]=de})});return Promise.all($).then(function(){return B})}var v=r(/\.json(\?.*)?$/i);function I(T,w,E){var B=i(E.from,w);return s(T,s.fetch(B,"text").then(JSON.parse),E)}var V=r(/^data:audio/);function x(T,w,E){var B=w.indexOf(",");return s(T,e.decode(w.slice(B+1)).buffer,E)}var S=r(/\.js(\?.*)?$/i);function C(T,w,E){var B=i(E.from,w);return s(T,s.fetch(B,"text").then(M),E)}function M(T){var w=T.indexOf("MIDI.Soundfont.");if(w<0)throw Error("Invalid MIDI.js Soundfont format");w=T.indexOf("=",w)+2;var E=T.lastIndexOf(",");return JSON.parse(T.slice(w,E)+"}")}t.exports&&(t.exports=s),typeof window<"u"&&(window.loadAudio=s)})(Pr);var ys=Pr.exports,Ar={exports:{}},gs=bs;function bs(t){var e=t.createGain(),n=e._voltage=ks(t),r=Ye(n),i=Ye(n),s=Ye(n);return e._startAmount=Ye(i),e._endAmount=Ye(s),e._multiplier=Ye(r),e._multiplier.connect(e),e._startAmount.connect(e),e._endAmount.connect(e),e.value=r.gain,e.startValue=i.gain,e.endValue=s.gain,e.startValue.value=0,e.endValue.value=0,Object.defineProperties(e,vs),e}var vs={attack:{value:0,writable:!0},decay:{value:0,writable:!0},sustain:{value:1,writable:!0},release:{value:0,writable:!0},getReleaseDuration:{value:function(){return this.release}},start:{value:function(t){var e=this._multiplier.gain,n=this._startAmount.gain,r=this._endAmount.gain;this._voltage.start(t),this._decayFrom=this._decayFrom=t+this.attack,this._startedAt=t;var i=this.sustain;e.cancelScheduledValues(t),n.cancelScheduledValues(t),r.cancelScheduledValues(t),r.setValueAtTime(0,t),this.attack?(e.setValueAtTime(0,t),e.linearRampToValueAtTime(1,t+this.attack),n.setValueAtTime(1,t),n.linearRampToValueAtTime(0,t+this.attack)):(e.setValueAtTime(1,t),n.setValueAtTime(0,t)),this.decay&&e.setTargetAtTime(i,this._decayFrom,$n(this.decay))}},stop:{value:function(t,e){e&&(t=t-this.release);var n=t+this.release;if(this.release){var r=this._multiplier.gain,i=this._startAmount.gain,s=this._endAmount.gain;r.cancelScheduledValues(t),i.cancelScheduledValues(t),s.cancelScheduledValues(t);var o=$n(this.release);if(this.attack&&t<this._decayFrom){var a=ws(0,1,this._startedAt,this._decayFrom,t);r.linearRampToValueAtTime(a,t),i.linearRampToValueAtTime(1-a,t),i.setTargetAtTime(0,t,o)}s.setTargetAtTime(1,t,o),r.setTargetAtTime(0,t,o)}return this._voltage.stop(n),n}},onended:{get:function(){return this._voltage.onended},set:function(t){this._voltage.onended=t}}},_s=new Float32Array([1,1]);function ks(t){var e=t.createBufferSource(),n=t.createBuffer(1,2,t.sampleRate);return n.getChannelData(0).set(_s),e.buffer=n,e.loop=!0,e}function Ye(t){var e=t.context.createGain();return t.connect(e),e}function $n(t){return Math.log(t+1)/Math.log(100)}function ws(t,e,n,r,i){var s=e-t,o=r-n,a=i-n,u=a/o,c=t+u*s;return c<=t&&(c=t),c>=e&&(c=e),c}var Ts=gs,Ss={},Is={gain:1,attack:.01,decay:.1,sustain:.9,release:.3,loop:!1,cents:0,loopStart:0,loopEnd:0};function Cs(t,e,n){var r=!1,i=0,s={},o=t.createGain();o.gain.value=1;var a=Object.assign({},Is,n),u={context:t,out:o,opts:a};return e instanceof AudioBuffer?u.buffer=e:u.buffers=e,u.start=function(f,l,h){if(u.buffer&&f!==null)return u.start(null,f,l);var d=f?u.buffers[f]:u.buffer;if(d){if(!r){console.warn("SamplePlayer not connected to any node.");return}}else{console.warn("Buffer "+f+" not found.");return}var m=h||Ss;l=Math.max(t.currentTime,l||0),u.emit("start",l,f,m);var v=p(f,d,m);return v.id=c(f,v),v.env.start(l),v.source.start(l),u.emit("started",l,v.id,v),m.duration&&v.stop(l+m.duration),v},u.play=function(f,l,h){return u.start(f,l,h)},u.stop=function(f,l){var h;return l=l||Object.keys(s),l.map(function(d){return h=s[d],h?(h.stop(f),h.id):null})},u.connect=function(f){return r=!0,o.connect(f),u},u.emit=function(f,l,h,d){u.onevent&&u.onevent(f,l,h,d);var m=u["on"+f];m&&m(l,h,d)},u;function c(f,l){return l.id=i++,s[l.id]=l,l.source.onended=function(){var h=t.currentTime;l.source.disconnect(),l.env.disconnect(),l.disconnect(),u.emit("ended",h,l.id,l)},l.id}function p(f,l,h){var d=t.createGain();return d.gain.value=0,d.connect(o),d.env=Es(t,h,a),d.env.connect(d.gain),d.source=t.createBufferSource(),d.source.buffer=l,d.source.connect(d),d.source.loop=h.loop||a.loop,d.source.playbackRate.value=Ns(h.cents||a.cents),d.source.loopStart=h.loopStart||a.loopStart,d.source.loopEnd=h.loopEnd||a.loopEnd,d.stop=function(m){var v=m||t.currentTime;u.emit("stop",v,f);var I=d.env.stop(v);d.source.stop(I)},d}}function Zn(t){return typeof t=="number"}var xs=["attack","decay","sustain","release"];function Es(t,e,n){var r=Ts(t),i=e.adsr||n.adsr;return xs.forEach(function(s,o){i?r[s]=i[o]:r[s]=e[s]||n[s]}),r.value.value=Zn(e.gain)?e.gain:Zn(n.gain)?n.gain:1,r}function Ns(t){return t?Math.pow(2,t/1200):1}var Os=Cs,Ps=function(t){return t.on=function(e,n){if(arguments.length===1&&typeof e=="function")return t.on("event",e);var r="on"+e,i=t[r];return t[r]=i?As(i,n):n,t},t};function As(t,e){return function(n,r,i,s){t(n,r,i,s),e(n,r,i,s)}}var Br=/^([a-gA-G])(#{1,}|b{1,}|x{1,}|)(-?\d*)\s*(.*)\s*$/;function Bs(){return Br}var Us=[0,2,4,5,7,9,11];function Ur(t,e,n){if(typeof t!="string")return null;var r=Br.exec(t);if(!r||!e&&r[4])return null;var i={letter:r[1].toUpperCase(),acc:r[2].replace(/x/g,"##")};return i.pc=i.letter+i.acc,i.step=(i.letter.charCodeAt(0)+3)%7,i.alt=i.acc[0]==="b"?-i.acc.length:i.acc.length,i.chroma=Us[i.step]+i.alt,r[3]&&(i.oct=+r[3],i.midi=i.chroma+12*(i.oct+1),i.freq=Mr(i.midi,n)),e&&(i.tonicOf=r[4]),i}function Mr(t,e){return Math.pow(2,(t-69)/12)*(e||440)}var Fr={parse:Ur,regex:Bs,midiToFreq:Mr},Ms=["letter","acc","pc","step","alt","chroma","oct","midi","freq"];Ms.forEach(function(t){Fr[t]=function(e){var n=Ur(e);return n&&typeof n[t]<"u"?n[t]:null}});var Fs=Fr,Rs=Fs,Ds=function(t){return t!==null&&t!==[]&&t>=0&&t<129},Ls=function(t){return Ds(t)?+t:Rs.midi(t)},qs=function(t){if(t.buffers){var e=t.opts.map,n=typeof e=="function"?e:Ls,r=function(s){return s?n(s)||s:null};t.buffers=Vs(t.buffers,r);var i=t.start;t.start=function(s,o,a){var u=r(s),c=u%1;return c&&(u=Math.floor(u),a=Object.assign(a||{},{cents:Math.floor(c*100)})),i(u,o,a)}}return t};function Vs(t,e){return Object.keys(t).reduce(function(n,r){return n[e(r)]=t[r],n},{})}var js=Array.isArray,Ks=function(t){return t&&typeof t=="object"},Hs={},Js=function(t){return t.schedule=function(e,n){var r=t.context.currentTime,i=e<r?r:e;t.emit("schedule",i,n);var s,o,a,u;return n.map(function(c){if(c)js(c)?(s=c[0],o=c[1]):(s=c.time,o=c);else return null;return Ks(o)?(a=o.name||o.key||o.note||o.midi||null,u=o):(a=o,u=Hs),t.start(a,i+(s||0),u)})},t};function Ot(t){throw new Error('Could not dynamically require "'+t+'". Please configure the dynamicRequireTargets or/and ignoreDynamicRequires option of @rollup/plugin-commonjs appropriately for this require call to work.')}var Rr={exports:{}};(function(t,e){(function(n){t.exports=n()})(function(){return function n(r,i,s){function o(c,p){if(!i[c]){if(!r[c]){var f=typeof Ot=="function"&&Ot;if(!p&&f)return f(c,!0);if(a)return a(c,!0);var l=new Error("Cannot find module '"+c+"'");throw l.code="MODULE_NOT_FOUND",l}var h=i[c]={exports:{}};r[c][0].call(h.exports,function(d){var m=r[c][1][d];return o(m||d)},h,h.exports,n,r,i,s)}return i[c].exports}for(var a=typeof Ot=="function"&&Ot,u=0;u<s.length;u++)o(s[u]);return o}({1:[function(n,r,i){Object.defineProperty(i,"__esModule",{value:!0}),i.default=function(s){function o(a){if(this._event=a,this._data=a.data,this.receivedTime=a.receivedTime,this._data&&this._data.length<2){console.warn("Illegal MIDI message of length",this._data.length);return}switch(this._messageCode=a.data[0]&240,this.channel=a.data[0]&15,this._messageCode){case 128:this.messageType="noteoff",this.key=a.data[1]&127,this.velocity=a.data[2]&127;break;case 144:this.messageType="noteon",this.key=a.data[1]&127,this.velocity=a.data[2]&127;break;case 160:this.messageType="keypressure",this.key=a.data[1]&127,this.pressure=a.data[2]&127;break;case 176:this.messageType="controlchange",this.controllerNumber=a.data[1]&127,this.controllerValue=a.data[2]&127,this.controllerNumber===120&&this.controllerValue===0?this.channelModeMessage="allsoundoff":this.controllerNumber===121?this.channelModeMessage="resetallcontrollers":this.controllerNumber===122?this.controllerValue===0?this.channelModeMessage="localcontroloff":this.channelModeMessage="localcontrolon":this.controllerNumber===123&&this.controllerValue===0?this.channelModeMessage="allnotesoff":this.controllerNumber===124&&this.controllerValue===0?this.channelModeMessage="omnimodeoff":this.controllerNumber===125&&this.controllerValue===0?this.channelModeMessage="omnimodeon":this.controllerNumber===126?this.channelModeMessage="monomodeon":this.controllerNumber===127&&(this.channelModeMessage="polymodeon");break;case 192:this.messageType="programchange",this.program=a.data[1];break;case 208:this.messageType="channelpressure",this.pressure=a.data[1]&127;break;case 224:this.messageType="pitchbendchange";var u=a.data[2]&127,c=a.data[1]&127;this.pitchBend=(u<<8)+c;break}}return new o(s)},r.exports=i.default},{}]},{},[1])(1)})})(Rr);var zs=Rr.exports,Gs=zs,Ws=function(t){return t.listenToMidi=function(e,n){var r={},i=n||{},s=i.gain||function(o){return o/127};return e.onmidimessage=function(o){var a=o.messageType?o:Gs(o);if(a.messageType==="noteon"&&a.velocity===0&&(a.messageType="noteoff"),!(i.channel&&a.channel!==i.channel))switch(a.messageType){case"noteon":r[a.key]=t.play(a.key,0,{gain:s(a.velocity)});break;case"noteoff":r[a.key]&&(r[a.key].stop(),delete r[a.key]);break}},t},t};(function(t){var e=Os,n=Ps,r=qs,i=Js,s=Ws;function o(a,u,c){return s(i(r(n(e(a,u,c)))))}t.exports&&(t.exports=o),typeof window<"u"&&(window.SamplePlayer=o)})(Ar);var Ys=Ar.exports;function er(t,e){return Array(e+1).join(t)}function Sn(t){return typeof t=="number"}function Xs(t){return typeof t=="string"}function Qs(t){return typeof t<"u"}function Dr(t,e){return Math.pow(2,(t-69)/12)*(e||440)}var Lr=/^([a-gA-G])(#{1,}|b{1,}|x{1,}|)(-?\d*)\s*(.*)\s*$/;function $s(){return Lr}var Zs=[0,2,4,5,7,9,11];function Oe(t,e,n){if(typeof t!="string")return null;var r=Lr.exec(t);if(!r||!e&&r[4])return null;var i={letter:r[1].toUpperCase(),acc:r[2].replace(/x/g,"##")};i.pc=i.letter+i.acc,i.step=(i.letter.charCodeAt(0)+3)%7,i.alt=i.acc[0]==="b"?-i.acc.length:i.acc.length;var s=Zs[i.step]+i.alt;return i.chroma=s<0?12+s:s%12,r[3]&&(i.oct=+r[3],i.midi=s+12*(i.oct+1),i.freq=Dr(i.midi,n)),e&&(i.tonicOf=r[4]),i}var eo="CDEFGAB";function to(t){return Sn(t)?t<0?er("b",-t):er("#",t):""}function no(t){return Sn(t)?""+t:""}function qr(t,e,n){return t===null||typeof t>"u"?null:t.step?qr(t.step,t.alt,t.oct):t<0||t>6?null:eo.charAt(t)+to(e)+no(n)}function Vr(t){if((Sn(t)||Xs(t))&&t>=0&&t<128)return+t;var e=Oe(t);return e&&Qs(e.midi)?e.midi:null}function ro(t,e){var n=Vr(t);return n===null?null:Dr(n,e)}function io(t){return(Oe(t)||{}).letter}function so(t){return(Oe(t)||{}).acc}function oo(t){return(Oe(t)||{}).pc}function ao(t){return(Oe(t)||{}).step}function co(t){return(Oe(t)||{}).alt}function uo(t){return(Oe(t)||{}).chroma}function lo(t){return(Oe(t)||{}).oct}const ho=Object.freeze(Object.defineProperty({__proto__:null,acc:so,alt:co,build:qr,chroma:uo,freq:ro,letter:io,midi:Vr,oct:lo,parse:Oe,pc:oo,regex:$s,step:ao},Symbol.toStringTag,{value:"Module"})),fo=Ir(ho);var rn,tr;function po(){if(tr)return rn;tr=1;var t=fo;function e(i,s){if(console.warn("new Soundfont() is deprected"),console.log("Please use Soundfont.instrument() instead of new Soundfont().instrument()"),!(this instanceof e))return new e(i);this.nameToUrl=s||e.nameToUrl,this.ctx=i,this.instruments={},this.promises=[]}e.prototype.onready=function(i){console.warn("deprecated API"),console.log("Please use Promise.all(Soundfont.instrument(), Soundfont.instrument()).then() instead of new Soundfont().onready()"),Promise.all(this.promises).then(i)},e.prototype.instrument=function(i,s){console.warn("new Soundfont().instrument() is deprecated."),console.log("Please use Soundfont.instrument() instead.");var o=this.ctx;if(i=i||"default",i in this.instruments)return this.instruments[i];var a={name:i,play:r(o,s)};if(this.instruments[i]=a,i!=="default"){var u=e.instrument(o,i,s).then(function(c){return a.play=c.play,a});this.promises.push(u),a.onready=function(c){console.warn("onready is deprecated. Use Soundfont.instrument().then()"),u.then(c)}}else a.onready=function(c){console.warn("onready is deprecated. Use Soundfont.instrument().then()"),c()};return a};function n(i,s,o){return console.warn("Soundfont.loadBuffers is deprecate."),console.log("Use Soundfont.instrument(..) and get buffers properties from the result."),e.instrument(i,s,o).then(function(a){return a.buffers})}e.loadBuffers=n;function r(i,s){return s=s||{},function(o,a,u,c){console.warn("The oscillator player is deprecated."),console.log("Starting with version 0.9.0 you will have to wait until the soundfont is loaded to play sounds.");var p=o>0&&o<129?+o:t.midi(o),f=p?t.midiToFreq(p,440):null;if(f){u=u||.2,c=c||{};var l=c.destination||s.destination||i.destination,h=c.vcoType||s.vcoType||"sine",d=c.gain||s.gain||.4,m=i.createOscillator();m.type=h,m.frequency.value=f;var v=i.createGain();return v.gain.value=d,m.connect(v),v.connect(l),m.start(a),u>0&&m.stop(a+u),m}}}return e.noteToMidi=t.midi,rn=e,rn}(function(t){var e=ys,n=Ys;function r(a,u,c){if(arguments.length===1)return function(d,m){return r(a,d,m)};var p=c||{},f=p.isSoundfontURL||i,l=p.nameToUrl||s,h=f(u)?u:l(u,p.soundfont,p.format);return e(a,h,{only:p.only||p.notes}).then(function(d){var m=n(a,d,p).connect(p.destination?p.destination:a.destination);return m.url=h,m.name=u,m})}function i(a){return/\.js(\?.*)?$/i.test(a)}function s(a,u,c){return c=c==="ogg"?c:"mp3",u=u==="FluidR3_GM"?u:"MusyngKite","https://gleitz.github.io/midi-js-soundfonts/"+u+"/"+a+"-"+c+".js"}var o=po();o.instrument=r,o.nameToUrl=s,t.exports&&(t.exports=o),typeof window<"u"&&(window.Soundfont=o)})(Or);var mo=Or.exports;const jr=window.AudioContext||window.webkitAudioContext;jr||alert("Your browser does not seem to support the Web Audio API!");const yo=new jr,sn={};function Kr(t){return sn[t]||(sn[t]=mo.instrument(yo,t)),sn[t]}function go(t,e){let n=0,r=t.length-1;for(;n!=r;){const i=Math.ceil((n+r)/2);e(t[i])>0?r=i-1:n=i}return r}function bo(t,e){t[e]=t[t.length-1],t.pop()}class vo{constructor(){U(this,"midiIsPlaying",te(!1));U(this,"midiCurrentTime",te(0));U(this,"midiTotalTime",te(0));U(this,"midiFile",te());U(this,"midiSpeed",te(1));U(this,"tracksIndexUpTo",[]);U(this,"midiData",null);U(this,"playIntervalID");U(this,"heldNotes",[]);U(this,"midiAccess");U(this,"onPlayNote");U(this,"onStopNote");this.midiFile.subscribe(e=>{if(this.midiIsPlaying.set(!1),this.midiTotalTime.set(0),this.midiCurrentTime.set(0),!e){this.midiData=null;return}const n=new FileReader;n.onload=()=>this.generatePlayData(n.result),n.readAsArrayBuffer(e)}),this.midiIsPlaying.subscribe(e=>{if(!e){clearInterval(this.playIntervalID),this.heldNotes.forEach(r=>this.onStopNote(r.name)),this.heldNotes=[];return}if(!this.midiData)return this.midiIsPlaying.set(!1),alert("No MIDI file selected!");this.midiData.tracks.forEach((r,i)=>{const s=Se(this.midiCurrentTime),o=go(r.notes,a=>a.time-s);this.tracksIndexUpTo[i]=o});let n=performance.now();this.playIntervalID=setInterval(()=>{const r=performance.now(),i=r-n;n=r,this.onUpdate(i/1e3*Se(this.midiSpeed))},10)}),navigator.requestMIDIAccess().then(e=>{this.midiAccess=e,this.connectMidiDevices(),e.onstatechange=()=>{this.connectMidiDevices()}})}generatePlayData(e){this.midiData=new Cr.Midi(e),this.midiData.tracks=this.midiData.tracks.filter(r=>r.notes.length!==0);let n=0;this.midiData.tracks.forEach(r=>{const i=r.notes[r.notes.length-1],s=i.time+i.duration;s>n&&(n=s)}),this.midiTotalTime.set(n)}onUpdate(e){const n=Se(this.midiCurrentTime)+e;this.midiCurrentTime.set(n),this.heldNotes.forEach((r,i)=>{n>r.time+r.duration&&(this.onStopNote(r.name),bo(this.heldNotes,i))}),this.midiData.tracks.forEach((r,i)=>{for(;;){const s=r.notes[this.tracksIndexUpTo[i]];if(!s||n<s.time)break;this.onPlayNote(s.name,s.velocity),this.heldNotes.push(s),this.tracksIndexUpTo[i]++}}),n>Se(this.midiTotalTime)&&this.midiIsPlaying.set(!1)}connectMidiDevices(){this.midiAccess.inputs.forEach(e=>{e.onmidimessage=this.onMidiEvent.bind(this)})}onMidiEvent(e){const[n,r,i]=e.data;n>=144&&n<=159?i==0?this.onStopNote(nn(r)):this.onPlayNote(nn(r),i/127):n>=128&&n<=143&&this.onStopNote(nn(r))}}const Ce=Object.create(null);Ce.open="0";Ce.close="1";Ce.ping="2";Ce.pong="3";Ce.message="4";Ce.upgrade="5";Ce.noop="6";const Ut=Object.create(null);Object.keys(Ce).forEach(t=>{Ut[Ce[t]]=t});const _o={type:"error",data:"parser error"},Hr=typeof Blob=="function"||typeof Blob<"u"&&Object.prototype.toString.call(Blob)==="[object BlobConstructor]",Jr=typeof ArrayBuffer=="function",zr=t=>typeof ArrayBuffer.isView=="function"?ArrayBuffer.isView(t):t&&t.buffer instanceof ArrayBuffer,In=({type:t,data:e},n,r)=>Hr&&e instanceof Blob?n?r(e):nr(e,r):Jr&&(e instanceof ArrayBuffer||zr(e))?n?r(e):nr(new Blob([e]),r):r(Ce[t]+(e||"")),nr=(t,e)=>{const n=new FileReader;return n.onload=function(){const r=n.result.split(",")[1];e("b"+(r||""))},n.readAsDataURL(t)};function rr(t){return t instanceof Uint8Array?t:t instanceof ArrayBuffer?new Uint8Array(t):new Uint8Array(t.buffer,t.byteOffset,t.byteLength)}let on;function ko(t,e){if(Hr&&t.data instanceof Blob)return t.data.arrayBuffer().then(rr).then(e);if(Jr&&(t.data instanceof ArrayBuffer||zr(t.data)))return e(rr(t.data));In(t,!1,n=>{on||(on=new TextEncoder),e(on.encode(n))})}const ir="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",at=typeof Uint8Array>"u"?[]:new Uint8Array(256);for(let t=0;t<ir.length;t++)at[ir.charCodeAt(t)]=t;const wo=t=>{let e=t.length*.75,n=t.length,r,i=0,s,o,a,u;t[t.length-1]==="="&&(e--,t[t.length-2]==="="&&e--);const c=new ArrayBuffer(e),p=new Uint8Array(c);for(r=0;r<n;r+=4)s=at[t.charCodeAt(r)],o=at[t.charCodeAt(r+1)],a=at[t.charCodeAt(r+2)],u=at[t.charCodeAt(r+3)],p[i++]=s<<2|o>>4,p[i++]=(o&15)<<4|a>>2,p[i++]=(a&3)<<6|u&63;return c},To=typeof ArrayBuffer=="function",Cn=(t,e)=>{if(typeof t!="string")return{type:"message",data:Gr(t,e)};const n=t.charAt(0);return n==="b"?{type:"message",data:So(t.substring(1),e)}:Ut[n]?t.length>1?{type:Ut[n],data:t.substring(1)}:{type:Ut[n]}:_o},So=(t,e)=>{if(To){const n=wo(t);return Gr(n,e)}else return{base64:!0,data:t}},Gr=(t,e)=>{switch(e){case"blob":return t instanceof Blob?t:new Blob([t]);case"arraybuffer":default:return t instanceof ArrayBuffer?t:t.buffer}},Wr=String.fromCharCode(30),Io=(t,e)=>{const n=t.length,r=new Array(n);let i=0;t.forEach((s,o)=>{In(s,!1,a=>{r[o]=a,++i===n&&e(r.join(Wr))})})},Co=(t,e)=>{const n=t.split(Wr),r=[];for(let i=0;i<n.length;i++){const s=Cn(n[i],e);if(r.push(s),s.type==="error")break}return r};let an;function xo(t,e,n){an||(an=new TextDecoder);const r=e||t[0]<48||t[0]>54;return Cn(r?t:an.decode(t),n)}const Yr=4;function J(t){if(t)return Eo(t)}function Eo(t){for(var e in J.prototype)t[e]=J.prototype[e];return t}J.prototype.on=J.prototype.addEventListener=function(t,e){return this._callbacks=this._callbacks||{},(this._callbacks["$"+t]=this._callbacks["$"+t]||[]).push(e),this};J.prototype.once=function(t,e){function n(){this.off(t,n),e.apply(this,arguments)}return n.fn=e,this.on(t,n),this};J.prototype.off=J.prototype.removeListener=J.prototype.removeAllListeners=J.prototype.removeEventListener=function(t,e){if(this._callbacks=this._callbacks||{},arguments.length==0)return this._callbacks={},this;var n=this._callbacks["$"+t];if(!n)return this;if(arguments.length==1)return delete this._callbacks["$"+t],this;for(var r,i=0;i<n.length;i++)if(r=n[i],r===e||r.fn===e){n.splice(i,1);break}return n.length===0&&delete this._callbacks["$"+t],this};J.prototype.emit=function(t){this._callbacks=this._callbacks||{};for(var e=new Array(arguments.length-1),n=this._callbacks["$"+t],r=1;r<arguments.length;r++)e[r-1]=arguments[r];if(n){n=n.slice(0);for(var r=0,i=n.length;r<i;++r)n[r].apply(this,e)}return this};J.prototype.emitReserved=J.prototype.emit;J.prototype.listeners=function(t){return this._callbacks=this._callbacks||{},this._callbacks["$"+t]||[]};J.prototype.hasListeners=function(t){return!!this.listeners(t).length};const fe=(()=>typeof self<"u"?self:typeof window<"u"?window:Function("return this")())();function Xr(t,...e){return e.reduce((n,r)=>(t.hasOwnProperty(r)&&(n[r]=t[r]),n),{})}const No=fe.setTimeout,Oo=fe.clearTimeout;function Wt(t,e){e.useNativeTimers?(t.setTimeoutFn=No.bind(fe),t.clearTimeoutFn=Oo.bind(fe)):(t.setTimeoutFn=fe.setTimeout.bind(fe),t.clearTimeoutFn=fe.clearTimeout.bind(fe))}const Po=1.33;function Ao(t){return typeof t=="string"?Bo(t):Math.ceil((t.byteLength||t.size)*Po)}function Bo(t){let e=0,n=0;for(let r=0,i=t.length;r<i;r++)e=t.charCodeAt(r),e<128?n+=1:e<2048?n+=2:e<55296||e>=57344?n+=3:(r++,n+=4);return n}function Uo(t){let e="";for(let n in t)t.hasOwnProperty(n)&&(e.length&&(e+="&"),e+=encodeURIComponent(n)+"="+encodeURIComponent(t[n]));return e}function Mo(t){let e={},n=t.split("&");for(let r=0,i=n.length;r<i;r++){let s=n[r].split("=");e[decodeURIComponent(s[0])]=decodeURIComponent(s[1])}return e}class Fo extends Error{constructor(e,n,r){super(e),this.description=n,this.context=r,this.type="TransportError"}}class xn extends J{constructor(e){super(),this.writable=!1,Wt(this,e),this.opts=e,this.query=e.query,this.socket=e.socket}onError(e,n,r){return super.emitReserved("error",new Fo(e,n,r)),this}open(){return this.readyState="opening",this.doOpen(),this}close(){return(this.readyState==="opening"||this.readyState==="open")&&(this.doClose(),this.onClose()),this}send(e){this.readyState==="open"&&this.write(e)}onOpen(){this.readyState="open",this.writable=!0,super.emitReserved("open")}onData(e){const n=Cn(e,this.socket.binaryType);this.onPacket(n)}onPacket(e){super.emitReserved("packet",e)}onClose(e){this.readyState="closed",super.emitReserved("close",e)}pause(e){}createUri(e,n={}){return e+"://"+this._hostname()+this._port()+this.opts.path+this._query(n)}_hostname(){const e=this.opts.hostname;return e.indexOf(":")===-1?e:"["+e+"]"}_port(){return this.opts.port&&(this.opts.secure&&+(this.opts.port!==443)||!this.opts.secure&&Number(this.opts.port)!==80)?":"+this.opts.port:""}_query(e){const n=Uo(e);return n.length?"?"+n:""}}const Qr="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz-_".split(""),dn=64,Ro={};let sr=0,Pt=0,or;function ar(t){let e="";do e=Qr[t%dn]+e,t=Math.floor(t/dn);while(t>0);return e}function $r(){const t=ar(+new Date);return t!==or?(sr=0,or=t):t+"."+ar(sr++)}for(;Pt<dn;Pt++)Ro[Qr[Pt]]=Pt;let Zr=!1;try{Zr=typeof XMLHttpRequest<"u"&&"withCredentials"in new XMLHttpRequest}catch{}const Do=Zr;function ei(t){const e=t.xdomain;try{if(typeof XMLHttpRequest<"u"&&(!e||Do))return new XMLHttpRequest}catch{}if(!e)try{return new fe[["Active"].concat("Object").join("X")]("Microsoft.XMLHTTP")}catch{}}function Lo(){}const qo=function(){return new ei({xdomain:!1}).responseType!=null}();class Vo extends xn{constructor(e){if(super(e),this.polling=!1,typeof location<"u"){const r=location.protocol==="https:";let i=location.port;i||(i=r?"443":"80"),this.xd=typeof location<"u"&&e.hostname!==location.hostname||i!==e.port}const n=e&&e.forceBase64;this.supportsBinary=qo&&!n,this.opts.withCredentials&&(this.cookieJar=void 0)}get name(){return"polling"}doOpen(){this.poll()}pause(e){this.readyState="pausing";const n=()=>{this.readyState="paused",e()};if(this.polling||!this.writable){let r=0;this.polling&&(r++,this.once("pollComplete",function(){--r||n()})),this.writable||(r++,this.once("drain",function(){--r||n()}))}else n()}poll(){this.polling=!0,this.doPoll(),this.emitReserved("poll")}onData(e){const n=r=>{if(this.readyState==="opening"&&r.type==="open"&&this.onOpen(),r.type==="close")return this.onClose({description:"transport closed by the server"}),!1;this.onPacket(r)};Co(e,this.socket.binaryType).forEach(n),this.readyState!=="closed"&&(this.polling=!1,this.emitReserved("pollComplete"),this.readyState==="open"&&this.poll())}doClose(){const e=()=>{this.write([{type:"close"}])};this.readyState==="open"?e():this.once("open",e)}write(e){this.writable=!1,Io(e,n=>{this.doWrite(n,()=>{this.writable=!0,this.emitReserved("drain")})})}uri(){const e=this.opts.secure?"https":"http",n=this.query||{};return this.opts.timestampRequests!==!1&&(n[this.opts.timestampParam]=$r()),!this.supportsBinary&&!n.sid&&(n.b64=1),this.createUri(e,n)}request(e={}){return Object.assign(e,{xd:this.xd,cookieJar:this.cookieJar},this.opts),new Ie(this.uri(),e)}doWrite(e,n){const r=this.request({method:"POST",data:e});r.on("success",n),r.on("error",(i,s)=>{this.onError("xhr post error",i,s)})}doPoll(){const e=this.request();e.on("data",this.onData.bind(this)),e.on("error",(n,r)=>{this.onError("xhr poll error",n,r)}),this.pollXhr=e}}class Ie extends J{constructor(e,n){super(),Wt(this,n),this.opts=n,this.method=n.method||"GET",this.uri=e,this.data=n.data!==void 0?n.data:null,this.create()}create(){var e;const n=Xr(this.opts,"agent","pfx","key","passphrase","cert","ca","ciphers","rejectUnauthorized","autoUnref");n.xdomain=!!this.opts.xd;const r=this.xhr=new ei(n);try{r.open(this.method,this.uri,!0);try{if(this.opts.extraHeaders){r.setDisableHeaderCheck&&r.setDisableHeaderCheck(!0);for(let i in this.opts.extraHeaders)this.opts.extraHeaders.hasOwnProperty(i)&&r.setRequestHeader(i,this.opts.extraHeaders[i])}}catch{}if(this.method==="POST")try{r.setRequestHeader("Content-type","text/plain;charset=UTF-8")}catch{}try{r.setRequestHeader("Accept","*/*")}catch{}(e=this.opts.cookieJar)===null||e===void 0||e.addCookies(r),"withCredentials"in r&&(r.withCredentials=this.opts.withCredentials),this.opts.requestTimeout&&(r.timeout=this.opts.requestTimeout),r.onreadystatechange=()=>{var i;r.readyState===3&&((i=this.opts.cookieJar)===null||i===void 0||i.parseCookies(r)),r.readyState===4&&(r.status===200||r.status===1223?this.onLoad():this.setTimeoutFn(()=>{this.onError(typeof r.status=="number"?r.status:0)},0))},r.send(this.data)}catch(i){this.setTimeoutFn(()=>{this.onError(i)},0);return}typeof document<"u"&&(this.index=Ie.requestsCount++,Ie.requests[this.index]=this)}onError(e){this.emitReserved("error",e,this.xhr),this.cleanup(!0)}cleanup(e){if(!(typeof this.xhr>"u"||this.xhr===null)){if(this.xhr.onreadystatechange=Lo,e)try{this.xhr.abort()}catch{}typeof document<"u"&&delete Ie.requests[this.index],this.xhr=null}}onLoad(){const e=this.xhr.responseText;e!==null&&(this.emitReserved("data",e),this.emitReserved("success"),this.cleanup())}abort(){this.cleanup()}}Ie.requestsCount=0;Ie.requests={};if(typeof document<"u"){if(typeof attachEvent=="function")attachEvent("onunload",cr);else if(typeof addEventListener=="function"){const t="onpagehide"in fe?"pagehide":"unload";addEventListener(t,cr,!1)}}function cr(){for(let t in Ie.requests)Ie.requests.hasOwnProperty(t)&&Ie.requests[t].abort()}const En=(()=>typeof Promise=="function"&&typeof Promise.resolve=="function"?e=>Promise.resolve().then(e):(e,n)=>n(e,0))(),At=fe.WebSocket||fe.MozWebSocket,ur=!0,jo="arraybuffer",lr=typeof navigator<"u"&&typeof navigator.product=="string"&&navigator.product.toLowerCase()==="reactnative";class Ko extends xn{constructor(e){super(e),this.supportsBinary=!e.forceBase64}get name(){return"websocket"}doOpen(){if(!this.check())return;const e=this.uri(),n=this.opts.protocols,r=lr?{}:Xr(this.opts,"agent","perMessageDeflate","pfx","key","passphrase","cert","ca","ciphers","rejectUnauthorized","localAddress","protocolVersion","origin","maxPayload","family","checkServerIdentity");this.opts.extraHeaders&&(r.headers=this.opts.extraHeaders);try{this.ws=ur&&!lr?n?new At(e,n):new At(e):new At(e,n,r)}catch(i){return this.emitReserved("error",i)}this.ws.binaryType=this.socket.binaryType||jo,this.addEventListeners()}addEventListeners(){this.ws.onopen=()=>{this.opts.autoUnref&&this.ws._socket.unref(),this.onOpen()},this.ws.onclose=e=>this.onClose({description:"websocket connection closed",context:e}),this.ws.onmessage=e=>this.onData(e.data),this.ws.onerror=e=>this.onError("websocket error",e)}write(e){this.writable=!1;for(let n=0;n<e.length;n++){const r=e[n],i=n===e.length-1;In(r,this.supportsBinary,s=>{const o={};try{ur&&this.ws.send(s)}catch{}i&&En(()=>{this.writable=!0,this.emitReserved("drain")},this.setTimeoutFn)})}}doClose(){typeof this.ws<"u"&&(this.ws.close(),this.ws=null)}uri(){const e=this.opts.secure?"wss":"ws",n=this.query||{};return this.opts.timestampRequests&&(n[this.opts.timestampParam]=$r()),this.supportsBinary||(n.b64=1),this.createUri(e,n)}check(){return!!At}}function Ho(t,e){return t.type==="message"&&typeof t.data!="string"&&e[0]>=48&&e[0]<=54}class Jo extends xn{get name(){return"webtransport"}doOpen(){typeof WebTransport=="function"&&(this.transport=new WebTransport(this.createUri("https"),this.opts.transportOptions[this.name]),this.transport.closed.then(()=>{this.onClose()}).catch(e=>{this.onError("webtransport error",e)}),this.transport.ready.then(()=>{this.transport.createBidirectionalStream().then(e=>{const n=e.readable.getReader();this.writer=e.writable.getWriter();let r;const i=()=>{n.read().then(({done:o,value:a})=>{o||(!r&&a.byteLength===1&&a[0]===54?r=!0:(this.onPacket(xo(a,r,"arraybuffer")),r=!1),i())}).catch(o=>{})};i();const s=this.query.sid?`0{"sid":"${this.query.sid}"}`:"0";this.writer.write(new TextEncoder().encode(s)).then(()=>this.onOpen())})}))}write(e){this.writable=!1;for(let n=0;n<e.length;n++){const r=e[n],i=n===e.length-1;ko(r,s=>{Ho(r,s)&&this.writer.write(Uint8Array.of(54)),this.writer.write(s).then(()=>{i&&En(()=>{this.writable=!0,this.emitReserved("drain")},this.setTimeoutFn)})})}}doClose(){var e;(e=this.transport)===null||e===void 0||e.close()}}const zo={websocket:Ko,webtransport:Jo,polling:Vo},Go=/^(?:(?![^:@\/?#]+:[^:@\/]*@)(http|https|ws|wss):\/\/)?((?:(([^:@\/?#]*)(?::([^:@\/?#]*))?)?@)?((?:[a-f0-9]{0,4}:){2,7}[a-f0-9]{0,4}|[^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/,Wo=["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"];function pn(t){const e=t,n=t.indexOf("["),r=t.indexOf("]");n!=-1&&r!=-1&&(t=t.substring(0,n)+t.substring(n,r).replace(/:/g,";")+t.substring(r,t.length));let i=Go.exec(t||""),s={},o=14;for(;o--;)s[Wo[o]]=i[o]||"";return n!=-1&&r!=-1&&(s.source=e,s.host=s.host.substring(1,s.host.length-1).replace(/;/g,":"),s.authority=s.authority.replace("[","").replace("]","").replace(/;/g,":"),s.ipv6uri=!0),s.pathNames=Yo(s,s.path),s.queryKey=Xo(s,s.query),s}function Yo(t,e){const n=/\/{2,9}/g,r=e.replace(n,"/").split("/");return(e.slice(0,1)=="/"||e.length===0)&&r.splice(0,1),e.slice(-1)=="/"&&r.splice(r.length-1,1),r}function Xo(t,e){const n={};return e.replace(/(?:^|&)([^&=]*)=?([^&]*)/g,function(r,i,s){i&&(n[i]=s)}),n}let ti=class Qe extends J{constructor(e,n={}){super(),this.writeBuffer=[],e&&typeof e=="object"&&(n=e,e=null),e?(e=pn(e),n.hostname=e.host,n.secure=e.protocol==="https"||e.protocol==="wss",n.port=e.port,e.query&&(n.query=e.query)):n.host&&(n.hostname=pn(n.host).host),Wt(this,n),this.secure=n.secure!=null?n.secure:typeof location<"u"&&location.protocol==="https:",n.hostname&&!n.port&&(n.port=this.secure?"443":"80"),this.hostname=n.hostname||(typeof location<"u"?location.hostname:"localhost"),this.port=n.port||(typeof location<"u"&&location.port?location.port:this.secure?"443":"80"),this.transports=n.transports||["polling","websocket","webtransport"],this.writeBuffer=[],this.prevBufferLen=0,this.opts=Object.assign({path:"/engine.io",agent:!1,withCredentials:!1,upgrade:!0,timestampParam:"t",rememberUpgrade:!1,addTrailingSlash:!0,rejectUnauthorized:!0,perMessageDeflate:{threshold:1024},transportOptions:{},closeOnBeforeunload:!1},n),this.opts.path=this.opts.path.replace(/\/$/,"")+(this.opts.addTrailingSlash?"/":""),typeof this.opts.query=="string"&&(this.opts.query=Mo(this.opts.query)),this.id=null,this.upgrades=null,this.pingInterval=null,this.pingTimeout=null,this.pingTimeoutTimer=null,typeof addEventListener=="function"&&(this.opts.closeOnBeforeunload&&(this.beforeunloadEventListener=()=>{this.transport&&(this.transport.removeAllListeners(),this.transport.close())},addEventListener("beforeunload",this.beforeunloadEventListener,!1)),this.hostname!=="localhost"&&(this.offlineEventListener=()=>{this.onClose("transport close",{description:"network connection lost"})},addEventListener("offline",this.offlineEventListener,!1))),this.open()}createTransport(e){const n=Object.assign({},this.opts.query);n.EIO=Yr,n.transport=e,this.id&&(n.sid=this.id);const r=Object.assign({},this.opts,{query:n,socket:this,hostname:this.hostname,secure:this.secure,port:this.port},this.opts.transportOptions[e]);return new zo[e](r)}open(){let e;if(this.opts.rememberUpgrade&&Qe.priorWebsocketSuccess&&this.transports.indexOf("websocket")!==-1)e="websocket";else if(this.transports.length===0){this.setTimeoutFn(()=>{this.emitReserved("error","No transports available")},0);return}else e=this.transports[0];this.readyState="opening";try{e=this.createTransport(e)}catch{this.transports.shift(),this.open();return}e.open(),this.setTransport(e)}setTransport(e){this.transport&&this.transport.removeAllListeners(),this.transport=e,e.on("drain",this.onDrain.bind(this)).on("packet",this.onPacket.bind(this)).on("error",this.onError.bind(this)).on("close",n=>this.onClose("transport close",n))}probe(e){let n=this.createTransport(e),r=!1;Qe.priorWebsocketSuccess=!1;const i=()=>{r||(n.send([{type:"ping",data:"probe"}]),n.once("packet",f=>{if(!r)if(f.type==="pong"&&f.data==="probe"){if(this.upgrading=!0,this.emitReserved("upgrading",n),!n)return;Qe.priorWebsocketSuccess=n.name==="websocket",this.transport.pause(()=>{r||this.readyState!=="closed"&&(p(),this.setTransport(n),n.send([{type:"upgrade"}]),this.emitReserved("upgrade",n),n=null,this.upgrading=!1,this.flush())})}else{const l=new Error("probe error");l.transport=n.name,this.emitReserved("upgradeError",l)}}))};function s(){r||(r=!0,p(),n.close(),n=null)}const o=f=>{const l=new Error("probe error: "+f);l.transport=n.name,s(),this.emitReserved("upgradeError",l)};function a(){o("transport closed")}function u(){o("socket closed")}function c(f){n&&f.name!==n.name&&s()}const p=()=>{n.removeListener("open",i),n.removeListener("error",o),n.removeListener("close",a),this.off("close",u),this.off("upgrading",c)};n.once("open",i),n.once("error",o),n.once("close",a),this.once("close",u),this.once("upgrading",c),this.upgrades.indexOf("webtransport")!==-1&&e!=="webtransport"?this.setTimeoutFn(()=>{r||n.open()},200):n.open()}onOpen(){if(this.readyState="open",Qe.priorWebsocketSuccess=this.transport.name==="websocket",this.emitReserved("open"),this.flush(),this.readyState==="open"&&this.opts.upgrade){let e=0;const n=this.upgrades.length;for(;e<n;e++)this.probe(this.upgrades[e])}}onPacket(e){if(this.readyState==="opening"||this.readyState==="open"||this.readyState==="closing")switch(this.emitReserved("packet",e),this.emitReserved("heartbeat"),e.type){case"open":this.onHandshake(JSON.parse(e.data));break;case"ping":this.resetPingTimeout(),this.sendPacket("pong"),this.emitReserved("ping"),this.emitReserved("pong");break;case"error":const n=new Error("server error");n.code=e.data,this.onError(n);break;case"message":this.emitReserved("data",e.data),this.emitReserved("message",e.data);break}}onHandshake(e){this.emitReserved("handshake",e),this.id=e.sid,this.transport.query.sid=e.sid,this.upgrades=this.filterUpgrades(e.upgrades),this.pingInterval=e.pingInterval,this.pingTimeout=e.pingTimeout,this.maxPayload=e.maxPayload,this.onOpen(),this.readyState!=="closed"&&this.resetPingTimeout()}resetPingTimeout(){this.clearTimeoutFn(this.pingTimeoutTimer),this.pingTimeoutTimer=this.setTimeoutFn(()=>{this.onClose("ping timeout")},this.pingInterval+this.pingTimeout),this.opts.autoUnref&&this.pingTimeoutTimer.unref()}onDrain(){this.writeBuffer.splice(0,this.prevBufferLen),this.prevBufferLen=0,this.writeBuffer.length===0?this.emitReserved("drain"):this.flush()}flush(){if(this.readyState!=="closed"&&this.transport.writable&&!this.upgrading&&this.writeBuffer.length){const e=this.getWritablePackets();this.transport.send(e),this.prevBufferLen=e.length,this.emitReserved("flush")}}getWritablePackets(){if(!(this.maxPayload&&this.transport.name==="polling"&&this.writeBuffer.length>1))return this.writeBuffer;let n=1;for(let r=0;r<this.writeBuffer.length;r++){const i=this.writeBuffer[r].data;if(i&&(n+=Ao(i)),r>0&&n>this.maxPayload)return this.writeBuffer.slice(0,r);n+=2}return this.writeBuffer}write(e,n,r){return this.sendPacket("message",e,n,r),this}send(e,n,r){return this.sendPacket("message",e,n,r),this}sendPacket(e,n,r,i){if(typeof n=="function"&&(i=n,n=void 0),typeof r=="function"&&(i=r,r=null),this.readyState==="closing"||this.readyState==="closed")return;r=r||{},r.compress=r.compress!==!1;const s={type:e,data:n,options:r};this.emitReserved("packetCreate",s),this.writeBuffer.push(s),i&&this.once("flush",i),this.flush()}close(){const e=()=>{this.onClose("forced close"),this.transport.close()},n=()=>{this.off("upgrade",n),this.off("upgradeError",n),e()},r=()=>{this.once("upgrade",n),this.once("upgradeError",n)};return(this.readyState==="opening"||this.readyState==="open")&&(this.readyState="closing",this.writeBuffer.length?this.once("drain",()=>{this.upgrading?r():e()}):this.upgrading?r():e()),this}onError(e){Qe.priorWebsocketSuccess=!1,this.emitReserved("error",e),this.onClose("transport error",e)}onClose(e,n){(this.readyState==="opening"||this.readyState==="open"||this.readyState==="closing")&&(this.clearTimeoutFn(this.pingTimeoutTimer),this.transport.removeAllListeners("close"),this.transport.close(),this.transport.removeAllListeners(),typeof removeEventListener=="function"&&(removeEventListener("beforeunload",this.beforeunloadEventListener,!1),removeEventListener("offline",this.offlineEventListener,!1)),this.readyState="closed",this.id=null,this.emitReserved("close",e,n),this.writeBuffer=[],this.prevBufferLen=0)}filterUpgrades(e){const n=[];let r=0;const i=e.length;for(;r<i;r++)~this.transports.indexOf(e[r])&&n.push(e[r]);return n}};ti.protocol=Yr;function Qo(t,e="",n){let r=t;n=n||typeof location<"u"&&location,t==null&&(t=n.protocol+"//"+n.host),typeof t=="string"&&(t.charAt(0)==="/"&&(t.charAt(1)==="/"?t=n.protocol+t:t=n.host+t),/^(https?|wss?):\/\//.test(t)||(typeof n<"u"?t=n.protocol+"//"+t:t="https://"+t),r=pn(t)),r.port||(/^(http|ws)$/.test(r.protocol)?r.port="80":/^(http|ws)s$/.test(r.protocol)&&(r.port="443")),r.path=r.path||"/";const s=r.host.indexOf(":")!==-1?"["+r.host+"]":r.host;return r.id=r.protocol+"://"+s+":"+r.port+e,r.href=r.protocol+"://"+s+(n&&n.port===r.port?"":":"+r.port),r}const $o=typeof ArrayBuffer=="function",Zo=t=>typeof ArrayBuffer.isView=="function"?ArrayBuffer.isView(t):t.buffer instanceof ArrayBuffer,ni=Object.prototype.toString,ea=typeof Blob=="function"||typeof Blob<"u"&&ni.call(Blob)==="[object BlobConstructor]",ta=typeof File=="function"||typeof File<"u"&&ni.call(File)==="[object FileConstructor]";function Nn(t){return $o&&(t instanceof ArrayBuffer||Zo(t))||ea&&t instanceof Blob||ta&&t instanceof File}function Mt(t,e){if(!t||typeof t!="object")return!1;if(Array.isArray(t)){for(let n=0,r=t.length;n<r;n++)if(Mt(t[n]))return!0;return!1}if(Nn(t))return!0;if(t.toJSON&&typeof t.toJSON=="function"&&arguments.length===1)return Mt(t.toJSON(),!0);for(const n in t)if(Object.prototype.hasOwnProperty.call(t,n)&&Mt(t[n]))return!0;return!1}function na(t){const e=[],n=t.data,r=t;return r.data=mn(n,e),r.attachments=e.length,{packet:r,buffers:e}}function mn(t,e){if(!t)return t;if(Nn(t)){const n={_placeholder:!0,num:e.length};return e.push(t),n}else if(Array.isArray(t)){const n=new Array(t.length);for(let r=0;r<t.length;r++)n[r]=mn(t[r],e);return n}else if(typeof t=="object"&&!(t instanceof Date)){const n={};for(const r in t)Object.prototype.hasOwnProperty.call(t,r)&&(n[r]=mn(t[r],e));return n}return t}function ra(t,e){return t.data=yn(t.data,e),delete t.attachments,t}function yn(t,e){if(!t)return t;if(t&&t._placeholder===!0){if(typeof t.num=="number"&&t.num>=0&&t.num<e.length)return e[t.num];throw new Error("illegal attachments")}else if(Array.isArray(t))for(let n=0;n<t.length;n++)t[n]=yn(t[n],e);else if(typeof t=="object")for(const n in t)Object.prototype.hasOwnProperty.call(t,n)&&(t[n]=yn(t[n],e));return t}const ia=["connect","connect_error","disconnect","disconnecting","newListener","removeListener"],sa=5;var O;(function(t){t[t.CONNECT=0]="CONNECT",t[t.DISCONNECT=1]="DISCONNECT",t[t.EVENT=2]="EVENT",t[t.ACK=3]="ACK",t[t.CONNECT_ERROR=4]="CONNECT_ERROR",t[t.BINARY_EVENT=5]="BINARY_EVENT",t[t.BINARY_ACK=6]="BINARY_ACK"})(O||(O={}));class oa{constructor(e){this.replacer=e}encode(e){return(e.type===O.EVENT||e.type===O.ACK)&&Mt(e)?this.encodeAsBinary({type:e.type===O.EVENT?O.BINARY_EVENT:O.BINARY_ACK,nsp:e.nsp,data:e.data,id:e.id}):[this.encodeAsString(e)]}encodeAsString(e){let n=""+e.type;return(e.type===O.BINARY_EVENT||e.type===O.BINARY_ACK)&&(n+=e.attachments+"-"),e.nsp&&e.nsp!=="/"&&(n+=e.nsp+","),e.id!=null&&(n+=e.id),e.data!=null&&(n+=JSON.stringify(e.data,this.replacer)),n}encodeAsBinary(e){const n=na(e),r=this.encodeAsString(n.packet),i=n.buffers;return i.unshift(r),i}}function hr(t){return Object.prototype.toString.call(t)==="[object Object]"}class On extends J{constructor(e){super(),this.reviver=e}add(e){let n;if(typeof e=="string"){if(this.reconstructor)throw new Error("got plaintext data when reconstructing a packet");n=this.decodeString(e);const r=n.type===O.BINARY_EVENT;r||n.type===O.BINARY_ACK?(n.type=r?O.EVENT:O.ACK,this.reconstructor=new aa(n),n.attachments===0&&super.emitReserved("decoded",n)):super.emitReserved("decoded",n)}else if(Nn(e)||e.base64)if(this.reconstructor)n=this.reconstructor.takeBinaryData(e),n&&(this.reconstructor=null,super.emitReserved("decoded",n));else throw new Error("got binary data when not reconstructing a packet");else throw new Error("Unknown type: "+e)}decodeString(e){let n=0;const r={type:Number(e.charAt(0))};if(O[r.type]===void 0)throw new Error("unknown packet type "+r.type);if(r.type===O.BINARY_EVENT||r.type===O.BINARY_ACK){const s=n+1;for(;e.charAt(++n)!=="-"&&n!=e.length;);const o=e.substring(s,n);if(o!=Number(o)||e.charAt(n)!=="-")throw new Error("Illegal attachments");r.attachments=Number(o)}if(e.charAt(n+1)==="/"){const s=n+1;for(;++n&&!(e.charAt(n)===","||n===e.length););r.nsp=e.substring(s,n)}else r.nsp="/";const i=e.charAt(n+1);if(i!==""&&Number(i)==i){const s=n+1;for(;++n;){const o=e.charAt(n);if(o==null||Number(o)!=o){--n;break}if(n===e.length)break}r.id=Number(e.substring(s,n+1))}if(e.charAt(++n)){const s=this.tryParse(e.substr(n));if(On.isPayloadValid(r.type,s))r.data=s;else throw new Error("invalid payload")}return r}tryParse(e){try{return JSON.parse(e,this.reviver)}catch{return!1}}static isPayloadValid(e,n){switch(e){case O.CONNECT:return hr(n);case O.DISCONNECT:return n===void 0;case O.CONNECT_ERROR:return typeof n=="string"||hr(n);case O.EVENT:case O.BINARY_EVENT:return Array.isArray(n)&&(typeof n[0]=="number"||typeof n[0]=="string"&&ia.indexOf(n[0])===-1);case O.ACK:case O.BINARY_ACK:return Array.isArray(n)}}destroy(){this.reconstructor&&(this.reconstructor.finishedReconstruction(),this.reconstructor=null)}}class aa{constructor(e){this.packet=e,this.buffers=[],this.reconPack=e}takeBinaryData(e){if(this.buffers.push(e),this.buffers.length===this.reconPack.attachments){const n=ra(this.reconPack,this.buffers);return this.finishedReconstruction(),n}return null}finishedReconstruction(){this.reconPack=null,this.buffers=[]}}const ca=Object.freeze(Object.defineProperty({__proto__:null,Decoder:On,Encoder:oa,get PacketType(){return O},protocol:sa},Symbol.toStringTag,{value:"Module"}));function ge(t,e,n){return t.on(e,n),function(){t.off(e,n)}}const ua=Object.freeze({connect:1,connect_error:1,disconnect:1,disconnecting:1,newListener:1,removeListener:1});class ri extends J{constructor(e,n,r){super(),this.connected=!1,this.recovered=!1,this.receiveBuffer=[],this.sendBuffer=[],this._queue=[],this._queueSeq=0,this.ids=0,this.acks={},this.flags={},this.io=e,this.nsp=n,r&&r.auth&&(this.auth=r.auth),this._opts=Object.assign({},r),this.io._autoConnect&&this.open()}get disconnected(){return!this.connected}subEvents(){if(this.subs)return;const e=this.io;this.subs=[ge(e,"open",this.onopen.bind(this)),ge(e,"packet",this.onpacket.bind(this)),ge(e,"error",this.onerror.bind(this)),ge(e,"close",this.onclose.bind(this))]}get active(){return!!this.subs}connect(){return this.connected?this:(this.subEvents(),this.io._reconnecting||this.io.open(),this.io._readyState==="open"&&this.onopen(),this)}open(){return this.connect()}send(...e){return e.unshift("message"),this.emit.apply(this,e),this}emit(e,...n){if(ua.hasOwnProperty(e))throw new Error('"'+e.toString()+'" is a reserved event name');if(n.unshift(e),this._opts.retries&&!this.flags.fromQueue&&!this.flags.volatile)return this._addToQueue(n),this;const r={type:O.EVENT,data:n};if(r.options={},r.options.compress=this.flags.compress!==!1,typeof n[n.length-1]=="function"){const o=this.ids++,a=n.pop();this._registerAckCallback(o,a),r.id=o}const i=this.io.engine&&this.io.engine.transport&&this.io.engine.transport.writable;return this.flags.volatile&&(!i||!this.connected)||(this.connected?(this.notifyOutgoingListeners(r),this.packet(r)):this.sendBuffer.push(r)),this.flags={},this}_registerAckCallback(e,n){var r;const i=(r=this.flags.timeout)!==null&&r!==void 0?r:this._opts.ackTimeout;if(i===void 0){this.acks[e]=n;return}const s=this.io.setTimeoutFn(()=>{delete this.acks[e];for(let o=0;o<this.sendBuffer.length;o++)this.sendBuffer[o].id===e&&this.sendBuffer.splice(o,1);n.call(this,new Error("operation has timed out"))},i);this.acks[e]=(...o)=>{this.io.clearTimeoutFn(s),n.apply(this,[null,...o])}}emitWithAck(e,...n){const r=this.flags.timeout!==void 0||this._opts.ackTimeout!==void 0;return new Promise((i,s)=>{n.push((o,a)=>r?o?s(o):i(a):i(o)),this.emit(e,...n)})}_addToQueue(e){let n;typeof e[e.length-1]=="function"&&(n=e.pop());const r={id:this._queueSeq++,tryCount:0,pending:!1,args:e,flags:Object.assign({fromQueue:!0},this.flags)};e.push((i,...s)=>r!==this._queue[0]?void 0:(i!==null?r.tryCount>this._opts.retries&&(this._queue.shift(),n&&n(i)):(this._queue.shift(),n&&n(null,...s)),r.pending=!1,this._drainQueue())),this._queue.push(r),this._drainQueue()}_drainQueue(e=!1){if(!this.connected||this._queue.length===0)return;const n=this._queue[0];n.pending&&!e||(n.pending=!0,n.tryCount++,this.flags=n.flags,this.emit.apply(this,n.args))}packet(e){e.nsp=this.nsp,this.io._packet(e)}onopen(){typeof this.auth=="function"?this.auth(e=>{this._sendConnectPacket(e)}):this._sendConnectPacket(this.auth)}_sendConnectPacket(e){this.packet({type:O.CONNECT,data:this._pid?Object.assign({pid:this._pid,offset:this._lastOffset},e):e})}onerror(e){this.connected||this.emitReserved("connect_error",e)}onclose(e,n){this.connected=!1,delete this.id,this.emitReserved("disconnect",e,n)}onpacket(e){if(e.nsp===this.nsp)switch(e.type){case O.CONNECT:e.data&&e.data.sid?this.onconnect(e.data.sid,e.data.pid):this.emitReserved("connect_error",new Error("It seems you are trying to reach a Socket.IO server in v2.x with a v3.x client, but they are not compatible (more information here: https://socket.io/docs/v3/migrating-from-2-x-to-3-0/)"));break;case O.EVENT:case O.BINARY_EVENT:this.onevent(e);break;case O.ACK:case O.BINARY_ACK:this.onack(e);break;case O.DISCONNECT:this.ondisconnect();break;case O.CONNECT_ERROR:this.destroy();const r=new Error(e.data.message);r.data=e.data.data,this.emitReserved("connect_error",r);break}}onevent(e){const n=e.data||[];e.id!=null&&n.push(this.ack(e.id)),this.connected?this.emitEvent(n):this.receiveBuffer.push(Object.freeze(n))}emitEvent(e){if(this._anyListeners&&this._anyListeners.length){const n=this._anyListeners.slice();for(const r of n)r.apply(this,e)}super.emit.apply(this,e),this._pid&&e.length&&typeof e[e.length-1]=="string"&&(this._lastOffset=e[e.length-1])}ack(e){const n=this;let r=!1;return function(...i){r||(r=!0,n.packet({type:O.ACK,id:e,data:i}))}}onack(e){const n=this.acks[e.id];typeof n=="function"&&(n.apply(this,e.data),delete this.acks[e.id])}onconnect(e,n){this.id=e,this.recovered=n&&this._pid===n,this._pid=n,this.connected=!0,this.emitBuffered(),this.emitReserved("connect"),this._drainQueue(!0)}emitBuffered(){this.receiveBuffer.forEach(e=>this.emitEvent(e)),this.receiveBuffer=[],this.sendBuffer.forEach(e=>{this.notifyOutgoingListeners(e),this.packet(e)}),this.sendBuffer=[]}ondisconnect(){this.destroy(),this.onclose("io server disconnect")}destroy(){this.subs&&(this.subs.forEach(e=>e()),this.subs=void 0),this.io._destroy(this)}disconnect(){return this.connected&&this.packet({type:O.DISCONNECT}),this.destroy(),this.connected&&this.onclose("io client disconnect"),this}close(){return this.disconnect()}compress(e){return this.flags.compress=e,this}get volatile(){return this.flags.volatile=!0,this}timeout(e){return this.flags.timeout=e,this}onAny(e){return this._anyListeners=this._anyListeners||[],this._anyListeners.push(e),this}prependAny(e){return this._anyListeners=this._anyListeners||[],this._anyListeners.unshift(e),this}offAny(e){if(!this._anyListeners)return this;if(e){const n=this._anyListeners;for(let r=0;r<n.length;r++)if(e===n[r])return n.splice(r,1),this}else this._anyListeners=[];return this}listenersAny(){return this._anyListeners||[]}onAnyOutgoing(e){return this._anyOutgoingListeners=this._anyOutgoingListeners||[],this._anyOutgoingListeners.push(e),this}prependAnyOutgoing(e){return this._anyOutgoingListeners=this._anyOutgoingListeners||[],this._anyOutgoingListeners.unshift(e),this}offAnyOutgoing(e){if(!this._anyOutgoingListeners)return this;if(e){const n=this._anyOutgoingListeners;for(let r=0;r<n.length;r++)if(e===n[r])return n.splice(r,1),this}else this._anyOutgoingListeners=[];return this}listenersAnyOutgoing(){return this._anyOutgoingListeners||[]}notifyOutgoingListeners(e){if(this._anyOutgoingListeners&&this._anyOutgoingListeners.length){const n=this._anyOutgoingListeners.slice();for(const r of n)r.apply(this,e.data)}}}function nt(t){t=t||{},this.ms=t.min||100,this.max=t.max||1e4,this.factor=t.factor||2,this.jitter=t.jitter>0&&t.jitter<=1?t.jitter:0,this.attempts=0}nt.prototype.duration=function(){var t=this.ms*Math.pow(this.factor,this.attempts++);if(this.jitter){var e=Math.random(),n=Math.floor(e*this.jitter*t);t=Math.floor(e*10)&1?t+n:t-n}return Math.min(t,this.max)|0};nt.prototype.reset=function(){this.attempts=0};nt.prototype.setMin=function(t){this.ms=t};nt.prototype.setMax=function(t){this.max=t};nt.prototype.setJitter=function(t){this.jitter=t};class gn extends J{constructor(e,n){var r;super(),this.nsps={},this.subs=[],e&&typeof e=="object"&&(n=e,e=void 0),n=n||{},n.path=n.path||"/socket.io",this.opts=n,Wt(this,n),this.reconnection(n.reconnection!==!1),this.reconnectionAttempts(n.reconnectionAttempts||1/0),this.reconnectionDelay(n.reconnectionDelay||1e3),this.reconnectionDelayMax(n.reconnectionDelayMax||5e3),this.randomizationFactor((r=n.randomizationFactor)!==null&&r!==void 0?r:.5),this.backoff=new nt({min:this.reconnectionDelay(),max:this.reconnectionDelayMax(),jitter:this.randomizationFactor()}),this.timeout(n.timeout==null?2e4:n.timeout),this._readyState="closed",this.uri=e;const i=n.parser||ca;this.encoder=new i.Encoder,this.decoder=new i.Decoder,this._autoConnect=n.autoConnect!==!1,this._autoConnect&&this.open()}reconnection(e){return arguments.length?(this._reconnection=!!e,this):this._reconnection}reconnectionAttempts(e){return e===void 0?this._reconnectionAttempts:(this._reconnectionAttempts=e,this)}reconnectionDelay(e){var n;return e===void 0?this._reconnectionDelay:(this._reconnectionDelay=e,(n=this.backoff)===null||n===void 0||n.setMin(e),this)}randomizationFactor(e){var n;return e===void 0?this._randomizationFactor:(this._randomizationFactor=e,(n=this.backoff)===null||n===void 0||n.setJitter(e),this)}reconnectionDelayMax(e){var n;return e===void 0?this._reconnectionDelayMax:(this._reconnectionDelayMax=e,(n=this.backoff)===null||n===void 0||n.setMax(e),this)}timeout(e){return arguments.length?(this._timeout=e,this):this._timeout}maybeReconnectOnOpen(){!this._reconnecting&&this._reconnection&&this.backoff.attempts===0&&this.reconnect()}open(e){if(~this._readyState.indexOf("open"))return this;this.engine=new ti(this.uri,this.opts);const n=this.engine,r=this;this._readyState="opening",this.skipReconnect=!1;const i=ge(n,"open",function(){r.onopen(),e&&e()}),s=a=>{this.cleanup(),this._readyState="closed",this.emitReserved("error",a),e?e(a):this.maybeReconnectOnOpen()},o=ge(n,"error",s);if(this._timeout!==!1){const a=this._timeout,u=this.setTimeoutFn(()=>{i(),s(new Error("timeout")),n.close()},a);this.opts.autoUnref&&u.unref(),this.subs.push(()=>{this.clearTimeoutFn(u)})}return this.subs.push(i),this.subs.push(o),this}connect(e){return this.open(e)}onopen(){this.cleanup(),this._readyState="open",this.emitReserved("open");const e=this.engine;this.subs.push(ge(e,"ping",this.onping.bind(this)),ge(e,"data",this.ondata.bind(this)),ge(e,"error",this.onerror.bind(this)),ge(e,"close",this.onclose.bind(this)),ge(this.decoder,"decoded",this.ondecoded.bind(this)))}onping(){this.emitReserved("ping")}ondata(e){try{this.decoder.add(e)}catch(n){this.onclose("parse error",n)}}ondecoded(e){En(()=>{this.emitReserved("packet",e)},this.setTimeoutFn)}onerror(e){this.emitReserved("error",e)}socket(e,n){let r=this.nsps[e];return r?this._autoConnect&&!r.active&&r.connect():(r=new ri(this,e,n),this.nsps[e]=r),r}_destroy(e){const n=Object.keys(this.nsps);for(const r of n)if(this.nsps[r].active)return;this._close()}_packet(e){const n=this.encoder.encode(e);for(let r=0;r<n.length;r++)this.engine.write(n[r],e.options)}cleanup(){this.subs.forEach(e=>e()),this.subs.length=0,this.decoder.destroy()}_close(){this.skipReconnect=!0,this._reconnecting=!1,this.onclose("forced close"),this.engine&&this.engine.close()}disconnect(){return this._close()}onclose(e,n){this.cleanup(),this.backoff.reset(),this._readyState="closed",this.emitReserved("close",e,n),this._reconnection&&!this.skipReconnect&&this.reconnect()}reconnect(){if(this._reconnecting||this.skipReconnect)return this;const e=this;if(this.backoff.attempts>=this._reconnectionAttempts)this.backoff.reset(),this.emitReserved("reconnect_failed"),this._reconnecting=!1;else{const n=this.backoff.duration();this._reconnecting=!0;const r=this.setTimeoutFn(()=>{e.skipReconnect||(this.emitReserved("reconnect_attempt",e.backoff.attempts),!e.skipReconnect&&e.open(i=>{i?(e._reconnecting=!1,e.reconnect(),this.emitReserved("reconnect_error",i)):e.onreconnect()}))},n);this.opts.autoUnref&&r.unref(),this.subs.push(()=>{this.clearTimeoutFn(r)})}}onreconnect(){const e=this.backoff.attempts;this._reconnecting=!1,this.backoff.reset(),this.emitReserved("reconnect",e)}}const st={};function Ft(t,e){typeof t=="object"&&(e=t,t=void 0),e=e||{};const n=Qo(t,e.path||"/socket.io"),r=n.source,i=n.id,s=n.path,o=st[i]&&s in st[i].nsps,a=e.forceNew||e["force new connection"]||e.multiplex===!1||o;let u;return a?u=new gn(r,e):(st[i]||(st[i]=new gn(r,e)),u=st[i]),n.query&&!e.query&&(e.query=n.queryKey),u.socket(n.path,e)}Object.assign(Ft,{Manager:gn,Socket:ri,io:Ft,connect:Ft});class la{constructor(){U(this,"connecting",te(!1));U(this,"connectError",te(""));U(this,"instrumentName",te("acoustic_grand_piano"));U(this,"connectedColorHues",te(new Map));U(this,"connected",te(!1));U(this,"threadMap",new Map);U(this,"originalThread",{audioNodeMap:new Map,colorHue:"220"});U(this,"socket",null);U(this,"onPlayNote");U(this,"onStopNote");this.threadMap.set("0",this.originalThread),this.instrumentName.subscribe(e=>{var n;this.socket&&this.socket.emit("instrument_change",{instrumentName:e}),this.loadInstrument(e,((n=this.socket)==null?void 0:n.id)??"0")})}async loadInstrument(e,n){let r=await Kr(e),i=this.threadMap.get(n);i&&(i.instrument=r)}addThread({socketID:e,colorHue:n,instrumentName:r}){this.threadMap.set(e,{audioNodeMap:e===this.socket.id?this.originalThread.audioNodeMap:new Map,colorHue:n}),this.connectedColorHues.set(Se(this.connectedColorHues).set(e,n)),r&&this.loadInstrument(r,e)}clean(){this.socket.removeAllListeners(),this.socket=null,this.connecting.set(!1),this.connected.set(!1),this.threadMap.clear(),this.threadMap.set("0",this.originalThread)}connect(e){if(Se(this.connecting)||Se(this.connected))return;if(e.length>100)return this.connectError.set("Room name to long!");const n="https://piano-backend.onrender.com";this.connectError.set(""),this.connecting.set(!0),this.socket=Ft(n,{query:{roomName:e,instrumentName:Se(this.instrumentName)},path:{}.VITE_BACKEND_PATH,reconnection:!1,timeout:1e3*60}),this.socket.on("connect_error",r=>{this.clean(),this.connectError.set("Failed to connect to server: "+r.message)}),this.socket.on("error_message",r=>{this.connectError.set(r)}),this.socket.on("connect_timeout",()=>{this.clean(),this.connectError.set("Timed out while connecting to server!")}),this.socket.on("connect",()=>{this.connecting.set(!1),this.connected.set(!0),this.threadMap.delete("0"),Se(this.connectedColorHues).clear(),history.replaceState({},void 0,`?room=${e}`),document.title=`Room ${e} - Play Piano!`}),this.socket.on("disconnect",()=>{this.clean(),history.replaceState({},void 0,location.pathname),document.title="Play Piano!"}),this.socket.on("play_note",r=>{this.onPlayNote(r,this.threadMap.get(r.socketID))}),this.socket.on("stop_note",r=>{this.onStopNote(r,this.threadMap.get(r.socketID))}),this.socket.on("instrument_change",r=>{this.loadInstrument(r.instrumentName,r.socketID)}),this.socket.on("client_connect",r=>{this.addThread(r)}),this.socket.on("client_list_recieve",r=>{for(let i of r)this.addThread(i)}),this.socket.on("client_disconnect",r=>{const i=Se(this.connectedColorHues);i.delete(r),this.connectedColorHues.set(i),this.threadMap.delete(r)})}playNote(e,n){var s;const r={note:e,volume:n};this.socket&&this.socket.emit("play_note",r);let i=this.threadMap.get(((s=this.socket)==null?void 0:s.id)??"0");this.onPlayNote(r,i)}stopNote(e,n){var s;const r={note:e,sustain:n};this.socket&&this.socket.emit("stop_note",r);let i=this.threadMap.get(((s=this.socket)==null?void 0:s.id)??"0");this.onStopNote(r,i)}}const ii=""+new URL("spinner-2868f450.svg",import.meta.url).href;function fr(t,e,n){const r=t.slice();return r[60]=e[n][0],r[61]=e[n][1],r}function dr(t,e,n){const r=t.slice();return r[64]=e[n],r}function pr(t){let e,n=t[64]+"",r;return{c(){e=_("option"),r=be(n),e.__value=t[64],j(e,e.__value)},m(i,s){q(i,e,s),y(e,r)},p:D,d(i){i&&R(e)}}}function ha(t){return{c:D,m:D,p:D,d:D}}function fa(t){return{c:D,m:D,p:D,d:D}}function da(t){let e,n;return{c(){e=_("img"),kr(e.src,n=ii)||b(e,"src",n),b(e,"alt","spinner"),b(e,"class","svelte-1b92m69")},m(r,i){q(r,e,i)},p:D,d(r){r&&R(e)}}}function pa(t){let e,n,r;return{c(){e=_("button"),e.textContent="Play"},m(i,s){q(i,e,s),n||(r=N(e,"click",t[47]),n=!0)},p:D,d(i){i&&R(e),n=!1,r()}}}function ma(t){let e,n,r;return{c(){e=_("button"),e.textContent="Pause"},m(i,s){q(i,e,s),n||(r=N(e,"click",t[46]),n=!0)},p:D,d(i){i&&R(e),n=!1,r()}}}function ya(t){let e,n,r,i;return{c(){e=_("button"),n=be("Join"),e.disabled=t[15]},m(s,o){q(s,e,o),y(e,n),r||(i=N(e,"click",t[58]),r=!0)},p(s,o){o[0]&32768&&(e.disabled=s[15])},d(s){s&&R(e),r=!1,i()}}}function ga(t){let e,n,r,i,s,o,a,u,c,p,f=tt(Array.from(t[14].entries())),l=[];for(let h=0;h<f.length;h+=1)l[h]=yr(fr(t,f,h));return{c(){e=_("button"),e.textContent="Leave",n=A(),r=_("span"),r.textContent="Connected!",i=_("br"),s=A(),o=_("span"),o.textContent="People:",a=A();for(let h=0;h<l.length;h+=1)l[h].c();u=Tr()},m(h,d){q(h,e,d),q(h,n,d),q(h,r,d),q(h,i,d),q(h,s,d),q(h,o,d),q(h,a,d);for(let m=0;m<l.length;m+=1)l[m]&&l[m].m(h,d);q(h,u,d),c||(p=N(e,"click",t[57]),c=!0)},p(h,d){if(d[0]&16385){f=tt(Array.from(h[14].entries()));let m;for(m=0;m<f.length;m+=1){const v=fr(h,f,m);l[m]?l[m].p(v,d):(l[m]=yr(v),l[m].c(),l[m].m(u.parentNode,u))}for(;m<l.length;m+=1)l[m].d(1);l.length=f.length}},d(h){h&&(R(e),R(n),R(r),R(i),R(s),R(o),R(a),R(u)),vn(l,h),c=!1,p()}}}function mr(t){let e;return{c(){e=_("span"),e.textContent="(you)",Ze(e,"margin-right","0.5rem")},m(n,r){q(n,e,r)},d(n){n&&R(e)}}}function yr(t){let e,n,r,i,s=t[60]===t[0].socket.id&&mr();return{c(){e=_("div"),r=A(),s&&s.c(),i=Tr(),b(e,"class","icon svelte-1b92m69"),b(e,"style",n=`--color-hue: ${t[61]}`)},m(o,a){q(o,e,a),q(o,r,a),s&&s.m(o,a),q(o,i,a)},p(o,a){a[0]&16384&&n!==(n=`--color-hue: ${o[61]}`)&&b(e,"style",n),o[60]===o[0].socket.id?s||(s=mr(),s.c(),s.m(i.parentNode,i)):s&&(s.d(1),s=null)},d(o){o&&(R(e),R(r),R(i)),s&&s.d(o)}}}function ba(t){let e,n,r,i;return{c(){e=_("span"),e.textContent="Connecting...",n=A(),r=_("img"),kr(r.src,i=ii)||b(r,"src",i),b(r,"alt","spinner"),b(r,"class","svelte-1b92m69")},m(s,o){q(s,e,o),q(s,n,o),q(s,r,o)},p:D,d(s){s&&(R(e),R(n),R(r))}}}function va(t){let e,n;return{c(){e=_("span"),n=be(t[16]),b(e,"class","error svelte-1b92m69")},m(r,i){q(r,e,i),y(e,n)},p(r,i){i[0]&65536&&Rt(n,r[16])},d(r){r&&R(e)}}}function _a(t){let e,n,r,i,s,o,a,u,c,p,f,l,h,d,m,v,I,V,x,S,C,M,T,w,E,B,$,H,W,de,Y,ce,re,ue,le,g,P,F,De,ft,pe,Pe,Ae,Be,dt,ie,Ve,pt,je,Ue,mt,ve,rt,Ke,yt,se,it,gt,ae,bt,me,vt,k,_e,xe,Z,Pn,_t=t[10].toFixed(1)+"",Yt,An,kt=t[12].toFixed(1)+"",Xt,Bn,Un,ye,wt,Mn,ke,Fn,Qt,$t,Rn,He=tt(Wn),ee=[];for(let K=0;K<He.length;K+=1)ee[K]=pr(dr(t,He,K));let he={ctx:t,current:null,token:null,hasCatch:!1,pending:da,then:fa,catch:ha};zn(B=t[3],he);function Dn(K,L){return K[9]?ma:pa}let Tt=Dn(t),we=Tt(t);function Ln(K,L){return K[13]?ga:ya}let St=Ln(t),Te=St(t);function qn(K,L){if(K[16])return va;if(K[15])return ba}let Je=qn(t),oe=Je&&Je(t);return{c(){e=_("div"),n=_("div"),r=_("div"),i=_("div"),s=_("span"),s.textContent="Sustain",o=A(),a=_("input"),u=A(),c=_("div"),p=_("span"),p.textContent="Octave Shift",f=A(),l=_("input"),h=A(),d=_("div"),m=_("span"),m.textContent="Volume",v=A(),I=_("input"),V=A(),x=_("input"),S=A(),C=_("div"),M=_("span"),M.textContent="Instrument",T=A(),w=_("select");for(let K=0;K<ee.length;K+=1)ee[K].c();E=A(),he.block.c(),$=A(),H=_("div"),W=_("span"),W.textContent="Size",de=A(),Y=_("select"),ce=_("option"),ce.textContent="Full size (88 keys)",re=_("option"),re.textContent="Half size (61 keys)",ue=_("option"),ue.textContent="Quater Size (37 keys)",le=_("option"),le.textContent="2 Octaves (24 keys)",g=_("option"),g.textContent="1 Octave (12 keys)",P=A(),F=_("div"),De=_("span"),De.textContent="Labels",ft=A(),pe=_("select"),Pe=_("option"),Pe.textContent="None",Ae=_("option"),Ae.textContent="Notes",Be=_("option"),Be.textContent="Key binds",dt=A(),ie=_("div"),Ve=_("p"),Ve.textContent="Play a midi:",pt=A(),je=_("div"),Ue=_("input"),mt=A(),ve=_("div"),we.c(),rt=A(),Ke=_("button"),Ke.textContent="Restart",yt=A(),se=_("div"),it=_("span"),it.textContent="Speed",gt=A(),ae=_("input"),bt=A(),me=_("input"),vt=be("times"),k=_("br"),_e=A(),xe=_("div"),Z=_("input"),Pn=A(),Yt=be(_t),An=be("/"),Xt=be(kt),Bn=be(" seconds"),Un=A(),ye=_("div"),wt=_("p"),wt.textContent="Join a room:",Mn=A(),ke=_("input"),Fn=A(),Te.c(),Qt=A(),oe&&oe.c(),b(s,"class","svelte-1b92m69"),b(a,"type","checkbox"),b(a,"class","svelte-1b92m69"),b(i,"title","Shortcut: space"),b(i,"class","svelte-1b92m69"),b(p,"class","svelte-1b92m69"),b(l,"type","number"),b(l,"min","-3"),b(l,"max","3"),b(l,"class","svelte-1b92m69"),b(c,"title","Shortcut: left ctrl +, left alt or right ctrl -"),b(c,"class","svelte-1b92m69"),b(m,"class","svelte-1b92m69"),b(I,"type","range"),b(I,"min","0"),b(I,"max","10"),b(I,"step","0.1"),Ze(I,"width","8rem"),b(I,"class","svelte-1b92m69"),b(x,"type","number"),b(x,"class","svelte-1b92m69"),b(d,"class","svelte-1b92m69"),b(M,"class","svelte-1b92m69"),t[1]===void 0&&lt(()=>t[42].call(w)),b(C,"class","svelte-1b92m69"),b(W,"class","svelte-1b92m69"),b(ce,"data-range","A0,C8"),ce.__value="Full size (88 keys)",j(ce,ce.__value),b(re,"data-range","C2,C7"),re.selected=!0,re.__value="Half size (61 keys)",j(re,re.__value),b(ue,"data-range","C3,C6"),ue.__value="Quater Size (37 keys)",j(ue,ue.__value),b(le,"data-range","C4,B5"),le.__value="2 Octaves (24 keys)",j(le,le.__value),b(g,"data-range","C4,B4"),g.__value="1 Octave (12 keys)",j(g,g.__value),b(H,"class","svelte-1b92m69"),b(De,"class","svelte-1b92m69"),Pe.__value="none",j(Pe,Pe.__value),Ae.__value="notes",j(Ae,Ae.__value),Be.__value="keybinds",j(Be,Be.__value),t[7]===void 0&&lt(()=>t[44].call(pe)),b(F,"class","svelte-1b92m69"),b(r,"class","option-list svelte-1b92m69"),b(Ve,"class","svelte-1b92m69"),b(Ue,"type","file"),b(Ue,"accept",".midi,.mid"),b(Ue,"class","svelte-1b92m69"),b(je,"class","svelte-1b92m69"),Ze(ve,"margin","0.2rem 0 0.2rem 0"),b(ve,"class","svelte-1b92m69"),b(ae,"type","range"),b(ae,"min","0.01"),b(ae,"max","4"),b(ae,"step","0.01"),b(ae,"class","svelte-1b92m69"),b(me,"type","number"),b(me,"min","0.01"),b(me,"class","svelte-1b92m69"),b(se,"title","Double click to set speed to normal"),b(se,"class","svelte-1b92m69"),b(Z,"type","range"),b(Z,"min","0"),b(Z,"max",t[12]),b(Z,"step","0.1"),Ze(Z,"width","18rem"),b(Z,"class","svelte-1b92m69"),b(xe,"class","svelte-1b92m69"),b(ie,"class","svelte-1b92m69"),b(n,"class","row svelte-1b92m69"),b(wt,"class","svelte-1b92m69"),b(ke,"type","text"),b(ke,"placeholder","Room name"),b(ke,"class","svelte-1b92m69"),b(e,"class","control-panel svelte-1b92m69")},m(K,L){q(K,e,L),y(e,n),y(n,r),y(r,i),y(i,s),y(i,o),y(i,a),a.checked=t[4],y(r,u),y(r,c),y(c,p),y(c,f),y(c,l),j(l,t[5]),y(r,h),y(r,d),y(d,m),y(d,v),y(d,I),j(I,t[6]),y(d,V),y(d,x),j(x,t[6]),y(r,S),y(r,C),y(C,M),y(C,T),y(C,w);for(let X=0;X<ee.length;X+=1)ee[X]&&ee[X].m(w,null);Ct(w,t[1],!0),y(C,E),he.block.m(C,he.anchor=null),he.mount=()=>C,he.anchor=null,y(r,$),y(r,H),y(H,W),y(H,de),y(H,Y),y(Y,ce),y(Y,re),y(Y,ue),y(Y,le),y(Y,g),y(r,P),y(r,F),y(F,De),y(F,ft),y(F,pe),y(pe,Pe),y(pe,Ae),y(pe,Be),Ct(pe,t[7],!0),y(n,dt),y(n,ie),y(ie,Ve),y(ie,pt),y(ie,je),y(je,Ue),y(ie,mt),y(ie,ve),we.m(ve,null),y(ve,rt),y(ve,Ke),y(ie,yt),y(ie,se),y(se,it),y(se,gt),y(se,ae),j(ae,t[11]),y(se,bt),y(se,me),j(me,t[11]),y(se,vt),y(se,k),y(ie,_e),y(ie,xe),y(xe,Z),j(Z,t[10]),y(xe,Pn),y(xe,Yt),y(xe,An),y(xe,Xt),y(xe,Bn),y(e,Un),y(e,ye),y(ye,wt),y(ye,Mn),y(ye,ke),j(ke,t[2]),y(ye,Fn),Te.m(ye,null),y(ye,Qt),oe&&oe.m(ye,null),$t||(Rn=[N(window,"keydown",t[34]),N(window,"keyup",t[35]),N(window,"load",t[32]),N(a,"change",t[38]),N(l,"input",t[39]),N(I,"change",t[40]),N(I,"input",t[40]),N(x,"input",t[41]),N(w,"change",t[42]),N(Y,"change",t[43]),ui(t[33].call(null,Y)),N(pe,"change",t[44]),N(Ue,"change",t[45]),N(Ke,"click",t[48]),N(ae,"change",t[49]),N(ae,"input",t[49]),N(me,"input",t[50]),N(se,"click",t[51]),N(Z,"change",t[52]),N(Z,"input",t[52]),N(Z,"mousedown",t[53]),N(Z,"mouseup",t[54]),N(ke,"input",t[55]),N(ke,"keydown",t[56])],$t=!0)},p(K,L){if(t=K,L[0]&16&&(a.checked=t[4]),L[0]&32&&Ee(l.value)!==t[5]&&j(l,t[5]),L[0]&64&&j(I,t[6]),L[0]&64&&Ee(x.value)!==t[6]&&j(x,t[6]),L&0){He=tt(Wn);let X;for(X=0;X<He.length;X+=1){const Vn=dr(t,He,X);ee[X]?ee[X].p(Vn,L):(ee[X]=pr(Vn),ee[X].c(),ee[X].m(w,null))}for(;X<ee.length;X+=1)ee[X].d(1);ee.length=He.length}L[0]&2&&Ct(w,t[1]),he.ctx=t,L[0]&8&&B!==(B=t[3])&&zn(B,he)||_i(he,t,L),L[0]&128&&Ct(pe,t[7]),Tt===(Tt=Dn(t))&&we?we.p(t,L):(we.d(1),we=Tt(t),we&&(we.c(),we.m(ve,rt))),L[0]&2048&&j(ae,t[11]),L[0]&2048&&Ee(me.value)!==t[11]&&j(me,t[11]),L[0]&4096&&b(Z,"max",t[12]),L[0]&1024&&j(Z,t[10]),L[0]&1024&&_t!==(_t=t[10].toFixed(1)+"")&&Rt(Yt,_t),L[0]&4096&&kt!==(kt=t[12].toFixed(1)+"")&&Rt(Xt,kt),L[0]&4&&ke.value!==t[2]&&j(ke,t[2]),St===(St=Ln(t))&&Te?Te.p(t,L):(Te.d(1),Te=St(t),Te&&(Te.c(),Te.m(ye,Qt))),Je===(Je=qn(t))&&oe?oe.p(t,L):(oe&&oe.d(1),oe=Je&&Je(t),oe&&(oe.c(),oe.m(ye,null)))},i:D,o:D,d(K){K&&R(e),vn(ee,K),he.block.d(),he.token=null,he=null,we.d(),Te.d(),oe&&oe.d(),$t=!1,Re(Rn)}}}class ka{constructor(){U(this,"octaveShift",te(0));U(this,"sustain",te(!1));U(this,"volume",te(5));U(this,"noteRange",te(["C2","C7"]));U(this,"labelType",te("keybinds"))}}function wa(t,e,n){let r,i,s,o,a,u,c,p,f,l,h,d,m,v,I,V,x="",{controlPanelData:S}=e,{midiPlayer:C}=e,{socketPlayer:M}=e,{noteRange:T,sustain:w,octaveShift:E,volume:B,labelType:$}=S;z(t,T,k=>n(59,o=k)),z(t,w,k=>n(4,i=k)),z(t,E,k=>n(5,s=k)),z(t,B,k=>n(6,u=k)),z(t,$,k=>n(7,c=k));let{midiFile:H,midiIsPlaying:W,midiCurrentTime:de,midiSpeed:Y,midiTotalTime:ce}=C;z(t,H,k=>n(8,p=k)),z(t,W,k=>n(9,f=k)),z(t,de,k=>n(10,l=k)),z(t,Y,k=>n(11,h=k)),z(t,ce,k=>n(12,d=k));let{instrumentName:re,connected:ue,connecting:le,connectError:g,connectedColorHues:P}=M;z(t,re,k=>n(1,a=k)),z(t,ue,k=>n(13,m=k)),z(t,le,k=>n(15,I=k)),z(t,g,k=>n(16,V=k)),z(t,P,k=>n(14,v=k)),E.subscribe(k=>k??0);function F(){const _e=new URLSearchParams(location.search).get("room");_e!=null&&(n(2,x=_e),M.connect(x))}function De(k){const _e=k.children[k.selectedIndex];Q(T,o=_e.dataset.range.split(","),o)}function ft(k){k.target.tagName!=="INPUT"&&(k.code==="Space"&&Q(w,i=!0,i),k.code==="ControlLeft"||k.code=="AltRight"?Q(E,s-=1,s):(k.code==="AltLeft"||k.code=="ControlRight")&&Q(E,s+=1,s),s<-3?Q(E,s=3,s):s>3&&Q(E,s=-3,s))}function pe(k){k.code==="Space"&&Q(w,i=!1,i)}function Pe(){i=this.checked,w.set(i)}function Ae(){s=Ee(this.value),E.set(s)}function Be(){u=Ee(this.value),B.set(u)}function dt(){u=Ee(this.value),B.set(u)}function ie(){a=Kn(this),re.set(a)}const Ve=k=>De(k.currentTarget);function pt(){c=Kn(this),$.set(c)}const je=k=>{var _e;return Q(H,p=(_e=k.currentTarget.files)==null?void 0:_e[0],p)},Ue=()=>Q(W,f=!1,f),mt=()=>Q(W,f=!0,f),ve=()=>{Q(de,l=0,l),Q(W,f=!1,f),setTimeout(()=>Q(W,f=!0,f),100)};function rt(){h=Ee(this.value),Y.set(h)}function Ke(){h=Ee(this.value),Y.set(h)}const yt=k=>{k.detail==2&&Q(Y,h=1,h)};function se(){l=Ee(this.value),de.set(l)}const it=()=>Q(W,f=!1,f),gt=()=>Q(W,f=!0,f);function ae(){x=this.value,n(2,x)}const bt=k=>{k.code==="Enter"&&M.connect(x)},me=()=>M.socket.disconnect(),vt=()=>M.connect(x);return t.$$set=k=>{"controlPanelData"in k&&n(36,S=k.controlPanelData),"midiPlayer"in k&&n(37,C=k.midiPlayer),"socketPlayer"in k&&n(0,M=k.socketPlayer)},t.$$.update=()=>{t.$$.dirty[0]&2&&n(3,r=Kr(a))},[M,a,x,r,i,s,u,c,p,f,l,h,d,m,v,I,V,T,w,E,B,$,H,W,de,Y,ce,re,ue,le,g,P,F,De,ft,pe,S,C,Pe,Ae,Be,dt,ie,Ve,pt,je,Ue,mt,ve,rt,Ke,yt,se,it,gt,ae,bt,me,vt]}class Ta extends wn{constructor(e){super(),kn(this,e,wa,_a,Vt,{controlPanelData:36,midiPlayer:37,socketPlayer:0},null,[-1,-1,-1])}}function gr(t,e,n){const r=t.slice();return r[33]=e[n][0],r[34]=e[n][1].isWhite,r[35]=e[n][1].pressedColor,r}function br(t){let e,n=t[15](t[33],t[5],t[4])+"",r,i,s,o,a;function u(...l){return t[23](t[33],...l)}function c(){return t[24](t[33])}function p(){return t[25](t[33])}function f(){return t[26](t[33])}return{c(){e=_("div"),r=be(n),i=A(),b(e,"class",s="key "+(t[34]?"white":"black")+" svelte-1569eu9"),Ze(e,"--color-hue",t[35]),Hn(e,"pressed",t[35]!==null)},m(l,h){q(l,e,h),y(e,r),y(e,i),o||(a=[N(e,"pointerdown",u),N(e,"pointerenter",c),N(e,"pointerleave",p),N(e,"pointerup",f)],o=!0)},p(l,h){t=l,h[0]&56&&n!==(n=t[15](t[33],t[5],t[4])+"")&&Rt(r,n),h[0]&8&&s!==(s="key "+(t[34]?"white":"black")+" svelte-1569eu9")&&b(e,"class",s),h[0]&8&&Ze(e,"--color-hue",t[35]),h[0]&8&&Hn(e,"pressed",t[35]!==null)},d(l){l&&R(e),o=!1,Re(a)}}}function Sa(t){let e,n,r,i,s=tt(Object.entries(t[3])),o=[];for(let a=0;a<s.length;a+=1)o[a]=br(gr(t,s,a));return{c(){e=_("div"),n=_("div");for(let a=0;a<o.length;a+=1)o[a].c();b(n,"class","piano svelte-1569eu9"),b(e,"class","piano-container svelte-1569eu9")},m(a,u){q(a,e,u),y(e,n);for(let c=0;c<o.length;c+=1)o[c]&&o[c].m(n,null);t[27](e),r||(i=[N(window,"resize",t[20]),N(window,"keyup",t[14]),N(window,"keydown",t[13]),N(window,"pointerdown",t[21]),N(window,"pointerup",t[22]),N(n,"touchstart",li(t[19]))],r=!0)},p(a,u){if(u[0]&35898){s=tt(Object.entries(a[3]));let c;for(c=0;c<s.length;c+=1){const p=gr(a,s,c);o[c]?o[c].p(p,u):(o[c]=br(p),o[c].c(),o[c].m(n,null))}for(;c<o.length;c+=1)o[c].d(1);o.length=s.length}},i:D,o:D,d(a){a&&R(e),vn(o,a),t[27](null),r=!1,Re(i)}}}function vr(t,e){e.get(t)&&(e.get(t).stop(),e.delete(t))}function Ia(t,e,n){let r,i,s,o,a=!1,u,c,p,f=new Map,{controlPanelData:l}=e,{noteRange:h,sustain:d,octaveShift:m,volume:v,labelType:I}=l;z(t,d,g=>n(28,r=g)),z(t,m,g=>n(4,s=g)),z(t,v,g=>n(29,i=g)),z(t,I,g=>n(5,o=g));let{midiPlayer:V}=e;V.onPlayNote=C,V.onStopNote=M;let{socketPlayer:x}=e;x.onPlayNote=({note:g,volume:P},F)=>{p[g]&&n(3,p[g].pressedColor=F.colorHue,p),F.instrument&&(vr(g,F.audioNodeMap),F.audioNodeMap.set(g,F.instrument.play(g,void 0,{gain:P})))},x.onStopNote=({note:g,sustain:P},F)=>{p[g]&&n(3,p[g].pressedColor=null,p),P||vr(g,F.audioNodeMap)},h.subscribe(g=>{n(3,[p,u]=hs(g[0],g[1]),p,n(0,u))});function S(g){const P=qt(g)+s;return ct(g)+P}function C(g,P){const F=S(g);f.has(F)||(p[g]&&n(3,p[g].isGhost=!0,p),f.set(F,!0),x.playNote(F,i*P))}function M(g){const P=S(g);f.has(P)&&(p[g]&&n(3,p[g].isGhost=!1,p),f.delete(P),x.stopNote(P,r))}d.subscribe(g=>{if(!g)for(const P of x.originalThread.audioNodeMap.keys())f.get(P)||x.stopNote(P,!1)}),m.subscribe(()=>{for(const g of f.keys())x.stopNote(g,r)});function T(g){if(c){const P=c.clientHeight/6,F=c.offsetWidth/g;c.style.setProperty("--white-key-width",`${Math.min(F,P)}px`)}}fi(()=>{T(u)});function w(g){const P=Qn[g.code],F=g.target;P&&F.tagName!=="INPUT"&&(g.preventDefault(),C(P,.5))}function E(g){const P=Qn[g.code];P&&M(P)}function B(g,P,F){switch(P){case"none":return"";case"notes":return ct(g);case"keybinds":return g=ct(g)+(qt(g)-F),ls[g]??""}}function $(g){di.call(this,t,g)}const H=()=>T(u),W=()=>n(1,a=!0),de=()=>n(1,a=!1),Y=(g,P)=>{P.currentTarget.releasePointerCapture(P.pointerId),C(g,.5)},ce=g=>{a&&C(g,.5)},re=g=>M(g),ue=g=>M(g);function le(g){cn[g?"unshift":"push"](()=>{c=g,n(2,c)})}return t.$$set=g=>{"controlPanelData"in g&&n(18,l=g.controlPanelData),"midiPlayer"in g&&n(16,V=g.midiPlayer),"socketPlayer"in g&&n(17,x=g.socketPlayer)},t.$$.update=()=>{t.$$.dirty[0]&1&&T(u)},[u,a,c,p,s,o,d,m,v,I,C,M,T,w,E,B,V,x,l,$,H,W,de,Y,ce,re,ue,le]}class Ca extends wn{constructor(e){super(),kn(this,e,Ia,Sa,Vt,{controlPanelData:18,midiPlayer:16,socketPlayer:17},null,[-1,-1])}}function xa(t){let e,n,r,i,s;return n=new Ta({props:{controlPanelData:t[0],midiPlayer:t[1],socketPlayer:t[2]}}),i=new Ca({props:{controlPanelData:t[0],midiPlayer:t[1],socketPlayer:t[2]}}),{c(){e=_("main"),Gn(n.$$.fragment),r=A(),Gn(i.$$.fragment),b(e,"class","svelte-ieeeet")},m(o,a){q(o,e,a),hn(n,e,null),y(e,r),hn(i,e,null),s=!0},p:D,i(o){s||(Dt(n.$$.fragment,o),Dt(i.$$.fragment,o),s=!0)},o(o){ln(n.$$.fragment,o),ln(i.$$.fragment,o),s=!1},d(o){o&&R(e),fn(n),fn(i)}}}function Ea(t){const e=new ka,n=new vo,r=new la;return[e,n,r]}class Na extends wn{constructor(e){super(),kn(this,e,Ea,xa,Vt,{})}}new Na({target:document.body});

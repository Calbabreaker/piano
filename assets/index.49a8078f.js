(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))r(i);new MutationObserver(i=>{for(const o of i)if(o.type==="childList")for(const s of o.addedNodes)s.tagName==="LINK"&&s.rel==="modulepreload"&&r(s)}).observe(document,{childList:!0,subtree:!0});function n(i){const o={};return i.integrity&&(o.integrity=i.integrity),i.referrerpolicy&&(o.referrerPolicy=i.referrerpolicy),i.crossorigin==="use-credentials"?o.credentials="include":i.crossorigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function r(i){if(i.ep)return;i.ep=!0;const o=n(i);fetch(i.href,o)}})();function U(){}function ri(t){return t&&typeof t=="object"&&typeof t.then=="function"}function vr(t){return t()}function Vn(){return Object.create(null)}function Be(t){t.forEach(vr)}function _r(t){return typeof t=="function"}function At(t,e){return t!=t?e==e:t!==e||t&&typeof t=="object"||typeof t=="function"}function ii(t){return Object.keys(t).length===0}function kr(t,...e){if(t==null)return U;const n=t.subscribe(...e);return n.unsubscribe?()=>n.unsubscribe():n}function pe(t){let e;return kr(t,n=>e=n)(),e}function J(t,e,n){t.$$.on_destroy.push(kr(e,n))}function Y(t,e,n){return t.set(n),e}function si(t){return t&&_r(t.destroy)?t.destroy:U}function g(t,e){t.appendChild(e)}function L(t,e,n){t.insertBefore(e,n||null)}function D(t){t.parentNode.removeChild(t)}function pn(t,e){for(let n=0;n<t.length;n+=1)t[n]&&t[n].d(e)}function k(t){return document.createElement(t)}function ce(t){return document.createTextNode(t)}function P(){return ce(" ")}function wr(){return ce("")}function C(t,e,n,r){return t.addEventListener(e,n,r),()=>t.removeEventListener(e,n,r)}function oi(t){return function(e){return e.preventDefault(),t.call(this,e)}}function v(t,e,n){n==null?t.removeAttribute(e):t.getAttribute(e)!==n&&t.setAttribute(e,n)}function we(t){return t===""?null:+t}function ai(t){return Array.from(t.childNodes)}function jn(t,e){e=""+e,t.wholeText!==e&&(t.data=e)}function Z(t,e){t.value=e==null?"":e}function St(t,e,n,r){n===null?t.style.removeProperty(e):t.style.setProperty(e,n,r?"important":"")}function Kn(t,e){for(let n=0;n<t.options.length;n+=1){const r=t.options[n];if(r.__value===e){r.selected=!0;return}}t.selectedIndex=-1}function ci(t){const e=t.querySelector(":checked")||t.options[0];return e&&e.__value}function lt(t,e,n){t.classList[n?"add":"remove"](e)}let et;function Te(t){et=t}function Tr(){if(!et)throw new Error("Function called outside component initialization");return et}function ui(t){Tr().$$.on_mount.push(t)}function li(t,e){const n=t.$$.callbacks[e.type];n&&n.slice().forEach(r=>r.call(this,e))}const We=[],Zt=[],bt=[],Hn=[],fi=Promise.resolve();let en=!1;function hi(){en||(en=!0,fi.then(mn))}function It(t){bt.push(t)}const Ht=new Set;let ft=0;function mn(){const t=et;do{for(;ft<We.length;){const e=We[ft];ft++,Te(e),di(e.$$)}for(Te(null),We.length=0,ft=0;Zt.length;)Zt.pop()();for(let e=0;e<bt.length;e+=1){const n=bt[e];Ht.has(n)||(Ht.add(n),n())}bt.length=0}while(We.length);for(;Hn.length;)Hn.pop()();en=!1,Ht.clear(),Te(t)}function di(t){if(t.fragment!==null){t.update(),Be(t.before_update);const e=t.dirty;t.dirty=[-1],t.fragment&&t.fragment.p(t.ctx,e),t.after_update.forEach(It)}}const vt=new Set;let Ue;function pi(){Ue={r:0,c:[],p:Ue}}function mi(){Ue.r||Be(Ue.c),Ue=Ue.p}function Ct(t,e){t&&t.i&&(vt.delete(t),t.i(e))}function tn(t,e,n,r){if(t&&t.o){if(vt.has(t))return;vt.add(t),Ue.c.push(()=>{vt.delete(t),r&&(n&&t.d(1),r())}),t.o(e)}else r&&r()}function $n(t,e){const n=e.token={};function r(i,o,s,c){if(e.token!==n)return;e.resolved=c;let u=e.ctx;s!==void 0&&(u=u.slice(),u[s]=c);const a=i&&(e.current=i)(u);let p=!1;e.block&&(e.blocks?e.blocks.forEach((h,l)=>{l!==o&&h&&(pi(),tn(h,1,1,()=>{e.blocks[l]===h&&(e.blocks[l]=null)}),mi())}):e.block.d(1),a.c(),Ct(a,1),a.m(e.mount(),e.anchor),p=!0),e.block=a,e.blocks&&(e.blocks[o]=a),p&&mn()}if(ri(t)){const i=Tr();if(t.then(o=>{Te(i),r(e.then,1,e.value,o),Te(null)},o=>{if(Te(i),r(e.catch,2,e.error,o),Te(null),!e.hasCatch)throw o}),e.current!==e.pending)return r(e.pending,0),!0}else{if(e.current!==e.then)return r(e.then,1,e.value,t),!0;e.resolved=t}}function zn(t){t&&t.c()}function nn(t,e,n,r){const{fragment:i,on_mount:o,on_destroy:s,after_update:c}=t.$$;i&&i.m(e,n),r||It(()=>{const u=o.map(vr).filter(_r);s?s.push(...u):Be(u),t.$$.on_mount=[]}),c.forEach(It)}function rn(t,e){const n=t.$$;n.fragment!==null&&(Be(n.on_destroy),n.fragment&&n.fragment.d(e),n.on_destroy=n.fragment=null,n.ctx=[])}function yi(t,e){t.$$.dirty[0]===-1&&(We.push(t),hi(),t.$$.dirty.fill(0)),t.$$.dirty[e/31|0]|=1<<e%31}function yn(t,e,n,r,i,o,s,c=[-1]){const u=et;Te(t);const a=t.$$={fragment:null,ctx:null,props:o,update:U,not_equal:i,bound:Vn(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(e.context||(u?u.$$.context:[])),callbacks:Vn(),dirty:c,skip_bound:!1,root:e.target||u.$$.root};s&&s(a.root);let p=!1;if(a.ctx=n?n(t,e.props||{},(h,l,...f)=>{const d=f.length?f[0]:l;return a.ctx&&i(a.ctx[h],a.ctx[h]=d)&&(!a.skip_bound&&a.bound[h]&&a.bound[h](d),p&&yi(t,h)),l}):[],a.update(),p=!0,Be(a.before_update),a.fragment=r?r(a.ctx):!1,e.target){if(e.hydrate){const h=ai(e.target);a.fragment&&a.fragment.l(h),h.forEach(D)}else a.fragment&&a.fragment.c();e.intro&&Ct(t.$$.fragment),nn(t,e.target,e.anchor,e.customElement),mn()}Te(u)}class gn{$destroy(){rn(this,1),this.$destroy=U}$on(e,n){const r=this.$$.callbacks[e]||(this.$$.callbacks[e]=[]);return r.push(n),()=>{const i=r.indexOf(n);i!==-1&&r.splice(i,1)}}$set(e){this.$$set&&!ii(e)&&(this.$$.skip_bound=!0,this.$$set(e),this.$$.skip_bound=!1)}}const qe=[];function ee(t,e=U){let n;const r=new Set;function i(c){if(At(t,c)&&(t=c,n)){const u=!qe.length;for(const a of r)a[1](),qe.push(a,t);if(u){for(let a=0;a<qe.length;a+=2)qe[a][0](qe[a+1]);qe.length=0}}}function o(c){i(c(t))}function s(c,u=U){const a=[c,u];return r.add(a),r.size===1&&(n=e(i)||U),c(t),()=>{r.delete(a),r.size===0&&(n(),n=null)}}return{set:i,update:o,subscribe:s}}const Jn=["accordion","acoustic_bass","acoustic_grand_piano","acoustic_guitar_nylon","acoustic_guitar_steel","agogo","alto_sax","applause","bagpipe","banjo","baritone_sax","bassoon","bird_tweet","blown_bottle","brass_section","breath_noise","bright_acoustic_piano","celesta","cello","choir_aahs","church_organ","clarinet","clavinet","contrabass","distortion_guitar","drawbar_organ","dulcimer","electric_bass_finger","electric_bass_pick","electric_grand_piano","electric_guitar_clean","electric_guitar_jazz","electric_guitar_muted","electric_piano_1","electric_piano_2","english_horn","fiddle","flute","french_horn","fretless_bass","fx_1_rain","fx_2_soundtrack","fx_3_crystal","fx_4_atmosphere","fx_5_brightness","fx_6_goblins","fx_7_echoes","fx_8_scifi","glockenspiel","guitar_fret_noise","guitar_harmonics","gunshot","harmonica","harpsichord","helicopter","honkytonk_piano","kalimba","koto","lead_1_square","lead_2_sawtooth","lead_3_calliope","lead_4_chiff","lead_5_charang","lead_6_voice","lead_7_fifths","lead_8_bass__lead","marimba","melodic_tom","music_box","muted_trumpet","oboe","ocarina","orchestra_hit","orchestral_harp","overdriven_guitar","pad_1_new_age","pad_2_warm","pad_3_polysynth","pad_4_choir","pad_5_bowed","pad_6_metallic","pad_7_halo","pad_8_sweep","pan_flute","percussive_organ","piccolo","pizzicato_strings","recorder","reed_organ","reverse_cymbal","rock_organ","seashore","shakuhachi","shamisen","shanai","sitar","slap_bass_1","slap_bass_2","soprano_sax","steel_drums","string_ensemble_1","string_ensemble_2","synth_bass_1","synth_bass_2","synth_brass_1","synth_brass_2","synth_choir","synth_drum","synth_strings_1","synth_strings_2","taiko_drum","tango_accordion","telephone_ring","tenor_sax","timpani","tinkle_bell","tremolo_strings","trombone","trumpet","tuba","tubular_bells","vibraphone","viola","violin","voice_oohs","whistle","woodblock","xylophone"];var Ke=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function xr(t){var e=t.default;if(typeof e=="function"){var n=function(){return e.apply(this,arguments)};n.prototype=e.prototype}else n={};return Object.defineProperty(n,"__esModule",{value:!0}),Object.keys(t).forEach(function(r){var i=Object.getOwnPropertyDescriptor(t,r);Object.defineProperty(n,r,i.get?i:{enumerable:!0,get:function(){return t[r]}})}),n}var Sr={},Bt={};function gi(t){var e=new X(t),n=e.readChunk();if(n.id!="MThd")throw"Bad MIDI file.  Expected 'MHdr', got: '"+n.id+"'";for(var r=bi(n.data),i=[],o=0;!e.eof()&&o<r.numTracks;o++){var s=e.readChunk();if(s.id!="MTrk")throw"Bad MIDI file.  Expected 'MTrk', got: '"+s.id+"'";var c=vi(s.data);i.push(c)}return{header:r,tracks:i}}function bi(t){var e=new X(t),n=e.readUInt16(),r=e.readUInt16(),i={format:n,numTracks:r},o=e.readUInt16();return o&32768?(i.framesPerSecond=256-(o>>8),i.ticksPerFrame=o&255):i.ticksPerBeat=o,i}function vi(t){for(var e=new X(t),n=[];!e.eof();){var r=o();n.push(r)}return n;var i;function o(){var s={};s.deltaTime=e.readVarInt();var c=e.readUInt8();if((c&240)===240)if(c===255){s.meta=!0;var u=e.readUInt8(),a=e.readVarInt();switch(u){case 0:if(s.type="sequenceNumber",a!==2)throw"Expected length for sequenceNumber event is 2, got "+a;return s.number=e.readUInt16(),s;case 1:return s.type="text",s.text=e.readString(a),s;case 2:return s.type="copyrightNotice",s.text=e.readString(a),s;case 3:return s.type="trackName",s.text=e.readString(a),s;case 4:return s.type="instrumentName",s.text=e.readString(a),s;case 5:return s.type="lyrics",s.text=e.readString(a),s;case 6:return s.type="marker",s.text=e.readString(a),s;case 7:return s.type="cuePoint",s.text=e.readString(a),s;case 32:if(s.type="channelPrefix",a!=1)throw"Expected length for channelPrefix event is 1, got "+a;return s.channel=e.readUInt8(),s;case 33:if(s.type="portPrefix",a!=1)throw"Expected length for portPrefix event is 1, got "+a;return s.port=e.readUInt8(),s;case 47:if(s.type="endOfTrack",a!=0)throw"Expected length for endOfTrack event is 0, got "+a;return s;case 81:if(s.type="setTempo",a!=3)throw"Expected length for setTempo event is 3, got "+a;return s.microsecondsPerBeat=e.readUInt24(),s;case 84:if(s.type="smpteOffset",a!=5)throw"Expected length for smpteOffset event is 5, got "+a;var p=e.readUInt8(),h={0:24,32:25,64:29,96:30};return s.frameRate=h[p&96],s.hour=p&31,s.min=e.readUInt8(),s.sec=e.readUInt8(),s.frame=e.readUInt8(),s.subFrame=e.readUInt8(),s;case 88:if(s.type="timeSignature",a!=2&&a!=4)throw"Expected length for timeSignature event is 4 or 2, got "+a;return s.numerator=e.readUInt8(),s.denominator=1<<e.readUInt8(),a===4?(s.metronome=e.readUInt8(),s.thirtyseconds=e.readUInt8()):(s.metronome=36,s.thirtyseconds=8),s;case 89:if(s.type="keySignature",a!=2)throw"Expected length for keySignature event is 2, got "+a;return s.key=e.readInt8(),s.scale=e.readUInt8(),s;case 127:return s.type="sequencerSpecific",s.data=e.readBytes(a),s;default:return s.type="unknownMeta",s.data=e.readBytes(a),s.metatypeByte=u,s}}else if(c==240){s.type="sysEx";var a=e.readVarInt();return s.data=e.readBytes(a),s}else if(c==247){s.type="endSysEx";var a=e.readVarInt();return s.data=e.readBytes(a),s}else throw"Unrecognised MIDI event type byte: "+c;else{var l;if((c&128)===0){if(i===null)throw"Running status byte encountered before status byte";l=c,c=i,s.running=!0}else l=e.readUInt8(),i=c;var f=c>>4;switch(s.channel=c&15,f){case 8:return s.type="noteOff",s.noteNumber=l,s.velocity=e.readUInt8(),s;case 9:var d=e.readUInt8();return s.type=d===0?"noteOff":"noteOn",s.noteNumber=l,s.velocity=d,d===0&&(s.byte9=!0),s;case 10:return s.type="noteAftertouch",s.noteNumber=l,s.amount=e.readUInt8(),s;case 11:return s.type="controller",s.controllerType=l,s.value=e.readUInt8(),s;case 12:return s.type="programChange",s.programNumber=l,s;case 13:return s.type="channelAftertouch",s.amount=l,s;case 14:return s.type="pitchBend",s.value=l+(e.readUInt8()<<7)-8192,s;default:throw"Unrecognised MIDI event type: "+f}}}}function X(t){this.buffer=t,this.bufferLen=this.buffer.length,this.pos=0}X.prototype.eof=function(){return this.pos>=this.bufferLen};X.prototype.readUInt8=function(){var t=this.buffer[this.pos];return this.pos+=1,t};X.prototype.readInt8=function(){var t=this.readUInt8();return t&128?t-256:t};X.prototype.readUInt16=function(){var t=this.readUInt8(),e=this.readUInt8();return(t<<8)+e};X.prototype.readInt16=function(){var t=this.readUInt16();return t&32768?t-65536:t};X.prototype.readUInt24=function(){var t=this.readUInt8(),e=this.readUInt8(),n=this.readUInt8();return(t<<16)+(e<<8)+n};X.prototype.readInt24=function(){var t=this.readUInt24();return t&8388608?t-16777216:t};X.prototype.readUInt32=function(){var t=this.readUInt8(),e=this.readUInt8(),n=this.readUInt8(),r=this.readUInt8();return(t<<24)+(e<<16)+(n<<8)+r};X.prototype.readBytes=function(t){var e=this.buffer.slice(this.pos,this.pos+t);return this.pos+=t,e};X.prototype.readString=function(t){var e=this.readBytes(t);return String.fromCharCode.apply(null,e)};X.prototype.readVarInt=function(){for(var t=0;!this.eof();){var e=this.readUInt8();if(e&128)t+=e&127,t<<=7;else return t+e}return t};X.prototype.readChunk=function(){var t=this.readString(4),e=this.readUInt32(),n=this.readBytes(e);return{id:t,length:e,data:n}};var _i=gi;function ki(t,e){if(typeof t!="object")throw"Invalid MIDI data";e=e||{};var n=t.header||{},r=t.tracks||[],i,o=r.length,s=new $;for(wi(s,n,o),i=0;i<o;i++)Ti(s,r[i],e);return s.buffer}function wi(t,e,n){var r=e.format==null?1:e.format,i=128;e.timeDivision?i=e.timeDivision:e.ticksPerFrame&&e.framesPerSecond?i=-(e.framesPerSecond&255)<<8|e.ticksPerFrame&255:e.ticksPerBeat&&(i=e.ticksPerBeat&32767);var o=new $;o.writeUInt16(r),o.writeUInt16(n),o.writeUInt16(i),t.writeChunk("MThd",o.buffer)}function Ti(t,e,n){var r=new $,i,o=e.length,s=null;for(i=0;i<o;i++)(n.running===!1||!n.running&&!e[i].running)&&(s=null),s=xi(r,e[i],s,n.useByte9ForNoteOff);t.writeChunk("MTrk",r.buffer)}function xi(t,e,n,r){var i=e.type,o=e.deltaTime,s=e.text||"",c=e.data||[],u=null;switch(t.writeVarInt(o),i){case"sequenceNumber":t.writeUInt8(255),t.writeUInt8(0),t.writeVarInt(2),t.writeUInt16(e.number);break;case"text":t.writeUInt8(255),t.writeUInt8(1),t.writeVarInt(s.length),t.writeString(s);break;case"copyrightNotice":t.writeUInt8(255),t.writeUInt8(2),t.writeVarInt(s.length),t.writeString(s);break;case"trackName":t.writeUInt8(255),t.writeUInt8(3),t.writeVarInt(s.length),t.writeString(s);break;case"instrumentName":t.writeUInt8(255),t.writeUInt8(4),t.writeVarInt(s.length),t.writeString(s);break;case"lyrics":t.writeUInt8(255),t.writeUInt8(5),t.writeVarInt(s.length),t.writeString(s);break;case"marker":t.writeUInt8(255),t.writeUInt8(6),t.writeVarInt(s.length),t.writeString(s);break;case"cuePoint":t.writeUInt8(255),t.writeUInt8(7),t.writeVarInt(s.length),t.writeString(s);break;case"channelPrefix":t.writeUInt8(255),t.writeUInt8(32),t.writeVarInt(1),t.writeUInt8(e.channel);break;case"portPrefix":t.writeUInt8(255),t.writeUInt8(33),t.writeVarInt(1),t.writeUInt8(e.port);break;case"endOfTrack":t.writeUInt8(255),t.writeUInt8(47),t.writeVarInt(0);break;case"setTempo":t.writeUInt8(255),t.writeUInt8(81),t.writeVarInt(3),t.writeUInt24(e.microsecondsPerBeat);break;case"smpteOffset":t.writeUInt8(255),t.writeUInt8(84),t.writeVarInt(5);var a={24:0,25:32,29:64,30:96},p=e.hour&31|a[e.frameRate];t.writeUInt8(p),t.writeUInt8(e.min),t.writeUInt8(e.sec),t.writeUInt8(e.frame),t.writeUInt8(e.subFrame);break;case"timeSignature":t.writeUInt8(255),t.writeUInt8(88),t.writeVarInt(4),t.writeUInt8(e.numerator);var h=Math.floor(Math.log(e.denominator)/Math.LN2)&255;t.writeUInt8(h),t.writeUInt8(e.metronome),t.writeUInt8(e.thirtyseconds||8);break;case"keySignature":t.writeUInt8(255),t.writeUInt8(89),t.writeVarInt(2),t.writeInt8(e.key),t.writeUInt8(e.scale);break;case"sequencerSpecific":t.writeUInt8(255),t.writeUInt8(127),t.writeVarInt(c.length),t.writeBytes(c);break;case"unknownMeta":e.metatypeByte!=null&&(t.writeUInt8(255),t.writeUInt8(e.metatypeByte),t.writeVarInt(c.length),t.writeBytes(c));break;case"sysEx":t.writeUInt8(240),t.writeVarInt(c.length),t.writeBytes(c);break;case"endSysEx":t.writeUInt8(247),t.writeVarInt(c.length),t.writeBytes(c);break;case"noteOff":var l=r!==!1&&e.byte9||r&&e.velocity==0?144:128;u=l|e.channel,u!==n&&t.writeUInt8(u),t.writeUInt8(e.noteNumber),t.writeUInt8(e.velocity);break;case"noteOn":u=144|e.channel,u!==n&&t.writeUInt8(u),t.writeUInt8(e.noteNumber),t.writeUInt8(e.velocity);break;case"noteAftertouch":u=160|e.channel,u!==n&&t.writeUInt8(u),t.writeUInt8(e.noteNumber),t.writeUInt8(e.amount);break;case"controller":u=176|e.channel,u!==n&&t.writeUInt8(u),t.writeUInt8(e.controllerType),t.writeUInt8(e.value);break;case"programChange":u=192|e.channel,u!==n&&t.writeUInt8(u),t.writeUInt8(e.programNumber);break;case"channelAftertouch":u=208|e.channel,u!==n&&t.writeUInt8(u),t.writeUInt8(e.amount);break;case"pitchBend":u=224|e.channel,u!==n&&t.writeUInt8(u);var f=8192+e.value,d=f&127,m=f>>7&127;t.writeUInt8(d),t.writeUInt8(m);break;default:throw"Unrecognized event type: "+i}return u}function $(){this.buffer=[]}$.prototype.writeUInt8=function(t){this.buffer.push(t&255)};$.prototype.writeInt8=$.prototype.writeUInt8;$.prototype.writeUInt16=function(t){var e=t>>8&255,n=t&255;this.writeUInt8(e),this.writeUInt8(n)};$.prototype.writeInt16=$.prototype.writeUInt16;$.prototype.writeUInt24=function(t){var e=t>>16&255,n=t>>8&255,r=t&255;this.writeUInt8(e),this.writeUInt8(n),this.writeUInt8(r)};$.prototype.writeInt24=$.prototype.writeUInt24;$.prototype.writeUInt32=function(t){var e=t>>24&255,n=t>>16&255,r=t>>8&255,i=t&255;this.writeUInt8(e),this.writeUInt8(n),this.writeUInt8(r),this.writeUInt8(i)};$.prototype.writeInt32=$.prototype.writeUInt32;$.prototype.writeBytes=function(t){this.buffer=this.buffer.concat(Array.prototype.slice.call(t,0))};$.prototype.writeString=function(t){var e,n=t.length,r=[];for(e=0;e<n;e++)r.push(t.codePointAt(e));this.writeBytes(r)};$.prototype.writeVarInt=function(t){if(t<0)throw"Cannot write negative variable-length integer";if(t<=127)this.writeUInt8(t);else{var e=t,n=[];for(n.push(e&127),e>>=7;e;){var r=e&127|128;n.push(r),e>>=7}this.writeBytes(n.reverse())}};$.prototype.writeChunk=function(t,e){this.writeString(t),this.writeUInt32(e.length),this.writeBytes(e)};var Si=ki;Bt.parseMidi=_i;Bt.writeMidi=Si;var Ot={},Fe={};Object.defineProperty(Fe,"__esModule",{value:!0});Fe.insert=Fe.search=void 0;function Ir(t,e,n){n===void 0&&(n="ticks");var r=0,i=t.length,o=i;if(i>0&&t[i-1][n]<=e)return i-1;for(;r<o;){var s=Math.floor(r+(o-r)/2),c=t[s],u=t[s+1];if(c[n]===e){for(var a=s;a<t.length;a++){var p=t[a];p[n]===e&&(s=a)}return s}else{if(c[n]<e&&u[n]>e)return s;c[n]>e?o=s:c[n]<e&&(r=s+1)}}return-1}Fe.search=Ir;function Ii(t,e,n){if(n===void 0&&(n="ticks"),t.length){var r=Ir(t,e[n],n);t.splice(r+1,0,e)}else t.push(e)}Fe.insert=Ii;(function(t){Object.defineProperty(t,"__esModule",{value:!0}),t.Header=t.keySignatureKeys=void 0;var e=Fe,n=new WeakMap;t.keySignatureKeys=["Cb","Gb","Db","Ab","Eb","Bb","F","C","G","D","A","E","B","F#","C#"];var r=function(){function i(o){var s=this;if(this.tempos=[],this.timeSignatures=[],this.keySignatures=[],this.meta=[],this.name="",n.set(this,480),o){n.set(this,o.header.ticksPerBeat),o.tracks.forEach(function(u){u.forEach(function(a){a.meta&&(a.type==="timeSignature"?s.timeSignatures.push({ticks:a.absoluteTime,timeSignature:[a.numerator,a.denominator]}):a.type==="setTempo"?s.tempos.push({bpm:6e7/a.microsecondsPerBeat,ticks:a.absoluteTime}):a.type==="keySignature"&&s.keySignatures.push({key:t.keySignatureKeys[a.key+7],scale:a.scale===0?"major":"minor",ticks:a.absoluteTime}))})});var c=0;o.tracks[0].forEach(function(u){c+=u.deltaTime,u.meta&&(u.type==="trackName"?s.name=u.text:(u.type==="text"||u.type==="cuePoint"||u.type==="marker"||u.type==="lyrics")&&s.meta.push({text:u.text,ticks:c,type:u.type}))}),this.update()}}return i.prototype.update=function(){var o=this,s=0,c=0;this.tempos.sort(function(u,a){return u.ticks-a.ticks}),this.tempos.forEach(function(u,a){var p=a>0?o.tempos[a-1].bpm:o.tempos[0].bpm,h=u.ticks/o.ppq-c,l=60/p*h;u.time=l+s,s=u.time,c+=h}),this.timeSignatures.sort(function(u,a){return u.ticks-a.ticks}),this.timeSignatures.forEach(function(u,a){var p=a>0?o.timeSignatures[a-1]:o.timeSignatures[0],h=(u.ticks-p.ticks)/o.ppq,l=h/p.timeSignature[0]/(p.timeSignature[1]/4);p.measures=p.measures||0,u.measures=l+p.measures})},i.prototype.ticksToSeconds=function(o){var s=(0,e.search)(this.tempos,o);if(s!==-1){var c=this.tempos[s],u=c.time,a=(o-c.ticks)/this.ppq;return u+60/c.bpm*a}else{var p=o/this.ppq;return 60/120*p}},i.prototype.ticksToMeasures=function(o){var s=(0,e.search)(this.timeSignatures,o);if(s!==-1){var c=this.timeSignatures[s],u=(o-c.ticks)/this.ppq;return c.measures+u/(c.timeSignature[0]/c.timeSignature[1])/4}else return o/this.ppq/4},Object.defineProperty(i.prototype,"ppq",{get:function(){return n.get(this)},enumerable:!1,configurable:!0}),i.prototype.secondsToTicks=function(o){var s=(0,e.search)(this.tempos,o,"time");if(s!==-1){var c=this.tempos[s],u=c.time,a=o-u,p=a/(60/c.bpm);return Math.round(c.ticks+p*this.ppq)}else{var h=o/.5;return Math.round(h*this.ppq)}},i.prototype.toJSON=function(){return{keySignatures:this.keySignatures,meta:this.meta,name:this.name,ppq:this.ppq,tempos:this.tempos.map(function(o){return{bpm:o.bpm,ticks:o.ticks}}),timeSignatures:this.timeSignatures}},i.prototype.fromJSON=function(o){this.name=o.name,this.tempos=o.tempos.map(function(s){return Object.assign({},s)}),this.timeSignatures=o.timeSignatures.map(function(s){return Object.assign({},s)}),this.keySignatures=o.keySignatures.map(function(s){return Object.assign({},s)}),this.meta=o.meta.map(function(s){return Object.assign({},s)}),n.set(this,o.ppq),this.update()},i.prototype.setTempo=function(o){this.tempos=[{bpm:o,ticks:0}],this.update()},i}();t.Header=r})(Ot);var tt={},bn={};(function(t){Object.defineProperty(t,"__esModule",{value:!0}),t.ControlChange=t.controlChangeIds=t.controlChangeNames=void 0,t.controlChangeNames={1:"modulationWheel",2:"breath",4:"footController",5:"portamentoTime",7:"volume",8:"balance",10:"pan",64:"sustain",65:"portamentoTime",66:"sostenuto",67:"softPedal",68:"legatoFootswitch",84:"portamentoControl"},t.controlChangeIds=Object.keys(t.controlChangeNames).reduce(function(i,o){return i[t.controlChangeNames[o]]=o,i},{});var e=new WeakMap,n=new WeakMap,r=function(){function i(o,s){e.set(this,s),n.set(this,o.controllerType),this.ticks=o.absoluteTime,this.value=o.value}return Object.defineProperty(i.prototype,"number",{get:function(){return n.get(this)},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"name",{get:function(){return t.controlChangeNames[this.number]?t.controlChangeNames[this.number]:null},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"time",{get:function(){var o=e.get(this);return o.ticksToSeconds(this.ticks)},set:function(o){var s=e.get(this);this.ticks=s.secondsToTicks(o)},enumerable:!1,configurable:!0}),i.prototype.toJSON=function(){return{number:this.number,ticks:this.ticks,time:this.time,value:this.value}},i}();t.ControlChange=r})(bn);var Pt={};Object.defineProperty(Pt,"__esModule",{value:!0});Pt.createControlChanges=void 0;var ht=bn;function Ci(){return new Proxy({},{get:function(t,e){if(t[e])return t[e];if(ht.controlChangeIds.hasOwnProperty(e))return t[ht.controlChangeIds[e]]},set:function(t,e,n){return ht.controlChangeIds.hasOwnProperty(e)?t[ht.controlChangeIds[e]]=n:t[e]=n,!0}})}Pt.createControlChanges=Ci;var Ut={};Object.defineProperty(Ut,"__esModule",{value:!0});Ut.PitchBend=void 0;var $t=new WeakMap,Oi=function(){function t(e,n){$t.set(this,n),this.ticks=e.absoluteTime,this.value=e.value}return Object.defineProperty(t.prototype,"time",{get:function(){var e=$t.get(this);return e.ticksToSeconds(this.ticks)},set:function(e){var n=$t.get(this);this.ticks=n.secondsToTicks(e)},enumerable:!1,configurable:!0}),t.prototype.toJSON=function(){return{ticks:this.ticks,time:this.time,value:this.value}},t}();Ut.PitchBend=Oi;var Mt={},Ae={};Object.defineProperty(Ae,"__esModule",{value:!0});Ae.DrumKitByPatchID=Ae.InstrumentFamilyByID=Ae.instrumentByPatchID=void 0;Ae.instrumentByPatchID=["acoustic grand piano","bright acoustic piano","electric grand piano","honky-tonk piano","electric piano 1","electric piano 2","harpsichord","clavi","celesta","glockenspiel","music box","vibraphone","marimba","xylophone","tubular bells","dulcimer","drawbar organ","percussive organ","rock organ","church organ","reed organ","accordion","harmonica","tango accordion","acoustic guitar (nylon)","acoustic guitar (steel)","electric guitar (jazz)","electric guitar (clean)","electric guitar (muted)","overdriven guitar","distortion guitar","guitar harmonics","acoustic bass","electric bass (finger)","electric bass (pick)","fretless bass","slap bass 1","slap bass 2","synth bass 1","synth bass 2","violin","viola","cello","contrabass","tremolo strings","pizzicato strings","orchestral harp","timpani","string ensemble 1","string ensemble 2","synthstrings 1","synthstrings 2","choir aahs","voice oohs","synth voice","orchestra hit","trumpet","trombone","tuba","muted trumpet","french horn","brass section","synthbrass 1","synthbrass 2","soprano sax","alto sax","tenor sax","baritone sax","oboe","english horn","bassoon","clarinet","piccolo","flute","recorder","pan flute","blown bottle","shakuhachi","whistle","ocarina","lead 1 (square)","lead 2 (sawtooth)","lead 3 (calliope)","lead 4 (chiff)","lead 5 (charang)","lead 6 (voice)","lead 7 (fifths)","lead 8 (bass + lead)","pad 1 (new age)","pad 2 (warm)","pad 3 (polysynth)","pad 4 (choir)","pad 5 (bowed)","pad 6 (metallic)","pad 7 (halo)","pad 8 (sweep)","fx 1 (rain)","fx 2 (soundtrack)","fx 3 (crystal)","fx 4 (atmosphere)","fx 5 (brightness)","fx 6 (goblins)","fx 7 (echoes)","fx 8 (sci-fi)","sitar","banjo","shamisen","koto","kalimba","bag pipe","fiddle","shanai","tinkle bell","agogo","steel drums","woodblock","taiko drum","melodic tom","synth drum","reverse cymbal","guitar fret noise","breath noise","seashore","bird tweet","telephone ring","helicopter","applause","gunshot"];Ae.InstrumentFamilyByID=["piano","chromatic percussion","organ","guitar","bass","strings","ensemble","brass","reed","pipe","synth lead","synth pad","synth effects","world","percussive","sound effects"];Ae.DrumKitByPatchID={0:"standard kit",8:"room kit",16:"power kit",24:"electronic kit",25:"tr-808 kit",32:"jazz kit",40:"brush kit",48:"orchestra kit",56:"sound fx kit"};Object.defineProperty(Mt,"__esModule",{value:!0});Mt.Instrument=void 0;var dt=Ae,Gn=new WeakMap,Ni=function(){function t(e,n){if(this.number=0,Gn.set(this,n),this.number=0,e){var r=e.find(function(i){return i.type==="programChange"});r&&(this.number=r.programNumber)}}return Object.defineProperty(t.prototype,"name",{get:function(){return this.percussion?dt.DrumKitByPatchID[this.number]:dt.instrumentByPatchID[this.number]},set:function(e){var n=dt.instrumentByPatchID.indexOf(e);n!==-1&&(this.number=n)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"family",{get:function(){return this.percussion?"drums":dt.InstrumentFamilyByID[Math.floor(this.number/8)]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"percussion",{get:function(){var e=Gn.get(this);return e.channel===9},enumerable:!1,configurable:!0}),t.prototype.toJSON=function(){return{family:this.family,number:this.number,name:this.name}},t.prototype.fromJSON=function(e){this.number=e.number},t}();Mt.Instrument=Ni;var Ft={};Object.defineProperty(Ft,"__esModule",{value:!0});Ft.Note=void 0;function Ei(t){var e=Math.floor(t/12)-1;return Cr(t)+e.toString()}function Cr(t){var e=["C","C#","D","D#","E","F","F#","G","G#","A","A#","B"],n=t%12;return e[n]}function Ai(t){var e=["C","C#","D","D#","E","F","F#","G","G#","A","A#","B"];return e.indexOf(t)}var Bi=function(){var t=/^([a-g]{1}(?:b|#|x|bb)?)(-?[0-9]+)/i,e={cbb:-2,cb:-1,c:0,"c#":1,cx:2,dbb:0,db:1,d:2,"d#":3,dx:4,ebb:2,eb:3,e:4,"e#":5,ex:6,fbb:3,fb:4,f:5,"f#":6,fx:7,gbb:5,gb:6,g:7,"g#":8,gx:9,abb:7,ab:8,a:9,"a#":10,ax:11,bbb:9,bb:10,b:11,"b#":12,bx:13};return function(n){var r=t.exec(n),i=r[1],o=r[2],s=e[i.toLowerCase()];return s+(parseInt(o,10)+1)*12}}(),Ve=new WeakMap,Pi=function(){function t(e,n,r){Ve.set(this,r),this.midi=e.midi,this.velocity=e.velocity,this.noteOffVelocity=n.velocity,this.ticks=e.ticks,this.durationTicks=n.ticks-e.ticks}return Object.defineProperty(t.prototype,"name",{get:function(){return Ei(this.midi)},set:function(e){this.midi=Bi(e)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"octave",{get:function(){return Math.floor(this.midi/12)-1},set:function(e){var n=e-this.octave;this.midi+=n*12},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"pitch",{get:function(){return Cr(this.midi)},set:function(e){this.midi=12*(this.octave+1)+Ai(e)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"duration",{get:function(){var e=Ve.get(this);return e.ticksToSeconds(this.ticks+this.durationTicks)-e.ticksToSeconds(this.ticks)},set:function(e){var n=Ve.get(this),r=n.secondsToTicks(this.time+e);this.durationTicks=r-this.ticks},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"time",{get:function(){var e=Ve.get(this);return e.ticksToSeconds(this.ticks)},set:function(e){var n=Ve.get(this);this.ticks=n.secondsToTicks(e)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"bars",{get:function(){var e=Ve.get(this);return e.ticksToMeasures(this.ticks)},enumerable:!1,configurable:!0}),t.prototype.toJSON=function(){return{duration:this.duration,durationTicks:this.durationTicks,midi:this.midi,name:this.name,ticks:this.ticks,time:this.time,velocity:this.velocity}},t}();Ft.Note=Pi;Object.defineProperty(tt,"__esModule",{value:!0});tt.Track=void 0;var zt=Fe,Ui=bn,Mi=Pt,Fi=Ut,Wn=Mt,Ri=Ft,pt=new WeakMap,Di=function(){function t(e,n){var r=this;if(this.name="",this.notes=[],this.controlChanges=(0,Mi.createControlChanges)(),this.pitchBends=[],pt.set(this,n),e){var i=e.find(function(l){return l.type==="trackName"});this.name=i?i.text:""}if(this.instrument=new Wn.Instrument(e,this),this.channel=0,e){for(var o=e.filter(function(l){return l.type==="noteOn"}),s=e.filter(function(l){return l.type==="noteOff"}),c=function(){var l=o.shift();u.channel=l.channel;var f=s.findIndex(function(m){return m.noteNumber===l.noteNumber&&m.absoluteTime>=l.absoluteTime});if(f!==-1){var d=s.splice(f,1)[0];u.addNote({durationTicks:d.absoluteTime-l.absoluteTime,midi:l.noteNumber,noteOffVelocity:d.velocity/127,ticks:l.absoluteTime,velocity:l.velocity/127})}},u=this;o.length;)c();var a=e.filter(function(l){return l.type==="controller"});a.forEach(function(l){r.addCC({number:l.controllerType,ticks:l.absoluteTime,value:l.value/127})});var p=e.filter(function(l){return l.type==="pitchBend"});p.forEach(function(l){r.addPitchBend({ticks:l.absoluteTime,value:l.value/Math.pow(2,13)})});var h=e.find(function(l){return l.type==="endOfTrack"});this.endOfTrackTicks=h!==void 0?h.absoluteTime:void 0}}return t.prototype.addNote=function(e){var n=pt.get(this),r=new Ri.Note({midi:0,ticks:0,velocity:1},{ticks:0,velocity:0},n);return Object.assign(r,e),(0,zt.insert)(this.notes,r,"ticks"),this},t.prototype.addCC=function(e){var n=pt.get(this),r=new Ui.ControlChange({controllerType:e.number},n);return delete e.number,Object.assign(r,e),Array.isArray(this.controlChanges[r.number])||(this.controlChanges[r.number]=[]),(0,zt.insert)(this.controlChanges[r.number],r,"ticks"),this},t.prototype.addPitchBend=function(e){var n=pt.get(this),r=new Fi.PitchBend({},n);return Object.assign(r,e),(0,zt.insert)(this.pitchBends,r,"ticks"),this},Object.defineProperty(t.prototype,"duration",{get:function(){if(!this.notes.length)return 0;for(var e=this.notes[this.notes.length-1].time+this.notes[this.notes.length-1].duration,n=0;n<this.notes.length-1;n++){var r=this.notes[n].time+this.notes[n].duration;e<r&&(e=r)}return e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"durationTicks",{get:function(){if(!this.notes.length)return 0;for(var e=this.notes[this.notes.length-1].ticks+this.notes[this.notes.length-1].durationTicks,n=0;n<this.notes.length-1;n++){var r=this.notes[n].ticks+this.notes[n].durationTicks;e<r&&(e=r)}return e},enumerable:!1,configurable:!0}),t.prototype.fromJSON=function(e){var n=this;this.name=e.name,this.channel=e.channel,this.instrument=new Wn.Instrument(void 0,this),this.instrument.fromJSON(e.instrument),e.endOfTrackTicks!==void 0&&(this.endOfTrackTicks=e.endOfTrackTicks);for(var r in e.controlChanges)e.controlChanges[r]&&e.controlChanges[r].forEach(function(i){n.addCC({number:i.number,ticks:i.ticks,value:i.value})});e.notes.forEach(function(i){n.addNote({durationTicks:i.durationTicks,midi:i.midi,ticks:i.ticks,velocity:i.velocity})})},t.prototype.toJSON=function(){for(var e={},n=0;n<127;n++)this.controlChanges.hasOwnProperty(n)&&(e[n]=this.controlChanges[n].map(function(i){return i.toJSON()}));var r={channel:this.channel,controlChanges:e,pitchBends:this.pitchBends.map(function(i){return i.toJSON()}),instrument:this.instrument.toJSON(),name:this.name,notes:this.notes.map(function(i){return i.toJSON()})};return this.endOfTrackTicks!==void 0&&(r.endOfTrackTicks=this.endOfTrackTicks),r},t}();tt.Track=Di;var Rt={};function Li(t){var e=[];return Or(t,e),e}function Or(t,e){for(var n=0;n<t.length;n++){var r=t[n];Array.isArray(r)?Or(r,e):e.push(r)}}const qi=Object.freeze(Object.defineProperty({__proto__:null,flatten:Li},Symbol.toStringTag,{value:"Module"})),Vi=xr(qi);var Ce=Ke&&Ke.__spreadArray||function(t,e,n){if(n||arguments.length===2)for(var r=0,i=e.length,o;r<i;r++)(o||!(r in e))&&(o||(o=Array.prototype.slice.call(e,0,r)),o[r]=e[r]);return t.concat(o||Array.prototype.slice.call(e))};Object.defineProperty(Rt,"__esModule",{value:!0});Rt.encode=void 0;var ji=Bt,Ki=Ot,Hi=Vi;function $i(t,e){return[{absoluteTime:t.ticks,channel:e,deltaTime:0,noteNumber:t.midi,type:"noteOn",velocity:Math.floor(t.velocity*127)},{absoluteTime:t.ticks+t.durationTicks,channel:e,deltaTime:0,noteNumber:t.midi,type:"noteOff",velocity:Math.floor(t.noteOffVelocity*127)}]}function zi(t){return(0,Hi.flatten)(t.notes.map(function(e){return $i(e,t.channel)}))}function Ji(t,e){return{absoluteTime:t.ticks,channel:e,controllerType:t.number,deltaTime:0,type:"controller",value:Math.floor(t.value*127)}}function Gi(t){for(var e=[],n=0;n<127;n++)t.controlChanges.hasOwnProperty(n)&&t.controlChanges[n].forEach(function(r){e.push(Ji(r,t.channel))});return e}function Wi(t,e){return{absoluteTime:t.ticks,channel:e,deltaTime:0,type:"pitchBend",value:t.value}}function Yi(t){var e=[];return t.pitchBends.forEach(function(n){e.push(Wi(n,t.channel))}),e}function Xi(t){return{absoluteTime:0,channel:t.channel,deltaTime:0,programNumber:t.instrument.number,type:"programChange"}}function Qi(t){return{absoluteTime:0,deltaTime:0,meta:!0,text:t,type:"trackName"}}function Zi(t){return{absoluteTime:t.ticks,deltaTime:0,meta:!0,microsecondsPerBeat:Math.floor(6e7/t.bpm),type:"setTempo"}}function es(t){return{absoluteTime:t.ticks,deltaTime:0,denominator:t.timeSignature[1],meta:!0,metronome:24,numerator:t.timeSignature[0],thirtyseconds:8,type:"timeSignature"}}function ts(t){var e=Ki.keySignatureKeys.indexOf(t.key);return{absoluteTime:t.ticks,deltaTime:0,key:e+7,meta:!0,scale:t.scale==="major"?0:1,type:"keySignature"}}function ns(t){return{absoluteTime:t.ticks,deltaTime:0,meta:!0,text:t.text,type:t.type}}function rs(t){var e={header:{format:1,numTracks:t.tracks.length+1,ticksPerBeat:t.header.ppq},tracks:Ce([Ce(Ce(Ce(Ce([{absoluteTime:0,deltaTime:0,meta:!0,text:t.header.name,type:"trackName"}],t.header.keySignatures.map(function(n){return ts(n)}),!0),t.header.meta.map(function(n){return ns(n)}),!0),t.header.tempos.map(function(n){return Zi(n)}),!0),t.header.timeSignatures.map(function(n){return es(n)}),!0)],t.tracks.map(function(n){return Ce(Ce(Ce([Qi(n.name),Xi(n)],zi(n),!0),Gi(n),!0),Yi(n),!0)}),!0)};return e.tracks=e.tracks.map(function(n){n=n.sort(function(i,o){return i.absoluteTime-o.absoluteTime});var r=0;return n.forEach(function(i){i.deltaTime=i.absoluteTime-r,r=i.absoluteTime,delete i.absoluteTime}),n.push({deltaTime:0,meta:!0,type:"endOfTrack"}),n}),new Uint8Array((0,ji.writeMidi)(e))}Rt.encode=rs;(function(t){var e=Ke&&Ke.__awaiter||function(h,l,f,d){function m(y){return y instanceof f?y:new f(function(I){I(y)})}return new(f||(f=Promise))(function(y,I){function q(N){try{w(d.next(N))}catch(V){I(V)}}function F(N){try{w(d.throw(N))}catch(V){I(V)}}function w(N){N.done?y(N.value):m(N.value).then(q,F)}w((d=d.apply(h,l||[])).next())})},n=Ke&&Ke.__generator||function(h,l){var f={label:0,sent:function(){if(y[0]&1)throw y[1];return y[1]},trys:[],ops:[]},d,m,y,I;return I={next:q(0),throw:q(1),return:q(2)},typeof Symbol=="function"&&(I[Symbol.iterator]=function(){return this}),I;function q(w){return function(N){return F([w,N])}}function F(w){if(d)throw new TypeError("Generator is already executing.");for(;f;)try{if(d=1,m&&(y=w[0]&2?m.return:w[0]?m.throw||((y=m.return)&&y.call(m),0):m.next)&&!(y=y.call(m,w[1])).done)return y;switch(m=0,y&&(w=[w[0]&2,y.value]),w[0]){case 0:case 1:y=w;break;case 4:return f.label++,{value:w[1],done:!1};case 5:f.label++,m=w[1],w=[0];continue;case 7:w=f.ops.pop(),f.trys.pop();continue;default:if(y=f.trys,!(y=y.length>0&&y[y.length-1])&&(w[0]===6||w[0]===2)){f=0;continue}if(w[0]===3&&(!y||w[1]>y[0]&&w[1]<y[3])){f.label=w[1];break}if(w[0]===6&&f.label<y[1]){f.label=y[1],y=w;break}if(y&&f.label<y[2]){f.label=y[2],f.ops.push(w);break}y[2]&&f.ops.pop(),f.trys.pop();continue}w=l.call(h,f)}catch(N){w=[6,N],m=0}finally{d=y=0}if(w[0]&5)throw w[1];return{value:w[0]?w[1]:void 0,done:!0}}};Object.defineProperty(t,"__esModule",{value:!0}),t.Header=t.Track=t.Midi=void 0;var r=Bt,i=Ot,o=tt,s=Rt,c=function(){function h(l){var f=this,d=null;if(l){var m=l instanceof ArrayBuffer?new Uint8Array(l):l;d=(0,r.parseMidi)(m),d.tracks.forEach(function(y){var I=0;y.forEach(function(q){I+=q.deltaTime,q.absoluteTime=I})}),d.tracks=p(d.tracks)}this.header=new i.Header(d),this.tracks=[],l&&(this.tracks=d.tracks.map(function(y){return new o.Track(y,f.header)}),d.header.format===1&&this.tracks[0].duration===0&&this.tracks.shift())}return h.fromUrl=function(l){return e(this,void 0,void 0,function(){var f,d;return n(this,function(m){switch(m.label){case 0:return[4,fetch(l)];case 1:return f=m.sent(),f.ok?[4,f.arrayBuffer()]:[3,3];case 2:return d=m.sent(),[2,new h(d)];case 3:throw new Error("Could not load '".concat(l,"'"))}})})},Object.defineProperty(h.prototype,"name",{get:function(){return this.header.name},set:function(l){this.header.name=l},enumerable:!1,configurable:!0}),Object.defineProperty(h.prototype,"duration",{get:function(){var l=this.tracks.map(function(f){return f.duration});return Math.max.apply(Math,l)},enumerable:!1,configurable:!0}),Object.defineProperty(h.prototype,"durationTicks",{get:function(){var l=this.tracks.map(function(f){return f.durationTicks});return Math.max.apply(Math,l)},enumerable:!1,configurable:!0}),h.prototype.addTrack=function(){var l=new o.Track(void 0,this.header);return this.tracks.push(l),l},h.prototype.toArray=function(){return(0,s.encode)(this)},h.prototype.toJSON=function(){return{header:this.header.toJSON(),tracks:this.tracks.map(function(l){return l.toJSON()})}},h.prototype.fromJSON=function(l){var f=this;this.header=new i.Header,this.header.fromJSON(l.header),this.tracks=l.tracks.map(function(d){var m=new o.Track(void 0,f.header);return m.fromJSON(d),m})},h.prototype.clone=function(){var l=new h;return l.fromJSON(this.toJSON()),l},h}();t.Midi=c;var u=tt;Object.defineProperty(t,"Track",{enumerable:!0,get:function(){return u.Track}});var a=Ot;Object.defineProperty(t,"Header",{enumerable:!0,get:function(){return a.Header}});function p(h){for(var l=[],f=0;f<h.length;f++)for(var d=l.length,m=new Map,y=Array(16).fill(0),I=0,q=h[f];I<q.length;I++){var F=q[I],w=d,N=F.channel;if(N!==void 0){F.type==="programChange"&&(y[N]=F.programNumber);var V=y[N],T="".concat(V," ").concat(N);m.has(T)?w=m.get(T):(w=d+m.size,m.set(T,w))}l[w]||l.push([]),l[w].push(F)}return l}})(Sr);const Ye=["C","C#","D","D#","E","F","F#","G","G#","A","A#","B"],Yn={Backquote:"A#2",Tab:"B2",KeyQ:"C3",Digit2:"C#3",KeyW:"D3",Digit3:"D#3",KeyE:"E3",KeyR:"F3",Digit5:"F#3",KeyT:"G3",Digit6:"G#3",KeyY:"A3",Digit7:"A#3",KeyU:"B3",KeyI:"C4",Digit9:"C#4",KeyO:"D4",Digit0:"D#4",KeyP:"E4",BracketLeft:"F4",Equal:"F#4",BracketRight:"G4",Backspace:"G#4",Backslash:"A4",CapsLock:"A#4",ShiftLeft:"B4",KeyZ:"C5",KeyS:"C#5",KeyX:"D5",KeyD:"D#5",KeyC:"E5",KeyV:"F5",KeyG:"F#5",KeyB:"G5",KeyH:"G#5",KeyN:"A5",KeyJ:"A#5",KeyM:"B5",Comma:"C6",KeyL:"C#6",Period:"D6",Semicolon:"D#6",Slash:"E6",ShiftRight:"F6",Enter:"F#6"};function sn(t){return parseInt(t.charAt(t.length-1))}function on(t){return t.substring(0,t.length-1)}function Jt(t){const e=Math.floor(t/12)-1;return Ye[t%12]+e}function is(t,e){const n=sn(e),r=sn(t),i=Ye.indexOf(on(t)),o=Ye.indexOf(on(e)),s={};let c=0;for(let u=r;u<=n;u++){let a=u===r?i:0;for(;a<Ye.length&&!(u===n&&a>o);){const h=Ye[a],l=h.length===1;s[h+u]={isWhite:l,pressedColor:null,isGhost:!1},l&&c++,a++}}return{noteMap:s,whiteKeys:c}}const re=ee(!1),Me=ee(0),_t=ee(0),an=ee(),Qe=ee(1);async function ss(t,e){let n=[],r=null;function i(a){r=new Sr.Midi(a),r.tracks=r.tracks.filter(h=>h.notes.length!==0);let p=0;r.tracks.forEach(h=>{const l=h.notes[h.notes.length-1],f=l.time+l.duration;f>p&&(p=f)}),_t.set(p)}an.subscribe(a=>{if(re.set(!1),_t.set(0),Me.set(0),!a){r=null;return}const p=new FileReader;p.onload=()=>i(p.result),p.readAsArrayBuffer(a)});function o(a){const p=pe(Me)+a;Me.set(p),r.tracks.forEach((h,l)=>{const f=h.notes[n[l]];!f||p>f.time&&(t(f.name,f.velocity),setTimeout(()=>e(f.name),f.duration*1e3/pe(Qe)),n[l]++)}),p>pe(_t)&&re.set(!1)}re.subscribe(a=>{if(!a)return;if(!r)return re.set(!1),alert("No MIDI file selected!");r.tracks.forEach((l,f)=>{const d=pe(Me),m=os(l.notes,y=>y.time-d);n[f]=m});let p=performance.now();function h(){if(!pe(re))return;const l=performance.now(),f=l-p;p=l,o(f/1e3*pe(Qe)),requestAnimationFrame(h)}h()});function s(a){const[p,h,l]=a.data;p>143&&p<160?l==0?e(Jt(h)):t(Jt(h),l/127):p>127&&p<144&&e(Jt(h))}const c=await navigator.requestMIDIAccess();function u(){c.inputs.forEach(a=>{a.onmidimessage=s})}u(),c.onstatechange=()=>{u()}}function os(t,e){let n=0,r=t.length-1;for(;n!=r;){const i=Math.ceil((n+r)/2);e(t[i])>0?r=i-1:n=i}return r}const ye=Object.create(null);ye.open="0";ye.close="1";ye.ping="2";ye.pong="3";ye.message="4";ye.upgrade="5";ye.noop="6";const kt=Object.create(null);Object.keys(ye).forEach(t=>{kt[ye[t]]=t});const as={type:"error",data:"parser error"},cs=typeof Blob=="function"||typeof Blob<"u"&&Object.prototype.toString.call(Blob)==="[object BlobConstructor]",us=typeof ArrayBuffer=="function",ls=t=>typeof ArrayBuffer.isView=="function"?ArrayBuffer.isView(t):t&&t.buffer instanceof ArrayBuffer,Nr=({type:t,data:e},n,r)=>cs&&e instanceof Blob?n?r(e):Xn(e,r):us&&(e instanceof ArrayBuffer||ls(e))?n?r(e):Xn(new Blob([e]),r):r(ye[t]+(e||"")),Xn=(t,e)=>{const n=new FileReader;return n.onload=function(){const r=n.result.split(",")[1];e("b"+r)},n.readAsDataURL(t)},Qn="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",Xe=typeof Uint8Array>"u"?[]:new Uint8Array(256);for(let t=0;t<Qn.length;t++)Xe[Qn.charCodeAt(t)]=t;const fs=t=>{let e=t.length*.75,n=t.length,r,i=0,o,s,c,u;t[t.length-1]==="="&&(e--,t[t.length-2]==="="&&e--);const a=new ArrayBuffer(e),p=new Uint8Array(a);for(r=0;r<n;r+=4)o=Xe[t.charCodeAt(r)],s=Xe[t.charCodeAt(r+1)],c=Xe[t.charCodeAt(r+2)],u=Xe[t.charCodeAt(r+3)],p[i++]=o<<2|s>>4,p[i++]=(s&15)<<4|c>>2,p[i++]=(c&3)<<6|u&63;return a},hs=typeof ArrayBuffer=="function",Er=(t,e)=>{if(typeof t!="string")return{type:"message",data:Ar(t,e)};const n=t.charAt(0);return n==="b"?{type:"message",data:ds(t.substring(1),e)}:kt[n]?t.length>1?{type:kt[n],data:t.substring(1)}:{type:kt[n]}:as},ds=(t,e)=>{if(hs){const n=fs(t);return Ar(n,e)}else return{base64:!0,data:t}},Ar=(t,e)=>{switch(e){case"blob":return t instanceof ArrayBuffer?new Blob([t]):t;case"arraybuffer":default:return t}},Br=String.fromCharCode(30),ps=(t,e)=>{const n=t.length,r=new Array(n);let i=0;t.forEach((o,s)=>{Nr(o,!1,c=>{r[s]=c,++i===n&&e(r.join(Br))})})},ms=(t,e)=>{const n=t.split(Br),r=[];for(let i=0;i<n.length;i++){const o=Er(n[i],e);if(r.push(o),o.type==="error")break}return r},Pr=4;function H(t){if(t)return ys(t)}function ys(t){for(var e in H.prototype)t[e]=H.prototype[e];return t}H.prototype.on=H.prototype.addEventListener=function(t,e){return this._callbacks=this._callbacks||{},(this._callbacks["$"+t]=this._callbacks["$"+t]||[]).push(e),this};H.prototype.once=function(t,e){function n(){this.off(t,n),e.apply(this,arguments)}return n.fn=e,this.on(t,n),this};H.prototype.off=H.prototype.removeListener=H.prototype.removeAllListeners=H.prototype.removeEventListener=function(t,e){if(this._callbacks=this._callbacks||{},arguments.length==0)return this._callbacks={},this;var n=this._callbacks["$"+t];if(!n)return this;if(arguments.length==1)return delete this._callbacks["$"+t],this;for(var r,i=0;i<n.length;i++)if(r=n[i],r===e||r.fn===e){n.splice(i,1);break}return n.length===0&&delete this._callbacks["$"+t],this};H.prototype.emit=function(t){this._callbacks=this._callbacks||{};for(var e=new Array(arguments.length-1),n=this._callbacks["$"+t],r=1;r<arguments.length;r++)e[r-1]=arguments[r];if(n){n=n.slice(0);for(var r=0,i=n.length;r<i;++r)n[r].apply(this,e)}return this};H.prototype.emitReserved=H.prototype.emit;H.prototype.listeners=function(t){return this._callbacks=this._callbacks||{},this._callbacks["$"+t]||[]};H.prototype.hasListeners=function(t){return!!this.listeners(t).length};const Ee=(()=>typeof self<"u"?self:typeof window<"u"?window:Function("return this")())();function Ur(t,...e){return e.reduce((n,r)=>(t.hasOwnProperty(r)&&(n[r]=t[r]),n),{})}const gs=setTimeout,bs=clearTimeout;function Dt(t,e){e.useNativeTimers?(t.setTimeoutFn=gs.bind(Ee),t.clearTimeoutFn=bs.bind(Ee)):(t.setTimeoutFn=setTimeout.bind(Ee),t.clearTimeoutFn=clearTimeout.bind(Ee))}const vs=1.33;function _s(t){return typeof t=="string"?ks(t):Math.ceil((t.byteLength||t.size)*vs)}function ks(t){let e=0,n=0;for(let r=0,i=t.length;r<i;r++)e=t.charCodeAt(r),e<128?n+=1:e<2048?n+=2:e<55296||e>=57344?n+=3:(r++,n+=4);return n}class ws extends Error{constructor(e,n,r){super(e),this.description=n,this.context=r,this.type="TransportError"}}class Mr extends H{constructor(e){super(),this.writable=!1,Dt(this,e),this.opts=e,this.query=e.query,this.readyState="",this.socket=e.socket}onError(e,n,r){return super.emitReserved("error",new ws(e,n,r)),this}open(){return(this.readyState==="closed"||this.readyState==="")&&(this.readyState="opening",this.doOpen()),this}close(){return(this.readyState==="opening"||this.readyState==="open")&&(this.doClose(),this.onClose()),this}send(e){this.readyState==="open"&&this.write(e)}onOpen(){this.readyState="open",this.writable=!0,super.emitReserved("open")}onData(e){const n=Er(e,this.socket.binaryType);this.onPacket(n)}onPacket(e){super.emitReserved("packet",e)}onClose(e){this.readyState="closed",super.emitReserved("close",e)}}const Fr="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz-_".split(""),cn=64,Ts={};let Zn=0,mt=0,er;function tr(t){let e="";do e=Fr[t%cn]+e,t=Math.floor(t/cn);while(t>0);return e}function Rr(){const t=tr(+new Date);return t!==er?(Zn=0,er=t):t+"."+tr(Zn++)}for(;mt<cn;mt++)Ts[Fr[mt]]=mt;function Dr(t){let e="";for(let n in t)t.hasOwnProperty(n)&&(e.length&&(e+="&"),e+=encodeURIComponent(n)+"="+encodeURIComponent(t[n]));return e}function xs(t){let e={},n=t.split("&");for(let r=0,i=n.length;r<i;r++){let o=n[r].split("=");e[decodeURIComponent(o[0])]=decodeURIComponent(o[1])}return e}let Lr=!1;try{Lr=typeof XMLHttpRequest<"u"&&"withCredentials"in new XMLHttpRequest}catch{}const Ss=Lr;function qr(t){const e=t.xdomain;try{if(typeof XMLHttpRequest<"u"&&(!e||Ss))return new XMLHttpRequest}catch{}if(!e)try{return new Ee[["Active"].concat("Object").join("X")]("Microsoft.XMLHTTP")}catch{}}function Is(){}const Cs=function(){return new qr({xdomain:!1}).responseType!=null}();class Os extends Mr{constructor(e){if(super(e),this.polling=!1,typeof location<"u"){const r=location.protocol==="https:";let i=location.port;i||(i=r?"443":"80"),this.xd=typeof location<"u"&&e.hostname!==location.hostname||i!==e.port,this.xs=e.secure!==r}const n=e&&e.forceBase64;this.supportsBinary=Cs&&!n}get name(){return"polling"}doOpen(){this.poll()}pause(e){this.readyState="pausing";const n=()=>{this.readyState="paused",e()};if(this.polling||!this.writable){let r=0;this.polling&&(r++,this.once("pollComplete",function(){--r||n()})),this.writable||(r++,this.once("drain",function(){--r||n()}))}else n()}poll(){this.polling=!0,this.doPoll(),this.emitReserved("poll")}onData(e){const n=r=>{if(this.readyState==="opening"&&r.type==="open"&&this.onOpen(),r.type==="close")return this.onClose({description:"transport closed by the server"}),!1;this.onPacket(r)};ms(e,this.socket.binaryType).forEach(n),this.readyState!=="closed"&&(this.polling=!1,this.emitReserved("pollComplete"),this.readyState==="open"&&this.poll())}doClose(){const e=()=>{this.write([{type:"close"}])};this.readyState==="open"?e():this.once("open",e)}write(e){this.writable=!1,ps(e,n=>{this.doWrite(n,()=>{this.writable=!0,this.emitReserved("drain")})})}uri(){let e=this.query||{};const n=this.opts.secure?"https":"http";let r="";this.opts.timestampRequests!==!1&&(e[this.opts.timestampParam]=Rr()),!this.supportsBinary&&!e.sid&&(e.b64=1),this.opts.port&&(n==="https"&&Number(this.opts.port)!==443||n==="http"&&Number(this.opts.port)!==80)&&(r=":"+this.opts.port);const i=Dr(e),o=this.opts.hostname.indexOf(":")!==-1;return n+"://"+(o?"["+this.opts.hostname+"]":this.opts.hostname)+r+this.opts.path+(i.length?"?"+i:"")}request(e={}){return Object.assign(e,{xd:this.xd,xs:this.xs},this.opts),new me(this.uri(),e)}doWrite(e,n){const r=this.request({method:"POST",data:e});r.on("success",n),r.on("error",(i,o)=>{this.onError("xhr post error",i,o)})}doPoll(){const e=this.request();e.on("data",this.onData.bind(this)),e.on("error",(n,r)=>{this.onError("xhr poll error",n,r)}),this.pollXhr=e}}class me extends H{constructor(e,n){super(),Dt(this,n),this.opts=n,this.method=n.method||"GET",this.uri=e,this.async=n.async!==!1,this.data=n.data!==void 0?n.data:null,this.create()}create(){const e=Ur(this.opts,"agent","pfx","key","passphrase","cert","ca","ciphers","rejectUnauthorized","autoUnref");e.xdomain=!!this.opts.xd,e.xscheme=!!this.opts.xs;const n=this.xhr=new qr(e);try{n.open(this.method,this.uri,this.async);try{if(this.opts.extraHeaders){n.setDisableHeaderCheck&&n.setDisableHeaderCheck(!0);for(let r in this.opts.extraHeaders)this.opts.extraHeaders.hasOwnProperty(r)&&n.setRequestHeader(r,this.opts.extraHeaders[r])}}catch{}if(this.method==="POST")try{n.setRequestHeader("Content-type","text/plain;charset=UTF-8")}catch{}try{n.setRequestHeader("Accept","*/*")}catch{}"withCredentials"in n&&(n.withCredentials=this.opts.withCredentials),this.opts.requestTimeout&&(n.timeout=this.opts.requestTimeout),n.onreadystatechange=()=>{n.readyState===4&&(n.status===200||n.status===1223?this.onLoad():this.setTimeoutFn(()=>{this.onError(typeof n.status=="number"?n.status:0)},0))},n.send(this.data)}catch(r){this.setTimeoutFn(()=>{this.onError(r)},0);return}typeof document<"u"&&(this.index=me.requestsCount++,me.requests[this.index]=this)}onError(e){this.emitReserved("error",e,this.xhr),this.cleanup(!0)}cleanup(e){if(!(typeof this.xhr>"u"||this.xhr===null)){if(this.xhr.onreadystatechange=Is,e)try{this.xhr.abort()}catch{}typeof document<"u"&&delete me.requests[this.index],this.xhr=null}}onLoad(){const e=this.xhr.responseText;e!==null&&(this.emitReserved("data",e),this.emitReserved("success"),this.cleanup())}abort(){this.cleanup()}}me.requestsCount=0;me.requests={};if(typeof document<"u"){if(typeof attachEvent=="function")attachEvent("onunload",nr);else if(typeof addEventListener=="function"){const t="onpagehide"in Ee?"pagehide":"unload";addEventListener(t,nr,!1)}}function nr(){for(let t in me.requests)me.requests.hasOwnProperty(t)&&me.requests[t].abort()}const Ns=(()=>typeof Promise=="function"&&typeof Promise.resolve=="function"?e=>Promise.resolve().then(e):(e,n)=>n(e,0))(),yt=Ee.WebSocket||Ee.MozWebSocket,rr=!0,Es="arraybuffer",ir=typeof navigator<"u"&&typeof navigator.product=="string"&&navigator.product.toLowerCase()==="reactnative";class As extends Mr{constructor(e){super(e),this.supportsBinary=!e.forceBase64}get name(){return"websocket"}doOpen(){if(!this.check())return;const e=this.uri(),n=this.opts.protocols,r=ir?{}:Ur(this.opts,"agent","perMessageDeflate","pfx","key","passphrase","cert","ca","ciphers","rejectUnauthorized","localAddress","protocolVersion","origin","maxPayload","family","checkServerIdentity");this.opts.extraHeaders&&(r.headers=this.opts.extraHeaders);try{this.ws=rr&&!ir?n?new yt(e,n):new yt(e):new yt(e,n,r)}catch(i){return this.emitReserved("error",i)}this.ws.binaryType=this.socket.binaryType||Es,this.addEventListeners()}addEventListeners(){this.ws.onopen=()=>{this.opts.autoUnref&&this.ws._socket.unref(),this.onOpen()},this.ws.onclose=e=>this.onClose({description:"websocket connection closed",context:e}),this.ws.onmessage=e=>this.onData(e.data),this.ws.onerror=e=>this.onError("websocket error",e)}write(e){this.writable=!1;for(let n=0;n<e.length;n++){const r=e[n],i=n===e.length-1;Nr(r,this.supportsBinary,o=>{const s={};try{rr&&this.ws.send(o)}catch{}i&&Ns(()=>{this.writable=!0,this.emitReserved("drain")},this.setTimeoutFn)})}}doClose(){typeof this.ws<"u"&&(this.ws.close(),this.ws=null)}uri(){let e=this.query||{};const n=this.opts.secure?"wss":"ws";let r="";this.opts.port&&(n==="wss"&&Number(this.opts.port)!==443||n==="ws"&&Number(this.opts.port)!==80)&&(r=":"+this.opts.port),this.opts.timestampRequests&&(e[this.opts.timestampParam]=Rr()),this.supportsBinary||(e.b64=1);const i=Dr(e),o=this.opts.hostname.indexOf(":")!==-1;return n+"://"+(o?"["+this.opts.hostname+"]":this.opts.hostname)+r+this.opts.path+(i.length?"?"+i:"")}check(){return!!yt}}const Bs={websocket:As,polling:Os},Ps=/^(?:(?![^:@]+:[^:@\/]*@)(http|https|ws|wss):\/\/)?((?:(([^:@]*)(?::([^:@]*))?)?@)?((?:[a-f0-9]{0,4}:){2,7}[a-f0-9]{0,4}|[^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/,Us=["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"];function un(t){const e=t,n=t.indexOf("["),r=t.indexOf("]");n!=-1&&r!=-1&&(t=t.substring(0,n)+t.substring(n,r).replace(/:/g,";")+t.substring(r,t.length));let i=Ps.exec(t||""),o={},s=14;for(;s--;)o[Us[s]]=i[s]||"";return n!=-1&&r!=-1&&(o.source=e,o.host=o.host.substring(1,o.host.length-1).replace(/;/g,":"),o.authority=o.authority.replace("[","").replace("]","").replace(/;/g,":"),o.ipv6uri=!0),o.pathNames=Ms(o,o.path),o.queryKey=Fs(o,o.query),o}function Ms(t,e){const n=/\/{2,9}/g,r=e.replace(n,"/").split("/");return(e.substr(0,1)=="/"||e.length===0)&&r.splice(0,1),e.substr(e.length-1,1)=="/"&&r.splice(r.length-1,1),r}function Fs(t,e){const n={};return e.replace(/(?:^|&)([^&=]*)=?([^&]*)/g,function(r,i,o){i&&(n[i]=o)}),n}class Ne extends H{constructor(e,n={}){super(),e&&typeof e=="object"&&(n=e,e=null),e?(e=un(e),n.hostname=e.host,n.secure=e.protocol==="https"||e.protocol==="wss",n.port=e.port,e.query&&(n.query=e.query)):n.host&&(n.hostname=un(n.host).host),Dt(this,n),this.secure=n.secure!=null?n.secure:typeof location<"u"&&location.protocol==="https:",n.hostname&&!n.port&&(n.port=this.secure?"443":"80"),this.hostname=n.hostname||(typeof location<"u"?location.hostname:"localhost"),this.port=n.port||(typeof location<"u"&&location.port?location.port:this.secure?"443":"80"),this.transports=n.transports||["polling","websocket"],this.readyState="",this.writeBuffer=[],this.prevBufferLen=0,this.opts=Object.assign({path:"/engine.io",agent:!1,withCredentials:!1,upgrade:!0,timestampParam:"t",rememberUpgrade:!1,rejectUnauthorized:!0,perMessageDeflate:{threshold:1024},transportOptions:{},closeOnBeforeunload:!0},n),this.opts.path=this.opts.path.replace(/\/$/,"")+"/",typeof this.opts.query=="string"&&(this.opts.query=xs(this.opts.query)),this.id=null,this.upgrades=null,this.pingInterval=null,this.pingTimeout=null,this.pingTimeoutTimer=null,typeof addEventListener=="function"&&(this.opts.closeOnBeforeunload&&addEventListener("beforeunload",()=>{this.transport&&(this.transport.removeAllListeners(),this.transport.close())},!1),this.hostname!=="localhost"&&(this.offlineEventListener=()=>{this.onClose("transport close",{description:"network connection lost"})},addEventListener("offline",this.offlineEventListener,!1))),this.open()}createTransport(e){const n=Object.assign({},this.opts.query);n.EIO=Pr,n.transport=e,this.id&&(n.sid=this.id);const r=Object.assign({},this.opts.transportOptions[e],this.opts,{query:n,socket:this,hostname:this.hostname,secure:this.secure,port:this.port});return new Bs[e](r)}open(){let e;if(this.opts.rememberUpgrade&&Ne.priorWebsocketSuccess&&this.transports.indexOf("websocket")!==-1)e="websocket";else if(this.transports.length===0){this.setTimeoutFn(()=>{this.emitReserved("error","No transports available")},0);return}else e=this.transports[0];this.readyState="opening";try{e=this.createTransport(e)}catch{this.transports.shift(),this.open();return}e.open(),this.setTransport(e)}setTransport(e){this.transport&&this.transport.removeAllListeners(),this.transport=e,e.on("drain",this.onDrain.bind(this)).on("packet",this.onPacket.bind(this)).on("error",this.onError.bind(this)).on("close",n=>this.onClose("transport close",n))}probe(e){let n=this.createTransport(e),r=!1;Ne.priorWebsocketSuccess=!1;const i=()=>{r||(n.send([{type:"ping",data:"probe"}]),n.once("packet",h=>{if(!r)if(h.type==="pong"&&h.data==="probe"){if(this.upgrading=!0,this.emitReserved("upgrading",n),!n)return;Ne.priorWebsocketSuccess=n.name==="websocket",this.transport.pause(()=>{r||this.readyState!=="closed"&&(p(),this.setTransport(n),n.send([{type:"upgrade"}]),this.emitReserved("upgrade",n),n=null,this.upgrading=!1,this.flush())})}else{const l=new Error("probe error");l.transport=n.name,this.emitReserved("upgradeError",l)}}))};function o(){r||(r=!0,p(),n.close(),n=null)}const s=h=>{const l=new Error("probe error: "+h);l.transport=n.name,o(),this.emitReserved("upgradeError",l)};function c(){s("transport closed")}function u(){s("socket closed")}function a(h){n&&h.name!==n.name&&o()}const p=()=>{n.removeListener("open",i),n.removeListener("error",s),n.removeListener("close",c),this.off("close",u),this.off("upgrading",a)};n.once("open",i),n.once("error",s),n.once("close",c),this.once("close",u),this.once("upgrading",a),n.open()}onOpen(){if(this.readyState="open",Ne.priorWebsocketSuccess=this.transport.name==="websocket",this.emitReserved("open"),this.flush(),this.readyState==="open"&&this.opts.upgrade&&this.transport.pause){let e=0;const n=this.upgrades.length;for(;e<n;e++)this.probe(this.upgrades[e])}}onPacket(e){if(this.readyState==="opening"||this.readyState==="open"||this.readyState==="closing")switch(this.emitReserved("packet",e),this.emitReserved("heartbeat"),e.type){case"open":this.onHandshake(JSON.parse(e.data));break;case"ping":this.resetPingTimeout(),this.sendPacket("pong"),this.emitReserved("ping"),this.emitReserved("pong");break;case"error":const n=new Error("server error");n.code=e.data,this.onError(n);break;case"message":this.emitReserved("data",e.data),this.emitReserved("message",e.data);break}}onHandshake(e){this.emitReserved("handshake",e),this.id=e.sid,this.transport.query.sid=e.sid,this.upgrades=this.filterUpgrades(e.upgrades),this.pingInterval=e.pingInterval,this.pingTimeout=e.pingTimeout,this.maxPayload=e.maxPayload,this.onOpen(),this.readyState!=="closed"&&this.resetPingTimeout()}resetPingTimeout(){this.clearTimeoutFn(this.pingTimeoutTimer),this.pingTimeoutTimer=this.setTimeoutFn(()=>{this.onClose("ping timeout")},this.pingInterval+this.pingTimeout),this.opts.autoUnref&&this.pingTimeoutTimer.unref()}onDrain(){this.writeBuffer.splice(0,this.prevBufferLen),this.prevBufferLen=0,this.writeBuffer.length===0?this.emitReserved("drain"):this.flush()}flush(){if(this.readyState!=="closed"&&this.transport.writable&&!this.upgrading&&this.writeBuffer.length){const e=this.getWritablePackets();this.transport.send(e),this.prevBufferLen=e.length,this.emitReserved("flush")}}getWritablePackets(){if(!(this.maxPayload&&this.transport.name==="polling"&&this.writeBuffer.length>1))return this.writeBuffer;let n=1;for(let r=0;r<this.writeBuffer.length;r++){const i=this.writeBuffer[r].data;if(i&&(n+=_s(i)),r>0&&n>this.maxPayload)return this.writeBuffer.slice(0,r);n+=2}return this.writeBuffer}write(e,n,r){return this.sendPacket("message",e,n,r),this}send(e,n,r){return this.sendPacket("message",e,n,r),this}sendPacket(e,n,r,i){if(typeof n=="function"&&(i=n,n=void 0),typeof r=="function"&&(i=r,r=null),this.readyState==="closing"||this.readyState==="closed")return;r=r||{},r.compress=r.compress!==!1;const o={type:e,data:n,options:r};this.emitReserved("packetCreate",o),this.writeBuffer.push(o),i&&this.once("flush",i),this.flush()}close(){const e=()=>{this.onClose("forced close"),this.transport.close()},n=()=>{this.off("upgrade",n),this.off("upgradeError",n),e()},r=()=>{this.once("upgrade",n),this.once("upgradeError",n)};return(this.readyState==="opening"||this.readyState==="open")&&(this.readyState="closing",this.writeBuffer.length?this.once("drain",()=>{this.upgrading?r():e()}):this.upgrading?r():e()),this}onError(e){Ne.priorWebsocketSuccess=!1,this.emitReserved("error",e),this.onClose("transport error",e)}onClose(e,n){(this.readyState==="opening"||this.readyState==="open"||this.readyState==="closing")&&(this.clearTimeoutFn(this.pingTimeoutTimer),this.transport.removeAllListeners("close"),this.transport.close(),this.transport.removeAllListeners(),typeof removeEventListener=="function"&&removeEventListener("offline",this.offlineEventListener,!1),this.readyState="closed",this.id=null,this.emitReserved("close",e,n),this.writeBuffer=[],this.prevBufferLen=0)}filterUpgrades(e){const n=[];let r=0;const i=e.length;for(;r<i;r++)~this.transports.indexOf(e[r])&&n.push(e[r]);return n}}Ne.protocol=Pr;function Rs(t,e="",n){let r=t;n=n||typeof location<"u"&&location,t==null&&(t=n.protocol+"//"+n.host),typeof t=="string"&&(t.charAt(0)==="/"&&(t.charAt(1)==="/"?t=n.protocol+t:t=n.host+t),/^(https?|wss?):\/\//.test(t)||(typeof n<"u"?t=n.protocol+"//"+t:t="https://"+t),r=un(t)),r.port||(/^(http|ws)$/.test(r.protocol)?r.port="80":/^(http|ws)s$/.test(r.protocol)&&(r.port="443")),r.path=r.path||"/";const o=r.host.indexOf(":")!==-1?"["+r.host+"]":r.host;return r.id=r.protocol+"://"+o+":"+r.port+e,r.href=r.protocol+"://"+o+(n&&n.port===r.port?"":":"+r.port),r}const Ds=typeof ArrayBuffer=="function",Ls=t=>typeof ArrayBuffer.isView=="function"?ArrayBuffer.isView(t):t.buffer instanceof ArrayBuffer,Vr=Object.prototype.toString,qs=typeof Blob=="function"||typeof Blob<"u"&&Vr.call(Blob)==="[object BlobConstructor]",Vs=typeof File=="function"||typeof File<"u"&&Vr.call(File)==="[object FileConstructor]";function vn(t){return Ds&&(t instanceof ArrayBuffer||Ls(t))||qs&&t instanceof Blob||Vs&&t instanceof File}function wt(t,e){if(!t||typeof t!="object")return!1;if(Array.isArray(t)){for(let n=0,r=t.length;n<r;n++)if(wt(t[n]))return!0;return!1}if(vn(t))return!0;if(t.toJSON&&typeof t.toJSON=="function"&&arguments.length===1)return wt(t.toJSON(),!0);for(const n in t)if(Object.prototype.hasOwnProperty.call(t,n)&&wt(t[n]))return!0;return!1}function js(t){const e=[],n=t.data,r=t;return r.data=ln(n,e),r.attachments=e.length,{packet:r,buffers:e}}function ln(t,e){if(!t)return t;if(vn(t)){const n={_placeholder:!0,num:e.length};return e.push(t),n}else if(Array.isArray(t)){const n=new Array(t.length);for(let r=0;r<t.length;r++)n[r]=ln(t[r],e);return n}else if(typeof t=="object"&&!(t instanceof Date)){const n={};for(const r in t)Object.prototype.hasOwnProperty.call(t,r)&&(n[r]=ln(t[r],e));return n}return t}function Ks(t,e){return t.data=fn(t.data,e),t.attachments=void 0,t}function fn(t,e){if(!t)return t;if(t&&t._placeholder===!0){if(typeof t.num=="number"&&t.num>=0&&t.num<e.length)return e[t.num];throw new Error("illegal attachments")}else if(Array.isArray(t))for(let n=0;n<t.length;n++)t[n]=fn(t[n],e);else if(typeof t=="object")for(const n in t)Object.prototype.hasOwnProperty.call(t,n)&&(t[n]=fn(t[n],e));return t}const Hs=5;var O;(function(t){t[t.CONNECT=0]="CONNECT",t[t.DISCONNECT=1]="DISCONNECT",t[t.EVENT=2]="EVENT",t[t.ACK=3]="ACK",t[t.CONNECT_ERROR=4]="CONNECT_ERROR",t[t.BINARY_EVENT=5]="BINARY_EVENT",t[t.BINARY_ACK=6]="BINARY_ACK"})(O||(O={}));class $s{constructor(e){this.replacer=e}encode(e){return(e.type===O.EVENT||e.type===O.ACK)&&wt(e)?(e.type=e.type===O.EVENT?O.BINARY_EVENT:O.BINARY_ACK,this.encodeAsBinary(e)):[this.encodeAsString(e)]}encodeAsString(e){let n=""+e.type;return(e.type===O.BINARY_EVENT||e.type===O.BINARY_ACK)&&(n+=e.attachments+"-"),e.nsp&&e.nsp!=="/"&&(n+=e.nsp+","),e.id!=null&&(n+=e.id),e.data!=null&&(n+=JSON.stringify(e.data,this.replacer)),n}encodeAsBinary(e){const n=js(e),r=this.encodeAsString(n.packet),i=n.buffers;return i.unshift(r),i}}class _n extends H{constructor(e){super(),this.reviver=e}add(e){let n;if(typeof e=="string"){if(this.reconstructor)throw new Error("got plaintext data when reconstructing a packet");n=this.decodeString(e),n.type===O.BINARY_EVENT||n.type===O.BINARY_ACK?(this.reconstructor=new zs(n),n.attachments===0&&super.emitReserved("decoded",n)):super.emitReserved("decoded",n)}else if(vn(e)||e.base64)if(this.reconstructor)n=this.reconstructor.takeBinaryData(e),n&&(this.reconstructor=null,super.emitReserved("decoded",n));else throw new Error("got binary data when not reconstructing a packet");else throw new Error("Unknown type: "+e)}decodeString(e){let n=0;const r={type:Number(e.charAt(0))};if(O[r.type]===void 0)throw new Error("unknown packet type "+r.type);if(r.type===O.BINARY_EVENT||r.type===O.BINARY_ACK){const o=n+1;for(;e.charAt(++n)!=="-"&&n!=e.length;);const s=e.substring(o,n);if(s!=Number(s)||e.charAt(n)!=="-")throw new Error("Illegal attachments");r.attachments=Number(s)}if(e.charAt(n+1)==="/"){const o=n+1;for(;++n&&!(e.charAt(n)===","||n===e.length););r.nsp=e.substring(o,n)}else r.nsp="/";const i=e.charAt(n+1);if(i!==""&&Number(i)==i){const o=n+1;for(;++n;){const s=e.charAt(n);if(s==null||Number(s)!=s){--n;break}if(n===e.length)break}r.id=Number(e.substring(o,n+1))}if(e.charAt(++n)){const o=this.tryParse(e.substr(n));if(_n.isPayloadValid(r.type,o))r.data=o;else throw new Error("invalid payload")}return r}tryParse(e){try{return JSON.parse(e,this.reviver)}catch{return!1}}static isPayloadValid(e,n){switch(e){case O.CONNECT:return typeof n=="object";case O.DISCONNECT:return n===void 0;case O.CONNECT_ERROR:return typeof n=="string"||typeof n=="object";case O.EVENT:case O.BINARY_EVENT:return Array.isArray(n)&&n.length>0;case O.ACK:case O.BINARY_ACK:return Array.isArray(n)}}destroy(){this.reconstructor&&this.reconstructor.finishedReconstruction()}}class zs{constructor(e){this.packet=e,this.buffers=[],this.reconPack=e}takeBinaryData(e){if(this.buffers.push(e),this.buffers.length===this.reconPack.attachments){const n=Ks(this.reconPack,this.buffers);return this.finishedReconstruction(),n}return null}finishedReconstruction(){this.reconPack=null,this.buffers=[]}}const Js=Object.freeze(Object.defineProperty({__proto__:null,protocol:Hs,get PacketType(){return O},Encoder:$s,Decoder:_n},Symbol.toStringTag,{value:"Module"}));function ae(t,e,n){return t.on(e,n),function(){t.off(e,n)}}const Gs=Object.freeze({connect:1,connect_error:1,disconnect:1,disconnecting:1,newListener:1,removeListener:1});class jr extends H{constructor(e,n,r){super(),this.connected=!1,this.receiveBuffer=[],this.sendBuffer=[],this.ids=0,this.acks={},this.flags={},this.io=e,this.nsp=n,r&&r.auth&&(this.auth=r.auth),this.io._autoConnect&&this.open()}get disconnected(){return!this.connected}subEvents(){if(this.subs)return;const e=this.io;this.subs=[ae(e,"open",this.onopen.bind(this)),ae(e,"packet",this.onpacket.bind(this)),ae(e,"error",this.onerror.bind(this)),ae(e,"close",this.onclose.bind(this))]}get active(){return!!this.subs}connect(){return this.connected?this:(this.subEvents(),this.io._reconnecting||this.io.open(),this.io._readyState==="open"&&this.onopen(),this)}open(){return this.connect()}send(...e){return e.unshift("message"),this.emit.apply(this,e),this}emit(e,...n){if(Gs.hasOwnProperty(e))throw new Error('"'+e.toString()+'" is a reserved event name');n.unshift(e);const r={type:O.EVENT,data:n};if(r.options={},r.options.compress=this.flags.compress!==!1,typeof n[n.length-1]=="function"){const s=this.ids++,c=n.pop();this._registerAckCallback(s,c),r.id=s}const i=this.io.engine&&this.io.engine.transport&&this.io.engine.transport.writable;return this.flags.volatile&&(!i||!this.connected)||(this.connected?(this.notifyOutgoingListeners(r),this.packet(r)):this.sendBuffer.push(r)),this.flags={},this}_registerAckCallback(e,n){const r=this.flags.timeout;if(r===void 0){this.acks[e]=n;return}const i=this.io.setTimeoutFn(()=>{delete this.acks[e];for(let o=0;o<this.sendBuffer.length;o++)this.sendBuffer[o].id===e&&this.sendBuffer.splice(o,1);n.call(this,new Error("operation has timed out"))},r);this.acks[e]=(...o)=>{this.io.clearTimeoutFn(i),n.apply(this,[null,...o])}}packet(e){e.nsp=this.nsp,this.io._packet(e)}onopen(){typeof this.auth=="function"?this.auth(e=>{this.packet({type:O.CONNECT,data:e})}):this.packet({type:O.CONNECT,data:this.auth})}onerror(e){this.connected||this.emitReserved("connect_error",e)}onclose(e,n){this.connected=!1,delete this.id,this.emitReserved("disconnect",e,n)}onpacket(e){if(e.nsp===this.nsp)switch(e.type){case O.CONNECT:if(e.data&&e.data.sid){const i=e.data.sid;this.onconnect(i)}else this.emitReserved("connect_error",new Error("It seems you are trying to reach a Socket.IO server in v2.x with a v3.x client, but they are not compatible (more information here: https://socket.io/docs/v3/migrating-from-2-x-to-3-0/)"));break;case O.EVENT:case O.BINARY_EVENT:this.onevent(e);break;case O.ACK:case O.BINARY_ACK:this.onack(e);break;case O.DISCONNECT:this.ondisconnect();break;case O.CONNECT_ERROR:this.destroy();const r=new Error(e.data.message);r.data=e.data.data,this.emitReserved("connect_error",r);break}}onevent(e){const n=e.data||[];e.id!=null&&n.push(this.ack(e.id)),this.connected?this.emitEvent(n):this.receiveBuffer.push(Object.freeze(n))}emitEvent(e){if(this._anyListeners&&this._anyListeners.length){const n=this._anyListeners.slice();for(const r of n)r.apply(this,e)}super.emit.apply(this,e)}ack(e){const n=this;let r=!1;return function(...i){r||(r=!0,n.packet({type:O.ACK,id:e,data:i}))}}onack(e){const n=this.acks[e.id];typeof n=="function"&&(n.apply(this,e.data),delete this.acks[e.id])}onconnect(e){this.id=e,this.connected=!0,this.emitBuffered(),this.emitReserved("connect")}emitBuffered(){this.receiveBuffer.forEach(e=>this.emitEvent(e)),this.receiveBuffer=[],this.sendBuffer.forEach(e=>{this.notifyOutgoingListeners(e),this.packet(e)}),this.sendBuffer=[]}ondisconnect(){this.destroy(),this.onclose("io server disconnect")}destroy(){this.subs&&(this.subs.forEach(e=>e()),this.subs=void 0),this.io._destroy(this)}disconnect(){return this.connected&&this.packet({type:O.DISCONNECT}),this.destroy(),this.connected&&this.onclose("io client disconnect"),this}close(){return this.disconnect()}compress(e){return this.flags.compress=e,this}get volatile(){return this.flags.volatile=!0,this}timeout(e){return this.flags.timeout=e,this}onAny(e){return this._anyListeners=this._anyListeners||[],this._anyListeners.push(e),this}prependAny(e){return this._anyListeners=this._anyListeners||[],this._anyListeners.unshift(e),this}offAny(e){if(!this._anyListeners)return this;if(e){const n=this._anyListeners;for(let r=0;r<n.length;r++)if(e===n[r])return n.splice(r,1),this}else this._anyListeners=[];return this}listenersAny(){return this._anyListeners||[]}onAnyOutgoing(e){return this._anyOutgoingListeners=this._anyOutgoingListeners||[],this._anyOutgoingListeners.push(e),this}prependAnyOutgoing(e){return this._anyOutgoingListeners=this._anyOutgoingListeners||[],this._anyOutgoingListeners.unshift(e),this}offAnyOutgoing(e){if(!this._anyOutgoingListeners)return this;if(e){const n=this._anyOutgoingListeners;for(let r=0;r<n.length;r++)if(e===n[r])return n.splice(r,1),this}else this._anyOutgoingListeners=[];return this}listenersAnyOutgoing(){return this._anyOutgoingListeners||[]}notifyOutgoingListeners(e){if(this._anyOutgoingListeners&&this._anyOutgoingListeners.length){const n=this._anyOutgoingListeners.slice();for(const r of n)r.apply(this,e.data)}}}function ze(t){t=t||{},this.ms=t.min||100,this.max=t.max||1e4,this.factor=t.factor||2,this.jitter=t.jitter>0&&t.jitter<=1?t.jitter:0,this.attempts=0}ze.prototype.duration=function(){var t=this.ms*Math.pow(this.factor,this.attempts++);if(this.jitter){var e=Math.random(),n=Math.floor(e*this.jitter*t);t=(Math.floor(e*10)&1)==0?t-n:t+n}return Math.min(t,this.max)|0};ze.prototype.reset=function(){this.attempts=0};ze.prototype.setMin=function(t){this.ms=t};ze.prototype.setMax=function(t){this.max=t};ze.prototype.setJitter=function(t){this.jitter=t};class hn extends H{constructor(e,n){var r;super(),this.nsps={},this.subs=[],e&&typeof e=="object"&&(n=e,e=void 0),n=n||{},n.path=n.path||"/socket.io",this.opts=n,Dt(this,n),this.reconnection(n.reconnection!==!1),this.reconnectionAttempts(n.reconnectionAttempts||1/0),this.reconnectionDelay(n.reconnectionDelay||1e3),this.reconnectionDelayMax(n.reconnectionDelayMax||5e3),this.randomizationFactor((r=n.randomizationFactor)!==null&&r!==void 0?r:.5),this.backoff=new ze({min:this.reconnectionDelay(),max:this.reconnectionDelayMax(),jitter:this.randomizationFactor()}),this.timeout(n.timeout==null?2e4:n.timeout),this._readyState="closed",this.uri=e;const i=n.parser||Js;this.encoder=new i.Encoder,this.decoder=new i.Decoder,this._autoConnect=n.autoConnect!==!1,this._autoConnect&&this.open()}reconnection(e){return arguments.length?(this._reconnection=!!e,this):this._reconnection}reconnectionAttempts(e){return e===void 0?this._reconnectionAttempts:(this._reconnectionAttempts=e,this)}reconnectionDelay(e){var n;return e===void 0?this._reconnectionDelay:(this._reconnectionDelay=e,(n=this.backoff)===null||n===void 0||n.setMin(e),this)}randomizationFactor(e){var n;return e===void 0?this._randomizationFactor:(this._randomizationFactor=e,(n=this.backoff)===null||n===void 0||n.setJitter(e),this)}reconnectionDelayMax(e){var n;return e===void 0?this._reconnectionDelayMax:(this._reconnectionDelayMax=e,(n=this.backoff)===null||n===void 0||n.setMax(e),this)}timeout(e){return arguments.length?(this._timeout=e,this):this._timeout}maybeReconnectOnOpen(){!this._reconnecting&&this._reconnection&&this.backoff.attempts===0&&this.reconnect()}open(e){if(~this._readyState.indexOf("open"))return this;this.engine=new Ne(this.uri,this.opts);const n=this.engine,r=this;this._readyState="opening",this.skipReconnect=!1;const i=ae(n,"open",function(){r.onopen(),e&&e()}),o=ae(n,"error",s=>{r.cleanup(),r._readyState="closed",this.emitReserved("error",s),e?e(s):r.maybeReconnectOnOpen()});if(this._timeout!==!1){const s=this._timeout;s===0&&i();const c=this.setTimeoutFn(()=>{i(),n.close(),n.emit("error",new Error("timeout"))},s);this.opts.autoUnref&&c.unref(),this.subs.push(function(){clearTimeout(c)})}return this.subs.push(i),this.subs.push(o),this}connect(e){return this.open(e)}onopen(){this.cleanup(),this._readyState="open",this.emitReserved("open");const e=this.engine;this.subs.push(ae(e,"ping",this.onping.bind(this)),ae(e,"data",this.ondata.bind(this)),ae(e,"error",this.onerror.bind(this)),ae(e,"close",this.onclose.bind(this)),ae(this.decoder,"decoded",this.ondecoded.bind(this)))}onping(){this.emitReserved("ping")}ondata(e){try{this.decoder.add(e)}catch{this.onclose("parse error")}}ondecoded(e){this.emitReserved("packet",e)}onerror(e){this.emitReserved("error",e)}socket(e,n){let r=this.nsps[e];return r||(r=new jr(this,e,n),this.nsps[e]=r),r}_destroy(e){const n=Object.keys(this.nsps);for(const r of n)if(this.nsps[r].active)return;this._close()}_packet(e){const n=this.encoder.encode(e);for(let r=0;r<n.length;r++)this.engine.write(n[r],e.options)}cleanup(){this.subs.forEach(e=>e()),this.subs.length=0,this.decoder.destroy()}_close(){this.skipReconnect=!0,this._reconnecting=!1,this.onclose("forced close"),this.engine&&this.engine.close()}disconnect(){return this._close()}onclose(e,n){this.cleanup(),this.backoff.reset(),this._readyState="closed",this.emitReserved("close",e,n),this._reconnection&&!this.skipReconnect&&this.reconnect()}reconnect(){if(this._reconnecting||this.skipReconnect)return this;const e=this;if(this.backoff.attempts>=this._reconnectionAttempts)this.backoff.reset(),this.emitReserved("reconnect_failed"),this._reconnecting=!1;else{const n=this.backoff.duration();this._reconnecting=!0;const r=this.setTimeoutFn(()=>{e.skipReconnect||(this.emitReserved("reconnect_attempt",e.backoff.attempts),!e.skipReconnect&&e.open(i=>{i?(e._reconnecting=!1,e.reconnect(),this.emitReserved("reconnect_error",i)):e.onreconnect()}))},n);this.opts.autoUnref&&r.unref(),this.subs.push(function(){clearTimeout(r)})}}onreconnect(){const e=this.backoff.attempts;this._reconnecting=!1,this.backoff.reset(),this.emitReserved("reconnect",e)}}const Ge={};function Tt(t,e){typeof t=="object"&&(e=t,t=void 0),e=e||{};const n=Rs(t,e.path||"/socket.io"),r=n.source,i=n.id,o=n.path,s=Ge[i]&&o in Ge[i].nsps,c=e.forceNew||e["force new connection"]||e.multiplex===!1||s;let u;return c?u=new hn(r,e):(Ge[i]||(Ge[i]=new hn(r,e)),u=Ge[i]),n.query&&!e.query&&(e.query=n.queryKey),u.socket(n.path,e)}Object.assign(Tt,{Manager:hn,Socket:jr,io:Tt,connect:Tt});var Kr={exports:{}},Hr={exports:{}};function Ws(t){return t>64&&t<91?t-65:t>96&&t<123?t-71:t>47&&t<58?t+4:t===43?62:t===47?63:0}function Ys(t,e){for(var n=t.replace(/[^A-Za-z0-9\+\/]/g,""),r=n.length,i=e?Math.ceil((r*3+1>>2)/e)*e:r*3+1>>2,o=new Uint8Array(i),s,c,u=0,a=0,p=0;p<r;p++)if(c=p&3,u|=Ws(n.charCodeAt(p))<<18-6*c,c===3||r-p===1){for(s=0;s<3&&a<i;s++,a++)o[a]=u>>>(16>>>s&24)&255;u=0}return o}var Xs={decode:Ys},Qs=function(t,e){return new Promise(function(n,r){var i=new XMLHttpRequest;e&&(i.responseType=e),i.open("GET",t),i.onload=function(){i.status===200?n(i.response):r(Error(i.statusText))},i.onerror=function(){r(Error("Network Error"))},i.send()})};(function(t){var e=Xs,n=Qs;function r(T){return function(_){return typeof _=="string"&&T.test(_)}}function i(T,_){return typeof T=="string"?T+_:typeof T=="function"?T(_):_}function o(T,_,A,B){var te=s(_)?c:u(_)?a:p(_)?h:l(_)?f:d(_)?m:y(_)?I:q(_)?F:w(_)?N:null,b=A||{};return te?te(T,_,b):B?Promise.resolve(B):Promise.reject("Source not valid ("+_+")")}o.fetch=n;function s(T){return T instanceof ArrayBuffer}function c(T,_,A){return new Promise(function(B,te){T.decodeAudioData(_,function(b){B(b)},function(){te("Can't decode audio data ("+_.slice(0,30)+"...)")})})}var u=r(/\.(mp3|wav|ogg)(\?.*)?$/i);function a(T,_,A){var B=i(A.from,_);return o(T,o.fetch(B,"arraybuffer"),A)}function p(T){return T&&typeof T.then=="function"}function h(T,_,A){return _.then(function(B){return o(T,B,A)})}var l=Array.isArray;function f(T,_,A){return Promise.all(_.map(function(B){return o(T,B,A,B)}))}function d(T){return T&&typeof T=="object"}function m(T,_,A){var B={},te=Object.keys(_).map(function(b){if(A.only&&A.only.indexOf(b)===-1)return null;var S=_[b];return o(T,S,A,S).then(function(M){B[b]=M})});return Promise.all(te).then(function(){return B})}var y=r(/\.json(\?.*)?$/i);function I(T,_,A){var B=i(A.from,_);return o(T,o.fetch(B,"text").then(JSON.parse),A)}var q=r(/^data:audio/);function F(T,_,A){var B=_.indexOf(",");return o(T,e.decode(_.slice(B+1)).buffer,A)}var w=r(/\.js(\?.*)?$/i);function N(T,_,A){var B=i(A.from,_);return o(T,o.fetch(B,"text").then(V),A)}function V(T){var _=T.indexOf("MIDI.Soundfont.");if(_<0)throw Error("Invalid MIDI.js Soundfont format");_=T.indexOf("=",_)+2;var A=T.lastIndexOf(",");return JSON.parse(T.slice(_,A)+"}")}t.exports&&(t.exports=o),typeof window<"u"&&(window.loadAudio=o)})(Hr);var $r={exports:{}},Zs=eo;function eo(t){var e=t.createGain(),n=e._voltage=ro(t),r=je(n),i=je(n),o=je(n);return e._startAmount=je(i),e._endAmount=je(o),e._multiplier=je(r),e._multiplier.connect(e),e._startAmount.connect(e),e._endAmount.connect(e),e.value=r.gain,e.startValue=i.gain,e.endValue=o.gain,e.startValue.value=0,e.endValue.value=0,Object.defineProperties(e,to),e}var to={attack:{value:0,writable:!0},decay:{value:0,writable:!0},sustain:{value:1,writable:!0},release:{value:0,writable:!0},getReleaseDuration:{value:function(){return this.release}},start:{value:function(t){var e=this._multiplier.gain,n=this._startAmount.gain,r=this._endAmount.gain;this._voltage.start(t),this._decayFrom=this._decayFrom=t+this.attack,this._startedAt=t;var i=this.sustain;e.cancelScheduledValues(t),n.cancelScheduledValues(t),r.cancelScheduledValues(t),r.setValueAtTime(0,t),this.attack?(e.setValueAtTime(0,t),e.linearRampToValueAtTime(1,t+this.attack),n.setValueAtTime(1,t),n.linearRampToValueAtTime(0,t+this.attack)):(e.setValueAtTime(1,t),n.setValueAtTime(0,t)),this.decay&&e.setTargetAtTime(i,this._decayFrom,sr(this.decay))}},stop:{value:function(t,e){e&&(t=t-this.release);var n=t+this.release;if(this.release){var r=this._multiplier.gain,i=this._startAmount.gain,o=this._endAmount.gain;r.cancelScheduledValues(t),i.cancelScheduledValues(t),o.cancelScheduledValues(t);var s=sr(this.release);if(this.attack&&t<this._decayFrom){var c=io(0,1,this._startedAt,this._decayFrom,t);r.linearRampToValueAtTime(c,t),i.linearRampToValueAtTime(1-c,t),i.setTargetAtTime(0,t,s)}o.setTargetAtTime(1,t,s),r.setTargetAtTime(0,t,s)}return this._voltage.stop(n),n}},onended:{get:function(){return this._voltage.onended},set:function(t){this._voltage.onended=t}}},no=new Float32Array([1,1]);function ro(t){var e=t.createBufferSource(),n=t.createBuffer(1,2,t.sampleRate);return n.getChannelData(0).set(no),e.buffer=n,e.loop=!0,e}function je(t){var e=t.context.createGain();return t.connect(e),e}function sr(t){return Math.log(t+1)/Math.log(100)}function io(t,e,n,r,i){var o=e-t,s=r-n,c=i-n,u=c/s,a=t+u*o;return a<=t&&(a=t),a>=e&&(a=e),a}var so=Zs,oo={},ao={gain:1,attack:.01,decay:.1,sustain:.9,release:.3,loop:!1,cents:0,loopStart:0,loopEnd:0};function co(t,e,n){var r=!1,i=0,o={},s=t.createGain();s.gain.value=1;var c=Object.assign({},ao,n),u={context:t,out:s,opts:c};return e instanceof AudioBuffer?u.buffer=e:u.buffers=e,u.start=function(h,l,f){if(u.buffer&&h!==null)return u.start(null,h,l);var d=h?u.buffers[h]:u.buffer;if(d){if(!r){console.warn("SamplePlayer not connected to any node.");return}}else{console.warn("Buffer "+h+" not found.");return}var m=f||oo;l=Math.max(t.currentTime,l||0),u.emit("start",l,h,m);var y=p(h,d,m);return y.id=a(h,y),y.env.start(l),y.source.start(l),u.emit("started",l,y.id,y),m.duration&&y.stop(l+m.duration),y},u.play=function(h,l,f){return u.start(h,l,f)},u.stop=function(h,l){var f;return l=l||Object.keys(o),l.map(function(d){return f=o[d],f?(f.stop(h),f.id):null})},u.connect=function(h){return r=!0,s.connect(h),u},u.emit=function(h,l,f,d){u.onevent&&u.onevent(h,l,f,d);var m=u["on"+h];m&&m(l,f,d)},u;function a(h,l){return l.id=i++,o[l.id]=l,l.source.onended=function(){var f=t.currentTime;l.source.disconnect(),l.env.disconnect(),l.disconnect(),u.emit("ended",f,l.id,l)},l.id}function p(h,l,f){var d=t.createGain();return d.gain.value=0,d.connect(s),d.env=lo(t,f,c),d.env.connect(d.gain),d.source=t.createBufferSource(),d.source.buffer=l,d.source.connect(d),d.source.loop=f.loop||c.loop,d.source.playbackRate.value=fo(f.cents||c.cents),d.source.loopStart=f.loopStart||c.loopStart,d.source.loopEnd=f.loopEnd||c.loopEnd,d.stop=function(m){var y=m||t.currentTime;u.emit("stop",y,h);var I=d.env.stop(y);d.source.stop(I)},d}}function or(t){return typeof t=="number"}var uo=["attack","decay","sustain","release"];function lo(t,e,n){var r=so(t),i=e.adsr||n.adsr;return uo.forEach(function(o,s){i?r[o]=i[s]:r[o]=e[o]||n[o]}),r.value.value=or(e.gain)?e.gain:or(n.gain)?n.gain:1,r}function fo(t){return t?Math.pow(2,t/1200):1}var ho=co,po=function(t){return t.on=function(e,n){if(arguments.length===1&&typeof e=="function")return t.on("event",e);var r="on"+e,i=t[r];return t[r]=i?mo(i,n):n,t},t};function mo(t,e){return function(n,r,i,o){t(n,r,i,o),e(n,r,i,o)}}var zr=/^([a-gA-G])(#{1,}|b{1,}|x{1,}|)(-?\d*)\s*(.*)\s*$/;function yo(){return zr}var go=[0,2,4,5,7,9,11];function Jr(t,e,n){if(typeof t!="string")return null;var r=zr.exec(t);if(!r||!e&&r[4])return null;var i={letter:r[1].toUpperCase(),acc:r[2].replace(/x/g,"##")};return i.pc=i.letter+i.acc,i.step=(i.letter.charCodeAt(0)+3)%7,i.alt=i.acc[0]==="b"?-i.acc.length:i.acc.length,i.chroma=go[i.step]+i.alt,r[3]&&(i.oct=+r[3],i.midi=i.chroma+12*(i.oct+1),i.freq=Gr(i.midi,n)),e&&(i.tonicOf=r[4]),i}function Gr(t,e){return Math.pow(2,(t-69)/12)*(e||440)}var Wr={parse:Jr,regex:yo,midiToFreq:Gr},bo=["letter","acc","pc","step","alt","chroma","oct","midi","freq"];bo.forEach(function(t){Wr[t]=function(e){var n=Jr(e);return n&&typeof n[t]<"u"?n[t]:null}});var vo=Wr,_o=vo,ko=function(t){return t!==null&&t!==[]&&t>=0&&t<129},wo=function(t){return ko(t)?+t:_o.midi(t)},To=function(t){if(t.buffers){var e=t.opts.map,n=typeof e=="function"?e:wo,r=function(o){return o?n(o)||o:null};t.buffers=xo(t.buffers,r);var i=t.start;t.start=function(o,s,c){var u=r(o),a=u%1;return a&&(u=Math.floor(u),c=Object.assign(c||{},{cents:Math.floor(a*100)})),i(u,s,c)}}return t};function xo(t,e){return Object.keys(t).reduce(function(n,r){return n[e(r)]=t[r],n},{})}var So=Array.isArray,Io=function(t){return t&&typeof t=="object"},Co={},Oo=function(t){return t.schedule=function(e,n){var r=t.context.currentTime,i=e<r?r:e;t.emit("schedule",i,n);var o,s,c,u;return n.map(function(a){if(a)So(a)?(o=a[0],s=a[1]):(o=a.time,s=a);else return null;return Io(s)?(c=s.name||s.key||s.note||s.midi||null,u=s):(c=s,u=Co),t.start(c,i+(o||0),u)})},t};function gt(t){throw new Error('Could not dynamically require "'+t+'". Please configure the dynamicRequireTargets or/and ignoreDynamicRequires option of @rollup/plugin-commonjs appropriately for this require call to work.')}var Yr={exports:{}};(function(t,e){(function(n){t.exports=n()})(function(){return function n(r,i,o){function s(a,p){if(!i[a]){if(!r[a]){var h=typeof gt=="function"&&gt;if(!p&&h)return h(a,!0);if(c)return c(a,!0);var l=new Error("Cannot find module '"+a+"'");throw l.code="MODULE_NOT_FOUND",l}var f=i[a]={exports:{}};r[a][0].call(f.exports,function(d){var m=r[a][1][d];return s(m||d)},f,f.exports,n,r,i,o)}return i[a].exports}for(var c=typeof gt=="function"&&gt,u=0;u<o.length;u++)s(o[u]);return s}({1:[function(n,r,i){Object.defineProperty(i,"__esModule",{value:!0}),i.default=function(o){function s(c){if(this._event=c,this._data=c.data,this.receivedTime=c.receivedTime,this._data&&this._data.length<2){console.warn("Illegal MIDI message of length",this._data.length);return}switch(this._messageCode=c.data[0]&240,this.channel=c.data[0]&15,this._messageCode){case 128:this.messageType="noteoff",this.key=c.data[1]&127,this.velocity=c.data[2]&127;break;case 144:this.messageType="noteon",this.key=c.data[1]&127,this.velocity=c.data[2]&127;break;case 160:this.messageType="keypressure",this.key=c.data[1]&127,this.pressure=c.data[2]&127;break;case 176:this.messageType="controlchange",this.controllerNumber=c.data[1]&127,this.controllerValue=c.data[2]&127,this.controllerNumber===120&&this.controllerValue===0?this.channelModeMessage="allsoundoff":this.controllerNumber===121?this.channelModeMessage="resetallcontrollers":this.controllerNumber===122?this.controllerValue===0?this.channelModeMessage="localcontroloff":this.channelModeMessage="localcontrolon":this.controllerNumber===123&&this.controllerValue===0?this.channelModeMessage="allnotesoff":this.controllerNumber===124&&this.controllerValue===0?this.channelModeMessage="omnimodeoff":this.controllerNumber===125&&this.controllerValue===0?this.channelModeMessage="omnimodeon":this.controllerNumber===126?this.channelModeMessage="monomodeon":this.controllerNumber===127&&(this.channelModeMessage="polymodeon");break;case 192:this.messageType="programchange",this.program=c.data[1];break;case 208:this.messageType="channelpressure",this.pressure=c.data[1]&127;break;case 224:this.messageType="pitchbendchange";var u=c.data[2]&127,a=c.data[1]&127;this.pitchBend=(u<<8)+a;break}}return new s(o)},r.exports=i.default},{}]},{},[1])(1)})})(Yr);var No=Yr.exports,Eo=function(t){return t.listenToMidi=function(e,n){var r={},i=n||{},o=i.gain||function(s){return s/127};return e.onmidimessage=function(s){var c=s.messageType?s:No(s);if(c.messageType==="noteon"&&c.velocity===0&&(c.messageType="noteoff"),!(i.channel&&c.channel!==i.channel))switch(c.messageType){case"noteon":r[c.key]=t.play(c.key,0,{gain:o(c.velocity)});break;case"noteoff":r[c.key]&&(r[c.key].stop(),delete r[c.key]);break}},t},t};(function(t){var e=ho,n=po,r=To,i=Oo,o=Eo;function s(c,u,a){return o(i(r(n(e(c,u,a)))))}t.exports&&(t.exports=s),typeof window<"u"&&(window.SamplePlayer=s)})($r);function ar(t,e){return Array(e+1).join(t)}function kn(t){return typeof t=="number"}function Ao(t){return typeof t=="string"}function Bo(t){return typeof t<"u"}function Xr(t,e){return Math.pow(2,(t-69)/12)*(e||440)}var Qr=/^([a-gA-G])(#{1,}|b{1,}|x{1,}|)(-?\d*)\s*(.*)\s*$/;function Po(){return Qr}var Uo=[0,2,4,5,7,9,11];function Se(t,e,n){if(typeof t!="string")return null;var r=Qr.exec(t);if(!r||!e&&r[4])return null;var i={letter:r[1].toUpperCase(),acc:r[2].replace(/x/g,"##")};i.pc=i.letter+i.acc,i.step=(i.letter.charCodeAt(0)+3)%7,i.alt=i.acc[0]==="b"?-i.acc.length:i.acc.length;var o=Uo[i.step]+i.alt;return i.chroma=o<0?12+o:o%12,r[3]&&(i.oct=+r[3],i.midi=o+12*(i.oct+1),i.freq=Xr(i.midi,n)),e&&(i.tonicOf=r[4]),i}var Mo="CDEFGAB";function Fo(t){return kn(t)?t<0?ar("b",-t):ar("#",t):""}function Ro(t){return kn(t)?""+t:""}function Zr(t,e,n){return t===null||typeof t>"u"?null:t.step?Zr(t.step,t.alt,t.oct):t<0||t>6?null:Mo.charAt(t)+Fo(e)+Ro(n)}function ei(t){if((kn(t)||Ao(t))&&t>=0&&t<128)return+t;var e=Se(t);return e&&Bo(e.midi)?e.midi:null}function Do(t,e){var n=ei(t);return n===null?null:Xr(n,e)}function Lo(t){return(Se(t)||{}).letter}function qo(t){return(Se(t)||{}).acc}function Vo(t){return(Se(t)||{}).pc}function jo(t){return(Se(t)||{}).step}function Ko(t){return(Se(t)||{}).alt}function Ho(t){return(Se(t)||{}).chroma}function $o(t){return(Se(t)||{}).oct}const zo=Object.freeze(Object.defineProperty({__proto__:null,regex:Po,parse:Se,build:Zr,midi:ei,freq:Do,letter:Lo,acc:qo,pc:Vo,step:jo,alt:Ko,chroma:Ho,oct:$o},Symbol.toStringTag,{value:"Module"})),Jo=xr(zo);var Gt,cr;function Go(){if(cr)return Gt;cr=1;var t=Jo;function e(i,o){if(console.warn("new Soundfont() is deprected"),console.log("Please use Soundfont.instrument() instead of new Soundfont().instrument()"),!(this instanceof e))return new e(i);this.nameToUrl=o||e.nameToUrl,this.ctx=i,this.instruments={},this.promises=[]}e.prototype.onready=function(i){console.warn("deprecated API"),console.log("Please use Promise.all(Soundfont.instrument(), Soundfont.instrument()).then() instead of new Soundfont().onready()"),Promise.all(this.promises).then(i)},e.prototype.instrument=function(i,o){console.warn("new Soundfont().instrument() is deprecated."),console.log("Please use Soundfont.instrument() instead.");var s=this.ctx;if(i=i||"default",i in this.instruments)return this.instruments[i];var c={name:i,play:r(s,o)};if(this.instruments[i]=c,i!=="default"){var u=e.instrument(s,i,o).then(function(a){return c.play=a.play,c});this.promises.push(u),c.onready=function(a){console.warn("onready is deprecated. Use Soundfont.instrument().then()"),u.then(a)}}else c.onready=function(a){console.warn("onready is deprecated. Use Soundfont.instrument().then()"),a()};return c};function n(i,o,s){return console.warn("Soundfont.loadBuffers is deprecate."),console.log("Use Soundfont.instrument(..) and get buffers properties from the result."),e.instrument(i,o,s).then(function(c){return c.buffers})}e.loadBuffers=n;function r(i,o){return o=o||{},function(s,c,u,a){console.warn("The oscillator player is deprecated."),console.log("Starting with version 0.9.0 you will have to wait until the soundfont is loaded to play sounds.");var p=s>0&&s<129?+s:t.midi(s),h=p?t.midiToFreq(p,440):null;if(!!h){u=u||.2,a=a||{};var l=a.destination||o.destination||i.destination,f=a.vcoType||o.vcoType||"sine",d=a.gain||o.gain||.4,m=i.createOscillator();m.type=f,m.frequency.value=h;var y=i.createGain();return y.gain.value=d,m.connect(y),y.connect(l),m.start(c),u>0&&m.stop(c+u),m}}}return e.noteToMidi=t.midi,Gt=e,Gt}(function(t){var e=Hr.exports,n=$r.exports;function r(c,u,a){if(arguments.length===1)return function(d,m){return r(c,d,m)};var p=a||{},h=p.isSoundfontURL||i,l=p.nameToUrl||o,f=h(u)?u:l(u,p.soundfont,p.format);return e(c,f,{only:p.only||p.notes}).then(function(d){var m=n(c,d,p).connect(p.destination?p.destination:c.destination);return m.url=f,m.name=u,m})}function i(c){return/\.js(\?.*)?$/i.test(c)}function o(c,u,a){return a=a==="ogg"?a:"mp3",u=u==="FluidR3_GM"?u:"MusyngKite","https://gleitz.github.io/midi-js-soundfonts/"+u+"/"+c+"-"+a+".js"}var s=Go();s.instrument=r,s.nameToUrl=o,t.exports&&(t.exports=s),typeof window<"u"&&(window.Soundfont=s)})(Kr);const ti=window.AudioContext||window.webkitAudioContext;ti||alert("Your browser does not seem to support the Web Audio API!");const Wo=new ti,Wt={};function ni(t){return Wt[t]||(Wt[t]=Kr.exports.instrument(Wo,t)),Wt[t]}const Nt=ee(!1),Ze=ee(""),Et=ee("acoustic_grand_piano"),$e=ee(new Map),wn=ee(!1),xe=new Map,Lt={audioNodeMap:new Map,colorHue:"220"};xe.set("0",Lt);let E,Tn,xn;async function Sn(t,e){let n=await ni(t),r=xe.get(e);r&&(r.instrument=n)}function ur({socketID:t,colorHue:e,instrumentName:n}){xe.set(t,{audioNodeMap:t===E.id?Lt.audioNodeMap:new Map,colorHue:e}),$e.set(pe($e).set(t,e)),n&&Sn(n,t)}function Yt(){E.removeAllListeners(),E=null,Nt.set(!1),wn.set(!1),xe.clear(),xe.set("0",Lt)}function Yo(t,e){Tn=t,xn=e}function Xt(t){const e="https://calbabreaker-piano-backend.herokuapp.com";Ze.set(""),Nt.set(!0),E=Tt(e,{query:{roomName:t,instrumentName:pe(Et)},path:{VITE_BACKEND_HOST:"https://calbabreaker-piano-backend.herokuapp.com",BASE_URL:"./",MODE:"production",DEV:!1,PROD:!0}.VITE_BACKEND_PATH}),E.on("connect_error",()=>{Yt(),Ze.set("Failed to connect to server!")}),E.on("connect_timeout",()=>{Yt(),Ze.set("Timed out while connecting to server!")}),E.on("connect",()=>{Nt.set(!1),wn.set(!0),xe.delete("0"),pe($e).clear(),history.replaceState({},void 0,`?room=${t}`),document.title=`Room ${t} - Play Piano!`}),E.on("disconnect",()=>{Yt(),history.replaceState({},void 0,location.pathname),document.title="Play Piano!"}),E.on("play_note",n=>{Tn(n)}),E.on("stop_note",n=>{xn(n)}),E.on("instrument_change",n=>{const{instrumentName:r,socketID:i}=n;Sn(r,i)}),E.on("client_connect",n=>{ur(n)}),E.on("client_list_recieve",n=>{const r=n;for(let i of r)ur(i)}),E.on("client_disconnect",n=>{const r=pe($e);r.delete(n),$e.set(r),xe.delete(n)})}function Xo(t,e){var r;const n={note:t,volume:e};E&&E.emit("play_note",n),Tn({...n,socketID:(r=E==null?void 0:E.id)!=null?r:"0"})}function Qt(t,e){var r;const n={note:t,sustain:e};E&&E.emit("stop_note",n),xn({...n,socketID:(r=E==null?void 0:E.id)!=null?r:"0"})}Et.subscribe(t=>{var e;E&&E.emit("instrument_change",{instrumentName:t}),Sn(t,(e=E==null?void 0:E.id)!=null?e:"0")});function lr(t,e,n){const r=t.slice();return r[39]=e[n][0],r[40]=e[n][1],r}function fr(t,e,n){const r=t.slice();return r[43]=e[n],r}function hr(t){let e,n=t[43]+"",r;return{c(){e=k("option"),r=ce(n),e.__value=t[43],e.value=e.__value},m(i,o){L(i,e,o),g(e,r)},p:U,d(i){i&&D(e)}}}function Qo(t){return{c:U,m:U,d:U}}function Zo(t){return{c:U,m:U,d:U}}function ea(t){let e;return{c(){e=ce("loading...")},m(n,r){L(n,e,r)},d(n){n&&D(e)}}}function ta(t){let e,n,r;return{c(){e=k("button"),e.textContent="Play"},m(i,o){L(i,e,o),n||(r=C(e,"click",t[27]),n=!0)},p:U,d(i){i&&D(e),n=!1,r()}}}function na(t){let e,n,r;return{c(){e=k("button"),e.textContent="Pause"},m(i,o){L(i,e,o),n||(r=C(e,"click",t[26]),n=!0)},p:U,d(i){i&&D(e),n=!1,r()}}}function ra(t){let e,n,r,i;return{c(){e=k("button"),n=ce("Join"),e.disabled=t[14]},m(o,s){L(o,e,s),g(e,n),r||(i=C(e,"click",t[37]),r=!0)},p(o,s){s[0]&16384&&(e.disabled=o[14])},d(o){o&&D(e),r=!1,i()}}}function ia(t){let e;return{c(){e=k("span"),e.textContent=`${Ze}`,v(e,"class","error svelte-1ufj93m")},m(n,r){L(n,e,r)},p:U,d(n){n&&D(e)}}}function sa(t){let e,n,r,i,o,s,c,u,a,p,h=Array.from(t[12].entries()),l=[];for(let f=0;f<h.length;f+=1)l[f]=pr(lr(t,h,f));return{c(){e=k("button"),e.textContent="Leave",n=P(),r=k("span"),r.textContent="Connected!",i=k("br"),o=P(),s=k("span"),s.textContent="People:",c=P();for(let f=0;f<l.length;f+=1)l[f].c();u=wr()},m(f,d){L(f,e,d),L(f,n,d),L(f,r,d),L(f,i,d),L(f,o,d),L(f,s,d),L(f,c,d);for(let m=0;m<l.length;m+=1)l[m].m(f,d);L(f,u,d),a||(p=C(e,"click",t[36]),a=!0)},p(f,d){if(d[0]&4096){h=Array.from(f[12].entries());let m;for(m=0;m<h.length;m+=1){const y=lr(f,h,m);l[m]?l[m].p(y,d):(l[m]=pr(y),l[m].c(),l[m].m(u.parentNode,u))}for(;m<l.length;m+=1)l[m].d(1);l.length=h.length}},d(f){f&&D(e),f&&D(n),f&&D(r),f&&D(i),f&&D(o),f&&D(s),f&&D(c),pn(l,f),f&&D(u),a=!1,p()}}}function dr(t){let e;return{c(){e=k("span"),e.textContent="(you)",St(e,"margin-right","0.5rem")},m(n,r){L(n,e,r)},d(n){n&&D(e)}}}function pr(t){let e,n,r,i,o=t[39]===E.id&&dr();return{c(){e=k("div"),r=P(),o&&o.c(),i=wr(),v(e,"class","icon svelte-1ufj93m"),v(e,"style",n=`--color-hue: ${t[40]}`)},m(s,c){L(s,e,c),L(s,r,c),o&&o.m(s,c),L(s,i,c)},p(s,c){c[0]&4096&&n!==(n=`--color-hue: ${s[40]}`)&&v(e,"style",n),s[39]===E.id?o||(o=dr(),o.c(),o.m(i.parentNode,i)):o&&(o.d(1),o=null)},d(s){s&&D(e),s&&D(r),o&&o.d(s),s&&D(i)}}}function mr(t){let e;return{c(){e=k("span"),e.textContent="Connecting..."},m(n,r){L(n,e,r)},d(n){n&&D(e)}}}function oa(t){let e,n,r,i,o,s,c,u,a,p,h,l,f,d,m,y,I,q,F,w,N,V,T,_,A,B,te,b,S,M,z,ue,ge,be,ve,nt,le,Ie,Re,rt,Pe,it,_e,Je,De,x,R,In,ie,Cn,ke,On,Nn,En,W,An,st=t[8].toFixed(1)+"",qt,Bn,ot=t[10].toFixed(1)+"",Vt,Pn,Un,se,at,Mn,fe,Fn,jt,Kt,Rn,Le=Jn,Q=[];for(let K=0;K<Le.length;K+=1)Q[K]=hr(fr(t,Le,K));let oe={ctx:t,current:null,token:null,hasCatch:!1,pending:ea,then:Zo,catch:Qo};$n(B=t[2],oe);function Dn(K,j){return K[7]?na:ta}let ct=Dn(t),he=ct(t);function Ln(K,j){return K[11]?sa:K[13]?ia:ra}let ut=Ln(t),de=ut(t),ne=t[14]&&mr();return{c(){e=k("div"),n=k("div"),r=k("div"),i=k("div"),o=k("span"),o.textContent="Sustain:",s=P(),c=k("input"),u=P(),a=k("div"),p=k("span"),p.textContent="Octave Shift:",h=P(),l=k("input"),f=P(),d=k("div"),m=k("span"),m.textContent="Volume:",y=P(),I=k("input"),q=P(),F=k("input"),w=P(),N=k("div"),V=k("span"),V.textContent="Instrument:",T=P(),_=k("select");for(let K=0;K<Q.length;K+=1)Q[K].c();A=P(),oe.block.c(),te=P(),b=k("span"),b.textContent="Size:",S=P(),M=k("select"),z=k("option"),z.textContent="Full size (88 keys)",ue=k("option"),ue.textContent="Half size (61 keys)",ge=k("option"),ge.textContent="Quater Size (37 keys)",be=k("option"),be.textContent="2 Octaves (24 keys)",ve=k("option"),ve.textContent="1 Octave (12 keys)",nt=P(),le=k("div"),Ie=k("div"),Re=k("p"),Re.textContent="Play a midi:",rt=P(),Pe=k("input"),it=P(),_e=k("div"),he.c(),Je=P(),De=k("button"),De.textContent="Restart",x=P(),R=k("div"),In=ce("Speed:"),ie=k("input"),Cn=P(),ke=k("input"),On=ce("times"),Nn=k("br"),En=P(),W=k("input"),An=P(),qt=ce(st),Bn=ce("/"),Vt=ce(ot),Pn=ce(" seconds"),Un=P(),se=k("div"),at=k("p"),at.textContent="Join a room:",Mn=P(),fe=k("input"),Fn=P(),de.c(),jt=P(),ne&&ne.c(),v(c,"type","checkbox"),v(c,"class","svelte-1ufj93m"),v(i,"title","Shortcut: space"),v(i,"class","svelte-1ufj93m"),v(l,"type","number"),v(l,"min","-3"),v(l,"max","3"),v(l,"class","svelte-1ufj93m"),v(a,"title","Shortcut: left ctrl +, left alt or right ctrl -"),v(a,"class","svelte-1ufj93m"),v(I,"type","range"),v(I,"min","0"),v(I,"max","50"),v(I,"step","0.1"),v(I,"class","svelte-1ufj93m"),v(F,"type","number"),v(F,"class","svelte-1ufj93m"),v(d,"class","svelte-1ufj93m"),t[0]===void 0&&It(()=>t[23].call(_)),v(N,"class","svelte-1ufj93m"),v(z,"data-range","A0,C8"),z.__value="Full size (88 keys)",z.value=z.__value,v(ue,"data-range","C2,C7"),ue.selected=!0,ue.__value="Half size (61 keys)",ue.value=ue.__value,v(ge,"data-range","C3,C6"),ge.__value="Quater Size (37 keys)",ge.value=ge.__value,v(be,"data-range","C4,B5"),be.__value="2 Octaves (24 keys)",be.value=be.__value,v(ve,"data-range","C4,B4"),ve.__value="1 Octave (12 keys)",ve.value=ve.__value,v(r,"class","svelte-1ufj93m"),v(Re,"class","svelte-1ufj93m"),v(Pe,"type","file"),v(Pe,"class","svelte-1ufj93m"),v(Ie,"class","svelte-1ufj93m"),v(_e,"class","svelte-1ufj93m"),v(ie,"type","range"),v(ie,"min","0.01"),v(ie,"max","4"),v(ie,"step","0.01"),v(ie,"class","svelte-1ufj93m"),v(ke,"type","number"),v(ke,"min","0.01"),v(ke,"class","svelte-1ufj93m"),v(W,"type","range"),v(W,"min","0"),v(W,"max",t[10]),v(W,"step","0.1"),St(W,"width","18rem"),v(W,"class","svelte-1ufj93m"),v(R,"class","svelte-1ufj93m"),v(le,"class","svelte-1ufj93m"),v(n,"class","row svelte-1ufj93m"),v(at,"class","svelte-1ufj93m"),v(fe,"type","text"),v(fe,"placeholder","Room name"),v(fe,"class","svelte-1ufj93m"),v(e,"class","control-panel svelte-1ufj93m")},m(K,j){L(K,e,j),g(e,n),g(n,r),g(r,i),g(i,o),g(i,s),g(i,c),c.checked=t[3],g(r,u),g(r,a),g(a,p),g(a,h),g(a,l),Z(l,t[4]),g(r,f),g(r,d),g(d,m),g(d,y),g(d,I),Z(I,t[5]),g(d,q),g(d,F),Z(F,t[5]),g(r,w),g(r,N),g(N,V),g(N,T),g(N,_);for(let G=0;G<Q.length;G+=1)Q[G].m(_,null);Kn(_,t[0]),g(N,A),oe.block.m(N,oe.anchor=null),oe.mount=()=>N,oe.anchor=null,g(r,te),g(r,b),g(r,S),g(r,M),g(M,z),g(M,ue),g(M,ge),g(M,be),g(M,ve),g(n,nt),g(n,le),g(le,Ie),g(Ie,Re),g(Ie,rt),g(Ie,Pe),g(le,it),g(le,_e),he.m(_e,null),g(_e,Je),g(_e,De),g(le,x),g(le,R),g(R,In),g(R,ie),Z(ie,t[9]),g(R,Cn),g(R,ke),Z(ke,t[9]),g(R,On),g(R,Nn),g(R,En),g(R,W),Z(W,t[8]),g(R,An),g(R,qt),g(R,Bn),g(R,Vt),g(R,Pn),g(e,Un),g(e,se),g(se,at),g(se,Mn),g(se,fe),Z(fe,t[1]),g(se,Fn),de.m(se,null),g(se,jt),ne&&ne.m(se,null),Kt||(Rn=[C(window,"keydown",t[17]),C(window,"keyup",t[18]),C(window,"load",t[15]),C(c,"change",t[19]),C(l,"input",t[20]),C(I,"change",t[21]),C(I,"input",t[21]),C(F,"input",t[22]),C(_,"change",t[23]),C(M,"change",t[24]),si(t[16].call(null,M)),C(Pe,"change",t[25]),C(De,"click",t[28]),C(ie,"change",t[29]),C(ie,"input",t[29]),C(ke,"input",t[30]),C(W,"change",t[31]),C(W,"input",t[31]),C(W,"mousedown",t[32]),C(W,"mouseup",t[33]),C(fe,"input",t[34]),C(fe,"keydown",t[35])],Kt=!0)},p(K,j){if(t=K,j[0]&8&&(c.checked=t[3]),j[0]&16&&we(l.value)!==t[4]&&Z(l,t[4]),j[0]&32&&Z(I,t[5]),j[0]&32&&we(F.value)!==t[5]&&Z(F,t[5]),j&0){Le=Jn;let G;for(G=0;G<Le.length;G+=1){const qn=fr(t,Le,G);Q[G]?Q[G].p(qn,j):(Q[G]=hr(qn),Q[G].c(),Q[G].m(_,null))}for(;G<Q.length;G+=1)Q[G].d(1);Q.length=Le.length}j[0]&1&&Kn(_,t[0]),oe.ctx=t,j[0]&4&&B!==(B=t[2])&&$n(B,oe),ct===(ct=Dn(t))&&he?he.p(t,j):(he.d(1),he=ct(t),he&&(he.c(),he.m(_e,Je))),j[0]&512&&Z(ie,t[9]),j[0]&512&&we(ke.value)!==t[9]&&Z(ke,t[9]),j[0]&1024&&v(W,"max",t[10]),j[0]&256&&Z(W,t[8]),j[0]&256&&st!==(st=t[8].toFixed(1)+"")&&jn(qt,st),j[0]&1024&&ot!==(ot=t[10].toFixed(1)+"")&&jn(Vt,ot),j[0]&2&&fe.value!==t[1]&&Z(fe,t[1]),ut===(ut=Ln(t))&&de?de.p(t,j):(de.d(1),de=ut(t),de&&(de.c(),de.m(se,jt))),t[14]?ne||(ne=mr(),ne.c(),ne.m(se,null)):ne&&(ne.d(1),ne=null)},i:U,o:U,d(K){K&&D(e),pn(Q,K),oe.block.d(),oe.token=null,oe=null,he.d(),de.d(),ne&&ne.d(),Kt=!1,Be(Rn)}}}const Oe=ee(0),He=ee(!1),xt=ee(25),dn=ee(["C0","C0"]);function aa(t,e,n){let r,i,o=U,s,c=U,u,a=U,p,h,l=U,f,d,m,y,I,q,F,w,N;J(t,He,x=>n(3,i=x)),J(t,Oe,x=>n(4,s=x)),J(t,dn,x=>n(38,u=x)),J(t,Et,x=>n(0,p=x)),J(t,xt,x=>n(5,h=x)),J(t,an,x=>n(6,f=x)),J(t,re,x=>n(7,d=x)),J(t,Me,x=>n(8,m=x)),J(t,Qe,x=>n(9,y=x)),J(t,_t,x=>n(10,I=x)),J(t,wn,x=>n(11,q=x)),J(t,$e,x=>n(12,F=x)),J(t,Ze,x=>n(13,w=x)),J(t,Nt,x=>n(14,N=x)),t.$$.on_destroy.push(()=>o()),t.$$.on_destroy.push(()=>c()),t.$$.on_destroy.push(()=>a()),t.$$.on_destroy.push(()=>l());let V="";function T(){const R=new URLSearchParams(location.search).get("room");R!=null&&(n(1,V=R),Xt(V))}function _(x){const R=x.children[x.selectedIndex];Y(dn,u=R.dataset.range.split(","),u)}function A(x){x.code==="Space"&&Y(He,i=!0,i),x.code==="ControlLeft"?Y(Oe,s-=1,s):(x.code==="AltLeft"||x.code=="ControlRight")&&Y(Oe,s+=1,s),s<-3?Y(Oe,s=3,s):s>3&&Y(Oe,s=-3,s)}function B(x){x.code==="Space"&&Y(He,i=!1,i)}function te(){i=this.checked,He.set(i)}function b(){s=we(this.value),Oe.set(s)}function S(){h=we(this.value),xt.set(h)}function M(){h=we(this.value),xt.set(h)}function z(){p=ci(this),Et.set(p)}const ue=x=>_(x.currentTarget),ge=x=>{var R;return Y(an,f=(R=x.currentTarget.files)==null?void 0:R[0],f)},be=()=>Y(re,d=!1,d),ve=()=>Y(re,d=!0,d),nt=()=>{Y(re,d=!1,d),Y(Me,m=0,m),setTimeout(()=>Y(re,d=!0,d),100)};function le(){y=we(this.value),Qe.set(y)}function Ie(){y=we(this.value),Qe.set(y)}function Re(){m=we(this.value),Me.set(m)}const rt=()=>Y(re,d=!1,d),Pe=()=>Y(re,d=!0,d);function it(){V=this.value,n(1,V)}const _e=x=>{x.code==="Enter"&&Xt(V)},Je=()=>E.disconnect(),De=()=>Xt(V);return t.$$.update=()=>{t.$$.dirty[0]&1&&n(2,r=ni(p))},[p,V,r,i,s,h,f,d,m,y,I,q,F,w,N,T,_,A,B,te,b,S,M,z,ue,ge,be,ve,nt,le,Ie,Re,rt,Pe,it,_e,Je,De]}class ca extends gn{constructor(e){super(),yn(this,e,aa,oa,At,{},null,[-1,-1])}}function yr(t,e,n){const r=t.slice();return r[25]=e[n][0],r[26]=e[n][1].isWhite,r[27]=e[n][1].pressedColor,r[28]=e[n][1].isGhost,r}function gr(t){let e,n,r,i;function o(...a){return t[13](t[25],...a)}function s(){return t[14](t[25])}function c(){return t[15](t[25])}function u(){return t[16](t[25])}return{c(){e=k("div"),v(e,"class",n="key "+(t[26]?"white":"black")+" svelte-yqi7mq"),St(e,"--color-hue",t[27]),lt(e,"pressed",t[27]!==null),lt(e,"ghost",t[28]&&t[27]===null)},m(a,p){L(a,e,p),r||(i=[C(e,"pointerdown",o),C(e,"pointerenter",s),C(e,"pointerleave",c),C(e,"pointerup",u)],r=!0)},p(a,p){t=a,p&2&&n!==(n="key "+(t[26]?"white":"black")+" svelte-yqi7mq")&&v(e,"class",n),p&2&&St(e,"--color-hue",t[27]),p&2&&lt(e,"pressed",t[27]!==null),p&2&&lt(e,"ghost",t[28]&&t[27]===null)},d(a){a&&D(e),r=!1,Be(i)}}}function ua(t){let e,n,r,i,o=Object.entries(t[1]),s=[];for(let c=0;c<o.length;c+=1)s[c]=gr(yr(t,o,c));return{c(){e=k("div"),n=k("div");for(let c=0;c<s.length;c+=1)s[c].c();v(n,"class","piano svelte-yqi7mq"),v(e,"class","piano-container svelte-yqi7mq")},m(c,u){L(c,e,u),g(e,n);for(let a=0;a<s.length;a+=1)s[a].m(n,null);t[17](e),r||(i=[C(window,"resize",t[10]),C(window,"keyup",t[7]),C(window,"keydown",t[6]),C(window,"pointerdown",t[11]),C(window,"pointerup",t[12]),C(n,"touchstart",oi(t[9]))],r=!0)},p(c,[u]){if(u&27){o=Object.entries(c[1]);let a;for(a=0;a<o.length;a+=1){const p=yr(c,o,a);s[a]?s[a].p(p,u):(s[a]=gr(p),s[a].c(),s[a].m(n,null))}for(;a<s.length;a+=1)s[a].d(1);s.length=o.length}},i:U,o:U,d(c){c&&D(e),pn(s,c),t[17](null),r=!1,Be(i)}}}function br(t,e){e.get(t)&&(e.get(t).stop(),e.delete(t))}function la(t,e,n){let r,i,o;J(t,He,b=>n(18,r=b)),J(t,xt,b=>n(19,i=b)),J(t,Oe,b=>n(20,o=b));let s=!1,c,u,a,p=new Map;dn.subscribe(b=>{const S=is(b[0],b[1]);n(1,c=S.noteMap),n(8,u=S.whiteKeys)}),Yo(d,m);function h(b){const S=sn(b)+o;return on(b)+S}function l(b,S){const M=h(b);p.get(M)||(c[b]&&n(1,c[b].isGhost=!0,c),p.set(M,!0),Xo(M,i*S))}function f(b){const S=h(b);c[b]&&n(1,c[b].isGhost=!1,c),p.get(S)&&(p.delete(S),Qt(S,r))}function d({socketID:b,note:S,volume:M}){const z=xe.get(b);c[S]&&n(1,c[S].pressedColor=z.colorHue,c),z.instrument&&(br(S,z.audioNodeMap),z.audioNodeMap.set(S,z.instrument.play(S,void 0,{gain:M})))}function m({socketID:b,note:S,sustain:M}){const z=xe.get(b);c[S]&&n(1,c[S].pressedColor=null,c),M||br(S,z.audioNodeMap)}ss(l,f),He.subscribe(b=>{if(!b)for(const S of Lt.audioNodeMap.keys())p.get(S)||Qt(S,!1)}),Oe.subscribe(()=>{for(const b of p.keys())Qt(b,r)});function y(b=u){if(!a)return;const S=a.clientHeight/6,M=a.offsetWidth/b;a.style.setProperty("--white-key-width",`${Math.min(M,S)}px`)}ui(()=>{y()});function I(b){const S=Yn[b.code],M=b.target;S&&M.tagName!=="INPUT"&&(b.preventDefault(),l(S,.5))}function q(b){const S=Yn[b.code];S&&f(S)}function F(b){li.call(this,t,b)}const w=()=>y(),N=()=>n(0,s=!0),V=()=>n(0,s=!1),T=(b,S)=>{S.currentTarget.releasePointerCapture(S.pointerId),l(b,.5)},_=b=>{s&&l(b,.5)},A=b=>f(b),B=b=>f(b);function te(b){Zt[b?"unshift":"push"](()=>{a=b,n(2,a)})}return t.$$.update=()=>{t.$$.dirty&256&&y(u)},[s,c,a,l,f,y,I,q,u,F,w,N,V,T,_,A,B,te]}class fa extends gn{constructor(e){super(),yn(this,e,la,ua,At,{})}}function ha(t){let e,n,r,i,o;return n=new ca({}),i=new fa({}),{c(){e=k("main"),zn(n.$$.fragment),r=P(),zn(i.$$.fragment),v(e,"class","svelte-ieeeet")},m(s,c){L(s,e,c),nn(n,e,null),g(e,r),nn(i,e,null),o=!0},p:U,i(s){o||(Ct(n.$$.fragment,s),Ct(i.$$.fragment,s),o=!0)},o(s){tn(n.$$.fragment,s),tn(i.$$.fragment,s),o=!1},d(s){s&&D(e),rn(n),rn(i)}}}class da extends gn{constructor(e){super(),yn(this,e,null,ha,At,{})}}new da({target:document.body});

var wr=Object.defineProperty;var Tr=(t,e,n)=>e in t?wr(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n;var B=(t,e,n)=>(Tr(t,typeof e!="symbol"?e+"":e,n),n);(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))r(i);new MutationObserver(i=>{for(const o of i)if(o.type==="childList")for(const s of o.addedNodes)s.tagName==="LINK"&&s.rel==="modulepreload"&&r(s)}).observe(document,{childList:!0,subtree:!0});function n(i){const o={};return i.integrity&&(o.integrity=i.integrity),i.referrerPolicy&&(o.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?o.credentials="include":i.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function r(i){if(i.ep)return;i.ep=!0;const o=n(i);fetch(i.href,o)}})();function J(){}function Cr(t){return!!t&&(typeof t=="object"||typeof t=="function")&&typeof t.then=="function"}function Fn(t){return t()}function nn(){return Object.create(null)}function be(t){t.forEach(Fn)}function Jt(t){return typeof t=="function"}function Ue(t,e){return t!=t?e==e:t!==e||t&&typeof t=="object"||typeof t=="function"}let it;function Dn(t,e){return t===e?!0:(it||(it=document.createElement("a")),it.href=e,t===it.href)}function Sr(t){return Object.keys(t).length===0}function Ln(t,...e){if(t==null){for(const r of e)r(void 0);return J}const n=t.subscribe(...e);return n.unsubscribe?()=>n.unsubscribe():n}function Q(t){let e;return Ln(t,n=>e=n)(),e}function $(t,e,n){t.$$.on_destroy.push(Ln(e,n))}function oe(t,e,n){return t.set(n),e}function Ir(t){return t&&Jt(t.destroy)?t.destroy:J}function g(t,e){t.appendChild(e)}function R(t,e,n){t.insertBefore(e,n||null)}function M(t){t.parentNode&&t.parentNode.removeChild(t)}function et(t,e){for(let n=0;n<t.length;n+=1)t[n]&&t[n].d(e)}function v(t){return document.createElement(t)}function ae(t){return document.createTextNode(t)}function x(){return ae(" ")}function qn(){return ae("")}function O(t,e,n,r){return t.addEventListener(e,n,r),()=>t.removeEventListener(e,n,r)}function Pr(t){return function(e){return e.preventDefault(),t.call(this,e)}}function _(t,e,n){n==null?t.removeAttribute(e):t.getAttribute(e)!==n&&t.setAttribute(e,n)}function ge(t){return t===""?null:+t}function Nr(t){return Array.from(t.childNodes)}function tt(t,e){e=""+e,t.data!==e&&(t.data=e)}function z(t,e){t.value=e??""}function Oe(t,e,n,r){n==null?t.style.removeProperty(e):t.style.setProperty(e,n,r?"important":"")}function Pe(t,e,n){for(let r=0;r<t.options.length;r+=1){const i=t.options[r];if(i.__value===e){i.selected=!0;return}}(!n||e!==void 0)&&(t.selectedIndex=-1)}function gt(t){const e=t.querySelector(":checked");return e&&e.__value}function rn(t,e,n){t.classList.toggle(e,!!n)}let nt;function we(t){nt=t}function Vn(){if(!nt)throw new Error("Function called outside component initialization");return nt}function Hn(t){Vn().$$.on_mount.push(t)}function Er(t,e){const n=t.$$.callbacks[e.type];n&&n.slice().forEach(r=>r.call(this,e))}const Le=[],Mt=[];let je=[];const sn=[],Or=Promise.resolve();let Rt=!1;function Ar(){Rt||(Rt=!0,Or.then(zt))}function xe(t){je.push(t)}const Nt=new Set;let Me=0;function zt(){if(Me!==0)return;const t=nt;do{try{for(;Me<Le.length;){const e=Le[Me];Me++,we(e),xr(e.$$)}}catch(e){throw Le.length=0,Me=0,e}for(we(null),Le.length=0,Me=0;Mt.length;)Mt.pop()();for(let e=0;e<je.length;e+=1){const n=je[e];Nt.has(n)||(Nt.add(n),n())}je.length=0}while(Le.length);for(;sn.length;)sn.pop()();Rt=!1,Nt.clear(),we(t)}function xr(t){if(t.fragment!==null){t.update(),be(t.before_update);const e=t.dirty;t.dirty=[-1],t.fragment&&t.fragment.p(t.ctx,e),t.after_update.forEach(xe)}}function Br(t){const e=[],n=[];je.forEach(r=>t.indexOf(r)===-1?e.push(r):n.push(r)),n.forEach(r=>r()),je=e}const dt=new Set;let Ee;function Ur(){Ee={r:0,c:[],p:Ee}}function Mr(){Ee.r||be(Ee.c),Ee=Ee.p}function Ae(t,e){t&&t.i&&(dt.delete(t),t.i(e))}function Ke(t,e,n,r){if(t&&t.o){if(dt.has(t))return;dt.add(t),Ee.c.push(()=>{dt.delete(t),r&&(n&&t.d(1),r())}),t.o(e)}else r&&r()}function on(t,e){const n=e.token={};function r(i,o,s,a){if(e.token!==n)return;e.resolved=a;let l=e.ctx;s!==void 0&&(l=l.slice(),l[s]=a);const c=i&&(e.current=i)(l);let m=!1;e.block&&(e.blocks?e.blocks.forEach((d,u)=>{u!==o&&d&&(Ur(),Ke(d,1,1,()=>{e.blocks[u]===d&&(e.blocks[u]=null)}),Mr())}):e.block.d(1),c.c(),Ae(c,1),c.m(e.mount(),e.anchor),m=!0),e.block=c,e.blocks&&(e.blocks[o]=c),m&&zt()}if(Cr(t)){const i=Vn();if(t.then(o=>{we(i),r(e.then,1,e.value,o),we(null)},o=>{if(we(i),r(e.catch,2,e.error,o),we(null),!e.hasCatch)throw o}),e.current!==e.pending)return r(e.pending,0),!0}else{if(e.current!==e.then)return r(e.then,1,e.value,t),!0;e.resolved=t}}function Te(t){return(t==null?void 0:t.length)!==void 0?t:Array.from(t)}function Ze(t){t&&t.c()}function Je(t,e,n){const{fragment:r,after_update:i}=t.$$;r&&r.m(e,n),xe(()=>{const o=t.$$.on_mount.map(Fn).filter(Jt);t.$$.on_destroy?t.$$.on_destroy.push(...o):be(o),t.$$.on_mount=[]}),i.forEach(xe)}function ze(t,e){const n=t.$$;n.fragment!==null&&(Br(n.after_update),be(n.on_destroy),n.fragment&&n.fragment.d(e),n.on_destroy=n.fragment=null,n.ctx=[])}function Rr(t,e){t.$$.dirty[0]===-1&&(Le.push(t),Ar(),t.$$.dirty.fill(0)),t.$$.dirty[e/31|0]|=1<<e%31}function We(t,e,n,r,i,o,s=null,a=[-1]){const l=nt;we(t);const c=t.$$={fragment:null,ctx:[],props:o,update:J,not_equal:i,bound:nn(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(e.context||(l?l.$$.context:[])),callbacks:nn(),dirty:a,skip_bound:!1,root:e.target||l.$$.root};s&&s(c.root);let m=!1;if(c.ctx=n?n(t,e.props||{},(d,u,...h)=>{const f=h.length?h[0]:u;return c.ctx&&i(c.ctx[d],c.ctx[d]=f)&&(!c.skip_bound&&c.bound[d]&&c.bound[d](f),m&&Rr(t,d)),u}):[],c.update(),m=!0,be(c.before_update),c.fragment=r?r(c.ctx):!1,e.target){if(e.hydrate){const d=Nr(e.target);c.fragment&&c.fragment.l(d),d.forEach(M)}else c.fragment&&c.fragment.c();e.intro&&Ae(t.$$.fragment),Je(t,e.target,e.anchor),zt()}we(l)}class Ge{constructor(){B(this,"$$");B(this,"$$set")}$destroy(){ze(this,1),this.$destroy=J}$on(e,n){if(!Jt(n))return J;const r=this.$$.callbacks[e]||(this.$$.callbacks[e]=[]);return r.push(n),()=>{const i=r.indexOf(n);i!==-1&&r.splice(i,1)}}$set(e){this.$$set&&!Sr(e)&&(this.$$.skip_bound=!0,this.$$set(e),this.$$.skip_bound=!1)}}const Fr="4";typeof window<"u"&&(window.__svelte||(window.__svelte={v:new Set})).v.add(Fr);var Ve=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function jn(t){if(t.__esModule)return t;var e=t.default;if(typeof e=="function"){var n=function r(){return this instanceof r?Reflect.construct(e,arguments,this.constructor):e.apply(this,arguments)};n.prototype=e.prototype}else n={};return Object.defineProperty(n,"__esModule",{value:!0}),Object.keys(t).forEach(function(r){var i=Object.getOwnPropertyDescriptor(t,r);Object.defineProperty(n,r,i.get?i:{enumerable:!0,get:function(){return t[r]}})}),n}var Ft={},kt={};function Dr(t){var e=new he(t),n=e.readChunk();if(n.id!="MThd")throw"Bad MIDI file.  Expected 'MHdr', got: '"+n.id+"'";for(var r=Lr(n.data),i=[],o=0;!e.eof()&&o<r.numTracks;o++){var s=e.readChunk();if(s.id!="MTrk")throw"Bad MIDI file.  Expected 'MTrk', got: '"+s.id+"'";var a=qr(s.data);i.push(a)}return{header:r,tracks:i}}function Lr(t){var e=new he(t),n=e.readUInt16(),r=e.readUInt16(),i={format:n,numTracks:r},o=e.readUInt16();return o&32768?(i.framesPerSecond=256-(o>>8),i.ticksPerFrame=o&255):i.ticksPerBeat=o,i}function qr(t){for(var e=new he(t),n=[];!e.eof();){var r=o();n.push(r)}return n;var i;function o(){var s={};s.deltaTime=e.readVarInt();var a=e.readUInt8();if((a&240)===240)if(a===255){s.meta=!0;var l=e.readUInt8(),c=e.readVarInt();switch(l){case 0:if(s.type="sequenceNumber",c!==2)throw"Expected length for sequenceNumber event is 2, got "+c;return s.number=e.readUInt16(),s;case 1:return s.type="text",s.text=e.readString(c),s;case 2:return s.type="copyrightNotice",s.text=e.readString(c),s;case 3:return s.type="trackName",s.text=e.readString(c),s;case 4:return s.type="instrumentName",s.text=e.readString(c),s;case 5:return s.type="lyrics",s.text=e.readString(c),s;case 6:return s.type="marker",s.text=e.readString(c),s;case 7:return s.type="cuePoint",s.text=e.readString(c),s;case 32:if(s.type="channelPrefix",c!=1)throw"Expected length for channelPrefix event is 1, got "+c;return s.channel=e.readUInt8(),s;case 33:if(s.type="portPrefix",c!=1)throw"Expected length for portPrefix event is 1, got "+c;return s.port=e.readUInt8(),s;case 47:if(s.type="endOfTrack",c!=0)throw"Expected length for endOfTrack event is 0, got "+c;return s;case 81:if(s.type="setTempo",c!=3)throw"Expected length for setTempo event is 3, got "+c;return s.microsecondsPerBeat=e.readUInt24(),s;case 84:if(s.type="smpteOffset",c!=5)throw"Expected length for smpteOffset event is 5, got "+c;var m=e.readUInt8(),d={0:24,32:25,64:29,96:30};return s.frameRate=d[m&96],s.hour=m&31,s.min=e.readUInt8(),s.sec=e.readUInt8(),s.frame=e.readUInt8(),s.subFrame=e.readUInt8(),s;case 88:if(s.type="timeSignature",c!=2&&c!=4)throw"Expected length for timeSignature event is 4 or 2, got "+c;return s.numerator=e.readUInt8(),s.denominator=1<<e.readUInt8(),c===4?(s.metronome=e.readUInt8(),s.thirtyseconds=e.readUInt8()):(s.metronome=36,s.thirtyseconds=8),s;case 89:if(s.type="keySignature",c!=2)throw"Expected length for keySignature event is 2, got "+c;return s.key=e.readInt8(),s.scale=e.readUInt8(),s;case 127:return s.type="sequencerSpecific",s.data=e.readBytes(c),s;default:return s.type="unknownMeta",s.data=e.readBytes(c),s.metatypeByte=l,s}}else if(a==240){s.type="sysEx";var c=e.readVarInt();return s.data=e.readBytes(c),s}else if(a==247){s.type="endSysEx";var c=e.readVarInt();return s.data=e.readBytes(c),s}else throw"Unrecognised MIDI event type byte: "+a;else{var u;if(a&128)u=e.readUInt8(),i=a;else{if(i===null)throw"Running status byte encountered before status byte";u=a,a=i,s.running=!0}var h=a>>4;switch(s.channel=a&15,h){case 8:return s.type="noteOff",s.noteNumber=u,s.velocity=e.readUInt8(),s;case 9:var f=e.readUInt8();return s.type=f===0?"noteOff":"noteOn",s.noteNumber=u,s.velocity=f,f===0&&(s.byte9=!0),s;case 10:return s.type="noteAftertouch",s.noteNumber=u,s.amount=e.readUInt8(),s;case 11:return s.type="controller",s.controllerType=u,s.value=e.readUInt8(),s;case 12:return s.type="programChange",s.programNumber=u,s;case 13:return s.type="channelAftertouch",s.amount=u,s;case 14:return s.type="pitchBend",s.value=u+(e.readUInt8()<<7)-8192,s;default:throw"Unrecognised MIDI event type: "+h}}}}function he(t){this.buffer=t,this.bufferLen=this.buffer.length,this.pos=0}he.prototype.eof=function(){return this.pos>=this.bufferLen};he.prototype.readUInt8=function(){var t=this.buffer[this.pos];return this.pos+=1,t};he.prototype.readInt8=function(){var t=this.readUInt8();return t&128?t-256:t};he.prototype.readUInt16=function(){var t=this.readUInt8(),e=this.readUInt8();return(t<<8)+e};he.prototype.readInt16=function(){var t=this.readUInt16();return t&32768?t-65536:t};he.prototype.readUInt24=function(){var t=this.readUInt8(),e=this.readUInt8(),n=this.readUInt8();return(t<<16)+(e<<8)+n};he.prototype.readInt24=function(){var t=this.readUInt24();return t&8388608?t-16777216:t};he.prototype.readUInt32=function(){var t=this.readUInt8(),e=this.readUInt8(),n=this.readUInt8(),r=this.readUInt8();return(t<<24)+(e<<16)+(n<<8)+r};he.prototype.readBytes=function(t){var e=this.buffer.slice(this.pos,this.pos+t);return this.pos+=t,e};he.prototype.readString=function(t){var e=this.readBytes(t);return String.fromCharCode.apply(null,e)};he.prototype.readVarInt=function(){for(var t=0;!this.eof();){var e=this.readUInt8();if(e&128)t+=e&127,t<<=7;else return t+e}return t};he.prototype.readChunk=function(){var t=this.readString(4),e=this.readUInt32(),n=this.readBytes(e);return{id:t,length:e,data:n}};var Vr=Dr;function Hr(t,e){if(typeof t!="object")throw"Invalid MIDI data";e=e||{};var n=t.header||{},r=t.tracks||[],i,o=r.length,s=new re;for(jr(s,n,o),i=0;i<o;i++)Kr(s,r[i],e);return s.buffer}function jr(t,e,n){var r=e.format==null?1:e.format,i=128;e.timeDivision?i=e.timeDivision:e.ticksPerFrame&&e.framesPerSecond?i=-(e.framesPerSecond&255)<<8|e.ticksPerFrame&255:e.ticksPerBeat&&(i=e.ticksPerBeat&32767);var o=new re;o.writeUInt16(r),o.writeUInt16(n),o.writeUInt16(i),t.writeChunk("MThd",o.buffer)}function Kr(t,e,n){var r=new re,i,o=e.length,s=null;for(i=0;i<o;i++)(n.running===!1||!n.running&&!e[i].running)&&(s=null),s=Jr(r,e[i],s,n.useByte9ForNoteOff);t.writeChunk("MTrk",r.buffer)}function Jr(t,e,n,r){var i=e.type,o=e.deltaTime,s=e.text||"",a=e.data||[],l=null;switch(t.writeVarInt(o),i){case"sequenceNumber":t.writeUInt8(255),t.writeUInt8(0),t.writeVarInt(2),t.writeUInt16(e.number);break;case"text":t.writeUInt8(255),t.writeUInt8(1),t.writeVarInt(s.length),t.writeString(s);break;case"copyrightNotice":t.writeUInt8(255),t.writeUInt8(2),t.writeVarInt(s.length),t.writeString(s);break;case"trackName":t.writeUInt8(255),t.writeUInt8(3),t.writeVarInt(s.length),t.writeString(s);break;case"instrumentName":t.writeUInt8(255),t.writeUInt8(4),t.writeVarInt(s.length),t.writeString(s);break;case"lyrics":t.writeUInt8(255),t.writeUInt8(5),t.writeVarInt(s.length),t.writeString(s);break;case"marker":t.writeUInt8(255),t.writeUInt8(6),t.writeVarInt(s.length),t.writeString(s);break;case"cuePoint":t.writeUInt8(255),t.writeUInt8(7),t.writeVarInt(s.length),t.writeString(s);break;case"channelPrefix":t.writeUInt8(255),t.writeUInt8(32),t.writeVarInt(1),t.writeUInt8(e.channel);break;case"portPrefix":t.writeUInt8(255),t.writeUInt8(33),t.writeVarInt(1),t.writeUInt8(e.port);break;case"endOfTrack":t.writeUInt8(255),t.writeUInt8(47),t.writeVarInt(0);break;case"setTempo":t.writeUInt8(255),t.writeUInt8(81),t.writeVarInt(3),t.writeUInt24(e.microsecondsPerBeat);break;case"smpteOffset":t.writeUInt8(255),t.writeUInt8(84),t.writeVarInt(5);var c={24:0,25:32,29:64,30:96},m=e.hour&31|c[e.frameRate];t.writeUInt8(m),t.writeUInt8(e.min),t.writeUInt8(e.sec),t.writeUInt8(e.frame),t.writeUInt8(e.subFrame);break;case"timeSignature":t.writeUInt8(255),t.writeUInt8(88),t.writeVarInt(4),t.writeUInt8(e.numerator);var d=Math.floor(Math.log(e.denominator)/Math.LN2)&255;t.writeUInt8(d),t.writeUInt8(e.metronome),t.writeUInt8(e.thirtyseconds||8);break;case"keySignature":t.writeUInt8(255),t.writeUInt8(89),t.writeVarInt(2),t.writeInt8(e.key),t.writeUInt8(e.scale);break;case"sequencerSpecific":t.writeUInt8(255),t.writeUInt8(127),t.writeVarInt(a.length),t.writeBytes(a);break;case"unknownMeta":e.metatypeByte!=null&&(t.writeUInt8(255),t.writeUInt8(e.metatypeByte),t.writeVarInt(a.length),t.writeBytes(a));break;case"sysEx":t.writeUInt8(240),t.writeVarInt(a.length),t.writeBytes(a);break;case"endSysEx":t.writeUInt8(247),t.writeVarInt(a.length),t.writeBytes(a);break;case"noteOff":var u=r!==!1&&e.byte9||r&&e.velocity==0?144:128;l=u|e.channel,l!==n&&t.writeUInt8(l),t.writeUInt8(e.noteNumber),t.writeUInt8(e.velocity);break;case"noteOn":l=144|e.channel,l!==n&&t.writeUInt8(l),t.writeUInt8(e.noteNumber),t.writeUInt8(e.velocity);break;case"noteAftertouch":l=160|e.channel,l!==n&&t.writeUInt8(l),t.writeUInt8(e.noteNumber),t.writeUInt8(e.amount);break;case"controller":l=176|e.channel,l!==n&&t.writeUInt8(l),t.writeUInt8(e.controllerType),t.writeUInt8(e.value);break;case"programChange":l=192|e.channel,l!==n&&t.writeUInt8(l),t.writeUInt8(e.programNumber);break;case"channelAftertouch":l=208|e.channel,l!==n&&t.writeUInt8(l),t.writeUInt8(e.amount);break;case"pitchBend":l=224|e.channel,l!==n&&t.writeUInt8(l);var h=8192+e.value,f=h&127,p=h>>7&127;t.writeUInt8(f),t.writeUInt8(p);break;default:throw"Unrecognized event type: "+i}return l}function re(){this.buffer=[]}re.prototype.writeUInt8=function(t){this.buffer.push(t&255)};re.prototype.writeInt8=re.prototype.writeUInt8;re.prototype.writeUInt16=function(t){var e=t>>8&255,n=t&255;this.writeUInt8(e),this.writeUInt8(n)};re.prototype.writeInt16=re.prototype.writeUInt16;re.prototype.writeUInt24=function(t){var e=t>>16&255,n=t>>8&255,r=t&255;this.writeUInt8(e),this.writeUInt8(n),this.writeUInt8(r)};re.prototype.writeInt24=re.prototype.writeUInt24;re.prototype.writeUInt32=function(t){var e=t>>24&255,n=t>>16&255,r=t>>8&255,i=t&255;this.writeUInt8(e),this.writeUInt8(n),this.writeUInt8(r),this.writeUInt8(i)};re.prototype.writeInt32=re.prototype.writeUInt32;re.prototype.writeBytes=function(t){this.buffer=this.buffer.concat(Array.prototype.slice.call(t,0))};re.prototype.writeString=function(t){var e,n=t.length,r=[];for(e=0;e<n;e++)r.push(t.codePointAt(e));this.writeBytes(r)};re.prototype.writeVarInt=function(t){if(t<0)throw"Cannot write negative variable-length integer";if(t<=127)this.writeUInt8(t);else{var e=t,n=[];for(n.push(e&127),e>>=7;e;){var r=e&127|128;n.push(r),e>>=7}this.writeBytes(n.reverse())}};re.prototype.writeChunk=function(t,e){this.writeString(t),this.writeUInt32(e.length),this.writeBytes(e)};var zr=Hr;kt.parseMidi=Vr;kt.writeMidi=zr;var bt={},Be={};Object.defineProperty(Be,"__esModule",{value:!0});Be.insert=Be.search=void 0;function Kn(t,e,n){n===void 0&&(n="ticks");var r=0,i=t.length,o=i;if(i>0&&t[i-1][n]<=e)return i-1;for(;r<o;){var s=Math.floor(r+(o-r)/2),a=t[s],l=t[s+1];if(a[n]===e){for(var c=s;c<t.length;c++){var m=t[c];m[n]===e&&(s=c)}return s}else{if(a[n]<e&&l[n]>e)return s;a[n]>e?o=s:a[n]<e&&(r=s+1)}}return-1}Be.search=Kn;function Wr(t,e,n){if(n===void 0&&(n="ticks"),t.length){var r=Kn(t,e[n],n);t.splice(r+1,0,e)}else t.push(e)}Be.insert=Wr;(function(t){Object.defineProperty(t,"__esModule",{value:!0}),t.Header=t.keySignatureKeys=void 0;var e=Be,n=new WeakMap;t.keySignatureKeys=["Cb","Gb","Db","Ab","Eb","Bb","F","C","G","D","A","E","B","F#","C#"];var r=function(){function i(o){var s=this;if(this.tempos=[],this.timeSignatures=[],this.keySignatures=[],this.meta=[],this.name="",n.set(this,480),o){n.set(this,o.header.ticksPerBeat),o.tracks.forEach(function(l){l.forEach(function(c){c.meta&&(c.type==="timeSignature"?s.timeSignatures.push({ticks:c.absoluteTime,timeSignature:[c.numerator,c.denominator]}):c.type==="setTempo"?s.tempos.push({bpm:6e7/c.microsecondsPerBeat,ticks:c.absoluteTime}):c.type==="keySignature"&&s.keySignatures.push({key:t.keySignatureKeys[c.key+7],scale:c.scale===0?"major":"minor",ticks:c.absoluteTime}))})});var a=0;o.tracks[0].forEach(function(l){a+=l.deltaTime,l.meta&&(l.type==="trackName"?s.name=l.text:(l.type==="text"||l.type==="cuePoint"||l.type==="marker"||l.type==="lyrics")&&s.meta.push({text:l.text,ticks:a,type:l.type}))}),this.update()}}return i.prototype.update=function(){var o=this,s=0,a=0;this.tempos.sort(function(l,c){return l.ticks-c.ticks}),this.tempos.forEach(function(l,c){var m=c>0?o.tempos[c-1].bpm:o.tempos[0].bpm,d=l.ticks/o.ppq-a,u=60/m*d;l.time=u+s,s=l.time,a+=d}),this.timeSignatures.sort(function(l,c){return l.ticks-c.ticks}),this.timeSignatures.forEach(function(l,c){var m=c>0?o.timeSignatures[c-1]:o.timeSignatures[0],d=(l.ticks-m.ticks)/o.ppq,u=d/m.timeSignature[0]/(m.timeSignature[1]/4);m.measures=m.measures||0,l.measures=u+m.measures})},i.prototype.ticksToSeconds=function(o){var s=(0,e.search)(this.tempos,o);if(s!==-1){var a=this.tempos[s],l=a.time,c=(o-a.ticks)/this.ppq;return l+60/a.bpm*c}else{var m=o/this.ppq;return 60/120*m}},i.prototype.ticksToMeasures=function(o){var s=(0,e.search)(this.timeSignatures,o);if(s!==-1){var a=this.timeSignatures[s],l=(o-a.ticks)/this.ppq;return a.measures+l/(a.timeSignature[0]/a.timeSignature[1])/4}else return o/this.ppq/4},Object.defineProperty(i.prototype,"ppq",{get:function(){return n.get(this)},enumerable:!1,configurable:!0}),i.prototype.secondsToTicks=function(o){var s=(0,e.search)(this.tempos,o,"time");if(s!==-1){var a=this.tempos[s],l=a.time,c=o-l,m=c/(60/a.bpm);return Math.round(a.ticks+m*this.ppq)}else{var d=o/.5;return Math.round(d*this.ppq)}},i.prototype.toJSON=function(){return{keySignatures:this.keySignatures,meta:this.meta,name:this.name,ppq:this.ppq,tempos:this.tempos.map(function(o){return{bpm:o.bpm,ticks:o.ticks}}),timeSignatures:this.timeSignatures}},i.prototype.fromJSON=function(o){this.name=o.name,this.tempos=o.tempos.map(function(s){return Object.assign({},s)}),this.timeSignatures=o.timeSignatures.map(function(s){return Object.assign({},s)}),this.keySignatures=o.keySignatures.map(function(s){return Object.assign({},s)}),this.meta=o.meta.map(function(s){return Object.assign({},s)}),n.set(this,o.ppq),this.update()},i.prototype.setTempo=function(o){this.tempos=[{bpm:o,ticks:0}],this.update()},i}();t.Header=r})(bt);var rt={},Wt={};(function(t){Object.defineProperty(t,"__esModule",{value:!0}),t.ControlChange=t.controlChangeIds=t.controlChangeNames=void 0,t.controlChangeNames={1:"modulationWheel",2:"breath",4:"footController",5:"portamentoTime",7:"volume",8:"balance",10:"pan",64:"sustain",65:"portamentoTime",66:"sostenuto",67:"softPedal",68:"legatoFootswitch",84:"portamentoControl"},t.controlChangeIds=Object.keys(t.controlChangeNames).reduce(function(i,o){return i[t.controlChangeNames[o]]=o,i},{});var e=new WeakMap,n=new WeakMap,r=function(){function i(o,s){e.set(this,s),n.set(this,o.controllerType),this.ticks=o.absoluteTime,this.value=o.value}return Object.defineProperty(i.prototype,"number",{get:function(){return n.get(this)},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"name",{get:function(){return t.controlChangeNames[this.number]?t.controlChangeNames[this.number]:null},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"time",{get:function(){var o=e.get(this);return o.ticksToSeconds(this.ticks)},set:function(o){var s=e.get(this);this.ticks=s.secondsToTicks(o)},enumerable:!1,configurable:!0}),i.prototype.toJSON=function(){return{number:this.number,ticks:this.ticks,time:this.time,value:this.value}},i}();t.ControlChange=r})(Wt);var wt={};Object.defineProperty(wt,"__esModule",{value:!0});wt.createControlChanges=void 0;var st=Wt;function Gr(){return new Proxy({},{get:function(t,e){if(t[e])return t[e];if(st.controlChangeIds.hasOwnProperty(e))return t[st.controlChangeIds[e]]},set:function(t,e,n){return st.controlChangeIds.hasOwnProperty(e)?t[st.controlChangeIds[e]]=n:t[e]=n,!0}})}wt.createControlChanges=Gr;var Tt={};Object.defineProperty(Tt,"__esModule",{value:!0});Tt.PitchBend=void 0;var Et=new WeakMap,$r=function(){function t(e,n){Et.set(this,n),this.ticks=e.absoluteTime,this.value=e.value}return Object.defineProperty(t.prototype,"time",{get:function(){var e=Et.get(this);return e.ticksToSeconds(this.ticks)},set:function(e){var n=Et.get(this);this.ticks=n.secondsToTicks(e)},enumerable:!1,configurable:!0}),t.prototype.toJSON=function(){return{ticks:this.ticks,time:this.time,value:this.value}},t}();Tt.PitchBend=$r;var Ct={},Ne={};Object.defineProperty(Ne,"__esModule",{value:!0});Ne.DrumKitByPatchID=Ne.InstrumentFamilyByID=Ne.instrumentByPatchID=void 0;Ne.instrumentByPatchID=["acoustic grand piano","bright acoustic piano","electric grand piano","honky-tonk piano","electric piano 1","electric piano 2","harpsichord","clavi","celesta","glockenspiel","music box","vibraphone","marimba","xylophone","tubular bells","dulcimer","drawbar organ","percussive organ","rock organ","church organ","reed organ","accordion","harmonica","tango accordion","acoustic guitar (nylon)","acoustic guitar (steel)","electric guitar (jazz)","electric guitar (clean)","electric guitar (muted)","overdriven guitar","distortion guitar","guitar harmonics","acoustic bass","electric bass (finger)","electric bass (pick)","fretless bass","slap bass 1","slap bass 2","synth bass 1","synth bass 2","violin","viola","cello","contrabass","tremolo strings","pizzicato strings","orchestral harp","timpani","string ensemble 1","string ensemble 2","synthstrings 1","synthstrings 2","choir aahs","voice oohs","synth voice","orchestra hit","trumpet","trombone","tuba","muted trumpet","french horn","brass section","synthbrass 1","synthbrass 2","soprano sax","alto sax","tenor sax","baritone sax","oboe","english horn","bassoon","clarinet","piccolo","flute","recorder","pan flute","blown bottle","shakuhachi","whistle","ocarina","lead 1 (square)","lead 2 (sawtooth)","lead 3 (calliope)","lead 4 (chiff)","lead 5 (charang)","lead 6 (voice)","lead 7 (fifths)","lead 8 (bass + lead)","pad 1 (new age)","pad 2 (warm)","pad 3 (polysynth)","pad 4 (choir)","pad 5 (bowed)","pad 6 (metallic)","pad 7 (halo)","pad 8 (sweep)","fx 1 (rain)","fx 2 (soundtrack)","fx 3 (crystal)","fx 4 (atmosphere)","fx 5 (brightness)","fx 6 (goblins)","fx 7 (echoes)","fx 8 (sci-fi)","sitar","banjo","shamisen","koto","kalimba","bag pipe","fiddle","shanai","tinkle bell","agogo","steel drums","woodblock","taiko drum","melodic tom","synth drum","reverse cymbal","guitar fret noise","breath noise","seashore","bird tweet","telephone ring","helicopter","applause","gunshot"];Ne.InstrumentFamilyByID=["piano","chromatic percussion","organ","guitar","bass","strings","ensemble","brass","reed","pipe","synth lead","synth pad","synth effects","world","percussive","sound effects"];Ne.DrumKitByPatchID={0:"standard kit",8:"room kit",16:"power kit",24:"electronic kit",25:"tr-808 kit",32:"jazz kit",40:"brush kit",48:"orchestra kit",56:"sound fx kit"};Object.defineProperty(Ct,"__esModule",{value:!0});Ct.Instrument=void 0;var ot=Ne,an=new WeakMap,Yr=function(){function t(e,n){if(this.number=0,an.set(this,n),this.number=0,e){var r=e.find(function(i){return i.type==="programChange"});r&&(this.number=r.programNumber)}}return Object.defineProperty(t.prototype,"name",{get:function(){return this.percussion?ot.DrumKitByPatchID[this.number]:ot.instrumentByPatchID[this.number]},set:function(e){var n=ot.instrumentByPatchID.indexOf(e);n!==-1&&(this.number=n)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"family",{get:function(){return this.percussion?"drums":ot.InstrumentFamilyByID[Math.floor(this.number/8)]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"percussion",{get:function(){var e=an.get(this);return e.channel===9},enumerable:!1,configurable:!0}),t.prototype.toJSON=function(){return{family:this.family,number:this.number,name:this.name}},t.prototype.fromJSON=function(e){this.number=e.number},t}();Ct.Instrument=Yr;var St={};Object.defineProperty(St,"__esModule",{value:!0});St.Note=void 0;function Xr(t){var e=Math.floor(t/12)-1;return Jn(t)+e.toString()}function Jn(t){var e=["C","C#","D","D#","E","F","F#","G","G#","A","A#","B"],n=t%12;return e[n]}function Qr(t){var e=["C","C#","D","D#","E","F","F#","G","G#","A","A#","B"];return e.indexOf(t)}var Zr=function(){var t=/^([a-g]{1}(?:b|#|x|bb)?)(-?[0-9]+)/i,e={cbb:-2,cb:-1,c:0,"c#":1,cx:2,dbb:0,db:1,d:2,"d#":3,dx:4,ebb:2,eb:3,e:4,"e#":5,ex:6,fbb:3,fb:4,f:5,"f#":6,fx:7,gbb:5,gb:6,g:7,"g#":8,gx:9,abb:7,ab:8,a:9,"a#":10,ax:11,bbb:9,bb:10,b:11,"b#":12,bx:13};return function(n){var r=t.exec(n),i=r[1],o=r[2],s=e[i.toLowerCase()];return s+(parseInt(o,10)+1)*12}}(),Re=new WeakMap,ei=function(){function t(e,n,r){Re.set(this,r),this.midi=e.midi,this.velocity=e.velocity,this.noteOffVelocity=n.velocity,this.ticks=e.ticks,this.durationTicks=n.ticks-e.ticks}return Object.defineProperty(t.prototype,"name",{get:function(){return Xr(this.midi)},set:function(e){this.midi=Zr(e)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"octave",{get:function(){return Math.floor(this.midi/12)-1},set:function(e){var n=e-this.octave;this.midi+=n*12},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"pitch",{get:function(){return Jn(this.midi)},set:function(e){this.midi=12*(this.octave+1)+Qr(e)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"duration",{get:function(){var e=Re.get(this);return e.ticksToSeconds(this.ticks+this.durationTicks)-e.ticksToSeconds(this.ticks)},set:function(e){var n=Re.get(this),r=n.secondsToTicks(this.time+e);this.durationTicks=r-this.ticks},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"time",{get:function(){var e=Re.get(this);return e.ticksToSeconds(this.ticks)},set:function(e){var n=Re.get(this);this.ticks=n.secondsToTicks(e)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"bars",{get:function(){var e=Re.get(this);return e.ticksToMeasures(this.ticks)},enumerable:!1,configurable:!0}),t.prototype.toJSON=function(){return{duration:this.duration,durationTicks:this.durationTicks,midi:this.midi,name:this.name,ticks:this.ticks,time:this.time,velocity:this.velocity}},t}();St.Note=ei;Object.defineProperty(rt,"__esModule",{value:!0});rt.Track=void 0;var Ot=Be,ti=Wt,ni=wt,ri=Tt,cn=Ct,ii=St,at=new WeakMap,si=function(){function t(e,n){var r=this;if(this.name="",this.notes=[],this.controlChanges=(0,ni.createControlChanges)(),this.pitchBends=[],at.set(this,n),e){var i=e.find(function(u){return u.type==="trackName"});this.name=i?i.text:""}if(this.instrument=new cn.Instrument(e,this),this.channel=0,e){for(var o=e.filter(function(u){return u.type==="noteOn"}),s=e.filter(function(u){return u.type==="noteOff"}),a=function(){var u=o.shift();l.channel=u.channel;var h=s.findIndex(function(p){return p.noteNumber===u.noteNumber&&p.absoluteTime>=u.absoluteTime});if(h!==-1){var f=s.splice(h,1)[0];l.addNote({durationTicks:f.absoluteTime-u.absoluteTime,midi:u.noteNumber,noteOffVelocity:f.velocity/127,ticks:u.absoluteTime,velocity:u.velocity/127})}},l=this;o.length;)a();var c=e.filter(function(u){return u.type==="controller"});c.forEach(function(u){r.addCC({number:u.controllerType,ticks:u.absoluteTime,value:u.value/127})});var m=e.filter(function(u){return u.type==="pitchBend"});m.forEach(function(u){r.addPitchBend({ticks:u.absoluteTime,value:u.value/Math.pow(2,13)})});var d=e.find(function(u){return u.type==="endOfTrack"});this.endOfTrackTicks=d!==void 0?d.absoluteTime:void 0}}return t.prototype.addNote=function(e){var n=at.get(this),r=new ii.Note({midi:0,ticks:0,velocity:1},{ticks:0,velocity:0},n);return Object.assign(r,e),(0,Ot.insert)(this.notes,r,"ticks"),this},t.prototype.addCC=function(e){var n=at.get(this),r=new ti.ControlChange({controllerType:e.number},n);return delete e.number,Object.assign(r,e),Array.isArray(this.controlChanges[r.number])||(this.controlChanges[r.number]=[]),(0,Ot.insert)(this.controlChanges[r.number],r,"ticks"),this},t.prototype.addPitchBend=function(e){var n=at.get(this),r=new ri.PitchBend({},n);return Object.assign(r,e),(0,Ot.insert)(this.pitchBends,r,"ticks"),this},Object.defineProperty(t.prototype,"duration",{get:function(){if(!this.notes.length)return 0;for(var e=this.notes[this.notes.length-1].time+this.notes[this.notes.length-1].duration,n=0;n<this.notes.length-1;n++){var r=this.notes[n].time+this.notes[n].duration;e<r&&(e=r)}return e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"durationTicks",{get:function(){if(!this.notes.length)return 0;for(var e=this.notes[this.notes.length-1].ticks+this.notes[this.notes.length-1].durationTicks,n=0;n<this.notes.length-1;n++){var r=this.notes[n].ticks+this.notes[n].durationTicks;e<r&&(e=r)}return e},enumerable:!1,configurable:!0}),t.prototype.fromJSON=function(e){var n=this;this.name=e.name,this.channel=e.channel,this.instrument=new cn.Instrument(void 0,this),this.instrument.fromJSON(e.instrument),e.endOfTrackTicks!==void 0&&(this.endOfTrackTicks=e.endOfTrackTicks);for(var r in e.controlChanges)e.controlChanges[r]&&e.controlChanges[r].forEach(function(i){n.addCC({number:i.number,ticks:i.ticks,value:i.value})});e.notes.forEach(function(i){n.addNote({durationTicks:i.durationTicks,midi:i.midi,ticks:i.ticks,velocity:i.velocity})})},t.prototype.toJSON=function(){for(var e={},n=0;n<127;n++)this.controlChanges.hasOwnProperty(n)&&(e[n]=this.controlChanges[n].map(function(i){return i.toJSON()}));var r={channel:this.channel,controlChanges:e,pitchBends:this.pitchBends.map(function(i){return i.toJSON()}),instrument:this.instrument.toJSON(),name:this.name,notes:this.notes.map(function(i){return i.toJSON()})};return this.endOfTrackTicks!==void 0&&(r.endOfTrackTicks=this.endOfTrackTicks),r},t}();rt.Track=si;var It={};function oi(t){var e=[];return zn(t,e),e}function zn(t,e){for(var n=0;n<t.length;n++){var r=t[n];Array.isArray(r)?zn(r,e):e.push(r)}}const ai=Object.freeze(Object.defineProperty({__proto__:null,flatten:oi},Symbol.toStringTag,{value:"Module"})),ci=jn(ai);var Ie=Ve&&Ve.__spreadArray||function(t,e,n){if(n||arguments.length===2)for(var r=0,i=e.length,o;r<i;r++)(o||!(r in e))&&(o||(o=Array.prototype.slice.call(e,0,r)),o[r]=e[r]);return t.concat(o||Array.prototype.slice.call(e))};Object.defineProperty(It,"__esModule",{value:!0});It.encode=void 0;var li=kt,ui=bt,hi=ci;function fi(t,e){return[{absoluteTime:t.ticks,channel:e,deltaTime:0,noteNumber:t.midi,type:"noteOn",velocity:Math.floor(t.velocity*127)},{absoluteTime:t.ticks+t.durationTicks,channel:e,deltaTime:0,noteNumber:t.midi,type:"noteOff",velocity:Math.floor(t.noteOffVelocity*127)}]}function di(t){return(0,hi.flatten)(t.notes.map(function(e){return fi(e,t.channel)}))}function pi(t,e){return{absoluteTime:t.ticks,channel:e,controllerType:t.number,deltaTime:0,type:"controller",value:Math.floor(t.value*127)}}function mi(t){for(var e=[],n=0;n<127;n++)t.controlChanges.hasOwnProperty(n)&&t.controlChanges[n].forEach(function(r){e.push(pi(r,t.channel))});return e}function yi(t,e){return{absoluteTime:t.ticks,channel:e,deltaTime:0,type:"pitchBend",value:t.value}}function gi(t){var e=[];return t.pitchBends.forEach(function(n){e.push(yi(n,t.channel))}),e}function bi(t){return{absoluteTime:0,channel:t.channel,deltaTime:0,programNumber:t.instrument.number,type:"programChange"}}function vi(t){return{absoluteTime:0,deltaTime:0,meta:!0,text:t,type:"trackName"}}function _i(t){return{absoluteTime:t.ticks,deltaTime:0,meta:!0,microsecondsPerBeat:Math.floor(6e7/t.bpm),type:"setTempo"}}function ki(t){return{absoluteTime:t.ticks,deltaTime:0,denominator:t.timeSignature[1],meta:!0,metronome:24,numerator:t.timeSignature[0],thirtyseconds:8,type:"timeSignature"}}function wi(t){var e=ui.keySignatureKeys.indexOf(t.key);return{absoluteTime:t.ticks,deltaTime:0,key:e+7,meta:!0,scale:t.scale==="major"?0:1,type:"keySignature"}}function Ti(t){return{absoluteTime:t.ticks,deltaTime:0,meta:!0,text:t.text,type:t.type}}function Ci(t){var e={header:{format:1,numTracks:t.tracks.length+1,ticksPerBeat:t.header.ppq},tracks:Ie([Ie(Ie(Ie(Ie([{absoluteTime:0,deltaTime:0,meta:!0,text:t.header.name,type:"trackName"}],t.header.keySignatures.map(function(n){return wi(n)}),!0),t.header.meta.map(function(n){return Ti(n)}),!0),t.header.tempos.map(function(n){return _i(n)}),!0),t.header.timeSignatures.map(function(n){return ki(n)}),!0)],t.tracks.map(function(n){return Ie(Ie(Ie([vi(n.name),bi(n)],di(n),!0),mi(n),!0),gi(n),!0)}),!0)};return e.tracks=e.tracks.map(function(n){n=n.sort(function(i,o){return i.absoluteTime-o.absoluteTime});var r=0;return n.forEach(function(i){i.deltaTime=i.absoluteTime-r,r=i.absoluteTime,delete i.absoluteTime}),n.push({deltaTime:0,meta:!0,type:"endOfTrack"}),n}),new Uint8Array((0,li.writeMidi)(e))}It.encode=Ci;(function(t){var e=Ve&&Ve.__awaiter||function(d,u,h,f){function p(y){return y instanceof h?y:new h(function(T){T(y)})}return new(h||(h=Promise))(function(y,T){function U(I){try{C(f.next(I))}catch(H){T(H)}}function L(I){try{C(f.throw(I))}catch(H){T(H)}}function C(I){I.done?y(I.value):p(I.value).then(U,L)}C((f=f.apply(d,u||[])).next())})},n=Ve&&Ve.__generator||function(d,u){var h={label:0,sent:function(){if(y[0]&1)throw y[1];return y[1]},trys:[],ops:[]},f,p,y,T;return T={next:U(0),throw:U(1),return:U(2)},typeof Symbol=="function"&&(T[Symbol.iterator]=function(){return this}),T;function U(C){return function(I){return L([C,I])}}function L(C){if(f)throw new TypeError("Generator is already executing.");for(;h;)try{if(f=1,p&&(y=C[0]&2?p.return:C[0]?p.throw||((y=p.return)&&y.call(p),0):p.next)&&!(y=y.call(p,C[1])).done)return y;switch(p=0,y&&(C=[C[0]&2,y.value]),C[0]){case 0:case 1:y=C;break;case 4:return h.label++,{value:C[1],done:!1};case 5:h.label++,p=C[1],C=[0];continue;case 7:C=h.ops.pop(),h.trys.pop();continue;default:if(y=h.trys,!(y=y.length>0&&y[y.length-1])&&(C[0]===6||C[0]===2)){h=0;continue}if(C[0]===3&&(!y||C[1]>y[0]&&C[1]<y[3])){h.label=C[1];break}if(C[0]===6&&h.label<y[1]){h.label=y[1],y=C;break}if(y&&h.label<y[2]){h.label=y[2],h.ops.push(C);break}y[2]&&h.ops.pop(),h.trys.pop();continue}C=u.call(d,h)}catch(I){C=[6,I],p=0}finally{f=y=0}if(C[0]&5)throw C[1];return{value:C[0]?C[1]:void 0,done:!0}}};Object.defineProperty(t,"__esModule",{value:!0}),t.Header=t.Track=t.Midi=void 0;var r=kt,i=bt,o=rt,s=It,a=function(){function d(u){var h=this,f=null;if(u){var p=u instanceof ArrayBuffer?new Uint8Array(u):u;f=(0,r.parseMidi)(p),f.tracks.forEach(function(y){var T=0;y.forEach(function(U){T+=U.deltaTime,U.absoluteTime=T})}),f.tracks=m(f.tracks)}this.header=new i.Header(f),this.tracks=[],u&&(this.tracks=f.tracks.map(function(y){return new o.Track(y,h.header)}),f.header.format===1&&this.tracks[0].duration===0&&this.tracks.shift())}return d.fromUrl=function(u){return e(this,void 0,void 0,function(){var h,f;return n(this,function(p){switch(p.label){case 0:return[4,fetch(u)];case 1:return h=p.sent(),h.ok?[4,h.arrayBuffer()]:[3,3];case 2:return f=p.sent(),[2,new d(f)];case 3:throw new Error("Could not load '".concat(u,"'"))}})})},Object.defineProperty(d.prototype,"name",{get:function(){return this.header.name},set:function(u){this.header.name=u},enumerable:!1,configurable:!0}),Object.defineProperty(d.prototype,"duration",{get:function(){var u=this.tracks.map(function(h){return h.duration});return Math.max.apply(Math,u)},enumerable:!1,configurable:!0}),Object.defineProperty(d.prototype,"durationTicks",{get:function(){var u=this.tracks.map(function(h){return h.durationTicks});return Math.max.apply(Math,u)},enumerable:!1,configurable:!0}),d.prototype.addTrack=function(){var u=new o.Track(void 0,this.header);return this.tracks.push(u),u},d.prototype.toArray=function(){return(0,s.encode)(this)},d.prototype.toJSON=function(){return{header:this.header.toJSON(),tracks:this.tracks.map(function(u){return u.toJSON()})}},d.prototype.fromJSON=function(u){var h=this;this.header=new i.Header,this.header.fromJSON(u.header),this.tracks=u.tracks.map(function(f){var p=new o.Track(void 0,h.header);return p.fromJSON(f),p})},d.prototype.clone=function(){var u=new d;return u.fromJSON(this.toJSON()),u},d}();t.Midi=a;var l=rt;Object.defineProperty(t,"Track",{enumerable:!0,get:function(){return l.Track}});var c=bt;Object.defineProperty(t,"Header",{enumerable:!0,get:function(){return c.Header}});function m(d){for(var u=[],h=0;h<d.length;h++)for(var f=u.length,p=new Map,y=Array(16).fill(0),T=0,U=d[h];T<U.length;T++){var L=U[T],C=f,I=L.channel;if(I!==void 0){L.type==="programChange"&&(y[I]=L.programNumber);var H=y[I],w="".concat(H," ").concat(I);p.has(w)?C=p.get(w):(C=f+p.size,p.set(w,C))}u[C]||u.push([]),u[C].push(L)}return u}})(Ft);const Fe=[];function ie(t,e=J){let n;const r=new Set;function i(a){if(Ue(t,a)&&(t=a,n)){const l=!Fe.length;for(const c of r)c[1](),Fe.push(c,t);if(l){for(let c=0;c<Fe.length;c+=2)Fe[c][0](Fe[c+1]);Fe.length=0}}}function o(a){i(a(t))}function s(a,l=J){const c=[a,l];return r.add(c),r.size===1&&(n=e(i,o)||J),a(t),()=>{r.delete(c),r.size===0&&n&&(n(),n=null)}}return{set:i,update:o,subscribe:s}}const He=["C","C#","D","D#","E","F","F#","G","G#","A","A#","B"],ln={Backquote:"A#2",Tab:"B2",KeyQ:"C3",Digit2:"C#3",KeyW:"D3",Digit3:"D#3",KeyE:"E3",KeyR:"F3",Digit5:"F#3",KeyT:"G3",Digit6:"G#3",KeyY:"A3",Digit7:"A#3",KeyU:"B3",KeyI:"C4",Digit9:"C#4",KeyO:"D4",Digit0:"D#4",KeyP:"E4",BracketLeft:"F4",Equal:"F#4",BracketRight:"G4",Backspace:"G#4",Backslash:"A4",CapsLock:"A#4",ShiftLeft:"B4",KeyZ:"C5",KeyS:"C#5",KeyX:"D5",KeyD:"D#5",KeyC:"E5",KeyV:"F5",KeyG:"F#5",KeyB:"G5",KeyH:"G#5",KeyN:"A5",KeyJ:"A#5",KeyM:"B5",Comma:"C6",KeyL:"C#6",Period:"D6",Semicolon:"D#6",Slash:"E6",ShiftRight:"F6",Enter:"F#6"},Si={"A#2":"`",B2:"↹",C3:"Q","C#3":"2",D3:"W","D#3":"3",E3:"E",F3:"R","F#3":"5",G3:"T","G#3":"6",A3:"Y","A#3":"7",B3:"U",C4:"I","C#4":"9",D4:"O","D#4":"0",E4:"P",F4:"[","F#4":"=",G4:"]","G#4":"⌫",A4:"\\","A#4":"⇪",B4:"⇧",C5:"Z","C#5":"S",D5:"X","D#5":"D",E5:"C",F5:"V","F#5":"G",G5:"B","G#5":"H",A5:"N","A#5":"J",B5:"M",C6:",","C#6":"L",D6:".","D#6":";",E6:"/",F6:"⇧","F#6":"↩"};function Dt(t){return parseInt(t.charAt(t.length-1))}function vt(t){return t.substring(0,t.length-1)}function Ye(t){const e=Math.floor(t/12)-1;return He[t%12]+e}function _t(t){const e=He.indexOf(vt(t));return(Dt(t)+1)*12+e}function Ii(t,e){const n=Dt(e),r=Dt(t),i=He.indexOf(vt(t)),o=He.indexOf(vt(e)),s={};let a=0,l=i;for(let c=r;c<=n;c++){for(;l<He.length&&!(c===n&&l>o);){const m=He[l],d=m.length===1;s[m+c]={isWhite:d,pressedColor:null},d&&a++,l++}l=0}return[s,a]}var Wn={exports:{}},Gn={exports:{}};function Pi(t){return t>64&&t<91?t-65:t>96&&t<123?t-71:t>47&&t<58?t+4:t===43?62:t===47?63:0}function Ni(t,e){for(var n=t.replace(/[^A-Za-z0-9\+\/]/g,""),r=n.length,i=e?Math.ceil((r*3+1>>2)/e)*e:r*3+1>>2,o=new Uint8Array(i),s,a,l=0,c=0,m=0;m<r;m++)if(a=m&3,l|=Pi(n.charCodeAt(m))<<18-6*a,a===3||r-m===1){for(s=0;s<3&&c<i;s++,c++)o[c]=l>>>(16>>>s&24)&255;l=0}return o}var Ei={decode:Ni},Oi=function(t,e){return new Promise(function(n,r){var i=new XMLHttpRequest;e&&(i.responseType=e),i.open("GET",t),i.onload=function(){i.status===200?n(i.response):r(Error(i.statusText))},i.onerror=function(){r(Error("Network Error"))},i.send()})};(function(t){var e=Ei,n=Oi;function r(w){return function(k){return typeof k=="string"&&w.test(k)}}function i(w,k){return typeof w=="string"?w+k:typeof w=="function"?w(k):k}function o(w,k,A,P){var Z=s(k)?a:l(k)?c:m(k)?d:u(k)?h:f(k)?p:y(k)?T:U(k)?L:C(k)?I:null,j=A||{};return Z?Z(w,k,j):P?Promise.resolve(P):Promise.reject("Source not valid ("+k+")")}o.fetch=n;function s(w){return w instanceof ArrayBuffer}function a(w,k,A){return new Promise(function(P,Z){w.decodeAudioData(k,function(j){P(j)},function(){Z("Can't decode audio data ("+k.slice(0,30)+"...)")})})}var l=r(/\.(mp3|wav|ogg)(\?.*)?$/i);function c(w,k,A){var P=i(A.from,k);return o(w,o.fetch(P,"arraybuffer"),A)}function m(w){return w&&typeof w.then=="function"}function d(w,k,A){return k.then(function(P){return o(w,P,A)})}var u=Array.isArray;function h(w,k,A){return Promise.all(k.map(function(P){return o(w,P,A,P)}))}function f(w){return w&&typeof w=="object"}function p(w,k,A){var P={},Z=Object.keys(k).map(function(j){if(A.only&&A.only.indexOf(j)===-1)return null;var ce=k[j];return o(w,ce,A,ce).then(function(ue){P[j]=ue})});return Promise.all(Z).then(function(){return P})}var y=r(/\.json(\?.*)?$/i);function T(w,k,A){var P=i(A.from,k);return o(w,o.fetch(P,"text").then(JSON.parse),A)}var U=r(/^data:audio/);function L(w,k,A){var P=k.indexOf(",");return o(w,e.decode(k.slice(P+1)).buffer,A)}var C=r(/\.js(\?.*)?$/i);function I(w,k,A){var P=i(A.from,k);return o(w,o.fetch(P,"text").then(H),A)}function H(w){var k=w.indexOf("MIDI.Soundfont.");if(k<0)throw Error("Invalid MIDI.js Soundfont format");k=w.indexOf("=",k)+2;var A=w.lastIndexOf(",");return JSON.parse(w.slice(k,A)+"}")}t.exports&&(t.exports=o),typeof window<"u"&&(window.loadAudio=o)})(Gn);var Ai=Gn.exports,$n={exports:{}},xi=Bi;function Bi(t){var e=t.createGain(),n=e._voltage=Ri(t),r=De(n),i=De(n),o=De(n);return e._startAmount=De(i),e._endAmount=De(o),e._multiplier=De(r),e._multiplier.connect(e),e._startAmount.connect(e),e._endAmount.connect(e),e.value=r.gain,e.startValue=i.gain,e.endValue=o.gain,e.startValue.value=0,e.endValue.value=0,Object.defineProperties(e,Ui),e}var Ui={attack:{value:0,writable:!0},decay:{value:0,writable:!0},sustain:{value:1,writable:!0},release:{value:0,writable:!0},getReleaseDuration:{value:function(){return this.release}},start:{value:function(t){var e=this._multiplier.gain,n=this._startAmount.gain,r=this._endAmount.gain;this._voltage.start(t),this._decayFrom=this._decayFrom=t+this.attack,this._startedAt=t;var i=this.sustain;e.cancelScheduledValues(t),n.cancelScheduledValues(t),r.cancelScheduledValues(t),r.setValueAtTime(0,t),this.attack?(e.setValueAtTime(0,t),e.linearRampToValueAtTime(1,t+this.attack),n.setValueAtTime(1,t),n.linearRampToValueAtTime(0,t+this.attack)):(e.setValueAtTime(1,t),n.setValueAtTime(0,t)),this.decay&&e.setTargetAtTime(i,this._decayFrom,un(this.decay))}},stop:{value:function(t,e){e&&(t=t-this.release);var n=t+this.release;if(this.release){var r=this._multiplier.gain,i=this._startAmount.gain,o=this._endAmount.gain;r.cancelScheduledValues(t),i.cancelScheduledValues(t),o.cancelScheduledValues(t);var s=un(this.release);if(this.attack&&t<this._decayFrom){var a=Fi(0,1,this._startedAt,this._decayFrom,t);r.linearRampToValueAtTime(a,t),i.linearRampToValueAtTime(1-a,t),i.setTargetAtTime(0,t,s)}o.setTargetAtTime(1,t,s),r.setTargetAtTime(0,t,s)}return this._voltage.stop(n),n}},onended:{get:function(){return this._voltage.onended},set:function(t){this._voltage.onended=t}}},Mi=new Float32Array([1,1]);function Ri(t){var e=t.createBufferSource(),n=t.createBuffer(1,2,t.sampleRate);return n.getChannelData(0).set(Mi),e.buffer=n,e.loop=!0,e}function De(t){var e=t.context.createGain();return t.connect(e),e}function un(t){return Math.log(t+1)/Math.log(100)}function Fi(t,e,n,r,i){var o=e-t,s=r-n,a=i-n,l=a/s,c=t+l*o;return c<=t&&(c=t),c>=e&&(c=e),c}var Di=xi,Li={},qi={gain:1,attack:.01,decay:.1,sustain:.9,release:.3,loop:!1,cents:0,loopStart:0,loopEnd:0};function Vi(t,e,n){var r=!1,i=0,o={},s=t.createGain();s.gain.value=1;var a=Object.assign({},qi,n),l={context:t,out:s,opts:a};return e instanceof AudioBuffer?l.buffer=e:l.buffers=e,l.start=function(d,u,h){if(l.buffer&&d!==null)return l.start(null,d,u);var f=d?l.buffers[d]:l.buffer;if(f){if(!r){console.warn("SamplePlayer not connected to any node.");return}}else{console.warn("Buffer "+d+" not found.");return}var p=h||Li;u=Math.max(t.currentTime,u||0),l.emit("start",u,d,p);var y=m(d,f,p);return y.id=c(d,y),y.env.start(u),y.source.start(u),l.emit("started",u,y.id,y),p.duration&&y.stop(u+p.duration),y},l.play=function(d,u,h){return l.start(d,u,h)},l.stop=function(d,u){var h;return u=u||Object.keys(o),u.map(function(f){return h=o[f],h?(h.stop(d),h.id):null})},l.connect=function(d){return r=!0,s.connect(d),l},l.emit=function(d,u,h,f){l.onevent&&l.onevent(d,u,h,f);var p=l["on"+d];p&&p(u,h,f)},l;function c(d,u){return u.id=i++,o[u.id]=u,u.source.onended=function(){var h=t.currentTime;u.source.disconnect(),u.env.disconnect(),u.disconnect(),l.emit("ended",h,u.id,u)},u.id}function m(d,u,h){var f=t.createGain();return f.gain.value=0,f.connect(s),f.env=ji(t,h,a),f.env.connect(f.gain),f.source=t.createBufferSource(),f.source.buffer=u,f.source.connect(f),f.source.loop=h.loop||a.loop,f.source.playbackRate.value=Ki(h.cents||a.cents),f.source.loopStart=h.loopStart||a.loopStart,f.source.loopEnd=h.loopEnd||a.loopEnd,f.stop=function(p){var y=p||t.currentTime;l.emit("stop",y,d);var T=f.env.stop(y);f.source.stop(T)},f}}function hn(t){return typeof t=="number"}var Hi=["attack","decay","sustain","release"];function ji(t,e,n){var r=Di(t),i=e.adsr||n.adsr;return Hi.forEach(function(o,s){i?r[o]=i[s]:r[o]=e[o]||n[o]}),r.value.value=hn(e.gain)?e.gain:hn(n.gain)?n.gain:1,r}function Ki(t){return t?Math.pow(2,t/1200):1}var Ji=Vi,zi=function(t){return t.on=function(e,n){if(arguments.length===1&&typeof e=="function")return t.on("event",e);var r="on"+e,i=t[r];return t[r]=i?Wi(i,n):n,t},t};function Wi(t,e){return function(n,r,i,o){t(n,r,i,o),e(n,r,i,o)}}var Yn=/^([a-gA-G])(#{1,}|b{1,}|x{1,}|)(-?\d*)\s*(.*)\s*$/;function Gi(){return Yn}var $i=[0,2,4,5,7,9,11];function Xn(t,e,n){if(typeof t!="string")return null;var r=Yn.exec(t);if(!r||!e&&r[4])return null;var i={letter:r[1].toUpperCase(),acc:r[2].replace(/x/g,"##")};return i.pc=i.letter+i.acc,i.step=(i.letter.charCodeAt(0)+3)%7,i.alt=i.acc[0]==="b"?-i.acc.length:i.acc.length,i.chroma=$i[i.step]+i.alt,r[3]&&(i.oct=+r[3],i.midi=i.chroma+12*(i.oct+1),i.freq=Qn(i.midi,n)),e&&(i.tonicOf=r[4]),i}function Qn(t,e){return Math.pow(2,(t-69)/12)*(e||440)}var Zn={parse:Xn,regex:Gi,midiToFreq:Qn},Yi=["letter","acc","pc","step","alt","chroma","oct","midi","freq"];Yi.forEach(function(t){Zn[t]=function(e){var n=Xn(e);return n&&typeof n[t]<"u"?n[t]:null}});var Xi=Zn,Qi=Xi,Zi=function(t){return t!==null&&t!==[]&&t>=0&&t<129},es=function(t){return Zi(t)?+t:Qi.midi(t)},ts=function(t){if(t.buffers){var e=t.opts.map,n=typeof e=="function"?e:es,r=function(o){return o?n(o)||o:null};t.buffers=ns(t.buffers,r);var i=t.start;t.start=function(o,s,a){var l=r(o),c=l%1;return c&&(l=Math.floor(l),a=Object.assign(a||{},{cents:Math.floor(c*100)})),i(l,s,a)}}return t};function ns(t,e){return Object.keys(t).reduce(function(n,r){return n[e(r)]=t[r],n},{})}var rs=Array.isArray,is=function(t){return t&&typeof t=="object"},ss={},os=function(t){return t.schedule=function(e,n){var r=t.context.currentTime,i=e<r?r:e;t.emit("schedule",i,n);var o,s,a,l;return n.map(function(c){if(c)rs(c)?(o=c[0],s=c[1]):(o=c.time,s=c);else return null;return is(s)?(a=s.name||s.key||s.note||s.midi||null,l=s):(a=s,l=ss),t.start(a,i+(o||0),l)})},t};function ct(t){throw new Error('Could not dynamically require "'+t+'". Please configure the dynamicRequireTargets or/and ignoreDynamicRequires option of @rollup/plugin-commonjs appropriately for this require call to work.')}var er={exports:{}};(function(t,e){(function(n){t.exports=n()})(function(){return function n(r,i,o){function s(c,m){if(!i[c]){if(!r[c]){var d=typeof ct=="function"&&ct;if(!m&&d)return d(c,!0);if(a)return a(c,!0);var u=new Error("Cannot find module '"+c+"'");throw u.code="MODULE_NOT_FOUND",u}var h=i[c]={exports:{}};r[c][0].call(h.exports,function(f){var p=r[c][1][f];return s(p||f)},h,h.exports,n,r,i,o)}return i[c].exports}for(var a=typeof ct=="function"&&ct,l=0;l<o.length;l++)s(o[l]);return s}({1:[function(n,r,i){Object.defineProperty(i,"__esModule",{value:!0}),i.default=function(o){function s(a){if(this._event=a,this._data=a.data,this.receivedTime=a.receivedTime,this._data&&this._data.length<2){console.warn("Illegal MIDI message of length",this._data.length);return}switch(this._messageCode=a.data[0]&240,this.channel=a.data[0]&15,this._messageCode){case 128:this.messageType="noteoff",this.key=a.data[1]&127,this.velocity=a.data[2]&127;break;case 144:this.messageType="noteon",this.key=a.data[1]&127,this.velocity=a.data[2]&127;break;case 160:this.messageType="keypressure",this.key=a.data[1]&127,this.pressure=a.data[2]&127;break;case 176:this.messageType="controlchange",this.controllerNumber=a.data[1]&127,this.controllerValue=a.data[2]&127,this.controllerNumber===120&&this.controllerValue===0?this.channelModeMessage="allsoundoff":this.controllerNumber===121?this.channelModeMessage="resetallcontrollers":this.controllerNumber===122?this.controllerValue===0?this.channelModeMessage="localcontroloff":this.channelModeMessage="localcontrolon":this.controllerNumber===123&&this.controllerValue===0?this.channelModeMessage="allnotesoff":this.controllerNumber===124&&this.controllerValue===0?this.channelModeMessage="omnimodeoff":this.controllerNumber===125&&this.controllerValue===0?this.channelModeMessage="omnimodeon":this.controllerNumber===126?this.channelModeMessage="monomodeon":this.controllerNumber===127&&(this.channelModeMessage="polymodeon");break;case 192:this.messageType="programchange",this.program=a.data[1];break;case 208:this.messageType="channelpressure",this.pressure=a.data[1]&127;break;case 224:this.messageType="pitchbendchange";var l=a.data[2]&127,c=a.data[1]&127;this.pitchBend=(l<<8)+c;break}}return new s(o)},r.exports=i.default},{}]},{},[1])(1)})})(er);var as=er.exports,cs=as,ls=function(t){return t.listenToMidi=function(e,n){var r={},i=n||{},o=i.gain||function(s){return s/127};return e.onmidimessage=function(s){var a=s.messageType?s:cs(s);if(a.messageType==="noteon"&&a.velocity===0&&(a.messageType="noteoff"),!(i.channel&&a.channel!==i.channel))switch(a.messageType){case"noteon":r[a.key]=t.play(a.key,0,{gain:o(a.velocity)});break;case"noteoff":r[a.key]&&(r[a.key].stop(),delete r[a.key]);break}},t},t};(function(t){var e=Ji,n=zi,r=ts,i=os,o=ls;function s(a,l,c){return o(i(r(n(e(a,l,c)))))}t.exports&&(t.exports=s),typeof window<"u"&&(window.SamplePlayer=s)})($n);var us=$n.exports;function fn(t,e){return Array(e+1).join(t)}function Gt(t){return typeof t=="number"}function hs(t){return typeof t=="string"}function fs(t){return typeof t<"u"}function tr(t,e){return Math.pow(2,(t-69)/12)*(e||440)}var nr=/^([a-gA-G])(#{1,}|b{1,}|x{1,}|)(-?\d*)\s*(.*)\s*$/;function ds(){return nr}var ps=[0,2,4,5,7,9,11];function Ce(t,e,n){if(typeof t!="string")return null;var r=nr.exec(t);if(!r||!e&&r[4])return null;var i={letter:r[1].toUpperCase(),acc:r[2].replace(/x/g,"##")};i.pc=i.letter+i.acc,i.step=(i.letter.charCodeAt(0)+3)%7,i.alt=i.acc[0]==="b"?-i.acc.length:i.acc.length;var o=ps[i.step]+i.alt;return i.chroma=o<0?12+o:o%12,r[3]&&(i.oct=+r[3],i.midi=o+12*(i.oct+1),i.freq=tr(i.midi,n)),e&&(i.tonicOf=r[4]),i}var ms="CDEFGAB";function ys(t){return Gt(t)?t<0?fn("b",-t):fn("#",t):""}function gs(t){return Gt(t)?""+t:""}function rr(t,e,n){return t===null||typeof t>"u"?null:t.step?rr(t.step,t.alt,t.oct):t<0||t>6?null:ms.charAt(t)+ys(e)+gs(n)}function ir(t){if((Gt(t)||hs(t))&&t>=0&&t<128)return+t;var e=Ce(t);return e&&fs(e.midi)?e.midi:null}function bs(t,e){var n=ir(t);return n===null?null:tr(n,e)}function vs(t){return(Ce(t)||{}).letter}function _s(t){return(Ce(t)||{}).acc}function ks(t){return(Ce(t)||{}).pc}function ws(t){return(Ce(t)||{}).step}function Ts(t){return(Ce(t)||{}).alt}function Cs(t){return(Ce(t)||{}).chroma}function Ss(t){return(Ce(t)||{}).oct}const Is=Object.freeze(Object.defineProperty({__proto__:null,acc:_s,alt:Ts,build:rr,chroma:Cs,freq:bs,letter:vs,midi:ir,oct:Ss,parse:Ce,pc:ks,regex:ds,step:ws},Symbol.toStringTag,{value:"Module"})),Ps=jn(Is);var At,dn;function Ns(){if(dn)return At;dn=1;var t=Ps;function e(i,o){if(console.warn("new Soundfont() is deprected"),console.log("Please use Soundfont.instrument() instead of new Soundfont().instrument()"),!(this instanceof e))return new e(i);this.nameToUrl=o||e.nameToUrl,this.ctx=i,this.instruments={},this.promises=[]}e.prototype.onready=function(i){console.warn("deprecated API"),console.log("Please use Promise.all(Soundfont.instrument(), Soundfont.instrument()).then() instead of new Soundfont().onready()"),Promise.all(this.promises).then(i)},e.prototype.instrument=function(i,o){console.warn("new Soundfont().instrument() is deprecated."),console.log("Please use Soundfont.instrument() instead.");var s=this.ctx;if(i=i||"default",i in this.instruments)return this.instruments[i];var a={name:i,play:r(s,o)};if(this.instruments[i]=a,i!=="default"){var l=e.instrument(s,i,o).then(function(c){return a.play=c.play,a});this.promises.push(l),a.onready=function(c){console.warn("onready is deprecated. Use Soundfont.instrument().then()"),l.then(c)}}else a.onready=function(c){console.warn("onready is deprecated. Use Soundfont.instrument().then()"),c()};return a};function n(i,o,s){return console.warn("Soundfont.loadBuffers is deprecate."),console.log("Use Soundfont.instrument(..) and get buffers properties from the result."),e.instrument(i,o,s).then(function(a){return a.buffers})}e.loadBuffers=n;function r(i,o){return o=o||{},function(s,a,l,c){console.warn("The oscillator player is deprecated."),console.log("Starting with version 0.9.0 you will have to wait until the soundfont is loaded to play sounds.");var m=s>0&&s<129?+s:t.midi(s),d=m?t.midiToFreq(m,440):null;if(d){l=l||.2,c=c||{};var u=c.destination||o.destination||i.destination,h=c.vcoType||o.vcoType||"sine",f=c.gain||o.gain||.4,p=i.createOscillator();p.type=h,p.frequency.value=d;var y=i.createGain();return y.gain.value=f,p.connect(y),y.connect(u),p.start(a),l>0&&p.stop(a+l),p}}}return e.noteToMidi=t.midi,At=e,At}(function(t){var e=Ai,n=us;function r(a,l,c){if(arguments.length===1)return function(f,p){return r(a,f,p)};var m=c||{},d=m.isSoundfontURL||i,u=m.nameToUrl||o,h=d(l)?l:u(l,m.soundfont,m.format);return e(a,h,{only:m.only||m.notes}).then(function(f){var p=n(a,f,m).connect(m.destination?m.destination:a.destination);return p.url=h,p.name=l,p})}function i(a){return/\.js(\?.*)?$/i.test(a)}function o(a,l,c){return c=c==="ogg"?c:"mp3",l=l==="FluidR3_GM"?l:"MusyngKite","https://gleitz.github.io/midi-js-soundfonts/"+l+"/"+a+"-"+c+".js"}var s=Ns();s.instrument=r,s.nameToUrl=o,t.exports&&(t.exports=s),typeof window<"u"&&(window.Soundfont=s)})(Wn);var Es=Wn.exports;const sr=window.AudioContext||window.webkitAudioContext,Os=new sr;sr||alert("Your browser does not seem to support the Web Audio API!");const xt={};function As(t){return xt[t]||(xt[t]=Es.instrument(Os,t)),xt[t]}function xs(t,e){if(!t||t.length==0)return 0;let n=0,r=t.length-1;for(;n!=r;){const i=Math.ceil((n+r)/2);e(t[i])>=0?r=i-1:n=i}return r}function Bs(t,e){t[e]=t[t.length-1],t.pop()}function or(t){return t.split("_").map(r=>r.charAt(0).toUpperCase()+r.slice(1)).join(" ")}class Us{constructor(){B(this,"midiIsPlaying",ie(!1));B(this,"midiCurrentTime",ie(0));B(this,"midiTotalTime",ie(0));B(this,"midiSpeed",ie(1));B(this,"midiIsRecording",ie(!1));B(this,"selectedMidiTrack",ie(0));B(this,"midiData",new Ft.Midi);B(this,"midiTracks",ie(this.midiData.tracks));B(this,"midiPlaySolo",ie(!1));B(this,"lastStartFunc",()=>{});B(this,"tracksIndexUpTo",[]);B(this,"loopIntervalID");B(this,"playingHeldNotes",[]);B(this,"recordingHeldNotes",new Map);B(this,"recoringMidiData",null);B(this,"midiLastStartTime",0);B(this,"onPlayNote");B(this,"onStopNote");this.midiTracks.subscribe(e=>{const n=e.length==0?0:this.midiData.duration;this.midiTotalTime.set(n),this.midiCurrentTime.set(Math.min(n,Q(this.midiCurrentTime)))})}startPlaying(){this.recalcPlayIndex(),this.startLoop(e=>{this.onPlayUpdate(e),e>Q(this.midiTotalTime)&&(this.stop(),this.lastStartFunc=()=>{},this.midiCurrentTime.set(0))}),this.midiIsPlaying.set(!0),this.lastStartFunc=this.startPlaying.bind(this),this.midiLastStartTime=Q(this.midiCurrentTime)}startRecording(){this.midiData.tracks.length==0&&this.addTrack(),this.midiData.tracks[Q(this.selectedMidiTrack)].notes=[],this.recoringMidiData=this.midiData.clone(),this.recalcPlayIndex(),this.midiIsRecording.set(!0),this.lastStartFunc=this.startRecording.bind(this),this.midiLastStartTime=Q(this.midiCurrentTime)}stop(){clearInterval(this.loopIntervalID),this.loopIntervalID=void 0,this.playingHeldNotes.forEach(e=>this.onStopNote(e.name)),this.playingHeldNotes=[],this.midiIsPlaying.set(!1),this.recoringMidiData&&(this.midiData=this.recoringMidiData,this.recoringMidiData=null,this.midiTracks.set(this.midiData.tracks)),this.midiIsRecording.set(!1),this.recordingHeldNotes.clear()}recordPlayNote(e,n){if(!Q(this.midiIsRecording))return;this.loopIntervalID===void 0&&this.startLoop(i=>{this.onPlayUpdate(i),i>Q(this.midiTotalTime)&&this.midiTotalTime.set(i)});const r=_t(e);this.recordingHeldNotes.set(r,{midi:r,velocity:n,time:Q(this.midiCurrentTime)})}recordStopNote(e){if(!Q(this.midiIsRecording))return;const n=_t(e),r=this.recordingHeldNotes.get(n);r&&(r.duration=Q(this.midiCurrentTime)-r.time,this.recoringMidiData.tracks[Q(this.selectedMidiTrack)].addNote(r),this.recordingHeldNotes.delete(n))}addTrack(){const e=this.midiData.addTrack();this.selectedMidiTrack.set(this.midiData.tracks.length-1),this.midiTracks.set(this.midiData.tracks);const n=prompt("Enter the track name: ");n&&(e.name=n)}deleteTrack(){const e=Q(this.selectedMidiTrack);this.midiData.tracks.splice(e,1),this.selectedMidiTrack.set(Math.min(this.midiData.tracks.length-1,e)),this.midiTracks.set(this.midiData.tracks)}saveFile(){const e=new Blob([this.midiData.toArray()],{type:"application/octet-stream"}),n=URL.createObjectURL(e),r=document.createElement("a");r.href=n,r.download="record.midi",document.body.appendChild(r),r.click(),document.body.removeChild(r),URL.revokeObjectURL(n)}setFile(e){if(!e)return;const n=new FileReader;n.onload=()=>{this.midiData=new Ft.Midi(n.result),this.midiTracks.set(this.midiData.tracks),this.selectedMidiTrack.set(0)},n.readAsArrayBuffer(e)}stopAndReseek(){this.stop(),this.lastStartFunc=()=>{},this.midiCurrentTime.set(this.midiLastStartTime)}recalcPlayIndex(){this.midiData.tracks.forEach((e,n)=>{const r=Q(this.midiCurrentTime);this.tracksIndexUpTo[n]=xs(e.notes,i=>i.time-r)})}startLoop(e){let n=performance.now();this.loopIntervalID=setInterval(()=>{const r=performance.now(),o=(r-n)/1e3*Q(this.midiSpeed),s=Q(this.midiCurrentTime)+o;this.midiCurrentTime.set(s),e(s),n=r},10)}onPlayUpdate(e){if(this.playingHeldNotes.forEach((n,r)=>{e>n.time+n.duration&&(this.onStopNote(n.name),Bs(this.playingHeldNotes,r))}),Q(this.midiPlaySolo)){const n=Q(this.selectedMidiTrack);this.checkTracksPlayNotes(e,n)}else for(let n=0;n<this.midiData.tracks.length;n++)this.checkTracksPlayNotes(e,n)}checkTracksPlayNotes(e,n){const r=this.midiData.tracks[n];for(;;){const i=r.notes[this.tracksIndexUpTo[n]];if(!i||e<i.time)break;i.time+i.duration>e&&(this.onPlayNote(i.name,i.velocity),this.playingHeldNotes.push(i)),this.tracksIndexUpTo[n]++}}}function pn(t,e,n){const r=t.slice();return r[39]=e[n][0],r[40]=e[n][1].isWhite,r[41]=e[n][1].pressedColor,r}function mn(t){let e,n=t[18](t[39],t[6],t[5],t[4])+"",r,i,o,s,a;function l(...u){return t[27](t[39],...u)}function c(){return t[28](t[39])}function m(){return t[29](t[39])}function d(){return t[30](t[39])}return{c(){e=v("div"),r=ae(n),i=x(),_(e,"class",o="key "+(t[40]?"white":"black")+" svelte-1569eu9"),Oe(e,"--color-hue",t[41]),rn(e,"pressed",t[41]!==null)},m(u,h){R(u,e,h),g(e,r),g(e,i),s||(a=[O(e,"pointerdown",l),O(e,"pointerenter",c),O(e,"pointerleave",m),O(e,"pointerup",d)],s=!0)},p(u,h){t=u,h[0]&120&&n!==(n=t[18](t[39],t[6],t[5],t[4])+"")&&tt(r,n),h[0]&8&&o!==(o="key "+(t[40]?"white":"black")+" svelte-1569eu9")&&_(e,"class",o),h[0]&8&&Oe(e,"--color-hue",t[41]),h[0]&8&&rn(e,"pressed",t[41]!==null)},d(u){u&&M(e),s=!1,be(a)}}}function Ms(t){let e,n,r,i,o=Te(Object.entries(t[3])),s=[];for(let a=0;a<o.length;a+=1)s[a]=mn(pn(t,o,a));return{c(){e=v("div"),n=v("div");for(let a=0;a<s.length;a+=1)s[a].c();_(n,"class","piano svelte-1569eu9"),_(e,"class","piano-container svelte-1569eu9")},m(a,l){R(a,e,l),g(e,n);for(let c=0;c<s.length;c+=1)s[c]&&s[c].m(n,null);t[31](e),r||(i=[O(window,"resize",t[24]),O(window,"keyup",t[17]),O(window,"keydown",t[16]),O(window,"pointerdown",t[25]),O(window,"pointerup",t[26]),O(n,"touchstart",Pr(t[23]))],r=!0)},p(a,l){if(l[0]&286842){o=Te(Object.entries(a[3]));let c;for(c=0;c<o.length;c+=1){const m=pn(a,o,c);s[c]?s[c].p(m,l):(s[c]=mn(m),s[c].c(),s[c].m(n,null))}for(;c<s.length;c+=1)s[c].d(1);s.length=o.length}},i:J,o:J,d(a){a&&M(e),et(s,a),t[31](null),r=!1,be(i)}}}function Rs(t,e,n){let r,i,o,s,a,l,c,m,d=!1,u,h=new Map,{pianoControlsData:f}=e,{noteRange:p,sustain:y,noteShift:T,octaveShift:U,volume:L,labelType:C}=f;$(t,p,b=>n(22,c=b)),$(t,y,b=>n(32,o=b)),$(t,T,b=>n(5,l=b)),$(t,U,b=>n(4,a=b)),$(t,L,b=>n(33,s=b)),$(t,C,b=>n(6,m=b));let{midiPlayer:I}=e;I.onPlayNote=k,I.onStopNote=A;let{socketPlayer:H}=e;H.onPlayNote=({note:b,volume:E},W)=>{r[b]&&n(3,r[b].pressedColor=W.colorHue,r),W.playAudio(b,E)},H.onStopNote=({note:b,sustain:E},W)=>{r[b]&&n(3,r[b].pressedColor=null,r),E||W.stopAudio(b)};function w(b){const E=_t(b)+l+a*12;return Ye(E)}function k(b,E=.5){const W=w(b);h.has(W)&&A(b),h.set(W,!0),H.playNote(W,s*E),this!==I&&I.recordPlayNote(b,E)}function A(b){const E=w(b);h.has(E)&&(h.delete(E),H.stopNote(E,o),this!==I&&I.recordStopNote(b))}y.subscribe(b=>{if(!b)for(const E of H.localClient.audioNodeMap.keys())h.get(E)||H.stopNote(E,!1)});function P(){for(const b of h.keys())H.stopNote(b,o)}U.subscribe(P),T.subscribe(P);function Z(b){if(u){const E=u.clientHeight/6,W=u.offsetWidth/b;u.style.setProperty("--white-key-width",`${Math.min(W,E)}px`)}}function j(b){const E=ln[b.code],W=b.target;E&&W.tagName!=="INPUT"&&(b.preventDefault(),k(E))}function ce(b){const E=ln[b.code];E&&A(E)}function ue(b,E,W,se){switch(E){case"none":return"";case"notes":return vt(b);case"keybinds":const G=_t(b)-W-se*12;return Si[Ye(G)]??""}}function N(b){const[E,W,se]=b.data;E>=144&&E<=159?se==0?A(Ye(W)):k(Ye(W),se/127):E>=128&&E<=143&&A(Ye(W))}function Y(b){b.inputs.forEach(E=>{E.onmidimessage=N})}Hn(()=>{Z(i),navigator.requestMIDIAccess().then(b=>{Y(b),b.onstatechange=()=>{Y(b)}})});function K(b){Er.call(this,t,b)}const fe=()=>Z(i),ne=b=>{var E;b.button===0&&((E=b.target)==null?void 0:E.tagName)!=="SELECT"&&n(1,d=!0)},le=()=>n(1,d=!1),ve=(b,E)=>{E.currentTarget.releasePointerCapture(E.pointerId),k(b)},D=b=>{d&&k(b)},de=b=>{d&&A(b)},Se=b=>A(b);function pe(b){Mt[b?"unshift":"push"](()=>{u=b,n(2,u)})}return t.$$set=b=>{"pianoControlsData"in b&&n(21,f=b.pianoControlsData),"midiPlayer"in b&&n(19,I=b.midiPlayer),"socketPlayer"in b&&n(20,H=b.socketPlayer)},t.$$.update=()=>{t.$$.dirty[0]&4194304&&n(3,[r,i]=Ii(c[0],c[1]),r,(n(0,i),n(22,c))),t.$$.dirty[0]&1&&Z(i)},[i,d,u,r,a,l,m,p,y,T,U,L,C,k,A,Z,j,ce,ue,I,H,f,c,K,fe,ne,le,ve,D,de,Se,pe]}class Fs extends Ge{constructor(e){super(),We(this,e,Rs,Ms,Ue,{pianoControlsData:21,midiPlayer:19,socketPlayer:20},null,[-1,-1])}}function yn(t,e,n){const r=t.slice();return r[35]=e[n],r[37]=n,r}function Ds(t){let e,n,r,i,o;return{c(){e=v("button"),n=ae("Play"),e.disabled=r=t[3].length==0},m(s,a){R(s,e,a),g(e,n),i||(o=O(e,"click",t[21]),i=!0)},p(s,a){a[0]&8&&r!==(r=s[3].length==0)&&(e.disabled=r)},d(s){s&&M(e),i=!1,o()}}}function Ls(t){let e,n,r;return{c(){e=v("button"),e.textContent="Stop"},m(i,o){R(i,e,o),n||(r=O(e,"click",t[20]),n=!0)},p:J,d(i){i&&M(e),n=!1,r()}}}function gn(t){let e,n,r,i,o;return{c(){e=v("select"),n=v("option"),n.textContent="all tracks",r=v("option"),r.textContent="single track",n.__value=!1,z(n,n.__value),r.__value=!0,z(r,r.__value),t[5]===void 0&&xe(()=>t[23].call(e))},m(s,a){R(s,e,a),g(e,n),g(e,r),Pe(e,t[5],!0),i||(o=O(e,"change",t[23]),i=!0)},p(s,a){a[0]&32&&Pe(e,s[5])},d(s){s&&M(e),i=!1,o()}}}function bn(t){let e,n,r,i,o,s,a,l,c,m=Te(t[3]),d=[];for(let u=0;u<m.length;u+=1)d[u]=vn(yn(t,m,u));return{c(){e=v("select");for(let u=0;u<d.length;u+=1)d[u].c();n=x(),r=v("button"),i=ae("Add Track"),o=x(),s=v("button"),a=ae("Delete Track"),e.disabled=t[1],t[6]===void 0&&xe(()=>t[26].call(e)),r.disabled=t[1],s.disabled=t[1]},m(u,h){R(u,e,h);for(let f=0;f<d.length;f+=1)d[f]&&d[f].m(e,null);Pe(e,t[6],!0),R(u,n,h),R(u,r,h),g(r,i),R(u,o,h),R(u,s,h),g(s,a),l||(c=[O(e,"change",t[26]),O(r,"click",t[27]),O(s,"click",t[28])],l=!0)},p(u,h){if(h[0]&8){m=Te(u[3]);let f;for(f=0;f<m.length;f+=1){const p=yn(u,m,f);d[f]?d[f].p(p,h):(d[f]=vn(p),d[f].c(),d[f].m(e,null))}for(;f<d.length;f+=1)d[f].d(1);d.length=m.length}h[0]&2&&(e.disabled=u[1]),h[0]&64&&Pe(e,u[6]),h[0]&2&&(r.disabled=u[1]),h[0]&2&&(s.disabled=u[1])},d(u){u&&(M(e),M(n),M(r),M(o),M(s)),et(d,u),l=!1,be(c)}}}function vn(t){let e,n=(t[35].name||`[Track ${t[37]}]`)+"",r;return{c(){e=v("option"),r=ae(n),e.__value=t[37],z(e,e.__value)},m(i,o){R(i,e,o),g(e,r)},p(i,o){o[0]&8&&n!==(n=(i[35].name||`[Track ${i[37]}]`)+"")&&tt(r,n)},d(i){i&&M(e)}}}function qs(t){let e,n,r,i,o,s,a,l,c,m,d,u,h,f,p,y,T,U,L,C,I,H,w,k,A,P,Z,j,ce,ue,N,Y,K,fe,ne,le=t[4].toFixed(1)+"",ve,D,de=t[8].toFixed(1)+"",Se,pe,b,E;function W(S,V){return S[2]?Ls:Ds}let se=W(t),G=se(t),ee=t[3].length>0&&gn(t),q=t[3].length>0&&bn(t);return{c(){e=v("div"),n=v("p"),n.textContent="Play midi:",r=x(),i=v("div"),o=v("input"),s=x(),a=v("div"),G.c(),l=x(),c=v("button"),m=ae("Restart"),u=x(),ee&&ee.c(),h=x(),f=v("div"),p=v("button"),y=ae("Record"),T=x(),U=v("button"),L=ae("Save"),I=x(),q&&q.c(),H=x(),w=v("div"),k=v("span"),k.textContent="Speed",A=x(),P=v("input"),Z=x(),j=v("input"),ce=x(),ue=v("span"),ue.textContent="times",N=x(),Y=v("div"),K=v("input"),fe=x(),ne=v("span"),ve=ae(le),D=ae("/"),Se=ae(de),pe=ae(" seconds"),_(o,"type","file"),_(o,"accept",".midi,.mid"),o.disabled=t[2],_(i,"class","svelte-1owab3p"),c.disabled=d=t[3].length==0,_(a,"class","svelte-1owab3p"),p.disabled=t[2],U.disabled=C=t[3].length==0||t[2],_(f,"class","svelte-1owab3p"),_(k,"class","svelte-1owab3p"),_(P,"type","range"),_(P,"min","0.01"),_(P,"max","4"),_(P,"step","0.01"),_(P,"title","Double click to set speed to normal"),_(j,"type","number"),_(j,"min","0.01"),_(ue,"class","svelte-1owab3p"),Oe(w,"display","flex"),_(w,"class","svelte-1owab3p"),_(K,"type","range"),_(K,"min","0"),_(K,"max",t[8]),_(K,"step","0.1"),Oe(K,"width","18rem"),K.disabled=t[1],_(ne,"class","svelte-1owab3p"),Oe(Y,"display","flex"),_(Y,"class","svelte-1owab3p"),_(e,"class","svelte-1owab3p")},m(S,V){R(S,e,V),g(e,n),g(e,r),g(e,i),g(i,o),g(e,s),g(e,a),G.m(a,null),g(a,l),g(a,c),g(c,m),g(a,u),ee&&ee.m(a,null),g(e,h),g(e,f),g(f,p),g(p,y),g(f,T),g(f,U),g(U,L),g(f,I),q&&q.m(f,null),g(e,H),g(e,w),g(w,k),g(w,A),g(w,P),z(P,t[7]),g(w,Z),g(w,j),z(j,t[7]),g(w,ce),g(w,ue),g(e,N),g(e,Y),g(Y,K),z(K,t[4]),g(Y,fe),g(Y,ne),g(ne,ve),g(ne,D),g(ne,Se),g(ne,pe),b||(E=[O(o,"change",t[19]),O(c,"click",t[22]),O(p,"click",t[24]),O(U,"click",t[25]),O(P,"change",t[29]),O(P,"input",t[29]),O(P,"click",t[30]),O(j,"input",t[31]),O(K,"change",t[32]),O(K,"input",t[32]),O(K,"mousedown",t[33]),O(K,"mouseup",t[34])],b=!0)},p(S,V){V[0]&4&&(o.disabled=S[2]),se===(se=W(S))&&G?G.p(S,V):(G.d(1),G=se(S),G&&(G.c(),G.m(a,l))),V[0]&8&&d!==(d=S[3].length==0)&&(c.disabled=d),S[3].length>0?ee?ee.p(S,V):(ee=gn(S),ee.c(),ee.m(a,null)):ee&&(ee.d(1),ee=null),V[0]&4&&(p.disabled=S[2]),V[0]&12&&C!==(C=S[3].length==0||S[2])&&(U.disabled=C),S[3].length>0?q?q.p(S,V):(q=bn(S),q.c(),q.m(f,null)):q&&(q.d(1),q=null),V[0]&128&&z(P,S[7]),V[0]&128&&ge(j.value)!==S[7]&&z(j,S[7]),V[0]&256&&_(K,"max",S[8]),V[0]&2&&(K.disabled=S[1]),V[0]&16&&z(K,S[4]),V[0]&16&&le!==(le=S[4].toFixed(1)+"")&&tt(ve,le),V[0]&256&&de!==(de=S[8].toFixed(1)+"")&&tt(Se,de)},i:J,o:J,d(S){S&&M(e),G.d(),ee&&ee.d(),q&&q.d(),b=!1,be(E)}}}function Vs(t,e,n){let r,i,o,s,a,l,c,m,d,{midiPlayer:u}=e,{midiIsPlaying:h,midiIsRecording:f,midiCurrentTime:p,midiSpeed:y,midiTotalTime:T,selectedMidiTrack:U,midiTracks:L,midiPlaySolo:C}=u;$(t,h,D=>n(18,o=D)),$(t,f,D=>n(1,i=D)),$(t,p,D=>n(4,a=D)),$(t,y,D=>n(7,m=D)),$(t,T,D=>n(8,d=D)),$(t,U,D=>n(6,c=D)),$(t,L,D=>n(3,s=D)),$(t,C,D=>n(5,l=D));function I(){localStorage.getItem("hasRecordedBefore")||(alert("Play any key to start recording. Recording WILL override the selected track."),localStorage.setItem("hasRecordedBefore","true")),u.startRecording()}const H=D=>{var de;return u.setFile((de=D.currentTarget.files)==null?void 0:de[0])},w=()=>u.stopAndReseek(),k=()=>u.startPlaying(),A=()=>{oe(p,a=0,a),u.stop(),u.lastStartFunc()};function P(){l=gt(this),C.set(l)}const Z=()=>I(),j=()=>u.saveFile();function ce(){c=gt(this),U.set(c)}const ue=()=>u.addTrack(),N=()=>u.deleteTrack();function Y(){m=ge(this.value),y.set(m)}const K=D=>{D.detail==2&&oe(y,m=1,m)};function fe(){m=ge(this.value),y.set(m)}function ne(){a=ge(this.value),p.set(a)}const le=()=>u.stop(),ve=()=>u.lastStartFunc();return t.$$set=D=>{"midiPlayer"in D&&n(0,u=D.midiPlayer)},t.$$.update=()=>{t.$$.dirty[0]&262146&&n(2,r=o||i)},[u,i,r,s,a,l,c,m,d,h,f,p,y,T,U,L,C,I,o,H,w,k,A,P,Z,j,ce,ue,N,Y,K,fe,ne,le,ve]}class Hs extends Ge{constructor(e){super(),We(this,e,Vs,qs,Ue,{midiPlayer:0},null,[-1,-1])}}const js=["accordion","acoustic_bass","acoustic_grand_piano","acoustic_guitar_nylon","acoustic_guitar_steel","agogo","alto_sax","applause","bagpipe","banjo","baritone_sax","bassoon","bird_tweet","blown_bottle","brass_section","breath_noise","bright_acoustic_piano","celesta","cello","choir_aahs","church_organ","clarinet","clavinet","contrabass","distortion_guitar","drawbar_organ","dulcimer","electric_bass_finger","electric_bass_pick","electric_grand_piano","electric_guitar_clean","electric_guitar_jazz","electric_guitar_muted","electric_piano_1","electric_piano_2","english_horn","fiddle","flute","french_horn","fretless_bass","fx_1_rain","fx_2_soundtrack","fx_3_crystal","fx_4_atmosphere","fx_5_brightness","fx_6_goblins","fx_7_echoes","fx_8_scifi","glockenspiel","guitar_fret_noise","guitar_harmonics","gunshot","harmonica","harpsichord","helicopter","honkytonk_piano","kalimba","koto","lead_1_square","lead_2_sawtooth","lead_3_calliope","lead_4_chiff","lead_5_charang","lead_6_voice","lead_7_fifths","lead_8_bass__lead","marimba","melodic_tom","music_box","muted_trumpet","oboe","ocarina","orchestra_hit","orchestral_harp","overdriven_guitar","pad_1_new_age","pad_2_warm","pad_3_polysynth","pad_4_choir","pad_5_bowed","pad_6_metallic","pad_7_halo","pad_8_sweep","pan_flute","percussive_organ","piccolo","pizzicato_strings","recorder","reed_organ","reverse_cymbal","rock_organ","seashore","shakuhachi","shamisen","shanai","sitar","slap_bass_1","slap_bass_2","soprano_sax","steel_drums","string_ensemble_1","string_ensemble_2","synth_bass_1","synth_bass_2","synth_brass_1","synth_brass_2","synth_choir","synth_drum","synth_strings_1","synth_strings_2","taiko_drum","tango_accordion","telephone_ring","tenor_sax","timpani","tinkle_bell","tremolo_strings","trombone","trumpet","tuba","tubular_bells","vibraphone","viola","violin","voice_oohs","whistle","woodblock","xylophone"],ar=""+new URL("spinner-2868f450.svg",import.meta.url).href;function _n(t,e,n){const r=t.slice();return r[28]=e[n],r}function Ks(t,e,n){const r=t.slice();return r[31]=e[n],r}function Js(t){let e;return{c(){e=v("option"),e.textContent=`${or(t[31])}`,e.__value=t[31],z(e,e.__value)},m(n,r){R(n,e,r)},p:J,d(n){n&&M(e)}}}function zs(t){return{c:J,m:J,d:J}}function Ws(t){return{c:J,m:J,d:J}}function Gs(t){let e,n;return{c(){e=v("img"),Dn(e.src,n=ar)||_(e,"src",n),_(e,"alt","spinner")},m(r,i){R(r,e,i)},d(r){r&&M(e)}}}function kn(t){let e,n=or(t[28])+"",r;return{c(){e=v("option"),r=ae(n),e.__value=t[28],z(e,e.__value)},m(i,o){R(i,e,o),g(e,r)},p:J,d(i){i&&M(e)}}}function $s(t){let e,n,r,i,o,s,a,l,c,m,d,u,h,f,p,y,T,U,L,C,I,H,w,k,A,P,Z,j,ce,ue,N,Y,K,fe,ne,le,ve,D,de,Se,pe,b,E,W=Te(js),se=[];for(let S=0;S<W.length;S+=1)se[S]=Js(Ks(t,W,S));let G={ctx:t,current:null,token:null,hasCatch:!1,pending:Gs,then:Ws,catch:zs};on(P=t[1],G);let ee=Te(wn),q=[];for(let S=0;S<ee.length;S+=1)q[S]=kn(_n(t,ee,S));return{c(){e=v("div"),n=v("div"),r=v("span"),r.textContent="Sustain",i=x(),o=v("input"),s=x(),a=v("div"),l=v("span"),l.textContent="Tranpose",c=x(),m=v("input"),d=x(),u=v("input"),h=x(),f=v("div"),p=v("span"),p.textContent="Volume",y=x(),T=v("input"),U=x(),L=v("input"),C=x(),I=v("div"),H=v("span"),H.textContent="Instrument",w=x(),k=v("select");for(let S=0;S<se.length;S+=1)se[S].c();A=x(),G.block.c(),Z=x(),j=v("div"),ce=v("span"),ce.textContent="Size",ue=x(),N=v("select"),Y=v("option"),Y.textContent="Full size (88 keys)",K=v("option"),K.textContent="Half size (61 keys)",fe=v("option"),fe.textContent="Quater Size (37 keys)",ne=v("option"),ne.textContent="2 Octaves (24 keys)",le=v("option"),le.textContent="1 Octave (12 keys)",ve=x(),D=v("div"),de=v("span"),de.textContent="Labels",Se=x(),pe=v("select");for(let S=0;S<q.length;S+=1)q[S].c();_(r,"class","svelte-1ue5508"),_(o,"type","checkbox"),_(n,"title","Shortcut: space"),_(n,"class","svelte-1ue5508"),_(l,"title","Double click to reset"),_(l,"class","svelte-1ue5508"),_(m,"title","Note shift (shortcut: left ctrl + left alt)"),_(m,"type","number"),_(u,"title","Octave shift (shortcut: right alt + right ctrl)"),_(u,"type","number"),_(a,"class","svelte-1ue5508"),_(p,"class","svelte-1ue5508"),_(T,"type","range"),_(T,"min","0"),_(T,"max","10"),_(T,"step","0.1"),Oe(T,"width","8rem"),_(L,"type","number"),_(f,"class","svelte-1ue5508"),_(H,"class","svelte-1ue5508"),t[0]===void 0&&xe(()=>t[24].call(k)),_(I,"class","svelte-1ue5508"),_(ce,"class","svelte-1ue5508"),_(Y,"data-range","A0,C8"),Y.__value="Full size (88 keys)",z(Y,Y.__value),_(K,"data-range","C2,C7"),K.selected=!0,K.__value="Half size (61 keys)",z(K,K.__value),_(fe,"data-range","C3,C6"),fe.__value="Quater Size (37 keys)",z(fe,fe.__value),_(ne,"data-range","C4,B5"),ne.__value="2 Octaves (24 keys)",z(ne,ne.__value),_(le,"data-range","C4,B4"),le.__value="1 Octave (12 keys)",z(le,le.__value),_(j,"class","svelte-1ue5508"),_(de,"class","svelte-1ue5508"),t[6]===void 0&&xe(()=>t[26].call(pe)),_(D,"class","svelte-1ue5508"),_(e,"class","option-list svelte-1ue5508")},m(S,V){R(S,e,V),g(e,n),g(n,r),g(n,i),g(n,o),o.checked=t[2],g(e,s),g(e,a),g(a,l),g(a,c),g(a,m),z(m,t[4]),g(a,d),g(a,u),z(u,t[3]),g(e,h),g(e,f),g(f,p),g(f,y),g(f,T),z(T,t[5]),g(f,U),g(f,L),z(L,t[5]),g(e,C),g(e,I),g(I,H),g(I,w),g(I,k);for(let X=0;X<se.length;X+=1)se[X]&&se[X].m(k,null);Pe(k,t[0],!0),g(I,A),G.block.m(I,G.anchor=null),G.mount=()=>I,G.anchor=null,g(e,Z),g(e,j),g(j,ce),g(j,ue),g(j,N),g(N,Y),g(N,K),g(N,fe),g(N,ne),g(N,le),g(e,ve),g(e,D),g(D,de),g(D,Se),g(D,pe);for(let X=0;X<q.length;X+=1)q[X]&&q[X].m(pe,null);Pe(pe,t[6],!0),b||(E=[O(window,"keydown",t[14]),O(window,"keyup",t[15]),O(o,"change",t[18]),O(l,"click",t[19]),O(m,"input",t[20]),O(u,"input",t[21]),O(T,"change",t[22]),O(T,"input",t[22]),O(L,"input",t[23]),O(k,"change",t[24]),O(N,"change",t[25]),Ir(t[13].call(null,N)),O(pe,"change",t[26])],b=!0)},p(S,V){if(t=S,V[0]&4&&(o.checked=t[2]),V[0]&16&&ge(m.value)!==t[4]&&z(m,t[4]),V[0]&8&&ge(u.value)!==t[3]&&z(u,t[3]),V[0]&32&&z(T,t[5]),V[0]&32&&ge(L.value)!==t[5]&&z(L,t[5]),V[0]&1&&Pe(k,t[0]),G.ctx=t,V[0]&2&&P!==(P=t[1])&&on(P,G),V&0){ee=Te(wn);let X;for(X=0;X<ee.length;X+=1){const tn=_n(t,ee,X);q[X]?q[X].p(tn,V):(q[X]=kn(tn),q[X].c(),q[X].m(pe,null))}for(;X<q.length;X+=1)q[X].d(1);q.length=ee.length}V[0]&64&&Pe(pe,t[6])},i:J,o:J,d(S){S&&M(e),et(se,S),G.block.d(),G.token=null,G=null,et(q,S),b=!1,be(E)}}}const wn=["none","notes","keybinds"];class Ys{constructor(){B(this,"octaveShift",ie(0));B(this,"noteShift",ie(0));B(this,"sustain",ie(!1));B(this,"volume",ie(5));B(this,"noteRange",ie(["C2","C7"]));B(this,"labelType",ie("keybinds"))}}function Xs(t,e,n){let r,i,o,s,a,l,c,{pianoControlsData:m}=e,{socketPlayer:d}=e,u="acoustic_grand_piano",{noteRange:h,sustain:f,noteShift:p,octaveShift:y,volume:T,labelType:U}=m;$(t,h,N=>n(27,a=N)),$(t,f,N=>n(2,i=N)),$(t,p,N=>n(4,s=N)),$(t,y,N=>n(3,o=N)),$(t,T,N=>n(5,l=N)),$(t,U,N=>n(6,c=N));function L(N){const Y=N.children[N.selectedIndex];oe(h,a=Y.dataset.range.split(","),a)}function C(N){if(N.target.tagName!=="INPUT")switch(N.code){case"Space":oe(f,i=!0,i);break;case"ControlLeft":oe(p,s-=1,s);break;case"AltLeft":oe(p,s+=1,s);break;case"AltRight":oe(y,o-=1,o);break;case"ControlRight":oe(y,o+=1,o);break}}p.subscribe(()=>{s>=12?(oe(y,o+=1,o),oe(p,s=0,s)):s<=-12&&(oe(y,o-=1,o),oe(p,s=0,s))}),y.subscribe(()=>{o<-3?oe(y,o=3,o):o>3&&oe(y,o=-3,o)});function I(N){N.code==="Space"&&oe(f,i=!1,i)}function H(){i=this.checked,f.set(i)}const w=N=>{N.detail==2&&(oe(p,s=0,s),oe(y,o=0,o))};function k(){s=ge(this.value),p.set(s)}function A(){o=ge(this.value),y.set(o)}function P(){l=ge(this.value),T.set(l)}function Z(){l=ge(this.value),T.set(l)}function j(){u=gt(this),n(0,u)}const ce=N=>L(N.currentTarget);function ue(){c=gt(this),U.set(c)}return t.$$set=N=>{"pianoControlsData"in N&&n(16,m=N.pianoControlsData),"socketPlayer"in N&&n(17,d=N.socketPlayer)},t.$$.update=()=>{t.$$.dirty[0]&131073&&n(1,r=d.changeInstrument(u))},[u,r,i,o,s,l,c,h,f,p,y,T,U,L,C,I,m,d,H,w,k,A,P,Z,j,ce,ue]}class Qs extends Ge{constructor(e){super(),We(this,e,Xs,$s,Ue,{pianoControlsData:16,socketPlayer:17},null,[-1,-1])}}const ke=Object.create(null);ke.open="0";ke.close="1";ke.ping="2";ke.pong="3";ke.message="4";ke.upgrade="5";ke.noop="6";const pt=Object.create(null);Object.keys(ke).forEach(t=>{pt[ke[t]]=t});const Lt={type:"error",data:"parser error"},cr=typeof Blob=="function"||typeof Blob<"u"&&Object.prototype.toString.call(Blob)==="[object BlobConstructor]",lr=typeof ArrayBuffer=="function",ur=t=>typeof ArrayBuffer.isView=="function"?ArrayBuffer.isView(t):t&&t.buffer instanceof ArrayBuffer,$t=({type:t,data:e},n,r)=>cr&&e instanceof Blob?n?r(e):Tn(e,r):lr&&(e instanceof ArrayBuffer||ur(e))?n?r(e):Tn(new Blob([e]),r):r(ke[t]+(e||"")),Tn=(t,e)=>{const n=new FileReader;return n.onload=function(){const r=n.result.split(",")[1];e("b"+(r||""))},n.readAsDataURL(t)};function Cn(t){return t instanceof Uint8Array?t:t instanceof ArrayBuffer?new Uint8Array(t):new Uint8Array(t.buffer,t.byteOffset,t.byteLength)}let Bt;function Zs(t,e){if(cr&&t.data instanceof Blob)return t.data.arrayBuffer().then(Cn).then(e);if(lr&&(t.data instanceof ArrayBuffer||ur(t.data)))return e(Cn(t.data));$t(t,!1,n=>{Bt||(Bt=new TextEncoder),e(Bt.encode(n))})}const Sn="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",Qe=typeof Uint8Array>"u"?[]:new Uint8Array(256);for(let t=0;t<Sn.length;t++)Qe[Sn.charCodeAt(t)]=t;const eo=t=>{let e=t.length*.75,n=t.length,r,i=0,o,s,a,l;t[t.length-1]==="="&&(e--,t[t.length-2]==="="&&e--);const c=new ArrayBuffer(e),m=new Uint8Array(c);for(r=0;r<n;r+=4)o=Qe[t.charCodeAt(r)],s=Qe[t.charCodeAt(r+1)],a=Qe[t.charCodeAt(r+2)],l=Qe[t.charCodeAt(r+3)],m[i++]=o<<2|s>>4,m[i++]=(s&15)<<4|a>>2,m[i++]=(a&3)<<6|l&63;return c},to=typeof ArrayBuffer=="function",Yt=(t,e)=>{if(typeof t!="string")return{type:"message",data:hr(t,e)};const n=t.charAt(0);return n==="b"?{type:"message",data:no(t.substring(1),e)}:pt[n]?t.length>1?{type:pt[n],data:t.substring(1)}:{type:pt[n]}:Lt},no=(t,e)=>{if(to){const n=eo(t);return hr(n,e)}else return{base64:!0,data:t}},hr=(t,e)=>{switch(e){case"blob":return t instanceof Blob?t:new Blob([t]);case"arraybuffer":default:return t instanceof ArrayBuffer?t:t.buffer}},fr=String.fromCharCode(30),ro=(t,e)=>{const n=t.length,r=new Array(n);let i=0;t.forEach((o,s)=>{$t(o,!1,a=>{r[s]=a,++i===n&&e(r.join(fr))})})},io=(t,e)=>{const n=t.split(fr),r=[];for(let i=0;i<n.length;i++){const o=Yt(n[i],e);if(r.push(o),o.type==="error")break}return r};function so(){return new TransformStream({transform(t,e){Zs(t,n=>{const r=n.length;let i;if(r<126)i=new Uint8Array(1),new DataView(i.buffer).setUint8(0,r);else if(r<65536){i=new Uint8Array(3);const o=new DataView(i.buffer);o.setUint8(0,126),o.setUint16(1,r)}else{i=new Uint8Array(9);const o=new DataView(i.buffer);o.setUint8(0,127),o.setBigUint64(1,BigInt(r))}t.data&&typeof t.data!="string"&&(i[0]|=128),e.enqueue(i),e.enqueue(n)})}})}let Ut;function lt(t){return t.reduce((e,n)=>e+n.length,0)}function ut(t,e){if(t[0].length===e)return t.shift();const n=new Uint8Array(e);let r=0;for(let i=0;i<e;i++)n[i]=t[0][r++],r===t[0].length&&(t.shift(),r=0);return t.length&&r<t[0].length&&(t[0]=t[0].slice(r)),n}function oo(t,e){Ut||(Ut=new TextDecoder);const n=[];let r=0,i=-1,o=!1;return new TransformStream({transform(s,a){for(n.push(s);;){if(r===0){if(lt(n)<1)break;const l=ut(n,1);o=(l[0]&128)===128,i=l[0]&127,i<126?r=3:i===126?r=1:r=2}else if(r===1){if(lt(n)<2)break;const l=ut(n,2);i=new DataView(l.buffer,l.byteOffset,l.length).getUint16(0),r=3}else if(r===2){if(lt(n)<8)break;const l=ut(n,8),c=new DataView(l.buffer,l.byteOffset,l.length),m=c.getUint32(0);if(m>Math.pow(2,53-32)-1){a.enqueue(Lt);break}i=m*Math.pow(2,32)+c.getUint32(4),r=3}else{if(lt(n)<i)break;const l=ut(n,i);a.enqueue(Yt(o?l:Ut.decode(l),e)),r=0}if(i===0||i>t){a.enqueue(Lt);break}}}})}const dr=4;function te(t){if(t)return ao(t)}function ao(t){for(var e in te.prototype)t[e]=te.prototype[e];return t}te.prototype.on=te.prototype.addEventListener=function(t,e){return this._callbacks=this._callbacks||{},(this._callbacks["$"+t]=this._callbacks["$"+t]||[]).push(e),this};te.prototype.once=function(t,e){function n(){this.off(t,n),e.apply(this,arguments)}return n.fn=e,this.on(t,n),this};te.prototype.off=te.prototype.removeListener=te.prototype.removeAllListeners=te.prototype.removeEventListener=function(t,e){if(this._callbacks=this._callbacks||{},arguments.length==0)return this._callbacks={},this;var n=this._callbacks["$"+t];if(!n)return this;if(arguments.length==1)return delete this._callbacks["$"+t],this;for(var r,i=0;i<n.length;i++)if(r=n[i],r===e||r.fn===e){n.splice(i,1);break}return n.length===0&&delete this._callbacks["$"+t],this};te.prototype.emit=function(t){this._callbacks=this._callbacks||{};for(var e=new Array(arguments.length-1),n=this._callbacks["$"+t],r=1;r<arguments.length;r++)e[r-1]=arguments[r];if(n){n=n.slice(0);for(var r=0,i=n.length;r<i;++r)n[r].apply(this,e)}return this};te.prototype.emitReserved=te.prototype.emit;te.prototype.listeners=function(t){return this._callbacks=this._callbacks||{},this._callbacks["$"+t]||[]};te.prototype.hasListeners=function(t){return!!this.listeners(t).length};const me=(()=>typeof self<"u"?self:typeof window<"u"?window:Function("return this")())();function pr(t,...e){return e.reduce((n,r)=>(t.hasOwnProperty(r)&&(n[r]=t[r]),n),{})}const co=me.setTimeout,lo=me.clearTimeout;function Pt(t,e){e.useNativeTimers?(t.setTimeoutFn=co.bind(me),t.clearTimeoutFn=lo.bind(me)):(t.setTimeoutFn=me.setTimeout.bind(me),t.clearTimeoutFn=me.clearTimeout.bind(me))}const uo=1.33;function ho(t){return typeof t=="string"?fo(t):Math.ceil((t.byteLength||t.size)*uo)}function fo(t){let e=0,n=0;for(let r=0,i=t.length;r<i;r++)e=t.charCodeAt(r),e<128?n+=1:e<2048?n+=2:e<55296||e>=57344?n+=3:(r++,n+=4);return n}function po(t){let e="";for(let n in t)t.hasOwnProperty(n)&&(e.length&&(e+="&"),e+=encodeURIComponent(n)+"="+encodeURIComponent(t[n]));return e}function mo(t){let e={},n=t.split("&");for(let r=0,i=n.length;r<i;r++){let o=n[r].split("=");e[decodeURIComponent(o[0])]=decodeURIComponent(o[1])}return e}class yo extends Error{constructor(e,n,r){super(e),this.description=n,this.context=r,this.type="TransportError"}}class Xt extends te{constructor(e){super(),this.writable=!1,Pt(this,e),this.opts=e,this.query=e.query,this.socket=e.socket}onError(e,n,r){return super.emitReserved("error",new yo(e,n,r)),this}open(){return this.readyState="opening",this.doOpen(),this}close(){return(this.readyState==="opening"||this.readyState==="open")&&(this.doClose(),this.onClose()),this}send(e){this.readyState==="open"&&this.write(e)}onOpen(){this.readyState="open",this.writable=!0,super.emitReserved("open")}onData(e){const n=Yt(e,this.socket.binaryType);this.onPacket(n)}onPacket(e){super.emitReserved("packet",e)}onClose(e){this.readyState="closed",super.emitReserved("close",e)}pause(e){}createUri(e,n={}){return e+"://"+this._hostname()+this._port()+this.opts.path+this._query(n)}_hostname(){const e=this.opts.hostname;return e.indexOf(":")===-1?e:"["+e+"]"}_port(){return this.opts.port&&(this.opts.secure&&+(this.opts.port!==443)||!this.opts.secure&&Number(this.opts.port)!==80)?":"+this.opts.port:""}_query(e){const n=po(e);return n.length?"?"+n:""}}const mr="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz-_".split(""),qt=64,go={};let In=0,ht=0,Pn;function Nn(t){let e="";do e=mr[t%qt]+e,t=Math.floor(t/qt);while(t>0);return e}function yr(){const t=Nn(+new Date);return t!==Pn?(In=0,Pn=t):t+"."+Nn(In++)}for(;ht<qt;ht++)go[mr[ht]]=ht;let gr=!1;try{gr=typeof XMLHttpRequest<"u"&&"withCredentials"in new XMLHttpRequest}catch{}const bo=gr;function br(t){const e=t.xdomain;try{if(typeof XMLHttpRequest<"u"&&(!e||bo))return new XMLHttpRequest}catch{}if(!e)try{return new me[["Active"].concat("Object").join("X")]("Microsoft.XMLHTTP")}catch{}}function vo(){}const _o=function(){return new br({xdomain:!1}).responseType!=null}();class ko extends Xt{constructor(e){if(super(e),this.polling=!1,typeof location<"u"){const r=location.protocol==="https:";let i=location.port;i||(i=r?"443":"80"),this.xd=typeof location<"u"&&e.hostname!==location.hostname||i!==e.port}const n=e&&e.forceBase64;this.supportsBinary=_o&&!n,this.opts.withCredentials&&(this.cookieJar=void 0)}get name(){return"polling"}doOpen(){this.poll()}pause(e){this.readyState="pausing";const n=()=>{this.readyState="paused",e()};if(this.polling||!this.writable){let r=0;this.polling&&(r++,this.once("pollComplete",function(){--r||n()})),this.writable||(r++,this.once("drain",function(){--r||n()}))}else n()}poll(){this.polling=!0,this.doPoll(),this.emitReserved("poll")}onData(e){const n=r=>{if(this.readyState==="opening"&&r.type==="open"&&this.onOpen(),r.type==="close")return this.onClose({description:"transport closed by the server"}),!1;this.onPacket(r)};io(e,this.socket.binaryType).forEach(n),this.readyState!=="closed"&&(this.polling=!1,this.emitReserved("pollComplete"),this.readyState==="open"&&this.poll())}doClose(){const e=()=>{this.write([{type:"close"}])};this.readyState==="open"?e():this.once("open",e)}write(e){this.writable=!1,ro(e,n=>{this.doWrite(n,()=>{this.writable=!0,this.emitReserved("drain")})})}uri(){const e=this.opts.secure?"https":"http",n=this.query||{};return this.opts.timestampRequests!==!1&&(n[this.opts.timestampParam]=yr()),!this.supportsBinary&&!n.sid&&(n.b64=1),this.createUri(e,n)}request(e={}){return Object.assign(e,{xd:this.xd,cookieJar:this.cookieJar},this.opts),new _e(this.uri(),e)}doWrite(e,n){const r=this.request({method:"POST",data:e});r.on("success",n),r.on("error",(i,o)=>{this.onError("xhr post error",i,o)})}doPoll(){const e=this.request();e.on("data",this.onData.bind(this)),e.on("error",(n,r)=>{this.onError("xhr poll error",n,r)}),this.pollXhr=e}}class _e extends te{constructor(e,n){super(),Pt(this,n),this.opts=n,this.method=n.method||"GET",this.uri=e,this.data=n.data!==void 0?n.data:null,this.create()}create(){var e;const n=pr(this.opts,"agent","pfx","key","passphrase","cert","ca","ciphers","rejectUnauthorized","autoUnref");n.xdomain=!!this.opts.xd;const r=this.xhr=new br(n);try{r.open(this.method,this.uri,!0);try{if(this.opts.extraHeaders){r.setDisableHeaderCheck&&r.setDisableHeaderCheck(!0);for(let i in this.opts.extraHeaders)this.opts.extraHeaders.hasOwnProperty(i)&&r.setRequestHeader(i,this.opts.extraHeaders[i])}}catch{}if(this.method==="POST")try{r.setRequestHeader("Content-type","text/plain;charset=UTF-8")}catch{}try{r.setRequestHeader("Accept","*/*")}catch{}(e=this.opts.cookieJar)===null||e===void 0||e.addCookies(r),"withCredentials"in r&&(r.withCredentials=this.opts.withCredentials),this.opts.requestTimeout&&(r.timeout=this.opts.requestTimeout),r.onreadystatechange=()=>{var i;r.readyState===3&&((i=this.opts.cookieJar)===null||i===void 0||i.parseCookies(r)),r.readyState===4&&(r.status===200||r.status===1223?this.onLoad():this.setTimeoutFn(()=>{this.onError(typeof r.status=="number"?r.status:0)},0))},r.send(this.data)}catch(i){this.setTimeoutFn(()=>{this.onError(i)},0);return}typeof document<"u"&&(this.index=_e.requestsCount++,_e.requests[this.index]=this)}onError(e){this.emitReserved("error",e,this.xhr),this.cleanup(!0)}cleanup(e){if(!(typeof this.xhr>"u"||this.xhr===null)){if(this.xhr.onreadystatechange=vo,e)try{this.xhr.abort()}catch{}typeof document<"u"&&delete _e.requests[this.index],this.xhr=null}}onLoad(){const e=this.xhr.responseText;e!==null&&(this.emitReserved("data",e),this.emitReserved("success"),this.cleanup())}abort(){this.cleanup()}}_e.requestsCount=0;_e.requests={};if(typeof document<"u"){if(typeof attachEvent=="function")attachEvent("onunload",En);else if(typeof addEventListener=="function"){const t="onpagehide"in me?"pagehide":"unload";addEventListener(t,En,!1)}}function En(){for(let t in _e.requests)_e.requests.hasOwnProperty(t)&&_e.requests[t].abort()}const Qt=(()=>typeof Promise=="function"&&typeof Promise.resolve=="function"?e=>Promise.resolve().then(e):(e,n)=>n(e,0))(),ft=me.WebSocket||me.MozWebSocket,On=!0,wo="arraybuffer",An=typeof navigator<"u"&&typeof navigator.product=="string"&&navigator.product.toLowerCase()==="reactnative";class To extends Xt{constructor(e){super(e),this.supportsBinary=!e.forceBase64}get name(){return"websocket"}doOpen(){if(!this.check())return;const e=this.uri(),n=this.opts.protocols,r=An?{}:pr(this.opts,"agent","perMessageDeflate","pfx","key","passphrase","cert","ca","ciphers","rejectUnauthorized","localAddress","protocolVersion","origin","maxPayload","family","checkServerIdentity");this.opts.extraHeaders&&(r.headers=this.opts.extraHeaders);try{this.ws=On&&!An?n?new ft(e,n):new ft(e):new ft(e,n,r)}catch(i){return this.emitReserved("error",i)}this.ws.binaryType=this.socket.binaryType,this.addEventListeners()}addEventListeners(){this.ws.onopen=()=>{this.opts.autoUnref&&this.ws._socket.unref(),this.onOpen()},this.ws.onclose=e=>this.onClose({description:"websocket connection closed",context:e}),this.ws.onmessage=e=>this.onData(e.data),this.ws.onerror=e=>this.onError("websocket error",e)}write(e){this.writable=!1;for(let n=0;n<e.length;n++){const r=e[n],i=n===e.length-1;$t(r,this.supportsBinary,o=>{const s={};try{On&&this.ws.send(o)}catch{}i&&Qt(()=>{this.writable=!0,this.emitReserved("drain")},this.setTimeoutFn)})}}doClose(){typeof this.ws<"u"&&(this.ws.close(),this.ws=null)}uri(){const e=this.opts.secure?"wss":"ws",n=this.query||{};return this.opts.timestampRequests&&(n[this.opts.timestampParam]=yr()),this.supportsBinary||(n.b64=1),this.createUri(e,n)}check(){return!!ft}}class Co extends Xt{get name(){return"webtransport"}doOpen(){typeof WebTransport=="function"&&(this.transport=new WebTransport(this.createUri("https"),this.opts.transportOptions[this.name]),this.transport.closed.then(()=>{this.onClose()}).catch(e=>{this.onError("webtransport error",e)}),this.transport.ready.then(()=>{this.transport.createBidirectionalStream().then(e=>{const n=oo(Number.MAX_SAFE_INTEGER,this.socket.binaryType),r=e.readable.pipeThrough(n).getReader(),i=so();i.readable.pipeTo(e.writable),this.writer=i.writable.getWriter();const o=()=>{r.read().then(({done:a,value:l})=>{a||(this.onPacket(l),o())}).catch(a=>{})};o();const s={type:"open"};this.query.sid&&(s.data=`{"sid":"${this.query.sid}"}`),this.writer.write(s).then(()=>this.onOpen())})}))}write(e){this.writable=!1;for(let n=0;n<e.length;n++){const r=e[n],i=n===e.length-1;this.writer.write(r).then(()=>{i&&Qt(()=>{this.writable=!0,this.emitReserved("drain")},this.setTimeoutFn)})}}doClose(){var e;(e=this.transport)===null||e===void 0||e.close()}}const So={websocket:To,webtransport:Co,polling:ko},Io=/^(?:(?![^:@\/?#]+:[^:@\/]*@)(http|https|ws|wss):\/\/)?((?:(([^:@\/?#]*)(?::([^:@\/?#]*))?)?@)?((?:[a-f0-9]{0,4}:){2,7}[a-f0-9]{0,4}|[^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/,Po=["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"];function Vt(t){const e=t,n=t.indexOf("["),r=t.indexOf("]");n!=-1&&r!=-1&&(t=t.substring(0,n)+t.substring(n,r).replace(/:/g,";")+t.substring(r,t.length));let i=Io.exec(t||""),o={},s=14;for(;s--;)o[Po[s]]=i[s]||"";return n!=-1&&r!=-1&&(o.source=e,o.host=o.host.substring(1,o.host.length-1).replace(/;/g,":"),o.authority=o.authority.replace("[","").replace("]","").replace(/;/g,":"),o.ipv6uri=!0),o.pathNames=No(o,o.path),o.queryKey=Eo(o,o.query),o}function No(t,e){const n=/\/{2,9}/g,r=e.replace(n,"/").split("/");return(e.slice(0,1)=="/"||e.length===0)&&r.splice(0,1),e.slice(-1)=="/"&&r.splice(r.length-1,1),r}function Eo(t,e){const n={};return e.replace(/(?:^|&)([^&=]*)=?([^&]*)/g,function(r,i,o){i&&(n[i]=o)}),n}let vr=class qe extends te{constructor(e,n={}){super(),this.binaryType=wo,this.writeBuffer=[],e&&typeof e=="object"&&(n=e,e=null),e?(e=Vt(e),n.hostname=e.host,n.secure=e.protocol==="https"||e.protocol==="wss",n.port=e.port,e.query&&(n.query=e.query)):n.host&&(n.hostname=Vt(n.host).host),Pt(this,n),this.secure=n.secure!=null?n.secure:typeof location<"u"&&location.protocol==="https:",n.hostname&&!n.port&&(n.port=this.secure?"443":"80"),this.hostname=n.hostname||(typeof location<"u"?location.hostname:"localhost"),this.port=n.port||(typeof location<"u"&&location.port?location.port:this.secure?"443":"80"),this.transports=n.transports||["polling","websocket","webtransport"],this.writeBuffer=[],this.prevBufferLen=0,this.opts=Object.assign({path:"/engine.io",agent:!1,withCredentials:!1,upgrade:!0,timestampParam:"t",rememberUpgrade:!1,addTrailingSlash:!0,rejectUnauthorized:!0,perMessageDeflate:{threshold:1024},transportOptions:{},closeOnBeforeunload:!1},n),this.opts.path=this.opts.path.replace(/\/$/,"")+(this.opts.addTrailingSlash?"/":""),typeof this.opts.query=="string"&&(this.opts.query=mo(this.opts.query)),this.id=null,this.upgrades=null,this.pingInterval=null,this.pingTimeout=null,this.pingTimeoutTimer=null,typeof addEventListener=="function"&&(this.opts.closeOnBeforeunload&&(this.beforeunloadEventListener=()=>{this.transport&&(this.transport.removeAllListeners(),this.transport.close())},addEventListener("beforeunload",this.beforeunloadEventListener,!1)),this.hostname!=="localhost"&&(this.offlineEventListener=()=>{this.onClose("transport close",{description:"network connection lost"})},addEventListener("offline",this.offlineEventListener,!1))),this.open()}createTransport(e){const n=Object.assign({},this.opts.query);n.EIO=dr,n.transport=e,this.id&&(n.sid=this.id);const r=Object.assign({},this.opts,{query:n,socket:this,hostname:this.hostname,secure:this.secure,port:this.port},this.opts.transportOptions[e]);return new So[e](r)}open(){let e;if(this.opts.rememberUpgrade&&qe.priorWebsocketSuccess&&this.transports.indexOf("websocket")!==-1)e="websocket";else if(this.transports.length===0){this.setTimeoutFn(()=>{this.emitReserved("error","No transports available")},0);return}else e=this.transports[0];this.readyState="opening";try{e=this.createTransport(e)}catch{this.transports.shift(),this.open();return}e.open(),this.setTransport(e)}setTransport(e){this.transport&&this.transport.removeAllListeners(),this.transport=e,e.on("drain",this.onDrain.bind(this)).on("packet",this.onPacket.bind(this)).on("error",this.onError.bind(this)).on("close",n=>this.onClose("transport close",n))}probe(e){let n=this.createTransport(e),r=!1;qe.priorWebsocketSuccess=!1;const i=()=>{r||(n.send([{type:"ping",data:"probe"}]),n.once("packet",d=>{if(!r)if(d.type==="pong"&&d.data==="probe"){if(this.upgrading=!0,this.emitReserved("upgrading",n),!n)return;qe.priorWebsocketSuccess=n.name==="websocket",this.transport.pause(()=>{r||this.readyState!=="closed"&&(m(),this.setTransport(n),n.send([{type:"upgrade"}]),this.emitReserved("upgrade",n),n=null,this.upgrading=!1,this.flush())})}else{const u=new Error("probe error");u.transport=n.name,this.emitReserved("upgradeError",u)}}))};function o(){r||(r=!0,m(),n.close(),n=null)}const s=d=>{const u=new Error("probe error: "+d);u.transport=n.name,o(),this.emitReserved("upgradeError",u)};function a(){s("transport closed")}function l(){s("socket closed")}function c(d){n&&d.name!==n.name&&o()}const m=()=>{n.removeListener("open",i),n.removeListener("error",s),n.removeListener("close",a),this.off("close",l),this.off("upgrading",c)};n.once("open",i),n.once("error",s),n.once("close",a),this.once("close",l),this.once("upgrading",c),this.upgrades.indexOf("webtransport")!==-1&&e!=="webtransport"?this.setTimeoutFn(()=>{r||n.open()},200):n.open()}onOpen(){if(this.readyState="open",qe.priorWebsocketSuccess=this.transport.name==="websocket",this.emitReserved("open"),this.flush(),this.readyState==="open"&&this.opts.upgrade){let e=0;const n=this.upgrades.length;for(;e<n;e++)this.probe(this.upgrades[e])}}onPacket(e){if(this.readyState==="opening"||this.readyState==="open"||this.readyState==="closing")switch(this.emitReserved("packet",e),this.emitReserved("heartbeat"),this.resetPingTimeout(),e.type){case"open":this.onHandshake(JSON.parse(e.data));break;case"ping":this.sendPacket("pong"),this.emitReserved("ping"),this.emitReserved("pong");break;case"error":const n=new Error("server error");n.code=e.data,this.onError(n);break;case"message":this.emitReserved("data",e.data),this.emitReserved("message",e.data);break}}onHandshake(e){this.emitReserved("handshake",e),this.id=e.sid,this.transport.query.sid=e.sid,this.upgrades=this.filterUpgrades(e.upgrades),this.pingInterval=e.pingInterval,this.pingTimeout=e.pingTimeout,this.maxPayload=e.maxPayload,this.onOpen(),this.readyState!=="closed"&&this.resetPingTimeout()}resetPingTimeout(){this.clearTimeoutFn(this.pingTimeoutTimer),this.pingTimeoutTimer=this.setTimeoutFn(()=>{this.onClose("ping timeout")},this.pingInterval+this.pingTimeout),this.opts.autoUnref&&this.pingTimeoutTimer.unref()}onDrain(){this.writeBuffer.splice(0,this.prevBufferLen),this.prevBufferLen=0,this.writeBuffer.length===0?this.emitReserved("drain"):this.flush()}flush(){if(this.readyState!=="closed"&&this.transport.writable&&!this.upgrading&&this.writeBuffer.length){const e=this.getWritablePackets();this.transport.send(e),this.prevBufferLen=e.length,this.emitReserved("flush")}}getWritablePackets(){if(!(this.maxPayload&&this.transport.name==="polling"&&this.writeBuffer.length>1))return this.writeBuffer;let n=1;for(let r=0;r<this.writeBuffer.length;r++){const i=this.writeBuffer[r].data;if(i&&(n+=ho(i)),r>0&&n>this.maxPayload)return this.writeBuffer.slice(0,r);n+=2}return this.writeBuffer}write(e,n,r){return this.sendPacket("message",e,n,r),this}send(e,n,r){return this.sendPacket("message",e,n,r),this}sendPacket(e,n,r,i){if(typeof n=="function"&&(i=n,n=void 0),typeof r=="function"&&(i=r,r=null),this.readyState==="closing"||this.readyState==="closed")return;r=r||{},r.compress=r.compress!==!1;const o={type:e,data:n,options:r};this.emitReserved("packetCreate",o),this.writeBuffer.push(o),i&&this.once("flush",i),this.flush()}close(){const e=()=>{this.onClose("forced close"),this.transport.close()},n=()=>{this.off("upgrade",n),this.off("upgradeError",n),e()},r=()=>{this.once("upgrade",n),this.once("upgradeError",n)};return(this.readyState==="opening"||this.readyState==="open")&&(this.readyState="closing",this.writeBuffer.length?this.once("drain",()=>{this.upgrading?r():e()}):this.upgrading?r():e()),this}onError(e){qe.priorWebsocketSuccess=!1,this.emitReserved("error",e),this.onClose("transport error",e)}onClose(e,n){(this.readyState==="opening"||this.readyState==="open"||this.readyState==="closing")&&(this.clearTimeoutFn(this.pingTimeoutTimer),this.transport.removeAllListeners("close"),this.transport.close(),this.transport.removeAllListeners(),typeof removeEventListener=="function"&&(removeEventListener("beforeunload",this.beforeunloadEventListener,!1),removeEventListener("offline",this.offlineEventListener,!1)),this.readyState="closed",this.id=null,this.emitReserved("close",e,n),this.writeBuffer=[],this.prevBufferLen=0)}filterUpgrades(e){const n=[];let r=0;const i=e.length;for(;r<i;r++)~this.transports.indexOf(e[r])&&n.push(e[r]);return n}};vr.protocol=dr;function Oo(t,e="",n){let r=t;n=n||typeof location<"u"&&location,t==null&&(t=n.protocol+"//"+n.host),typeof t=="string"&&(t.charAt(0)==="/"&&(t.charAt(1)==="/"?t=n.protocol+t:t=n.host+t),/^(https?|wss?):\/\//.test(t)||(typeof n<"u"?t=n.protocol+"//"+t:t="https://"+t),r=Vt(t)),r.port||(/^(http|ws)$/.test(r.protocol)?r.port="80":/^(http|ws)s$/.test(r.protocol)&&(r.port="443")),r.path=r.path||"/";const o=r.host.indexOf(":")!==-1?"["+r.host+"]":r.host;return r.id=r.protocol+"://"+o+":"+r.port+e,r.href=r.protocol+"://"+o+(n&&n.port===r.port?"":":"+r.port),r}const Ao=typeof ArrayBuffer=="function",xo=t=>typeof ArrayBuffer.isView=="function"?ArrayBuffer.isView(t):t.buffer instanceof ArrayBuffer,_r=Object.prototype.toString,Bo=typeof Blob=="function"||typeof Blob<"u"&&_r.call(Blob)==="[object BlobConstructor]",Uo=typeof File=="function"||typeof File<"u"&&_r.call(File)==="[object FileConstructor]";function Zt(t){return Ao&&(t instanceof ArrayBuffer||xo(t))||Bo&&t instanceof Blob||Uo&&t instanceof File}function mt(t,e){if(!t||typeof t!="object")return!1;if(Array.isArray(t)){for(let n=0,r=t.length;n<r;n++)if(mt(t[n]))return!0;return!1}if(Zt(t))return!0;if(t.toJSON&&typeof t.toJSON=="function"&&arguments.length===1)return mt(t.toJSON(),!0);for(const n in t)if(Object.prototype.hasOwnProperty.call(t,n)&&mt(t[n]))return!0;return!1}function Mo(t){const e=[],n=t.data,r=t;return r.data=Ht(n,e),r.attachments=e.length,{packet:r,buffers:e}}function Ht(t,e){if(!t)return t;if(Zt(t)){const n={_placeholder:!0,num:e.length};return e.push(t),n}else if(Array.isArray(t)){const n=new Array(t.length);for(let r=0;r<t.length;r++)n[r]=Ht(t[r],e);return n}else if(typeof t=="object"&&!(t instanceof Date)){const n={};for(const r in t)Object.prototype.hasOwnProperty.call(t,r)&&(n[r]=Ht(t[r],e));return n}return t}function Ro(t,e){return t.data=jt(t.data,e),delete t.attachments,t}function jt(t,e){if(!t)return t;if(t&&t._placeholder===!0){if(typeof t.num=="number"&&t.num>=0&&t.num<e.length)return e[t.num];throw new Error("illegal attachments")}else if(Array.isArray(t))for(let n=0;n<t.length;n++)t[n]=jt(t[n],e);else if(typeof t=="object")for(const n in t)Object.prototype.hasOwnProperty.call(t,n)&&(t[n]=jt(t[n],e));return t}const Fo=["connect","connect_error","disconnect","disconnecting","newListener","removeListener"],Do=5;var F;(function(t){t[t.CONNECT=0]="CONNECT",t[t.DISCONNECT=1]="DISCONNECT",t[t.EVENT=2]="EVENT",t[t.ACK=3]="ACK",t[t.CONNECT_ERROR=4]="CONNECT_ERROR",t[t.BINARY_EVENT=5]="BINARY_EVENT",t[t.BINARY_ACK=6]="BINARY_ACK"})(F||(F={}));class Lo{constructor(e){this.replacer=e}encode(e){return(e.type===F.EVENT||e.type===F.ACK)&&mt(e)?this.encodeAsBinary({type:e.type===F.EVENT?F.BINARY_EVENT:F.BINARY_ACK,nsp:e.nsp,data:e.data,id:e.id}):[this.encodeAsString(e)]}encodeAsString(e){let n=""+e.type;return(e.type===F.BINARY_EVENT||e.type===F.BINARY_ACK)&&(n+=e.attachments+"-"),e.nsp&&e.nsp!=="/"&&(n+=e.nsp+","),e.id!=null&&(n+=e.id),e.data!=null&&(n+=JSON.stringify(e.data,this.replacer)),n}encodeAsBinary(e){const n=Mo(e),r=this.encodeAsString(n.packet),i=n.buffers;return i.unshift(r),i}}function xn(t){return Object.prototype.toString.call(t)==="[object Object]"}class en extends te{constructor(e){super(),this.reviver=e}add(e){let n;if(typeof e=="string"){if(this.reconstructor)throw new Error("got plaintext data when reconstructing a packet");n=this.decodeString(e);const r=n.type===F.BINARY_EVENT;r||n.type===F.BINARY_ACK?(n.type=r?F.EVENT:F.ACK,this.reconstructor=new qo(n),n.attachments===0&&super.emitReserved("decoded",n)):super.emitReserved("decoded",n)}else if(Zt(e)||e.base64)if(this.reconstructor)n=this.reconstructor.takeBinaryData(e),n&&(this.reconstructor=null,super.emitReserved("decoded",n));else throw new Error("got binary data when not reconstructing a packet");else throw new Error("Unknown type: "+e)}decodeString(e){let n=0;const r={type:Number(e.charAt(0))};if(F[r.type]===void 0)throw new Error("unknown packet type "+r.type);if(r.type===F.BINARY_EVENT||r.type===F.BINARY_ACK){const o=n+1;for(;e.charAt(++n)!=="-"&&n!=e.length;);const s=e.substring(o,n);if(s!=Number(s)||e.charAt(n)!=="-")throw new Error("Illegal attachments");r.attachments=Number(s)}if(e.charAt(n+1)==="/"){const o=n+1;for(;++n&&!(e.charAt(n)===","||n===e.length););r.nsp=e.substring(o,n)}else r.nsp="/";const i=e.charAt(n+1);if(i!==""&&Number(i)==i){const o=n+1;for(;++n;){const s=e.charAt(n);if(s==null||Number(s)!=s){--n;break}if(n===e.length)break}r.id=Number(e.substring(o,n+1))}if(e.charAt(++n)){const o=this.tryParse(e.substr(n));if(en.isPayloadValid(r.type,o))r.data=o;else throw new Error("invalid payload")}return r}tryParse(e){try{return JSON.parse(e,this.reviver)}catch{return!1}}static isPayloadValid(e,n){switch(e){case F.CONNECT:return xn(n);case F.DISCONNECT:return n===void 0;case F.CONNECT_ERROR:return typeof n=="string"||xn(n);case F.EVENT:case F.BINARY_EVENT:return Array.isArray(n)&&(typeof n[0]=="number"||typeof n[0]=="string"&&Fo.indexOf(n[0])===-1);case F.ACK:case F.BINARY_ACK:return Array.isArray(n)}}destroy(){this.reconstructor&&(this.reconstructor.finishedReconstruction(),this.reconstructor=null)}}class qo{constructor(e){this.packet=e,this.buffers=[],this.reconPack=e}takeBinaryData(e){if(this.buffers.push(e),this.buffers.length===this.reconPack.attachments){const n=Ro(this.reconPack,this.buffers);return this.finishedReconstruction(),n}return null}finishedReconstruction(){this.reconPack=null,this.buffers=[]}}const Vo=Object.freeze(Object.defineProperty({__proto__:null,Decoder:en,Encoder:Lo,get PacketType(){return F},protocol:Do},Symbol.toStringTag,{value:"Module"}));function ye(t,e,n){return t.on(e,n),function(){t.off(e,n)}}const Ho=Object.freeze({connect:1,connect_error:1,disconnect:1,disconnecting:1,newListener:1,removeListener:1});class kr extends te{constructor(e,n,r){super(),this.connected=!1,this.recovered=!1,this.receiveBuffer=[],this.sendBuffer=[],this._queue=[],this._queueSeq=0,this.ids=0,this.acks={},this.flags={},this.io=e,this.nsp=n,r&&r.auth&&(this.auth=r.auth),this._opts=Object.assign({},r),this.io._autoConnect&&this.open()}get disconnected(){return!this.connected}subEvents(){if(this.subs)return;const e=this.io;this.subs=[ye(e,"open",this.onopen.bind(this)),ye(e,"packet",this.onpacket.bind(this)),ye(e,"error",this.onerror.bind(this)),ye(e,"close",this.onclose.bind(this))]}get active(){return!!this.subs}connect(){return this.connected?this:(this.subEvents(),this.io._reconnecting||this.io.open(),this.io._readyState==="open"&&this.onopen(),this)}open(){return this.connect()}send(...e){return e.unshift("message"),this.emit.apply(this,e),this}emit(e,...n){if(Ho.hasOwnProperty(e))throw new Error('"'+e.toString()+'" is a reserved event name');if(n.unshift(e),this._opts.retries&&!this.flags.fromQueue&&!this.flags.volatile)return this._addToQueue(n),this;const r={type:F.EVENT,data:n};if(r.options={},r.options.compress=this.flags.compress!==!1,typeof n[n.length-1]=="function"){const s=this.ids++,a=n.pop();this._registerAckCallback(s,a),r.id=s}const i=this.io.engine&&this.io.engine.transport&&this.io.engine.transport.writable;return this.flags.volatile&&(!i||!this.connected)||(this.connected?(this.notifyOutgoingListeners(r),this.packet(r)):this.sendBuffer.push(r)),this.flags={},this}_registerAckCallback(e,n){var r;const i=(r=this.flags.timeout)!==null&&r!==void 0?r:this._opts.ackTimeout;if(i===void 0){this.acks[e]=n;return}const o=this.io.setTimeoutFn(()=>{delete this.acks[e];for(let s=0;s<this.sendBuffer.length;s++)this.sendBuffer[s].id===e&&this.sendBuffer.splice(s,1);n.call(this,new Error("operation has timed out"))},i);this.acks[e]=(...s)=>{this.io.clearTimeoutFn(o),n.apply(this,[null,...s])}}emitWithAck(e,...n){const r=this.flags.timeout!==void 0||this._opts.ackTimeout!==void 0;return new Promise((i,o)=>{n.push((s,a)=>r?s?o(s):i(a):i(s)),this.emit(e,...n)})}_addToQueue(e){let n;typeof e[e.length-1]=="function"&&(n=e.pop());const r={id:this._queueSeq++,tryCount:0,pending:!1,args:e,flags:Object.assign({fromQueue:!0},this.flags)};e.push((i,...o)=>r!==this._queue[0]?void 0:(i!==null?r.tryCount>this._opts.retries&&(this._queue.shift(),n&&n(i)):(this._queue.shift(),n&&n(null,...o)),r.pending=!1,this._drainQueue())),this._queue.push(r),this._drainQueue()}_drainQueue(e=!1){if(!this.connected||this._queue.length===0)return;const n=this._queue[0];n.pending&&!e||(n.pending=!0,n.tryCount++,this.flags=n.flags,this.emit.apply(this,n.args))}packet(e){e.nsp=this.nsp,this.io._packet(e)}onopen(){typeof this.auth=="function"?this.auth(e=>{this._sendConnectPacket(e)}):this._sendConnectPacket(this.auth)}_sendConnectPacket(e){this.packet({type:F.CONNECT,data:this._pid?Object.assign({pid:this._pid,offset:this._lastOffset},e):e})}onerror(e){this.connected||this.emitReserved("connect_error",e)}onclose(e,n){this.connected=!1,delete this.id,this.emitReserved("disconnect",e,n)}onpacket(e){if(e.nsp===this.nsp)switch(e.type){case F.CONNECT:e.data&&e.data.sid?this.onconnect(e.data.sid,e.data.pid):this.emitReserved("connect_error",new Error("It seems you are trying to reach a Socket.IO server in v2.x with a v3.x client, but they are not compatible (more information here: https://socket.io/docs/v3/migrating-from-2-x-to-3-0/)"));break;case F.EVENT:case F.BINARY_EVENT:this.onevent(e);break;case F.ACK:case F.BINARY_ACK:this.onack(e);break;case F.DISCONNECT:this.ondisconnect();break;case F.CONNECT_ERROR:this.destroy();const r=new Error(e.data.message);r.data=e.data.data,this.emitReserved("connect_error",r);break}}onevent(e){const n=e.data||[];e.id!=null&&n.push(this.ack(e.id)),this.connected?this.emitEvent(n):this.receiveBuffer.push(Object.freeze(n))}emitEvent(e){if(this._anyListeners&&this._anyListeners.length){const n=this._anyListeners.slice();for(const r of n)r.apply(this,e)}super.emit.apply(this,e),this._pid&&e.length&&typeof e[e.length-1]=="string"&&(this._lastOffset=e[e.length-1])}ack(e){const n=this;let r=!1;return function(...i){r||(r=!0,n.packet({type:F.ACK,id:e,data:i}))}}onack(e){const n=this.acks[e.id];typeof n=="function"&&(n.apply(this,e.data),delete this.acks[e.id])}onconnect(e,n){this.id=e,this.recovered=n&&this._pid===n,this._pid=n,this.connected=!0,this.emitBuffered(),this.emitReserved("connect"),this._drainQueue(!0)}emitBuffered(){this.receiveBuffer.forEach(e=>this.emitEvent(e)),this.receiveBuffer=[],this.sendBuffer.forEach(e=>{this.notifyOutgoingListeners(e),this.packet(e)}),this.sendBuffer=[]}ondisconnect(){this.destroy(),this.onclose("io server disconnect")}destroy(){this.subs&&(this.subs.forEach(e=>e()),this.subs=void 0),this.io._destroy(this)}disconnect(){return this.connected&&this.packet({type:F.DISCONNECT}),this.destroy(),this.connected&&this.onclose("io client disconnect"),this}close(){return this.disconnect()}compress(e){return this.flags.compress=e,this}get volatile(){return this.flags.volatile=!0,this}timeout(e){return this.flags.timeout=e,this}onAny(e){return this._anyListeners=this._anyListeners||[],this._anyListeners.push(e),this}prependAny(e){return this._anyListeners=this._anyListeners||[],this._anyListeners.unshift(e),this}offAny(e){if(!this._anyListeners)return this;if(e){const n=this._anyListeners;for(let r=0;r<n.length;r++)if(e===n[r])return n.splice(r,1),this}else this._anyListeners=[];return this}listenersAny(){return this._anyListeners||[]}onAnyOutgoing(e){return this._anyOutgoingListeners=this._anyOutgoingListeners||[],this._anyOutgoingListeners.push(e),this}prependAnyOutgoing(e){return this._anyOutgoingListeners=this._anyOutgoingListeners||[],this._anyOutgoingListeners.unshift(e),this}offAnyOutgoing(e){if(!this._anyOutgoingListeners)return this;if(e){const n=this._anyOutgoingListeners;for(let r=0;r<n.length;r++)if(e===n[r])return n.splice(r,1),this}else this._anyOutgoingListeners=[];return this}listenersAnyOutgoing(){return this._anyOutgoingListeners||[]}notifyOutgoingListeners(e){if(this._anyOutgoingListeners&&this._anyOutgoingListeners.length){const n=this._anyOutgoingListeners.slice();for(const r of n)r.apply(this,e.data)}}}function $e(t){t=t||{},this.ms=t.min||100,this.max=t.max||1e4,this.factor=t.factor||2,this.jitter=t.jitter>0&&t.jitter<=1?t.jitter:0,this.attempts=0}$e.prototype.duration=function(){var t=this.ms*Math.pow(this.factor,this.attempts++);if(this.jitter){var e=Math.random(),n=Math.floor(e*this.jitter*t);t=Math.floor(e*10)&1?t+n:t-n}return Math.min(t,this.max)|0};$e.prototype.reset=function(){this.attempts=0};$e.prototype.setMin=function(t){this.ms=t};$e.prototype.setMax=function(t){this.max=t};$e.prototype.setJitter=function(t){this.jitter=t};class Kt extends te{constructor(e,n){var r;super(),this.nsps={},this.subs=[],e&&typeof e=="object"&&(n=e,e=void 0),n=n||{},n.path=n.path||"/socket.io",this.opts=n,Pt(this,n),this.reconnection(n.reconnection!==!1),this.reconnectionAttempts(n.reconnectionAttempts||1/0),this.reconnectionDelay(n.reconnectionDelay||1e3),this.reconnectionDelayMax(n.reconnectionDelayMax||5e3),this.randomizationFactor((r=n.randomizationFactor)!==null&&r!==void 0?r:.5),this.backoff=new $e({min:this.reconnectionDelay(),max:this.reconnectionDelayMax(),jitter:this.randomizationFactor()}),this.timeout(n.timeout==null?2e4:n.timeout),this._readyState="closed",this.uri=e;const i=n.parser||Vo;this.encoder=new i.Encoder,this.decoder=new i.Decoder,this._autoConnect=n.autoConnect!==!1,this._autoConnect&&this.open()}reconnection(e){return arguments.length?(this._reconnection=!!e,this):this._reconnection}reconnectionAttempts(e){return e===void 0?this._reconnectionAttempts:(this._reconnectionAttempts=e,this)}reconnectionDelay(e){var n;return e===void 0?this._reconnectionDelay:(this._reconnectionDelay=e,(n=this.backoff)===null||n===void 0||n.setMin(e),this)}randomizationFactor(e){var n;return e===void 0?this._randomizationFactor:(this._randomizationFactor=e,(n=this.backoff)===null||n===void 0||n.setJitter(e),this)}reconnectionDelayMax(e){var n;return e===void 0?this._reconnectionDelayMax:(this._reconnectionDelayMax=e,(n=this.backoff)===null||n===void 0||n.setMax(e),this)}timeout(e){return arguments.length?(this._timeout=e,this):this._timeout}maybeReconnectOnOpen(){!this._reconnecting&&this._reconnection&&this.backoff.attempts===0&&this.reconnect()}open(e){if(~this._readyState.indexOf("open"))return this;this.engine=new vr(this.uri,this.opts);const n=this.engine,r=this;this._readyState="opening",this.skipReconnect=!1;const i=ye(n,"open",function(){r.onopen(),e&&e()}),o=a=>{this.cleanup(),this._readyState="closed",this.emitReserved("error",a),e?e(a):this.maybeReconnectOnOpen()},s=ye(n,"error",o);if(this._timeout!==!1){const a=this._timeout,l=this.setTimeoutFn(()=>{i(),o(new Error("timeout")),n.close()},a);this.opts.autoUnref&&l.unref(),this.subs.push(()=>{this.clearTimeoutFn(l)})}return this.subs.push(i),this.subs.push(s),this}connect(e){return this.open(e)}onopen(){this.cleanup(),this._readyState="open",this.emitReserved("open");const e=this.engine;this.subs.push(ye(e,"ping",this.onping.bind(this)),ye(e,"data",this.ondata.bind(this)),ye(e,"error",this.onerror.bind(this)),ye(e,"close",this.onclose.bind(this)),ye(this.decoder,"decoded",this.ondecoded.bind(this)))}onping(){this.emitReserved("ping")}ondata(e){try{this.decoder.add(e)}catch(n){this.onclose("parse error",n)}}ondecoded(e){Qt(()=>{this.emitReserved("packet",e)},this.setTimeoutFn)}onerror(e){this.emitReserved("error",e)}socket(e,n){let r=this.nsps[e];return r?this._autoConnect&&!r.active&&r.connect():(r=new kr(this,e,n),this.nsps[e]=r),r}_destroy(e){const n=Object.keys(this.nsps);for(const r of n)if(this.nsps[r].active)return;this._close()}_packet(e){const n=this.encoder.encode(e);for(let r=0;r<n.length;r++)this.engine.write(n[r],e.options)}cleanup(){this.subs.forEach(e=>e()),this.subs.length=0,this.decoder.destroy()}_close(){this.skipReconnect=!0,this._reconnecting=!1,this.onclose("forced close"),this.engine&&this.engine.close()}disconnect(){return this._close()}onclose(e,n){this.cleanup(),this.backoff.reset(),this._readyState="closed",this.emitReserved("close",e,n),this._reconnection&&!this.skipReconnect&&this.reconnect()}reconnect(){if(this._reconnecting||this.skipReconnect)return this;const e=this;if(this.backoff.attempts>=this._reconnectionAttempts)this.backoff.reset(),this.emitReserved("reconnect_failed"),this._reconnecting=!1;else{const n=this.backoff.duration();this._reconnecting=!0;const r=this.setTimeoutFn(()=>{e.skipReconnect||(this.emitReserved("reconnect_attempt",e.backoff.attempts),!e.skipReconnect&&e.open(i=>{i?(e._reconnecting=!1,e.reconnect(),this.emitReserved("reconnect_error",i)):e.onreconnect()}))},n);this.opts.autoUnref&&r.unref(),this.subs.push(()=>{this.clearTimeoutFn(r)})}}onreconnect(){const e=this.backoff.attempts;this._reconnecting=!1,this.backoff.reset(),this.emitReserved("reconnect",e)}}const Xe={};function yt(t,e){typeof t=="object"&&(e=t,t=void 0),e=e||{};const n=Oo(t,e.path||"/socket.io"),r=n.source,i=n.id,o=n.path,s=Xe[i]&&o in Xe[i].nsps,a=e.forceNew||e["force new connection"]||e.multiplex===!1||s;let l;return a?l=new Kt(r,e):(Xe[i]||(Xe[i]=new Kt(r,e)),l=Xe[i]),n.query&&!e.query&&(e.query=n.queryKey),l.socket(n.path,e)}Object.assign(yt,{Manager:Kt,Socket:kr,io:yt,connect:yt});class Bn{constructor(e){B(this,"audioNodeMap",new Map);B(this,"instrument");B(this,"instrumentName");B(this,"colorHue");this.colorHue=e}async setInstrument(e){this.instrumentName=e,this.instrument=await As(e)}stopAudio(e){this.audioNodeMap.get(e)&&(this.audioNodeMap.get(e).stop(),this.audioNodeMap.delete(e))}playAudio(e,n){this.instrument&&(this.stopAudio(e),this.audioNodeMap.set(e,this.instrument.play(e,void 0,{gain:n})))}}class jo{constructor(){B(this,"connecting",ie(!1));B(this,"connectError",ie(""));B(this,"connectedColorHues",ie(new Map));B(this,"connected",ie(!1));B(this,"clientMap",new Map);B(this,"localClient",new Bn("220"));B(this,"socket",null);B(this,"onPlayNote");B(this,"onStopNote")}connect(e){if(Q(this.connecting)||Q(this.connected))return;if(e.length>100)return this.connectError.set("Room name to long!");const n="https://piano-backend.onrender.com";this.connectError.set(""),this.connecting.set(!0),this.socket=yt(n,{query:{roomName:e,instrumentName:this.localClient.instrumentName},path:{}.VITE_BACKEND_PATH,reconnection:!1,timeout:1e3*60}),this.socket.on("connect_error",r=>{this.clean(),this.connectError.set("Failed to connect to server: "+r.message)}),this.socket.on("error_message",r=>{this.connectError.set(r)}),this.socket.on("connect_timeout",()=>{this.clean(),this.connectError.set("Timed out while connecting to server!")}),this.socket.on("connect",()=>{this.connecting.set(!1),this.connected.set(!0),history.replaceState({},void 0,`?room=${e}`),document.title=`Room ${e} - Play Piano!`}),this.socket.on("disconnect",()=>{this.clean(),history.replaceState({},void 0,location.pathname),document.title="Play Piano!"}),this.socket.on("play_note",r=>{this.onPlayNote(r,this.clientMap.get(r.socketID))}),this.socket.on("stop_note",r=>{this.onStopNote(r,this.clientMap.get(r.socketID))}),this.socket.on("change_instrument",async r=>{this.clientMap.get(r.socketID).setInstrument(r.instrumentName)}),this.socket.on("client_connect",r=>{this.addClient(r)}),this.socket.on("client_list_recieve",r=>{for(let i of r)this.addClient(i)}),this.socket.on("client_disconnect",r=>{const i=Q(this.connectedColorHues);i.delete(r),this.connectedColorHues.set(i),this.cleanClient(this.clientMap.get(r)),this.clientMap.delete(r)})}playNote(e,n){const r={note:e,volume:n};this.onPlayNote(r,this.localClient),this.socket&&this.socket.emit("play_note",r)}stopNote(e,n){const r={note:e,sustain:n};this.onStopNote(r,this.localClient),this.socket&&this.socket.emit("stop_note",r)}async changeInstrument(e){this.socket&&this.socket.emit("change_instrument",{instrumentName:e}),await this.localClient.setInstrument(e)}addClient({socketID:e,colorHue:n,instrumentName:r}){const i=Q(this.connectedColorHues);if(i.set(e,n),this.connectedColorHues.set(i),e==this.socket.id)this.localClient.colorHue=n,this.clientMap.set(e,this.localClient);else{const o=new Bn(n);this.clientMap.set(e,o),o.setInstrument(r)}}clean(){for(const e of this.clientMap.values())this.cleanClient(e);this.socket.removeAllListeners(),this.socket=null,this.connecting.set(!1),this.connected.set(!1),this.clientMap.clear(),this.localClient.colorHue="220",Q(this.connectedColorHues).clear()}cleanClient(e){for(const n of e.audioNodeMap.keys())this.onStopNote({note:n,sustain:!1},e)}}function Un(t,e,n){const r=t.slice();return r[14]=e[n][0],r[15]=e[n][1],r}function Ko(t){let e,n,r,i;return{c(){e=v("button"),n=ae("Join"),e.disabled=t[4]},m(o,s){R(o,e,s),g(e,n),r||(i=O(e,"click",t[13]),r=!0)},p(o,s){s&16&&(e.disabled=o[4])},d(o){o&&M(e),r=!1,i()}}}function Jo(t){let e,n,r,i,o,s,a,l,c,m,d=Te(Array.from(t[3].entries())),u=[];for(let h=0;h<d.length;h+=1)u[h]=Rn(Un(t,d,h));return{c(){e=v("button"),e.textContent="Leave",n=x(),r=v("span"),r.textContent="Connected!",i=v("br"),o=x(),s=v("span"),s.textContent="People:",a=x();for(let h=0;h<u.length;h+=1)u[h].c();l=qn()},m(h,f){R(h,e,f),R(h,n,f),R(h,r,f),R(h,i,f),R(h,o,f),R(h,s,f),R(h,a,f);for(let p=0;p<u.length;p+=1)u[p]&&u[p].m(h,f);R(h,l,f),c||(m=O(e,"click",t[12]),c=!0)},p(h,f){if(f&9){d=Te(Array.from(h[3].entries()));let p;for(p=0;p<d.length;p+=1){const y=Un(h,d,p);u[p]?u[p].p(y,f):(u[p]=Rn(y),u[p].c(),u[p].m(l.parentNode,l))}for(;p<u.length;p+=1)u[p].d(1);u.length=d.length}},d(h){h&&(M(e),M(n),M(r),M(i),M(o),M(s),M(a),M(l)),et(u,h),c=!1,m()}}}function Mn(t){let e;return{c(){e=v("span"),e.textContent="(you)",Oe(e,"margin-right","0.5rem")},m(n,r){R(n,e,r)},d(n){n&&M(e)}}}function Rn(t){let e,n,r,i,o=t[14]===t[0].socket.id&&Mn();return{c(){e=v("div"),r=x(),o&&o.c(),i=qn(),_(e,"class","icon svelte-ye3hvw"),_(e,"style",n=`--color-hue: ${t[15]}`)},m(s,a){R(s,e,a),R(s,r,a),o&&o.m(s,a),R(s,i,a)},p(s,a){a&8&&n!==(n=`--color-hue: ${s[15]}`)&&_(e,"style",n),s[14]===s[0].socket.id?o||(o=Mn(),o.c(),o.m(i.parentNode,i)):o&&(o.d(1),o=null)},d(s){s&&(M(e),M(r),M(i)),o&&o.d(s)}}}function zo(t){let e,n,r,i;return{c(){e=v("span"),e.textContent="Connecting...",n=x(),r=v("img"),Dn(r.src,i=ar)||_(r,"src",i),_(r,"alt","spinner")},m(o,s){R(o,e,s),R(o,n,s),R(o,r,s)},p:J,d(o){o&&(M(e),M(n),M(r))}}}function Wo(t){let e,n;return{c(){e=v("span"),n=ae(t[5]),_(e,"class","error svelte-ye3hvw")},m(r,i){R(r,e,i),g(e,n)},p(r,i){i&32&&tt(n,r[5])},d(r){r&&M(e)}}}function Go(t){let e,n,r,i,o,s,a,l;function c(p,y){return p[2]?Jo:Ko}let m=c(t),d=m(t);function u(p,y){if(p[5])return Wo;if(p[4])return zo}let h=u(t),f=h&&h(t);return{c(){e=v("div"),n=v("p"),n.textContent="Join a room:",r=x(),i=v("input"),o=x(),d.c(),s=x(),f&&f.c(),_(i,"type","text"),_(i,"placeholder","Room name")},m(p,y){R(p,e,y),g(e,n),g(e,r),g(e,i),z(i,t[1]),g(e,o),d.m(e,null),g(e,s),f&&f.m(e,null),a||(l=[O(i,"input",t[10]),O(i,"keydown",t[11])],a=!0)},p(p,[y]){y&2&&i.value!==p[1]&&z(i,p[1]),m===(m=c(p))&&d?d.p(p,y):(d.d(1),d=m(p),d&&(d.c(),d.m(e,s))),h===(h=u(p))&&f?f.p(p,y):(f&&f.d(1),f=h&&h(p),f&&(f.c(),f.m(e,null)))},i:J,o:J,d(p){p&&M(e),d.d(),f&&f.d(),a=!1,be(l)}}}function $o(t,e,n){let r,i,o,s,{socketPlayer:a}=e,l="",{connected:c,connecting:m,connectError:d,connectedColorHues:u}=a;$(t,c,T=>n(2,r=T)),$(t,m,T=>n(4,o=T)),$(t,d,T=>n(5,s=T)),$(t,u,T=>n(3,i=T)),Hn(()=>{const U=new URLSearchParams(location.search).get("room");U!=null&&(n(1,l=U),a.connect(l))});function h(){l=this.value,n(1,l)}const f=T=>{T.code==="Enter"&&a.connect(l)},p=()=>a.socket.disconnect(),y=()=>a.connect(l);return t.$$set=T=>{"socketPlayer"in T&&n(0,a=T.socketPlayer)},[a,l,r,i,o,s,c,m,d,u,h,f,p,y]}class Yo extends Ge{constructor(e){super(),We(this,e,$o,Go,Ue,{socketPlayer:0})}}function Xo(t){let e,n,r,i,o,s,a,l;return r=new Qs({props:{pianoControlsData:t[0],socketPlayer:t[2]}}),o=new Hs({props:{midiPlayer:t[1]}}),a=new Yo({props:{socketPlayer:t[2]}}),{c(){e=v("div"),n=v("div"),Ze(r.$$.fragment),i=x(),Ze(o.$$.fragment),s=x(),Ze(a.$$.fragment),_(n,"class","row svelte-b9289n"),_(e,"class","control-panel svelte-b9289n")},m(c,m){R(c,e,m),g(e,n),Je(r,n,null),g(n,i),Je(o,n,null),g(e,s),Je(a,e,null),l=!0},p(c,[m]){const d={};m&1&&(d.pianoControlsData=c[0]),m&4&&(d.socketPlayer=c[2]),r.$set(d);const u={};m&2&&(u.midiPlayer=c[1]),o.$set(u);const h={};m&4&&(h.socketPlayer=c[2]),a.$set(h)},i(c){l||(Ae(r.$$.fragment,c),Ae(o.$$.fragment,c),Ae(a.$$.fragment,c),l=!0)},o(c){Ke(r.$$.fragment,c),Ke(o.$$.fragment,c),Ke(a.$$.fragment,c),l=!1},d(c){c&&M(e),ze(r),ze(o),ze(a)}}}function Qo(t,e,n){let{pianoControlsData:r}=e,{midiPlayer:i}=e,{socketPlayer:o}=e;return t.$$set=s=>{"pianoControlsData"in s&&n(0,r=s.pianoControlsData),"midiPlayer"in s&&n(1,i=s.midiPlayer),"socketPlayer"in s&&n(2,o=s.socketPlayer)},[r,i,o]}class Zo extends Ge{constructor(e){super(),We(this,e,Qo,Xo,Ue,{pianoControlsData:0,midiPlayer:1,socketPlayer:2})}}function ea(t){let e,n,r,i,o;return n=new Zo({props:{pianoControlsData:t[0],midiPlayer:t[1],socketPlayer:t[2]}}),i=new Fs({props:{pianoControlsData:t[0],midiPlayer:t[1],socketPlayer:t[2]}}),{c(){e=v("main"),Ze(n.$$.fragment),r=x(),Ze(i.$$.fragment)},m(s,a){R(s,e,a),Je(n,e,null),g(e,r),Je(i,e,null),o=!0},p:J,i(s){o||(Ae(n.$$.fragment,s),Ae(i.$$.fragment,s),o=!0)},o(s){Ke(n.$$.fragment,s),Ke(i.$$.fragment,s),o=!1},d(s){s&&M(e),ze(n),ze(i)}}}function ta(t){const e=new Ys,n=new Us,r=new jo;return[e,n,r]}class na extends Ge{constructor(e){super(),We(this,e,ta,ea,Ue,{})}}new na({target:document.body});

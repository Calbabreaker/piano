var _n=Object.defineProperty;var kn=(e,t,n)=>t in e?_n(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n;var x=(e,t,n)=>kn(e,typeof t!="symbol"?t+"":t,n);(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))r(i);new MutationObserver(i=>{for(const a of i)if(a.type==="childList")for(const o of a.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&r(o)}).observe(document,{childList:!0,subtree:!0});function n(i){const a={};return i.integrity&&(a.integrity=i.integrity),i.referrerPolicy&&(a.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?a.credentials="include":i.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function r(i){if(i.ep)return;i.ep=!0;const a=n(i);fetch(i.href,a)}})();function G(){}function wn(e){return!!e&&(typeof e=="object"||typeof e=="function")&&typeof e.then=="function"}function zt(e){return e()}function It(){return Object.create(null)}function pe(e){e.forEach(zt)}function Wt(e){return typeof e=="function"}function Ne(e,t){return e!=e?t==t:e!==t||e&&typeof e=="object"||typeof e=="function"}let $e;function $t(e,t){return e===t?!0:($e||($e=document.createElement("a")),$e.href=t,e===$e.href)}function Tn(e){return Object.keys(e).length===0}function Yt(e,...t){if(e==null){for(const r of t)r(void 0);return G}const n=e.subscribe(...t);return n.unsubscribe?()=>n.unsubscribe():n}function ee(e){let t;return Yt(e,n=>t=n)(),t}function z(e,t,n){e.$$.on_destroy.push(Yt(t,n))}function se(e,t,n){return e.set(n),t}function b(e,t){e.appendChild(t)}function E(e,t,n){e.insertBefore(t,n||null)}function B(e){e.parentNode&&e.parentNode.removeChild(e)}function Ge(e,t){for(let n=0;n<e.length;n+=1)e[n]&&e[n].d(t)}function v(e){return document.createElement(e)}function oe(e){return document.createTextNode(e)}function F(){return oe(" ")}function Xt(){return oe("")}function U(e,t,n,r){return e.addEventListener(t,n,r),()=>e.removeEventListener(t,n,r)}function In(e){return function(t){return t.preventDefault(),e.call(this,t)}}function k(e,t,n){n==null?e.removeAttribute(t):e.getAttribute(t)!==n&&e.setAttribute(t,n)}function he(e){return e===""?null:+e}function Cn(e){return Array.from(e.childNodes)}function Je(e,t){t=""+t,e.data!==t&&(e.data=t)}function K(e,t){e.value=t??""}function Ce(e,t,n,r){n==null?e.style.removeProperty(t):e.style.setProperty(t,n,"")}function ge(e,t,n){for(let r=0;r<e.options.length;r+=1){const i=e.options[r];if(i.__value===t){i.selected=!0;return}}(!n||t!==void 0)&&(e.selectedIndex=-1)}function He(e){const t=e.querySelector(":checked");return t&&t.__value}function Ct(e,t,n){e.classList.toggle(t,!!n)}let ze;function be(e){ze=e}function Zt(){if(!ze)throw new Error("Function called outside component initialization");return ze}function Qt(e){Zt().$$.on_mount.push(e)}function Sn(e,t){const n=e.$$.callbacks[t.type];n&&n.slice().forEach(r=>r.call(this,t))}const Oe=[],gt=[];let Ee=[];const St=[],Pn=Promise.resolve();let bt=!1;function Nn(){bt||(bt=!0,Pn.then(_t))}function we(e){Ee.push(e)}const ut=new Set;let Ue=0;function _t(){if(Ue!==0)return;const e=ze;do{try{for(;Ue<Oe.length;){const t=Oe[Ue];Ue++,be(t),Un(t.$$)}}catch(t){throw Oe.length=0,Ue=0,t}for(be(null),Oe.length=0,Ue=0;gt.length;)gt.pop()();for(let t=0;t<Ee.length;t+=1){const n=Ee[t];ut.has(n)||(ut.add(n),n())}Ee.length=0}while(Oe.length);for(;St.length;)St.pop()();bt=!1,ut.clear(),be(e)}function Un(e){if(e.fragment!==null){e.update(),pe(e.before_update);const t=e.dirty;e.dirty=[-1],e.fragment&&e.fragment.p(e.ctx,t),e.after_update.forEach(we)}}function Mn(e){const t=[],n=[];Ee.forEach(r=>e.indexOf(r)===-1?t.push(r):n.push(r)),n.forEach(r=>r()),Ee=t}const et=new Set;let Ie;function xn(){Ie={r:0,c:[],p:Ie}}function Fn(){Ie.r||pe(Ie.c),Ie=Ie.p}function Se(e,t){e&&e.i&&(et.delete(e),e.i(t))}function De(e,t,n,r){if(e&&e.o){if(et.has(e))return;et.add(e),Ie.c.push(()=>{et.delete(e),r&&(n&&e.d(1),r())}),e.o(t)}else r&&r()}function Pt(e,t){const n=t.token={};function r(i,a,o,s){if(t.token!==n)return;t.resolved=s;let u=t.ctx;o!==void 0&&(u=u.slice(),u[o]=s);const c=i&&(t.current=i)(u);let m=!1;t.block&&(t.blocks?t.blocks.forEach((h,l)=>{l!==a&&h&&(xn(),De(h,1,1,()=>{t.blocks[l]===h&&(t.blocks[l]=null)}),Fn())}):t.block.d(1),c.c(),Se(c,1),c.m(t.mount(),t.anchor),m=!0),t.block=c,t.blocks&&(t.blocks[a]=c),m&&_t()}if(wn(e)){const i=Zt();if(e.then(a=>{be(i),r(t.then,1,t.value,a),be(null)},a=>{if(be(i),r(t.catch,2,t.error,a),be(null),!t.hasCatch)throw a}),t.current!==t.pending)return r(t.pending,0),!0}else{if(t.current!==t.then)return r(t.then,1,t.value,e),!0;t.resolved=e}}function ye(e){return(e==null?void 0:e.length)!==void 0?e:Array.from(e)}function Ke(e){e&&e.c()}function je(e,t,n){const{fragment:r,after_update:i}=e.$$;r&&r.m(t,n),we(()=>{const a=e.$$.on_mount.map(zt).filter(Wt);e.$$.on_destroy?e.$$.on_destroy.push(...a):pe(a),e.$$.on_mount=[]}),i.forEach(we)}function Re(e,t){const n=e.$$;n.fragment!==null&&(Mn(n.after_update),pe(n.on_destroy),n.fragment&&n.fragment.d(t),n.on_destroy=n.fragment=null,n.ctx=[])}function On(e,t){e.$$.dirty[0]===-1&&(Oe.push(e),Nn(),e.$$.dirty.fill(0)),e.$$.dirty[t/31|0]|=1<<t%31}function Ve(e,t,n,r,i,a,o=null,s=[-1]){const u=ze;be(e);const c=e.$$={fragment:null,ctx:[],props:a,update:G,not_equal:i,bound:It(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(t.context||(u?u.$$.context:[])),callbacks:It(),dirty:s,skip_bound:!1,root:t.target||u.$$.root};o&&o(c.root);let m=!1;if(c.ctx=n?n(e,t.props||{},(h,l,...f)=>{const d=f.length?f[0]:l;return c.ctx&&i(c.ctx[h],c.ctx[h]=d)&&(!c.skip_bound&&c.bound[h]&&c.bound[h](d),m&&On(e,h)),l}):[],c.update(),m=!0,pe(c.before_update),c.fragment=r?r(c.ctx):!1,t.target){if(t.hydrate){const h=Cn(t.target);c.fragment&&c.fragment.l(h),h.forEach(B)}else c.fragment&&c.fragment.c();t.intro&&Se(e.$$.fragment),je(e,t.target,t.anchor),_t()}be(u)}class qe{constructor(){x(this,"$$");x(this,"$$set")}$destroy(){Re(this,1),this.$destroy=G}$on(t,n){if(!Wt(n))return G;const r=this.$$.callbacks[t]||(this.$$.callbacks[t]=[]);return r.push(n),()=>{const i=r.indexOf(n);i!==-1&&r.splice(i,1)}}$set(t){this.$$set&&!Tn(t)&&(this.$$.skip_bound=!0,this.$$set(t),this.$$.skip_bound=!1)}}const An="4";typeof window<"u"&&(window.__svelte||(window.__svelte={v:new Set})).v.add(An);var Ae=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function en(e){if(e.__esModule)return e;var t=e.default;if(typeof t=="function"){var n=function r(){return this instanceof r?Reflect.construct(t,arguments,this.constructor):t.apply(this,arguments)};n.prototype=t.prototype}else n={};return Object.defineProperty(n,"__esModule",{value:!0}),Object.keys(e).forEach(function(r){var i=Object.getOwnPropertyDescriptor(e,r);Object.defineProperty(n,r,i.get?i:{enumerable:!0,get:function(){return e[r]}})}),n}var yt={},it={};function Bn(e){var t=new le(e),n=t.readChunk();if(n.id!="MThd")throw"Bad MIDI file.  Expected 'MHdr', got: '"+n.id+"'";for(var r=En(n.data),i=[],a=0;!t.eof()&&a<r.numTracks;a++){var o=t.readChunk();if(o.id!="MTrk")throw"Bad MIDI file.  Expected 'MTrk', got: '"+o.id+"'";var s=Dn(o.data);i.push(s)}return{header:r,tracks:i}}function En(e){var t=new le(e),n=t.readUInt16(),r=t.readUInt16(),i={format:n,numTracks:r},a=t.readUInt16();return a&32768?(i.framesPerSecond=256-(a>>8),i.ticksPerFrame=a&255):i.ticksPerBeat=a,i}function Dn(e){for(var t=new le(e),n=[];!t.eof();){var r=a();n.push(r)}return n;var i;function a(){var o={};o.deltaTime=t.readVarInt();var s=t.readUInt8();if((s&240)===240)if(s===255){o.meta=!0;var u=t.readUInt8(),c=t.readVarInt();switch(u){case 0:if(o.type="sequenceNumber",c!==2)throw"Expected length for sequenceNumber event is 2, got "+c;return o.number=t.readUInt16(),o;case 1:return o.type="text",o.text=t.readString(c),o;case 2:return o.type="copyrightNotice",o.text=t.readString(c),o;case 3:return o.type="trackName",o.text=t.readString(c),o;case 4:return o.type="instrumentName",o.text=t.readString(c),o;case 5:return o.type="lyrics",o.text=t.readString(c),o;case 6:return o.type="marker",o.text=t.readString(c),o;case 7:return o.type="cuePoint",o.text=t.readString(c),o;case 32:if(o.type="channelPrefix",c!=1)throw"Expected length for channelPrefix event is 1, got "+c;return o.channel=t.readUInt8(),o;case 33:if(o.type="portPrefix",c!=1)throw"Expected length for portPrefix event is 1, got "+c;return o.port=t.readUInt8(),o;case 47:if(o.type="endOfTrack",c!=0)throw"Expected length for endOfTrack event is 0, got "+c;return o;case 81:if(o.type="setTempo",c!=3)throw"Expected length for setTempo event is 3, got "+c;return o.microsecondsPerBeat=t.readUInt24(),o;case 84:if(o.type="smpteOffset",c!=5)throw"Expected length for smpteOffset event is 5, got "+c;var m=t.readUInt8(),h={0:24,32:25,64:29,96:30};return o.frameRate=h[m&96],o.hour=m&31,o.min=t.readUInt8(),o.sec=t.readUInt8(),o.frame=t.readUInt8(),o.subFrame=t.readUInt8(),o;case 88:if(o.type="timeSignature",c!=2&&c!=4)throw"Expected length for timeSignature event is 4 or 2, got "+c;return o.numerator=t.readUInt8(),o.denominator=1<<t.readUInt8(),c===4?(o.metronome=t.readUInt8(),o.thirtyseconds=t.readUInt8()):(o.metronome=36,o.thirtyseconds=8),o;case 89:if(o.type="keySignature",c!=2)throw"Expected length for keySignature event is 2, got "+c;return o.key=t.readInt8(),o.scale=t.readUInt8(),o;case 127:return o.type="sequencerSpecific",o.data=t.readBytes(c),o;default:return o.type="unknownMeta",o.data=t.readBytes(c),o.metatypeByte=u,o}}else if(s==240){o.type="sysEx";var c=t.readVarInt();return o.data=t.readBytes(c),o}else if(s==247){o.type="endSysEx";var c=t.readVarInt();return o.data=t.readBytes(c),o}else throw"Unrecognised MIDI event type byte: "+s;else{var l;if(s&128)l=t.readUInt8(),i=s;else{if(i===null)throw"Running status byte encountered before status byte";l=s,s=i,o.running=!0}var f=s>>4;switch(o.channel=s&15,f){case 8:return o.type="noteOff",o.noteNumber=l,o.velocity=t.readUInt8(),o;case 9:var d=t.readUInt8();return o.type=d===0?"noteOff":"noteOn",o.noteNumber=l,o.velocity=d,d===0&&(o.byte9=!0),o;case 10:return o.type="noteAftertouch",o.noteNumber=l,o.amount=t.readUInt8(),o;case 11:return o.type="controller",o.controllerType=l,o.value=t.readUInt8(),o;case 12:return o.type="programChange",o.programNumber=l,o;case 13:return o.type="channelAftertouch",o.amount=l,o;case 14:return o.type="pitchBend",o.value=l+(t.readUInt8()<<7)-8192,o;default:throw"Unrecognised MIDI event type: "+f}}}}function le(e){this.buffer=e,this.bufferLen=this.buffer.length,this.pos=0}le.prototype.eof=function(){return this.pos>=this.bufferLen};le.prototype.readUInt8=function(){var e=this.buffer[this.pos];return this.pos+=1,e};le.prototype.readInt8=function(){var e=this.readUInt8();return e&128?e-256:e};le.prototype.readUInt16=function(){var e=this.readUInt8(),t=this.readUInt8();return(e<<8)+t};le.prototype.readInt16=function(){var e=this.readUInt16();return e&32768?e-65536:e};le.prototype.readUInt24=function(){var e=this.readUInt8(),t=this.readUInt8(),n=this.readUInt8();return(e<<16)+(t<<8)+n};le.prototype.readInt24=function(){var e=this.readUInt24();return e&8388608?e-16777216:e};le.prototype.readUInt32=function(){var e=this.readUInt8(),t=this.readUInt8(),n=this.readUInt8(),r=this.readUInt8();return(e<<24)+(t<<16)+(n<<8)+r};le.prototype.readBytes=function(e){var t=this.buffer.slice(this.pos,this.pos+e);return this.pos+=e,t};le.prototype.readString=function(e){var t=this.readBytes(e);return String.fromCharCode.apply(null,t)};le.prototype.readVarInt=function(){for(var e=0;!this.eof();){var t=this.readUInt8();if(t&128)e+=t&127,e<<=7;else return e+t}return e};le.prototype.readChunk=function(){var e=this.readString(4),t=this.readUInt32(),n=this.readBytes(t);return{id:e,length:t,data:n}};var jn=Bn;function Rn(e,t){if(typeof e!="object")throw"Invalid MIDI data";t=t||{};var n=e.header||{},r=e.tracks||[],i,a=r.length,o=new te;for(Vn(o,n,a),i=0;i<a;i++)qn(o,r[i],t);return o.buffer}function Vn(e,t,n){var r=t.format==null?1:t.format,i=128;t.timeDivision?i=t.timeDivision:t.ticksPerFrame&&t.framesPerSecond?i=-(t.framesPerSecond&255)<<8|t.ticksPerFrame&255:t.ticksPerBeat&&(i=t.ticksPerBeat&32767);var a=new te;a.writeUInt16(r),a.writeUInt16(n),a.writeUInt16(i),e.writeChunk("MThd",a.buffer)}function qn(e,t,n){var r=new te,i,a=t.length,o=null;for(i=0;i<a;i++)(n.running===!1||!n.running&&!t[i].running)&&(o=null),o=Ln(r,t[i],o,n.useByte9ForNoteOff);e.writeChunk("MTrk",r.buffer)}function Ln(e,t,n,r){var i=t.type,a=t.deltaTime,o=t.text||"",s=t.data||[],u=null;switch(e.writeVarInt(a),i){case"sequenceNumber":e.writeUInt8(255),e.writeUInt8(0),e.writeVarInt(2),e.writeUInt16(t.number);break;case"text":e.writeUInt8(255),e.writeUInt8(1),e.writeVarInt(o.length),e.writeString(o);break;case"copyrightNotice":e.writeUInt8(255),e.writeUInt8(2),e.writeVarInt(o.length),e.writeString(o);break;case"trackName":e.writeUInt8(255),e.writeUInt8(3),e.writeVarInt(o.length),e.writeString(o);break;case"instrumentName":e.writeUInt8(255),e.writeUInt8(4),e.writeVarInt(o.length),e.writeString(o);break;case"lyrics":e.writeUInt8(255),e.writeUInt8(5),e.writeVarInt(o.length),e.writeString(o);break;case"marker":e.writeUInt8(255),e.writeUInt8(6),e.writeVarInt(o.length),e.writeString(o);break;case"cuePoint":e.writeUInt8(255),e.writeUInt8(7),e.writeVarInt(o.length),e.writeString(o);break;case"channelPrefix":e.writeUInt8(255),e.writeUInt8(32),e.writeVarInt(1),e.writeUInt8(t.channel);break;case"portPrefix":e.writeUInt8(255),e.writeUInt8(33),e.writeVarInt(1),e.writeUInt8(t.port);break;case"endOfTrack":e.writeUInt8(255),e.writeUInt8(47),e.writeVarInt(0);break;case"setTempo":e.writeUInt8(255),e.writeUInt8(81),e.writeVarInt(3),e.writeUInt24(t.microsecondsPerBeat);break;case"smpteOffset":e.writeUInt8(255),e.writeUInt8(84),e.writeVarInt(5);var c={24:0,25:32,29:64,30:96},m=t.hour&31|c[t.frameRate];e.writeUInt8(m),e.writeUInt8(t.min),e.writeUInt8(t.sec),e.writeUInt8(t.frame),e.writeUInt8(t.subFrame);break;case"timeSignature":e.writeUInt8(255),e.writeUInt8(88),e.writeVarInt(4),e.writeUInt8(t.numerator);var h=Math.floor(Math.log(t.denominator)/Math.LN2)&255;e.writeUInt8(h),e.writeUInt8(t.metronome),e.writeUInt8(t.thirtyseconds||8);break;case"keySignature":e.writeUInt8(255),e.writeUInt8(89),e.writeVarInt(2),e.writeInt8(t.key),e.writeUInt8(t.scale);break;case"sequencerSpecific":e.writeUInt8(255),e.writeUInt8(127),e.writeVarInt(s.length),e.writeBytes(s);break;case"unknownMeta":t.metatypeByte!=null&&(e.writeUInt8(255),e.writeUInt8(t.metatypeByte),e.writeVarInt(s.length),e.writeBytes(s));break;case"sysEx":e.writeUInt8(240),e.writeVarInt(s.length),e.writeBytes(s);break;case"endSysEx":e.writeUInt8(247),e.writeVarInt(s.length),e.writeBytes(s);break;case"noteOff":var l=r!==!1&&t.byte9||r&&t.velocity==0?144:128;u=l|t.channel,u!==n&&e.writeUInt8(u),e.writeUInt8(t.noteNumber),e.writeUInt8(t.velocity);break;case"noteOn":u=144|t.channel,u!==n&&e.writeUInt8(u),e.writeUInt8(t.noteNumber),e.writeUInt8(t.velocity);break;case"noteAftertouch":u=160|t.channel,u!==n&&e.writeUInt8(u),e.writeUInt8(t.noteNumber),e.writeUInt8(t.amount);break;case"controller":u=176|t.channel,u!==n&&e.writeUInt8(u),e.writeUInt8(t.controllerType),e.writeUInt8(t.value);break;case"programChange":u=192|t.channel,u!==n&&e.writeUInt8(u),e.writeUInt8(t.programNumber);break;case"channelAftertouch":u=208|t.channel,u!==n&&e.writeUInt8(u),e.writeUInt8(t.amount);break;case"pitchBend":u=224|t.channel,u!==n&&e.writeUInt8(u);var f=8192+t.value,d=f&127,p=f>>7&127;e.writeUInt8(d),e.writeUInt8(p);break;default:throw"Unrecognized event type: "+i}return u}function te(){this.buffer=[]}te.prototype.writeUInt8=function(e){this.buffer.push(e&255)};te.prototype.writeInt8=te.prototype.writeUInt8;te.prototype.writeUInt16=function(e){var t=e>>8&255,n=e&255;this.writeUInt8(t),this.writeUInt8(n)};te.prototype.writeInt16=te.prototype.writeUInt16;te.prototype.writeUInt24=function(e){var t=e>>16&255,n=e>>8&255,r=e&255;this.writeUInt8(t),this.writeUInt8(n),this.writeUInt8(r)};te.prototype.writeInt24=te.prototype.writeUInt24;te.prototype.writeUInt32=function(e){var t=e>>24&255,n=e>>16&255,r=e>>8&255,i=e&255;this.writeUInt8(t),this.writeUInt8(n),this.writeUInt8(r),this.writeUInt8(i)};te.prototype.writeInt32=te.prototype.writeUInt32;te.prototype.writeBytes=function(e){this.buffer=this.buffer.concat(Array.prototype.slice.call(e,0))};te.prototype.writeString=function(e){var t,n=e.length,r=[];for(t=0;t<n;t++)r.push(e.codePointAt(t));this.writeBytes(r)};te.prototype.writeVarInt=function(e){if(e<0)throw"Cannot write negative variable-length integer";if(e<=127)this.writeUInt8(e);else{var t=e,n=[];for(n.push(t&127),t>>=7;t;){var r=t&127|128;n.push(r),t>>=7}this.writeBytes(n.reverse())}};te.prototype.writeChunk=function(e,t){this.writeString(e),this.writeUInt32(t.length),this.writeBytes(t)};var Hn=Rn;it.parseMidi=jn;it.writeMidi=Hn;var tt={},Pe={};Object.defineProperty(Pe,"__esModule",{value:!0});Pe.insert=Pe.search=void 0;function tn(e,t,n){n===void 0&&(n="ticks");var r=0,i=e.length,a=i;if(i>0&&e[i-1][n]<=t)return i-1;for(;r<a;){var o=Math.floor(r+(a-r)/2),s=e[o],u=e[o+1];if(s[n]===t){for(var c=o;c<e.length;c++){var m=e[c];m[n]===t&&(o=c)}return o}else{if(s[n]<t&&u[n]>t)return o;s[n]>t?a=o:s[n]<t&&(r=o+1)}}return-1}Pe.search=tn;function Kn(e,t,n){if(n===void 0&&(n="ticks"),e.length){var r=tn(e,t[n],n);e.splice(r+1,0,t)}else e.push(t)}Pe.insert=Kn;(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.Header=e.keySignatureKeys=void 0;var t=Pe,n=new WeakMap;e.keySignatureKeys=["Cb","Gb","Db","Ab","Eb","Bb","F","C","G","D","A","E","B","F#","C#"];var r=function(){function i(a){var o=this;if(this.tempos=[],this.timeSignatures=[],this.keySignatures=[],this.meta=[],this.name="",n.set(this,480),a){n.set(this,a.header.ticksPerBeat),a.tracks.forEach(function(u){u.forEach(function(c){c.meta&&(c.type==="timeSignature"?o.timeSignatures.push({ticks:c.absoluteTime,timeSignature:[c.numerator,c.denominator]}):c.type==="setTempo"?o.tempos.push({bpm:6e7/c.microsecondsPerBeat,ticks:c.absoluteTime}):c.type==="keySignature"&&o.keySignatures.push({key:e.keySignatureKeys[c.key+7],scale:c.scale===0?"major":"minor",ticks:c.absoluteTime}))})});var s=0;a.tracks[0].forEach(function(u){s+=u.deltaTime,u.meta&&(u.type==="trackName"?o.name=u.text:(u.type==="text"||u.type==="cuePoint"||u.type==="marker"||u.type==="lyrics")&&o.meta.push({text:u.text,ticks:s,type:u.type}))}),this.update()}}return i.prototype.update=function(){var a=this,o=0,s=0;this.tempos.sort(function(u,c){return u.ticks-c.ticks}),this.tempos.forEach(function(u,c){var m=c>0?a.tempos[c-1].bpm:a.tempos[0].bpm,h=u.ticks/a.ppq-s,l=60/m*h;u.time=l+o,o=u.time,s+=h}),this.timeSignatures.sort(function(u,c){return u.ticks-c.ticks}),this.timeSignatures.forEach(function(u,c){var m=c>0?a.timeSignatures[c-1]:a.timeSignatures[0],h=(u.ticks-m.ticks)/a.ppq,l=h/m.timeSignature[0]/(m.timeSignature[1]/4);m.measures=m.measures||0,u.measures=l+m.measures})},i.prototype.ticksToSeconds=function(a){var o=(0,t.search)(this.tempos,a);if(o!==-1){var s=this.tempos[o],u=s.time,c=(a-s.ticks)/this.ppq;return u+60/s.bpm*c}else{var m=a/this.ppq;return 60/120*m}},i.prototype.ticksToMeasures=function(a){var o=(0,t.search)(this.timeSignatures,a);if(o!==-1){var s=this.timeSignatures[o],u=(a-s.ticks)/this.ppq;return s.measures+u/(s.timeSignature[0]/s.timeSignature[1])/4}else return a/this.ppq/4},Object.defineProperty(i.prototype,"ppq",{get:function(){return n.get(this)},enumerable:!1,configurable:!0}),i.prototype.secondsToTicks=function(a){var o=(0,t.search)(this.tempos,a,"time");if(o!==-1){var s=this.tempos[o],u=s.time,c=a-u,m=c/(60/s.bpm);return Math.round(s.ticks+m*this.ppq)}else{var h=a/.5;return Math.round(h*this.ppq)}},i.prototype.toJSON=function(){return{keySignatures:this.keySignatures,meta:this.meta,name:this.name,ppq:this.ppq,tempos:this.tempos.map(function(a){return{bpm:a.bpm,ticks:a.ticks}}),timeSignatures:this.timeSignatures}},i.prototype.fromJSON=function(a){this.name=a.name,this.tempos=a.tempos.map(function(o){return Object.assign({},o)}),this.timeSignatures=a.timeSignatures.map(function(o){return Object.assign({},o)}),this.keySignatures=a.keySignatures.map(function(o){return Object.assign({},o)}),this.meta=a.meta.map(function(o){return Object.assign({},o)}),n.set(this,a.ppq),this.update()},i.prototype.setTempo=function(a){this.tempos=[{bpm:a,ticks:0}],this.update()},i}();e.Header=r})(tt);var We={},kt={};(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.ControlChange=e.controlChangeIds=e.controlChangeNames=void 0,e.controlChangeNames={1:"modulationWheel",2:"breath",4:"footController",5:"portamentoTime",7:"volume",8:"balance",10:"pan",64:"sustain",65:"portamentoTime",66:"sostenuto",67:"softPedal",68:"legatoFootswitch",84:"portamentoControl"},e.controlChangeIds=Object.keys(e.controlChangeNames).reduce(function(i,a){return i[e.controlChangeNames[a]]=a,i},{});var t=new WeakMap,n=new WeakMap,r=function(){function i(a,o){t.set(this,o),n.set(this,a.controllerType),this.ticks=a.absoluteTime,this.value=a.value}return Object.defineProperty(i.prototype,"number",{get:function(){return n.get(this)},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"name",{get:function(){return e.controlChangeNames[this.number]?e.controlChangeNames[this.number]:null},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"time",{get:function(){var a=t.get(this);return a.ticksToSeconds(this.ticks)},set:function(a){var o=t.get(this);this.ticks=o.secondsToTicks(a)},enumerable:!1,configurable:!0}),i.prototype.toJSON=function(){return{number:this.number,ticks:this.ticks,time:this.time,value:this.value}},i}();e.ControlChange=r})(kt);var ot={};Object.defineProperty(ot,"__esModule",{value:!0});ot.createControlChanges=void 0;var Ye=kt;function Gn(){return new Proxy({},{get:function(e,t){if(e[t])return e[t];if(Ye.controlChangeIds.hasOwnProperty(t))return e[Ye.controlChangeIds[t]]},set:function(e,t,n){return Ye.controlChangeIds.hasOwnProperty(t)?e[Ye.controlChangeIds[t]]=n:e[t]=n,!0}})}ot.createControlChanges=Gn;var at={};Object.defineProperty(at,"__esModule",{value:!0});at.PitchBend=void 0;var ft=new WeakMap,Jn=function(){function e(t,n){ft.set(this,n),this.ticks=t.absoluteTime,this.value=t.value}return Object.defineProperty(e.prototype,"time",{get:function(){var t=ft.get(this);return t.ticksToSeconds(this.ticks)},set:function(t){var n=ft.get(this);this.ticks=n.secondsToTicks(t)},enumerable:!1,configurable:!0}),e.prototype.toJSON=function(){return{ticks:this.ticks,time:this.time,value:this.value}},e}();at.PitchBend=Jn;var st={},Te={};Object.defineProperty(Te,"__esModule",{value:!0});Te.DrumKitByPatchID=Te.InstrumentFamilyByID=Te.instrumentByPatchID=void 0;Te.instrumentByPatchID=["acoustic grand piano","bright acoustic piano","electric grand piano","honky-tonk piano","electric piano 1","electric piano 2","harpsichord","clavi","celesta","glockenspiel","music box","vibraphone","marimba","xylophone","tubular bells","dulcimer","drawbar organ","percussive organ","rock organ","church organ","reed organ","accordion","harmonica","tango accordion","acoustic guitar (nylon)","acoustic guitar (steel)","electric guitar (jazz)","electric guitar (clean)","electric guitar (muted)","overdriven guitar","distortion guitar","guitar harmonics","acoustic bass","electric bass (finger)","electric bass (pick)","fretless bass","slap bass 1","slap bass 2","synth bass 1","synth bass 2","violin","viola","cello","contrabass","tremolo strings","pizzicato strings","orchestral harp","timpani","string ensemble 1","string ensemble 2","synthstrings 1","synthstrings 2","choir aahs","voice oohs","synth voice","orchestra hit","trumpet","trombone","tuba","muted trumpet","french horn","brass section","synthbrass 1","synthbrass 2","soprano sax","alto sax","tenor sax","baritone sax","oboe","english horn","bassoon","clarinet","piccolo","flute","recorder","pan flute","blown bottle","shakuhachi","whistle","ocarina","lead 1 (square)","lead 2 (sawtooth)","lead 3 (calliope)","lead 4 (chiff)","lead 5 (charang)","lead 6 (voice)","lead 7 (fifths)","lead 8 (bass + lead)","pad 1 (new age)","pad 2 (warm)","pad 3 (polysynth)","pad 4 (choir)","pad 5 (bowed)","pad 6 (metallic)","pad 7 (halo)","pad 8 (sweep)","fx 1 (rain)","fx 2 (soundtrack)","fx 3 (crystal)","fx 4 (atmosphere)","fx 5 (brightness)","fx 6 (goblins)","fx 7 (echoes)","fx 8 (sci-fi)","sitar","banjo","shamisen","koto","kalimba","bag pipe","fiddle","shanai","tinkle bell","agogo","steel drums","woodblock","taiko drum","melodic tom","synth drum","reverse cymbal","guitar fret noise","breath noise","seashore","bird tweet","telephone ring","helicopter","applause","gunshot"];Te.InstrumentFamilyByID=["piano","chromatic percussion","organ","guitar","bass","strings","ensemble","brass","reed","pipe","synth lead","synth pad","synth effects","world","percussive","sound effects"];Te.DrumKitByPatchID={0:"standard kit",8:"room kit",16:"power kit",24:"electronic kit",25:"tr-808 kit",32:"jazz kit",40:"brush kit",48:"orchestra kit",56:"sound fx kit"};Object.defineProperty(st,"__esModule",{value:!0});st.Instrument=void 0;var Xe=Te,Nt=new WeakMap,zn=function(){function e(t,n){if(this.number=0,Nt.set(this,n),this.number=0,t){var r=t.find(function(i){return i.type==="programChange"});r&&(this.number=r.programNumber)}}return Object.defineProperty(e.prototype,"name",{get:function(){return this.percussion?Xe.DrumKitByPatchID[this.number]:Xe.instrumentByPatchID[this.number]},set:function(t){var n=Xe.instrumentByPatchID.indexOf(t);n!==-1&&(this.number=n)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"family",{get:function(){return this.percussion?"drums":Xe.InstrumentFamilyByID[Math.floor(this.number/8)]},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"percussion",{get:function(){var t=Nt.get(this);return t.channel===9},enumerable:!1,configurable:!0}),e.prototype.toJSON=function(){return{family:this.family,number:this.number,name:this.name}},e.prototype.fromJSON=function(t){this.number=t.number},e}();st.Instrument=zn;var ct={};Object.defineProperty(ct,"__esModule",{value:!0});ct.Note=void 0;function Wn(e){var t=Math.floor(e/12)-1;return nn(e)+t.toString()}function nn(e){var t=["C","C#","D","D#","E","F","F#","G","G#","A","A#","B"],n=e%12;return t[n]}function $n(e){var t=["C","C#","D","D#","E","F","F#","G","G#","A","A#","B"];return t.indexOf(e)}var Yn=function(){var e=/^([a-g]{1}(?:b|#|x|bb)?)(-?[0-9]+)/i,t={cbb:-2,cb:-1,c:0,"c#":1,cx:2,dbb:0,db:1,d:2,"d#":3,dx:4,ebb:2,eb:3,e:4,"e#":5,ex:6,fbb:3,fb:4,f:5,"f#":6,fx:7,gbb:5,gb:6,g:7,"g#":8,gx:9,abb:7,ab:8,a:9,"a#":10,ax:11,bbb:9,bb:10,b:11,"b#":12,bx:13};return function(n){var r=e.exec(n),i=r[1],a=r[2],o=t[i.toLowerCase()];return o+(parseInt(a,10)+1)*12}}(),Me=new WeakMap,Xn=function(){function e(t,n,r){Me.set(this,r),this.midi=t.midi,this.velocity=t.velocity,this.noteOffVelocity=n.velocity,this.ticks=t.ticks,this.durationTicks=n.ticks-t.ticks}return Object.defineProperty(e.prototype,"name",{get:function(){return Wn(this.midi)},set:function(t){this.midi=Yn(t)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"octave",{get:function(){return Math.floor(this.midi/12)-1},set:function(t){var n=t-this.octave;this.midi+=n*12},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"pitch",{get:function(){return nn(this.midi)},set:function(t){this.midi=12*(this.octave+1)+$n(t)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"duration",{get:function(){var t=Me.get(this);return t.ticksToSeconds(this.ticks+this.durationTicks)-t.ticksToSeconds(this.ticks)},set:function(t){var n=Me.get(this),r=n.secondsToTicks(this.time+t);this.durationTicks=r-this.ticks},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"time",{get:function(){var t=Me.get(this);return t.ticksToSeconds(this.ticks)},set:function(t){var n=Me.get(this);this.ticks=n.secondsToTicks(t)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"bars",{get:function(){var t=Me.get(this);return t.ticksToMeasures(this.ticks)},enumerable:!1,configurable:!0}),e.prototype.toJSON=function(){return{duration:this.duration,durationTicks:this.durationTicks,midi:this.midi,name:this.name,ticks:this.ticks,time:this.time,velocity:this.velocity}},e}();ct.Note=Xn;Object.defineProperty(We,"__esModule",{value:!0});We.Track=void 0;var dt=Pe,Zn=kt,Qn=ot,er=at,Ut=st,tr=ct,Ze=new WeakMap,nr=function(){function e(t,n){var r=this;if(this.name="",this.notes=[],this.controlChanges=(0,Qn.createControlChanges)(),this.pitchBends=[],Ze.set(this,n),t){var i=t.find(function(l){return l.type==="trackName"});this.name=i?i.text:""}if(this.instrument=new Ut.Instrument(t,this),this.channel=0,t){for(var a=t.filter(function(l){return l.type==="noteOn"}),o=t.filter(function(l){return l.type==="noteOff"}),s=function(){var l=a.shift();u.channel=l.channel;var f=o.findIndex(function(p){return p.noteNumber===l.noteNumber&&p.absoluteTime>=l.absoluteTime});if(f!==-1){var d=o.splice(f,1)[0];u.addNote({durationTicks:d.absoluteTime-l.absoluteTime,midi:l.noteNumber,noteOffVelocity:d.velocity/127,ticks:l.absoluteTime,velocity:l.velocity/127})}},u=this;a.length;)s();var c=t.filter(function(l){return l.type==="controller"});c.forEach(function(l){r.addCC({number:l.controllerType,ticks:l.absoluteTime,value:l.value/127})});var m=t.filter(function(l){return l.type==="pitchBend"});m.forEach(function(l){r.addPitchBend({ticks:l.absoluteTime,value:l.value/Math.pow(2,13)})});var h=t.find(function(l){return l.type==="endOfTrack"});this.endOfTrackTicks=h!==void 0?h.absoluteTime:void 0}}return e.prototype.addNote=function(t){var n=Ze.get(this),r=new tr.Note({midi:0,ticks:0,velocity:1},{ticks:0,velocity:0},n);return Object.assign(r,t),(0,dt.insert)(this.notes,r,"ticks"),this},e.prototype.addCC=function(t){var n=Ze.get(this),r=new Zn.ControlChange({controllerType:t.number},n);return delete t.number,Object.assign(r,t),Array.isArray(this.controlChanges[r.number])||(this.controlChanges[r.number]=[]),(0,dt.insert)(this.controlChanges[r.number],r,"ticks"),this},e.prototype.addPitchBend=function(t){var n=Ze.get(this),r=new er.PitchBend({},n);return Object.assign(r,t),(0,dt.insert)(this.pitchBends,r,"ticks"),this},Object.defineProperty(e.prototype,"duration",{get:function(){if(!this.notes.length)return 0;for(var t=this.notes[this.notes.length-1].time+this.notes[this.notes.length-1].duration,n=0;n<this.notes.length-1;n++){var r=this.notes[n].time+this.notes[n].duration;t<r&&(t=r)}return t},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"durationTicks",{get:function(){if(!this.notes.length)return 0;for(var t=this.notes[this.notes.length-1].ticks+this.notes[this.notes.length-1].durationTicks,n=0;n<this.notes.length-1;n++){var r=this.notes[n].ticks+this.notes[n].durationTicks;t<r&&(t=r)}return t},enumerable:!1,configurable:!0}),e.prototype.fromJSON=function(t){var n=this;this.name=t.name,this.channel=t.channel,this.instrument=new Ut.Instrument(void 0,this),this.instrument.fromJSON(t.instrument),t.endOfTrackTicks!==void 0&&(this.endOfTrackTicks=t.endOfTrackTicks);for(var r in t.controlChanges)t.controlChanges[r]&&t.controlChanges[r].forEach(function(i){n.addCC({number:i.number,ticks:i.ticks,value:i.value})});t.notes.forEach(function(i){n.addNote({durationTicks:i.durationTicks,midi:i.midi,ticks:i.ticks,velocity:i.velocity})})},e.prototype.toJSON=function(){for(var t={},n=0;n<127;n++)this.controlChanges.hasOwnProperty(n)&&(t[n]=this.controlChanges[n].map(function(i){return i.toJSON()}));var r={channel:this.channel,controlChanges:t,pitchBends:this.pitchBends.map(function(i){return i.toJSON()}),instrument:this.instrument.toJSON(),name:this.name,notes:this.notes.map(function(i){return i.toJSON()})};return this.endOfTrackTicks!==void 0&&(r.endOfTrackTicks=this.endOfTrackTicks),r},e}();We.Track=nr;var lt={};function rr(e){var t=[];return rn(e,t),t}function rn(e,t){for(var n=0;n<e.length;n++){var r=e[n];Array.isArray(r)?rn(r,t):t.push(r)}}const ir=Object.freeze(Object.defineProperty({__proto__:null,flatten:rr},Symbol.toStringTag,{value:"Module"})),or=en(ir);var ke=Ae&&Ae.__spreadArray||function(e,t,n){if(n||arguments.length===2)for(var r=0,i=t.length,a;r<i;r++)(a||!(r in t))&&(a||(a=Array.prototype.slice.call(t,0,r)),a[r]=t[r]);return e.concat(a||Array.prototype.slice.call(t))};Object.defineProperty(lt,"__esModule",{value:!0});lt.encode=void 0;var ar=it,sr=tt,cr=or;function lr(e,t){return[{absoluteTime:e.ticks,channel:t,deltaTime:0,noteNumber:e.midi,type:"noteOn",velocity:Math.floor(e.velocity*127)},{absoluteTime:e.ticks+e.durationTicks,channel:t,deltaTime:0,noteNumber:e.midi,type:"noteOff",velocity:Math.floor(e.noteOffVelocity*127)}]}function ur(e){return(0,cr.flatten)(e.notes.map(function(t){return lr(t,e.channel)}))}function fr(e,t){return{absoluteTime:e.ticks,channel:t,controllerType:e.number,deltaTime:0,type:"controller",value:Math.floor(e.value*127)}}function dr(e){for(var t=[],n=0;n<127;n++)e.controlChanges.hasOwnProperty(n)&&e.controlChanges[n].forEach(function(r){t.push(fr(r,e.channel))});return t}function hr(e,t){return{absoluteTime:e.ticks,channel:t,deltaTime:0,type:"pitchBend",value:e.value}}function pr(e){var t=[];return e.pitchBends.forEach(function(n){t.push(hr(n,e.channel))}),t}function mr(e){return{absoluteTime:0,channel:e.channel,deltaTime:0,programNumber:e.instrument.number,type:"programChange"}}function gr(e){return{absoluteTime:0,deltaTime:0,meta:!0,text:e,type:"trackName"}}function br(e){return{absoluteTime:e.ticks,deltaTime:0,meta:!0,microsecondsPerBeat:Math.floor(6e7/e.bpm),type:"setTempo"}}function yr(e){return{absoluteTime:e.ticks,deltaTime:0,denominator:e.timeSignature[1],meta:!0,metronome:24,numerator:e.timeSignature[0],thirtyseconds:8,type:"timeSignature"}}function vr(e){var t=sr.keySignatureKeys.indexOf(e.key);return{absoluteTime:e.ticks,deltaTime:0,key:t+7,meta:!0,scale:e.scale==="major"?0:1,type:"keySignature"}}function _r(e){return{absoluteTime:e.ticks,deltaTime:0,meta:!0,text:e.text,type:e.type}}function kr(e){var t={header:{format:1,numTracks:e.tracks.length+1,ticksPerBeat:e.header.ppq},tracks:ke([ke(ke(ke(ke([{absoluteTime:0,deltaTime:0,meta:!0,text:e.header.name,type:"trackName"}],e.header.keySignatures.map(function(n){return vr(n)}),!0),e.header.meta.map(function(n){return _r(n)}),!0),e.header.tempos.map(function(n){return br(n)}),!0),e.header.timeSignatures.map(function(n){return yr(n)}),!0)],e.tracks.map(function(n){return ke(ke(ke([gr(n.name),mr(n)],ur(n),!0),dr(n),!0),pr(n),!0)}),!0)};return t.tracks=t.tracks.map(function(n){n=n.sort(function(i,a){return i.absoluteTime-a.absoluteTime});var r=0;return n.forEach(function(i){i.deltaTime=i.absoluteTime-r,r=i.absoluteTime,delete i.absoluteTime}),n.push({deltaTime:0,meta:!0,type:"endOfTrack"}),n}),new Uint8Array((0,ar.writeMidi)(t))}lt.encode=kr;(function(e){var t=Ae&&Ae.__awaiter||function(h,l,f,d){function p(g){return g instanceof f?g:new f(function(T){T(g)})}return new(f||(f=Promise))(function(g,T){function O(S){try{I(d.next(S))}catch(q){T(q)}}function V(S){try{I(d.throw(S))}catch(q){T(q)}}function I(S){S.done?g(S.value):p(S.value).then(O,V)}I((d=d.apply(h,l||[])).next())})},n=Ae&&Ae.__generator||function(h,l){var f={label:0,sent:function(){if(g[0]&1)throw g[1];return g[1]},trys:[],ops:[]},d,p,g,T;return T={next:O(0),throw:O(1),return:O(2)},typeof Symbol=="function"&&(T[Symbol.iterator]=function(){return this}),T;function O(I){return function(S){return V([I,S])}}function V(I){if(d)throw new TypeError("Generator is already executing.");for(;f;)try{if(d=1,p&&(g=I[0]&2?p.return:I[0]?p.throw||((g=p.return)&&g.call(p),0):p.next)&&!(g=g.call(p,I[1])).done)return g;switch(p=0,g&&(I=[I[0]&2,g.value]),I[0]){case 0:case 1:g=I;break;case 4:return f.label++,{value:I[1],done:!1};case 5:f.label++,p=I[1],I=[0];continue;case 7:I=f.ops.pop(),f.trys.pop();continue;default:if(g=f.trys,!(g=g.length>0&&g[g.length-1])&&(I[0]===6||I[0]===2)){f=0;continue}if(I[0]===3&&(!g||I[1]>g[0]&&I[1]<g[3])){f.label=I[1];break}if(I[0]===6&&f.label<g[1]){f.label=g[1],g=I;break}if(g&&f.label<g[2]){f.label=g[2],f.ops.push(I);break}g[2]&&f.ops.pop(),f.trys.pop();continue}I=l.call(h,f)}catch(S){I=[6,S],p=0}finally{d=g=0}if(I[0]&5)throw I[1];return{value:I[0]?I[1]:void 0,done:!0}}};Object.defineProperty(e,"__esModule",{value:!0}),e.Header=e.Track=e.Midi=void 0;var r=it,i=tt,a=We,o=lt,s=function(){function h(l){var f=this,d=null;if(l){var p=l instanceof ArrayBuffer?new Uint8Array(l):l;d=(0,r.parseMidi)(p),d.tracks.forEach(function(g){var T=0;g.forEach(function(O){T+=O.deltaTime,O.absoluteTime=T})}),d.tracks=m(d.tracks)}this.header=new i.Header(d),this.tracks=[],l&&(this.tracks=d.tracks.map(function(g){return new a.Track(g,f.header)}),d.header.format===1&&this.tracks[0].duration===0&&this.tracks.shift())}return h.fromUrl=function(l){return t(this,void 0,void 0,function(){var f,d;return n(this,function(p){switch(p.label){case 0:return[4,fetch(l)];case 1:return f=p.sent(),f.ok?[4,f.arrayBuffer()]:[3,3];case 2:return d=p.sent(),[2,new h(d)];case 3:throw new Error("Could not load '".concat(l,"'"))}})})},Object.defineProperty(h.prototype,"name",{get:function(){return this.header.name},set:function(l){this.header.name=l},enumerable:!1,configurable:!0}),Object.defineProperty(h.prototype,"duration",{get:function(){var l=this.tracks.map(function(f){return f.duration});return Math.max.apply(Math,l)},enumerable:!1,configurable:!0}),Object.defineProperty(h.prototype,"durationTicks",{get:function(){var l=this.tracks.map(function(f){return f.durationTicks});return Math.max.apply(Math,l)},enumerable:!1,configurable:!0}),h.prototype.addTrack=function(){var l=new a.Track(void 0,this.header);return this.tracks.push(l),l},h.prototype.toArray=function(){return(0,o.encode)(this)},h.prototype.toJSON=function(){return{header:this.header.toJSON(),tracks:this.tracks.map(function(l){return l.toJSON()})}},h.prototype.fromJSON=function(l){var f=this;this.header=new i.Header,this.header.fromJSON(l.header),this.tracks=l.tracks.map(function(d){var p=new a.Track(void 0,f.header);return p.fromJSON(d),p})},h.prototype.clone=function(){var l=new h;return l.fromJSON(this.toJSON()),l},h}();e.Midi=s;var u=We;Object.defineProperty(e,"Track",{enumerable:!0,get:function(){return u.Track}});var c=tt;Object.defineProperty(e,"Header",{enumerable:!0,get:function(){return c.Header}});function m(h){for(var l=[],f=0;f<h.length;f++)for(var d=l.length,p=new Map,g=Array(16).fill(0),T=0,O=h[f];T<O.length;T++){var V=O[T],I=d,S=V.channel;if(S!==void 0){V.type==="programChange"&&(g[S]=V.programNumber);var q=g[S],w="".concat(q," ").concat(S);p.has(w)?I=p.get(w):(I=d+p.size,p.set(w,I))}l[I]||l.push([]),l[I].push(V)}return l}})(yt);const xe=[];function ie(e,t=G){let n;const r=new Set;function i(s){if(Ne(e,s)&&(e=s,n)){const u=!xe.length;for(const c of r)c[1](),xe.push(c,e);if(u){for(let c=0;c<xe.length;c+=2)xe[c][0](xe[c+1]);xe.length=0}}}function a(s){i(s(e))}function o(s,u=G){const c=[s,u];return r.add(c),r.size===1&&(n=t(i,a)||G),s(e),()=>{r.delete(c),r.size===0&&n&&(n(),n=null)}}return{set:i,update:a,subscribe:o}}const Be=["C","C#","D","D#","E","F","F#","G","G#","A","A#","B"],Mt={Backquote:"A#2",Tab:"B2",KeyQ:"C3",Digit2:"C#3",KeyW:"D3",Digit3:"D#3",KeyE:"E3",KeyR:"F3",Digit5:"F#3",KeyT:"G3",Digit6:"G#3",KeyY:"A3",Digit7:"A#3",KeyU:"B3",KeyI:"C4",Digit9:"C#4",KeyO:"D4",Digit0:"D#4",KeyP:"E4",BracketLeft:"F4",Equal:"F#4",BracketRight:"G4",Backspace:"G#4",Backslash:"A4",CapsLock:"A#4",Escape:"A#4",ShiftLeft:"B4",KeyZ:"C5",KeyS:"C#5",KeyX:"D5",KeyD:"D#5",KeyC:"E5",KeyV:"F5",KeyG:"F#5",KeyB:"G5",KeyH:"G#5",KeyN:"A5",KeyJ:"A#5",KeyM:"B5",Comma:"C6",KeyL:"C#6",Period:"D6",Semicolon:"D#6",Slash:"E6",ShiftRight:"F6",Enter:"F#6"},wr={"A#2":"`",B2:"↹",C3:"Q","C#3":"2",D3:"W","D#3":"3",E3:"E",F3:"R","F#3":"5",G3:"T","G#3":"6",A3:"Y","A#3":"7",B3:"U",C4:"I","C#4":"9",D4:"O","D#4":"0",E4:"P",F4:"[","F#4":"=",G4:"]","G#4":"⌫",A4:"\\","A#4":"⇪",B4:"⇧",C5:"Z","C#5":"S",D5:"X","D#5":"D",E5:"C",F5:"V","F#5":"G",G5:"B","G#5":"H",A5:"N","A#5":"J",B5:"M",C6:",","C#6":"L",D6:".","D#6":";",E6:"/",F6:"⇧","F#6":"↩"};function vt(e){return parseInt(e.charAt(e.length-1))}function nt(e){return e.substring(0,e.length-1)}function Le(e){const t=Math.floor(e/12)-1;return Be[e%12]+t}function rt(e){const t=Be.indexOf(nt(e));return(vt(e)+1)*12+t}function Tr(e){const[t,n]=e.split(","),r=vt(n),i=vt(t),a=Be.indexOf(nt(t)),o=Be.indexOf(nt(n)),s={};let u=0,c=a;for(let m=i;m<=r;m++){for(;c<Be.length&&!(m===r&&c>o);){const h=Be[c],l=h.length===1;s[h+m]={isWhite:l,pressedColor:null},l&&u++,c++}c=0}return[s,u]}var on={exports:{}},an={exports:{}};function Ir(e){return e>64&&e<91?e-65:e>96&&e<123?e-71:e>47&&e<58?e+4:e===43?62:e===47?63:0}function Cr(e,t){for(var n=e.replace(/[^A-Za-z0-9\+\/]/g,""),r=n.length,i=t?Math.ceil((r*3+1>>2)/t)*t:r*3+1>>2,a=new Uint8Array(i),o,s,u=0,c=0,m=0;m<r;m++)if(s=m&3,u|=Ir(n.charCodeAt(m))<<18-6*s,s===3||r-m===1){for(o=0;o<3&&c<i;o++,c++)a[c]=u>>>(16>>>o&24)&255;u=0}return a}var Sr={decode:Cr},Pr=function(e,t){return new Promise(function(n,r){var i=new XMLHttpRequest;t&&(i.responseType=t),i.open("GET",e),i.onload=function(){i.status===200?n(i.response):r(Error(i.statusText))},i.onerror=function(){r(Error("Network Error"))},i.send()})};(function(e){var t=Sr,n=Pr;function r(w){return function(_){return typeof _=="string"&&w.test(_)}}function i(w,_){return typeof w=="string"?w+_:typeof w=="function"?w(_):_}function a(w,_,M,P){var Y=o(_)?s:u(_)?c:m(_)?h:l(_)?f:d(_)?p:g(_)?T:O(_)?V:I(_)?S:null,L=M||{};return Y?Y(w,_,L):P?Promise.resolve(P):Promise.reject("Source not valid ("+_+")")}a.fetch=n;function o(w){return w instanceof ArrayBuffer}function s(w,_,M){return new Promise(function(P,Y){w.decodeAudioData(_,function(L){P(L)},function(){Y("Can't decode audio data ("+_.slice(0,30)+"...)")})})}var u=r(/\.(mp3|wav|ogg)(\?.*)?$/i);function c(w,_,M){var P=i(M.from,_);return a(w,a.fetch(P,"arraybuffer"),M)}function m(w){return w&&typeof w.then=="function"}function h(w,_,M){return _.then(function(P){return a(w,P,M)})}var l=Array.isArray;function f(w,_,M){return Promise.all(_.map(function(P){return a(w,P,M,P)}))}function d(w){return w&&typeof w=="object"}function p(w,_,M){var P={},Y=Object.keys(_).map(function(L){if(M.only&&M.only.indexOf(L)===-1)return null;var ae=_[L];return a(w,ae,M,ae).then(function(A){P[L]=A})});return Promise.all(Y).then(function(){return P})}var g=r(/\.json(\?.*)?$/i);function T(w,_,M){var P=i(M.from,_);return a(w,a.fetch(P,"text").then(JSON.parse),M)}var O=r(/^data:audio/);function V(w,_,M){var P=_.indexOf(",");return a(w,t.decode(_.slice(P+1)).buffer,M)}var I=r(/\.js(\?.*)?$/i);function S(w,_,M){var P=i(M.from,_);return a(w,a.fetch(P,"text").then(q),M)}function q(w){var _=w.indexOf("MIDI.Soundfont.");if(_<0)throw Error("Invalid MIDI.js Soundfont format");_=w.indexOf("=",_)+2;var M=w.lastIndexOf(",");return JSON.parse(w.slice(_,M)+"}")}e.exports&&(e.exports=a),typeof window<"u"&&(window.loadAudio=a)})(an);var Nr=an.exports,sn={exports:{}},Ur=Mr;function Mr(e){var t=e.createGain(),n=t._voltage=Or(e),r=Fe(n),i=Fe(n),a=Fe(n);return t._startAmount=Fe(i),t._endAmount=Fe(a),t._multiplier=Fe(r),t._multiplier.connect(t),t._startAmount.connect(t),t._endAmount.connect(t),t.value=r.gain,t.startValue=i.gain,t.endValue=a.gain,t.startValue.value=0,t.endValue.value=0,Object.defineProperties(t,xr),t}var xr={attack:{value:0,writable:!0},decay:{value:0,writable:!0},sustain:{value:1,writable:!0},release:{value:0,writable:!0},getReleaseDuration:{value:function(){return this.release}},start:{value:function(e){var t=this._multiplier.gain,n=this._startAmount.gain,r=this._endAmount.gain;this._voltage.start(e),this._decayFrom=this._decayFrom=e+this.attack,this._startedAt=e;var i=this.sustain;t.cancelScheduledValues(e),n.cancelScheduledValues(e),r.cancelScheduledValues(e),r.setValueAtTime(0,e),this.attack?(t.setValueAtTime(0,e),t.linearRampToValueAtTime(1,e+this.attack),n.setValueAtTime(1,e),n.linearRampToValueAtTime(0,e+this.attack)):(t.setValueAtTime(1,e),n.setValueAtTime(0,e)),this.decay&&t.setTargetAtTime(i,this._decayFrom,xt(this.decay))}},stop:{value:function(e,t){t&&(e=e-this.release);var n=e+this.release;if(this.release){var r=this._multiplier.gain,i=this._startAmount.gain,a=this._endAmount.gain;r.cancelScheduledValues(e),i.cancelScheduledValues(e),a.cancelScheduledValues(e);var o=xt(this.release);if(this.attack&&e<this._decayFrom){var s=Ar(0,1,this._startedAt,this._decayFrom,e);r.linearRampToValueAtTime(s,e),i.linearRampToValueAtTime(1-s,e),i.setTargetAtTime(0,e,o)}a.setTargetAtTime(1,e,o),r.setTargetAtTime(0,e,o)}return this._voltage.stop(n),n}},onended:{get:function(){return this._voltage.onended},set:function(e){this._voltage.onended=e}}},Fr=new Float32Array([1,1]);function Or(e){var t=e.createBufferSource(),n=e.createBuffer(1,2,e.sampleRate);return n.getChannelData(0).set(Fr),t.buffer=n,t.loop=!0,t}function Fe(e){var t=e.context.createGain();return e.connect(t),t}function xt(e){return Math.log(e+1)/Math.log(100)}function Ar(e,t,n,r,i){var a=t-e,o=r-n,s=i-n,u=s/o,c=e+u*a;return c<=e&&(c=e),c>=t&&(c=t),c}var Br=Ur,Er={},Dr={gain:1,attack:.01,decay:.1,sustain:.9,release:.3,loop:!1,cents:0,loopStart:0,loopEnd:0};function jr(e,t,n){var r=!1,i=0,a={},o=e.createGain();o.gain.value=1;var s=Object.assign({},Dr,n),u={context:e,out:o,opts:s};return t instanceof AudioBuffer?u.buffer=t:u.buffers=t,u.start=function(h,l,f){if(u.buffer&&h!==null)return u.start(null,h,l);var d=h?u.buffers[h]:u.buffer;if(d){if(!r){console.warn("SamplePlayer not connected to any node.");return}}else{console.warn("Buffer "+h+" not found.");return}var p=f||Er;l=Math.max(e.currentTime,l||0),u.emit("start",l,h,p);var g=m(h,d,p);return g.id=c(h,g),g.env.start(l),g.source.start(l),u.emit("started",l,g.id,g),p.duration&&g.stop(l+p.duration),g},u.play=function(h,l,f){return u.start(h,l,f)},u.stop=function(h,l){var f;return l=l||Object.keys(a),l.map(function(d){return f=a[d],f?(f.stop(h),f.id):null})},u.connect=function(h){return r=!0,o.connect(h),u},u.emit=function(h,l,f,d){u.onevent&&u.onevent(h,l,f,d);var p=u["on"+h];p&&p(l,f,d)},u;function c(h,l){return l.id=i++,a[l.id]=l,l.source.onended=function(){var f=e.currentTime;l.source.disconnect(),l.env.disconnect(),l.disconnect(),u.emit("ended",f,l.id,l)},l.id}function m(h,l,f){var d=e.createGain();return d.gain.value=0,d.connect(o),d.env=Vr(e,f,s),d.env.connect(d.gain),d.source=e.createBufferSource(),d.source.buffer=l,d.source.connect(d),d.source.loop=f.loop||s.loop,d.source.playbackRate.value=qr(f.cents||s.cents),d.source.loopStart=f.loopStart||s.loopStart,d.source.loopEnd=f.loopEnd||s.loopEnd,d.stop=function(p){var g=p||e.currentTime;u.emit("stop",g,h);var T=d.env.stop(g);d.source.stop(T)},d}}function Ft(e){return typeof e=="number"}var Rr=["attack","decay","sustain","release"];function Vr(e,t,n){var r=Br(e),i=t.adsr||n.adsr;return Rr.forEach(function(a,o){i?r[a]=i[o]:r[a]=t[a]||n[a]}),r.value.value=Ft(t.gain)?t.gain:Ft(n.gain)?n.gain:1,r}function qr(e){return e?Math.pow(2,e/1200):1}var Lr=jr,Hr=function(e){return e.on=function(t,n){if(arguments.length===1&&typeof t=="function")return e.on("event",t);var r="on"+t,i=e[r];return e[r]=i?Kr(i,n):n,e},e};function Kr(e,t){return function(n,r,i,a){e(n,r,i,a),t(n,r,i,a)}}var cn=/^([a-gA-G])(#{1,}|b{1,}|x{1,}|)(-?\d*)\s*(.*)\s*$/;function Gr(){return cn}var Jr=[0,2,4,5,7,9,11];function ln(e,t,n){if(typeof e!="string")return null;var r=cn.exec(e);if(!r||!t&&r[4])return null;var i={letter:r[1].toUpperCase(),acc:r[2].replace(/x/g,"##")};return i.pc=i.letter+i.acc,i.step=(i.letter.charCodeAt(0)+3)%7,i.alt=i.acc[0]==="b"?-i.acc.length:i.acc.length,i.chroma=Jr[i.step]+i.alt,r[3]&&(i.oct=+r[3],i.midi=i.chroma+12*(i.oct+1),i.freq=un(i.midi,n)),t&&(i.tonicOf=r[4]),i}function un(e,t){return Math.pow(2,(e-69)/12)*(t||440)}var fn={parse:ln,regex:Gr,midiToFreq:un},zr=["letter","acc","pc","step","alt","chroma","oct","midi","freq"];zr.forEach(function(e){fn[e]=function(t){var n=ln(t);return n&&typeof n[e]<"u"?n[e]:null}});var Wr=fn,$r=Wr,Yr=function(e){return e!==null&&e!==[]&&e>=0&&e<129},Xr=function(e){return Yr(e)?+e:$r.midi(e)},Zr=function(e){if(e.buffers){var t=e.opts.map,n=typeof t=="function"?t:Xr,r=function(a){return a?n(a)||a:null};e.buffers=Qr(e.buffers,r);var i=e.start;e.start=function(a,o,s){var u=r(a),c=u%1;return c&&(u=Math.floor(u),s=Object.assign(s||{},{cents:Math.floor(c*100)})),i(u,o,s)}}return e};function Qr(e,t){return Object.keys(e).reduce(function(n,r){return n[t(r)]=e[r],n},{})}var ei=Array.isArray,ti=function(e){return e&&typeof e=="object"},ni={},ri=function(e){return e.schedule=function(t,n){var r=e.context.currentTime,i=t<r?r:t;e.emit("schedule",i,n);var a,o,s,u;return n.map(function(c){if(c)ei(c)?(a=c[0],o=c[1]):(a=c.time,o=c);else return null;return ti(o)?(s=o.name||o.key||o.note||o.midi||null,u=o):(s=o,u=ni),e.start(s,i+(a||0),u)})},e};function Qe(e){throw new Error('Could not dynamically require "'+e+'". Please configure the dynamicRequireTargets or/and ignoreDynamicRequires option of @rollup/plugin-commonjs appropriately for this require call to work.')}var dn={exports:{}};(function(e,t){(function(n){e.exports=n()})(function(){return function n(r,i,a){function o(c,m){if(!i[c]){if(!r[c]){var h=typeof Qe=="function"&&Qe;if(!m&&h)return h(c,!0);if(s)return s(c,!0);var l=new Error("Cannot find module '"+c+"'");throw l.code="MODULE_NOT_FOUND",l}var f=i[c]={exports:{}};r[c][0].call(f.exports,function(d){var p=r[c][1][d];return o(p||d)},f,f.exports,n,r,i,a)}return i[c].exports}for(var s=typeof Qe=="function"&&Qe,u=0;u<a.length;u++)o(a[u]);return o}({1:[function(n,r,i){Object.defineProperty(i,"__esModule",{value:!0}),i.default=function(a){function o(s){if(this._event=s,this._data=s.data,this.receivedTime=s.receivedTime,this._data&&this._data.length<2){console.warn("Illegal MIDI message of length",this._data.length);return}switch(this._messageCode=s.data[0]&240,this.channel=s.data[0]&15,this._messageCode){case 128:this.messageType="noteoff",this.key=s.data[1]&127,this.velocity=s.data[2]&127;break;case 144:this.messageType="noteon",this.key=s.data[1]&127,this.velocity=s.data[2]&127;break;case 160:this.messageType="keypressure",this.key=s.data[1]&127,this.pressure=s.data[2]&127;break;case 176:this.messageType="controlchange",this.controllerNumber=s.data[1]&127,this.controllerValue=s.data[2]&127,this.controllerNumber===120&&this.controllerValue===0?this.channelModeMessage="allsoundoff":this.controllerNumber===121?this.channelModeMessage="resetallcontrollers":this.controllerNumber===122?this.controllerValue===0?this.channelModeMessage="localcontroloff":this.channelModeMessage="localcontrolon":this.controllerNumber===123&&this.controllerValue===0?this.channelModeMessage="allnotesoff":this.controllerNumber===124&&this.controllerValue===0?this.channelModeMessage="omnimodeoff":this.controllerNumber===125&&this.controllerValue===0?this.channelModeMessage="omnimodeon":this.controllerNumber===126?this.channelModeMessage="monomodeon":this.controllerNumber===127&&(this.channelModeMessage="polymodeon");break;case 192:this.messageType="programchange",this.program=s.data[1];break;case 208:this.messageType="channelpressure",this.pressure=s.data[1]&127;break;case 224:this.messageType="pitchbendchange";var u=s.data[2]&127,c=s.data[1]&127;this.pitchBend=(u<<8)+c;break}}return new o(a)},r.exports=i.default},{}]},{},[1])(1)})})(dn);var ii=dn.exports,oi=ii,ai=function(e){return e.listenToMidi=function(t,n){var r={},i=n||{},a=i.gain||function(o){return o/127};return t.onmidimessage=function(o){var s=o.messageType?o:oi(o);if(s.messageType==="noteon"&&s.velocity===0&&(s.messageType="noteoff"),!(i.channel&&s.channel!==i.channel))switch(s.messageType){case"noteon":r[s.key]=e.play(s.key,0,{gain:a(s.velocity)});break;case"noteoff":r[s.key]&&(r[s.key].stop(),delete r[s.key]);break}},e},e};(function(e){var t=Lr,n=Hr,r=Zr,i=ri,a=ai;function o(s,u,c){return a(i(r(n(t(s,u,c)))))}e.exports&&(e.exports=o),typeof window<"u"&&(window.SamplePlayer=o)})(sn);var si=sn.exports;function Ot(e,t){return Array(t+1).join(e)}function wt(e){return typeof e=="number"}function ci(e){return typeof e=="string"}function li(e){return typeof e<"u"}function hn(e,t){return Math.pow(2,(e-69)/12)*(t||440)}var pn=/^([a-gA-G])(#{1,}|b{1,}|x{1,}|)(-?\d*)\s*(.*)\s*$/;function ui(){return pn}var fi=[0,2,4,5,7,9,11];function ve(e,t,n){if(typeof e!="string")return null;var r=pn.exec(e);if(!r||!t&&r[4])return null;var i={letter:r[1].toUpperCase(),acc:r[2].replace(/x/g,"##")};i.pc=i.letter+i.acc,i.step=(i.letter.charCodeAt(0)+3)%7,i.alt=i.acc[0]==="b"?-i.acc.length:i.acc.length;var a=fi[i.step]+i.alt;return i.chroma=a<0?12+a:a%12,r[3]&&(i.oct=+r[3],i.midi=a+12*(i.oct+1),i.freq=hn(i.midi,n)),t&&(i.tonicOf=r[4]),i}var di="CDEFGAB";function hi(e){return wt(e)?e<0?Ot("b",-e):Ot("#",e):""}function pi(e){return wt(e)?""+e:""}function mn(e,t,n){return e===null||typeof e>"u"?null:e.step?mn(e.step,e.alt,e.oct):e<0||e>6?null:di.charAt(e)+hi(t)+pi(n)}function gn(e){if((wt(e)||ci(e))&&e>=0&&e<128)return+e;var t=ve(e);return t&&li(t.midi)?t.midi:null}function mi(e,t){var n=gn(e);return n===null?null:hn(n,t)}function gi(e){return(ve(e)||{}).letter}function bi(e){return(ve(e)||{}).acc}function yi(e){return(ve(e)||{}).pc}function vi(e){return(ve(e)||{}).step}function _i(e){return(ve(e)||{}).alt}function ki(e){return(ve(e)||{}).chroma}function wi(e){return(ve(e)||{}).oct}const Ti=Object.freeze(Object.defineProperty({__proto__:null,acc:bi,alt:_i,build:mn,chroma:ki,freq:mi,letter:gi,midi:gn,oct:wi,parse:ve,pc:yi,regex:ui,step:vi},Symbol.toStringTag,{value:"Module"})),Ii=en(Ti);var ht,At;function Ci(){if(At)return ht;At=1;var e=Ii;function t(i,a){if(console.warn("new Soundfont() is deprected"),console.log("Please use Soundfont.instrument() instead of new Soundfont().instrument()"),!(this instanceof t))return new t(i);this.nameToUrl=a||t.nameToUrl,this.ctx=i,this.instruments={},this.promises=[]}t.prototype.onready=function(i){console.warn("deprecated API"),console.log("Please use Promise.all(Soundfont.instrument(), Soundfont.instrument()).then() instead of new Soundfont().onready()"),Promise.all(this.promises).then(i)},t.prototype.instrument=function(i,a){console.warn("new Soundfont().instrument() is deprecated."),console.log("Please use Soundfont.instrument() instead.");var o=this.ctx;if(i=i||"default",i in this.instruments)return this.instruments[i];var s={name:i,play:r(o,a)};if(this.instruments[i]=s,i!=="default"){var u=t.instrument(o,i,a).then(function(c){return s.play=c.play,s});this.promises.push(u),s.onready=function(c){console.warn("onready is deprecated. Use Soundfont.instrument().then()"),u.then(c)}}else s.onready=function(c){console.warn("onready is deprecated. Use Soundfont.instrument().then()"),c()};return s};function n(i,a,o){return console.warn("Soundfont.loadBuffers is deprecate."),console.log("Use Soundfont.instrument(..) and get buffers properties from the result."),t.instrument(i,a,o).then(function(s){return s.buffers})}t.loadBuffers=n;function r(i,a){return a=a||{},function(o,s,u,c){console.warn("The oscillator player is deprecated."),console.log("Starting with version 0.9.0 you will have to wait until the soundfont is loaded to play sounds.");var m=o>0&&o<129?+o:e.midi(o),h=m?e.midiToFreq(m,440):null;if(h){u=u||.2,c=c||{};var l=c.destination||a.destination||i.destination,f=c.vcoType||a.vcoType||"sine",d=c.gain||a.gain||.4,p=i.createOscillator();p.type=f,p.frequency.value=h;var g=i.createGain();return g.gain.value=d,p.connect(g),g.connect(l),p.start(s),u>0&&p.stop(s+u),p}}}return t.noteToMidi=e.midi,ht=t,ht}(function(e){var t=Nr,n=si;function r(s,u,c){if(arguments.length===1)return function(d,p){return r(s,d,p)};var m=c||{},h=m.isSoundfontURL||i,l=m.nameToUrl||a,f=h(u)?u:l(u,m.soundfont,m.format);return t(s,f,{only:m.only||m.notes}).then(function(d){var p=n(s,d,m).connect(m.destination?m.destination:s.destination);return p.url=f,p.name=u,p})}function i(s){return/\.js(\?.*)?$/i.test(s)}function a(s,u,c){return c=c==="ogg"?c:"mp3",u=u==="FluidR3_GM"?u:"MusyngKite","https://gleitz.github.io/midi-js-soundfonts/"+u+"/"+s+"-"+c+".js"}var o=Ci();o.instrument=r,o.nameToUrl=a,e.exports&&(e.exports=o),typeof window<"u"&&(window.Soundfont=o)})(on);var Si=on.exports;const bn=window.AudioContext||window.webkitAudioContext,Pi=new bn;bn||alert("Your browser does not seem to support the Web Audio API!");const pt={};function Ni(e){return pt[e]||(pt[e]=Si.instrument(Pi,e)),pt[e]}function Ui(e,t){if(!e||e.length==0)return 0;let n=0,r=e.length-1;for(;n!=r;){const i=Math.ceil((n+r)/2);t(e[i])>=0?r=i-1:n=i}return r}function Mi(e,t){e[t]=e[e.length-1],e.pop()}function yn(e){return e.split("_").map(r=>r.charAt(0).toUpperCase()+r.slice(1)).join(" ")}class xi{constructor(){x(this,"isPlaying",ie(!1));x(this,"currentTime",ie(0));x(this,"totalTime",ie(0));x(this,"speed",ie(1));x(this,"isRecording",ie(!1));x(this,"selectedTrack",ie(0));x(this,"data",new yt.Midi);x(this,"tracks",ie(this.data.tracks));x(this,"shouldPlaySolo",ie(!1));x(this,"lastStartFunc",()=>{});x(this,"tracksIndexUpTo",[]);x(this,"loopIntervalID",null);x(this,"playingHeldNotes",[]);x(this,"recordingHeldNotes",new Map);x(this,"recoringMidiData",null);x(this,"midiLastStartTime",0);x(this,"onPlayNote");x(this,"onStopNote");this.tracks.subscribe(t=>{const n=t.length==0?0:this.data.duration;this.totalTime.set(n),this.currentTime.set(Math.min(n,ee(this.currentTime)))})}startPlaying(){this.recalcPlayIndex(),this.startLoop(t=>{this.onPlayUpdate(t),t>ee(this.totalTime)&&(this.stop(),this.lastStartFunc=()=>{},this.currentTime.set(0))}),this.isPlaying.set(!0),this.lastStartFunc=this.startPlaying.bind(this),this.midiLastStartTime=ee(this.currentTime)}startRecording(){this.data.tracks.length==0&&this.addTrack(),this.data.tracks[ee(this.selectedTrack)].notes=[],this.recoringMidiData=this.data.clone(),this.recalcPlayIndex(),this.isRecording.set(!0),this.lastStartFunc=this.startRecording.bind(this),this.midiLastStartTime=ee(this.currentTime)}stop(){clearInterval(this.loopIntervalID),this.loopIntervalID=null,this.playingHeldNotes.forEach(t=>this.onStopNote(t.name)),this.playingHeldNotes=[],this.isPlaying.set(!1),this.recoringMidiData&&(this.data=this.recoringMidiData,this.recoringMidiData=null,this.tracks.set(this.data.tracks)),this.isRecording.set(!1),this.recordingHeldNotes.clear()}recordPlayNote(t,n){if(!ee(this.isRecording))return;this.loopIntervalID===null&&this.startLoop(i=>{this.onPlayUpdate(i),i>ee(this.totalTime)&&this.totalTime.set(i)});const r=rt(t);this.recordingHeldNotes.set(r,{midi:r,velocity:n,time:ee(this.currentTime)})}recordStopNote(t){if(!ee(this.isRecording))return;const n=rt(t),r=this.recordingHeldNotes.get(n);r&&(r.duration=ee(this.currentTime)-r.time,this.recoringMidiData.tracks[ee(this.selectedTrack)].addNote(r),this.recordingHeldNotes.delete(n))}addTrack(){const t=this.data.addTrack();this.selectedTrack.set(this.data.tracks.length-1),this.tracks.set(this.data.tracks);const n=prompt("Enter the track name: ");n&&(t.name=n)}deleteTrack(){const t=ee(this.selectedTrack);this.data.tracks.splice(t,1),this.selectedTrack.set(Math.min(this.data.tracks.length-1,t)),this.tracks.set(this.data.tracks)}saveFile(){const t=new Blob([this.data.toArray()],{type:"application/octet-stream"}),n=URL.createObjectURL(t),r=document.createElement("a");r.href=n,r.download="record.midi",document.body.appendChild(r),r.click(),document.body.removeChild(r),URL.revokeObjectURL(n)}setFile(t){if(!t)return;const n=new FileReader;n.onload=()=>{this.data=new yt.Midi(n.result),this.tracks.set(this.data.tracks),this.selectedTrack.set(0)},n.readAsArrayBuffer(t)}stopAndReseek(){this.stop(),this.lastStartFunc=()=>{},this.currentTime.set(this.midiLastStartTime)}recalcPlayIndex(){this.data.tracks.forEach((t,n)=>{const r=ee(this.currentTime);this.tracksIndexUpTo[n]=Ui(t.notes,i=>i.time-r)})}startLoop(t){let n=performance.now();this.loopIntervalID=setInterval(()=>{const r=performance.now(),a=(r-n)/1e3*ee(this.speed),o=ee(this.currentTime)+a;this.currentTime.set(o),t(o),n=r},10)}onPlayUpdate(t){if(this.playingHeldNotes.forEach((n,r)=>{t>n.time+n.duration&&(this.onStopNote(n.name),Mi(this.playingHeldNotes,r))}),ee(this.shouldPlaySolo)){const n=ee(this.selectedTrack);this.checkTracksPlayNotes(t,n)}else for(let n=0;n<this.data.tracks.length;n++)this.checkTracksPlayNotes(t,n)}checkTracksPlayNotes(t,n){const r=this.data.tracks[n];for(;;){const i=r.notes[this.tracksIndexUpTo[n]];if(!i||t<i.time)break;i.time+i.duration>t&&(this.onPlayNote(i.name,i.velocity),this.playingHeldNotes.push(i)),this.tracksIndexUpTo[n]++}}}function Bt(e,t,n){const r=e.slice();return r[39]=t[n][0],r[40]=t[n][1].isWhite,r[41]=t[n][1].pressedColor,r}function Et(e){let t,n=e[18](e[39],e[6],e[5],e[4])+"",r,i,a,o,s;function u(...l){return e[27](e[39],...l)}function c(){return e[28](e[39])}function m(){return e[29](e[39])}function h(){return e[30](e[39])}return{c(){t=v("div"),r=oe(n),i=F(),k(t,"class",a="key "+(e[40]?"white":"black")+" svelte-1569eu9"),Ce(t,"--color-hue",e[41]),Ct(t,"pressed",e[41]!==null)},m(l,f){E(l,t,f),b(t,r),b(t,i),o||(s=[U(t,"pointerdown",u),U(t,"pointerenter",c),U(t,"pointerleave",m),U(t,"pointerup",h)],o=!0)},p(l,f){e=l,f[0]&120&&n!==(n=e[18](e[39],e[6],e[5],e[4])+"")&&Je(r,n),f[0]&8&&a!==(a="key "+(e[40]?"white":"black")+" svelte-1569eu9")&&k(t,"class",a),f[0]&8&&Ce(t,"--color-hue",e[41]),f[0]&8&&Ct(t,"pressed",e[41]!==null)},d(l){l&&B(t),o=!1,pe(s)}}}function Fi(e){let t,n,r,i,a=ye(Object.entries(e[3])),o=[];for(let s=0;s<a.length;s+=1)o[s]=Et(Bt(e,a,s));return{c(){t=v("div"),n=v("div");for(let s=0;s<o.length;s+=1)o[s].c();k(n,"class","piano svelte-1569eu9"),k(t,"class","piano-container svelte-1569eu9")},m(s,u){E(s,t,u),b(t,n);for(let c=0;c<o.length;c+=1)o[c]&&o[c].m(n,null);e[31](t),r||(i=[U(window,"resize",e[24]),U(window,"keyup",e[17]),U(window,"keydown",e[16]),U(window,"pointerdown",e[25]),U(window,"pointerup",e[26]),U(n,"touchstart",In(e[23]))],r=!0)},p(s,u){if(u[0]&286842){a=ye(Object.entries(s[3]));let c;for(c=0;c<a.length;c+=1){const m=Bt(s,a,c);o[c]?o[c].p(m,u):(o[c]=Et(m),o[c].c(),o[c].m(n,null))}for(;c<o.length;c+=1)o[c].d(1);o.length=a.length}},i:G,o:G,d(s){s&&B(t),Ge(o,s),e[31](null),r=!1,pe(i)}}}function Oi(e,t,n){let r,i,a,o,s,u,c,m,h=!1,l,f=new Map,{pianoControlsData:d}=t,{noteRange:p,sustain:g,noteShift:T,octaveShift:O,volume:V,labelType:I}=d;z(e,p,y=>n(22,c=y)),z(e,g,y=>n(32,a=y)),z(e,T,y=>n(5,u=y)),z(e,O,y=>n(4,s=y)),z(e,V,y=>n(33,o=y)),z(e,I,y=>n(6,m=y));let{midiPlayer:S}=t;S.onPlayNote=_,S.onStopNote=M;let{socketPlayer:q}=t;q.onPlayNote=({note:y,volume:N},W)=>{r[y]&&n(3,r[y].pressedColor=W.colorHue,r),W.playAudio(y,N)},q.onStopNote=({note:y,sustain:N},W)=>{r[y]&&n(3,r[y].pressedColor=null,r),N||W.stopAudio(y)};function w(y){const N=rt(y)+u+s*12;return Le(N)}function _(y,N=.5,W=!0){const X=w(y);if(f.has(X))if(W)M(y);else return;f.set(X,!0),q.playNote(X,o*N),this!==S&&S.recordPlayNote(y,N)}function M(y){const N=w(y);f.has(N)&&(f.delete(N),q.stopNote(N,a),this!==S&&S.recordStopNote(y))}g.subscribe(y=>{if(!y)for(const N of q.localClient.audioNodeMap.keys())f.get(N)||q.stopNote(N,!1)});function P(){for(const y of f.keys())q.stopNote(y,a)}O.subscribe(P),T.subscribe(P);function Y(y){if(l){const N=l.clientHeight/6,W=l.offsetWidth/y;l.style.setProperty("--white-key-width",`${Math.min(W,N)}px`)}}function L(y){const N=Mt[y.code],W=y.target;N&&W.tagName!=="INPUT"&&(y.preventDefault(),_(N,void 0,!1))}function ae(y){const N=Mt[y.code];N&&M(N)}function A(y,N,W,X){if(N=="notes")return nt(y);if(N=="keybinds"){const J=rt(y)-W-X*12;return wr[Le(J)]??""}else return""}function ne(y){const[N,W,X]=y.data;N>=144&&N<=159?X==0?M(Le(W)):_(Le(W),X/127):N>=128&&N<=143&&M(Le(W))}function Q(y){y.inputs.forEach(N=>{N.onmidimessage=ne})}Qt(()=>{Y(i),navigator.requestMIDIAccess().then(y=>{Q(y),y.onstatechange=()=>{Q(y)}})});function H(y){Sn.call(this,e,y)}const fe=()=>Y(i),re=y=>{var N;y.button===0&&((N=y.target)==null?void 0:N.tagName)!=="SELECT"&&n(1,h=!0)},ce=()=>n(1,h=!1),me=(y,N)=>{N.currentTarget.releasePointerCapture(N.pointerId),_(y)},D=y=>{h&&_(y)},ue=y=>{h&&M(y)},_e=y=>M(y);function de(y){gt[y?"unshift":"push"](()=>{l=y,n(2,l)})}return e.$$set=y=>{"pianoControlsData"in y&&n(21,d=y.pianoControlsData),"midiPlayer"in y&&n(19,S=y.midiPlayer),"socketPlayer"in y&&n(20,q=y.socketPlayer)},e.$$.update=()=>{e.$$.dirty[0]&4194304&&n(3,[r,i]=Tr(c),r,(n(0,i),n(22,c))),e.$$.dirty[0]&1&&Y(i)},[i,h,l,r,s,u,m,p,g,T,O,V,I,_,M,Y,L,ae,A,S,q,d,c,H,fe,re,ce,me,D,ue,_e,de]}class Ai extends qe{constructor(t){super(),Ve(this,t,Oi,Fi,Ne,{pianoControlsData:21,midiPlayer:19,socketPlayer:20},null,[-1,-1])}}function Dt(e,t,n){const r=e.slice();return r[35]=t[n],r[37]=n,r}function Bi(e){let t,n,r,i,a;return{c(){t=v("button"),n=oe("Play"),t.disabled=r=e[3].length==0},m(o,s){E(o,t,s),b(t,n),i||(a=U(t,"click",e[21]),i=!0)},p(o,s){s[0]&8&&r!==(r=o[3].length==0)&&(t.disabled=r)},d(o){o&&B(t),i=!1,a()}}}function Ei(e){let t,n,r;return{c(){t=v("button"),t.textContent="Stop"},m(i,a){E(i,t,a),n||(r=U(t,"click",e[20]),n=!0)},p:G,d(i){i&&B(t),n=!1,r()}}}function jt(e){let t,n,r,i,a;return{c(){t=v("select"),n=v("option"),n.textContent="all tracks",r=v("option"),r.textContent="single track",n.__value=!1,K(n,n.__value),r.__value=!0,K(r,r.__value),e[5]===void 0&&we(()=>e[23].call(t))},m(o,s){E(o,t,s),b(t,n),b(t,r),ge(t,e[5],!0),i||(a=U(t,"change",e[23]),i=!0)},p(o,s){s[0]&32&&ge(t,o[5])},d(o){o&&B(t),i=!1,a()}}}function Rt(e){let t,n,r,i,a,o,s,u,c,m=ye(e[3]),h=[];for(let l=0;l<m.length;l+=1)h[l]=Vt(Dt(e,m,l));return{c(){t=v("select");for(let l=0;l<h.length;l+=1)h[l].c();n=F(),r=v("button"),i=oe("Add Track"),a=F(),o=v("button"),s=oe("Delete Track"),t.disabled=e[1],e[6]===void 0&&we(()=>e[26].call(t)),r.disabled=e[1],o.disabled=e[1]},m(l,f){E(l,t,f);for(let d=0;d<h.length;d+=1)h[d]&&h[d].m(t,null);ge(t,e[6],!0),E(l,n,f),E(l,r,f),b(r,i),E(l,a,f),E(l,o,f),b(o,s),u||(c=[U(t,"change",e[26]),U(r,"click",e[27]),U(o,"click",e[28])],u=!0)},p(l,f){if(f[0]&8){m=ye(l[3]);let d;for(d=0;d<m.length;d+=1){const p=Dt(l,m,d);h[d]?h[d].p(p,f):(h[d]=Vt(p),h[d].c(),h[d].m(t,null))}for(;d<h.length;d+=1)h[d].d(1);h.length=m.length}f[0]&2&&(t.disabled=l[1]),f[0]&64&&ge(t,l[6]),f[0]&2&&(r.disabled=l[1]),f[0]&2&&(o.disabled=l[1])},d(l){l&&(B(t),B(n),B(r),B(a),B(o)),Ge(h,l),u=!1,pe(c)}}}function Vt(e){let t,n=(e[35].name||`[Track ${e[37]}]`)+"",r;return{c(){t=v("option"),r=oe(n),t.__value=e[37],K(t,t.__value)},m(i,a){E(i,t,a),b(t,r)},p(i,a){a[0]&8&&n!==(n=(i[35].name||`[Track ${i[37]}]`)+"")&&Je(r,n)},d(i){i&&B(t)}}}function Di(e){let t,n,r,i,a,o,s,u,c,m,h,l,f,d,p,g,T,O,V,I,S,q,w,_,M,P,Y,L,ae,A,ne,Q,H,fe,re,ce=e[4].toFixed(1)+"",me,D,ue=e[8].toFixed(1)+"",_e,de,y,N;function W(C,j){return C[2]?Ei:Bi}let X=W(e),J=X(e),Z=e[3].length>0&&jt(e),R=e[3].length>0&&Rt(e);return{c(){t=v("div"),n=v("p"),n.textContent="Play midi:",r=F(),i=v("div"),a=v("input"),o=F(),s=v("div"),J.c(),u=F(),c=v("button"),m=oe("Restart"),l=F(),Z&&Z.c(),f=F(),d=v("div"),p=v("button"),g=oe("Record"),T=F(),O=v("button"),V=oe("Save"),S=F(),R&&R.c(),q=F(),w=v("div"),_=v("span"),_.textContent="Speed",M=F(),P=v("input"),Y=F(),L=v("input"),ae=F(),A=v("span"),A.textContent="times",ne=F(),Q=v("div"),H=v("input"),fe=F(),re=v("span"),me=oe(ce),D=oe("/"),_e=oe(ue),de=oe(" seconds"),k(a,"type","file"),k(a,"accept",".midi,.mid"),a.disabled=e[2],k(i,"class","svelte-1owab3p"),c.disabled=h=e[3].length==0,k(s,"class","svelte-1owab3p"),p.disabled=e[2],O.disabled=I=e[3].length==0||e[2],k(d,"class","svelte-1owab3p"),k(_,"class","svelte-1owab3p"),k(P,"type","range"),k(P,"min","0.01"),k(P,"max","4"),k(P,"step","0.01"),k(P,"title","Double click to set speed to normal"),k(L,"type","number"),k(L,"min","0.01"),k(A,"class","svelte-1owab3p"),Ce(w,"display","flex"),k(w,"class","svelte-1owab3p"),k(H,"type","range"),k(H,"min","0"),k(H,"max",e[8]),k(H,"step","0.1"),Ce(H,"width","18rem"),H.disabled=e[1],k(re,"class","svelte-1owab3p"),Ce(Q,"display","flex"),k(Q,"class","svelte-1owab3p"),k(t,"class","svelte-1owab3p")},m(C,j){E(C,t,j),b(t,n),b(t,r),b(t,i),b(i,a),b(t,o),b(t,s),J.m(s,null),b(s,u),b(s,c),b(c,m),b(s,l),Z&&Z.m(s,null),b(t,f),b(t,d),b(d,p),b(p,g),b(d,T),b(d,O),b(O,V),b(d,S),R&&R.m(d,null),b(t,q),b(t,w),b(w,_),b(w,M),b(w,P),K(P,e[7]),b(w,Y),b(w,L),K(L,e[7]),b(w,ae),b(w,A),b(t,ne),b(t,Q),b(Q,H),K(H,e[4]),b(Q,fe),b(Q,re),b(re,me),b(re,D),b(re,_e),b(re,de),y||(N=[U(a,"change",e[19]),U(c,"click",e[22]),U(p,"click",e[24]),U(O,"click",e[25]),U(P,"change",e[29]),U(P,"input",e[29]),U(P,"click",e[30]),U(L,"input",e[31]),U(H,"change",e[32]),U(H,"input",e[32]),U(H,"mousedown",e[33]),U(H,"mouseup",e[34])],y=!0)},p(C,j){j[0]&4&&(a.disabled=C[2]),X===(X=W(C))&&J?J.p(C,j):(J.d(1),J=X(C),J&&(J.c(),J.m(s,u))),j[0]&8&&h!==(h=C[3].length==0)&&(c.disabled=h),C[3].length>0?Z?Z.p(C,j):(Z=jt(C),Z.c(),Z.m(s,null)):Z&&(Z.d(1),Z=null),j[0]&4&&(p.disabled=C[2]),j[0]&12&&I!==(I=C[3].length==0||C[2])&&(O.disabled=I),C[3].length>0?R?R.p(C,j):(R=Rt(C),R.c(),R.m(d,null)):R&&(R.d(1),R=null),j[0]&128&&K(P,C[7]),j[0]&128&&he(L.value)!==C[7]&&K(L,C[7]),j[0]&256&&k(H,"max",C[8]),j[0]&2&&(H.disabled=C[1]),j[0]&16&&K(H,C[4]),j[0]&16&&ce!==(ce=C[4].toFixed(1)+"")&&Je(me,ce),j[0]&256&&ue!==(ue=C[8].toFixed(1)+"")&&Je(_e,ue)},i:G,o:G,d(C){C&&B(t),J.d(),Z&&Z.d(),R&&R.d(),y=!1,pe(N)}}}function ji(e,t,n){let r,i,a,o,s,u,c,m,h,{midiPlayer:l}=t,{isPlaying:f,isRecording:d,currentTime:p,speed:g,totalTime:T,selectedTrack:O,tracks:V,shouldPlaySolo:I}=l;z(e,f,D=>n(18,a=D)),z(e,d,D=>n(1,i=D)),z(e,p,D=>n(4,s=D)),z(e,g,D=>n(7,m=D)),z(e,T,D=>n(8,h=D)),z(e,O,D=>n(6,c=D)),z(e,V,D=>n(3,o=D)),z(e,I,D=>n(5,u=D));function S(){l.startRecording(),localStorage.getItem("hasRecordedBefore")||(alert("Play any key to start recording. Recording WILL override the selected track."),localStorage.setItem("hasRecordedBefore","true"))}const q=D=>{var ue;return l.setFile((ue=D.currentTarget.files)==null?void 0:ue[0])},w=()=>l.stopAndReseek(),_=()=>l.startPlaying(),M=()=>{se(p,s=0,s),l.stop(),l.lastStartFunc()};function P(){u=He(this),I.set(u)}const Y=()=>S(),L=()=>l.saveFile();function ae(){c=He(this),O.set(c)}const A=()=>l.addTrack(),ne=()=>l.deleteTrack();function Q(){m=he(this.value),g.set(m)}const H=D=>{D.detail==2&&se(g,m=1,m)};function fe(){m=he(this.value),g.set(m)}function re(){s=he(this.value),p.set(s)}const ce=()=>l.stop(),me=()=>l.lastStartFunc();return e.$$set=D=>{"midiPlayer"in D&&n(0,l=D.midiPlayer)},e.$$.update=()=>{e.$$.dirty[0]&262146&&n(2,r=a||i)},[l,i,r,o,s,u,c,m,h,f,d,p,g,T,O,V,I,S,a,q,w,_,M,P,Y,L,ae,A,ne,Q,H,fe,re,ce,me]}class Ri extends qe{constructor(t){super(),Ve(this,t,ji,Di,Ne,{midiPlayer:0},null,[-1,-1])}}const Vi=["accordion","acoustic_bass","acoustic_grand_piano","acoustic_guitar_nylon","acoustic_guitar_steel","agogo","alto_sax","applause","bagpipe","banjo","baritone_sax","bassoon","bird_tweet","blown_bottle","brass_section","breath_noise","bright_acoustic_piano","celesta","cello","choir_aahs","church_organ","clarinet","clavinet","contrabass","distortion_guitar","drawbar_organ","dulcimer","electric_bass_finger","electric_bass_pick","electric_grand_piano","electric_guitar_clean","electric_guitar_jazz","electric_guitar_muted","electric_piano_1","electric_piano_2","english_horn","fiddle","flute","french_horn","fretless_bass","fx_1_rain","fx_2_soundtrack","fx_3_crystal","fx_4_atmosphere","fx_5_brightness","fx_6_goblins","fx_7_echoes","fx_8_scifi","glockenspiel","guitar_fret_noise","guitar_harmonics","gunshot","harmonica","harpsichord","helicopter","honkytonk_piano","kalimba","koto","lead_1_square","lead_2_sawtooth","lead_3_calliope","lead_4_chiff","lead_5_charang","lead_6_voice","lead_7_fifths","lead_8_bass__lead","marimba","melodic_tom","music_box","muted_trumpet","oboe","ocarina","orchestra_hit","orchestral_harp","overdriven_guitar","pad_1_new_age","pad_2_warm","pad_3_polysynth","pad_4_choir","pad_5_bowed","pad_6_metallic","pad_7_halo","pad_8_sweep","pan_flute","percussive_organ","piccolo","pizzicato_strings","recorder","reed_organ","reverse_cymbal","rock_organ","seashore","shakuhachi","shamisen","shanai","sitar","slap_bass_1","slap_bass_2","soprano_sax","steel_drums","string_ensemble_1","string_ensemble_2","synth_bass_1","synth_bass_2","synth_brass_1","synth_brass_2","synth_choir","synth_drum","synth_strings_1","synth_strings_2","taiko_drum","tango_accordion","telephone_ring","tenor_sax","timpani","tinkle_bell","tremolo_strings","trombone","trumpet","tuba","tubular_bells","vibraphone","viola","violin","voice_oohs","whistle","woodblock","xylophone"],vn="data:image/svg+xml,%3c!--%20Taken%20from%20https://github.com/n3r4zzurr0/svg-spinners%20--%3e%3csvg%20width='24'%20height='24'%20stroke='%23fff'%20viewBox='0%200%2024%2024'%20xmlns='http://www.w3.org/2000/svg'%3e%3cstyle%3e.spinner_V8m1{transform-origin:center;animation:spinner_zKoa%202s%20linear%20infinite}.spinner_V8m1%20circle{stroke-linecap:round;animation:spinner_YpZS%201.5s%20ease-in-out%20infinite}@keyframes%20spinner_zKoa{100%25{transform:rotate(360deg)}}@keyframes%20spinner_YpZS{0%25{stroke-dasharray:0%20150;stroke-dashoffset:0}47.5%25{stroke-dasharray:42%20150;stroke-dashoffset:-16}95%25,100%25{stroke-dasharray:42%20150;stroke-dashoffset:-59}}%3c/style%3e%3cg%20class='spinner_V8m1'%3e%3ccircle%20cx='12'%20cy='12'%20r='9.5'%20fill='none'%20stroke-width='3'%3e%3c/circle%3e%3c/g%3e%3c/svg%3e";function qt(e,t,n){const r=e.slice();return r[27]=t[n],r}function qi(e,t,n){const r=e.slice();return r[30]=t[n],r}function Li(e){let t;return{c(){t=v("option"),t.textContent=`${yn(e[30])}`,t.__value=e[30],K(t,t.__value)},m(n,r){E(n,t,r)},p:G,d(n){n&&B(t)}}}function Hi(e){return{c:G,m:G,d:G}}function Ki(e){return{c:G,m:G,d:G}}function Gi(e){let t,n;return{c(){t=v("img"),$t(t.src,n=vn)||k(t,"src",n),k(t,"alt","spinner")},m(r,i){E(r,t,i)},d(r){r&&B(t)}}}function Lt(e){let t,n=yn(e[27])+"",r;return{c(){t=v("option"),r=oe(n),t.__value=e[27],K(t,t.__value)},m(i,a){E(i,t,a),b(t,r)},p:G,d(i){i&&B(t)}}}function Ji(e){let t,n,r,i,a,o,s,u,c,m,h,l,f,d,p,g,T,O,V,I,S,q,w,_,M,P,Y,L,ae,A,ne,Q,H,fe,re,ce,me,D,ue,_e,de,y,N,W=ye(Vi),X=[];for(let C=0;C<W.length;C+=1)X[C]=Li(qi(e,W,C));let J={ctx:e,current:null,token:null,hasCatch:!1,pending:Gi,then:Ki,catch:Hi};Pt(P=e[1],J);let Z=ye(Ht),R=[];for(let C=0;C<Z.length;C+=1)R[C]=Lt(qt(e,Z,C));return{c(){t=v("div"),n=v("div"),r=v("span"),r.textContent="Sustain",i=F(),a=v("input"),o=F(),s=v("div"),u=v("span"),u.textContent="Tranpose",c=F(),m=v("input"),h=F(),l=v("input"),f=F(),d=v("div"),p=v("span"),p.textContent="Volume",g=F(),T=v("input"),O=F(),V=v("input"),I=F(),S=v("div"),q=v("span"),q.textContent="Instrument",w=F(),_=v("select");for(let C=0;C<X.length;C+=1)X[C].c();M=F(),J.block.c(),Y=F(),L=v("div"),ae=v("span"),ae.textContent="Size",A=F(),ne=v("select"),Q=v("option"),Q.textContent="Full size (88 keys)",H=v("option"),H.textContent="Half size (61 keys)",fe=v("option"),fe.textContent="Quater Size (37 keys)",re=v("option"),re.textContent="2 Octaves (24 keys)",ce=v("option"),ce.textContent="1 Octave (12 keys)",me=F(),D=v("div"),ue=v("span"),ue.textContent="Labels",_e=F(),de=v("select");for(let C=0;C<R.length;C+=1)R[C].c();k(r,"class","svelte-1ue5508"),k(a,"type","checkbox"),k(n,"title","Shortcut: space"),k(n,"class","svelte-1ue5508"),k(u,"title","Double click to reset"),k(u,"class","svelte-1ue5508"),k(m,"title","Note shift (shortcut: left ctrl + left alt)"),k(m,"type","number"),k(l,"title","Octave shift (shortcut: right alt + right ctrl)"),k(l,"type","number"),k(s,"class","svelte-1ue5508"),k(p,"class","svelte-1ue5508"),k(T,"type","range"),k(T,"min","0"),k(T,"max","10"),k(T,"step","0.1"),Ce(T,"width","8rem"),k(V,"type","number"),k(d,"class","svelte-1ue5508"),k(q,"class","svelte-1ue5508"),e[0]===void 0&&we(()=>e[24].call(_)),k(S,"class","svelte-1ue5508"),k(ae,"class","svelte-1ue5508"),Q.__value="A0,C8",K(Q,Q.__value),H.__value="C2,C7",K(H,H.__value),fe.__value="C3,C6",K(fe,fe.__value),re.__value="C4,B5",K(re,re.__value),ce.__value="C4,B4",K(ce,ce.__value),e[6]===void 0&&we(()=>e[25].call(ne)),k(L,"class","svelte-1ue5508"),k(ue,"class","svelte-1ue5508"),e[7]===void 0&&we(()=>e[26].call(de)),k(D,"class","svelte-1ue5508"),k(t,"class","option-list svelte-1ue5508")},m(C,j){E(C,t,j),b(t,n),b(n,r),b(n,i),b(n,a),a.checked=e[2],b(t,o),b(t,s),b(s,u),b(s,c),b(s,m),K(m,e[4]),b(s,h),b(s,l),K(l,e[3]),b(t,f),b(t,d),b(d,p),b(d,g),b(d,T),K(T,e[5]),b(d,O),b(d,V),K(V,e[5]),b(t,I),b(t,S),b(S,q),b(S,w),b(S,_);for(let $=0;$<X.length;$+=1)X[$]&&X[$].m(_,null);ge(_,e[0],!0),b(S,M),J.block.m(S,J.anchor=null),J.mount=()=>S,J.anchor=null,b(t,Y),b(t,L),b(L,ae),b(L,A),b(L,ne),b(ne,Q),b(ne,H),b(ne,fe),b(ne,re),b(ne,ce),ge(ne,e[6],!0),b(t,me),b(t,D),b(D,ue),b(D,_e),b(D,de);for(let $=0;$<R.length;$+=1)R[$]&&R[$].m(de,null);ge(de,e[7],!0),y||(N=[U(window,"keydown",e[14]),U(window,"keyup",e[15]),U(a,"change",e[18]),U(u,"click",e[19]),U(m,"input",e[20]),U(l,"input",e[21]),U(T,"change",e[22]),U(T,"input",e[22]),U(V,"input",e[23]),U(_,"change",e[24]),U(ne,"change",e[25]),U(de,"change",e[26])],y=!0)},p(C,j){if(e=C,j[0]&4&&(a.checked=e[2]),j[0]&16&&he(m.value)!==e[4]&&K(m,e[4]),j[0]&8&&he(l.value)!==e[3]&&K(l,e[3]),j[0]&32&&K(T,e[5]),j[0]&32&&he(V.value)!==e[5]&&K(V,e[5]),j[0]&1&&ge(_,e[0]),J.ctx=e,j[0]&2&&P!==(P=e[1])&&Pt(P,J),j[0]&64&&ge(ne,e[6]),j&0){Z=ye(Ht);let $;for($=0;$<Z.length;$+=1){const Tt=qt(e,Z,$);R[$]?R[$].p(Tt,j):(R[$]=Lt(Tt),R[$].c(),R[$].m(de,null))}for(;$<R.length;$+=1)R[$].d(1);R.length=Z.length}j[0]&128&&ge(de,e[7])},i:G,o:G,d(C){C&&B(t),Ge(X,C),J.block.d(),J.token=null,J=null,Ge(R,C),y=!1,pe(N)}}}const Ht=["none","notes","keybinds"];class zi{constructor(){x(this,"octaveShift",ie(0));x(this,"noteShift",ie(0));x(this,"sustain",ie(!1));x(this,"volume",ie(5));x(this,"noteRange",ie("C2,C7"));x(this,"labelType",ie("keybinds"))}}function Wi(e,t,n){let r,i,a,o,s,u,c,{pianoControlsData:m}=t,{socketPlayer:h}=t,l="acoustic_grand_piano",{noteRange:f,sustain:d,noteShift:p,octaveShift:g,volume:T,labelType:O}=m;z(e,f,A=>n(6,u=A)),z(e,d,A=>n(2,i=A)),z(e,p,A=>n(4,o=A)),z(e,g,A=>n(3,a=A)),z(e,T,A=>n(5,s=A)),z(e,O,A=>n(7,c=A));function V(A){if(A.target.tagName!=="INPUT")switch(A.code){case"Space":se(d,i=!0,i);break;case"ControlLeft":se(p,o-=1,o);break;case"AltLeft":se(p,o+=1,o);break;case"AltRight":se(g,a-=1,a);break;case"ControlRight":se(g,a+=1,a);break}}p.subscribe(()=>{o>=12?(se(g,a+=1,a),se(p,o=0,o)):o<=-12&&(se(g,a-=1,a),se(p,o=0,o))}),g.subscribe(()=>{a<-3?se(g,a=3,a):a>3&&se(g,a=-3,a)});function I(A){A.code==="Space"&&se(d,i=!1,i)}function S(){i=this.checked,d.set(i)}const q=A=>{A.detail==2&&(se(p,o=0,o),se(g,a=0,a))};function w(){o=he(this.value),p.set(o)}function _(){a=he(this.value),g.set(a)}function M(){s=he(this.value),T.set(s)}function P(){s=he(this.value),T.set(s)}function Y(){l=He(this),n(0,l)}function L(){u=He(this),f.set(u)}function ae(){c=He(this),O.set(c)}return e.$$set=A=>{"pianoControlsData"in A&&n(16,m=A.pianoControlsData),"socketPlayer"in A&&n(17,h=A.socketPlayer)},e.$$.update=()=>{e.$$.dirty[0]&131073&&n(1,r=h.changeInstrument(l))},[l,r,i,a,o,s,u,c,f,d,p,g,T,O,V,I,m,h,S,q,w,_,M,P,Y,L,ae]}class $i extends qe{constructor(t){super(),Ve(this,t,Wi,Ji,Ne,{pianoControlsData:16,socketPlayer:17},null,[-1,-1])}}var Yi={BASE_URL:"./",DEV:!1,MODE:"production",PROD:!0,SSR:!1,VITE_BACKEND_HOST:"piano-backend.onrender.com"};class mt{constructor(t){x(this,"audioNodeMap",new Map);x(this,"instrument");x(this,"instrumentName");x(this,"colorHue");x(this,"socketID");this.colorHue=t.color_hue,this.socketID=t.socket_id,this.setInstrument(t.instrument_name)}async setInstrument(t){this.instrumentName=t,this.instrument=await Ni(t)}stopAudio(t){const n=this.audioNodeMap.get(t);n&&(n.stop(),this.audioNodeMap.delete(t))}playAudio(t,n){this.instrument&&(this.stopAudio(t),this.audioNodeMap.set(t,this.instrument.play(t,void 0,{gain:n})))}}class Xi{constructor(){x(this,"connecting",ie(!1));x(this,"connectError",ie(""));x(this,"connectedColorHues",ie(new Map));x(this,"connected",ie(!1));x(this,"clientMap",new Map);x(this,"localClient",new mt({color_hue:220,socket_id:0,instrument_name:"acoustic_grand_piano"}));x(this,"socket",null);x(this,"onPlayNote");x(this,"onStopNote")}connect(t,n=6){if(t.length>100)return this.connectError.set("Room name to long!");const r="piano-backend.onrender.com",i=location.protocol==="https:"?"wss":"ws",a=Yi.VITE_BACKEND_PATH??"",o=`room_name=${t}&instrument_name=${this.localClient.instrumentName}`;this.socket=new WebSocket(`${i}://${r}/${a}?${o}`),this.socket.onopen=()=>{console.log("Connected to websocket"),this.connecting.set(!1),this.connected.set(!0),history.replaceState({},"",`?room=${t}`),document.title=`Room ${t} - Play Piano!`},this.socket.onclose=()=>{history.replaceState({},"",location.pathname),document.title="Play Piano!",this.clean(),ee(this.connected)&&(console.log("Trying to reconnect"),this.connect(t),this.connected.set(!1))},this.socket.onerror=()=>{console.log(`Failed to connect, reconnecting ${n} attempts left`),setTimeout(()=>{n==0?(this.connectError.set("Failed to connect to websocket server"),this.disconnect()):this.connect(t,n-1)},1e3)},this.socket.onmessage=s=>{const u=JSON.parse(s.data);u&&this.handleMessage(u)},this.connectError.set(""),this.connecting.set(!0)}disconnect(){this.connected.set(!1),this.connecting.set(!1),this.socket&&this.socket.close()}handleMessage(t){switch(t.type){case"Error":this.connectError.set(t.error);break;case"PlayNote":this.onPlayNote(t,this.getClient(t.socket_id));break;case"StopNote":this.onStopNote(t,this.getClient(t.socket_id));break;case"InstrumentChange":this.getClient(t.socket_id).setInstrument(t.instrument_name);break;case"ClientConnect":this.addClient(new mt(t));break;case"ReceiveInfo":{for(const i of t.client_list)this.addClient(new mt(i));const r=t.created_client;this.localClient.colorHue=r.color_hue,this.localClient.socketID=t.created_client.socket_id,this.addClient(this.localClient);break}case"ClientDisconnect":this.connectedColorHues.update(r=>(r.delete(t.socket_id),r));const n=this.getClient(t.socket_id);n&&(this.cleanClient(n),this.clientMap.delete(t.socket_id));break}}getClient(t){return this.clientMap.get(t)}playNote(t,n){const r={note:t,volume:n};this.onPlayNote(r,this.localClient),this.sendMessage("PlayNote",r)}stopNote(t,n){const r={note:t,sustain:n};this.onStopNote(r,this.localClient),this.sendMessage("StopNote",r)}sendMessage(t,n){this.socket&&ee(this.connected)&&this.socket.send(JSON.stringify({type:t,...n}))}async changeInstrument(t){this.sendMessage("InstrumentChange",{instrument_name:t}),await this.localClient.setInstrument(t)}addClient(t){this.connectedColorHues.update(n=>(n.set(t.socketID,t.colorHue),n)),this.clientMap.set(t.socketID,t)}clean(){for(const t of this.clientMap.values())this.cleanClient(t);this.socket=null,this.clientMap.clear(),this.localClient.colorHue=220,this.localClient.socketID=0,this.connectedColorHues.update(t=>(t.clear(),t))}cleanClient(t){for(const n of t.audioNodeMap.keys())this.onStopNote({note:n,sustain:!1},t)}}function Kt(e,t,n){const r=e.slice();return r[14]=t[n][0],r[15]=t[n][1],r}function Zi(e){let t,n,r,i;return{c(){t=v("button"),n=oe("Join"),t.disabled=e[3]},m(a,o){E(a,t,o),b(t,n),r||(i=U(t,"click",e[13]),r=!0)},p(a,o){o&8&&(t.disabled=a[3])},d(a){a&&B(t),r=!1,i()}}}function Qi(e){let t,n,r,i,a,o,s,u,c,m,h=ye(Array.from(e[4].entries())),l=[];for(let f=0;f<h.length;f+=1)l[f]=Jt(Kt(e,h,f));return{c(){t=v("button"),t.textContent="Leave",n=F(),r=v("span"),r.textContent="Connected!",i=v("br"),a=F(),o=v("span"),o.textContent="People:",s=F();for(let f=0;f<l.length;f+=1)l[f].c();u=Xt()},m(f,d){E(f,t,d),E(f,n,d),E(f,r,d),E(f,i,d),E(f,a,d),E(f,o,d),E(f,s,d);for(let p=0;p<l.length;p+=1)l[p]&&l[p].m(f,d);E(f,u,d),c||(m=U(t,"click",e[12]),c=!0)},p(f,d){if(d&17){h=ye(Array.from(f[4].entries()));let p;for(p=0;p<h.length;p+=1){const g=Kt(f,h,p);l[p]?l[p].p(g,d):(l[p]=Jt(g),l[p].c(),l[p].m(u.parentNode,u))}for(;p<l.length;p+=1)l[p].d(1);l.length=h.length}},d(f){f&&(B(t),B(n),B(r),B(i),B(a),B(o),B(s),B(u)),Ge(l,f),c=!1,m()}}}function Gt(e){let t;return{c(){t=v("span"),t.textContent="(you)",Ce(t,"margin-right","0.5rem")},m(n,r){E(n,t,r)},d(n){n&&B(t)}}}function Jt(e){let t,n,r,i,a=e[14]===e[0].localClient.socketID&&Gt();return{c(){t=v("div"),r=F(),a&&a.c(),i=Xt(),k(t,"class","icon svelte-ye3hvw"),k(t,"style",n=`--color-hue: ${e[15]}`)},m(o,s){E(o,t,s),E(o,r,s),a&&a.m(o,s),E(o,i,s)},p(o,s){s&16&&n!==(n=`--color-hue: ${o[15]}`)&&k(t,"style",n),o[14]===o[0].localClient.socketID?a||(a=Gt(),a.c(),a.m(i.parentNode,i)):a&&(a.d(1),a=null)},d(o){o&&(B(t),B(r),B(i)),a&&a.d(o)}}}function eo(e){let t,n,r,i;return{c(){t=v("span"),t.textContent="Connecting...",n=F(),r=v("img"),$t(r.src,i=vn)||k(r,"src",i),k(r,"alt","spinner")},m(a,o){E(a,t,o),E(a,n,o),E(a,r,o)},p:G,d(a){a&&(B(t),B(n),B(r))}}}function to(e){let t,n;return{c(){t=v("span"),n=oe(e[5]),k(t,"class","error svelte-ye3hvw")},m(r,i){E(r,t,i),b(t,n)},p(r,i){i&32&&Je(n,r[5])},d(r){r&&B(t)}}}function no(e){let t,n,r,i,a,o,s,u;function c(p,g){return p[2]?Qi:Zi}let m=c(e),h=m(e);function l(p,g){if(p[5])return to;if(p[3])return eo}let f=l(e),d=f&&f(e);return{c(){t=v("div"),n=v("p"),n.textContent="Join a room:",r=F(),i=v("input"),a=F(),h.c(),o=F(),d&&d.c(),k(i,"type","text"),k(i,"placeholder","Room name")},m(p,g){E(p,t,g),b(t,n),b(t,r),b(t,i),K(i,e[1]),b(t,a),h.m(t,null),b(t,o),d&&d.m(t,null),s||(u=[U(i,"input",e[10]),U(i,"keydown",e[11])],s=!0)},p(p,[g]){g&2&&i.value!==p[1]&&K(i,p[1]),m===(m=c(p))&&h?h.p(p,g):(h.d(1),h=m(p),h&&(h.c(),h.m(t,o))),f===(f=l(p))&&d?d.p(p,g):(d&&d.d(1),d=f&&f(p),d&&(d.c(),d.m(t,null)))},i:G,o:G,d(p){p&&B(t),h.d(),d&&d.d(),s=!1,pe(u)}}}function ro(e,t,n){let r,i,a,o,{socketPlayer:s}=t,u="",{connected:c,connecting:m,connectError:h,connectedColorHues:l}=s;z(e,c,T=>n(2,r=T)),z(e,m,T=>n(3,i=T)),z(e,h,T=>n(5,o=T)),z(e,l,T=>n(4,a=T)),Qt(()=>{const O=new URLSearchParams(location.search).get("room");O!=null&&(n(1,u=O),s.connect(u))});function f(){u=this.value,n(1,u)}const d=T=>{T.code==="Enter"&&!r&&!i&&s.connect(u)},p=()=>s.disconnect(),g=()=>s.connect(u);return e.$$set=T=>{"socketPlayer"in T&&n(0,s=T.socketPlayer)},[s,u,r,i,a,o,c,m,h,l,f,d,p,g]}class io extends qe{constructor(t){super(),Ve(this,t,ro,no,Ne,{socketPlayer:0})}}function oo(e){let t,n,r,i,a,o,s,u;return r=new $i({props:{pianoControlsData:e[0],socketPlayer:e[2]}}),a=new Ri({props:{midiPlayer:e[1]}}),s=new io({props:{socketPlayer:e[2]}}),{c(){t=v("div"),n=v("div"),Ke(r.$$.fragment),i=F(),Ke(a.$$.fragment),o=F(),Ke(s.$$.fragment),k(n,"class","row svelte-b9289n"),k(t,"class","control-panel svelte-b9289n")},m(c,m){E(c,t,m),b(t,n),je(r,n,null),b(n,i),je(a,n,null),b(t,o),je(s,t,null),u=!0},p(c,[m]){const h={};m&1&&(h.pianoControlsData=c[0]),m&4&&(h.socketPlayer=c[2]),r.$set(h);const l={};m&2&&(l.midiPlayer=c[1]),a.$set(l);const f={};m&4&&(f.socketPlayer=c[2]),s.$set(f)},i(c){u||(Se(r.$$.fragment,c),Se(a.$$.fragment,c),Se(s.$$.fragment,c),u=!0)},o(c){De(r.$$.fragment,c),De(a.$$.fragment,c),De(s.$$.fragment,c),u=!1},d(c){c&&B(t),Re(r),Re(a),Re(s)}}}function ao(e,t,n){let{pianoControlsData:r}=t,{midiPlayer:i}=t,{socketPlayer:a}=t;return e.$$set=o=>{"pianoControlsData"in o&&n(0,r=o.pianoControlsData),"midiPlayer"in o&&n(1,i=o.midiPlayer),"socketPlayer"in o&&n(2,a=o.socketPlayer)},[r,i,a]}class so extends qe{constructor(t){super(),Ve(this,t,ao,oo,Ne,{pianoControlsData:0,midiPlayer:1,socketPlayer:2})}}function co(e){let t,n,r,i,a;return n=new so({props:{pianoControlsData:e[0],midiPlayer:e[1],socketPlayer:e[2]}}),i=new Ai({props:{pianoControlsData:e[0],midiPlayer:e[1],socketPlayer:e[2]}}),{c(){t=v("main"),Ke(n.$$.fragment),r=F(),Ke(i.$$.fragment)},m(o,s){E(o,t,s),je(n,t,null),b(t,r),je(i,t,null),a=!0},p:G,i(o){a||(Se(n.$$.fragment,o),Se(i.$$.fragment,o),a=!0)},o(o){De(n.$$.fragment,o),De(i.$$.fragment,o),a=!1},d(o){o&&B(t),Re(n),Re(i)}}}function lo(e){const t=new zi,n=new xi,r=new Xi;return[t,n,r]}class uo extends qe{constructor(t){super(),Ve(this,t,lo,co,Ne,{})}}new uo({target:document.body});

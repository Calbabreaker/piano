var Kr=Object.defineProperty;var Jr=(t,e,n)=>e in t?Kr(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n;var B=(t,e,n)=>(Jr(t,typeof e!="symbol"?e+"":e,n),n);(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))r(i);new MutationObserver(i=>{for(const o of i)if(o.type==="childList")for(const s of o.addedNodes)s.tagName==="LINK"&&s.rel==="modulepreload"&&r(s)}).observe(document,{childList:!0,subtree:!0});function n(i){const o={};return i.integrity&&(o.integrity=i.integrity),i.referrerPolicy&&(o.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?o.credentials="include":i.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function r(i){if(i.ep)return;i.ep=!0;const o=n(i);fetch(i.href,o)}})();function q(){}function zr(t){return!!t&&(typeof t=="object"||typeof t=="function")&&typeof t.then=="function"}function ar(t){return t()}function On(){return Object.create(null)}function Oe(t){t.forEach(ar)}function cn(t){return typeof t=="function"}function Nt(t,e){return t!=t?e==e:t!==e||t&&typeof t=="object"||typeof t=="function"}function Wr(t){return Object.keys(t).length===0}function cr(t,...e){if(t==null){for(const r of e)r(void 0);return q}const n=t.subscribe(...e);return n.unsubscribe?()=>n.unsubscribe():n}function ve(t){let e;return cr(t,n=>e=n)(),e}function X(t,e,n){t.$$.on_destroy.push(cr(e,n))}function ee(t,e,n){return t.set(n),e}function Gr(t){return t&&cn(t.destroy)?t.destroy:q}function b(t,e){t.appendChild(e)}function L(t,e,n){t.insertBefore(e,n||null)}function R(t){t.parentNode&&t.parentNode.removeChild(t)}function un(t,e){for(let n=0;n<t.length;n+=1)t[n]&&t[n].d(e)}function T(t){return document.createElement(t)}function ue(t){return document.createTextNode(t)}function U(){return ue(" ")}function ur(){return ue("")}function E(t,e,n,r){return t.addEventListener(e,n,r),()=>t.removeEventListener(e,n,r)}function Yr(t){return function(e){return e.preventDefault(),t.call(this,e)}}function v(t,e,n){n==null?t.removeAttribute(e):t.getAttribute(e)!==n&&t.setAttribute(e,n)}function Te(t){return t===""?null:+t}function $r(t){return Array.from(t.childNodes)}function Gt(t,e){e=""+e,t.data!==e&&(t.data=e)}function H(t,e){t.value=e??""}function It(t,e,n,r){n==null?t.style.removeProperty(e):t.style.setProperty(e,n,r?"important":"")}function Pn(t,e,n){for(let r=0;r<t.options.length;r+=1){const i=t.options[r];if(i.__value===e){i.selected=!0;return}}(!n||e!==void 0)&&(t.selectedIndex=-1)}function Xr(t){const e=t.querySelector(":checked");return e&&e.__value}function pt(t,e,n){t.classList.toggle(e,!!n)}let Ze;function Se(t){Ze=t}function lr(){if(!Ze)throw new Error("Function called outside component initialization");return Ze}function Qr(t){lr().$$.on_mount.push(t)}function Zr(t,e){const n=t.$$.callbacks[e.type];n&&n.slice().forEach(r=>r.call(this,e))}const je=[],Yt=[];let Je=[];const An=[],ei=Promise.resolve();let $t=!1;function ti(){$t||($t=!0,ei.then(ln))}function xt(t){Je.push(t)}const qt=new Set;let De=0;function ln(){if(De!==0)return;const t=Ze;do{try{for(;De<je.length;){const e=je[De];De++,Se(e),ni(e.$$)}}catch(e){throw je.length=0,De=0,e}for(Se(null),je.length=0,De=0;Yt.length;)Yt.pop()();for(let e=0;e<Je.length;e+=1){const n=Je[e];qt.has(n)||(qt.add(n),n())}Je.length=0}while(je.length);for(;An.length;)An.pop()();$t=!1,qt.clear(),Se(t)}function ni(t){if(t.fragment!==null){t.update(),Oe(t.before_update);const e=t.dirty;t.dirty=[-1],t.fragment&&t.fragment.p(t.ctx,e),t.after_update.forEach(xt)}}function ri(t){const e=[],n=[];Je.forEach(r=>t.indexOf(r)===-1?e.push(r):n.push(r)),n.forEach(r=>r()),Je=e}const kt=new Set;let Pe;function ii(){Pe={r:0,c:[],p:Pe}}function si(){Pe.r||Oe(Pe.c),Pe=Pe.p}function Ct(t,e){t&&t.i&&(kt.delete(t),t.i(e))}function Xt(t,e,n,r){if(t&&t.o){if(kt.has(t))return;kt.add(t),Pe.c.push(()=>{kt.delete(t),r&&(n&&t.d(1),r())}),t.o(e)}else r&&r()}function Bn(t,e){const n=e.token={};function r(i,o,s,c){if(e.token!==n)return;e.resolved=c;let u=e.ctx;s!==void 0&&(u=u.slice(),u[s]=c);const a=i&&(e.current=i)(u);let d=!1;e.block&&(e.blocks?e.blocks.forEach((f,l)=>{l!==o&&f&&(ii(),Xt(f,1,1,()=>{e.blocks[l]===f&&(e.blocks[l]=null)}),si())}):e.block.d(1),a.c(),Ct(a,1),a.m(e.mount(),e.anchor),d=!0),e.block=a,e.blocks&&(e.blocks[o]=a),d&&ln()}if(zr(t)){const i=lr();if(t.then(o=>{Se(i),r(e.then,1,e.value,o),Se(null)},o=>{if(Se(i),r(e.catch,2,e.error,o),Se(null),!e.hasCatch)throw o}),e.current!==e.pending)return r(e.pending,0),!0}else{if(e.current!==e.then)return r(e.then,1,e.value,t),!0;e.resolved=t}}function ze(t){return(t==null?void 0:t.length)!==void 0?t:Array.from(t)}function Un(t){t&&t.c()}function Qt(t,e,n){const{fragment:r,after_update:i}=t.$$;r&&r.m(e,n),xt(()=>{const o=t.$$.on_mount.map(ar).filter(cn);t.$$.on_destroy?t.$$.on_destroy.push(...o):Oe(o),t.$$.on_mount=[]}),i.forEach(xt)}function Zt(t,e){const n=t.$$;n.fragment!==null&&(ri(n.after_update),Oe(n.on_destroy),n.fragment&&n.fragment.d(e),n.on_destroy=n.fragment=null,n.ctx=[])}function oi(t,e){t.$$.dirty[0]===-1&&(je.push(t),ti(),t.$$.dirty.fill(0)),t.$$.dirty[e/31|0]|=1<<e%31}function hn(t,e,n,r,i,o,s,c=[-1]){const u=Ze;Se(t);const a=t.$$={fragment:null,ctx:[],props:o,update:q,not_equal:i,bound:On(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(e.context||(u?u.$$.context:[])),callbacks:On(),dirty:c,skip_bound:!1,root:e.target||u.$$.root};s&&s(a.root);let d=!1;if(a.ctx=n?n(t,e.props||{},(f,l,...h)=>{const p=h.length?h[0]:l;return a.ctx&&i(a.ctx[f],a.ctx[f]=p)&&(!a.skip_bound&&a.bound[f]&&a.bound[f](p),d&&oi(t,f)),l}):[],a.update(),d=!0,Oe(a.before_update),a.fragment=r?r(a.ctx):!1,e.target){if(e.hydrate){const f=$r(e.target);a.fragment&&a.fragment.l(f),f.forEach(R)}else a.fragment&&a.fragment.c();e.intro&&Ct(t.$$.fragment),Qt(t,e.target,e.anchor),ln()}Se(u)}class fn{constructor(){B(this,"$$");B(this,"$$set")}$destroy(){Zt(this,1),this.$destroy=q}$on(e,n){if(!cn(n))return q;const r=this.$$.callbacks[e]||(this.$$.callbacks[e]=[]);return r.push(n),()=>{const i=r.indexOf(n);i!==-1&&r.splice(i,1)}}$set(e){this.$$set&&!Wr(e)&&(this.$$.skip_bound=!0,this.$$set(e),this.$$.skip_bound=!1)}}const ai="4";typeof window<"u"&&(window.__svelte||(window.__svelte={v:new Set})).v.add(ai);const Le=[];function re(t,e=q){let n;const r=new Set;function i(c){if(Nt(t,c)&&(t=c,n)){const u=!Le.length;for(const a of r)a[1](),Le.push(a,t);if(u){for(let a=0;a<Le.length;a+=2)Le[a][0](Le[a+1]);Le.length=0}}}function o(c){i(c(t))}function s(c,u=q){const a=[c,u];return r.add(a),r.size===1&&(n=e(i,o)||q),c(t),()=>{r.delete(a),r.size===0&&n&&(n(),n=null)}}return{set:i,update:o,subscribe:s}}const Mn=["accordion","acoustic_bass","acoustic_grand_piano","acoustic_guitar_nylon","acoustic_guitar_steel","agogo","alto_sax","applause","bagpipe","banjo","baritone_sax","bassoon","bird_tweet","blown_bottle","brass_section","breath_noise","bright_acoustic_piano","celesta","cello","choir_aahs","church_organ","clarinet","clavinet","contrabass","distortion_guitar","drawbar_organ","dulcimer","electric_bass_finger","electric_bass_pick","electric_grand_piano","electric_guitar_clean","electric_guitar_jazz","electric_guitar_muted","electric_piano_1","electric_piano_2","english_horn","fiddle","flute","french_horn","fretless_bass","fx_1_rain","fx_2_soundtrack","fx_3_crystal","fx_4_atmosphere","fx_5_brightness","fx_6_goblins","fx_7_echoes","fx_8_scifi","glockenspiel","guitar_fret_noise","guitar_harmonics","gunshot","harmonica","harpsichord","helicopter","honkytonk_piano","kalimba","koto","lead_1_square","lead_2_sawtooth","lead_3_calliope","lead_4_chiff","lead_5_charang","lead_6_voice","lead_7_fifths","lead_8_bass__lead","marimba","melodic_tom","music_box","muted_trumpet","oboe","ocarina","orchestra_hit","orchestral_harp","overdriven_guitar","pad_1_new_age","pad_2_warm","pad_3_polysynth","pad_4_choir","pad_5_bowed","pad_6_metallic","pad_7_halo","pad_8_sweep","pan_flute","percussive_organ","piccolo","pizzicato_strings","recorder","reed_organ","reverse_cymbal","rock_organ","seashore","shakuhachi","shamisen","shanai","sitar","slap_bass_1","slap_bass_2","soprano_sax","steel_drums","string_ensemble_1","string_ensemble_2","synth_bass_1","synth_bass_2","synth_brass_1","synth_brass_2","synth_choir","synth_drum","synth_strings_1","synth_strings_2","taiko_drum","tango_accordion","telephone_ring","tenor_sax","timpani","tinkle_bell","tremolo_strings","trombone","trumpet","tuba","tubular_bells","vibraphone","viola","violin","voice_oohs","whistle","woodblock","xylophone"];var Ke=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function hr(t){if(t.__esModule)return t;var e=t.default;if(typeof e=="function"){var n=function r(){if(this instanceof r){var i=[null];i.push.apply(i,arguments);var o=Function.bind.apply(e,i);return new o}return e.apply(this,arguments)};n.prototype=e.prototype}else n={};return Object.defineProperty(n,"__esModule",{value:!0}),Object.keys(t).forEach(function(r){var i=Object.getOwnPropertyDescriptor(t,r);Object.defineProperty(n,r,i.get?i:{enumerable:!0,get:function(){return t[r]}})}),n}var fr={},Ot={};function ci(t){var e=new te(t),n=e.readChunk();if(n.id!="MThd")throw"Bad MIDI file.  Expected 'MHdr', got: '"+n.id+"'";for(var r=ui(n.data),i=[],o=0;!e.eof()&&o<r.numTracks;o++){var s=e.readChunk();if(s.id!="MTrk")throw"Bad MIDI file.  Expected 'MTrk', got: '"+s.id+"'";var c=li(s.data);i.push(c)}return{header:r,tracks:i}}function ui(t){var e=new te(t),n=e.readUInt16(),r=e.readUInt16(),i={format:n,numTracks:r},o=e.readUInt16();return o&32768?(i.framesPerSecond=256-(o>>8),i.ticksPerFrame=o&255):i.ticksPerBeat=o,i}function li(t){for(var e=new te(t),n=[];!e.eof();){var r=o();n.push(r)}return n;var i;function o(){var s={};s.deltaTime=e.readVarInt();var c=e.readUInt8();if((c&240)===240)if(c===255){s.meta=!0;var u=e.readUInt8(),a=e.readVarInt();switch(u){case 0:if(s.type="sequenceNumber",a!==2)throw"Expected length for sequenceNumber event is 2, got "+a;return s.number=e.readUInt16(),s;case 1:return s.type="text",s.text=e.readString(a),s;case 2:return s.type="copyrightNotice",s.text=e.readString(a),s;case 3:return s.type="trackName",s.text=e.readString(a),s;case 4:return s.type="instrumentName",s.text=e.readString(a),s;case 5:return s.type="lyrics",s.text=e.readString(a),s;case 6:return s.type="marker",s.text=e.readString(a),s;case 7:return s.type="cuePoint",s.text=e.readString(a),s;case 32:if(s.type="channelPrefix",a!=1)throw"Expected length for channelPrefix event is 1, got "+a;return s.channel=e.readUInt8(),s;case 33:if(s.type="portPrefix",a!=1)throw"Expected length for portPrefix event is 1, got "+a;return s.port=e.readUInt8(),s;case 47:if(s.type="endOfTrack",a!=0)throw"Expected length for endOfTrack event is 0, got "+a;return s;case 81:if(s.type="setTempo",a!=3)throw"Expected length for setTempo event is 3, got "+a;return s.microsecondsPerBeat=e.readUInt24(),s;case 84:if(s.type="smpteOffset",a!=5)throw"Expected length for smpteOffset event is 5, got "+a;var d=e.readUInt8(),f={0:24,32:25,64:29,96:30};return s.frameRate=f[d&96],s.hour=d&31,s.min=e.readUInt8(),s.sec=e.readUInt8(),s.frame=e.readUInt8(),s.subFrame=e.readUInt8(),s;case 88:if(s.type="timeSignature",a!=2&&a!=4)throw"Expected length for timeSignature event is 4 or 2, got "+a;return s.numerator=e.readUInt8(),s.denominator=1<<e.readUInt8(),a===4?(s.metronome=e.readUInt8(),s.thirtyseconds=e.readUInt8()):(s.metronome=36,s.thirtyseconds=8),s;case 89:if(s.type="keySignature",a!=2)throw"Expected length for keySignature event is 2, got "+a;return s.key=e.readInt8(),s.scale=e.readUInt8(),s;case 127:return s.type="sequencerSpecific",s.data=e.readBytes(a),s;default:return s.type="unknownMeta",s.data=e.readBytes(a),s.metatypeByte=u,s}}else if(c==240){s.type="sysEx";var a=e.readVarInt();return s.data=e.readBytes(a),s}else if(c==247){s.type="endSysEx";var a=e.readVarInt();return s.data=e.readBytes(a),s}else throw"Unrecognised MIDI event type byte: "+c;else{var l;if(c&128)l=e.readUInt8(),i=c;else{if(i===null)throw"Running status byte encountered before status byte";l=c,c=i,s.running=!0}var h=c>>4;switch(s.channel=c&15,h){case 8:return s.type="noteOff",s.noteNumber=l,s.velocity=e.readUInt8(),s;case 9:var p=e.readUInt8();return s.type=p===0?"noteOff":"noteOn",s.noteNumber=l,s.velocity=p,p===0&&(s.byte9=!0),s;case 10:return s.type="noteAftertouch",s.noteNumber=l,s.amount=e.readUInt8(),s;case 11:return s.type="controller",s.controllerType=l,s.value=e.readUInt8(),s;case 12:return s.type="programChange",s.programNumber=l,s;case 13:return s.type="channelAftertouch",s.amount=l,s;case 14:return s.type="pitchBend",s.value=l+(e.readUInt8()<<7)-8192,s;default:throw"Unrecognised MIDI event type: "+h}}}}function te(t){this.buffer=t,this.bufferLen=this.buffer.length,this.pos=0}te.prototype.eof=function(){return this.pos>=this.bufferLen};te.prototype.readUInt8=function(){var t=this.buffer[this.pos];return this.pos+=1,t};te.prototype.readInt8=function(){var t=this.readUInt8();return t&128?t-256:t};te.prototype.readUInt16=function(){var t=this.readUInt8(),e=this.readUInt8();return(t<<8)+e};te.prototype.readInt16=function(){var t=this.readUInt16();return t&32768?t-65536:t};te.prototype.readUInt24=function(){var t=this.readUInt8(),e=this.readUInt8(),n=this.readUInt8();return(t<<16)+(e<<8)+n};te.prototype.readInt24=function(){var t=this.readUInt24();return t&8388608?t-16777216:t};te.prototype.readUInt32=function(){var t=this.readUInt8(),e=this.readUInt8(),n=this.readUInt8(),r=this.readUInt8();return(t<<24)+(e<<16)+(n<<8)+r};te.prototype.readBytes=function(t){var e=this.buffer.slice(this.pos,this.pos+t);return this.pos+=t,e};te.prototype.readString=function(t){var e=this.readBytes(t);return String.fromCharCode.apply(null,e)};te.prototype.readVarInt=function(){for(var t=0;!this.eof();){var e=this.readUInt8();if(e&128)t+=e&127,t<<=7;else return t+e}return t};te.prototype.readChunk=function(){var t=this.readString(4),e=this.readUInt32(),n=this.readBytes(e);return{id:t,length:e,data:n}};var hi=ci;function fi(t,e){if(typeof t!="object")throw"Invalid MIDI data";e=e||{};var n=t.header||{},r=t.tracks||[],i,o=r.length,s=new J;for(di(s,n,o),i=0;i<o;i++)pi(s,r[i],e);return s.buffer}function di(t,e,n){var r=e.format==null?1:e.format,i=128;e.timeDivision?i=e.timeDivision:e.ticksPerFrame&&e.framesPerSecond?i=-(e.framesPerSecond&255)<<8|e.ticksPerFrame&255:e.ticksPerBeat&&(i=e.ticksPerBeat&32767);var o=new J;o.writeUInt16(r),o.writeUInt16(n),o.writeUInt16(i),t.writeChunk("MThd",o.buffer)}function pi(t,e,n){var r=new J,i,o=e.length,s=null;for(i=0;i<o;i++)(n.running===!1||!n.running&&!e[i].running)&&(s=null),s=mi(r,e[i],s,n.useByte9ForNoteOff);t.writeChunk("MTrk",r.buffer)}function mi(t,e,n,r){var i=e.type,o=e.deltaTime,s=e.text||"",c=e.data||[],u=null;switch(t.writeVarInt(o),i){case"sequenceNumber":t.writeUInt8(255),t.writeUInt8(0),t.writeVarInt(2),t.writeUInt16(e.number);break;case"text":t.writeUInt8(255),t.writeUInt8(1),t.writeVarInt(s.length),t.writeString(s);break;case"copyrightNotice":t.writeUInt8(255),t.writeUInt8(2),t.writeVarInt(s.length),t.writeString(s);break;case"trackName":t.writeUInt8(255),t.writeUInt8(3),t.writeVarInt(s.length),t.writeString(s);break;case"instrumentName":t.writeUInt8(255),t.writeUInt8(4),t.writeVarInt(s.length),t.writeString(s);break;case"lyrics":t.writeUInt8(255),t.writeUInt8(5),t.writeVarInt(s.length),t.writeString(s);break;case"marker":t.writeUInt8(255),t.writeUInt8(6),t.writeVarInt(s.length),t.writeString(s);break;case"cuePoint":t.writeUInt8(255),t.writeUInt8(7),t.writeVarInt(s.length),t.writeString(s);break;case"channelPrefix":t.writeUInt8(255),t.writeUInt8(32),t.writeVarInt(1),t.writeUInt8(e.channel);break;case"portPrefix":t.writeUInt8(255),t.writeUInt8(33),t.writeVarInt(1),t.writeUInt8(e.port);break;case"endOfTrack":t.writeUInt8(255),t.writeUInt8(47),t.writeVarInt(0);break;case"setTempo":t.writeUInt8(255),t.writeUInt8(81),t.writeVarInt(3),t.writeUInt24(e.microsecondsPerBeat);break;case"smpteOffset":t.writeUInt8(255),t.writeUInt8(84),t.writeVarInt(5);var a={24:0,25:32,29:64,30:96},d=e.hour&31|a[e.frameRate];t.writeUInt8(d),t.writeUInt8(e.min),t.writeUInt8(e.sec),t.writeUInt8(e.frame),t.writeUInt8(e.subFrame);break;case"timeSignature":t.writeUInt8(255),t.writeUInt8(88),t.writeVarInt(4),t.writeUInt8(e.numerator);var f=Math.floor(Math.log(e.denominator)/Math.LN2)&255;t.writeUInt8(f),t.writeUInt8(e.metronome),t.writeUInt8(e.thirtyseconds||8);break;case"keySignature":t.writeUInt8(255),t.writeUInt8(89),t.writeVarInt(2),t.writeInt8(e.key),t.writeUInt8(e.scale);break;case"sequencerSpecific":t.writeUInt8(255),t.writeUInt8(127),t.writeVarInt(c.length),t.writeBytes(c);break;case"unknownMeta":e.metatypeByte!=null&&(t.writeUInt8(255),t.writeUInt8(e.metatypeByte),t.writeVarInt(c.length),t.writeBytes(c));break;case"sysEx":t.writeUInt8(240),t.writeVarInt(c.length),t.writeBytes(c);break;case"endSysEx":t.writeUInt8(247),t.writeVarInt(c.length),t.writeBytes(c);break;case"noteOff":var l=r!==!1&&e.byte9||r&&e.velocity==0?144:128;u=l|e.channel,u!==n&&t.writeUInt8(u),t.writeUInt8(e.noteNumber),t.writeUInt8(e.velocity);break;case"noteOn":u=144|e.channel,u!==n&&t.writeUInt8(u),t.writeUInt8(e.noteNumber),t.writeUInt8(e.velocity);break;case"noteAftertouch":u=160|e.channel,u!==n&&t.writeUInt8(u),t.writeUInt8(e.noteNumber),t.writeUInt8(e.amount);break;case"controller":u=176|e.channel,u!==n&&t.writeUInt8(u),t.writeUInt8(e.controllerType),t.writeUInt8(e.value);break;case"programChange":u=192|e.channel,u!==n&&t.writeUInt8(u),t.writeUInt8(e.programNumber);break;case"channelAftertouch":u=208|e.channel,u!==n&&t.writeUInt8(u),t.writeUInt8(e.amount);break;case"pitchBend":u=224|e.channel,u!==n&&t.writeUInt8(u);var h=8192+e.value,p=h&127,m=h>>7&127;t.writeUInt8(p),t.writeUInt8(m);break;default:throw"Unrecognized event type: "+i}return u}function J(){this.buffer=[]}J.prototype.writeUInt8=function(t){this.buffer.push(t&255)};J.prototype.writeInt8=J.prototype.writeUInt8;J.prototype.writeUInt16=function(t){var e=t>>8&255,n=t&255;this.writeUInt8(e),this.writeUInt8(n)};J.prototype.writeInt16=J.prototype.writeUInt16;J.prototype.writeUInt24=function(t){var e=t>>16&255,n=t>>8&255,r=t&255;this.writeUInt8(e),this.writeUInt8(n),this.writeUInt8(r)};J.prototype.writeInt24=J.prototype.writeUInt24;J.prototype.writeUInt32=function(t){var e=t>>24&255,n=t>>16&255,r=t>>8&255,i=t&255;this.writeUInt8(e),this.writeUInt8(n),this.writeUInt8(r),this.writeUInt8(i)};J.prototype.writeInt32=J.prototype.writeUInt32;J.prototype.writeBytes=function(t){this.buffer=this.buffer.concat(Array.prototype.slice.call(t,0))};J.prototype.writeString=function(t){var e,n=t.length,r=[];for(e=0;e<n;e++)r.push(t.codePointAt(e));this.writeBytes(r)};J.prototype.writeVarInt=function(t){if(t<0)throw"Cannot write negative variable-length integer";if(t<=127)this.writeUInt8(t);else{var e=t,n=[];for(n.push(e&127),e>>=7;e;){var r=e&127|128;n.push(r),e>>=7}this.writeBytes(n.reverse())}};J.prototype.writeChunk=function(t,e){this.writeString(t),this.writeUInt32(e.length),this.writeBytes(e)};var yi=fi;Ot.parseMidi=hi;Ot.writeMidi=yi;var Et={},Ae={};Object.defineProperty(Ae,"__esModule",{value:!0});Ae.insert=Ae.search=void 0;function dr(t,e,n){n===void 0&&(n="ticks");var r=0,i=t.length,o=i;if(i>0&&t[i-1][n]<=e)return i-1;for(;r<o;){var s=Math.floor(r+(o-r)/2),c=t[s],u=t[s+1];if(c[n]===e){for(var a=s;a<t.length;a++){var d=t[a];d[n]===e&&(s=a)}return s}else{if(c[n]<e&&u[n]>e)return s;c[n]>e?o=s:c[n]<e&&(r=s+1)}}return-1}Ae.search=dr;function gi(t,e,n){if(n===void 0&&(n="ticks"),t.length){var r=dr(t,e[n],n);t.splice(r+1,0,e)}else t.push(e)}Ae.insert=gi;(function(t){Object.defineProperty(t,"__esModule",{value:!0}),t.Header=t.keySignatureKeys=void 0;var e=Ae,n=new WeakMap;t.keySignatureKeys=["Cb","Gb","Db","Ab","Eb","Bb","F","C","G","D","A","E","B","F#","C#"];var r=function(){function i(o){var s=this;if(this.tempos=[],this.timeSignatures=[],this.keySignatures=[],this.meta=[],this.name="",n.set(this,480),o){n.set(this,o.header.ticksPerBeat),o.tracks.forEach(function(u){u.forEach(function(a){a.meta&&(a.type==="timeSignature"?s.timeSignatures.push({ticks:a.absoluteTime,timeSignature:[a.numerator,a.denominator]}):a.type==="setTempo"?s.tempos.push({bpm:6e7/a.microsecondsPerBeat,ticks:a.absoluteTime}):a.type==="keySignature"&&s.keySignatures.push({key:t.keySignatureKeys[a.key+7],scale:a.scale===0?"major":"minor",ticks:a.absoluteTime}))})});var c=0;o.tracks[0].forEach(function(u){c+=u.deltaTime,u.meta&&(u.type==="trackName"?s.name=u.text:(u.type==="text"||u.type==="cuePoint"||u.type==="marker"||u.type==="lyrics")&&s.meta.push({text:u.text,ticks:c,type:u.type}))}),this.update()}}return i.prototype.update=function(){var o=this,s=0,c=0;this.tempos.sort(function(u,a){return u.ticks-a.ticks}),this.tempos.forEach(function(u,a){var d=a>0?o.tempos[a-1].bpm:o.tempos[0].bpm,f=u.ticks/o.ppq-c,l=60/d*f;u.time=l+s,s=u.time,c+=f}),this.timeSignatures.sort(function(u,a){return u.ticks-a.ticks}),this.timeSignatures.forEach(function(u,a){var d=a>0?o.timeSignatures[a-1]:o.timeSignatures[0],f=(u.ticks-d.ticks)/o.ppq,l=f/d.timeSignature[0]/(d.timeSignature[1]/4);d.measures=d.measures||0,u.measures=l+d.measures})},i.prototype.ticksToSeconds=function(o){var s=(0,e.search)(this.tempos,o);if(s!==-1){var c=this.tempos[s],u=c.time,a=(o-c.ticks)/this.ppq;return u+60/c.bpm*a}else{var d=o/this.ppq;return 60/120*d}},i.prototype.ticksToMeasures=function(o){var s=(0,e.search)(this.timeSignatures,o);if(s!==-1){var c=this.timeSignatures[s],u=(o-c.ticks)/this.ppq;return c.measures+u/(c.timeSignature[0]/c.timeSignature[1])/4}else return o/this.ppq/4},Object.defineProperty(i.prototype,"ppq",{get:function(){return n.get(this)},enumerable:!1,configurable:!0}),i.prototype.secondsToTicks=function(o){var s=(0,e.search)(this.tempos,o,"time");if(s!==-1){var c=this.tempos[s],u=c.time,a=o-u,d=a/(60/c.bpm);return Math.round(c.ticks+d*this.ppq)}else{var f=o/.5;return Math.round(f*this.ppq)}},i.prototype.toJSON=function(){return{keySignatures:this.keySignatures,meta:this.meta,name:this.name,ppq:this.ppq,tempos:this.tempos.map(function(o){return{bpm:o.bpm,ticks:o.ticks}}),timeSignatures:this.timeSignatures}},i.prototype.fromJSON=function(o){this.name=o.name,this.tempos=o.tempos.map(function(s){return Object.assign({},s)}),this.timeSignatures=o.timeSignatures.map(function(s){return Object.assign({},s)}),this.keySignatures=o.keySignatures.map(function(s){return Object.assign({},s)}),this.meta=o.meta.map(function(s){return Object.assign({},s)}),n.set(this,o.ppq),this.update()},i.prototype.setTempo=function(o){this.tempos=[{bpm:o,ticks:0}],this.update()},i}();t.Header=r})(Et);var et={},dn={};(function(t){Object.defineProperty(t,"__esModule",{value:!0}),t.ControlChange=t.controlChangeIds=t.controlChangeNames=void 0,t.controlChangeNames={1:"modulationWheel",2:"breath",4:"footController",5:"portamentoTime",7:"volume",8:"balance",10:"pan",64:"sustain",65:"portamentoTime",66:"sostenuto",67:"softPedal",68:"legatoFootswitch",84:"portamentoControl"},t.controlChangeIds=Object.keys(t.controlChangeNames).reduce(function(i,o){return i[t.controlChangeNames[o]]=o,i},{});var e=new WeakMap,n=new WeakMap,r=function(){function i(o,s){e.set(this,s),n.set(this,o.controllerType),this.ticks=o.absoluteTime,this.value=o.value}return Object.defineProperty(i.prototype,"number",{get:function(){return n.get(this)},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"name",{get:function(){return t.controlChangeNames[this.number]?t.controlChangeNames[this.number]:null},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"time",{get:function(){var o=e.get(this);return o.ticksToSeconds(this.ticks)},set:function(o){var s=e.get(this);this.ticks=s.secondsToTicks(o)},enumerable:!1,configurable:!0}),i.prototype.toJSON=function(){return{number:this.number,ticks:this.ticks,time:this.time,value:this.value}},i}();t.ControlChange=r})(dn);var Pt={};Object.defineProperty(Pt,"__esModule",{value:!0});Pt.createControlChanges=void 0;var mt=dn;function bi(){return new Proxy({},{get:function(t,e){if(t[e])return t[e];if(mt.controlChangeIds.hasOwnProperty(e))return t[mt.controlChangeIds[e]]},set:function(t,e,n){return mt.controlChangeIds.hasOwnProperty(e)?t[mt.controlChangeIds[e]]=n:t[e]=n,!0}})}Pt.createControlChanges=bi;var At={};Object.defineProperty(At,"__esModule",{value:!0});At.PitchBend=void 0;var Vt=new WeakMap,vi=function(){function t(e,n){Vt.set(this,n),this.ticks=e.absoluteTime,this.value=e.value}return Object.defineProperty(t.prototype,"time",{get:function(){var e=Vt.get(this);return e.ticksToSeconds(this.ticks)},set:function(e){var n=Vt.get(this);this.ticks=n.secondsToTicks(e)},enumerable:!1,configurable:!0}),t.prototype.toJSON=function(){return{ticks:this.ticks,time:this.time,value:this.value}},t}();At.PitchBend=vi;var Bt={},Ne={};Object.defineProperty(Ne,"__esModule",{value:!0});Ne.DrumKitByPatchID=Ne.InstrumentFamilyByID=Ne.instrumentByPatchID=void 0;Ne.instrumentByPatchID=["acoustic grand piano","bright acoustic piano","electric grand piano","honky-tonk piano","electric piano 1","electric piano 2","harpsichord","clavi","celesta","glockenspiel","music box","vibraphone","marimba","xylophone","tubular bells","dulcimer","drawbar organ","percussive organ","rock organ","church organ","reed organ","accordion","harmonica","tango accordion","acoustic guitar (nylon)","acoustic guitar (steel)","electric guitar (jazz)","electric guitar (clean)","electric guitar (muted)","overdriven guitar","distortion guitar","guitar harmonics","acoustic bass","electric bass (finger)","electric bass (pick)","fretless bass","slap bass 1","slap bass 2","synth bass 1","synth bass 2","violin","viola","cello","contrabass","tremolo strings","pizzicato strings","orchestral harp","timpani","string ensemble 1","string ensemble 2","synthstrings 1","synthstrings 2","choir aahs","voice oohs","synth voice","orchestra hit","trumpet","trombone","tuba","muted trumpet","french horn","brass section","synthbrass 1","synthbrass 2","soprano sax","alto sax","tenor sax","baritone sax","oboe","english horn","bassoon","clarinet","piccolo","flute","recorder","pan flute","blown bottle","shakuhachi","whistle","ocarina","lead 1 (square)","lead 2 (sawtooth)","lead 3 (calliope)","lead 4 (chiff)","lead 5 (charang)","lead 6 (voice)","lead 7 (fifths)","lead 8 (bass + lead)","pad 1 (new age)","pad 2 (warm)","pad 3 (polysynth)","pad 4 (choir)","pad 5 (bowed)","pad 6 (metallic)","pad 7 (halo)","pad 8 (sweep)","fx 1 (rain)","fx 2 (soundtrack)","fx 3 (crystal)","fx 4 (atmosphere)","fx 5 (brightness)","fx 6 (goblins)","fx 7 (echoes)","fx 8 (sci-fi)","sitar","banjo","shamisen","koto","kalimba","bag pipe","fiddle","shanai","tinkle bell","agogo","steel drums","woodblock","taiko drum","melodic tom","synth drum","reverse cymbal","guitar fret noise","breath noise","seashore","bird tweet","telephone ring","helicopter","applause","gunshot"];Ne.InstrumentFamilyByID=["piano","chromatic percussion","organ","guitar","bass","strings","ensemble","brass","reed","pipe","synth lead","synth pad","synth effects","world","percussive","sound effects"];Ne.DrumKitByPatchID={0:"standard kit",8:"room kit",16:"power kit",24:"electronic kit",25:"tr-808 kit",32:"jazz kit",40:"brush kit",48:"orchestra kit",56:"sound fx kit"};Object.defineProperty(Bt,"__esModule",{value:!0});Bt.Instrument=void 0;var yt=Ne,Fn=new WeakMap,_i=function(){function t(e,n){if(this.number=0,Fn.set(this,n),this.number=0,e){var r=e.find(function(i){return i.type==="programChange"});r&&(this.number=r.programNumber)}}return Object.defineProperty(t.prototype,"name",{get:function(){return this.percussion?yt.DrumKitByPatchID[this.number]:yt.instrumentByPatchID[this.number]},set:function(e){var n=yt.instrumentByPatchID.indexOf(e);n!==-1&&(this.number=n)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"family",{get:function(){return this.percussion?"drums":yt.InstrumentFamilyByID[Math.floor(this.number/8)]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"percussion",{get:function(){var e=Fn.get(this);return e.channel===9},enumerable:!1,configurable:!0}),t.prototype.toJSON=function(){return{family:this.family,number:this.number,name:this.name}},t.prototype.fromJSON=function(e){this.number=e.number},t}();Bt.Instrument=_i;var Ut={};Object.defineProperty(Ut,"__esModule",{value:!0});Ut.Note=void 0;function ki(t){var e=Math.floor(t/12)-1;return pr(t)+e.toString()}function pr(t){var e=["C","C#","D","D#","E","F","F#","G","G#","A","A#","B"],n=t%12;return e[n]}function wi(t){var e=["C","C#","D","D#","E","F","F#","G","G#","A","A#","B"];return e.indexOf(t)}var Ti=function(){var t=/^([a-g]{1}(?:b|#|x|bb)?)(-?[0-9]+)/i,e={cbb:-2,cb:-1,c:0,"c#":1,cx:2,dbb:0,db:1,d:2,"d#":3,dx:4,ebb:2,eb:3,e:4,"e#":5,ex:6,fbb:3,fb:4,f:5,"f#":6,fx:7,gbb:5,gb:6,g:7,"g#":8,gx:9,abb:7,ab:8,a:9,"a#":10,ax:11,bbb:9,bb:10,b:11,"b#":12,bx:13};return function(n){var r=t.exec(n),i=r[1],o=r[2],s=e[i.toLowerCase()];return s+(parseInt(o,10)+1)*12}}(),qe=new WeakMap,Si=function(){function t(e,n,r){qe.set(this,r),this.midi=e.midi,this.velocity=e.velocity,this.noteOffVelocity=n.velocity,this.ticks=e.ticks,this.durationTicks=n.ticks-e.ticks}return Object.defineProperty(t.prototype,"name",{get:function(){return ki(this.midi)},set:function(e){this.midi=Ti(e)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"octave",{get:function(){return Math.floor(this.midi/12)-1},set:function(e){var n=e-this.octave;this.midi+=n*12},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"pitch",{get:function(){return pr(this.midi)},set:function(e){this.midi=12*(this.octave+1)+wi(e)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"duration",{get:function(){var e=qe.get(this);return e.ticksToSeconds(this.ticks+this.durationTicks)-e.ticksToSeconds(this.ticks)},set:function(e){var n=qe.get(this),r=n.secondsToTicks(this.time+e);this.durationTicks=r-this.ticks},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"time",{get:function(){var e=qe.get(this);return e.ticksToSeconds(this.ticks)},set:function(e){var n=qe.get(this);this.ticks=n.secondsToTicks(e)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"bars",{get:function(){var e=qe.get(this);return e.ticksToMeasures(this.ticks)},enumerable:!1,configurable:!0}),t.prototype.toJSON=function(){return{duration:this.duration,durationTicks:this.durationTicks,midi:this.midi,name:this.name,ticks:this.ticks,time:this.time,velocity:this.velocity}},t}();Ut.Note=Si;Object.defineProperty(et,"__esModule",{value:!0});et.Track=void 0;var jt=Ae,Ii=dn,xi=Pt,Ci=At,Rn=Bt,Ei=Ut,gt=new WeakMap,Ni=function(){function t(e,n){var r=this;if(this.name="",this.notes=[],this.controlChanges=(0,xi.createControlChanges)(),this.pitchBends=[],gt.set(this,n),e){var i=e.find(function(l){return l.type==="trackName"});this.name=i?i.text:""}if(this.instrument=new Rn.Instrument(e,this),this.channel=0,e){for(var o=e.filter(function(l){return l.type==="noteOn"}),s=e.filter(function(l){return l.type==="noteOff"}),c=function(){var l=o.shift();u.channel=l.channel;var h=s.findIndex(function(m){return m.noteNumber===l.noteNumber&&m.absoluteTime>=l.absoluteTime});if(h!==-1){var p=s.splice(h,1)[0];u.addNote({durationTicks:p.absoluteTime-l.absoluteTime,midi:l.noteNumber,noteOffVelocity:p.velocity/127,ticks:l.absoluteTime,velocity:l.velocity/127})}},u=this;o.length;)c();var a=e.filter(function(l){return l.type==="controller"});a.forEach(function(l){r.addCC({number:l.controllerType,ticks:l.absoluteTime,value:l.value/127})});var d=e.filter(function(l){return l.type==="pitchBend"});d.forEach(function(l){r.addPitchBend({ticks:l.absoluteTime,value:l.value/Math.pow(2,13)})});var f=e.find(function(l){return l.type==="endOfTrack"});this.endOfTrackTicks=f!==void 0?f.absoluteTime:void 0}}return t.prototype.addNote=function(e){var n=gt.get(this),r=new Ei.Note({midi:0,ticks:0,velocity:1},{ticks:0,velocity:0},n);return Object.assign(r,e),(0,jt.insert)(this.notes,r,"ticks"),this},t.prototype.addCC=function(e){var n=gt.get(this),r=new Ii.ControlChange({controllerType:e.number},n);return delete e.number,Object.assign(r,e),Array.isArray(this.controlChanges[r.number])||(this.controlChanges[r.number]=[]),(0,jt.insert)(this.controlChanges[r.number],r,"ticks"),this},t.prototype.addPitchBend=function(e){var n=gt.get(this),r=new Ci.PitchBend({},n);return Object.assign(r,e),(0,jt.insert)(this.pitchBends,r,"ticks"),this},Object.defineProperty(t.prototype,"duration",{get:function(){if(!this.notes.length)return 0;for(var e=this.notes[this.notes.length-1].time+this.notes[this.notes.length-1].duration,n=0;n<this.notes.length-1;n++){var r=this.notes[n].time+this.notes[n].duration;e<r&&(e=r)}return e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"durationTicks",{get:function(){if(!this.notes.length)return 0;for(var e=this.notes[this.notes.length-1].ticks+this.notes[this.notes.length-1].durationTicks,n=0;n<this.notes.length-1;n++){var r=this.notes[n].ticks+this.notes[n].durationTicks;e<r&&(e=r)}return e},enumerable:!1,configurable:!0}),t.prototype.fromJSON=function(e){var n=this;this.name=e.name,this.channel=e.channel,this.instrument=new Rn.Instrument(void 0,this),this.instrument.fromJSON(e.instrument),e.endOfTrackTicks!==void 0&&(this.endOfTrackTicks=e.endOfTrackTicks);for(var r in e.controlChanges)e.controlChanges[r]&&e.controlChanges[r].forEach(function(i){n.addCC({number:i.number,ticks:i.ticks,value:i.value})});e.notes.forEach(function(i){n.addNote({durationTicks:i.durationTicks,midi:i.midi,ticks:i.ticks,velocity:i.velocity})})},t.prototype.toJSON=function(){for(var e={},n=0;n<127;n++)this.controlChanges.hasOwnProperty(n)&&(e[n]=this.controlChanges[n].map(function(i){return i.toJSON()}));var r={channel:this.channel,controlChanges:e,pitchBends:this.pitchBends.map(function(i){return i.toJSON()}),instrument:this.instrument.toJSON(),name:this.name,notes:this.notes.map(function(i){return i.toJSON()})};return this.endOfTrackTicks!==void 0&&(r.endOfTrackTicks=this.endOfTrackTicks),r},t}();et.Track=Ni;var Mt={};function Oi(t){var e=[];return mr(t,e),e}function mr(t,e){for(var n=0;n<t.length;n++){var r=t[n];Array.isArray(r)?mr(r,e):e.push(r)}}const Pi=Object.freeze(Object.defineProperty({__proto__:null,flatten:Oi},Symbol.toStringTag,{value:"Module"})),Ai=hr(Pi);var Ee=Ke&&Ke.__spreadArray||function(t,e,n){if(n||arguments.length===2)for(var r=0,i=e.length,o;r<i;r++)(o||!(r in e))&&(o||(o=Array.prototype.slice.call(e,0,r)),o[r]=e[r]);return t.concat(o||Array.prototype.slice.call(e))};Object.defineProperty(Mt,"__esModule",{value:!0});Mt.encode=void 0;var Bi=Ot,Ui=Et,Mi=Ai;function Fi(t,e){return[{absoluteTime:t.ticks,channel:e,deltaTime:0,noteNumber:t.midi,type:"noteOn",velocity:Math.floor(t.velocity*127)},{absoluteTime:t.ticks+t.durationTicks,channel:e,deltaTime:0,noteNumber:t.midi,type:"noteOff",velocity:Math.floor(t.noteOffVelocity*127)}]}function Ri(t){return(0,Mi.flatten)(t.notes.map(function(e){return Fi(e,t.channel)}))}function Di(t,e){return{absoluteTime:t.ticks,channel:e,controllerType:t.number,deltaTime:0,type:"controller",value:Math.floor(t.value*127)}}function Li(t){for(var e=[],n=0;n<127;n++)t.controlChanges.hasOwnProperty(n)&&t.controlChanges[n].forEach(function(r){e.push(Di(r,t.channel))});return e}function qi(t,e){return{absoluteTime:t.ticks,channel:e,deltaTime:0,type:"pitchBend",value:t.value}}function Vi(t){var e=[];return t.pitchBends.forEach(function(n){e.push(qi(n,t.channel))}),e}function ji(t){return{absoluteTime:0,channel:t.channel,deltaTime:0,programNumber:t.instrument.number,type:"programChange"}}function Hi(t){return{absoluteTime:0,deltaTime:0,meta:!0,text:t,type:"trackName"}}function Ki(t){return{absoluteTime:t.ticks,deltaTime:0,meta:!0,microsecondsPerBeat:Math.floor(6e7/t.bpm),type:"setTempo"}}function Ji(t){return{absoluteTime:t.ticks,deltaTime:0,denominator:t.timeSignature[1],meta:!0,metronome:24,numerator:t.timeSignature[0],thirtyseconds:8,type:"timeSignature"}}function zi(t){var e=Ui.keySignatureKeys.indexOf(t.key);return{absoluteTime:t.ticks,deltaTime:0,key:e+7,meta:!0,scale:t.scale==="major"?0:1,type:"keySignature"}}function Wi(t){return{absoluteTime:t.ticks,deltaTime:0,meta:!0,text:t.text,type:t.type}}function Gi(t){var e={header:{format:1,numTracks:t.tracks.length+1,ticksPerBeat:t.header.ppq},tracks:Ee([Ee(Ee(Ee(Ee([{absoluteTime:0,deltaTime:0,meta:!0,text:t.header.name,type:"trackName"}],t.header.keySignatures.map(function(n){return zi(n)}),!0),t.header.meta.map(function(n){return Wi(n)}),!0),t.header.tempos.map(function(n){return Ki(n)}),!0),t.header.timeSignatures.map(function(n){return Ji(n)}),!0)],t.tracks.map(function(n){return Ee(Ee(Ee([Hi(n.name),ji(n)],Ri(n),!0),Li(n),!0),Vi(n),!0)}),!0)};return e.tracks=e.tracks.map(function(n){n=n.sort(function(i,o){return i.absoluteTime-o.absoluteTime});var r=0;return n.forEach(function(i){i.deltaTime=i.absoluteTime-r,r=i.absoluteTime,delete i.absoluteTime}),n.push({deltaTime:0,meta:!0,type:"endOfTrack"}),n}),new Uint8Array((0,Bi.writeMidi)(e))}Mt.encode=Gi;(function(t){var e=Ke&&Ke.__awaiter||function(f,l,h,p){function m(y){return y instanceof h?y:new h(function(I){I(y)})}return new(h||(h=Promise))(function(y,I){function M(x){try{w(p.next(x))}catch(G){I(G)}}function A(x){try{w(p.throw(x))}catch(G){I(G)}}function w(x){x.done?y(x.value):m(x.value).then(M,A)}w((p=p.apply(f,l||[])).next())})},n=Ke&&Ke.__generator||function(f,l){var h={label:0,sent:function(){if(y[0]&1)throw y[1];return y[1]},trys:[],ops:[]},p,m,y,I;return I={next:M(0),throw:M(1),return:M(2)},typeof Symbol=="function"&&(I[Symbol.iterator]=function(){return this}),I;function M(w){return function(x){return A([w,x])}}function A(w){if(p)throw new TypeError("Generator is already executing.");for(;h;)try{if(p=1,m&&(y=w[0]&2?m.return:w[0]?m.throw||((y=m.return)&&y.call(m),0):m.next)&&!(y=y.call(m,w[1])).done)return y;switch(m=0,y&&(w=[w[0]&2,y.value]),w[0]){case 0:case 1:y=w;break;case 4:return h.label++,{value:w[1],done:!1};case 5:h.label++,m=w[1],w=[0];continue;case 7:w=h.ops.pop(),h.trys.pop();continue;default:if(y=h.trys,!(y=y.length>0&&y[y.length-1])&&(w[0]===6||w[0]===2)){h=0;continue}if(w[0]===3&&(!y||w[1]>y[0]&&w[1]<y[3])){h.label=w[1];break}if(w[0]===6&&h.label<y[1]){h.label=y[1],y=w;break}if(y&&h.label<y[2]){h.label=y[2],h.ops.push(w);break}y[2]&&h.ops.pop(),h.trys.pop();continue}w=l.call(f,h)}catch(x){w=[6,x],m=0}finally{p=y=0}if(w[0]&5)throw w[1];return{value:w[0]?w[1]:void 0,done:!0}}};Object.defineProperty(t,"__esModule",{value:!0}),t.Header=t.Track=t.Midi=void 0;var r=Ot,i=Et,o=et,s=Mt,c=function(){function f(l){var h=this,p=null;if(l){var m=l instanceof ArrayBuffer?new Uint8Array(l):l;p=(0,r.parseMidi)(m),p.tracks.forEach(function(y){var I=0;y.forEach(function(M){I+=M.deltaTime,M.absoluteTime=I})}),p.tracks=d(p.tracks)}this.header=new i.Header(p),this.tracks=[],l&&(this.tracks=p.tracks.map(function(y){return new o.Track(y,h.header)}),p.header.format===1&&this.tracks[0].duration===0&&this.tracks.shift())}return f.fromUrl=function(l){return e(this,void 0,void 0,function(){var h,p;return n(this,function(m){switch(m.label){case 0:return[4,fetch(l)];case 1:return h=m.sent(),h.ok?[4,h.arrayBuffer()]:[3,3];case 2:return p=m.sent(),[2,new f(p)];case 3:throw new Error("Could not load '".concat(l,"'"))}})})},Object.defineProperty(f.prototype,"name",{get:function(){return this.header.name},set:function(l){this.header.name=l},enumerable:!1,configurable:!0}),Object.defineProperty(f.prototype,"duration",{get:function(){var l=this.tracks.map(function(h){return h.duration});return Math.max.apply(Math,l)},enumerable:!1,configurable:!0}),Object.defineProperty(f.prototype,"durationTicks",{get:function(){var l=this.tracks.map(function(h){return h.durationTicks});return Math.max.apply(Math,l)},enumerable:!1,configurable:!0}),f.prototype.addTrack=function(){var l=new o.Track(void 0,this.header);return this.tracks.push(l),l},f.prototype.toArray=function(){return(0,s.encode)(this)},f.prototype.toJSON=function(){return{header:this.header.toJSON(),tracks:this.tracks.map(function(l){return l.toJSON()})}},f.prototype.fromJSON=function(l){var h=this;this.header=new i.Header,this.header.fromJSON(l.header),this.tracks=l.tracks.map(function(p){var m=new o.Track(void 0,h.header);return m.fromJSON(p),m})},f.prototype.clone=function(){var l=new f;return l.fromJSON(this.toJSON()),l},f}();t.Midi=c;var u=et;Object.defineProperty(t,"Track",{enumerable:!0,get:function(){return u.Track}});var a=Et;Object.defineProperty(t,"Header",{enumerable:!0,get:function(){return a.Header}});function d(f){for(var l=[],h=0;h<f.length;h++)for(var p=l.length,m=new Map,y=Array(16).fill(0),I=0,M=f[h];I<M.length;I++){var A=M[I],w=p,x=A.channel;if(x!==void 0){A.type==="programChange"&&(y[x]=A.programNumber);var G=y[x],S="".concat(G," ").concat(x);m.has(S)?w=m.get(S):(w=p+m.size,m.set(S,w))}l[w]||l.push([]),l[w].push(A)}return l}})(fr);const Xe=["C","C#","D","D#","E","F","F#","G","G#","A","A#","B"],Dn={Backquote:"A#2",Tab:"B2",KeyQ:"C3",Digit2:"C#3",KeyW:"D3",Digit3:"D#3",KeyE:"E3",KeyR:"F3",Digit5:"F#3",KeyT:"G3",Digit6:"G#3",KeyY:"A3",Digit7:"A#3",KeyU:"B3",KeyI:"C4",Digit9:"C#4",KeyO:"D4",Digit0:"D#4",KeyP:"E4",BracketLeft:"F4",Equal:"F#4",BracketRight:"G4",Backspace:"G#4",Backslash:"A4",CapsLock:"A#4",ShiftLeft:"B4",KeyZ:"C5",KeyS:"C#5",KeyX:"D5",KeyD:"D#5",KeyC:"E5",KeyV:"F5",KeyG:"F#5",KeyB:"G5",KeyH:"G#5",KeyN:"A5",KeyJ:"A#5",KeyM:"B5",Comma:"C6",KeyL:"C#6",Period:"D6",Semicolon:"D#6",Slash:"E6",ShiftRight:"F6",Enter:"F#6"};function en(t){return parseInt(t.charAt(t.length-1))}function tn(t){return t.substring(0,t.length-1)}function Ht(t){const e=Math.floor(t/12)-1;return Xe[t%12]+e}function Yi(t,e){const n=en(e),r=en(t),i=Xe.indexOf(tn(t)),o=Xe.indexOf(tn(e)),s={};let c=0,u=i;for(let a=r;a<=n;a++){for(;u<Xe.length&&!(a===n&&u>o);){const d=Xe[u],f=d.length===1;s[d+a]={isWhite:f,pressedColor:null,isGhost:!1},f&&c++,u++}u=0}return[s,c]}class $i{constructor(){B(this,"midiIsPlaying",re(!1));B(this,"midiCurrentTime",re(0));B(this,"midiTotalTime",re(0));B(this,"midiFile",re());B(this,"midiSpeed",re(1));B(this,"tracksIndexUpTo",[]);B(this,"midiData",null);B(this,"playIntervalID");B(this,"heldNotes",[]);B(this,"midiAccess");B(this,"onPlayNote");B(this,"onStopNote");this.midiFile.subscribe(e=>{if(this.midiIsPlaying.set(!1),this.midiTotalTime.set(0),this.midiCurrentTime.set(0),!e){this.midiData=null;return}const n=new FileReader;n.onload=()=>this.generatePlayData(n.result),n.readAsArrayBuffer(e)}),this.midiIsPlaying.subscribe(e=>{if(!e){clearInterval(this.playIntervalID),this.heldNotes.forEach(r=>this.onStopNote(r.name)),this.heldNotes=[];return}if(!this.midiData)return this.midiIsPlaying.set(!1),alert("No MIDI file selected!");this.midiData.tracks.forEach((r,i)=>{const o=ve(this.midiCurrentTime),s=Xi(r.notes,c=>c.time-o);this.tracksIndexUpTo[i]=s});let n=performance.now();this.playIntervalID=setInterval(()=>{const r=performance.now(),i=r-n;n=r,this.onUpdate(i/1e3*ve(this.midiSpeed))},10)}),navigator.requestMIDIAccess().then(e=>{this.midiAccess=e,this.connectMidiDevices(),e.onstatechange=()=>{this.connectMidiDevices()}})}generatePlayData(e){this.midiData=new fr.Midi(e),this.midiData.tracks=this.midiData.tracks.filter(r=>r.notes.length!==0);let n=0;this.midiData.tracks.forEach(r=>{const i=r.notes[r.notes.length-1],o=i.time+i.duration;o>n&&(n=o)}),this.midiTotalTime.set(n)}onUpdate(e){const n=ve(this.midiCurrentTime)+e;this.midiCurrentTime.set(n),this.heldNotes.forEach((r,i)=>{n>r.time+r.duration&&(this.onStopNote(r.name),Qi(this.heldNotes,i))}),this.midiData.tracks.forEach((r,i)=>{for(;;){const o=r.notes[this.tracksIndexUpTo[i]];if(!o||n<o.time)break;this.onPlayNote(o.name,o.velocity),this.heldNotes.push(o),this.tracksIndexUpTo[i]++}}),n>ve(this.midiTotalTime)&&this.midiIsPlaying.set(!1)}connectMidiDevices(){this.midiAccess.inputs.forEach(e=>{e.onmidimessage=this.onMidiEvent})}onMidiEvent(e){const[n,r,i]=e.data;n>=144&&n<=159?i==0?this.onStopNote(Ht(r)):this.onPlayNote(Ht(r),i/127):n>=128&&n<=143&&this.onStopNote(Ht(r))}}function Xi(t,e){let n=0,r=t.length-1;for(;n!=r;){const i=Math.ceil((n+r)/2);e(t[i])>0?r=i-1:n=i}return r}function Qi(t,e){t[e]=t[t.length-1],t.pop()}const ke=Object.create(null);ke.open="0";ke.close="1";ke.ping="2";ke.pong="3";ke.message="4";ke.upgrade="5";ke.noop="6";const wt=Object.create(null);Object.keys(ke).forEach(t=>{wt[ke[t]]=t});const Zi={type:"error",data:"parser error"},yr=typeof Blob=="function"||typeof Blob<"u"&&Object.prototype.toString.call(Blob)==="[object BlobConstructor]",gr=typeof ArrayBuffer=="function",br=t=>typeof ArrayBuffer.isView=="function"?ArrayBuffer.isView(t):t&&t.buffer instanceof ArrayBuffer,pn=({type:t,data:e},n,r)=>yr&&e instanceof Blob?n?r(e):Ln(e,r):gr&&(e instanceof ArrayBuffer||br(e))?n?r(e):Ln(new Blob([e]),r):r(ke[t]+(e||"")),Ln=(t,e)=>{const n=new FileReader;return n.onload=function(){const r=n.result.split(",")[1];e("b"+(r||""))},n.readAsDataURL(t)};function qn(t){return t instanceof Uint8Array?t:t instanceof ArrayBuffer?new Uint8Array(t):new Uint8Array(t.buffer,t.byteOffset,t.byteLength)}let Kt;function es(t,e){if(yr&&t.data instanceof Blob)return t.data.arrayBuffer().then(qn).then(e);if(gr&&(t.data instanceof ArrayBuffer||br(t.data)))return e(qn(t.data));pn(t,!1,n=>{Kt||(Kt=new TextEncoder),e(Kt.encode(n))})}const Vn="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",Qe=typeof Uint8Array>"u"?[]:new Uint8Array(256);for(let t=0;t<Vn.length;t++)Qe[Vn.charCodeAt(t)]=t;const ts=t=>{let e=t.length*.75,n=t.length,r,i=0,o,s,c,u;t[t.length-1]==="="&&(e--,t[t.length-2]==="="&&e--);const a=new ArrayBuffer(e),d=new Uint8Array(a);for(r=0;r<n;r+=4)o=Qe[t.charCodeAt(r)],s=Qe[t.charCodeAt(r+1)],c=Qe[t.charCodeAt(r+2)],u=Qe[t.charCodeAt(r+3)],d[i++]=o<<2|s>>4,d[i++]=(s&15)<<4|c>>2,d[i++]=(c&3)<<6|u&63;return a},ns=typeof ArrayBuffer=="function",mn=(t,e)=>{if(typeof t!="string")return{type:"message",data:vr(t,e)};const n=t.charAt(0);return n==="b"?{type:"message",data:rs(t.substring(1),e)}:wt[n]?t.length>1?{type:wt[n],data:t.substring(1)}:{type:wt[n]}:Zi},rs=(t,e)=>{if(ns){const n=ts(t);return vr(n,e)}else return{base64:!0,data:t}},vr=(t,e)=>{switch(e){case"blob":return t instanceof Blob?t:new Blob([t]);case"arraybuffer":default:return t instanceof ArrayBuffer?t:t.buffer}},_r=String.fromCharCode(30),is=(t,e)=>{const n=t.length,r=new Array(n);let i=0;t.forEach((o,s)=>{pn(o,!1,c=>{r[s]=c,++i===n&&e(r.join(_r))})})},ss=(t,e)=>{const n=t.split(_r),r=[];for(let i=0;i<n.length;i++){const o=mn(n[i],e);if(r.push(o),o.type==="error")break}return r};let Jt;function os(t,e,n){Jt||(Jt=new TextDecoder);const r=e||t[0]<48||t[0]>54;return mn(r?t:Jt.decode(t),n)}const kr=4;function K(t){if(t)return as(t)}function as(t){for(var e in K.prototype)t[e]=K.prototype[e];return t}K.prototype.on=K.prototype.addEventListener=function(t,e){return this._callbacks=this._callbacks||{},(this._callbacks["$"+t]=this._callbacks["$"+t]||[]).push(e),this};K.prototype.once=function(t,e){function n(){this.off(t,n),e.apply(this,arguments)}return n.fn=e,this.on(t,n),this};K.prototype.off=K.prototype.removeListener=K.prototype.removeAllListeners=K.prototype.removeEventListener=function(t,e){if(this._callbacks=this._callbacks||{},arguments.length==0)return this._callbacks={},this;var n=this._callbacks["$"+t];if(!n)return this;if(arguments.length==1)return delete this._callbacks["$"+t],this;for(var r,i=0;i<n.length;i++)if(r=n[i],r===e||r.fn===e){n.splice(i,1);break}return n.length===0&&delete this._callbacks["$"+t],this};K.prototype.emit=function(t){this._callbacks=this._callbacks||{};for(var e=new Array(arguments.length-1),n=this._callbacks["$"+t],r=1;r<arguments.length;r++)e[r-1]=arguments[r];if(n){n=n.slice(0);for(var r=0,i=n.length;r<i;++r)n[r].apply(this,e)}return this};K.prototype.emitReserved=K.prototype.emit;K.prototype.listeners=function(t){return this._callbacks=this._callbacks||{},this._callbacks["$"+t]||[]};K.prototype.hasListeners=function(t){return!!this.listeners(t).length};const le=(()=>typeof self<"u"?self:typeof window<"u"?window:Function("return this")())();function wr(t,...e){return e.reduce((n,r)=>(t.hasOwnProperty(r)&&(n[r]=t[r]),n),{})}const cs=le.setTimeout,us=le.clearTimeout;function Ft(t,e){e.useNativeTimers?(t.setTimeoutFn=cs.bind(le),t.clearTimeoutFn=us.bind(le)):(t.setTimeoutFn=le.setTimeout.bind(le),t.clearTimeoutFn=le.clearTimeout.bind(le))}const ls=1.33;function hs(t){return typeof t=="string"?fs(t):Math.ceil((t.byteLength||t.size)*ls)}function fs(t){let e=0,n=0;for(let r=0,i=t.length;r<i;r++)e=t.charCodeAt(r),e<128?n+=1:e<2048?n+=2:e<55296||e>=57344?n+=3:(r++,n+=4);return n}function ds(t){let e="";for(let n in t)t.hasOwnProperty(n)&&(e.length&&(e+="&"),e+=encodeURIComponent(n)+"="+encodeURIComponent(t[n]));return e}function ps(t){let e={},n=t.split("&");for(let r=0,i=n.length;r<i;r++){let o=n[r].split("=");e[decodeURIComponent(o[0])]=decodeURIComponent(o[1])}return e}class ms extends Error{constructor(e,n,r){super(e),this.description=n,this.context=r,this.type="TransportError"}}class yn extends K{constructor(e){super(),this.writable=!1,Ft(this,e),this.opts=e,this.query=e.query,this.socket=e.socket}onError(e,n,r){return super.emitReserved("error",new ms(e,n,r)),this}open(){return this.readyState="opening",this.doOpen(),this}close(){return(this.readyState==="opening"||this.readyState==="open")&&(this.doClose(),this.onClose()),this}send(e){this.readyState==="open"&&this.write(e)}onOpen(){this.readyState="open",this.writable=!0,super.emitReserved("open")}onData(e){const n=mn(e,this.socket.binaryType);this.onPacket(n)}onPacket(e){super.emitReserved("packet",e)}onClose(e){this.readyState="closed",super.emitReserved("close",e)}pause(e){}createUri(e,n={}){return e+"://"+this._hostname()+this._port()+this.opts.path+this._query(n)}_hostname(){const e=this.opts.hostname;return e.indexOf(":")===-1?e:"["+e+"]"}_port(){return this.opts.port&&(this.opts.secure&&+(this.opts.port!==443)||!this.opts.secure&&Number(this.opts.port)!==80)?":"+this.opts.port:""}_query(e){const n=ds(e);return n.length?"?"+n:""}}const Tr="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz-_".split(""),nn=64,ys={};let jn=0,bt=0,Hn;function Kn(t){let e="";do e=Tr[t%nn]+e,t=Math.floor(t/nn);while(t>0);return e}function Sr(){const t=Kn(+new Date);return t!==Hn?(jn=0,Hn=t):t+"."+Kn(jn++)}for(;bt<nn;bt++)ys[Tr[bt]]=bt;let Ir=!1;try{Ir=typeof XMLHttpRequest<"u"&&"withCredentials"in new XMLHttpRequest}catch{}const gs=Ir;function xr(t){const e=t.xdomain;try{if(typeof XMLHttpRequest<"u"&&(!e||gs))return new XMLHttpRequest}catch{}if(!e)try{return new le[["Active"].concat("Object").join("X")]("Microsoft.XMLHTTP")}catch{}}function bs(){}const vs=function(){return new xr({xdomain:!1}).responseType!=null}();class _s extends yn{constructor(e){if(super(e),this.polling=!1,typeof location<"u"){const r=location.protocol==="https:";let i=location.port;i||(i=r?"443":"80"),this.xd=typeof location<"u"&&e.hostname!==location.hostname||i!==e.port}const n=e&&e.forceBase64;this.supportsBinary=vs&&!n,this.opts.withCredentials&&(this.cookieJar=void 0)}get name(){return"polling"}doOpen(){this.poll()}pause(e){this.readyState="pausing";const n=()=>{this.readyState="paused",e()};if(this.polling||!this.writable){let r=0;this.polling&&(r++,this.once("pollComplete",function(){--r||n()})),this.writable||(r++,this.once("drain",function(){--r||n()}))}else n()}poll(){this.polling=!0,this.doPoll(),this.emitReserved("poll")}onData(e){const n=r=>{if(this.readyState==="opening"&&r.type==="open"&&this.onOpen(),r.type==="close")return this.onClose({description:"transport closed by the server"}),!1;this.onPacket(r)};ss(e,this.socket.binaryType).forEach(n),this.readyState!=="closed"&&(this.polling=!1,this.emitReserved("pollComplete"),this.readyState==="open"&&this.poll())}doClose(){const e=()=>{this.write([{type:"close"}])};this.readyState==="open"?e():this.once("open",e)}write(e){this.writable=!1,is(e,n=>{this.doWrite(n,()=>{this.writable=!0,this.emitReserved("drain")})})}uri(){const e=this.opts.secure?"https":"http",n=this.query||{};return this.opts.timestampRequests!==!1&&(n[this.opts.timestampParam]=Sr()),!this.supportsBinary&&!n.sid&&(n.b64=1),this.createUri(e,n)}request(e={}){return Object.assign(e,{xd:this.xd,cookieJar:this.cookieJar},this.opts),new _e(this.uri(),e)}doWrite(e,n){const r=this.request({method:"POST",data:e});r.on("success",n),r.on("error",(i,o)=>{this.onError("xhr post error",i,o)})}doPoll(){const e=this.request();e.on("data",this.onData.bind(this)),e.on("error",(n,r)=>{this.onError("xhr poll error",n,r)}),this.pollXhr=e}}class _e extends K{constructor(e,n){super(),Ft(this,n),this.opts=n,this.method=n.method||"GET",this.uri=e,this.data=n.data!==void 0?n.data:null,this.create()}create(){var e;const n=wr(this.opts,"agent","pfx","key","passphrase","cert","ca","ciphers","rejectUnauthorized","autoUnref");n.xdomain=!!this.opts.xd;const r=this.xhr=new xr(n);try{r.open(this.method,this.uri,!0);try{if(this.opts.extraHeaders){r.setDisableHeaderCheck&&r.setDisableHeaderCheck(!0);for(let i in this.opts.extraHeaders)this.opts.extraHeaders.hasOwnProperty(i)&&r.setRequestHeader(i,this.opts.extraHeaders[i])}}catch{}if(this.method==="POST")try{r.setRequestHeader("Content-type","text/plain;charset=UTF-8")}catch{}try{r.setRequestHeader("Accept","*/*")}catch{}(e=this.opts.cookieJar)===null||e===void 0||e.addCookies(r),"withCredentials"in r&&(r.withCredentials=this.opts.withCredentials),this.opts.requestTimeout&&(r.timeout=this.opts.requestTimeout),r.onreadystatechange=()=>{var i;r.readyState===3&&((i=this.opts.cookieJar)===null||i===void 0||i.parseCookies(r)),r.readyState===4&&(r.status===200||r.status===1223?this.onLoad():this.setTimeoutFn(()=>{this.onError(typeof r.status=="number"?r.status:0)},0))},r.send(this.data)}catch(i){this.setTimeoutFn(()=>{this.onError(i)},0);return}typeof document<"u"&&(this.index=_e.requestsCount++,_e.requests[this.index]=this)}onError(e){this.emitReserved("error",e,this.xhr),this.cleanup(!0)}cleanup(e){if(!(typeof this.xhr>"u"||this.xhr===null)){if(this.xhr.onreadystatechange=bs,e)try{this.xhr.abort()}catch{}typeof document<"u"&&delete _e.requests[this.index],this.xhr=null}}onLoad(){const e=this.xhr.responseText;e!==null&&(this.emitReserved("data",e),this.emitReserved("success"),this.cleanup())}abort(){this.cleanup()}}_e.requestsCount=0;_e.requests={};if(typeof document<"u"){if(typeof attachEvent=="function")attachEvent("onunload",Jn);else if(typeof addEventListener=="function"){const t="onpagehide"in le?"pagehide":"unload";addEventListener(t,Jn,!1)}}function Jn(){for(let t in _e.requests)_e.requests.hasOwnProperty(t)&&_e.requests[t].abort()}const gn=(()=>typeof Promise=="function"&&typeof Promise.resolve=="function"?e=>Promise.resolve().then(e):(e,n)=>n(e,0))(),vt=le.WebSocket||le.MozWebSocket,zn=!0,ks="arraybuffer",Wn=typeof navigator<"u"&&typeof navigator.product=="string"&&navigator.product.toLowerCase()==="reactnative";class ws extends yn{constructor(e){super(e),this.supportsBinary=!e.forceBase64}get name(){return"websocket"}doOpen(){if(!this.check())return;const e=this.uri(),n=this.opts.protocols,r=Wn?{}:wr(this.opts,"agent","perMessageDeflate","pfx","key","passphrase","cert","ca","ciphers","rejectUnauthorized","localAddress","protocolVersion","origin","maxPayload","family","checkServerIdentity");this.opts.extraHeaders&&(r.headers=this.opts.extraHeaders);try{this.ws=zn&&!Wn?n?new vt(e,n):new vt(e):new vt(e,n,r)}catch(i){return this.emitReserved("error",i)}this.ws.binaryType=this.socket.binaryType||ks,this.addEventListeners()}addEventListeners(){this.ws.onopen=()=>{this.opts.autoUnref&&this.ws._socket.unref(),this.onOpen()},this.ws.onclose=e=>this.onClose({description:"websocket connection closed",context:e}),this.ws.onmessage=e=>this.onData(e.data),this.ws.onerror=e=>this.onError("websocket error",e)}write(e){this.writable=!1;for(let n=0;n<e.length;n++){const r=e[n],i=n===e.length-1;pn(r,this.supportsBinary,o=>{const s={};try{zn&&this.ws.send(o)}catch{}i&&gn(()=>{this.writable=!0,this.emitReserved("drain")},this.setTimeoutFn)})}}doClose(){typeof this.ws<"u"&&(this.ws.close(),this.ws=null)}uri(){const e=this.opts.secure?"wss":"ws",n=this.query||{};return this.opts.timestampRequests&&(n[this.opts.timestampParam]=Sr()),this.supportsBinary||(n.b64=1),this.createUri(e,n)}check(){return!!vt}}function Ts(t,e){return t.type==="message"&&typeof t.data!="string"&&e[0]>=48&&e[0]<=54}class Ss extends yn{get name(){return"webtransport"}doOpen(){typeof WebTransport=="function"&&(this.transport=new WebTransport(this.createUri("https"),this.opts.transportOptions[this.name]),this.transport.closed.then(()=>{this.onClose()}).catch(e=>{this.onError("webtransport error",e)}),this.transport.ready.then(()=>{this.transport.createBidirectionalStream().then(e=>{const n=e.readable.getReader();this.writer=e.writable.getWriter();let r;const i=()=>{n.read().then(({done:s,value:c})=>{s||(!r&&c.byteLength===1&&c[0]===54?r=!0:(this.onPacket(os(c,r,"arraybuffer")),r=!1),i())}).catch(s=>{})};i();const o=this.query.sid?`0{"sid":"${this.query.sid}"}`:"0";this.writer.write(new TextEncoder().encode(o)).then(()=>this.onOpen())})}))}write(e){this.writable=!1;for(let n=0;n<e.length;n++){const r=e[n],i=n===e.length-1;es(r,o=>{Ts(r,o)&&this.writer.write(Uint8Array.of(54)),this.writer.write(o).then(()=>{i&&gn(()=>{this.writable=!0,this.emitReserved("drain")},this.setTimeoutFn)})})}}doClose(){var e;(e=this.transport)===null||e===void 0||e.close()}}const Is={websocket:ws,webtransport:Ss,polling:_s},xs=/^(?:(?![^:@\/?#]+:[^:@\/]*@)(http|https|ws|wss):\/\/)?((?:(([^:@\/?#]*)(?::([^:@\/?#]*))?)?@)?((?:[a-f0-9]{0,4}:){2,7}[a-f0-9]{0,4}|[^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/,Cs=["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"];function rn(t){const e=t,n=t.indexOf("["),r=t.indexOf("]");n!=-1&&r!=-1&&(t=t.substring(0,n)+t.substring(n,r).replace(/:/g,";")+t.substring(r,t.length));let i=xs.exec(t||""),o={},s=14;for(;s--;)o[Cs[s]]=i[s]||"";return n!=-1&&r!=-1&&(o.source=e,o.host=o.host.substring(1,o.host.length-1).replace(/;/g,":"),o.authority=o.authority.replace("[","").replace("]","").replace(/;/g,":"),o.ipv6uri=!0),o.pathNames=Es(o,o.path),o.queryKey=Ns(o,o.query),o}function Es(t,e){const n=/\/{2,9}/g,r=e.replace(n,"/").split("/");return(e.slice(0,1)=="/"||e.length===0)&&r.splice(0,1),e.slice(-1)=="/"&&r.splice(r.length-1,1),r}function Ns(t,e){const n={};return e.replace(/(?:^|&)([^&=]*)=?([^&]*)/g,function(r,i,o){i&&(n[i]=o)}),n}let Cr=class He extends K{constructor(e,n={}){super(),this.writeBuffer=[],e&&typeof e=="object"&&(n=e,e=null),e?(e=rn(e),n.hostname=e.host,n.secure=e.protocol==="https"||e.protocol==="wss",n.port=e.port,e.query&&(n.query=e.query)):n.host&&(n.hostname=rn(n.host).host),Ft(this,n),this.secure=n.secure!=null?n.secure:typeof location<"u"&&location.protocol==="https:",n.hostname&&!n.port&&(n.port=this.secure?"443":"80"),this.hostname=n.hostname||(typeof location<"u"?location.hostname:"localhost"),this.port=n.port||(typeof location<"u"&&location.port?location.port:this.secure?"443":"80"),this.transports=n.transports||["polling","websocket","webtransport"],this.writeBuffer=[],this.prevBufferLen=0,this.opts=Object.assign({path:"/engine.io",agent:!1,withCredentials:!1,upgrade:!0,timestampParam:"t",rememberUpgrade:!1,addTrailingSlash:!0,rejectUnauthorized:!0,perMessageDeflate:{threshold:1024},transportOptions:{},closeOnBeforeunload:!1},n),this.opts.path=this.opts.path.replace(/\/$/,"")+(this.opts.addTrailingSlash?"/":""),typeof this.opts.query=="string"&&(this.opts.query=ps(this.opts.query)),this.id=null,this.upgrades=null,this.pingInterval=null,this.pingTimeout=null,this.pingTimeoutTimer=null,typeof addEventListener=="function"&&(this.opts.closeOnBeforeunload&&(this.beforeunloadEventListener=()=>{this.transport&&(this.transport.removeAllListeners(),this.transport.close())},addEventListener("beforeunload",this.beforeunloadEventListener,!1)),this.hostname!=="localhost"&&(this.offlineEventListener=()=>{this.onClose("transport close",{description:"network connection lost"})},addEventListener("offline",this.offlineEventListener,!1))),this.open()}createTransport(e){const n=Object.assign({},this.opts.query);n.EIO=kr,n.transport=e,this.id&&(n.sid=this.id);const r=Object.assign({},this.opts,{query:n,socket:this,hostname:this.hostname,secure:this.secure,port:this.port},this.opts.transportOptions[e]);return new Is[e](r)}open(){let e;if(this.opts.rememberUpgrade&&He.priorWebsocketSuccess&&this.transports.indexOf("websocket")!==-1)e="websocket";else if(this.transports.length===0){this.setTimeoutFn(()=>{this.emitReserved("error","No transports available")},0);return}else e=this.transports[0];this.readyState="opening";try{e=this.createTransport(e)}catch{this.transports.shift(),this.open();return}e.open(),this.setTransport(e)}setTransport(e){this.transport&&this.transport.removeAllListeners(),this.transport=e,e.on("drain",this.onDrain.bind(this)).on("packet",this.onPacket.bind(this)).on("error",this.onError.bind(this)).on("close",n=>this.onClose("transport close",n))}probe(e){let n=this.createTransport(e),r=!1;He.priorWebsocketSuccess=!1;const i=()=>{r||(n.send([{type:"ping",data:"probe"}]),n.once("packet",f=>{if(!r)if(f.type==="pong"&&f.data==="probe"){if(this.upgrading=!0,this.emitReserved("upgrading",n),!n)return;He.priorWebsocketSuccess=n.name==="websocket",this.transport.pause(()=>{r||this.readyState!=="closed"&&(d(),this.setTransport(n),n.send([{type:"upgrade"}]),this.emitReserved("upgrade",n),n=null,this.upgrading=!1,this.flush())})}else{const l=new Error("probe error");l.transport=n.name,this.emitReserved("upgradeError",l)}}))};function o(){r||(r=!0,d(),n.close(),n=null)}const s=f=>{const l=new Error("probe error: "+f);l.transport=n.name,o(),this.emitReserved("upgradeError",l)};function c(){s("transport closed")}function u(){s("socket closed")}function a(f){n&&f.name!==n.name&&o()}const d=()=>{n.removeListener("open",i),n.removeListener("error",s),n.removeListener("close",c),this.off("close",u),this.off("upgrading",a)};n.once("open",i),n.once("error",s),n.once("close",c),this.once("close",u),this.once("upgrading",a),this.upgrades.indexOf("webtransport")!==-1&&e!=="webtransport"?this.setTimeoutFn(()=>{r||n.open()},200):n.open()}onOpen(){if(this.readyState="open",He.priorWebsocketSuccess=this.transport.name==="websocket",this.emitReserved("open"),this.flush(),this.readyState==="open"&&this.opts.upgrade){let e=0;const n=this.upgrades.length;for(;e<n;e++)this.probe(this.upgrades[e])}}onPacket(e){if(this.readyState==="opening"||this.readyState==="open"||this.readyState==="closing")switch(this.emitReserved("packet",e),this.emitReserved("heartbeat"),e.type){case"open":this.onHandshake(JSON.parse(e.data));break;case"ping":this.resetPingTimeout(),this.sendPacket("pong"),this.emitReserved("ping"),this.emitReserved("pong");break;case"error":const n=new Error("server error");n.code=e.data,this.onError(n);break;case"message":this.emitReserved("data",e.data),this.emitReserved("message",e.data);break}}onHandshake(e){this.emitReserved("handshake",e),this.id=e.sid,this.transport.query.sid=e.sid,this.upgrades=this.filterUpgrades(e.upgrades),this.pingInterval=e.pingInterval,this.pingTimeout=e.pingTimeout,this.maxPayload=e.maxPayload,this.onOpen(),this.readyState!=="closed"&&this.resetPingTimeout()}resetPingTimeout(){this.clearTimeoutFn(this.pingTimeoutTimer),this.pingTimeoutTimer=this.setTimeoutFn(()=>{this.onClose("ping timeout")},this.pingInterval+this.pingTimeout),this.opts.autoUnref&&this.pingTimeoutTimer.unref()}onDrain(){this.writeBuffer.splice(0,this.prevBufferLen),this.prevBufferLen=0,this.writeBuffer.length===0?this.emitReserved("drain"):this.flush()}flush(){if(this.readyState!=="closed"&&this.transport.writable&&!this.upgrading&&this.writeBuffer.length){const e=this.getWritablePackets();this.transport.send(e),this.prevBufferLen=e.length,this.emitReserved("flush")}}getWritablePackets(){if(!(this.maxPayload&&this.transport.name==="polling"&&this.writeBuffer.length>1))return this.writeBuffer;let n=1;for(let r=0;r<this.writeBuffer.length;r++){const i=this.writeBuffer[r].data;if(i&&(n+=hs(i)),r>0&&n>this.maxPayload)return this.writeBuffer.slice(0,r);n+=2}return this.writeBuffer}write(e,n,r){return this.sendPacket("message",e,n,r),this}send(e,n,r){return this.sendPacket("message",e,n,r),this}sendPacket(e,n,r,i){if(typeof n=="function"&&(i=n,n=void 0),typeof r=="function"&&(i=r,r=null),this.readyState==="closing"||this.readyState==="closed")return;r=r||{},r.compress=r.compress!==!1;const o={type:e,data:n,options:r};this.emitReserved("packetCreate",o),this.writeBuffer.push(o),i&&this.once("flush",i),this.flush()}close(){const e=()=>{this.onClose("forced close"),this.transport.close()},n=()=>{this.off("upgrade",n),this.off("upgradeError",n),e()},r=()=>{this.once("upgrade",n),this.once("upgradeError",n)};return(this.readyState==="opening"||this.readyState==="open")&&(this.readyState="closing",this.writeBuffer.length?this.once("drain",()=>{this.upgrading?r():e()}):this.upgrading?r():e()),this}onError(e){He.priorWebsocketSuccess=!1,this.emitReserved("error",e),this.onClose("transport error",e)}onClose(e,n){(this.readyState==="opening"||this.readyState==="open"||this.readyState==="closing")&&(this.clearTimeoutFn(this.pingTimeoutTimer),this.transport.removeAllListeners("close"),this.transport.close(),this.transport.removeAllListeners(),typeof removeEventListener=="function"&&(removeEventListener("beforeunload",this.beforeunloadEventListener,!1),removeEventListener("offline",this.offlineEventListener,!1)),this.readyState="closed",this.id=null,this.emitReserved("close",e,n),this.writeBuffer=[],this.prevBufferLen=0)}filterUpgrades(e){const n=[];let r=0;const i=e.length;for(;r<i;r++)~this.transports.indexOf(e[r])&&n.push(e[r]);return n}};Cr.protocol=kr;function Os(t,e="",n){let r=t;n=n||typeof location<"u"&&location,t==null&&(t=n.protocol+"//"+n.host),typeof t=="string"&&(t.charAt(0)==="/"&&(t.charAt(1)==="/"?t=n.protocol+t:t=n.host+t),/^(https?|wss?):\/\//.test(t)||(typeof n<"u"?t=n.protocol+"//"+t:t="https://"+t),r=rn(t)),r.port||(/^(http|ws)$/.test(r.protocol)?r.port="80":/^(http|ws)s$/.test(r.protocol)&&(r.port="443")),r.path=r.path||"/";const o=r.host.indexOf(":")!==-1?"["+r.host+"]":r.host;return r.id=r.protocol+"://"+o+":"+r.port+e,r.href=r.protocol+"://"+o+(n&&n.port===r.port?"":":"+r.port),r}const Ps=typeof ArrayBuffer=="function",As=t=>typeof ArrayBuffer.isView=="function"?ArrayBuffer.isView(t):t.buffer instanceof ArrayBuffer,Er=Object.prototype.toString,Bs=typeof Blob=="function"||typeof Blob<"u"&&Er.call(Blob)==="[object BlobConstructor]",Us=typeof File=="function"||typeof File<"u"&&Er.call(File)==="[object FileConstructor]";function bn(t){return Ps&&(t instanceof ArrayBuffer||As(t))||Bs&&t instanceof Blob||Us&&t instanceof File}function Tt(t,e){if(!t||typeof t!="object")return!1;if(Array.isArray(t)){for(let n=0,r=t.length;n<r;n++)if(Tt(t[n]))return!0;return!1}if(bn(t))return!0;if(t.toJSON&&typeof t.toJSON=="function"&&arguments.length===1)return Tt(t.toJSON(),!0);for(const n in t)if(Object.prototype.hasOwnProperty.call(t,n)&&Tt(t[n]))return!0;return!1}function Ms(t){const e=[],n=t.data,r=t;return r.data=sn(n,e),r.attachments=e.length,{packet:r,buffers:e}}function sn(t,e){if(!t)return t;if(bn(t)){const n={_placeholder:!0,num:e.length};return e.push(t),n}else if(Array.isArray(t)){const n=new Array(t.length);for(let r=0;r<t.length;r++)n[r]=sn(t[r],e);return n}else if(typeof t=="object"&&!(t instanceof Date)){const n={};for(const r in t)Object.prototype.hasOwnProperty.call(t,r)&&(n[r]=sn(t[r],e));return n}return t}function Fs(t,e){return t.data=on(t.data,e),delete t.attachments,t}function on(t,e){if(!t)return t;if(t&&t._placeholder===!0){if(typeof t.num=="number"&&t.num>=0&&t.num<e.length)return e[t.num];throw new Error("illegal attachments")}else if(Array.isArray(t))for(let n=0;n<t.length;n++)t[n]=on(t[n],e);else if(typeof t=="object")for(const n in t)Object.prototype.hasOwnProperty.call(t,n)&&(t[n]=on(t[n],e));return t}const Rs=["connect","connect_error","disconnect","disconnecting","newListener","removeListener"],Ds=5;var N;(function(t){t[t.CONNECT=0]="CONNECT",t[t.DISCONNECT=1]="DISCONNECT",t[t.EVENT=2]="EVENT",t[t.ACK=3]="ACK",t[t.CONNECT_ERROR=4]="CONNECT_ERROR",t[t.BINARY_EVENT=5]="BINARY_EVENT",t[t.BINARY_ACK=6]="BINARY_ACK"})(N||(N={}));class Ls{constructor(e){this.replacer=e}encode(e){return(e.type===N.EVENT||e.type===N.ACK)&&Tt(e)?this.encodeAsBinary({type:e.type===N.EVENT?N.BINARY_EVENT:N.BINARY_ACK,nsp:e.nsp,data:e.data,id:e.id}):[this.encodeAsString(e)]}encodeAsString(e){let n=""+e.type;return(e.type===N.BINARY_EVENT||e.type===N.BINARY_ACK)&&(n+=e.attachments+"-"),e.nsp&&e.nsp!=="/"&&(n+=e.nsp+","),e.id!=null&&(n+=e.id),e.data!=null&&(n+=JSON.stringify(e.data,this.replacer)),n}encodeAsBinary(e){const n=Ms(e),r=this.encodeAsString(n.packet),i=n.buffers;return i.unshift(r),i}}function Gn(t){return Object.prototype.toString.call(t)==="[object Object]"}class vn extends K{constructor(e){super(),this.reviver=e}add(e){let n;if(typeof e=="string"){if(this.reconstructor)throw new Error("got plaintext data when reconstructing a packet");n=this.decodeString(e);const r=n.type===N.BINARY_EVENT;r||n.type===N.BINARY_ACK?(n.type=r?N.EVENT:N.ACK,this.reconstructor=new qs(n),n.attachments===0&&super.emitReserved("decoded",n)):super.emitReserved("decoded",n)}else if(bn(e)||e.base64)if(this.reconstructor)n=this.reconstructor.takeBinaryData(e),n&&(this.reconstructor=null,super.emitReserved("decoded",n));else throw new Error("got binary data when not reconstructing a packet");else throw new Error("Unknown type: "+e)}decodeString(e){let n=0;const r={type:Number(e.charAt(0))};if(N[r.type]===void 0)throw new Error("unknown packet type "+r.type);if(r.type===N.BINARY_EVENT||r.type===N.BINARY_ACK){const o=n+1;for(;e.charAt(++n)!=="-"&&n!=e.length;);const s=e.substring(o,n);if(s!=Number(s)||e.charAt(n)!=="-")throw new Error("Illegal attachments");r.attachments=Number(s)}if(e.charAt(n+1)==="/"){const o=n+1;for(;++n&&!(e.charAt(n)===","||n===e.length););r.nsp=e.substring(o,n)}else r.nsp="/";const i=e.charAt(n+1);if(i!==""&&Number(i)==i){const o=n+1;for(;++n;){const s=e.charAt(n);if(s==null||Number(s)!=s){--n;break}if(n===e.length)break}r.id=Number(e.substring(o,n+1))}if(e.charAt(++n)){const o=this.tryParse(e.substr(n));if(vn.isPayloadValid(r.type,o))r.data=o;else throw new Error("invalid payload")}return r}tryParse(e){try{return JSON.parse(e,this.reviver)}catch{return!1}}static isPayloadValid(e,n){switch(e){case N.CONNECT:return Gn(n);case N.DISCONNECT:return n===void 0;case N.CONNECT_ERROR:return typeof n=="string"||Gn(n);case N.EVENT:case N.BINARY_EVENT:return Array.isArray(n)&&(typeof n[0]=="number"||typeof n[0]=="string"&&Rs.indexOf(n[0])===-1);case N.ACK:case N.BINARY_ACK:return Array.isArray(n)}}destroy(){this.reconstructor&&(this.reconstructor.finishedReconstruction(),this.reconstructor=null)}}class qs{constructor(e){this.packet=e,this.buffers=[],this.reconPack=e}takeBinaryData(e){if(this.buffers.push(e),this.buffers.length===this.reconPack.attachments){const n=Fs(this.reconPack,this.buffers);return this.finishedReconstruction(),n}return null}finishedReconstruction(){this.reconPack=null,this.buffers=[]}}const Vs=Object.freeze(Object.defineProperty({__proto__:null,Decoder:vn,Encoder:Ls,get PacketType(){return N},protocol:Ds},Symbol.toStringTag,{value:"Module"}));function me(t,e,n){return t.on(e,n),function(){t.off(e,n)}}const js=Object.freeze({connect:1,connect_error:1,disconnect:1,disconnecting:1,newListener:1,removeListener:1});class Nr extends K{constructor(e,n,r){super(),this.connected=!1,this.recovered=!1,this.receiveBuffer=[],this.sendBuffer=[],this._queue=[],this._queueSeq=0,this.ids=0,this.acks={},this.flags={},this.io=e,this.nsp=n,r&&r.auth&&(this.auth=r.auth),this._opts=Object.assign({},r),this.io._autoConnect&&this.open()}get disconnected(){return!this.connected}subEvents(){if(this.subs)return;const e=this.io;this.subs=[me(e,"open",this.onopen.bind(this)),me(e,"packet",this.onpacket.bind(this)),me(e,"error",this.onerror.bind(this)),me(e,"close",this.onclose.bind(this))]}get active(){return!!this.subs}connect(){return this.connected?this:(this.subEvents(),this.io._reconnecting||this.io.open(),this.io._readyState==="open"&&this.onopen(),this)}open(){return this.connect()}send(...e){return e.unshift("message"),this.emit.apply(this,e),this}emit(e,...n){if(js.hasOwnProperty(e))throw new Error('"'+e.toString()+'" is a reserved event name');if(n.unshift(e),this._opts.retries&&!this.flags.fromQueue&&!this.flags.volatile)return this._addToQueue(n),this;const r={type:N.EVENT,data:n};if(r.options={},r.options.compress=this.flags.compress!==!1,typeof n[n.length-1]=="function"){const s=this.ids++,c=n.pop();this._registerAckCallback(s,c),r.id=s}const i=this.io.engine&&this.io.engine.transport&&this.io.engine.transport.writable;return this.flags.volatile&&(!i||!this.connected)||(this.connected?(this.notifyOutgoingListeners(r),this.packet(r)):this.sendBuffer.push(r)),this.flags={},this}_registerAckCallback(e,n){var r;const i=(r=this.flags.timeout)!==null&&r!==void 0?r:this._opts.ackTimeout;if(i===void 0){this.acks[e]=n;return}const o=this.io.setTimeoutFn(()=>{delete this.acks[e];for(let s=0;s<this.sendBuffer.length;s++)this.sendBuffer[s].id===e&&this.sendBuffer.splice(s,1);n.call(this,new Error("operation has timed out"))},i);this.acks[e]=(...s)=>{this.io.clearTimeoutFn(o),n.apply(this,[null,...s])}}emitWithAck(e,...n){const r=this.flags.timeout!==void 0||this._opts.ackTimeout!==void 0;return new Promise((i,o)=>{n.push((s,c)=>r?s?o(s):i(c):i(s)),this.emit(e,...n)})}_addToQueue(e){let n;typeof e[e.length-1]=="function"&&(n=e.pop());const r={id:this._queueSeq++,tryCount:0,pending:!1,args:e,flags:Object.assign({fromQueue:!0},this.flags)};e.push((i,...o)=>r!==this._queue[0]?void 0:(i!==null?r.tryCount>this._opts.retries&&(this._queue.shift(),n&&n(i)):(this._queue.shift(),n&&n(null,...o)),r.pending=!1,this._drainQueue())),this._queue.push(r),this._drainQueue()}_drainQueue(e=!1){if(!this.connected||this._queue.length===0)return;const n=this._queue[0];n.pending&&!e||(n.pending=!0,n.tryCount++,this.flags=n.flags,this.emit.apply(this,n.args))}packet(e){e.nsp=this.nsp,this.io._packet(e)}onopen(){typeof this.auth=="function"?this.auth(e=>{this._sendConnectPacket(e)}):this._sendConnectPacket(this.auth)}_sendConnectPacket(e){this.packet({type:N.CONNECT,data:this._pid?Object.assign({pid:this._pid,offset:this._lastOffset},e):e})}onerror(e){this.connected||this.emitReserved("connect_error",e)}onclose(e,n){this.connected=!1,delete this.id,this.emitReserved("disconnect",e,n)}onpacket(e){if(e.nsp===this.nsp)switch(e.type){case N.CONNECT:e.data&&e.data.sid?this.onconnect(e.data.sid,e.data.pid):this.emitReserved("connect_error",new Error("It seems you are trying to reach a Socket.IO server in v2.x with a v3.x client, but they are not compatible (more information here: https://socket.io/docs/v3/migrating-from-2-x-to-3-0/)"));break;case N.EVENT:case N.BINARY_EVENT:this.onevent(e);break;case N.ACK:case N.BINARY_ACK:this.onack(e);break;case N.DISCONNECT:this.ondisconnect();break;case N.CONNECT_ERROR:this.destroy();const r=new Error(e.data.message);r.data=e.data.data,this.emitReserved("connect_error",r);break}}onevent(e){const n=e.data||[];e.id!=null&&n.push(this.ack(e.id)),this.connected?this.emitEvent(n):this.receiveBuffer.push(Object.freeze(n))}emitEvent(e){if(this._anyListeners&&this._anyListeners.length){const n=this._anyListeners.slice();for(const r of n)r.apply(this,e)}super.emit.apply(this,e),this._pid&&e.length&&typeof e[e.length-1]=="string"&&(this._lastOffset=e[e.length-1])}ack(e){const n=this;let r=!1;return function(...i){r||(r=!0,n.packet({type:N.ACK,id:e,data:i}))}}onack(e){const n=this.acks[e.id];typeof n=="function"&&(n.apply(this,e.data),delete this.acks[e.id])}onconnect(e,n){this.id=e,this.recovered=n&&this._pid===n,this._pid=n,this.connected=!0,this.emitBuffered(),this.emitReserved("connect"),this._drainQueue(!0)}emitBuffered(){this.receiveBuffer.forEach(e=>this.emitEvent(e)),this.receiveBuffer=[],this.sendBuffer.forEach(e=>{this.notifyOutgoingListeners(e),this.packet(e)}),this.sendBuffer=[]}ondisconnect(){this.destroy(),this.onclose("io server disconnect")}destroy(){this.subs&&(this.subs.forEach(e=>e()),this.subs=void 0),this.io._destroy(this)}disconnect(){return this.connected&&this.packet({type:N.DISCONNECT}),this.destroy(),this.connected&&this.onclose("io client disconnect"),this}close(){return this.disconnect()}compress(e){return this.flags.compress=e,this}get volatile(){return this.flags.volatile=!0,this}timeout(e){return this.flags.timeout=e,this}onAny(e){return this._anyListeners=this._anyListeners||[],this._anyListeners.push(e),this}prependAny(e){return this._anyListeners=this._anyListeners||[],this._anyListeners.unshift(e),this}offAny(e){if(!this._anyListeners)return this;if(e){const n=this._anyListeners;for(let r=0;r<n.length;r++)if(e===n[r])return n.splice(r,1),this}else this._anyListeners=[];return this}listenersAny(){return this._anyListeners||[]}onAnyOutgoing(e){return this._anyOutgoingListeners=this._anyOutgoingListeners||[],this._anyOutgoingListeners.push(e),this}prependAnyOutgoing(e){return this._anyOutgoingListeners=this._anyOutgoingListeners||[],this._anyOutgoingListeners.unshift(e),this}offAnyOutgoing(e){if(!this._anyOutgoingListeners)return this;if(e){const n=this._anyOutgoingListeners;for(let r=0;r<n.length;r++)if(e===n[r])return n.splice(r,1),this}else this._anyOutgoingListeners=[];return this}listenersAnyOutgoing(){return this._anyOutgoingListeners||[]}notifyOutgoingListeners(e){if(this._anyOutgoingListeners&&this._anyOutgoingListeners.length){const n=this._anyOutgoingListeners.slice();for(const r of n)r.apply(this,e.data)}}}function We(t){t=t||{},this.ms=t.min||100,this.max=t.max||1e4,this.factor=t.factor||2,this.jitter=t.jitter>0&&t.jitter<=1?t.jitter:0,this.attempts=0}We.prototype.duration=function(){var t=this.ms*Math.pow(this.factor,this.attempts++);if(this.jitter){var e=Math.random(),n=Math.floor(e*this.jitter*t);t=Math.floor(e*10)&1?t+n:t-n}return Math.min(t,this.max)|0};We.prototype.reset=function(){this.attempts=0};We.prototype.setMin=function(t){this.ms=t};We.prototype.setMax=function(t){this.max=t};We.prototype.setJitter=function(t){this.jitter=t};class an extends K{constructor(e,n){var r;super(),this.nsps={},this.subs=[],e&&typeof e=="object"&&(n=e,e=void 0),n=n||{},n.path=n.path||"/socket.io",this.opts=n,Ft(this,n),this.reconnection(n.reconnection!==!1),this.reconnectionAttempts(n.reconnectionAttempts||1/0),this.reconnectionDelay(n.reconnectionDelay||1e3),this.reconnectionDelayMax(n.reconnectionDelayMax||5e3),this.randomizationFactor((r=n.randomizationFactor)!==null&&r!==void 0?r:.5),this.backoff=new We({min:this.reconnectionDelay(),max:this.reconnectionDelayMax(),jitter:this.randomizationFactor()}),this.timeout(n.timeout==null?2e4:n.timeout),this._readyState="closed",this.uri=e;const i=n.parser||Vs;this.encoder=new i.Encoder,this.decoder=new i.Decoder,this._autoConnect=n.autoConnect!==!1,this._autoConnect&&this.open()}reconnection(e){return arguments.length?(this._reconnection=!!e,this):this._reconnection}reconnectionAttempts(e){return e===void 0?this._reconnectionAttempts:(this._reconnectionAttempts=e,this)}reconnectionDelay(e){var n;return e===void 0?this._reconnectionDelay:(this._reconnectionDelay=e,(n=this.backoff)===null||n===void 0||n.setMin(e),this)}randomizationFactor(e){var n;return e===void 0?this._randomizationFactor:(this._randomizationFactor=e,(n=this.backoff)===null||n===void 0||n.setJitter(e),this)}reconnectionDelayMax(e){var n;return e===void 0?this._reconnectionDelayMax:(this._reconnectionDelayMax=e,(n=this.backoff)===null||n===void 0||n.setMax(e),this)}timeout(e){return arguments.length?(this._timeout=e,this):this._timeout}maybeReconnectOnOpen(){!this._reconnecting&&this._reconnection&&this.backoff.attempts===0&&this.reconnect()}open(e){if(~this._readyState.indexOf("open"))return this;this.engine=new Cr(this.uri,this.opts);const n=this.engine,r=this;this._readyState="opening",this.skipReconnect=!1;const i=me(n,"open",function(){r.onopen(),e&&e()}),o=c=>{this.cleanup(),this._readyState="closed",this.emitReserved("error",c),e?e(c):this.maybeReconnectOnOpen()},s=me(n,"error",o);if(this._timeout!==!1){const c=this._timeout,u=this.setTimeoutFn(()=>{i(),o(new Error("timeout")),n.close()},c);this.opts.autoUnref&&u.unref(),this.subs.push(()=>{this.clearTimeoutFn(u)})}return this.subs.push(i),this.subs.push(s),this}connect(e){return this.open(e)}onopen(){this.cleanup(),this._readyState="open",this.emitReserved("open");const e=this.engine;this.subs.push(me(e,"ping",this.onping.bind(this)),me(e,"data",this.ondata.bind(this)),me(e,"error",this.onerror.bind(this)),me(e,"close",this.onclose.bind(this)),me(this.decoder,"decoded",this.ondecoded.bind(this)))}onping(){this.emitReserved("ping")}ondata(e){try{this.decoder.add(e)}catch(n){this.onclose("parse error",n)}}ondecoded(e){gn(()=>{this.emitReserved("packet",e)},this.setTimeoutFn)}onerror(e){this.emitReserved("error",e)}socket(e,n){let r=this.nsps[e];return r?this._autoConnect&&!r.active&&r.connect():(r=new Nr(this,e,n),this.nsps[e]=r),r}_destroy(e){const n=Object.keys(this.nsps);for(const r of n)if(this.nsps[r].active)return;this._close()}_packet(e){const n=this.encoder.encode(e);for(let r=0;r<n.length;r++)this.engine.write(n[r],e.options)}cleanup(){this.subs.forEach(e=>e()),this.subs.length=0,this.decoder.destroy()}_close(){this.skipReconnect=!0,this._reconnecting=!1,this.onclose("forced close"),this.engine&&this.engine.close()}disconnect(){return this._close()}onclose(e,n){this.cleanup(),this.backoff.reset(),this._readyState="closed",this.emitReserved("close",e,n),this._reconnection&&!this.skipReconnect&&this.reconnect()}reconnect(){if(this._reconnecting||this.skipReconnect)return this;const e=this;if(this.backoff.attempts>=this._reconnectionAttempts)this.backoff.reset(),this.emitReserved("reconnect_failed"),this._reconnecting=!1;else{const n=this.backoff.duration();this._reconnecting=!0;const r=this.setTimeoutFn(()=>{e.skipReconnect||(this.emitReserved("reconnect_attempt",e.backoff.attempts),!e.skipReconnect&&e.open(i=>{i?(e._reconnecting=!1,e.reconnect(),this.emitReserved("reconnect_error",i)):e.onreconnect()}))},n);this.opts.autoUnref&&r.unref(),this.subs.push(()=>{this.clearTimeoutFn(r)})}}onreconnect(){const e=this.backoff.attempts;this._reconnecting=!1,this.backoff.reset(),this.emitReserved("reconnect",e)}}const $e={};function St(t,e){typeof t=="object"&&(e=t,t=void 0),e=e||{};const n=Os(t,e.path||"/socket.io"),r=n.source,i=n.id,o=n.path,s=$e[i]&&o in $e[i].nsps,c=e.forceNew||e["force new connection"]||e.multiplex===!1||s;let u;return c?u=new an(r,e):($e[i]||($e[i]=new an(r,e)),u=$e[i]),n.query&&!e.query&&(e.query=n.queryKey),u.socket(n.path,e)}Object.assign(St,{Manager:an,Socket:Nr,io:St,connect:St});var Or={exports:{}},Pr={exports:{}};function Hs(t){return t>64&&t<91?t-65:t>96&&t<123?t-71:t>47&&t<58?t+4:t===43?62:t===47?63:0}function Ks(t,e){for(var n=t.replace(/[^A-Za-z0-9\+\/]/g,""),r=n.length,i=e?Math.ceil((r*3+1>>2)/e)*e:r*3+1>>2,o=new Uint8Array(i),s,c,u=0,a=0,d=0;d<r;d++)if(c=d&3,u|=Hs(n.charCodeAt(d))<<18-6*c,c===3||r-d===1){for(s=0;s<3&&a<i;s++,a++)o[a]=u>>>(16>>>s&24)&255;u=0}return o}var Js={decode:Ks},zs=function(t,e){return new Promise(function(n,r){var i=new XMLHttpRequest;e&&(i.responseType=e),i.open("GET",t),i.onload=function(){i.status===200?n(i.response):r(Error(i.statusText))},i.onerror=function(){r(Error("Network Error"))},i.send()})};(function(t){var e=Js,n=zs;function r(S){return function(_){return typeof _=="string"&&S.test(_)}}function i(S,_){return typeof S=="string"?S+_:typeof S=="function"?S(_):_}function o(S,_,O,P){var j=s(_)?c:u(_)?a:d(_)?f:l(_)?h:p(_)?m:y(_)?I:M(_)?A:w(_)?x:null,z=O||{};return j?j(S,_,z):P?Promise.resolve(P):Promise.reject("Source not valid ("+_+")")}o.fetch=n;function s(S){return S instanceof ArrayBuffer}function c(S,_,O){return new Promise(function(P,j){S.decodeAudioData(_,function(z){P(z)},function(){j("Can't decode audio data ("+_.slice(0,30)+"...)")})})}var u=r(/\.(mp3|wav|ogg)(\?.*)?$/i);function a(S,_,O){var P=i(O.from,_);return o(S,o.fetch(P,"arraybuffer"),O)}function d(S){return S&&typeof S.then=="function"}function f(S,_,O){return _.then(function(P){return o(S,P,O)})}var l=Array.isArray;function h(S,_,O){return Promise.all(_.map(function(P){return o(S,P,O,P)}))}function p(S){return S&&typeof S=="object"}function m(S,_,O){var P={},j=Object.keys(_).map(function(z){if(O.only&&O.only.indexOf(z)===-1)return null;var ae=_[z];return o(S,ae,O,ae).then(function(Q){P[z]=Q})});return Promise.all(j).then(function(){return P})}var y=r(/\.json(\?.*)?$/i);function I(S,_,O){var P=i(O.from,_);return o(S,o.fetch(P,"text").then(JSON.parse),O)}var M=r(/^data:audio/);function A(S,_,O){var P=_.indexOf(",");return o(S,e.decode(_.slice(P+1)).buffer,O)}var w=r(/\.js(\?.*)?$/i);function x(S,_,O){var P=i(O.from,_);return o(S,o.fetch(P,"text").then(G),O)}function G(S){var _=S.indexOf("MIDI.Soundfont.");if(_<0)throw Error("Invalid MIDI.js Soundfont format");_=S.indexOf("=",_)+2;var O=S.lastIndexOf(",");return JSON.parse(S.slice(_,O)+"}")}t.exports&&(t.exports=o),typeof window<"u"&&(window.loadAudio=o)})(Pr);var Ws=Pr.exports,Ar={exports:{}},Gs=Ys;function Ys(t){var e=t.createGain(),n=e._voltage=Qs(t),r=Ve(n),i=Ve(n),o=Ve(n);return e._startAmount=Ve(i),e._endAmount=Ve(o),e._multiplier=Ve(r),e._multiplier.connect(e),e._startAmount.connect(e),e._endAmount.connect(e),e.value=r.gain,e.startValue=i.gain,e.endValue=o.gain,e.startValue.value=0,e.endValue.value=0,Object.defineProperties(e,$s),e}var $s={attack:{value:0,writable:!0},decay:{value:0,writable:!0},sustain:{value:1,writable:!0},release:{value:0,writable:!0},getReleaseDuration:{value:function(){return this.release}},start:{value:function(t){var e=this._multiplier.gain,n=this._startAmount.gain,r=this._endAmount.gain;this._voltage.start(t),this._decayFrom=this._decayFrom=t+this.attack,this._startedAt=t;var i=this.sustain;e.cancelScheduledValues(t),n.cancelScheduledValues(t),r.cancelScheduledValues(t),r.setValueAtTime(0,t),this.attack?(e.setValueAtTime(0,t),e.linearRampToValueAtTime(1,t+this.attack),n.setValueAtTime(1,t),n.linearRampToValueAtTime(0,t+this.attack)):(e.setValueAtTime(1,t),n.setValueAtTime(0,t)),this.decay&&e.setTargetAtTime(i,this._decayFrom,Yn(this.decay))}},stop:{value:function(t,e){e&&(t=t-this.release);var n=t+this.release;if(this.release){var r=this._multiplier.gain,i=this._startAmount.gain,o=this._endAmount.gain;r.cancelScheduledValues(t),i.cancelScheduledValues(t),o.cancelScheduledValues(t);var s=Yn(this.release);if(this.attack&&t<this._decayFrom){var c=Zs(0,1,this._startedAt,this._decayFrom,t);r.linearRampToValueAtTime(c,t),i.linearRampToValueAtTime(1-c,t),i.setTargetAtTime(0,t,s)}o.setTargetAtTime(1,t,s),r.setTargetAtTime(0,t,s)}return this._voltage.stop(n),n}},onended:{get:function(){return this._voltage.onended},set:function(t){this._voltage.onended=t}}},Xs=new Float32Array([1,1]);function Qs(t){var e=t.createBufferSource(),n=t.createBuffer(1,2,t.sampleRate);return n.getChannelData(0).set(Xs),e.buffer=n,e.loop=!0,e}function Ve(t){var e=t.context.createGain();return t.connect(e),e}function Yn(t){return Math.log(t+1)/Math.log(100)}function Zs(t,e,n,r,i){var o=e-t,s=r-n,c=i-n,u=c/s,a=t+u*o;return a<=t&&(a=t),a>=e&&(a=e),a}var eo=Gs,to={},no={gain:1,attack:.01,decay:.1,sustain:.9,release:.3,loop:!1,cents:0,loopStart:0,loopEnd:0};function ro(t,e,n){var r=!1,i=0,o={},s=t.createGain();s.gain.value=1;var c=Object.assign({},no,n),u={context:t,out:s,opts:c};return e instanceof AudioBuffer?u.buffer=e:u.buffers=e,u.start=function(f,l,h){if(u.buffer&&f!==null)return u.start(null,f,l);var p=f?u.buffers[f]:u.buffer;if(p){if(!r){console.warn("SamplePlayer not connected to any node.");return}}else{console.warn("Buffer "+f+" not found.");return}var m=h||to;l=Math.max(t.currentTime,l||0),u.emit("start",l,f,m);var y=d(f,p,m);return y.id=a(f,y),y.env.start(l),y.source.start(l),u.emit("started",l,y.id,y),m.duration&&y.stop(l+m.duration),y},u.play=function(f,l,h){return u.start(f,l,h)},u.stop=function(f,l){var h;return l=l||Object.keys(o),l.map(function(p){return h=o[p],h?(h.stop(f),h.id):null})},u.connect=function(f){return r=!0,s.connect(f),u},u.emit=function(f,l,h,p){u.onevent&&u.onevent(f,l,h,p);var m=u["on"+f];m&&m(l,h,p)},u;function a(f,l){return l.id=i++,o[l.id]=l,l.source.onended=function(){var h=t.currentTime;l.source.disconnect(),l.env.disconnect(),l.disconnect(),u.emit("ended",h,l.id,l)},l.id}function d(f,l,h){var p=t.createGain();return p.gain.value=0,p.connect(s),p.env=so(t,h,c),p.env.connect(p.gain),p.source=t.createBufferSource(),p.source.buffer=l,p.source.connect(p),p.source.loop=h.loop||c.loop,p.source.playbackRate.value=oo(h.cents||c.cents),p.source.loopStart=h.loopStart||c.loopStart,p.source.loopEnd=h.loopEnd||c.loopEnd,p.stop=function(m){var y=m||t.currentTime;u.emit("stop",y,f);var I=p.env.stop(y);p.source.stop(I)},p}}function $n(t){return typeof t=="number"}var io=["attack","decay","sustain","release"];function so(t,e,n){var r=eo(t),i=e.adsr||n.adsr;return io.forEach(function(o,s){i?r[o]=i[s]:r[o]=e[o]||n[o]}),r.value.value=$n(e.gain)?e.gain:$n(n.gain)?n.gain:1,r}function oo(t){return t?Math.pow(2,t/1200):1}var ao=ro,co=function(t){return t.on=function(e,n){if(arguments.length===1&&typeof e=="function")return t.on("event",e);var r="on"+e,i=t[r];return t[r]=i?uo(i,n):n,t},t};function uo(t,e){return function(n,r,i,o){t(n,r,i,o),e(n,r,i,o)}}var Br=/^([a-gA-G])(#{1,}|b{1,}|x{1,}|)(-?\d*)\s*(.*)\s*$/;function lo(){return Br}var ho=[0,2,4,5,7,9,11];function Ur(t,e,n){if(typeof t!="string")return null;var r=Br.exec(t);if(!r||!e&&r[4])return null;var i={letter:r[1].toUpperCase(),acc:r[2].replace(/x/g,"##")};return i.pc=i.letter+i.acc,i.step=(i.letter.charCodeAt(0)+3)%7,i.alt=i.acc[0]==="b"?-i.acc.length:i.acc.length,i.chroma=ho[i.step]+i.alt,r[3]&&(i.oct=+r[3],i.midi=i.chroma+12*(i.oct+1),i.freq=Mr(i.midi,n)),e&&(i.tonicOf=r[4]),i}function Mr(t,e){return Math.pow(2,(t-69)/12)*(e||440)}var Fr={parse:Ur,regex:lo,midiToFreq:Mr},fo=["letter","acc","pc","step","alt","chroma","oct","midi","freq"];fo.forEach(function(t){Fr[t]=function(e){var n=Ur(e);return n&&typeof n[t]<"u"?n[t]:null}});var po=Fr,mo=po,yo=function(t){return t!==null&&t!==[]&&t>=0&&t<129},go=function(t){return yo(t)?+t:mo.midi(t)},bo=function(t){if(t.buffers){var e=t.opts.map,n=typeof e=="function"?e:go,r=function(o){return o?n(o)||o:null};t.buffers=vo(t.buffers,r);var i=t.start;t.start=function(o,s,c){var u=r(o),a=u%1;return a&&(u=Math.floor(u),c=Object.assign(c||{},{cents:Math.floor(a*100)})),i(u,s,c)}}return t};function vo(t,e){return Object.keys(t).reduce(function(n,r){return n[e(r)]=t[r],n},{})}var _o=Array.isArray,ko=function(t){return t&&typeof t=="object"},wo={},To=function(t){return t.schedule=function(e,n){var r=t.context.currentTime,i=e<r?r:e;t.emit("schedule",i,n);var o,s,c,u;return n.map(function(a){if(a)_o(a)?(o=a[0],s=a[1]):(o=a.time,s=a);else return null;return ko(s)?(c=s.name||s.key||s.note||s.midi||null,u=s):(c=s,u=wo),t.start(c,i+(o||0),u)})},t};function _t(t){throw new Error('Could not dynamically require "'+t+'". Please configure the dynamicRequireTargets or/and ignoreDynamicRequires option of @rollup/plugin-commonjs appropriately for this require call to work.')}var Rr={exports:{}};(function(t,e){(function(n){t.exports=n()})(function(){return function n(r,i,o){function s(a,d){if(!i[a]){if(!r[a]){var f=typeof _t=="function"&&_t;if(!d&&f)return f(a,!0);if(c)return c(a,!0);var l=new Error("Cannot find module '"+a+"'");throw l.code="MODULE_NOT_FOUND",l}var h=i[a]={exports:{}};r[a][0].call(h.exports,function(p){var m=r[a][1][p];return s(m||p)},h,h.exports,n,r,i,o)}return i[a].exports}for(var c=typeof _t=="function"&&_t,u=0;u<o.length;u++)s(o[u]);return s}({1:[function(n,r,i){Object.defineProperty(i,"__esModule",{value:!0}),i.default=function(o){function s(c){if(this._event=c,this._data=c.data,this.receivedTime=c.receivedTime,this._data&&this._data.length<2){console.warn("Illegal MIDI message of length",this._data.length);return}switch(this._messageCode=c.data[0]&240,this.channel=c.data[0]&15,this._messageCode){case 128:this.messageType="noteoff",this.key=c.data[1]&127,this.velocity=c.data[2]&127;break;case 144:this.messageType="noteon",this.key=c.data[1]&127,this.velocity=c.data[2]&127;break;case 160:this.messageType="keypressure",this.key=c.data[1]&127,this.pressure=c.data[2]&127;break;case 176:this.messageType="controlchange",this.controllerNumber=c.data[1]&127,this.controllerValue=c.data[2]&127,this.controllerNumber===120&&this.controllerValue===0?this.channelModeMessage="allsoundoff":this.controllerNumber===121?this.channelModeMessage="resetallcontrollers":this.controllerNumber===122?this.controllerValue===0?this.channelModeMessage="localcontroloff":this.channelModeMessage="localcontrolon":this.controllerNumber===123&&this.controllerValue===0?this.channelModeMessage="allnotesoff":this.controllerNumber===124&&this.controllerValue===0?this.channelModeMessage="omnimodeoff":this.controllerNumber===125&&this.controllerValue===0?this.channelModeMessage="omnimodeon":this.controllerNumber===126?this.channelModeMessage="monomodeon":this.controllerNumber===127&&(this.channelModeMessage="polymodeon");break;case 192:this.messageType="programchange",this.program=c.data[1];break;case 208:this.messageType="channelpressure",this.pressure=c.data[1]&127;break;case 224:this.messageType="pitchbendchange";var u=c.data[2]&127,a=c.data[1]&127;this.pitchBend=(u<<8)+a;break}}return new s(o)},r.exports=i.default},{}]},{},[1])(1)})})(Rr);var So=Rr.exports,Io=So,xo=function(t){return t.listenToMidi=function(e,n){var r={},i=n||{},o=i.gain||function(s){return s/127};return e.onmidimessage=function(s){var c=s.messageType?s:Io(s);if(c.messageType==="noteon"&&c.velocity===0&&(c.messageType="noteoff"),!(i.channel&&c.channel!==i.channel))switch(c.messageType){case"noteon":r[c.key]=t.play(c.key,0,{gain:o(c.velocity)});break;case"noteoff":r[c.key]&&(r[c.key].stop(),delete r[c.key]);break}},t},t};(function(t){var e=ao,n=co,r=bo,i=To,o=xo;function s(c,u,a){return o(i(r(n(e(c,u,a)))))}t.exports&&(t.exports=s),typeof window<"u"&&(window.SamplePlayer=s)})(Ar);var Co=Ar.exports;function Xn(t,e){return Array(e+1).join(t)}function _n(t){return typeof t=="number"}function Eo(t){return typeof t=="string"}function No(t){return typeof t<"u"}function Dr(t,e){return Math.pow(2,(t-69)/12)*(e||440)}var Lr=/^([a-gA-G])(#{1,}|b{1,}|x{1,}|)(-?\d*)\s*(.*)\s*$/;function Oo(){return Lr}var Po=[0,2,4,5,7,9,11];function Ie(t,e,n){if(typeof t!="string")return null;var r=Lr.exec(t);if(!r||!e&&r[4])return null;var i={letter:r[1].toUpperCase(),acc:r[2].replace(/x/g,"##")};i.pc=i.letter+i.acc,i.step=(i.letter.charCodeAt(0)+3)%7,i.alt=i.acc[0]==="b"?-i.acc.length:i.acc.length;var o=Po[i.step]+i.alt;return i.chroma=o<0?12+o:o%12,r[3]&&(i.oct=+r[3],i.midi=o+12*(i.oct+1),i.freq=Dr(i.midi,n)),e&&(i.tonicOf=r[4]),i}var Ao="CDEFGAB";function Bo(t){return _n(t)?t<0?Xn("b",-t):Xn("#",t):""}function Uo(t){return _n(t)?""+t:""}function qr(t,e,n){return t===null||typeof t>"u"?null:t.step?qr(t.step,t.alt,t.oct):t<0||t>6?null:Ao.charAt(t)+Bo(e)+Uo(n)}function Vr(t){if((_n(t)||Eo(t))&&t>=0&&t<128)return+t;var e=Ie(t);return e&&No(e.midi)?e.midi:null}function Mo(t,e){var n=Vr(t);return n===null?null:Dr(n,e)}function Fo(t){return(Ie(t)||{}).letter}function Ro(t){return(Ie(t)||{}).acc}function Do(t){return(Ie(t)||{}).pc}function Lo(t){return(Ie(t)||{}).step}function qo(t){return(Ie(t)||{}).alt}function Vo(t){return(Ie(t)||{}).chroma}function jo(t){return(Ie(t)||{}).oct}const Ho=Object.freeze(Object.defineProperty({__proto__:null,acc:Ro,alt:qo,build:qr,chroma:Vo,freq:Mo,letter:Fo,midi:Vr,oct:jo,parse:Ie,pc:Do,regex:Oo,step:Lo},Symbol.toStringTag,{value:"Module"})),Ko=hr(Ho);var zt,Qn;function Jo(){if(Qn)return zt;Qn=1;var t=Ko;function e(i,o){if(console.warn("new Soundfont() is deprected"),console.log("Please use Soundfont.instrument() instead of new Soundfont().instrument()"),!(this instanceof e))return new e(i);this.nameToUrl=o||e.nameToUrl,this.ctx=i,this.instruments={},this.promises=[]}e.prototype.onready=function(i){console.warn("deprecated API"),console.log("Please use Promise.all(Soundfont.instrument(), Soundfont.instrument()).then() instead of new Soundfont().onready()"),Promise.all(this.promises).then(i)},e.prototype.instrument=function(i,o){console.warn("new Soundfont().instrument() is deprecated."),console.log("Please use Soundfont.instrument() instead.");var s=this.ctx;if(i=i||"default",i in this.instruments)return this.instruments[i];var c={name:i,play:r(s,o)};if(this.instruments[i]=c,i!=="default"){var u=e.instrument(s,i,o).then(function(a){return c.play=a.play,c});this.promises.push(u),c.onready=function(a){console.warn("onready is deprecated. Use Soundfont.instrument().then()"),u.then(a)}}else c.onready=function(a){console.warn("onready is deprecated. Use Soundfont.instrument().then()"),a()};return c};function n(i,o,s){return console.warn("Soundfont.loadBuffers is deprecate."),console.log("Use Soundfont.instrument(..) and get buffers properties from the result."),e.instrument(i,o,s).then(function(c){return c.buffers})}e.loadBuffers=n;function r(i,o){return o=o||{},function(s,c,u,a){console.warn("The oscillator player is deprecated."),console.log("Starting with version 0.9.0 you will have to wait until the soundfont is loaded to play sounds.");var d=s>0&&s<129?+s:t.midi(s),f=d?t.midiToFreq(d,440):null;if(f){u=u||.2,a=a||{};var l=a.destination||o.destination||i.destination,h=a.vcoType||o.vcoType||"sine",p=a.gain||o.gain||.4,m=i.createOscillator();m.type=h,m.frequency.value=f;var y=i.createGain();return y.gain.value=p,m.connect(y),y.connect(l),m.start(c),u>0&&m.stop(c+u),m}}}return e.noteToMidi=t.midi,zt=e,zt}(function(t){var e=Ws,n=Co;function r(c,u,a){if(arguments.length===1)return function(p,m){return r(c,p,m)};var d=a||{},f=d.isSoundfontURL||i,l=d.nameToUrl||o,h=f(u)?u:l(u,d.soundfont,d.format);return e(c,h,{only:d.only||d.notes}).then(function(p){var m=n(c,p,d).connect(d.destination?d.destination:c.destination);return m.url=h,m.name=u,m})}function i(c){return/\.js(\?.*)?$/i.test(c)}function o(c,u,a){return a=a==="ogg"?a:"mp3",u=u==="FluidR3_GM"?u:"MusyngKite","https://gleitz.github.io/midi-js-soundfonts/"+u+"/"+c+"-"+a+".js"}var s=Jo();s.instrument=r,s.nameToUrl=o,t.exports&&(t.exports=s),typeof window<"u"&&(window.Soundfont=s)})(Or);var zo=Or.exports;const jr=window.AudioContext||window.webkitAudioContext;jr||alert("Your browser does not seem to support the Web Audio API!");const Wo=new jr,Wt={};function Hr(t){return Wt[t]||(Wt[t]=zo.instrument(Wo,t)),Wt[t]}class Go{constructor(){B(this,"connecting",re(!1));B(this,"connectError",re(""));B(this,"instrumentName",re("acoustic_grand_piano"));B(this,"connectedColorHues",re(new Map));B(this,"connected",re(!1));B(this,"threadMap",new Map);B(this,"originalThread",{audioNodeMap:new Map,colorHue:"220"});B(this,"socket",null);B(this,"onPlayNote");B(this,"onStopNote");this.threadMap.set("0",this.originalThread),console.log(this.threadMap),this.instrumentName.subscribe(e=>{var n;this.socket&&this.socket.emit("instrument_change",{instrumentName:e}),this.loadInstrument(e,((n=this.socket)==null?void 0:n.id)??"0")})}async loadInstrument(e,n){let r=await Hr(e),i=this.threadMap.get(n);i&&(i.instrument=r)}addThread({socketID:e,colorHue:n,instrumentName:r}){this.threadMap.set(e,{audioNodeMap:e===this.socket.id?this.originalThread.audioNodeMap:new Map,colorHue:n}),this.connectedColorHues.set(ve(this.connectedColorHues).set(e,n)),r&&this.loadInstrument(r,e)}clean(){this.socket.removeAllListeners(),this.socket=null,this.connecting.set(!1),this.connected.set(!1),this.threadMap.clear(),this.threadMap.set("0",this.originalThread)}connect(e){if(ve(this.connecting)||ve(this.connected))return;if(e.length>100)return this.connectError.set("Room name to long!");const n="https://piano-backend.onrender.com";this.connectError.set(""),this.connecting.set(!0),this.socket=St(n,{query:{roomName:e,instrumentName:ve(this.instrumentName)},path:{}.VITE_BACKEND_PATH,reconnection:!1,timeout:1e3*60}),this.socket.on("connect_error",r=>{this.clean(),this.connectError.set("Failed to connect to server: "+r.message)}),this.socket.on("error_message",r=>{this.connectError.set(r)}),this.socket.on("connect_timeout",()=>{this.clean(),this.connectError.set("Timed out while connecting to server!")}),this.socket.on("connect",()=>{this.connecting.set(!1),this.connected.set(!0),this.threadMap.delete("0"),ve(this.connectedColorHues).clear(),history.replaceState({},void 0,`?room=${e}`),document.title=`Room ${e} - Play Piano!`}),this.socket.on("disconnect",()=>{this.clean(),history.replaceState({},void 0,location.pathname),document.title="Play Piano!"}),this.socket.on("play_note",r=>{this.onPlayNote(r,this.threadMap.get(r.socketID))}),this.socket.on("stop_note",r=>{this.onStopNote(r,this.threadMap.get(r.socketID))}),this.socket.on("instrument_change",r=>{this.loadInstrument(r.instrumentName,r.socketID)}),this.socket.on("client_connect",r=>{this.addThread(r)}),this.socket.on("client_list_recieve",r=>{for(let i of r)this.addThread(i)}),this.socket.on("client_disconnect",r=>{const i=ve(this.connectedColorHues);i.delete(r),this.connectedColorHues.set(i),this.threadMap.delete(r)})}playNote(e,n){var o;const r={note:e,volume:n};this.socket&&this.socket.emit("play_note",r);let i=this.threadMap.get(((o=this.socket)==null?void 0:o.id)??"0");this.onPlayNote(r,i)}stopNote(e,n){var o;const r={note:e,sustain:n};this.socket&&this.socket.emit("stop_note",r);let i=this.threadMap.get(((o=this.socket)==null?void 0:o.id)??"0");this.onStopNote(r,i)}}function Zn(t,e,n){const r=t.slice();return r[56]=e[n][0],r[57]=e[n][1],r}function er(t,e,n){const r=t.slice();return r[60]=e[n],r}function tr(t){let e,n=t[60]+"",r;return{c(){e=T("option"),r=ue(n),e.__value=t[60],H(e,e.__value)},m(i,o){L(i,e,o),b(e,r)},p:q,d(i){i&&R(e)}}}function Yo(t){return{c:q,m:q,d:q}}function $o(t){return{c:q,m:q,d:q}}function Xo(t){let e;return{c(){e=ue("loading...")},m(n,r){L(n,e,r)},d(n){n&&R(e)}}}function Qo(t){let e,n,r;return{c(){e=T("button"),e.textContent="Play"},m(i,o){L(i,e,o),n||(r=E(e,"click",t[44]),n=!0)},p:q,d(i){i&&R(e),n=!1,r()}}}function Zo(t){let e,n,r;return{c(){e=T("button"),e.textContent="Pause"},m(i,o){L(i,e,o),n||(r=E(e,"click",t[43]),n=!0)},p:q,d(i){i&&R(e),n=!1,r()}}}function ea(t){let e,n,r,i;return{c(){e=T("button"),n=ue("Join"),e.disabled=t[14]},m(o,s){L(o,e,s),b(e,n),r||(i=E(e,"click",t[54]),r=!0)},p(o,s){s[0]&16384&&(e.disabled=o[14])},d(o){o&&R(e),r=!1,i()}}}function ta(t){let e,n,r,i,o,s,c,u,a,d,f=ze(Array.from(t[13].entries())),l=[];for(let h=0;h<f.length;h+=1)l[h]=rr(Zn(t,f,h));return{c(){e=T("button"),e.textContent="Leave",n=U(),r=T("span"),r.textContent="Connected!",i=T("br"),o=U(),s=T("span"),s.textContent="People:",c=U();for(let h=0;h<l.length;h+=1)l[h].c();u=ur()},m(h,p){L(h,e,p),L(h,n,p),L(h,r,p),L(h,i,p),L(h,o,p),L(h,s,p),L(h,c,p);for(let m=0;m<l.length;m+=1)l[m]&&l[m].m(h,p);L(h,u,p),a||(d=E(e,"click",t[53]),a=!0)},p(h,p){if(p[0]&8193){f=ze(Array.from(h[13].entries()));let m;for(m=0;m<f.length;m+=1){const y=Zn(h,f,m);l[m]?l[m].p(y,p):(l[m]=rr(y),l[m].c(),l[m].m(u.parentNode,u))}for(;m<l.length;m+=1)l[m].d(1);l.length=f.length}},d(h){h&&(R(e),R(n),R(r),R(i),R(o),R(s),R(c),R(u)),un(l,h),a=!1,d()}}}function nr(t){let e;return{c(){e=T("span"),e.textContent="(you)",It(e,"margin-right","0.5rem")},m(n,r){L(n,e,r)},d(n){n&&R(e)}}}function rr(t){let e,n,r,i,o=t[56]===t[0].socket.id&&nr();return{c(){e=T("div"),r=U(),o&&o.c(),i=ur(),v(e,"class","icon svelte-kmoprw"),v(e,"style",n=`--color-hue: ${t[57]}`)},m(s,c){L(s,e,c),L(s,r,c),o&&o.m(s,c),L(s,i,c)},p(s,c){c[0]&8192&&n!==(n=`--color-hue: ${s[57]}`)&&v(e,"style",n),s[56]===s[0].socket.id?o||(o=nr(),o.c(),o.m(i.parentNode,i)):o&&(o.d(1),o=null)},d(s){s&&(R(e),R(r),R(i)),o&&o.d(s)}}}function na(t){let e;return{c(){e=T("span"),e.textContent="Connecting..."},m(n,r){L(n,e,r)},p:q,d(n){n&&R(e)}}}function ra(t){let e,n;return{c(){e=T("span"),n=ue(t[15]),v(e,"class","error svelte-kmoprw")},m(r,i){L(r,e,i),b(e,n)},p(r,i){i[0]&32768&&Gt(n,r[15])},d(r){r&&R(e)}}}function ia(t){let e,n,r,i,o,s,c,u,a,d,f,l,h,p,m,y,I,M,A,w,x,G,S,_,O,P,j,z,ae,Q,ie,se,g,C,F,tt,he,xe,Be,nt,Ce,rt,we,Ge,Ue,it,W,st,oe,ot,fe,at,ct,ut,Y,lt,Me=t[9].toFixed(1)+"",Ye,k,ce=t[11].toFixed(1)+"",Rt,kn,wn,de,ht,Tn,ye,Sn,Dt,Lt,In,Fe=ze(Mn),Z=[];for(let V=0;V<Fe.length;V+=1)Z[V]=tr(er(t,Fe,V));let pe={ctx:t,current:null,token:null,hasCatch:!1,pending:Xo,then:$o,catch:Yo};Bn(P=t[3],pe);function xn(V,D){return V[8]?Zo:Qo}let ft=xn(t),ge=ft(t);function Cn(V,D){return V[12]?ta:ea}let dt=Cn(t),be=dt(t);function En(V,D){if(V[15])return ra;if(V[14])return na}let Re=En(t),ne=Re&&Re(t);return{c(){e=T("div"),n=T("div"),r=T("div"),i=T("div"),o=T("span"),o.textContent="Sustain:",s=U(),c=T("input"),u=U(),a=T("div"),d=T("span"),d.textContent="Octave Shift:",f=U(),l=T("input"),h=U(),p=T("div"),m=T("span"),m.textContent="Volume:",y=U(),I=T("input"),M=U(),A=T("input"),w=U(),x=T("div"),G=T("span"),G.textContent="Instrument:",S=U(),_=T("select");for(let V=0;V<Z.length;V+=1)Z[V].c();O=U(),pe.block.c(),j=U(),z=T("span"),z.textContent="Size:",ae=U(),Q=T("select"),ie=T("option"),ie.textContent="Full size (88 keys)",se=T("option"),se.textContent="Half size (61 keys)",g=T("option"),g.textContent="Quater Size (37 keys)",C=T("option"),C.textContent="2 Octaves (24 keys)",F=T("option"),F.textContent="1 Octave (12 keys)",tt=U(),he=T("div"),xe=T("div"),Be=T("p"),Be.textContent="Play a midi:",nt=U(),Ce=T("input"),rt=U(),we=T("div"),ge.c(),Ge=U(),Ue=T("button"),Ue.textContent="Restart",it=U(),W=T("div"),st=ue("Speed:"),oe=T("input"),ot=U(),fe=T("input"),at=ue("times"),ct=T("br"),ut=U(),Y=T("input"),lt=U(),Ye=ue(Me),k=ue("/"),Rt=ue(ce),kn=ue(" seconds"),wn=U(),de=T("div"),ht=T("p"),ht.textContent="Join a room:",Tn=U(),ye=T("input"),Sn=U(),be.c(),Dt=U(),ne&&ne.c(),v(c,"type","checkbox"),v(c,"class","svelte-kmoprw"),v(i,"title","Shortcut: space"),v(i,"class","svelte-kmoprw"),v(l,"type","number"),v(l,"min","-3"),v(l,"max","3"),v(l,"class","svelte-kmoprw"),v(a,"title","Shortcut: left ctrl +, left alt or right ctrl -"),v(a,"class","svelte-kmoprw"),v(I,"type","range"),v(I,"min","0"),v(I,"max","10"),v(I,"step","0.1"),v(I,"class","svelte-kmoprw"),v(A,"type","number"),v(A,"class","svelte-kmoprw"),v(p,"class","svelte-kmoprw"),t[1]===void 0&&xt(()=>t[40].call(_)),v(x,"class","svelte-kmoprw"),v(ie,"data-range","A0,C8"),ie.__value="Full size (88 keys)",H(ie,ie.__value),v(se,"data-range","C2,C7"),se.selected=!0,se.__value="Half size (61 keys)",H(se,se.__value),v(g,"data-range","C3,C6"),g.__value="Quater Size (37 keys)",H(g,g.__value),v(C,"data-range","C4,B5"),C.__value="2 Octaves (24 keys)",H(C,C.__value),v(F,"data-range","C4,B4"),F.__value="1 Octave (12 keys)",H(F,F.__value),v(r,"class","svelte-kmoprw"),v(Be,"class","svelte-kmoprw"),v(Ce,"type","file"),v(Ce,"accept",".midi,.mid"),v(Ce,"class","svelte-kmoprw"),v(xe,"class","svelte-kmoprw"),v(we,"class","svelte-kmoprw"),v(oe,"type","range"),v(oe,"min","0.01"),v(oe,"max","4"),v(oe,"step","0.01"),v(oe,"class","svelte-kmoprw"),v(fe,"type","number"),v(fe,"min","0.01"),v(fe,"class","svelte-kmoprw"),v(Y,"type","range"),v(Y,"min","0"),v(Y,"max",t[11]),v(Y,"step","0.1"),It(Y,"width","18rem"),v(Y,"class","svelte-kmoprw"),v(W,"class","svelte-kmoprw"),v(he,"class","svelte-kmoprw"),v(n,"class","row svelte-kmoprw"),v(ht,"class","svelte-kmoprw"),v(ye,"type","text"),v(ye,"placeholder","Room name"),v(ye,"class","svelte-kmoprw"),v(e,"class","control-panel svelte-kmoprw")},m(V,D){L(V,e,D),b(e,n),b(n,r),b(r,i),b(i,o),b(i,s),b(i,c),c.checked=t[4],b(r,u),b(r,a),b(a,d),b(a,f),b(a,l),H(l,t[5]),b(r,h),b(r,p),b(p,m),b(p,y),b(p,I),H(I,t[6]),b(p,M),b(p,A),H(A,t[6]),b(r,w),b(r,x),b(x,G),b(x,S),b(x,_);for(let $=0;$<Z.length;$+=1)Z[$]&&Z[$].m(_,null);Pn(_,t[1],!0),b(x,O),pe.block.m(x,pe.anchor=null),pe.mount=()=>x,pe.anchor=null,b(r,j),b(r,z),b(r,ae),b(r,Q),b(Q,ie),b(Q,se),b(Q,g),b(Q,C),b(Q,F),b(n,tt),b(n,he),b(he,xe),b(xe,Be),b(xe,nt),b(xe,Ce),b(he,rt),b(he,we),ge.m(we,null),b(we,Ge),b(we,Ue),b(he,it),b(he,W),b(W,st),b(W,oe),H(oe,t[10]),b(W,ot),b(W,fe),H(fe,t[10]),b(W,at),b(W,ct),b(W,ut),b(W,Y),H(Y,t[9]),b(W,lt),b(W,Ye),b(W,k),b(W,Rt),b(W,kn),b(e,wn),b(e,de),b(de,ht),b(de,Tn),b(de,ye),H(ye,t[2]),b(de,Sn),be.m(de,null),b(de,Dt),ne&&ne.m(de,null),Lt||(In=[E(window,"keydown",t[32]),E(window,"keyup",t[33]),E(window,"load",t[30]),E(c,"change",t[36]),E(l,"input",t[37]),E(I,"change",t[38]),E(I,"input",t[38]),E(A,"input",t[39]),E(_,"change",t[40]),E(Q,"change",t[41]),Gr(t[31].call(null,Q)),E(Ce,"change",t[42]),E(Ue,"click",t[45]),E(oe,"change",t[46]),E(oe,"input",t[46]),E(fe,"input",t[47]),E(Y,"change",t[48]),E(Y,"input",t[48]),E(Y,"mousedown",t[49]),E(Y,"mouseup",t[50]),E(ye,"input",t[51]),E(ye,"keydown",t[52])],Lt=!0)},p(V,D){if(t=V,D[0]&16&&(c.checked=t[4]),D[0]&32&&Te(l.value)!==t[5]&&H(l,t[5]),D[0]&64&&H(I,t[6]),D[0]&64&&Te(A.value)!==t[6]&&H(A,t[6]),D&0){Fe=ze(Mn);let $;for($=0;$<Fe.length;$+=1){const Nn=er(t,Fe,$);Z[$]?Z[$].p(Nn,D):(Z[$]=tr(Nn),Z[$].c(),Z[$].m(_,null))}for(;$<Z.length;$+=1)Z[$].d(1);Z.length=Fe.length}D[0]&2&&Pn(_,t[1]),pe.ctx=t,D[0]&8&&P!==(P=t[3])&&Bn(P,pe),ft===(ft=xn(t))&&ge?ge.p(t,D):(ge.d(1),ge=ft(t),ge&&(ge.c(),ge.m(we,Ge))),D[0]&1024&&H(oe,t[10]),D[0]&1024&&Te(fe.value)!==t[10]&&H(fe,t[10]),D[0]&2048&&v(Y,"max",t[11]),D[0]&512&&H(Y,t[9]),D[0]&512&&Me!==(Me=t[9].toFixed(1)+"")&&Gt(Ye,Me),D[0]&2048&&ce!==(ce=t[11].toFixed(1)+"")&&Gt(Rt,ce),D[0]&4&&ye.value!==t[2]&&H(ye,t[2]),dt===(dt=Cn(t))&&be?be.p(t,D):(be.d(1),be=dt(t),be&&(be.c(),be.m(de,Dt))),Re===(Re=En(t))&&ne?ne.p(t,D):(ne&&ne.d(1),ne=Re&&Re(t),ne&&(ne.c(),ne.m(de,null)))},i:q,o:q,d(V){V&&R(e),un(Z,V),pe.block.d(),pe.token=null,pe=null,ge.d(),be.d(),ne&&ne.d(),Lt=!1,Oe(In)}}}class sa{constructor(){B(this,"octaveShift",re(0));B(this,"sustain",re(!1));B(this,"volume",re(5));B(this,"noteRange",re(["C0","C0"]))}}function oa(t,e,n){let r,i,o,s,c,u,a,d,f,l,h,p,m,y,I,M="",{controlPanelData:A}=e,{midiPlayer:w}=e,{socketPlayer:x}=e,{noteRange:G,sustain:S,octaveShift:_,volume:O}=A;X(t,G,k=>n(55,s=k)),X(t,S,k=>n(4,i=k)),X(t,_,k=>n(5,o=k)),X(t,O,k=>n(6,u=k));let{midiFile:P,midiIsPlaying:j,midiCurrentTime:z,midiSpeed:ae,midiTotalTime:Q}=w;X(t,P,k=>n(7,a=k)),X(t,j,k=>n(8,d=k)),X(t,z,k=>n(9,f=k)),X(t,ae,k=>n(10,l=k)),X(t,Q,k=>n(11,h=k));let{instrumentName:ie,connected:se,connecting:g,connectError:C,connectedColorHues:F}=x;X(t,ie,k=>n(1,c=k)),X(t,se,k=>n(12,p=k)),X(t,g,k=>n(14,y=k)),X(t,C,k=>n(15,I=k)),X(t,F,k=>n(13,m=k));function tt(){const ce=new URLSearchParams(location.search).get("room");ce!=null&&(n(2,M=ce),x.connect(M))}function he(k){const ce=k.children[k.selectedIndex];ee(G,s=ce.dataset.range.split(","),s)}function xe(k){k.code==="Space"&&ee(S,i=!0,i),k.code==="ControlLeft"?ee(_,o-=1,o):(k.code==="AltLeft"||k.code=="ControlRight")&&ee(_,o+=1,o),o<-3?ee(_,o=3,o):o>3&&ee(_,o=-3,o)}function Be(k){k.code==="Space"&&ee(S,i=!1,i)}function nt(){i=this.checked,S.set(i)}function Ce(){o=Te(this.value),_.set(o)}function rt(){u=Te(this.value),O.set(u)}function we(){u=Te(this.value),O.set(u)}function Ge(){c=Xr(this),ie.set(c)}const Ue=k=>he(k.currentTarget),it=k=>{var ce;return ee(P,a=(ce=k.currentTarget.files)==null?void 0:ce[0],a)},W=()=>ee(j,d=!1,d),st=()=>ee(j,d=!0,d),oe=()=>{ee(j,d=!1,d),ee(z,f=0,f),setTimeout(()=>ee(j,d=!0,d),100)};function ot(){l=Te(this.value),ae.set(l)}function fe(){l=Te(this.value),ae.set(l)}function at(){f=Te(this.value),z.set(f)}const ct=()=>ee(j,d=!1,d),ut=()=>ee(j,d=!0,d);function Y(){M=this.value,n(2,M)}const lt=k=>{k.code==="Enter"&&x.connect(M)},Me=()=>x.socket.disconnect(),Ye=()=>x.connect(M);return t.$$set=k=>{"controlPanelData"in k&&n(34,A=k.controlPanelData),"midiPlayer"in k&&n(35,w=k.midiPlayer),"socketPlayer"in k&&n(0,x=k.socketPlayer)},t.$$.update=()=>{t.$$.dirty[0]&2&&n(3,r=Hr(c))},[x,c,M,r,i,o,u,a,d,f,l,h,p,m,y,I,G,S,_,O,P,j,z,ae,Q,ie,se,g,C,F,tt,he,xe,Be,A,w,nt,Ce,rt,we,Ge,Ue,it,W,st,oe,ot,fe,at,ct,ut,Y,lt,Me,Ye]}class aa extends fn{constructor(e){super(),hn(this,e,oa,ia,Nt,{controlPanelData:34,midiPlayer:35,socketPlayer:0},null,[-1,-1,-1])}}function ir(t,e,n){const r=t.slice();return r[30]=e[n][0],r[31]=e[n][1].isWhite,r[32]=e[n][1].pressedColor,r[33]=e[n][1].isGhost,r}function sr(t){let e,n,r,i;function o(...a){return t[19](t[30],...a)}function s(){return t[20](t[30])}function c(){return t[21](t[30])}function u(){return t[22](t[30])}return{c(){e=T("div"),v(e,"class",n="key "+(t[31]?"white":"black")+" svelte-rsi44m"),It(e,"--color-hue",t[32]),pt(e,"pressed",t[32]!==null),pt(e,"ghost",t[33]&&t[32]===null)},m(a,d){L(a,e,d),r||(i=[E(e,"pointerdown",o),E(e,"pointerenter",s),E(e,"pointerleave",c),E(e,"pointerup",u)],r=!0)},p(a,d){t=a,d[0]&8&&n!==(n="key "+(t[31]?"white":"black")+" svelte-rsi44m")&&v(e,"class",n),d[0]&8&&It(e,"--color-hue",t[32]),d[0]&8&&pt(e,"pressed",t[32]!==null),d[0]&8&&pt(e,"ghost",t[33]&&t[32]===null)},d(a){a&&R(e),r=!1,Oe(i)}}}function ca(t){let e,n,r,i,o=ze(Object.entries(t[3])),s=[];for(let c=0;c<o.length;c+=1)s[c]=sr(ir(t,o,c));return{c(){e=T("div"),n=T("div");for(let c=0;c<s.length;c+=1)s[c].c();v(n,"class","piano svelte-rsi44m"),v(e,"class","piano-container svelte-rsi44m")},m(c,u){L(c,e,u),b(e,n);for(let a=0;a<s.length;a+=1)s[a]&&s[a].m(n,null);t[23](e),r||(i=[E(window,"resize",t[16]),E(window,"keyup",t[11]),E(window,"keydown",t[10]),E(window,"pointerdown",t[17]),E(window,"pointerup",t[18]),E(n,"touchstart",Yr(t[15]))],r=!0)},p(c,u){if(u[0]&394){o=ze(Object.entries(c[3]));let a;for(a=0;a<o.length;a+=1){const d=ir(c,o,a);s[a]?s[a].p(d,u):(s[a]=sr(d),s[a].c(),s[a].m(n,null))}for(;a<s.length;a+=1)s[a].d(1);s.length=o.length}},i:q,o:q,d(c){c&&R(e),un(s,c),t[23](null),r=!1,Oe(i)}}}function or(t,e){e.get(t)&&(e.get(t).stop(),e.delete(t))}function ua(t,e,n){let r,i,o,s=!1,c,u,a,d=new Map,{controlPanelData:f}=e,{noteRange:l,sustain:h,octaveShift:p,volume:m}=f;X(t,h,g=>n(24,r=g)),X(t,p,g=>n(26,o=g)),X(t,m,g=>n(25,i=g));let{midiPlayer:y}=e;y.onPlayNote=A,y.onStopNote=w;let{socketPlayer:I}=e;I.onPlayNote=({note:g,volume:C},F)=>{a[g]&&n(3,a[g].pressedColor=F.colorHue,a),F.instrument&&(or(g,F.audioNodeMap),F.audioNodeMap.set(g,F.instrument.play(g,void 0,{gain:C})))},I.onStopNote=({note:g,sustain:C},F)=>{a[g]&&n(3,a[g].pressedColor=null,a),C||or(g,F.audioNodeMap)},l.subscribe(g=>{n(3,[a,c]=Yi(g[0],g[1]),a,n(0,c))});function M(g){const C=en(g)+o;return tn(g)+C}function A(g,C){const F=M(g);d.has(F)||(a[g]&&n(3,a[g].isGhost=!0,a),d.set(F,!0),I.playNote(F,i*C))}function w(g){const C=M(g);d.has(C)&&(a[g]&&n(3,a[g].isGhost=!1,a),d.delete(C),I.stopNote(C,r))}h.subscribe(g=>{if(!g)for(const C of I.originalThread.audioNodeMap.keys())d.get(C)||I.stopNote(C,!1)}),p.subscribe(()=>{for(const g of d.keys())I.stopNote(g,r)});function x(g){if(u){const C=u.clientHeight/6,F=u.offsetWidth/g;u.style.setProperty("--white-key-width",`${Math.min(F,C)}px`)}}Qr(()=>{x(c)});function G(g){const C=Dn[g.code],F=g.target;C&&F.tagName!=="INPUT"&&(g.preventDefault(),A(C,.5))}function S(g){const C=Dn[g.code];C&&w(C)}function _(g){Zr.call(this,t,g)}const O=()=>x(c),P=()=>n(1,s=!0),j=()=>n(1,s=!1),z=(g,C)=>{C.currentTarget.releasePointerCapture(C.pointerId),A(g,.5)},ae=g=>{s&&A(g,.5)},Q=g=>w(g),ie=g=>w(g);function se(g){Yt[g?"unshift":"push"](()=>{u=g,n(2,u)})}return t.$$set=g=>{"controlPanelData"in g&&n(14,f=g.controlPanelData),"midiPlayer"in g&&n(12,y=g.midiPlayer),"socketPlayer"in g&&n(13,I=g.socketPlayer)},t.$$.update=()=>{t.$$.dirty[0]&1&&x(c)},[c,s,u,a,h,p,m,A,w,x,G,S,y,I,f,_,O,P,j,z,ae,Q,ie,se]}class la extends fn{constructor(e){super(),hn(this,e,ua,ca,Nt,{controlPanelData:14,midiPlayer:12,socketPlayer:13},null,[-1,-1])}}function ha(t){let e,n,r,i,o;return n=new aa({props:{controlPanelData:t[0],midiPlayer:t[1],socketPlayer:t[2]}}),i=new la({props:{controlPanelData:t[0],midiPlayer:t[1],socketPlayer:t[2]}}),{c(){e=T("main"),Un(n.$$.fragment),r=U(),Un(i.$$.fragment),v(e,"class","svelte-ieeeet")},m(s,c){L(s,e,c),Qt(n,e,null),b(e,r),Qt(i,e,null),o=!0},p:q,i(s){o||(Ct(n.$$.fragment,s),Ct(i.$$.fragment,s),o=!0)},o(s){Xt(n.$$.fragment,s),Xt(i.$$.fragment,s),o=!1},d(s){s&&R(e),Zt(n),Zt(i)}}}function fa(t){const e=new sa,n=new $i,r=new Go;return[e,n,r]}class da extends fn{constructor(e){super(),hn(this,e,fa,ha,Nt,{})}}new da({target:document.body});

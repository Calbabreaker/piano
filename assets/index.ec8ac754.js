import{g as ee,w as G,M as Zt,l as xt,a as $t,S as Ve,i as Ye,s as Xe,e as m,t as ie,b as K,c,n as P,d as S,h as qe,f as k,j as _,k as en,m as Dt,o as L,p as jt,q as y,r as tn,u as ae,v as Ze,x as nn,y as xe,z as $e,A as I,B as on,C as z,D as ln,E as et,F as Le,G as sn,H as an,I as rn,J as Et,K as Mt,L as Ft,N as Tt,O as Ot}from"./vendor.90408fa6.js";const cn=function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const l of document.querySelectorAll('link[rel="modulepreload"]'))o(l);new MutationObserver(l=>{for(const s of l)if(s.type==="childList")for(const a of s.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&o(a)}).observe(document,{childList:!0,subtree:!0});function n(l){const s={};return l.integrity&&(s.integrity=l.integrity),l.referrerpolicy&&(s.referrerPolicy=l.referrerpolicy),l.crossorigin==="use-credentials"?s.credentials="include":l.crossorigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function o(l){if(l.ep)return;l.ep=!0;const s=n(l);fetch(l.href,s)}};cn();const It=["accordion","acoustic_bass","acoustic_grand_piano","acoustic_guitar_nylon","acoustic_guitar_steel","agogo","alto_sax","applause","bagpipe","banjo","baritone_sax","bassoon","bird_tweet","blown_bottle","brass_section","breath_noise","bright_acoustic_piano","celesta","cello","choir_aahs","church_organ","clarinet","clavinet","contrabass","distortion_guitar","drawbar_organ","dulcimer","electric_bass_finger","electric_bass_pick","electric_grand_piano","electric_guitar_clean","electric_guitar_jazz","electric_guitar_muted","electric_piano_1","electric_piano_2","english_horn","fiddle","flute","french_horn","fretless_bass","fx_1_rain","fx_2_soundtrack","fx_3_crystal","fx_4_atmosphere","fx_5_brightness","fx_6_goblins","fx_7_echoes","fx_8_scifi","glockenspiel","guitar_fret_noise","guitar_harmonics","gunshot","harmonica","harpsichord","helicopter","honkytonk_piano","kalimba","koto","lead_1_square","lead_2_sawtooth","lead_3_calliope","lead_4_chiff","lead_5_charang","lead_6_voice","lead_7_fifths","lead_8_bass__lead","marimba","melodic_tom","music_box","muted_trumpet","oboe","ocarina","orchestra_hit","orchestral_harp","overdriven_guitar","pad_1_new_age","pad_2_warm","pad_3_polysynth","pad_4_choir","pad_5_bowed","pad_6_metallic","pad_7_halo","pad_8_sweep","pan_flute","percussive_organ","piccolo","pizzicato_strings","recorder","reed_organ","reverse_cymbal","rock_organ","seashore","shakuhachi","shamisen","shanai","sitar","slap_bass_1","slap_bass_2","soprano_sax","steel_drums","string_ensemble_1","string_ensemble_2","synth_bass_1","synth_bass_2","synth_brass_1","synth_brass_2","synth_choir","synth_drum","synth_strings_1","synth_strings_2","taiko_drum","tango_accordion","telephone_ring","tenor_sax","timpani","tinkle_bell","tremolo_strings","trombone","trumpet","tuba","tubular_bells","vibraphone","viola","violin","voice_oohs","whistle","woodblock","xylophone"],Se=["C","C#","D","D#","E","F","F#","G","G#","A","A#","B"],Bt={Backquote:"A#2",Tab:"B2",KeyQ:"C3",Digit2:"C#3",KeyW:"D3",Digit3:"D#3",KeyE:"E3",KeyR:"F3",Digit5:"F#3",KeyT:"G3",Digit6:"G#3",KeyY:"A3",Digit7:"A#3",KeyU:"B3",KeyI:"C4",Digit9:"C#4",KeyO:"D4",Digit0:"D#4",KeyP:"E4",BracketLeft:"F4",Equal:"F#4",BracketRight:"G4",Backspace:"G#4",Backslash:"A4",CapsLock:"A#4",ShiftLeft:"B4",KeyZ:"C5",KeyS:"C#5",KeyX:"D5",KeyD:"D#5",KeyC:"E5",KeyV:"F5",KeyG:"F#5",KeyB:"G5",KeyH:"G#5",KeyN:"A5",KeyJ:"A#5",KeyM:"B5",Comma:"C6",KeyL:"C#6",Period:"D6",Semicolon:"D#6",Slash:"E6",ShiftRight:"F6",Enter:"F#6"};function tt(e){return parseInt(e.charAt(e.length-1))}function nt(e){return e.substring(0,e.length-1)}function ot(e){const t=Math.floor(e/12)-1;return Se[e%12]+t}function un(e,t){const n=tt(t),o=tt(e),l=Se.indexOf(nt(e)),s=Se.indexOf(nt(t)),a={};let u=0;for(let p=o;p<=n;p++){let r=p===o?l:0;for(;r<Se.length&&!(p===n&&r>s);){const d=Se[r],b=d.length===1;a[d+p]={white:b,pressedColor:null,ghost:!1},b&&u++,r++}}return{noteMap:a,whiteKeys:u}}const W=G(!1),be=G(0),ze=G(0),lt=G(),Ae=G(1);async function _n(e,t){let n=[],o=null;function l(r){o=new Zt(r),o.tracks=o.tracks.filter(d=>d.notes.length!==0);let i=0;o.tracks.forEach(d=>{const b=d.notes[d.notes.length-1],w=b.time+b.duration;w>i&&(i=w)}),ze.set(i)}lt.subscribe(r=>{if(W.set(!1),ze.set(0),be.set(0),!r){o=null;return}const i=new FileReader;i.onload=()=>l(i.result),i.readAsArrayBuffer(r)});function s(r){const i=ee(be)+r;be.set(i),o.tracks.forEach((d,b)=>{const w=d.notes[n[b]];if(!w)return;i-w.time>0&&(e(w.name,w.velocity),setTimeout(()=>t(w.name),w.duration*1e3/ee(Ae)),n[b]++)}),i>ee(ze)&&W.set(!1)}W.subscribe(r=>{if(!r)return;if(!o)return W.set(!1),alert("No MIDI file selected!");o.tracks.forEach((b,w)=>{let v=0,D=b.notes.length-1;for(;v!=D;){const M=Math.ceil((v+D)/2);b.notes[M].time>ee(be)?D=M-1:v=M}n[w]=v});let i=performance.now();const d=()=>{if(!ee(W))return;const b=performance.now(),w=b-i;i=b,s(w/1e3*ee(Ae)),requestAnimationFrame(d)};d()});function a(r){const[i,d,b]=r.data;i>143&&i<160?b==0?t(ot(d)):e(ot(d),b/127):i>127&&i<144&&t(ot(d))}const u=await navigator.requestMIDIAccess();function p(){u.inputs.forEach(r=>{r.onmidimessage=a})}p(),u.onstatechange=()=>{p()}}const qt=window.AudioContext||window.webkitAudioContext;qt||alert("Your browser does not seem to support the Web Audio API!");const fn=new qt,st={};function Lt(e){return st[e]||(st[e]=xt.exports.instrument(fn,e)),st[e]}const zt=G(),Re=G("acoustic_grand_piano"),Ne=G(new Map),it=G(!1),re=new Map,He={audioNodeMap:new Map,colorHue:"220"};re.set("0",He);let A,at,rt;async function ct(e,t){let n=await Lt(e),o=re.get(t);o&&(o.instrument=n)}function Rt({socketID:e,colorHue:t,instrumentName:n}){re.set(e,{audioNodeMap:e===A.id?He.audioNodeMap:new Map,colorHue:t}),Ne.set(ee(Ne).set(e,t)),n&&ct(n,e)}function ut(){A.removeAllListeners(),A=null,it.set(!1)}function pn(e,t){at=e,rt=t}function _t(e){const t=new Promise((n,o)=>{A=$t("https://calbabreaker-piano-backend.herokuapp.com",{query:{roomName:e,instrumentName:ee(Re)},path:{}.VITE_BACKEND_PATH}),A.on("connect_error",()=>{ut(),o("Failed to connect to server!")}),A.on("connect_timeout",()=>{ut(),o("Timed out while connecting to server!")}),A.on("connect",()=>{it.set(!0),re.delete("0"),ee(Ne).clear(),n(),history.replaceState({},`Play Piano! - ${e}`,`?room=${e}`)}),A.on("disconnect",()=>{re.clear(),re.set("0",He),ut(),history.replaceState({},"Play Piano!",location.pathname)}),A.on("play_note",s=>{at(s)}),A.on("stop_note",s=>{rt(s)}),A.on("instrument_change",s=>{const{instrumentName:a,socketID:u}=s;ct(a,u)}),A.on("client_connect",s=>{Rt(s)}),A.on("client_list_recieve",s=>{const a=s;for(let u of a)Rt(u)}),A.on("client_disconnect",s=>{const a=ee(Ne);a.delete(s),Ne.set(a),re.delete(s)})});zt.set(t)}function dn(e,t){const n={note:e,volume:t};A?A.emit("play_note",n):at(n)}function ft(e,t){const n={note:e,sustain:t};A?A.emit("stop_note",n):rt(n)}Re.subscribe(e=>{A?A.emit("instrument_change",{instrumentName:e}):ct(e,"0")});const{window:mn}=on;function Ht(e,t,n){const o=e.slice();return o[38]=t[n][0],o[39]=t[n][1],o}function Gt(e,t,n){const o=e.slice();return o[43]=t[n],o}function Jt(e){let t,n=e[43]+"",o,l;return{c(){t=m("option"),o=ie(n),t.__value=l=e[43],t.value=t.__value},m(s,a){K(s,t,a),c(t,o)},p:P,d(s){s&&S(t)}}}function hn(e){return{c:P,m:P,d:P}}function gn(e){return{c:P,m:P,d:P}}function bn(e){let t;return{c(){t=ie("loading...")},m(n,o){K(n,t,o)},d(n){n&&S(t)}}}function vn(e){let t,n,o;return{c(){t=m("button"),t.textContent="Play"},m(l,s){K(l,t,s),n||(o=y(t,"click",e[24]),n=!0)},p:P,d(l){l&&S(t),n=!1,o()}}}function yn(e){let t,n,o;return{c(){t=m("button"),t.textContent="Pause"},m(l,s){K(l,t,s),n||(o=y(t,"click",e[23]),n=!0)},p:P,d(l){l&&S(t),n=!1,o()}}}function kn(e){let t,n,o;return{c(){t=m("button"),t.textContent="Join"},m(l,s){K(l,t,s),n||(o=y(t,"click",e[34]),n=!0)},p:P,d(l){l&&S(t),n=!1,o()}}}function wn(e){let t,n,o;return{c(){t=m("button"),t.textContent="Leave"},m(l,s){K(l,t,s),n||(o=y(t,"click",e[33]),n=!0)},p:P,d(l){l&&S(t),n=!1,o()}}}function Cn(e){let t,n=e[42]+"",o;return{c(){t=m("span"),o=ie(n),_(t,"class","error svelte-1ufj93m")},m(l,s){K(l,t,s),c(t,o)},p(l,s){s[0]&4096&&n!==(n=l[42]+"")&&Ze(o,n)},d(l){l&&S(t)}}}function Nn(e){let t,n=e[11]&&Wt(e);return{c(){n&&n.c(),t=et()},m(o,l){n&&n.m(o,l),K(o,t,l)},p(o,l){o[11]?n?n.p(o,l):(n=Wt(o),n.c(),n.m(t.parentNode,t)):n&&(n.d(1),n=null)},d(o){n&&n.d(o),o&&S(t)}}}function Wt(e){let t,n,o,l,s,a,u=Array.from(e[13].entries()),p=[];for(let r=0;r<u.length;r+=1)p[r]=Qt(Ht(e,u,r));return{c(){t=m("span"),t.textContent="Connected!",n=m("br"),o=k(),l=m("span"),l.textContent="People:",s=k();for(let r=0;r<p.length;r+=1)p[r].c();a=et()},m(r,i){K(r,t,i),K(r,n,i),K(r,o,i),K(r,l,i),K(r,s,i);for(let d=0;d<p.length;d+=1)p[d].m(r,i);K(r,a,i)},p(r,i){if(i[0]&8192){u=Array.from(r[13].entries());let d;for(d=0;d<u.length;d+=1){const b=Ht(r,u,d);p[d]?p[d].p(b,i):(p[d]=Qt(b),p[d].c(),p[d].m(a.parentNode,a))}for(;d<p.length;d+=1)p[d].d(1);p.length=u.length}},d(r){r&&S(t),r&&S(n),r&&S(o),r&&S(l),r&&S(s),xe(p,r),r&&S(a)}}}function Ut(e){let t;return{c(){t=m("span"),t.textContent="(you)",Dt(t,"margin-right","0.5rem")},m(n,o){K(n,t,o)},d(n){n&&S(t)}}}function Qt(e){let t,n,o,l,s=e[38]===A.id&&Ut();return{c(){t=m("div"),o=k(),s&&s.c(),l=et(),_(t,"class","icon svelte-1ufj93m"),_(t,"style",n=`--color-hue: ${e[39]}`)},m(a,u){K(a,t,u),K(a,o,u),s&&s.m(a,u),K(a,l,u)},p(a,u){u[0]&8192&&n!==(n=`--color-hue: ${a[39]}`)&&_(t,"style",n),a[38]===A.id?s||(s=Ut(),s.c(),s.m(l.parentNode,l)):s&&(s.d(1),s=null)},d(a){a&&S(t),a&&S(o),s&&s.d(a),a&&S(l)}}}function Kn(e){let t;return{c(){t=m("span"),t.textContent="Connecting..."},m(n,o){K(n,t,o)},p:P,d(n){n&&S(t)}}}function Sn(e){let t,n,o,l,s,a,u,p,r,i,d,b,w,v,D,M,F,fe,R,pe,j,ve,de,H,ye,ce,ke,me,f,h,C,Y,te,ne,oe,De,X,ue,we,je,he,Ee,le,Ke,g,ge,T,dt,U,mt,se,ht,gt,bt,B,vt,Me=e[8].toFixed(1)+"",Je,yt,Fe=e[10].toFixed(1)+"",We,kt,wt,Q,Te,Ct,Z,Nt,Ue,Oe,Qe,Kt,Ce=It,q=[];for(let E=0;E<Ce.length;E+=1)q[E]=Jt(Gt(e,Ce,E));let V={ctx:e,current:null,token:null,hasCatch:!1,pending:bn,then:gn,catch:hn};qe(ce=e[2],V);function St(E,N){return E[7]?yn:vn}let Ie=St(e),x=Ie(e);function At(E,N){return E[11]?wn:kn}let Be=At(e),$=Be(e),J={ctx:e,current:null,token:null,hasCatch:!0,pending:Kn,then:Nn,catch:Cn,error:42};return qe(Oe=e[12],J),{c(){t=m("div"),n=m("div"),o=m("div"),l=m("div"),s=m("span"),s.textContent="Sustain:",a=k(),u=m("input"),p=k(),r=m("div"),i=m("span"),i.textContent="Octave Shift:",d=k(),b=m("input"),w=k(),v=m("div"),D=m("span"),D.textContent="Volume:",M=k(),F=m("input"),fe=k(),R=m("input"),pe=k(),j=m("div"),ve=m("span"),ve.textContent="Instrument:",de=k(),H=m("select");for(let E=0;E<q.length;E+=1)q[E].c();ye=k(),V.block.c(),ke=k(),me=m("span"),me.textContent="Size:",f=k(),h=m("select"),C=m("option"),C.textContent="Full size (88 keys)",Y=m("option"),Y.textContent="Half size (61 keys)",te=m("option"),te.textContent="Quater Size (37 keys)",ne=m("option"),ne.textContent="2 Octaves (24 keys)",oe=m("option"),oe.textContent="1 Octave (12 keys)",De=k(),X=m("div"),ue=m("div"),we=m("p"),we.textContent="Play a midi:",je=k(),he=m("input"),Ee=k(),le=m("div"),x.c(),Ke=k(),g=m("button"),g.textContent="Restart",ge=k(),T=m("div"),dt=ie("Speed:"),U=m("input"),mt=k(),se=m("input"),ht=ie("times"),gt=m("br"),bt=k(),B=m("input"),vt=k(),Je=ie(Me),yt=ie("/"),We=ie(Fe),kt=ie(" seconds"),wt=k(),Q=m("div"),Te=m("p"),Te.textContent="Join a room:",Ct=k(),Z=m("input"),Nt=k(),$.c(),Ue=k(),J.block.c(),_(u,"type","checkbox"),_(u,"class","svelte-1ufj93m"),_(l,"title","Shortcut: space"),_(l,"class","svelte-1ufj93m"),_(b,"type","number"),_(b,"min","-3"),_(b,"max","3"),_(b,"class","svelte-1ufj93m"),_(r,"title","Shortcut: left ctrl +, left alt or right ctrl -"),_(r,"class","svelte-1ufj93m"),_(F,"type","range"),_(F,"min","0"),_(F,"max","50"),_(F,"step","0.1"),_(F,"class","svelte-1ufj93m"),_(R,"type","number"),_(R,"class","svelte-1ufj93m"),_(v,"class","svelte-1ufj93m"),e[0]===void 0&&en(()=>e[20].call(H)),_(j,"class","svelte-1ufj93m"),_(C,"data-range","A0,C8"),C.__value="Full size (88 keys)",C.value=C.__value,_(Y,"data-range","C2,C7"),Y.selected=!0,Y.__value="Half size (61 keys)",Y.value=Y.__value,_(te,"data-range","C3,C6"),te.__value="Quater Size (37 keys)",te.value=te.__value,_(ne,"data-range","C4,B5"),ne.__value="2 Octaves (24 keys)",ne.value=ne.__value,_(oe,"data-range","C4,B4"),oe.__value="1 Octave (12 keys)",oe.value=oe.__value,_(o,"class","svelte-1ufj93m"),_(we,"class","svelte-1ufj93m"),_(he,"type","file"),_(he,"class","svelte-1ufj93m"),_(ue,"class","svelte-1ufj93m"),_(le,"class","svelte-1ufj93m"),_(U,"type","range"),_(U,"min","0.01"),_(U,"max","4"),_(U,"step","0.01"),_(U,"class","svelte-1ufj93m"),_(se,"type","number"),_(se,"min","0.01"),_(se,"class","svelte-1ufj93m"),_(B,"type","range"),_(B,"min","0"),_(B,"max",e[10]),_(B,"step","0.1"),Dt(B,"width","18rem"),_(B,"class","svelte-1ufj93m"),_(T,"class","svelte-1ufj93m"),_(X,"class","svelte-1ufj93m"),_(n,"class","row svelte-1ufj93m"),_(Te,"class","svelte-1ufj93m"),_(Z,"type","text"),_(Z,"placeholder","Room name"),_(Z,"class","svelte-1ufj93m"),_(t,"class","control-panel svelte-1ufj93m")},m(E,N){K(E,t,N),c(t,n),c(n,o),c(o,l),c(l,s),c(l,a),c(l,u),u.checked=e[4],c(o,p),c(o,r),c(r,i),c(r,d),c(r,b),L(b,e[3]),c(o,w),c(o,v),c(v,D),c(v,M),c(v,F),L(F,e[5]),c(v,fe),c(v,R),L(R,e[5]),c(o,pe),c(o,j),c(j,ve),c(j,de),c(j,H);for(let O=0;O<q.length;O+=1)q[O].m(H,null);jt(H,e[0]),c(j,ye),V.block.m(j,V.anchor=null),V.mount=()=>j,V.anchor=null,c(o,ke),c(o,me),c(o,f),c(o,h),c(h,C),c(h,Y),c(h,te),c(h,ne),c(h,oe),c(n,De),c(n,X),c(X,ue),c(ue,we),c(ue,je),c(ue,he),c(X,Ee),c(X,le),x.m(le,null),c(le,Ke),c(le,g),c(X,ge),c(X,T),c(T,dt),c(T,U),L(U,e[9]),c(T,mt),c(T,se),L(se,e[9]),c(T,ht),c(T,gt),c(T,bt),c(T,B),L(B,e[8]),c(T,vt),c(T,Je),c(T,yt),c(T,We),c(T,kt),c(t,wt),c(t,Q),c(Q,Te),c(Q,Ct),c(Q,Z),L(Z,e[1]),c(Q,Nt),$.m(Q,null),c(Q,Ue),J.block.m(Q,J.anchor=null),J.mount=()=>Q,J.anchor=null,Qe||(Kt=[y(mn,"keydown",e[15]),y(u,"change",e[16]),y(b,"input",e[17]),y(F,"change",e[18]),y(F,"input",e[18]),y(R,"input",e[19]),y(H,"change",e[20]),y(h,"change",e[21]),tn(e[14].call(null,h)),y(he,"change",e[22]),y(g,"click",e[25]),y(U,"change",e[26]),y(U,"input",e[26]),y(se,"input",e[27]),y(B,"change",e[28]),y(B,"input",e[28]),y(B,"mousedown",e[29]),y(B,"mouseup",e[30]),y(Z,"input",e[31]),y(Z,"keydown",e[32])],Qe=!0)},p(E,N){if(e=E,N[0]&16&&(u.checked=e[4]),N[0]&8&&ae(b.value)!==e[3]&&L(b,e[3]),N[0]&32&&L(F,e[5]),N[0]&32&&ae(R.value)!==e[5]&&L(R,e[5]),N&0){Ce=It;let O;for(O=0;O<Ce.length;O+=1){const Pt=Gt(e,Ce,O);q[O]?q[O].p(Pt,N):(q[O]=Jt(Pt),q[O].c(),q[O].m(H,null))}for(;O<q.length;O+=1)q[O].d(1);q.length=Ce.length}N[0]&1&&jt(H,e[0]),V.ctx=e,N[0]&4&&ce!==(ce=e[2])&&qe(ce,V),Ie===(Ie=St(e))&&x?x.p(e,N):(x.d(1),x=Ie(e),x&&(x.c(),x.m(le,Ke))),N[0]&512&&L(U,e[9]),N[0]&512&&ae(se.value)!==e[9]&&L(se,e[9]),N[0]&1024&&_(B,"max",e[10]),N[0]&256&&L(B,e[8]),N[0]&256&&Me!==(Me=e[8].toFixed(1)+"")&&Ze(Je,Me),N[0]&1024&&Fe!==(Fe=e[10].toFixed(1)+"")&&Ze(We,Fe),N[0]&2&&Z.value!==e[1]&&L(Z,e[1]),Be===(Be=At(e))&&$?$.p(e,N):($.d(1),$=Be(e),$&&($.c(),$.m(Q,Ue))),J.ctx=e,N[0]&4096&&Oe!==(Oe=e[12])&&qe(Oe,J)||nn(J,e,N)},i:P,o:P,d(E){E&&S(t),xe(q,E),V.block.d(),V.token=null,V=null,x.d(),$.d(),J.block.d(),J.token=null,J=null,Qe=!1,$e(Kt)}}}const _e=G(0),Pe=G(!1),Ge=G(25),pt=G(["C0","C0"]);function An(e,t,n){let o,l,s=P,a,u=P,p,r=P,i,d,b=P,w,v,D,M,F,fe,R,pe;I(e,_e,g=>n(3,l=g)),I(e,Pe,g=>n(4,a=g)),I(e,pt,g=>n(35,p=g)),I(e,Re,g=>n(0,i=g)),I(e,Ge,g=>n(5,d=g)),I(e,lt,g=>n(6,w=g)),I(e,W,g=>n(7,v=g)),I(e,be,g=>n(8,D=g)),I(e,Ae,g=>n(9,M=g)),I(e,ze,g=>n(10,F=g)),I(e,it,g=>n(11,fe=g)),I(e,zt,g=>n(12,R=g)),I(e,Ne,g=>n(13,pe=g)),e.$$.on_destroy.push(()=>s()),e.$$.on_destroy.push(()=>u()),e.$$.on_destroy.push(()=>r()),e.$$.on_destroy.push(()=>b());let j="";const de=new URLSearchParams(window.location.search).get("room");de&&(j=de,_t(j));function H(g){const ge=g.children[g.selectedIndex];z(pt,p=ge.dataset.range.split(","),p)}function ye(g){g.code==="Space"&&z(Pe,a=!a,a),g.code==="ControlLeft"?z(_e,l-=1,l):(g.code==="AltLeft"||g.code=="ControlRight")&&z(_e,l+=1,l),l<-3?z(_e,l=3,l):l>3&&z(_e,l=-3,l)}function ce(){a=this.checked,Pe.set(a)}function ke(){l=ae(this.value),_e.set(l)}function me(){d=ae(this.value),Ge.set(d)}function f(){d=ae(this.value),Ge.set(d)}function h(){i=ln(this),Re.set(i)}const C=g=>H(g.currentTarget),Y=g=>{var ge;return z(lt,w=(ge=g.currentTarget.files)==null?void 0:ge[0],w)},te=()=>z(W,v=!1,v),ne=()=>z(W,v=!0,v),oe=()=>{z(W,v=!1,v),z(be,D=0,D),setTimeout(()=>{z(W,v=!0,v)},100)};function De(){M=ae(this.value),Ae.set(M)}function X(){M=ae(this.value),Ae.set(M)}function ue(){D=ae(this.value),be.set(D)}const we=()=>z(W,v=!1,v),je=()=>z(W,v=!0,v);function he(){j=this.value,n(1,j)}const Ee=g=>{g.code==="Enter"&&_t(j)},le=()=>A.disconnect(),Ke=()=>_t(j);return e.$$.update=()=>{e.$$.dirty[0]&1&&n(2,o=Lt(i))},[i,j,o,l,a,d,w,v,D,M,F,fe,R,pe,H,ye,ce,ke,me,f,h,C,Y,te,ne,oe,De,X,ue,we,je,he,Ee,le,Ke]}class Pn extends Ve{constructor(t){super();Ye(this,t,An,Sn,Xe,{},null,[-1,-1])}}function Vt(e,t,n){const o=e.slice();return o[26]=t[n][0],o[27]=t[n][1].white,o[28]=t[n][1].pressedColor,o[29]=t[n][1].ghost,o}function Yt(e){let t,n,o,l,s;function a(...i){return e[14](e[26],...i)}function u(){return e[15](e[26])}function p(){return e[16](e[26])}function r(){return e[17](e[26])}return{c(){t=m("div"),_(t,"class",n="key "+(e[27]?"white":"black")+" svelte-yqi7mq"),_(t,"style",o=`--color-hue: ${e[28]}`),Le(t,"pressed",e[28]!==null),Le(t,"ghost",e[29]&&e[28]===null)},m(i,d){K(i,t,d),l||(s=[y(t,"pointerdown",a),y(t,"pointerenter",u),y(t,"pointerleave",p),y(t,"pointerup",r)],l=!0)},p(i,d){e=i,d[0]&4&&n!==(n="key "+(e[27]?"white":"black")+" svelte-yqi7mq")&&_(t,"class",n),d[0]&4&&o!==(o=`--color-hue: ${e[28]}`)&&_(t,"style",o),d[0]&4&&Le(t,"pressed",e[28]!==null),d[0]&4&&Le(t,"ghost",e[29]&&e[28]===null)},d(i){i&&S(t),l=!1,$e(s)}}}function Dn(e){let t,n,o,l,s,a=Object.entries(e[2]),u=[];for(let p=0;p<a.length;p+=1)u[p]=Yt(Vt(e,a,p));return{c(){t=m("div"),n=m("div");for(let p=0;p<u.length;p+=1)u[p].c();_(n,"class","piano svelte-yqi7mq"),_(n,"style",o=`--white-keys: ${e[0]}`),_(t,"class","piano-container svelte-yqi7mq")},m(p,r){K(p,t,r),c(t,n);for(let i=0;i<u.length;i+=1)u[i].m(n,null);e[18](t),l||(s=[y(window,"resize",e[10]),y(window,"load",e[11]),y(window,"keyup",e[8]),y(window,"keydown",e[7]),y(window,"pointerdown",e[12]),y(window,"pointerup",e[13]),y(n,"touchend",sn(e[9]))],l=!0)},p(p,r){if(r[0]&54){a=Object.entries(p[2]);let i;for(i=0;i<a.length;i+=1){const d=Vt(p,a,i);u[i]?u[i].p(d,r):(u[i]=Yt(d),u[i].c(),u[i].m(n,null))}for(;i<u.length;i+=1)u[i].d(1);u.length=a.length}r[0]&1&&o!==(o=`--white-keys: ${p[0]}`)&&_(n,"style",o)},i:P,o:P,d(p){p&&S(t),xe(u,p),e[18](null),l=!1,$e(s)}}}function Xt(e,t){t.get(e)&&(t.get(e).stop(),t.delete(e))}function jn(e,t,n){let o,l,s;I(e,Pe,f=>n(19,o=f)),I(e,Ge,f=>n(20,l=f)),I(e,_e,f=>n(21,s=f));let a=!1,u,p,r,i=new Map;pt.subscribe(f=>{const h=un(f[0],f[1]);n(2,u=h.noteMap),n(0,p=h.whiteKeys)});function d(f){var C;const h=re.get((C=f.socketID)!=null?C:"0");u[f.note]&&n(2,u[f.note].pressedColor=h.colorHue,u),!!h.instrument&&(Xt(f.note,h.audioNodeMap),h.audioNodeMap.set(f.note,h.instrument.play(f.note,void 0,{gain:f.volume})))}function b(f){var C;const h=re.get((C=f.socketID)!=null?C:"0");u[f.note]&&n(2,u[f.note].pressedColor=null,u),f.sustain||Xt(f.note,h.audioNodeMap)}pn(d,b);function w(f){const h=tt(f)+s;return nt(f)+h}function v(f,h){const C=w(f);i.get(C)||(u[f]&&n(2,u[f].ghost=!0,u),i.set(C,!0),dn(C,l*h))}function D(f){const h=w(f);u[f]&&n(2,u[f].ghost=!1,u),!!i.get(h)&&(i.delete(h),ft(h,o))}_n(v,D),Pe.subscribe(f=>{if(!f)for(const h of He.audioNodeMap.keys())i.get(h)||ft(h,!1)}),_e.subscribe(()=>{for(const f of i.keys())ft(f,o)});function M(f=p){if(!r)return;const h=r.clientHeight/6,C=r.offsetWidth/f;r.style.setProperty("--white-key-width",`${Math.min(C,h)}px`)}function F(f){const h=Bt[f.code],C=f.target;h&&C.tagName!=="INPUT"&&(f.preventDefault(),v(h,.5))}function fe(f){const h=Bt[f.code];h&&D(h)}function R(f){an.call(this,e,f)}const pe=()=>M(),j=()=>M(),ve=()=>n(1,a=!0),de=()=>n(1,a=!1),H=(f,h)=>{h.currentTarget.releasePointerCapture(h.pointerId),v(f,.5)},ye=f=>{a&&v(f,.5)},ce=f=>D(f),ke=f=>D(f);function me(f){rn[f?"unshift":"push"](()=>{r=f,n(3,r)})}return e.$$.update=()=>{e.$$.dirty[0]&1&&M(p)},[p,a,u,r,v,D,M,F,fe,R,pe,j,ve,de,H,ye,ce,ke,me]}class En extends Ve{constructor(t){super();Ye(this,t,jn,Dn,Xe,{},null,[-1,-1])}}function Mn(e){let t,n,o,l,s;return n=new Pn({}),l=new En({}),{c(){t=m("main"),Et(n.$$.fragment),o=k(),Et(l.$$.fragment),_(t,"class","svelte-ieeeet")},m(a,u){K(a,t,u),Mt(n,t,null),c(t,o),Mt(l,t,null),s=!0},p:P,i(a){s||(Ft(n.$$.fragment,a),Ft(l.$$.fragment,a),s=!0)},o(a){Tt(n.$$.fragment,a),Tt(l.$$.fragment,a),s=!1},d(a){a&&S(t),Ot(n),Ot(l)}}}class Fn extends Ve{constructor(t){super();Ye(this,t,null,Mn,Xe,{})}}new Fn({target:document.body});

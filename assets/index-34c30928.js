(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))r(i);new MutationObserver(i=>{for(const o of i)if(o.type==="childList")for(const s of o.addedNodes)s.tagName==="LINK"&&s.rel==="modulepreload"&&r(s)}).observe(document,{childList:!0,subtree:!0});function n(i){const o={};return i.integrity&&(o.integrity=i.integrity),i.referrerpolicy&&(o.referrerPolicy=i.referrerpolicy),i.crossorigin==="use-credentials"?o.credentials="include":i.crossorigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function r(i){if(i.ep)return;i.ep=!0;const o=n(i);fetch(i.href,o)}})();function U(){}function si(e){return e&&typeof e=="object"&&typeof e.then=="function"}function Sr(e){return e()}function Wn(){return Object.create(null)}function Ae(e){e.forEach(Sr)}function kn(e){return typeof e=="function"}function Pt(e,t){return e!=e?t==t:e!==t||e&&typeof e=="object"||typeof e=="function"}function oi(e){return Object.keys(e).length===0}function Ir(e,...t){if(e==null)return U;const n=e.subscribe(...t);return n.unsubscribe?()=>n.unsubscribe():n}function pe(e){let t;return Ir(e,n=>t=n)(),t}function J(e,t,n){e.$$.on_destroy.push(Ir(t,n))}function Y(e,t,n){return e.set(n),t}function ai(e){return e&&kn(e.destroy)?e.destroy:U}function g(e,t){e.appendChild(t)}function V(e,t,n){e.insertBefore(t,n||null)}function L(e){e.parentNode&&e.parentNode.removeChild(e)}function wn(e,t){for(let n=0;n<e.length;n+=1)e[n]&&e[n].d(t)}function k(e){return document.createElement(e)}function re(e){return document.createTextNode(e)}function P(){return re(" ")}function Cr(){return re("")}function C(e,t,n,r){return e.addEventListener(t,n,r),()=>e.removeEventListener(t,n,r)}function ci(e){return function(t){return t.preventDefault(),e.call(this,t)}}function v(e,t,n){n==null?e.removeAttribute(t):e.getAttribute(t)!==n&&e.setAttribute(t,n)}function we(e){return e===""?null:+e}function ui(e){return Array.from(e.childNodes)}function tn(e,t){t=""+t,e.wholeText!==t&&(e.data=t)}function ee(e,t){e.value=t??""}function Ct(e,t,n,r){n===null?e.style.removeProperty(t):e.style.setProperty(t,n,r?"important":"")}function Yn(e,t){for(let n=0;n<e.options.length;n+=1){const r=e.options[n];if(r.__value===t){r.selected=!0;return}}e.selectedIndex=-1}function li(e){const t=e.querySelector(":checked")||e.options[0];return t&&t.__value}function ft(e,t,n){e.classList[n?"add":"remove"](t)}let tt;function Te(e){tt=e}function Or(){if(!tt)throw new Error("Function called outside component initialization");return tt}function fi(e){Or().$$.on_mount.push(e)}function hi(e,t){const n=e.$$.callbacks[t.type];n&&n.slice().forEach(r=>r.call(this,t))}const Ye=[],nn=[],vt=[],Xn=[],di=Promise.resolve();let rn=!1;function pi(){rn||(rn=!0,di.then(Tn))}function Ot(e){vt.push(e)}const zt=new Set;let ht=0;function Tn(){const e=tt;do{for(;ht<Ye.length;){const t=Ye[ht];ht++,Te(t),mi(t.$$)}for(Te(null),Ye.length=0,ht=0;nn.length;)nn.pop()();for(let t=0;t<vt.length;t+=1){const n=vt[t];zt.has(n)||(zt.add(n),n())}vt.length=0}while(Ye.length);for(;Xn.length;)Xn.pop()();rn=!1,zt.clear(),Te(e)}function mi(e){if(e.fragment!==null){e.update(),Ae(e.before_update);const t=e.dirty;e.dirty=[-1],e.fragment&&e.fragment.p(e.ctx,t),e.after_update.forEach(Ot)}}const _t=new Set;let Ue;function yi(){Ue={r:0,c:[],p:Ue}}function gi(){Ue.r||Ae(Ue.c),Ue=Ue.p}function Nt(e,t){e&&e.i&&(_t.delete(e),e.i(t))}function sn(e,t,n,r){if(e&&e.o){if(_t.has(e))return;_t.add(e),Ue.c.push(()=>{_t.delete(e),r&&(n&&e.d(1),r())}),e.o(t)}else r&&r()}function Qn(e,t){const n=t.token={};function r(i,o,s,a){if(t.token!==n)return;t.resolved=a;let l=t.ctx;s!==void 0&&(l=l.slice(),l[s]=a);const c=i&&(t.current=i)(l);let m=!1;t.block&&(t.blocks?t.blocks.forEach((d,u)=>{u!==o&&d&&(yi(),sn(d,1,1,()=>{t.blocks[u]===d&&(t.blocks[u]=null)}),gi())}):t.block.d(1),c.c(),Nt(c,1),c.m(t.mount(),t.anchor),m=!0),t.block=c,t.blocks&&(t.blocks[o]=c),m&&Tn()}if(si(e)){const i=Or();if(e.then(o=>{Te(i),r(t.then,1,t.value,o),Te(null)},o=>{if(Te(i),r(t.catch,2,t.error,o),Te(null),!t.hasCatch)throw o}),t.current!==t.pending)return r(t.pending,0),!0}else{if(t.current!==t.then)return r(t.then,1,t.value,e),!0;t.resolved=e}}function Zn(e){e&&e.c()}function on(e,t,n,r){const{fragment:i,after_update:o}=e.$$;i&&i.m(t,n),r||Ot(()=>{const s=e.$$.on_mount.map(Sr).filter(kn);e.$$.on_destroy?e.$$.on_destroy.push(...s):Ae(s),e.$$.on_mount=[]}),o.forEach(Ot)}function an(e,t){const n=e.$$;n.fragment!==null&&(Ae(n.on_destroy),n.fragment&&n.fragment.d(t),n.on_destroy=n.fragment=null,n.ctx=[])}function bi(e,t){e.$$.dirty[0]===-1&&(Ye.push(e),pi(),e.$$.dirty.fill(0)),e.$$.dirty[t/31|0]|=1<<t%31}function xn(e,t,n,r,i,o,s,a=[-1]){const l=tt;Te(e);const c=e.$$={fragment:null,ctx:[],props:o,update:U,not_equal:i,bound:Wn(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(t.context||(l?l.$$.context:[])),callbacks:Wn(),dirty:a,skip_bound:!1,root:t.target||l.$$.root};s&&s(c.root);let m=!1;if(c.ctx=n?n(e,t.props||{},(d,u,...f)=>{const h=f.length?f[0]:u;return c.ctx&&i(c.ctx[d],c.ctx[d]=h)&&(!c.skip_bound&&c.bound[d]&&c.bound[d](h),m&&bi(e,d)),u}):[],c.update(),m=!0,Ae(c.before_update),c.fragment=r?r(c.ctx):!1,t.target){if(t.hydrate){const d=ui(t.target);c.fragment&&c.fragment.l(d),d.forEach(L)}else c.fragment&&c.fragment.c();t.intro&&Nt(e.$$.fragment),on(e,t.target,t.anchor,t.customElement),Tn()}Te(l)}class Sn{$destroy(){an(this,1),this.$destroy=U}$on(t,n){if(!kn(n))return U;const r=this.$$.callbacks[t]||(this.$$.callbacks[t]=[]);return r.push(n),()=>{const i=r.indexOf(n);i!==-1&&r.splice(i,1)}}$set(t){this.$$set&&!oi(t)&&(this.$$.skip_bound=!0,this.$$set(t),this.$$.skip_bound=!1)}}const Ve=[];function te(e,t=U){let n;const r=new Set;function i(a){if(Pt(e,a)&&(e=a,n)){const l=!Ve.length;for(const c of r)c[1](),Ve.push(c,e);if(l){for(let c=0;c<Ve.length;c+=2)Ve[c][0](Ve[c+1]);Ve.length=0}}}function o(a){i(a(e))}function s(a,l=U){const c=[a,l];return r.add(c),r.size===1&&(n=t(i)||U),a(e),()=>{r.delete(c),r.size===0&&(n(),n=null)}}return{set:i,update:o,subscribe:s}}const er=["accordion","acoustic_bass","acoustic_grand_piano","acoustic_guitar_nylon","acoustic_guitar_steel","agogo","alto_sax","applause","bagpipe","banjo","baritone_sax","bassoon","bird_tweet","blown_bottle","brass_section","breath_noise","bright_acoustic_piano","celesta","cello","choir_aahs","church_organ","clarinet","clavinet","contrabass","distortion_guitar","drawbar_organ","dulcimer","electric_bass_finger","electric_bass_pick","electric_grand_piano","electric_guitar_clean","electric_guitar_jazz","electric_guitar_muted","electric_piano_1","electric_piano_2","english_horn","fiddle","flute","french_horn","fretless_bass","fx_1_rain","fx_2_soundtrack","fx_3_crystal","fx_4_atmosphere","fx_5_brightness","fx_6_goblins","fx_7_echoes","fx_8_scifi","glockenspiel","guitar_fret_noise","guitar_harmonics","gunshot","harmonica","harpsichord","helicopter","honkytonk_piano","kalimba","koto","lead_1_square","lead_2_sawtooth","lead_3_calliope","lead_4_chiff","lead_5_charang","lead_6_voice","lead_7_fifths","lead_8_bass__lead","marimba","melodic_tom","music_box","muted_trumpet","oboe","ocarina","orchestra_hit","orchestral_harp","overdriven_guitar","pad_1_new_age","pad_2_warm","pad_3_polysynth","pad_4_choir","pad_5_bowed","pad_6_metallic","pad_7_halo","pad_8_sweep","pan_flute","percussive_organ","piccolo","pizzicato_strings","recorder","reed_organ","reverse_cymbal","rock_organ","seashore","shakuhachi","shamisen","shanai","sitar","slap_bass_1","slap_bass_2","soprano_sax","steel_drums","string_ensemble_1","string_ensemble_2","synth_bass_1","synth_bass_2","synth_brass_1","synth_brass_2","synth_choir","synth_drum","synth_strings_1","synth_strings_2","taiko_drum","tango_accordion","telephone_ring","tenor_sax","timpani","tinkle_bell","tremolo_strings","trombone","trumpet","tuba","tubular_bells","vibraphone","viola","violin","voice_oohs","whistle","woodblock","xylophone"];var Ke=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function Nr(e){if(e.__esModule)return e;var t=e.default;if(typeof t=="function"){var n=function r(){if(this instanceof r){var i=[null];i.push.apply(i,arguments);var o=Function.bind.apply(t,i);return new o}return t.apply(this,arguments)};n.prototype=t.prototype}else n={};return Object.defineProperty(n,"__esModule",{value:!0}),Object.keys(e).forEach(function(r){var i=Object.getOwnPropertyDescriptor(e,r);Object.defineProperty(n,r,i.get?i:{enumerable:!0,get:function(){return e[r]}})}),n}var Er={},Ut={};function vi(e){var t=new X(e),n=t.readChunk();if(n.id!="MThd")throw"Bad MIDI file.  Expected 'MHdr', got: '"+n.id+"'";for(var r=_i(n.data),i=[],o=0;!t.eof()&&o<r.numTracks;o++){var s=t.readChunk();if(s.id!="MTrk")throw"Bad MIDI file.  Expected 'MTrk', got: '"+s.id+"'";var a=ki(s.data);i.push(a)}return{header:r,tracks:i}}function _i(e){var t=new X(e),n=t.readUInt16(),r=t.readUInt16(),i={format:n,numTracks:r},o=t.readUInt16();return o&32768?(i.framesPerSecond=256-(o>>8),i.ticksPerFrame=o&255):i.ticksPerBeat=o,i}function ki(e){for(var t=new X(e),n=[];!t.eof();){var r=o();n.push(r)}return n;var i;function o(){var s={};s.deltaTime=t.readVarInt();var a=t.readUInt8();if((a&240)===240)if(a===255){s.meta=!0;var l=t.readUInt8(),c=t.readVarInt();switch(l){case 0:if(s.type="sequenceNumber",c!==2)throw"Expected length for sequenceNumber event is 2, got "+c;return s.number=t.readUInt16(),s;case 1:return s.type="text",s.text=t.readString(c),s;case 2:return s.type="copyrightNotice",s.text=t.readString(c),s;case 3:return s.type="trackName",s.text=t.readString(c),s;case 4:return s.type="instrumentName",s.text=t.readString(c),s;case 5:return s.type="lyrics",s.text=t.readString(c),s;case 6:return s.type="marker",s.text=t.readString(c),s;case 7:return s.type="cuePoint",s.text=t.readString(c),s;case 32:if(s.type="channelPrefix",c!=1)throw"Expected length for channelPrefix event is 1, got "+c;return s.channel=t.readUInt8(),s;case 33:if(s.type="portPrefix",c!=1)throw"Expected length for portPrefix event is 1, got "+c;return s.port=t.readUInt8(),s;case 47:if(s.type="endOfTrack",c!=0)throw"Expected length for endOfTrack event is 0, got "+c;return s;case 81:if(s.type="setTempo",c!=3)throw"Expected length for setTempo event is 3, got "+c;return s.microsecondsPerBeat=t.readUInt24(),s;case 84:if(s.type="smpteOffset",c!=5)throw"Expected length for smpteOffset event is 5, got "+c;var m=t.readUInt8(),d={0:24,32:25,64:29,96:30};return s.frameRate=d[m&96],s.hour=m&31,s.min=t.readUInt8(),s.sec=t.readUInt8(),s.frame=t.readUInt8(),s.subFrame=t.readUInt8(),s;case 88:if(s.type="timeSignature",c!=2&&c!=4)throw"Expected length for timeSignature event is 4 or 2, got "+c;return s.numerator=t.readUInt8(),s.denominator=1<<t.readUInt8(),c===4?(s.metronome=t.readUInt8(),s.thirtyseconds=t.readUInt8()):(s.metronome=36,s.thirtyseconds=8),s;case 89:if(s.type="keySignature",c!=2)throw"Expected length for keySignature event is 2, got "+c;return s.key=t.readInt8(),s.scale=t.readUInt8(),s;case 127:return s.type="sequencerSpecific",s.data=t.readBytes(c),s;default:return s.type="unknownMeta",s.data=t.readBytes(c),s.metatypeByte=l,s}}else if(a==240){s.type="sysEx";var c=t.readVarInt();return s.data=t.readBytes(c),s}else if(a==247){s.type="endSysEx";var c=t.readVarInt();return s.data=t.readBytes(c),s}else throw"Unrecognised MIDI event type byte: "+a;else{var u;if(a&128)u=t.readUInt8(),i=a;else{if(i===null)throw"Running status byte encountered before status byte";u=a,a=i,s.running=!0}var f=a>>4;switch(s.channel=a&15,f){case 8:return s.type="noteOff",s.noteNumber=u,s.velocity=t.readUInt8(),s;case 9:var h=t.readUInt8();return s.type=h===0?"noteOff":"noteOn",s.noteNumber=u,s.velocity=h,h===0&&(s.byte9=!0),s;case 10:return s.type="noteAftertouch",s.noteNumber=u,s.amount=t.readUInt8(),s;case 11:return s.type="controller",s.controllerType=u,s.value=t.readUInt8(),s;case 12:return s.type="programChange",s.programNumber=u,s;case 13:return s.type="channelAftertouch",s.amount=u,s;case 14:return s.type="pitchBend",s.value=u+(t.readUInt8()<<7)-8192,s;default:throw"Unrecognised MIDI event type: "+f}}}}function X(e){this.buffer=e,this.bufferLen=this.buffer.length,this.pos=0}X.prototype.eof=function(){return this.pos>=this.bufferLen};X.prototype.readUInt8=function(){var e=this.buffer[this.pos];return this.pos+=1,e};X.prototype.readInt8=function(){var e=this.readUInt8();return e&128?e-256:e};X.prototype.readUInt16=function(){var e=this.readUInt8(),t=this.readUInt8();return(e<<8)+t};X.prototype.readInt16=function(){var e=this.readUInt16();return e&32768?e-65536:e};X.prototype.readUInt24=function(){var e=this.readUInt8(),t=this.readUInt8(),n=this.readUInt8();return(e<<16)+(t<<8)+n};X.prototype.readInt24=function(){var e=this.readUInt24();return e&8388608?e-16777216:e};X.prototype.readUInt32=function(){var e=this.readUInt8(),t=this.readUInt8(),n=this.readUInt8(),r=this.readUInt8();return(e<<24)+(t<<16)+(n<<8)+r};X.prototype.readBytes=function(e){var t=this.buffer.slice(this.pos,this.pos+e);return this.pos+=e,t};X.prototype.readString=function(e){var t=this.readBytes(e);return String.fromCharCode.apply(null,t)};X.prototype.readVarInt=function(){for(var e=0;!this.eof();){var t=this.readUInt8();if(t&128)e+=t&127,e<<=7;else return e+t}return e};X.prototype.readChunk=function(){var e=this.readString(4),t=this.readUInt32(),n=this.readBytes(t);return{id:e,length:t,data:n}};var wi=vi;function Ti(e,t){if(typeof e!="object")throw"Invalid MIDI data";t=t||{};var n=e.header||{},r=e.tracks||[],i,o=r.length,s=new H;for(xi(s,n,o),i=0;i<o;i++)Si(s,r[i],t);return s.buffer}function xi(e,t,n){var r=t.format==null?1:t.format,i=128;t.timeDivision?i=t.timeDivision:t.ticksPerFrame&&t.framesPerSecond?i=-(t.framesPerSecond&255)<<8|t.ticksPerFrame&255:t.ticksPerBeat&&(i=t.ticksPerBeat&32767);var o=new H;o.writeUInt16(r),o.writeUInt16(n),o.writeUInt16(i),e.writeChunk("MThd",o.buffer)}function Si(e,t,n){var r=new H,i,o=t.length,s=null;for(i=0;i<o;i++)(n.running===!1||!n.running&&!t[i].running)&&(s=null),s=Ii(r,t[i],s,n.useByte9ForNoteOff);e.writeChunk("MTrk",r.buffer)}function Ii(e,t,n,r){var i=t.type,o=t.deltaTime,s=t.text||"",a=t.data||[],l=null;switch(e.writeVarInt(o),i){case"sequenceNumber":e.writeUInt8(255),e.writeUInt8(0),e.writeVarInt(2),e.writeUInt16(t.number);break;case"text":e.writeUInt8(255),e.writeUInt8(1),e.writeVarInt(s.length),e.writeString(s);break;case"copyrightNotice":e.writeUInt8(255),e.writeUInt8(2),e.writeVarInt(s.length),e.writeString(s);break;case"trackName":e.writeUInt8(255),e.writeUInt8(3),e.writeVarInt(s.length),e.writeString(s);break;case"instrumentName":e.writeUInt8(255),e.writeUInt8(4),e.writeVarInt(s.length),e.writeString(s);break;case"lyrics":e.writeUInt8(255),e.writeUInt8(5),e.writeVarInt(s.length),e.writeString(s);break;case"marker":e.writeUInt8(255),e.writeUInt8(6),e.writeVarInt(s.length),e.writeString(s);break;case"cuePoint":e.writeUInt8(255),e.writeUInt8(7),e.writeVarInt(s.length),e.writeString(s);break;case"channelPrefix":e.writeUInt8(255),e.writeUInt8(32),e.writeVarInt(1),e.writeUInt8(t.channel);break;case"portPrefix":e.writeUInt8(255),e.writeUInt8(33),e.writeVarInt(1),e.writeUInt8(t.port);break;case"endOfTrack":e.writeUInt8(255),e.writeUInt8(47),e.writeVarInt(0);break;case"setTempo":e.writeUInt8(255),e.writeUInt8(81),e.writeVarInt(3),e.writeUInt24(t.microsecondsPerBeat);break;case"smpteOffset":e.writeUInt8(255),e.writeUInt8(84),e.writeVarInt(5);var c={24:0,25:32,29:64,30:96},m=t.hour&31|c[t.frameRate];e.writeUInt8(m),e.writeUInt8(t.min),e.writeUInt8(t.sec),e.writeUInt8(t.frame),e.writeUInt8(t.subFrame);break;case"timeSignature":e.writeUInt8(255),e.writeUInt8(88),e.writeVarInt(4),e.writeUInt8(t.numerator);var d=Math.floor(Math.log(t.denominator)/Math.LN2)&255;e.writeUInt8(d),e.writeUInt8(t.metronome),e.writeUInt8(t.thirtyseconds||8);break;case"keySignature":e.writeUInt8(255),e.writeUInt8(89),e.writeVarInt(2),e.writeInt8(t.key),e.writeUInt8(t.scale);break;case"sequencerSpecific":e.writeUInt8(255),e.writeUInt8(127),e.writeVarInt(a.length),e.writeBytes(a);break;case"unknownMeta":t.metatypeByte!=null&&(e.writeUInt8(255),e.writeUInt8(t.metatypeByte),e.writeVarInt(a.length),e.writeBytes(a));break;case"sysEx":e.writeUInt8(240),e.writeVarInt(a.length),e.writeBytes(a);break;case"endSysEx":e.writeUInt8(247),e.writeVarInt(a.length),e.writeBytes(a);break;case"noteOff":var u=r!==!1&&t.byte9||r&&t.velocity==0?144:128;l=u|t.channel,l!==n&&e.writeUInt8(l),e.writeUInt8(t.noteNumber),e.writeUInt8(t.velocity);break;case"noteOn":l=144|t.channel,l!==n&&e.writeUInt8(l),e.writeUInt8(t.noteNumber),e.writeUInt8(t.velocity);break;case"noteAftertouch":l=160|t.channel,l!==n&&e.writeUInt8(l),e.writeUInt8(t.noteNumber),e.writeUInt8(t.amount);break;case"controller":l=176|t.channel,l!==n&&e.writeUInt8(l),e.writeUInt8(t.controllerType),e.writeUInt8(t.value);break;case"programChange":l=192|t.channel,l!==n&&e.writeUInt8(l),e.writeUInt8(t.programNumber);break;case"channelAftertouch":l=208|t.channel,l!==n&&e.writeUInt8(l),e.writeUInt8(t.amount);break;case"pitchBend":l=224|t.channel,l!==n&&e.writeUInt8(l);var f=8192+t.value,h=f&127,p=f>>7&127;e.writeUInt8(h),e.writeUInt8(p);break;default:throw"Unrecognized event type: "+i}return l}function H(){this.buffer=[]}H.prototype.writeUInt8=function(e){this.buffer.push(e&255)};H.prototype.writeInt8=H.prototype.writeUInt8;H.prototype.writeUInt16=function(e){var t=e>>8&255,n=e&255;this.writeUInt8(t),this.writeUInt8(n)};H.prototype.writeInt16=H.prototype.writeUInt16;H.prototype.writeUInt24=function(e){var t=e>>16&255,n=e>>8&255,r=e&255;this.writeUInt8(t),this.writeUInt8(n),this.writeUInt8(r)};H.prototype.writeInt24=H.prototype.writeUInt24;H.prototype.writeUInt32=function(e){var t=e>>24&255,n=e>>16&255,r=e>>8&255,i=e&255;this.writeUInt8(t),this.writeUInt8(n),this.writeUInt8(r),this.writeUInt8(i)};H.prototype.writeInt32=H.prototype.writeUInt32;H.prototype.writeBytes=function(e){this.buffer=this.buffer.concat(Array.prototype.slice.call(e,0))};H.prototype.writeString=function(e){var t,n=e.length,r=[];for(t=0;t<n;t++)r.push(e.codePointAt(t));this.writeBytes(r)};H.prototype.writeVarInt=function(e){if(e<0)throw"Cannot write negative variable-length integer";if(e<=127)this.writeUInt8(e);else{var t=e,n=[];for(n.push(t&127),t>>=7;t;){var r=t&127|128;n.push(r),t>>=7}this.writeBytes(n.reverse())}};H.prototype.writeChunk=function(e,t){this.writeString(e),this.writeUInt32(t.length),this.writeBytes(t)};var Ci=Ti;Ut.parseMidi=wi;Ut.writeMidi=Ci;var Et={},Fe={};Object.defineProperty(Fe,"__esModule",{value:!0});Fe.insert=Fe.search=void 0;function Ar(e,t,n){n===void 0&&(n="ticks");var r=0,i=e.length,o=i;if(i>0&&e[i-1][n]<=t)return i-1;for(;r<o;){var s=Math.floor(r+(o-r)/2),a=e[s],l=e[s+1];if(a[n]===t){for(var c=s;c<e.length;c++){var m=e[c];m[n]===t&&(s=c)}return s}else{if(a[n]<t&&l[n]>t)return s;a[n]>t?o=s:a[n]<t&&(r=s+1)}}return-1}Fe.search=Ar;function Oi(e,t,n){if(n===void 0&&(n="ticks"),e.length){var r=Ar(e,t[n],n);e.splice(r+1,0,t)}else e.push(t)}Fe.insert=Oi;(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.Header=e.keySignatureKeys=void 0;var t=Fe,n=new WeakMap;e.keySignatureKeys=["Cb","Gb","Db","Ab","Eb","Bb","F","C","G","D","A","E","B","F#","C#"];var r=function(){function i(o){var s=this;if(this.tempos=[],this.timeSignatures=[],this.keySignatures=[],this.meta=[],this.name="",n.set(this,480),o){n.set(this,o.header.ticksPerBeat),o.tracks.forEach(function(l){l.forEach(function(c){c.meta&&(c.type==="timeSignature"?s.timeSignatures.push({ticks:c.absoluteTime,timeSignature:[c.numerator,c.denominator]}):c.type==="setTempo"?s.tempos.push({bpm:6e7/c.microsecondsPerBeat,ticks:c.absoluteTime}):c.type==="keySignature"&&s.keySignatures.push({key:e.keySignatureKeys[c.key+7],scale:c.scale===0?"major":"minor",ticks:c.absoluteTime}))})});var a=0;o.tracks[0].forEach(function(l){a+=l.deltaTime,l.meta&&(l.type==="trackName"?s.name=l.text:(l.type==="text"||l.type==="cuePoint"||l.type==="marker"||l.type==="lyrics")&&s.meta.push({text:l.text,ticks:a,type:l.type}))}),this.update()}}return i.prototype.update=function(){var o=this,s=0,a=0;this.tempos.sort(function(l,c){return l.ticks-c.ticks}),this.tempos.forEach(function(l,c){var m=c>0?o.tempos[c-1].bpm:o.tempos[0].bpm,d=l.ticks/o.ppq-a,u=60/m*d;l.time=u+s,s=l.time,a+=d}),this.timeSignatures.sort(function(l,c){return l.ticks-c.ticks}),this.timeSignatures.forEach(function(l,c){var m=c>0?o.timeSignatures[c-1]:o.timeSignatures[0],d=(l.ticks-m.ticks)/o.ppq,u=d/m.timeSignature[0]/(m.timeSignature[1]/4);m.measures=m.measures||0,l.measures=u+m.measures})},i.prototype.ticksToSeconds=function(o){var s=(0,t.search)(this.tempos,o);if(s!==-1){var a=this.tempos[s],l=a.time,c=(o-a.ticks)/this.ppq;return l+60/a.bpm*c}else{var m=o/this.ppq;return 60/120*m}},i.prototype.ticksToMeasures=function(o){var s=(0,t.search)(this.timeSignatures,o);if(s!==-1){var a=this.timeSignatures[s],l=(o-a.ticks)/this.ppq;return a.measures+l/(a.timeSignature[0]/a.timeSignature[1])/4}else return o/this.ppq/4},Object.defineProperty(i.prototype,"ppq",{get:function(){return n.get(this)},enumerable:!1,configurable:!0}),i.prototype.secondsToTicks=function(o){var s=(0,t.search)(this.tempos,o,"time");if(s!==-1){var a=this.tempos[s],l=a.time,c=o-l,m=c/(60/a.bpm);return Math.round(a.ticks+m*this.ppq)}else{var d=o/.5;return Math.round(d*this.ppq)}},i.prototype.toJSON=function(){return{keySignatures:this.keySignatures,meta:this.meta,name:this.name,ppq:this.ppq,tempos:this.tempos.map(function(o){return{bpm:o.bpm,ticks:o.ticks}}),timeSignatures:this.timeSignatures}},i.prototype.fromJSON=function(o){this.name=o.name,this.tempos=o.tempos.map(function(s){return Object.assign({},s)}),this.timeSignatures=o.timeSignatures.map(function(s){return Object.assign({},s)}),this.keySignatures=o.keySignatures.map(function(s){return Object.assign({},s)}),this.meta=o.meta.map(function(s){return Object.assign({},s)}),n.set(this,o.ppq),this.update()},i.prototype.setTempo=function(o){this.tempos=[{bpm:o,ticks:0}],this.update()},i}();e.Header=r})(Et);var nt={},In={};(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.ControlChange=e.controlChangeIds=e.controlChangeNames=void 0,e.controlChangeNames={1:"modulationWheel",2:"breath",4:"footController",5:"portamentoTime",7:"volume",8:"balance",10:"pan",64:"sustain",65:"portamentoTime",66:"sostenuto",67:"softPedal",68:"legatoFootswitch",84:"portamentoControl"},e.controlChangeIds=Object.keys(e.controlChangeNames).reduce(function(i,o){return i[e.controlChangeNames[o]]=o,i},{});var t=new WeakMap,n=new WeakMap,r=function(){function i(o,s){t.set(this,s),n.set(this,o.controllerType),this.ticks=o.absoluteTime,this.value=o.value}return Object.defineProperty(i.prototype,"number",{get:function(){return n.get(this)},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"name",{get:function(){return e.controlChangeNames[this.number]?e.controlChangeNames[this.number]:null},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"time",{get:function(){var o=t.get(this);return o.ticksToSeconds(this.ticks)},set:function(o){var s=t.get(this);this.ticks=s.secondsToTicks(o)},enumerable:!1,configurable:!0}),i.prototype.toJSON=function(){return{number:this.number,ticks:this.ticks,time:this.time,value:this.value}},i}();e.ControlChange=r})(In);var Mt={};Object.defineProperty(Mt,"__esModule",{value:!0});Mt.createControlChanges=void 0;var dt=In;function Ni(){return new Proxy({},{get:function(e,t){if(e[t])return e[t];if(dt.controlChangeIds.hasOwnProperty(t))return e[dt.controlChangeIds[t]]},set:function(e,t,n){return dt.controlChangeIds.hasOwnProperty(t)?e[dt.controlChangeIds[t]]=n:e[t]=n,!0}})}Mt.createControlChanges=Ni;var Ft={};Object.defineProperty(Ft,"__esModule",{value:!0});Ft.PitchBend=void 0;var Jt=new WeakMap,Ei=function(){function e(t,n){Jt.set(this,n),this.ticks=t.absoluteTime,this.value=t.value}return Object.defineProperty(e.prototype,"time",{get:function(){var t=Jt.get(this);return t.ticksToSeconds(this.ticks)},set:function(t){var n=Jt.get(this);this.ticks=n.secondsToTicks(t)},enumerable:!1,configurable:!0}),e.prototype.toJSON=function(){return{ticks:this.ticks,time:this.time,value:this.value}},e}();Ft.PitchBend=Ei;var Rt={},Ee={};Object.defineProperty(Ee,"__esModule",{value:!0});Ee.DrumKitByPatchID=Ee.InstrumentFamilyByID=Ee.instrumentByPatchID=void 0;Ee.instrumentByPatchID=["acoustic grand piano","bright acoustic piano","electric grand piano","honky-tonk piano","electric piano 1","electric piano 2","harpsichord","clavi","celesta","glockenspiel","music box","vibraphone","marimba","xylophone","tubular bells","dulcimer","drawbar organ","percussive organ","rock organ","church organ","reed organ","accordion","harmonica","tango accordion","acoustic guitar (nylon)","acoustic guitar (steel)","electric guitar (jazz)","electric guitar (clean)","electric guitar (muted)","overdriven guitar","distortion guitar","guitar harmonics","acoustic bass","electric bass (finger)","electric bass (pick)","fretless bass","slap bass 1","slap bass 2","synth bass 1","synth bass 2","violin","viola","cello","contrabass","tremolo strings","pizzicato strings","orchestral harp","timpani","string ensemble 1","string ensemble 2","synthstrings 1","synthstrings 2","choir aahs","voice oohs","synth voice","orchestra hit","trumpet","trombone","tuba","muted trumpet","french horn","brass section","synthbrass 1","synthbrass 2","soprano sax","alto sax","tenor sax","baritone sax","oboe","english horn","bassoon","clarinet","piccolo","flute","recorder","pan flute","blown bottle","shakuhachi","whistle","ocarina","lead 1 (square)","lead 2 (sawtooth)","lead 3 (calliope)","lead 4 (chiff)","lead 5 (charang)","lead 6 (voice)","lead 7 (fifths)","lead 8 (bass + lead)","pad 1 (new age)","pad 2 (warm)","pad 3 (polysynth)","pad 4 (choir)","pad 5 (bowed)","pad 6 (metallic)","pad 7 (halo)","pad 8 (sweep)","fx 1 (rain)","fx 2 (soundtrack)","fx 3 (crystal)","fx 4 (atmosphere)","fx 5 (brightness)","fx 6 (goblins)","fx 7 (echoes)","fx 8 (sci-fi)","sitar","banjo","shamisen","koto","kalimba","bag pipe","fiddle","shanai","tinkle bell","agogo","steel drums","woodblock","taiko drum","melodic tom","synth drum","reverse cymbal","guitar fret noise","breath noise","seashore","bird tweet","telephone ring","helicopter","applause","gunshot"];Ee.InstrumentFamilyByID=["piano","chromatic percussion","organ","guitar","bass","strings","ensemble","brass","reed","pipe","synth lead","synth pad","synth effects","world","percussive","sound effects"];Ee.DrumKitByPatchID={0:"standard kit",8:"room kit",16:"power kit",24:"electronic kit",25:"tr-808 kit",32:"jazz kit",40:"brush kit",48:"orchestra kit",56:"sound fx kit"};Object.defineProperty(Rt,"__esModule",{value:!0});Rt.Instrument=void 0;var pt=Ee,tr=new WeakMap,Ai=function(){function e(t,n){if(this.number=0,tr.set(this,n),this.number=0,t){var r=t.find(function(i){return i.type==="programChange"});r&&(this.number=r.programNumber)}}return Object.defineProperty(e.prototype,"name",{get:function(){return this.percussion?pt.DrumKitByPatchID[this.number]:pt.instrumentByPatchID[this.number]},set:function(t){var n=pt.instrumentByPatchID.indexOf(t);n!==-1&&(this.number=n)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"family",{get:function(){return this.percussion?"drums":pt.InstrumentFamilyByID[Math.floor(this.number/8)]},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"percussion",{get:function(){var t=tr.get(this);return t.channel===9},enumerable:!1,configurable:!0}),e.prototype.toJSON=function(){return{family:this.family,number:this.number,name:this.name}},e.prototype.fromJSON=function(t){this.number=t.number},e}();Rt.Instrument=Ai;var Lt={};Object.defineProperty(Lt,"__esModule",{value:!0});Lt.Note=void 0;function Bi(e){var t=Math.floor(e/12)-1;return Br(e)+t.toString()}function Br(e){var t=["C","C#","D","D#","E","F","F#","G","G#","A","A#","B"],n=e%12;return t[n]}function Pi(e){var t=["C","C#","D","D#","E","F","F#","G","G#","A","A#","B"];return t.indexOf(e)}var Ui=function(){var e=/^([a-g]{1}(?:b|#|x|bb)?)(-?[0-9]+)/i,t={cbb:-2,cb:-1,c:0,"c#":1,cx:2,dbb:0,db:1,d:2,"d#":3,dx:4,ebb:2,eb:3,e:4,"e#":5,ex:6,fbb:3,fb:4,f:5,"f#":6,fx:7,gbb:5,gb:6,g:7,"g#":8,gx:9,abb:7,ab:8,a:9,"a#":10,ax:11,bbb:9,bb:10,b:11,"b#":12,bx:13};return function(n){var r=e.exec(n),i=r[1],o=r[2],s=t[i.toLowerCase()];return s+(parseInt(o,10)+1)*12}}(),je=new WeakMap,Mi=function(){function e(t,n,r){je.set(this,r),this.midi=t.midi,this.velocity=t.velocity,this.noteOffVelocity=n.velocity,this.ticks=t.ticks,this.durationTicks=n.ticks-t.ticks}return Object.defineProperty(e.prototype,"name",{get:function(){return Bi(this.midi)},set:function(t){this.midi=Ui(t)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"octave",{get:function(){return Math.floor(this.midi/12)-1},set:function(t){var n=t-this.octave;this.midi+=n*12},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"pitch",{get:function(){return Br(this.midi)},set:function(t){this.midi=12*(this.octave+1)+Pi(t)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"duration",{get:function(){var t=je.get(this);return t.ticksToSeconds(this.ticks+this.durationTicks)-t.ticksToSeconds(this.ticks)},set:function(t){var n=je.get(this),r=n.secondsToTicks(this.time+t);this.durationTicks=r-this.ticks},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"time",{get:function(){var t=je.get(this);return t.ticksToSeconds(this.ticks)},set:function(t){var n=je.get(this);this.ticks=n.secondsToTicks(t)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"bars",{get:function(){var t=je.get(this);return t.ticksToMeasures(this.ticks)},enumerable:!1,configurable:!0}),e.prototype.toJSON=function(){return{duration:this.duration,durationTicks:this.durationTicks,midi:this.midi,name:this.name,ticks:this.ticks,time:this.time,velocity:this.velocity}},e}();Lt.Note=Mi;Object.defineProperty(nt,"__esModule",{value:!0});nt.Track=void 0;var Gt=Fe,Fi=In,Ri=Mt,Li=Ft,nr=Rt,Di=Lt,mt=new WeakMap,qi=function(){function e(t,n){var r=this;if(this.name="",this.notes=[],this.controlChanges=(0,Ri.createControlChanges)(),this.pitchBends=[],mt.set(this,n),t){var i=t.find(function(u){return u.type==="trackName"});this.name=i?i.text:""}if(this.instrument=new nr.Instrument(t,this),this.channel=0,t){for(var o=t.filter(function(u){return u.type==="noteOn"}),s=t.filter(function(u){return u.type==="noteOff"}),a=function(){var u=o.shift();l.channel=u.channel;var f=s.findIndex(function(p){return p.noteNumber===u.noteNumber&&p.absoluteTime>=u.absoluteTime});if(f!==-1){var h=s.splice(f,1)[0];l.addNote({durationTicks:h.absoluteTime-u.absoluteTime,midi:u.noteNumber,noteOffVelocity:h.velocity/127,ticks:u.absoluteTime,velocity:u.velocity/127})}},l=this;o.length;)a();var c=t.filter(function(u){return u.type==="controller"});c.forEach(function(u){r.addCC({number:u.controllerType,ticks:u.absoluteTime,value:u.value/127})});var m=t.filter(function(u){return u.type==="pitchBend"});m.forEach(function(u){r.addPitchBend({ticks:u.absoluteTime,value:u.value/Math.pow(2,13)})});var d=t.find(function(u){return u.type==="endOfTrack"});this.endOfTrackTicks=d!==void 0?d.absoluteTime:void 0}}return e.prototype.addNote=function(t){var n=mt.get(this),r=new Di.Note({midi:0,ticks:0,velocity:1},{ticks:0,velocity:0},n);return Object.assign(r,t),(0,Gt.insert)(this.notes,r,"ticks"),this},e.prototype.addCC=function(t){var n=mt.get(this),r=new Fi.ControlChange({controllerType:t.number},n);return delete t.number,Object.assign(r,t),Array.isArray(this.controlChanges[r.number])||(this.controlChanges[r.number]=[]),(0,Gt.insert)(this.controlChanges[r.number],r,"ticks"),this},e.prototype.addPitchBend=function(t){var n=mt.get(this),r=new Li.PitchBend({},n);return Object.assign(r,t),(0,Gt.insert)(this.pitchBends,r,"ticks"),this},Object.defineProperty(e.prototype,"duration",{get:function(){if(!this.notes.length)return 0;for(var t=this.notes[this.notes.length-1].time+this.notes[this.notes.length-1].duration,n=0;n<this.notes.length-1;n++){var r=this.notes[n].time+this.notes[n].duration;t<r&&(t=r)}return t},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"durationTicks",{get:function(){if(!this.notes.length)return 0;for(var t=this.notes[this.notes.length-1].ticks+this.notes[this.notes.length-1].durationTicks,n=0;n<this.notes.length-1;n++){var r=this.notes[n].ticks+this.notes[n].durationTicks;t<r&&(t=r)}return t},enumerable:!1,configurable:!0}),e.prototype.fromJSON=function(t){var n=this;this.name=t.name,this.channel=t.channel,this.instrument=new nr.Instrument(void 0,this),this.instrument.fromJSON(t.instrument),t.endOfTrackTicks!==void 0&&(this.endOfTrackTicks=t.endOfTrackTicks);for(var r in t.controlChanges)t.controlChanges[r]&&t.controlChanges[r].forEach(function(i){n.addCC({number:i.number,ticks:i.ticks,value:i.value})});t.notes.forEach(function(i){n.addNote({durationTicks:i.durationTicks,midi:i.midi,ticks:i.ticks,velocity:i.velocity})})},e.prototype.toJSON=function(){for(var t={},n=0;n<127;n++)this.controlChanges.hasOwnProperty(n)&&(t[n]=this.controlChanges[n].map(function(i){return i.toJSON()}));var r={channel:this.channel,controlChanges:t,pitchBends:this.pitchBends.map(function(i){return i.toJSON()}),instrument:this.instrument.toJSON(),name:this.name,notes:this.notes.map(function(i){return i.toJSON()})};return this.endOfTrackTicks!==void 0&&(r.endOfTrackTicks=this.endOfTrackTicks),r},e}();nt.Track=qi;var Dt={};function Vi(e){var t=[];return Pr(e,t),t}function Pr(e,t){for(var n=0;n<e.length;n++){var r=e[n];Array.isArray(r)?Pr(r,t):t.push(r)}}const ji=Object.freeze(Object.defineProperty({__proto__:null,flatten:Vi},Symbol.toStringTag,{value:"Module"})),$i=Nr(ji);var Ce=Ke&&Ke.__spreadArray||function(e,t,n){if(n||arguments.length===2)for(var r=0,i=t.length,o;r<i;r++)(o||!(r in t))&&(o||(o=Array.prototype.slice.call(t,0,r)),o[r]=t[r]);return e.concat(o||Array.prototype.slice.call(t))};Object.defineProperty(Dt,"__esModule",{value:!0});Dt.encode=void 0;var Ki=Ut,Hi=Et,zi=$i;function Ji(e,t){return[{absoluteTime:e.ticks,channel:t,deltaTime:0,noteNumber:e.midi,type:"noteOn",velocity:Math.floor(e.velocity*127)},{absoluteTime:e.ticks+e.durationTicks,channel:t,deltaTime:0,noteNumber:e.midi,type:"noteOff",velocity:Math.floor(e.noteOffVelocity*127)}]}function Gi(e){return(0,zi.flatten)(e.notes.map(function(t){return Ji(t,e.channel)}))}function Wi(e,t){return{absoluteTime:e.ticks,channel:t,controllerType:e.number,deltaTime:0,type:"controller",value:Math.floor(e.value*127)}}function Yi(e){for(var t=[],n=0;n<127;n++)e.controlChanges.hasOwnProperty(n)&&e.controlChanges[n].forEach(function(r){t.push(Wi(r,e.channel))});return t}function Xi(e,t){return{absoluteTime:e.ticks,channel:t,deltaTime:0,type:"pitchBend",value:e.value}}function Qi(e){var t=[];return e.pitchBends.forEach(function(n){t.push(Xi(n,e.channel))}),t}function Zi(e){return{absoluteTime:0,channel:e.channel,deltaTime:0,programNumber:e.instrument.number,type:"programChange"}}function es(e){return{absoluteTime:0,deltaTime:0,meta:!0,text:e,type:"trackName"}}function ts(e){return{absoluteTime:e.ticks,deltaTime:0,meta:!0,microsecondsPerBeat:Math.floor(6e7/e.bpm),type:"setTempo"}}function ns(e){return{absoluteTime:e.ticks,deltaTime:0,denominator:e.timeSignature[1],meta:!0,metronome:24,numerator:e.timeSignature[0],thirtyseconds:8,type:"timeSignature"}}function rs(e){var t=Hi.keySignatureKeys.indexOf(e.key);return{absoluteTime:e.ticks,deltaTime:0,key:t+7,meta:!0,scale:e.scale==="major"?0:1,type:"keySignature"}}function is(e){return{absoluteTime:e.ticks,deltaTime:0,meta:!0,text:e.text,type:e.type}}function ss(e){var t={header:{format:1,numTracks:e.tracks.length+1,ticksPerBeat:e.header.ppq},tracks:Ce([Ce(Ce(Ce(Ce([{absoluteTime:0,deltaTime:0,meta:!0,text:e.header.name,type:"trackName"}],e.header.keySignatures.map(function(n){return rs(n)}),!0),e.header.meta.map(function(n){return is(n)}),!0),e.header.tempos.map(function(n){return ts(n)}),!0),e.header.timeSignatures.map(function(n){return ns(n)}),!0)],e.tracks.map(function(n){return Ce(Ce(Ce([es(n.name),Zi(n)],Gi(n),!0),Yi(n),!0),Qi(n),!0)}),!0)};return t.tracks=t.tracks.map(function(n){n=n.sort(function(i,o){return i.absoluteTime-o.absoluteTime});var r=0;return n.forEach(function(i){i.deltaTime=i.absoluteTime-r,r=i.absoluteTime,delete i.absoluteTime}),n.push({deltaTime:0,meta:!0,type:"endOfTrack"}),n}),new Uint8Array((0,Ki.writeMidi)(t))}Dt.encode=ss;(function(e){var t=Ke&&Ke.__awaiter||function(d,u,f,h){function p(y){return y instanceof f?y:new f(function(I){I(y)})}return new(f||(f=Promise))(function(y,I){function D(N){try{w(h.next(N))}catch($){I($)}}function F(N){try{w(h.throw(N))}catch($){I($)}}function w(N){N.done?y(N.value):p(N.value).then(D,F)}w((h=h.apply(d,u||[])).next())})},n=Ke&&Ke.__generator||function(d,u){var f={label:0,sent:function(){if(y[0]&1)throw y[1];return y[1]},trys:[],ops:[]},h,p,y,I;return I={next:D(0),throw:D(1),return:D(2)},typeof Symbol=="function"&&(I[Symbol.iterator]=function(){return this}),I;function D(w){return function(N){return F([w,N])}}function F(w){if(h)throw new TypeError("Generator is already executing.");for(;f;)try{if(h=1,p&&(y=w[0]&2?p.return:w[0]?p.throw||((y=p.return)&&y.call(p),0):p.next)&&!(y=y.call(p,w[1])).done)return y;switch(p=0,y&&(w=[w[0]&2,y.value]),w[0]){case 0:case 1:y=w;break;case 4:return f.label++,{value:w[1],done:!1};case 5:f.label++,p=w[1],w=[0];continue;case 7:w=f.ops.pop(),f.trys.pop();continue;default:if(y=f.trys,!(y=y.length>0&&y[y.length-1])&&(w[0]===6||w[0]===2)){f=0;continue}if(w[0]===3&&(!y||w[1]>y[0]&&w[1]<y[3])){f.label=w[1];break}if(w[0]===6&&f.label<y[1]){f.label=y[1],y=w;break}if(y&&f.label<y[2]){f.label=y[2],f.ops.push(w);break}y[2]&&f.ops.pop(),f.trys.pop();continue}w=u.call(d,f)}catch(N){w=[6,N],p=0}finally{h=y=0}if(w[0]&5)throw w[1];return{value:w[0]?w[1]:void 0,done:!0}}};Object.defineProperty(e,"__esModule",{value:!0}),e.Header=e.Track=e.Midi=void 0;var r=Ut,i=Et,o=nt,s=Dt,a=function(){function d(u){var f=this,h=null;if(u){var p=u instanceof ArrayBuffer?new Uint8Array(u):u;h=(0,r.parseMidi)(p),h.tracks.forEach(function(y){var I=0;y.forEach(function(D){I+=D.deltaTime,D.absoluteTime=I})}),h.tracks=m(h.tracks)}this.header=new i.Header(h),this.tracks=[],u&&(this.tracks=h.tracks.map(function(y){return new o.Track(y,f.header)}),h.header.format===1&&this.tracks[0].duration===0&&this.tracks.shift())}return d.fromUrl=function(u){return t(this,void 0,void 0,function(){var f,h;return n(this,function(p){switch(p.label){case 0:return[4,fetch(u)];case 1:return f=p.sent(),f.ok?[4,f.arrayBuffer()]:[3,3];case 2:return h=p.sent(),[2,new d(h)];case 3:throw new Error("Could not load '".concat(u,"'"))}})})},Object.defineProperty(d.prototype,"name",{get:function(){return this.header.name},set:function(u){this.header.name=u},enumerable:!1,configurable:!0}),Object.defineProperty(d.prototype,"duration",{get:function(){var u=this.tracks.map(function(f){return f.duration});return Math.max.apply(Math,u)},enumerable:!1,configurable:!0}),Object.defineProperty(d.prototype,"durationTicks",{get:function(){var u=this.tracks.map(function(f){return f.durationTicks});return Math.max.apply(Math,u)},enumerable:!1,configurable:!0}),d.prototype.addTrack=function(){var u=new o.Track(void 0,this.header);return this.tracks.push(u),u},d.prototype.toArray=function(){return(0,s.encode)(this)},d.prototype.toJSON=function(){return{header:this.header.toJSON(),tracks:this.tracks.map(function(u){return u.toJSON()})}},d.prototype.fromJSON=function(u){var f=this;this.header=new i.Header,this.header.fromJSON(u.header),this.tracks=u.tracks.map(function(h){var p=new o.Track(void 0,f.header);return p.fromJSON(h),p})},d.prototype.clone=function(){var u=new d;return u.fromJSON(this.toJSON()),u},d}();e.Midi=a;var l=nt;Object.defineProperty(e,"Track",{enumerable:!0,get:function(){return l.Track}});var c=Et;Object.defineProperty(e,"Header",{enumerable:!0,get:function(){return c.Header}});function m(d){for(var u=[],f=0;f<d.length;f++)for(var h=u.length,p=new Map,y=Array(16).fill(0),I=0,D=d[f];I<D.length;I++){var F=D[I],w=h,N=F.channel;if(N!==void 0){F.type==="programChange"&&(y[N]=F.programNumber);var $=y[N],T="".concat($," ").concat(N);p.has(T)?w=p.get(T):(w=h+p.size,p.set(T,w))}u[w]||u.push([]),u[w].push(F)}return u}})(Er);const Xe=["C","C#","D","D#","E","F","F#","G","G#","A","A#","B"],rr={Backquote:"A#2",Tab:"B2",KeyQ:"C3",Digit2:"C#3",KeyW:"D3",Digit3:"D#3",KeyE:"E3",KeyR:"F3",Digit5:"F#3",KeyT:"G3",Digit6:"G#3",KeyY:"A3",Digit7:"A#3",KeyU:"B3",KeyI:"C4",Digit9:"C#4",KeyO:"D4",Digit0:"D#4",KeyP:"E4",BracketLeft:"F4",Equal:"F#4",BracketRight:"G4",Backspace:"G#4",Backslash:"A4",CapsLock:"A#4",ShiftLeft:"B4",KeyZ:"C5",KeyS:"C#5",KeyX:"D5",KeyD:"D#5",KeyC:"E5",KeyV:"F5",KeyG:"F#5",KeyB:"G5",KeyH:"G#5",KeyN:"A5",KeyJ:"A#5",KeyM:"B5",Comma:"C6",KeyL:"C#6",Period:"D6",Semicolon:"D#6",Slash:"E6",ShiftRight:"F6",Enter:"F#6"};function cn(e){return parseInt(e.charAt(e.length-1))}function un(e){return e.substring(0,e.length-1)}function Wt(e){const t=Math.floor(e/12)-1;return Xe[e%12]+t}function os(e,t){const n=cn(t),r=cn(e),i=Xe.indexOf(un(e)),o=Xe.indexOf(un(t)),s={};let a=0;for(let l=r;l<=n;l++){let c=l===r?i:0;for(;c<Xe.length&&!(l===n&&c>o);){const d=Xe[c],u=d.length===1;s[d+l]={isWhite:u,pressedColor:null,isGhost:!1},u&&a++,c++}}return{noteMap:s,whiteKeys:a}}const ae=te(!1),Me=te(0),kt=te(0),ln=te(),wt=te(1);async function as(e,t){let n=[],r=null,i,o=[];function s(d){r=new Er.Midi(d),r.tracks=r.tracks.filter(f=>f.notes.length!==0);let u=0;r.tracks.forEach(f=>{const h=f.notes[f.notes.length-1],p=h.time+h.duration;p>u&&(u=p)}),kt.set(u)}ln.subscribe(d=>{if(ae.set(!1),kt.set(0),Me.set(0),!d){r=null;return}const u=new FileReader;u.onload=()=>s(u.result),u.readAsArrayBuffer(d)});function a(d){const u=pe(Me)+d;Me.set(u),o.forEach((f,h)=>{u>f.time+f.duration&&(t(f.name),us(o,h))}),r.tracks.forEach((f,h)=>{for(;;){const p=f.notes[n[h]];if(!p||u<p.time)break;e(p.name,p.velocity),o.push(p),n[h]++}}),u>pe(kt)&&ae.set(!1)}ae.subscribe(d=>{if(!d){clearInterval(i),o=[];return}if(!r)return ae.set(!1),alert("No MIDI file selected!");r.tracks.forEach((h,p)=>{const y=pe(Me),I=cs(h.notes,D=>D.time-y);n[p]=I});let u=performance.now();function f(){const h=performance.now(),p=h-u;u=h,a(p/1e3*pe(wt))}i=setInterval(f,10)});function l(d){const[u,f,h]=d.data;u>143&&u<160?h==0?t(Wt(f)):e(Wt(f),h/127):u>127&&u<144&&t(Wt(f))}const c=await navigator.requestMIDIAccess();function m(){c.inputs.forEach(d=>{d.onmidimessage=l})}m(),c.onstatechange=()=>{m()}}function cs(e,t){let n=0,r=e.length-1;for(;n!=r;){const i=Math.ceil((n+r)/2);t(e[i])>0?r=i-1:n=i}return r}function us(e,t){e[t]=e[e.length-1],e.pop()}const ye=Object.create(null);ye.open="0";ye.close="1";ye.ping="2";ye.pong="3";ye.message="4";ye.upgrade="5";ye.noop="6";const Tt=Object.create(null);Object.keys(ye).forEach(e=>{Tt[ye[e]]=e});const ls={type:"error",data:"parser error"},fs=typeof Blob=="function"||typeof Blob<"u"&&Object.prototype.toString.call(Blob)==="[object BlobConstructor]",hs=typeof ArrayBuffer=="function",ds=e=>typeof ArrayBuffer.isView=="function"?ArrayBuffer.isView(e):e&&e.buffer instanceof ArrayBuffer,Ur=({type:e,data:t},n,r)=>fs&&t instanceof Blob?n?r(t):ir(t,r):hs&&(t instanceof ArrayBuffer||ds(t))?n?r(t):ir(new Blob([t]),r):r(ye[e]+(t||"")),ir=(e,t)=>{const n=new FileReader;return n.onload=function(){const r=n.result.split(",")[1];t("b"+r)},n.readAsDataURL(e)},sr="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",Qe=typeof Uint8Array>"u"?[]:new Uint8Array(256);for(let e=0;e<sr.length;e++)Qe[sr.charCodeAt(e)]=e;const ps=e=>{let t=e.length*.75,n=e.length,r,i=0,o,s,a,l;e[e.length-1]==="="&&(t--,e[e.length-2]==="="&&t--);const c=new ArrayBuffer(t),m=new Uint8Array(c);for(r=0;r<n;r+=4)o=Qe[e.charCodeAt(r)],s=Qe[e.charCodeAt(r+1)],a=Qe[e.charCodeAt(r+2)],l=Qe[e.charCodeAt(r+3)],m[i++]=o<<2|s>>4,m[i++]=(s&15)<<4|a>>2,m[i++]=(a&3)<<6|l&63;return c},ms=typeof ArrayBuffer=="function",Mr=(e,t)=>{if(typeof e!="string")return{type:"message",data:Fr(e,t)};const n=e.charAt(0);return n==="b"?{type:"message",data:ys(e.substring(1),t)}:Tt[n]?e.length>1?{type:Tt[n],data:e.substring(1)}:{type:Tt[n]}:ls},ys=(e,t)=>{if(ms){const n=ps(e);return Fr(n,t)}else return{base64:!0,data:e}},Fr=(e,t)=>{switch(t){case"blob":return e instanceof ArrayBuffer?new Blob([e]):e;case"arraybuffer":default:return e}},Rr=String.fromCharCode(30),gs=(e,t)=>{const n=e.length,r=new Array(n);let i=0;e.forEach((o,s)=>{Ur(o,!1,a=>{r[s]=a,++i===n&&t(r.join(Rr))})})},bs=(e,t)=>{const n=e.split(Rr),r=[];for(let i=0;i<n.length;i++){const o=Mr(n[i],t);if(r.push(o),o.type==="error")break}return r},Lr=4;function K(e){if(e)return vs(e)}function vs(e){for(var t in K.prototype)e[t]=K.prototype[t];return e}K.prototype.on=K.prototype.addEventListener=function(e,t){return this._callbacks=this._callbacks||{},(this._callbacks["$"+e]=this._callbacks["$"+e]||[]).push(t),this};K.prototype.once=function(e,t){function n(){this.off(e,n),t.apply(this,arguments)}return n.fn=t,this.on(e,n),this};K.prototype.off=K.prototype.removeListener=K.prototype.removeAllListeners=K.prototype.removeEventListener=function(e,t){if(this._callbacks=this._callbacks||{},arguments.length==0)return this._callbacks={},this;var n=this._callbacks["$"+e];if(!n)return this;if(arguments.length==1)return delete this._callbacks["$"+e],this;for(var r,i=0;i<n.length;i++)if(r=n[i],r===t||r.fn===t){n.splice(i,1);break}return n.length===0&&delete this._callbacks["$"+e],this};K.prototype.emit=function(e){this._callbacks=this._callbacks||{};for(var t=new Array(arguments.length-1),n=this._callbacks["$"+e],r=1;r<arguments.length;r++)t[r-1]=arguments[r];if(n){n=n.slice(0);for(var r=0,i=n.length;r<i;++r)n[r].apply(this,t)}return this};K.prototype.emitReserved=K.prototype.emit;K.prototype.listeners=function(e){return this._callbacks=this._callbacks||{},this._callbacks["$"+e]||[]};K.prototype.hasListeners=function(e){return!!this.listeners(e).length};const Ne=(()=>typeof self<"u"?self:typeof window<"u"?window:Function("return this")())();function Dr(e,...t){return t.reduce((n,r)=>(e.hasOwnProperty(r)&&(n[r]=e[r]),n),{})}const _s=setTimeout,ks=clearTimeout;function qt(e,t){t.useNativeTimers?(e.setTimeoutFn=_s.bind(Ne),e.clearTimeoutFn=ks.bind(Ne)):(e.setTimeoutFn=setTimeout.bind(Ne),e.clearTimeoutFn=clearTimeout.bind(Ne))}const ws=1.33;function Ts(e){return typeof e=="string"?xs(e):Math.ceil((e.byteLength||e.size)*ws)}function xs(e){let t=0,n=0;for(let r=0,i=e.length;r<i;r++)t=e.charCodeAt(r),t<128?n+=1:t<2048?n+=2:t<55296||t>=57344?n+=3:(r++,n+=4);return n}class Ss extends Error{constructor(t,n,r){super(t),this.description=n,this.context=r,this.type="TransportError"}}class qr extends K{constructor(t){super(),this.writable=!1,qt(this,t),this.opts=t,this.query=t.query,this.readyState="",this.socket=t.socket}onError(t,n,r){return super.emitReserved("error",new Ss(t,n,r)),this}open(){return(this.readyState==="closed"||this.readyState==="")&&(this.readyState="opening",this.doOpen()),this}close(){return(this.readyState==="opening"||this.readyState==="open")&&(this.doClose(),this.onClose()),this}send(t){this.readyState==="open"&&this.write(t)}onOpen(){this.readyState="open",this.writable=!0,super.emitReserved("open")}onData(t){const n=Mr(t,this.socket.binaryType);this.onPacket(n)}onPacket(t){super.emitReserved("packet",t)}onClose(t){this.readyState="closed",super.emitReserved("close",t)}}const Vr="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz-_".split(""),fn=64,Is={};let or=0,yt=0,ar;function cr(e){let t="";do t=Vr[e%fn]+t,e=Math.floor(e/fn);while(e>0);return t}function jr(){const e=cr(+new Date);return e!==ar?(or=0,ar=e):e+"."+cr(or++)}for(;yt<fn;yt++)Is[Vr[yt]]=yt;function $r(e){let t="";for(let n in e)e.hasOwnProperty(n)&&(t.length&&(t+="&"),t+=encodeURIComponent(n)+"="+encodeURIComponent(e[n]));return t}function Cs(e){let t={},n=e.split("&");for(let r=0,i=n.length;r<i;r++){let o=n[r].split("=");t[decodeURIComponent(o[0])]=decodeURIComponent(o[1])}return t}let Kr=!1;try{Kr=typeof XMLHttpRequest<"u"&&"withCredentials"in new XMLHttpRequest}catch{}const Os=Kr;function Hr(e){const t=e.xdomain;try{if(typeof XMLHttpRequest<"u"&&(!t||Os))return new XMLHttpRequest}catch{}if(!t)try{return new Ne[["Active"].concat("Object").join("X")]("Microsoft.XMLHTTP")}catch{}}function Ns(){}const Es=function(){return new Hr({xdomain:!1}).responseType!=null}();class As extends qr{constructor(t){if(super(t),this.polling=!1,typeof location<"u"){const r=location.protocol==="https:";let i=location.port;i||(i=r?"443":"80"),this.xd=typeof location<"u"&&t.hostname!==location.hostname||i!==t.port,this.xs=t.secure!==r}const n=t&&t.forceBase64;this.supportsBinary=Es&&!n}get name(){return"polling"}doOpen(){this.poll()}pause(t){this.readyState="pausing";const n=()=>{this.readyState="paused",t()};if(this.polling||!this.writable){let r=0;this.polling&&(r++,this.once("pollComplete",function(){--r||n()})),this.writable||(r++,this.once("drain",function(){--r||n()}))}else n()}poll(){this.polling=!0,this.doPoll(),this.emitReserved("poll")}onData(t){const n=r=>{if(this.readyState==="opening"&&r.type==="open"&&this.onOpen(),r.type==="close")return this.onClose({description:"transport closed by the server"}),!1;this.onPacket(r)};bs(t,this.socket.binaryType).forEach(n),this.readyState!=="closed"&&(this.polling=!1,this.emitReserved("pollComplete"),this.readyState==="open"&&this.poll())}doClose(){const t=()=>{this.write([{type:"close"}])};this.readyState==="open"?t():this.once("open",t)}write(t){this.writable=!1,gs(t,n=>{this.doWrite(n,()=>{this.writable=!0,this.emitReserved("drain")})})}uri(){let t=this.query||{};const n=this.opts.secure?"https":"http";let r="";this.opts.timestampRequests!==!1&&(t[this.opts.timestampParam]=jr()),!this.supportsBinary&&!t.sid&&(t.b64=1),this.opts.port&&(n==="https"&&Number(this.opts.port)!==443||n==="http"&&Number(this.opts.port)!==80)&&(r=":"+this.opts.port);const i=$r(t),o=this.opts.hostname.indexOf(":")!==-1;return n+"://"+(o?"["+this.opts.hostname+"]":this.opts.hostname)+r+this.opts.path+(i.length?"?"+i:"")}request(t={}){return Object.assign(t,{xd:this.xd,xs:this.xs},this.opts),new me(this.uri(),t)}doWrite(t,n){const r=this.request({method:"POST",data:t});r.on("success",n),r.on("error",(i,o)=>{this.onError("xhr post error",i,o)})}doPoll(){const t=this.request();t.on("data",this.onData.bind(this)),t.on("error",(n,r)=>{this.onError("xhr poll error",n,r)}),this.pollXhr=t}}class me extends K{constructor(t,n){super(),qt(this,n),this.opts=n,this.method=n.method||"GET",this.uri=t,this.async=n.async!==!1,this.data=n.data!==void 0?n.data:null,this.create()}create(){const t=Dr(this.opts,"agent","pfx","key","passphrase","cert","ca","ciphers","rejectUnauthorized","autoUnref");t.xdomain=!!this.opts.xd,t.xscheme=!!this.opts.xs;const n=this.xhr=new Hr(t);try{n.open(this.method,this.uri,this.async);try{if(this.opts.extraHeaders){n.setDisableHeaderCheck&&n.setDisableHeaderCheck(!0);for(let r in this.opts.extraHeaders)this.opts.extraHeaders.hasOwnProperty(r)&&n.setRequestHeader(r,this.opts.extraHeaders[r])}}catch{}if(this.method==="POST")try{n.setRequestHeader("Content-type","text/plain;charset=UTF-8")}catch{}try{n.setRequestHeader("Accept","*/*")}catch{}"withCredentials"in n&&(n.withCredentials=this.opts.withCredentials),this.opts.requestTimeout&&(n.timeout=this.opts.requestTimeout),n.onreadystatechange=()=>{n.readyState===4&&(n.status===200||n.status===1223?this.onLoad():this.setTimeoutFn(()=>{this.onError(typeof n.status=="number"?n.status:0)},0))},n.send(this.data)}catch(r){this.setTimeoutFn(()=>{this.onError(r)},0);return}typeof document<"u"&&(this.index=me.requestsCount++,me.requests[this.index]=this)}onError(t){this.emitReserved("error",t,this.xhr),this.cleanup(!0)}cleanup(t){if(!(typeof this.xhr>"u"||this.xhr===null)){if(this.xhr.onreadystatechange=Ns,t)try{this.xhr.abort()}catch{}typeof document<"u"&&delete me.requests[this.index],this.xhr=null}}onLoad(){const t=this.xhr.responseText;t!==null&&(this.emitReserved("data",t),this.emitReserved("success"),this.cleanup())}abort(){this.cleanup()}}me.requestsCount=0;me.requests={};if(typeof document<"u"){if(typeof attachEvent=="function")attachEvent("onunload",ur);else if(typeof addEventListener=="function"){const e="onpagehide"in Ne?"pagehide":"unload";addEventListener(e,ur,!1)}}function ur(){for(let e in me.requests)me.requests.hasOwnProperty(e)&&me.requests[e].abort()}const zr=(()=>typeof Promise=="function"&&typeof Promise.resolve=="function"?t=>Promise.resolve().then(t):(t,n)=>n(t,0))(),gt=Ne.WebSocket||Ne.MozWebSocket,lr=!0,Bs="arraybuffer",fr=typeof navigator<"u"&&typeof navigator.product=="string"&&navigator.product.toLowerCase()==="reactnative";class Ps extends qr{constructor(t){super(t),this.supportsBinary=!t.forceBase64}get name(){return"websocket"}doOpen(){if(!this.check())return;const t=this.uri(),n=this.opts.protocols,r=fr?{}:Dr(this.opts,"agent","perMessageDeflate","pfx","key","passphrase","cert","ca","ciphers","rejectUnauthorized","localAddress","protocolVersion","origin","maxPayload","family","checkServerIdentity");this.opts.extraHeaders&&(r.headers=this.opts.extraHeaders);try{this.ws=lr&&!fr?n?new gt(t,n):new gt(t):new gt(t,n,r)}catch(i){return this.emitReserved("error",i)}this.ws.binaryType=this.socket.binaryType||Bs,this.addEventListeners()}addEventListeners(){this.ws.onopen=()=>{this.opts.autoUnref&&this.ws._socket.unref(),this.onOpen()},this.ws.onclose=t=>this.onClose({description:"websocket connection closed",context:t}),this.ws.onmessage=t=>this.onData(t.data),this.ws.onerror=t=>this.onError("websocket error",t)}write(t){this.writable=!1;for(let n=0;n<t.length;n++){const r=t[n],i=n===t.length-1;Ur(r,this.supportsBinary,o=>{const s={};try{lr&&this.ws.send(o)}catch{}i&&zr(()=>{this.writable=!0,this.emitReserved("drain")},this.setTimeoutFn)})}}doClose(){typeof this.ws<"u"&&(this.ws.close(),this.ws=null)}uri(){let t=this.query||{};const n=this.opts.secure?"wss":"ws";let r="";this.opts.port&&(n==="wss"&&Number(this.opts.port)!==443||n==="ws"&&Number(this.opts.port)!==80)&&(r=":"+this.opts.port),this.opts.timestampRequests&&(t[this.opts.timestampParam]=jr()),this.supportsBinary||(t.b64=1);const i=$r(t),o=this.opts.hostname.indexOf(":")!==-1;return n+"://"+(o?"["+this.opts.hostname+"]":this.opts.hostname)+r+this.opts.path+(i.length?"?"+i:"")}check(){return!!gt}}const Us={websocket:Ps,polling:As},Ms=/^(?:(?![^:@]+:[^:@\/]*@)(http|https|ws|wss):\/\/)?((?:(([^:@]*)(?::([^:@]*))?)?@)?((?:[a-f0-9]{0,4}:){2,7}[a-f0-9]{0,4}|[^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/,Fs=["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"];function hn(e){const t=e,n=e.indexOf("["),r=e.indexOf("]");n!=-1&&r!=-1&&(e=e.substring(0,n)+e.substring(n,r).replace(/:/g,";")+e.substring(r,e.length));let i=Ms.exec(e||""),o={},s=14;for(;s--;)o[Fs[s]]=i[s]||"";return n!=-1&&r!=-1&&(o.source=t,o.host=o.host.substring(1,o.host.length-1).replace(/;/g,":"),o.authority=o.authority.replace("[","").replace("]","").replace(/;/g,":"),o.ipv6uri=!0),o.pathNames=Rs(o,o.path),o.queryKey=Ls(o,o.query),o}function Rs(e,t){const n=/\/{2,9}/g,r=t.replace(n,"/").split("/");return(t.slice(0,1)=="/"||t.length===0)&&r.splice(0,1),t.slice(-1)=="/"&&r.splice(r.length-1,1),r}function Ls(e,t){const n={};return t.replace(/(?:^|&)([^&=]*)=?([^&]*)/g,function(r,i,o){i&&(n[i]=o)}),n}let Pe=class extends K{constructor(t,n={}){super(),t&&typeof t=="object"&&(n=t,t=null),t?(t=hn(t),n.hostname=t.host,n.secure=t.protocol==="https"||t.protocol==="wss",n.port=t.port,t.query&&(n.query=t.query)):n.host&&(n.hostname=hn(n.host).host),qt(this,n),this.secure=n.secure!=null?n.secure:typeof location<"u"&&location.protocol==="https:",n.hostname&&!n.port&&(n.port=this.secure?"443":"80"),this.hostname=n.hostname||(typeof location<"u"?location.hostname:"localhost"),this.port=n.port||(typeof location<"u"&&location.port?location.port:this.secure?"443":"80"),this.transports=n.transports||["polling","websocket"],this.readyState="",this.writeBuffer=[],this.prevBufferLen=0,this.opts=Object.assign({path:"/engine.io",agent:!1,withCredentials:!1,upgrade:!0,timestampParam:"t",rememberUpgrade:!1,rejectUnauthorized:!0,perMessageDeflate:{threshold:1024},transportOptions:{},closeOnBeforeunload:!0},n),this.opts.path=this.opts.path.replace(/\/$/,"")+"/",typeof this.opts.query=="string"&&(this.opts.query=Cs(this.opts.query)),this.id=null,this.upgrades=null,this.pingInterval=null,this.pingTimeout=null,this.pingTimeoutTimer=null,typeof addEventListener=="function"&&(this.opts.closeOnBeforeunload&&(this.beforeunloadEventListener=()=>{this.transport&&(this.transport.removeAllListeners(),this.transport.close())},addEventListener("beforeunload",this.beforeunloadEventListener,!1)),this.hostname!=="localhost"&&(this.offlineEventListener=()=>{this.onClose("transport close",{description:"network connection lost"})},addEventListener("offline",this.offlineEventListener,!1))),this.open()}createTransport(t){const n=Object.assign({},this.opts.query);n.EIO=Lr,n.transport=t,this.id&&(n.sid=this.id);const r=Object.assign({},this.opts.transportOptions[t],this.opts,{query:n,socket:this,hostname:this.hostname,secure:this.secure,port:this.port});return new Us[t](r)}open(){let t;if(this.opts.rememberUpgrade&&Pe.priorWebsocketSuccess&&this.transports.indexOf("websocket")!==-1)t="websocket";else if(this.transports.length===0){this.setTimeoutFn(()=>{this.emitReserved("error","No transports available")},0);return}else t=this.transports[0];this.readyState="opening";try{t=this.createTransport(t)}catch{this.transports.shift(),this.open();return}t.open(),this.setTransport(t)}setTransport(t){this.transport&&this.transport.removeAllListeners(),this.transport=t,t.on("drain",this.onDrain.bind(this)).on("packet",this.onPacket.bind(this)).on("error",this.onError.bind(this)).on("close",n=>this.onClose("transport close",n))}probe(t){let n=this.createTransport(t),r=!1;Pe.priorWebsocketSuccess=!1;const i=()=>{r||(n.send([{type:"ping",data:"probe"}]),n.once("packet",d=>{if(!r)if(d.type==="pong"&&d.data==="probe"){if(this.upgrading=!0,this.emitReserved("upgrading",n),!n)return;Pe.priorWebsocketSuccess=n.name==="websocket",this.transport.pause(()=>{r||this.readyState!=="closed"&&(m(),this.setTransport(n),n.send([{type:"upgrade"}]),this.emitReserved("upgrade",n),n=null,this.upgrading=!1,this.flush())})}else{const u=new Error("probe error");u.transport=n.name,this.emitReserved("upgradeError",u)}}))};function o(){r||(r=!0,m(),n.close(),n=null)}const s=d=>{const u=new Error("probe error: "+d);u.transport=n.name,o(),this.emitReserved("upgradeError",u)};function a(){s("transport closed")}function l(){s("socket closed")}function c(d){n&&d.name!==n.name&&o()}const m=()=>{n.removeListener("open",i),n.removeListener("error",s),n.removeListener("close",a),this.off("close",l),this.off("upgrading",c)};n.once("open",i),n.once("error",s),n.once("close",a),this.once("close",l),this.once("upgrading",c),n.open()}onOpen(){if(this.readyState="open",Pe.priorWebsocketSuccess=this.transport.name==="websocket",this.emitReserved("open"),this.flush(),this.readyState==="open"&&this.opts.upgrade&&this.transport.pause){let t=0;const n=this.upgrades.length;for(;t<n;t++)this.probe(this.upgrades[t])}}onPacket(t){if(this.readyState==="opening"||this.readyState==="open"||this.readyState==="closing")switch(this.emitReserved("packet",t),this.emitReserved("heartbeat"),t.type){case"open":this.onHandshake(JSON.parse(t.data));break;case"ping":this.resetPingTimeout(),this.sendPacket("pong"),this.emitReserved("ping"),this.emitReserved("pong");break;case"error":const n=new Error("server error");n.code=t.data,this.onError(n);break;case"message":this.emitReserved("data",t.data),this.emitReserved("message",t.data);break}}onHandshake(t){this.emitReserved("handshake",t),this.id=t.sid,this.transport.query.sid=t.sid,this.upgrades=this.filterUpgrades(t.upgrades),this.pingInterval=t.pingInterval,this.pingTimeout=t.pingTimeout,this.maxPayload=t.maxPayload,this.onOpen(),this.readyState!=="closed"&&this.resetPingTimeout()}resetPingTimeout(){this.clearTimeoutFn(this.pingTimeoutTimer),this.pingTimeoutTimer=this.setTimeoutFn(()=>{this.onClose("ping timeout")},this.pingInterval+this.pingTimeout),this.opts.autoUnref&&this.pingTimeoutTimer.unref()}onDrain(){this.writeBuffer.splice(0,this.prevBufferLen),this.prevBufferLen=0,this.writeBuffer.length===0?this.emitReserved("drain"):this.flush()}flush(){if(this.readyState!=="closed"&&this.transport.writable&&!this.upgrading&&this.writeBuffer.length){const t=this.getWritablePackets();this.transport.send(t),this.prevBufferLen=t.length,this.emitReserved("flush")}}getWritablePackets(){if(!(this.maxPayload&&this.transport.name==="polling"&&this.writeBuffer.length>1))return this.writeBuffer;let n=1;for(let r=0;r<this.writeBuffer.length;r++){const i=this.writeBuffer[r].data;if(i&&(n+=Ts(i)),r>0&&n>this.maxPayload)return this.writeBuffer.slice(0,r);n+=2}return this.writeBuffer}write(t,n,r){return this.sendPacket("message",t,n,r),this}send(t,n,r){return this.sendPacket("message",t,n,r),this}sendPacket(t,n,r,i){if(typeof n=="function"&&(i=n,n=void 0),typeof r=="function"&&(i=r,r=null),this.readyState==="closing"||this.readyState==="closed")return;r=r||{},r.compress=r.compress!==!1;const o={type:t,data:n,options:r};this.emitReserved("packetCreate",o),this.writeBuffer.push(o),i&&this.once("flush",i),this.flush()}close(){const t=()=>{this.onClose("forced close"),this.transport.close()},n=()=>{this.off("upgrade",n),this.off("upgradeError",n),t()},r=()=>{this.once("upgrade",n),this.once("upgradeError",n)};return(this.readyState==="opening"||this.readyState==="open")&&(this.readyState="closing",this.writeBuffer.length?this.once("drain",()=>{this.upgrading?r():t()}):this.upgrading?r():t()),this}onError(t){Pe.priorWebsocketSuccess=!1,this.emitReserved("error",t),this.onClose("transport error",t)}onClose(t,n){(this.readyState==="opening"||this.readyState==="open"||this.readyState==="closing")&&(this.clearTimeoutFn(this.pingTimeoutTimer),this.transport.removeAllListeners("close"),this.transport.close(),this.transport.removeAllListeners(),typeof removeEventListener=="function"&&(removeEventListener("beforeunload",this.beforeunloadEventListener,!1),removeEventListener("offline",this.offlineEventListener,!1)),this.readyState="closed",this.id=null,this.emitReserved("close",t,n),this.writeBuffer=[],this.prevBufferLen=0)}filterUpgrades(t){const n=[];let r=0;const i=t.length;for(;r<i;r++)~this.transports.indexOf(t[r])&&n.push(t[r]);return n}};Pe.protocol=Lr;function Ds(e,t="",n){let r=e;n=n||typeof location<"u"&&location,e==null&&(e=n.protocol+"//"+n.host),typeof e=="string"&&(e.charAt(0)==="/"&&(e.charAt(1)==="/"?e=n.protocol+e:e=n.host+e),/^(https?|wss?):\/\//.test(e)||(typeof n<"u"?e=n.protocol+"//"+e:e="https://"+e),r=hn(e)),r.port||(/^(http|ws)$/.test(r.protocol)?r.port="80":/^(http|ws)s$/.test(r.protocol)&&(r.port="443")),r.path=r.path||"/";const o=r.host.indexOf(":")!==-1?"["+r.host+"]":r.host;return r.id=r.protocol+"://"+o+":"+r.port+t,r.href=r.protocol+"://"+o+(n&&n.port===r.port?"":":"+r.port),r}const qs=typeof ArrayBuffer=="function",Vs=e=>typeof ArrayBuffer.isView=="function"?ArrayBuffer.isView(e):e.buffer instanceof ArrayBuffer,Jr=Object.prototype.toString,js=typeof Blob=="function"||typeof Blob<"u"&&Jr.call(Blob)==="[object BlobConstructor]",$s=typeof File=="function"||typeof File<"u"&&Jr.call(File)==="[object FileConstructor]";function Cn(e){return qs&&(e instanceof ArrayBuffer||Vs(e))||js&&e instanceof Blob||$s&&e instanceof File}function xt(e,t){if(!e||typeof e!="object")return!1;if(Array.isArray(e)){for(let n=0,r=e.length;n<r;n++)if(xt(e[n]))return!0;return!1}if(Cn(e))return!0;if(e.toJSON&&typeof e.toJSON=="function"&&arguments.length===1)return xt(e.toJSON(),!0);for(const n in e)if(Object.prototype.hasOwnProperty.call(e,n)&&xt(e[n]))return!0;return!1}function Ks(e){const t=[],n=e.data,r=e;return r.data=dn(n,t),r.attachments=t.length,{packet:r,buffers:t}}function dn(e,t){if(!e)return e;if(Cn(e)){const n={_placeholder:!0,num:t.length};return t.push(e),n}else if(Array.isArray(e)){const n=new Array(e.length);for(let r=0;r<e.length;r++)n[r]=dn(e[r],t);return n}else if(typeof e=="object"&&!(e instanceof Date)){const n={};for(const r in e)Object.prototype.hasOwnProperty.call(e,r)&&(n[r]=dn(e[r],t));return n}return e}function Hs(e,t){return e.data=pn(e.data,t),e.attachments=void 0,e}function pn(e,t){if(!e)return e;if(e&&e._placeholder===!0){if(typeof e.num=="number"&&e.num>=0&&e.num<t.length)return t[e.num];throw new Error("illegal attachments")}else if(Array.isArray(e))for(let n=0;n<e.length;n++)e[n]=pn(e[n],t);else if(typeof e=="object")for(const n in e)Object.prototype.hasOwnProperty.call(e,n)&&(e[n]=pn(e[n],t));return e}const zs=5;var O;(function(e){e[e.CONNECT=0]="CONNECT",e[e.DISCONNECT=1]="DISCONNECT",e[e.EVENT=2]="EVENT",e[e.ACK=3]="ACK",e[e.CONNECT_ERROR=4]="CONNECT_ERROR",e[e.BINARY_EVENT=5]="BINARY_EVENT",e[e.BINARY_ACK=6]="BINARY_ACK"})(O||(O={}));class Js{constructor(t){this.replacer=t}encode(t){return(t.type===O.EVENT||t.type===O.ACK)&&xt(t)?(t.type=t.type===O.EVENT?O.BINARY_EVENT:O.BINARY_ACK,this.encodeAsBinary(t)):[this.encodeAsString(t)]}encodeAsString(t){let n=""+t.type;return(t.type===O.BINARY_EVENT||t.type===O.BINARY_ACK)&&(n+=t.attachments+"-"),t.nsp&&t.nsp!=="/"&&(n+=t.nsp+","),t.id!=null&&(n+=t.id),t.data!=null&&(n+=JSON.stringify(t.data,this.replacer)),n}encodeAsBinary(t){const n=Ks(t),r=this.encodeAsString(n.packet),i=n.buffers;return i.unshift(r),i}}class On extends K{constructor(t){super(),this.reviver=t}add(t){let n;if(typeof t=="string"){if(this.reconstructor)throw new Error("got plaintext data when reconstructing a packet");n=this.decodeString(t),n.type===O.BINARY_EVENT||n.type===O.BINARY_ACK?(this.reconstructor=new Gs(n),n.attachments===0&&super.emitReserved("decoded",n)):super.emitReserved("decoded",n)}else if(Cn(t)||t.base64)if(this.reconstructor)n=this.reconstructor.takeBinaryData(t),n&&(this.reconstructor=null,super.emitReserved("decoded",n));else throw new Error("got binary data when not reconstructing a packet");else throw new Error("Unknown type: "+t)}decodeString(t){let n=0;const r={type:Number(t.charAt(0))};if(O[r.type]===void 0)throw new Error("unknown packet type "+r.type);if(r.type===O.BINARY_EVENT||r.type===O.BINARY_ACK){const o=n+1;for(;t.charAt(++n)!=="-"&&n!=t.length;);const s=t.substring(o,n);if(s!=Number(s)||t.charAt(n)!=="-")throw new Error("Illegal attachments");r.attachments=Number(s)}if(t.charAt(n+1)==="/"){const o=n+1;for(;++n&&!(t.charAt(n)===","||n===t.length););r.nsp=t.substring(o,n)}else r.nsp="/";const i=t.charAt(n+1);if(i!==""&&Number(i)==i){const o=n+1;for(;++n;){const s=t.charAt(n);if(s==null||Number(s)!=s){--n;break}if(n===t.length)break}r.id=Number(t.substring(o,n+1))}if(t.charAt(++n)){const o=this.tryParse(t.substr(n));if(On.isPayloadValid(r.type,o))r.data=o;else throw new Error("invalid payload")}return r}tryParse(t){try{return JSON.parse(t,this.reviver)}catch{return!1}}static isPayloadValid(t,n){switch(t){case O.CONNECT:return typeof n=="object";case O.DISCONNECT:return n===void 0;case O.CONNECT_ERROR:return typeof n=="string"||typeof n=="object";case O.EVENT:case O.BINARY_EVENT:return Array.isArray(n)&&n.length>0;case O.ACK:case O.BINARY_ACK:return Array.isArray(n)}}destroy(){this.reconstructor&&this.reconstructor.finishedReconstruction()}}class Gs{constructor(t){this.packet=t,this.buffers=[],this.reconPack=t}takeBinaryData(t){if(this.buffers.push(t),this.buffers.length===this.reconPack.attachments){const n=Hs(this.reconPack,this.buffers);return this.finishedReconstruction(),n}return null}finishedReconstruction(){this.reconPack=null,this.buffers=[]}}const Ws=Object.freeze(Object.defineProperty({__proto__:null,Decoder:On,Encoder:Js,get PacketType(){return O},protocol:zs},Symbol.toStringTag,{value:"Module"}));function ce(e,t,n){return e.on(t,n),function(){e.off(t,n)}}const Ys=Object.freeze({connect:1,connect_error:1,disconnect:1,disconnecting:1,newListener:1,removeListener:1});class Gr extends K{constructor(t,n,r){super(),this.connected=!1,this.receiveBuffer=[],this.sendBuffer=[],this.ids=0,this.acks={},this.flags={},this.io=t,this.nsp=n,r&&r.auth&&(this.auth=r.auth),this.io._autoConnect&&this.open()}get disconnected(){return!this.connected}subEvents(){if(this.subs)return;const t=this.io;this.subs=[ce(t,"open",this.onopen.bind(this)),ce(t,"packet",this.onpacket.bind(this)),ce(t,"error",this.onerror.bind(this)),ce(t,"close",this.onclose.bind(this))]}get active(){return!!this.subs}connect(){return this.connected?this:(this.subEvents(),this.io._reconnecting||this.io.open(),this.io._readyState==="open"&&this.onopen(),this)}open(){return this.connect()}send(...t){return t.unshift("message"),this.emit.apply(this,t),this}emit(t,...n){if(Ys.hasOwnProperty(t))throw new Error('"'+t.toString()+'" is a reserved event name');n.unshift(t);const r={type:O.EVENT,data:n};if(r.options={},r.options.compress=this.flags.compress!==!1,typeof n[n.length-1]=="function"){const s=this.ids++,a=n.pop();this._registerAckCallback(s,a),r.id=s}const i=this.io.engine&&this.io.engine.transport&&this.io.engine.transport.writable;return this.flags.volatile&&(!i||!this.connected)||(this.connected?(this.notifyOutgoingListeners(r),this.packet(r)):this.sendBuffer.push(r)),this.flags={},this}_registerAckCallback(t,n){const r=this.flags.timeout;if(r===void 0){this.acks[t]=n;return}const i=this.io.setTimeoutFn(()=>{delete this.acks[t];for(let o=0;o<this.sendBuffer.length;o++)this.sendBuffer[o].id===t&&this.sendBuffer.splice(o,1);n.call(this,new Error("operation has timed out"))},r);this.acks[t]=(...o)=>{this.io.clearTimeoutFn(i),n.apply(this,[null,...o])}}packet(t){t.nsp=this.nsp,this.io._packet(t)}onopen(){typeof this.auth=="function"?this.auth(t=>{this.packet({type:O.CONNECT,data:t})}):this.packet({type:O.CONNECT,data:this.auth})}onerror(t){this.connected||this.emitReserved("connect_error",t)}onclose(t,n){this.connected=!1,delete this.id,this.emitReserved("disconnect",t,n)}onpacket(t){if(t.nsp===this.nsp)switch(t.type){case O.CONNECT:if(t.data&&t.data.sid){const i=t.data.sid;this.onconnect(i)}else this.emitReserved("connect_error",new Error("It seems you are trying to reach a Socket.IO server in v2.x with a v3.x client, but they are not compatible (more information here: https://socket.io/docs/v3/migrating-from-2-x-to-3-0/)"));break;case O.EVENT:case O.BINARY_EVENT:this.onevent(t);break;case O.ACK:case O.BINARY_ACK:this.onack(t);break;case O.DISCONNECT:this.ondisconnect();break;case O.CONNECT_ERROR:this.destroy();const r=new Error(t.data.message);r.data=t.data.data,this.emitReserved("connect_error",r);break}}onevent(t){const n=t.data||[];t.id!=null&&n.push(this.ack(t.id)),this.connected?this.emitEvent(n):this.receiveBuffer.push(Object.freeze(n))}emitEvent(t){if(this._anyListeners&&this._anyListeners.length){const n=this._anyListeners.slice();for(const r of n)r.apply(this,t)}super.emit.apply(this,t)}ack(t){const n=this;let r=!1;return function(...i){r||(r=!0,n.packet({type:O.ACK,id:t,data:i}))}}onack(t){const n=this.acks[t.id];typeof n=="function"&&(n.apply(this,t.data),delete this.acks[t.id])}onconnect(t){this.id=t,this.connected=!0,this.emitBuffered(),this.emitReserved("connect")}emitBuffered(){this.receiveBuffer.forEach(t=>this.emitEvent(t)),this.receiveBuffer=[],this.sendBuffer.forEach(t=>{this.notifyOutgoingListeners(t),this.packet(t)}),this.sendBuffer=[]}ondisconnect(){this.destroy(),this.onclose("io server disconnect")}destroy(){this.subs&&(this.subs.forEach(t=>t()),this.subs=void 0),this.io._destroy(this)}disconnect(){return this.connected&&this.packet({type:O.DISCONNECT}),this.destroy(),this.connected&&this.onclose("io client disconnect"),this}close(){return this.disconnect()}compress(t){return this.flags.compress=t,this}get volatile(){return this.flags.volatile=!0,this}timeout(t){return this.flags.timeout=t,this}onAny(t){return this._anyListeners=this._anyListeners||[],this._anyListeners.push(t),this}prependAny(t){return this._anyListeners=this._anyListeners||[],this._anyListeners.unshift(t),this}offAny(t){if(!this._anyListeners)return this;if(t){const n=this._anyListeners;for(let r=0;r<n.length;r++)if(t===n[r])return n.splice(r,1),this}else this._anyListeners=[];return this}listenersAny(){return this._anyListeners||[]}onAnyOutgoing(t){return this._anyOutgoingListeners=this._anyOutgoingListeners||[],this._anyOutgoingListeners.push(t),this}prependAnyOutgoing(t){return this._anyOutgoingListeners=this._anyOutgoingListeners||[],this._anyOutgoingListeners.unshift(t),this}offAnyOutgoing(t){if(!this._anyOutgoingListeners)return this;if(t){const n=this._anyOutgoingListeners;for(let r=0;r<n.length;r++)if(t===n[r])return n.splice(r,1),this}else this._anyOutgoingListeners=[];return this}listenersAnyOutgoing(){return this._anyOutgoingListeners||[]}notifyOutgoingListeners(t){if(this._anyOutgoingListeners&&this._anyOutgoingListeners.length){const n=this._anyOutgoingListeners.slice();for(const r of n)r.apply(this,t.data)}}}function Je(e){e=e||{},this.ms=e.min||100,this.max=e.max||1e4,this.factor=e.factor||2,this.jitter=e.jitter>0&&e.jitter<=1?e.jitter:0,this.attempts=0}Je.prototype.duration=function(){var e=this.ms*Math.pow(this.factor,this.attempts++);if(this.jitter){var t=Math.random(),n=Math.floor(t*this.jitter*e);e=Math.floor(t*10)&1?e+n:e-n}return Math.min(e,this.max)|0};Je.prototype.reset=function(){this.attempts=0};Je.prototype.setMin=function(e){this.ms=e};Je.prototype.setMax=function(e){this.max=e};Je.prototype.setJitter=function(e){this.jitter=e};class mn extends K{constructor(t,n){var r;super(),this.nsps={},this.subs=[],t&&typeof t=="object"&&(n=t,t=void 0),n=n||{},n.path=n.path||"/socket.io",this.opts=n,qt(this,n),this.reconnection(n.reconnection!==!1),this.reconnectionAttempts(n.reconnectionAttempts||1/0),this.reconnectionDelay(n.reconnectionDelay||1e3),this.reconnectionDelayMax(n.reconnectionDelayMax||5e3),this.randomizationFactor((r=n.randomizationFactor)!==null&&r!==void 0?r:.5),this.backoff=new Je({min:this.reconnectionDelay(),max:this.reconnectionDelayMax(),jitter:this.randomizationFactor()}),this.timeout(n.timeout==null?2e4:n.timeout),this._readyState="closed",this.uri=t;const i=n.parser||Ws;this.encoder=new i.Encoder,this.decoder=new i.Decoder,this._autoConnect=n.autoConnect!==!1,this._autoConnect&&this.open()}reconnection(t){return arguments.length?(this._reconnection=!!t,this):this._reconnection}reconnectionAttempts(t){return t===void 0?this._reconnectionAttempts:(this._reconnectionAttempts=t,this)}reconnectionDelay(t){var n;return t===void 0?this._reconnectionDelay:(this._reconnectionDelay=t,(n=this.backoff)===null||n===void 0||n.setMin(t),this)}randomizationFactor(t){var n;return t===void 0?this._randomizationFactor:(this._randomizationFactor=t,(n=this.backoff)===null||n===void 0||n.setJitter(t),this)}reconnectionDelayMax(t){var n;return t===void 0?this._reconnectionDelayMax:(this._reconnectionDelayMax=t,(n=this.backoff)===null||n===void 0||n.setMax(t),this)}timeout(t){return arguments.length?(this._timeout=t,this):this._timeout}maybeReconnectOnOpen(){!this._reconnecting&&this._reconnection&&this.backoff.attempts===0&&this.reconnect()}open(t){if(~this._readyState.indexOf("open"))return this;this.engine=new Pe(this.uri,this.opts);const n=this.engine,r=this;this._readyState="opening",this.skipReconnect=!1;const i=ce(n,"open",function(){r.onopen(),t&&t()}),o=ce(n,"error",s=>{r.cleanup(),r._readyState="closed",this.emitReserved("error",s),t?t(s):r.maybeReconnectOnOpen()});if(this._timeout!==!1){const s=this._timeout;s===0&&i();const a=this.setTimeoutFn(()=>{i(),n.close(),n.emit("error",new Error("timeout"))},s);this.opts.autoUnref&&a.unref(),this.subs.push(function(){clearTimeout(a)})}return this.subs.push(i),this.subs.push(o),this}connect(t){return this.open(t)}onopen(){this.cleanup(),this._readyState="open",this.emitReserved("open");const t=this.engine;this.subs.push(ce(t,"ping",this.onping.bind(this)),ce(t,"data",this.ondata.bind(this)),ce(t,"error",this.onerror.bind(this)),ce(t,"close",this.onclose.bind(this)),ce(this.decoder,"decoded",this.ondecoded.bind(this)))}onping(){this.emitReserved("ping")}ondata(t){try{this.decoder.add(t)}catch(n){this.onclose("parse error",n)}}ondecoded(t){zr(()=>{this.emitReserved("packet",t)},this.setTimeoutFn)}onerror(t){this.emitReserved("error",t)}socket(t,n){let r=this.nsps[t];return r||(r=new Gr(this,t,n),this.nsps[t]=r),r}_destroy(t){const n=Object.keys(this.nsps);for(const r of n)if(this.nsps[r].active)return;this._close()}_packet(t){const n=this.encoder.encode(t);for(let r=0;r<n.length;r++)this.engine.write(n[r],t.options)}cleanup(){this.subs.forEach(t=>t()),this.subs.length=0,this.decoder.destroy()}_close(){this.skipReconnect=!0,this._reconnecting=!1,this.onclose("forced close"),this.engine&&this.engine.close()}disconnect(){return this._close()}onclose(t,n){this.cleanup(),this.backoff.reset(),this._readyState="closed",this.emitReserved("close",t,n),this._reconnection&&!this.skipReconnect&&this.reconnect()}reconnect(){if(this._reconnecting||this.skipReconnect)return this;const t=this;if(this.backoff.attempts>=this._reconnectionAttempts)this.backoff.reset(),this.emitReserved("reconnect_failed"),this._reconnecting=!1;else{const n=this.backoff.duration();this._reconnecting=!0;const r=this.setTimeoutFn(()=>{t.skipReconnect||(this.emitReserved("reconnect_attempt",t.backoff.attempts),!t.skipReconnect&&t.open(i=>{i?(t._reconnecting=!1,t.reconnect(),this.emitReserved("reconnect_error",i)):t.onreconnect()}))},n);this.opts.autoUnref&&r.unref(),this.subs.push(function(){clearTimeout(r)})}}onreconnect(){const t=this.backoff.attempts;this._reconnecting=!1,this.backoff.reset(),this.emitReserved("reconnect",t)}}const We={};function St(e,t){typeof e=="object"&&(t=e,e=void 0),t=t||{};const n=Ds(e,t.path||"/socket.io"),r=n.source,i=n.id,o=n.path,s=We[i]&&o in We[i].nsps,a=t.forceNew||t["force new connection"]||t.multiplex===!1||s;let l;return a?l=new mn(r,t):(We[i]||(We[i]=new mn(r,t)),l=We[i]),n.query&&!t.query&&(t.query=n.queryKey),l.socket(n.path,t)}Object.assign(St,{Manager:mn,Socket:Gr,io:St,connect:St});var yn={},Xs={get exports(){return yn},set exports(e){yn=e}},gn={},Qs={get exports(){return gn},set exports(e){gn=e}};function Zs(e){return e>64&&e<91?e-65:e>96&&e<123?e-71:e>47&&e<58?e+4:e===43?62:e===47?63:0}function eo(e,t){for(var n=e.replace(/[^A-Za-z0-9\+\/]/g,""),r=n.length,i=t?Math.ceil((r*3+1>>2)/t)*t:r*3+1>>2,o=new Uint8Array(i),s,a,l=0,c=0,m=0;m<r;m++)if(a=m&3,l|=Zs(n.charCodeAt(m))<<18-6*a,a===3||r-m===1){for(s=0;s<3&&c<i;s++,c++)o[c]=l>>>(16>>>s&24)&255;l=0}return o}var to={decode:eo},no=function(e,t){return new Promise(function(n,r){var i=new XMLHttpRequest;t&&(i.responseType=t),i.open("GET",e),i.onload=function(){i.status===200?n(i.response):r(Error(i.statusText))},i.onerror=function(){r(Error("Network Error"))},i.send()})};(function(e){var t=to,n=no;function r(T){return function(_){return typeof _=="string"&&T.test(_)}}function i(T,_){return typeof T=="string"?T+_:typeof T=="function"?T(_):_}function o(T,_,A,B){var ne=s(_)?a:l(_)?c:m(_)?d:u(_)?f:h(_)?p:y(_)?I:D(_)?F:w(_)?N:null,b=A||{};return ne?ne(T,_,b):B?Promise.resolve(B):Promise.reject("Source not valid ("+_+")")}o.fetch=n;function s(T){return T instanceof ArrayBuffer}function a(T,_,A){return new Promise(function(B,ne){T.decodeAudioData(_,function(b){B(b)},function(){ne("Can't decode audio data ("+_.slice(0,30)+"...)")})})}var l=r(/\.(mp3|wav|ogg)(\?.*)?$/i);function c(T,_,A){var B=i(A.from,_);return o(T,o.fetch(B,"arraybuffer"),A)}function m(T){return T&&typeof T.then=="function"}function d(T,_,A){return _.then(function(B){return o(T,B,A)})}var u=Array.isArray;function f(T,_,A){return Promise.all(_.map(function(B){return o(T,B,A,B)}))}function h(T){return T&&typeof T=="object"}function p(T,_,A){var B={},ne=Object.keys(_).map(function(b){if(A.only&&A.only.indexOf(b)===-1)return null;var S=_[b];return o(T,S,A,S).then(function(M){B[b]=M})});return Promise.all(ne).then(function(){return B})}var y=r(/\.json(\?.*)?$/i);function I(T,_,A){var B=i(A.from,_);return o(T,o.fetch(B,"text").then(JSON.parse),A)}var D=r(/^data:audio/);function F(T,_,A){var B=_.indexOf(",");return o(T,t.decode(_.slice(B+1)).buffer,A)}var w=r(/\.js(\?.*)?$/i);function N(T,_,A){var B=i(A.from,_);return o(T,o.fetch(B,"text").then($),A)}function $(T){var _=T.indexOf("MIDI.Soundfont.");if(_<0)throw Error("Invalid MIDI.js Soundfont format");_=T.indexOf("=",_)+2;var A=T.lastIndexOf(",");return JSON.parse(T.slice(_,A)+"}")}e.exports&&(e.exports=o),typeof window<"u"&&(window.loadAudio=o)})(Qs);var bn={},ro={get exports(){return bn},set exports(e){bn=e}},io=so;function so(e){var t=e.createGain(),n=t._voltage=co(e),r=$e(n),i=$e(n),o=$e(n);return t._startAmount=$e(i),t._endAmount=$e(o),t._multiplier=$e(r),t._multiplier.connect(t),t._startAmount.connect(t),t._endAmount.connect(t),t.value=r.gain,t.startValue=i.gain,t.endValue=o.gain,t.startValue.value=0,t.endValue.value=0,Object.defineProperties(t,oo),t}var oo={attack:{value:0,writable:!0},decay:{value:0,writable:!0},sustain:{value:1,writable:!0},release:{value:0,writable:!0},getReleaseDuration:{value:function(){return this.release}},start:{value:function(e){var t=this._multiplier.gain,n=this._startAmount.gain,r=this._endAmount.gain;this._voltage.start(e),this._decayFrom=this._decayFrom=e+this.attack,this._startedAt=e;var i=this.sustain;t.cancelScheduledValues(e),n.cancelScheduledValues(e),r.cancelScheduledValues(e),r.setValueAtTime(0,e),this.attack?(t.setValueAtTime(0,e),t.linearRampToValueAtTime(1,e+this.attack),n.setValueAtTime(1,e),n.linearRampToValueAtTime(0,e+this.attack)):(t.setValueAtTime(1,e),n.setValueAtTime(0,e)),this.decay&&t.setTargetAtTime(i,this._decayFrom,hr(this.decay))}},stop:{value:function(e,t){t&&(e=e-this.release);var n=e+this.release;if(this.release){var r=this._multiplier.gain,i=this._startAmount.gain,o=this._endAmount.gain;r.cancelScheduledValues(e),i.cancelScheduledValues(e),o.cancelScheduledValues(e);var s=hr(this.release);if(this.attack&&e<this._decayFrom){var a=uo(0,1,this._startedAt,this._decayFrom,e);r.linearRampToValueAtTime(a,e),i.linearRampToValueAtTime(1-a,e),i.setTargetAtTime(0,e,s)}o.setTargetAtTime(1,e,s),r.setTargetAtTime(0,e,s)}return this._voltage.stop(n),n}},onended:{get:function(){return this._voltage.onended},set:function(e){this._voltage.onended=e}}},ao=new Float32Array([1,1]);function co(e){var t=e.createBufferSource(),n=e.createBuffer(1,2,e.sampleRate);return n.getChannelData(0).set(ao),t.buffer=n,t.loop=!0,t}function $e(e){var t=e.context.createGain();return e.connect(t),t}function hr(e){return Math.log(e+1)/Math.log(100)}function uo(e,t,n,r,i){var o=t-e,s=r-n,a=i-n,l=a/s,c=e+l*o;return c<=e&&(c=e),c>=t&&(c=t),c}var lo=io,fo={},ho={gain:1,attack:.01,decay:.1,sustain:.9,release:.3,loop:!1,cents:0,loopStart:0,loopEnd:0};function po(e,t,n){var r=!1,i=0,o={},s=e.createGain();s.gain.value=1;var a=Object.assign({},ho,n),l={context:e,out:s,opts:a};return t instanceof AudioBuffer?l.buffer=t:l.buffers=t,l.start=function(d,u,f){if(l.buffer&&d!==null)return l.start(null,d,u);var h=d?l.buffers[d]:l.buffer;if(h){if(!r){console.warn("SamplePlayer not connected to any node.");return}}else{console.warn("Buffer "+d+" not found.");return}var p=f||fo;u=Math.max(e.currentTime,u||0),l.emit("start",u,d,p);var y=m(d,h,p);return y.id=c(d,y),y.env.start(u),y.source.start(u),l.emit("started",u,y.id,y),p.duration&&y.stop(u+p.duration),y},l.play=function(d,u,f){return l.start(d,u,f)},l.stop=function(d,u){var f;return u=u||Object.keys(o),u.map(function(h){return f=o[h],f?(f.stop(d),f.id):null})},l.connect=function(d){return r=!0,s.connect(d),l},l.emit=function(d,u,f,h){l.onevent&&l.onevent(d,u,f,h);var p=l["on"+d];p&&p(u,f,h)},l;function c(d,u){return u.id=i++,o[u.id]=u,u.source.onended=function(){var f=e.currentTime;u.source.disconnect(),u.env.disconnect(),u.disconnect(),l.emit("ended",f,u.id,u)},u.id}function m(d,u,f){var h=e.createGain();return h.gain.value=0,h.connect(s),h.env=yo(e,f,a),h.env.connect(h.gain),h.source=e.createBufferSource(),h.source.buffer=u,h.source.connect(h),h.source.loop=f.loop||a.loop,h.source.playbackRate.value=go(f.cents||a.cents),h.source.loopStart=f.loopStart||a.loopStart,h.source.loopEnd=f.loopEnd||a.loopEnd,h.stop=function(p){var y=p||e.currentTime;l.emit("stop",y,d);var I=h.env.stop(y);h.source.stop(I)},h}}function dr(e){return typeof e=="number"}var mo=["attack","decay","sustain","release"];function yo(e,t,n){var r=lo(e),i=t.adsr||n.adsr;return mo.forEach(function(o,s){i?r[o]=i[s]:r[o]=t[o]||n[o]}),r.value.value=dr(t.gain)?t.gain:dr(n.gain)?n.gain:1,r}function go(e){return e?Math.pow(2,e/1200):1}var bo=po,vo=function(e){return e.on=function(t,n){if(arguments.length===1&&typeof t=="function")return e.on("event",t);var r="on"+t,i=e[r];return e[r]=i?_o(i,n):n,e},e};function _o(e,t){return function(n,r,i,o){e(n,r,i,o),t(n,r,i,o)}}var Wr=/^([a-gA-G])(#{1,}|b{1,}|x{1,}|)(-?\d*)\s*(.*)\s*$/;function ko(){return Wr}var wo=[0,2,4,5,7,9,11];function Yr(e,t,n){if(typeof e!="string")return null;var r=Wr.exec(e);if(!r||!t&&r[4])return null;var i={letter:r[1].toUpperCase(),acc:r[2].replace(/x/g,"##")};return i.pc=i.letter+i.acc,i.step=(i.letter.charCodeAt(0)+3)%7,i.alt=i.acc[0]==="b"?-i.acc.length:i.acc.length,i.chroma=wo[i.step]+i.alt,r[3]&&(i.oct=+r[3],i.midi=i.chroma+12*(i.oct+1),i.freq=Xr(i.midi,n)),t&&(i.tonicOf=r[4]),i}function Xr(e,t){return Math.pow(2,(e-69)/12)*(t||440)}var Qr={parse:Yr,regex:ko,midiToFreq:Xr},To=["letter","acc","pc","step","alt","chroma","oct","midi","freq"];To.forEach(function(e){Qr[e]=function(t){var n=Yr(t);return n&&typeof n[e]<"u"?n[e]:null}});var xo=Qr,So=xo,Io=function(e){return e!==null&&e!==[]&&e>=0&&e<129},Co=function(e){return Io(e)?+e:So.midi(e)},Oo=function(e){if(e.buffers){var t=e.opts.map,n=typeof t=="function"?t:Co,r=function(o){return o?n(o)||o:null};e.buffers=No(e.buffers,r);var i=e.start;e.start=function(o,s,a){var l=r(o),c=l%1;return c&&(l=Math.floor(l),a=Object.assign(a||{},{cents:Math.floor(c*100)})),i(l,s,a)}}return e};function No(e,t){return Object.keys(e).reduce(function(n,r){return n[t(r)]=e[r],n},{})}var Eo=Array.isArray,Ao=function(e){return e&&typeof e=="object"},Bo={},Po=function(e){return e.schedule=function(t,n){var r=e.context.currentTime,i=t<r?r:t;e.emit("schedule",i,n);var o,s,a,l;return n.map(function(c){if(c)Eo(c)?(o=c[0],s=c[1]):(o=c.time,s=c);else return null;return Ao(s)?(a=s.name||s.key||s.note||s.midi||null,l=s):(a=s,l=Bo),e.start(a,i+(o||0),l)})},e};function bt(e){throw new Error('Could not dynamically require "'+e+'". Please configure the dynamicRequireTargets or/and ignoreDynamicRequires option of @rollup/plugin-commonjs appropriately for this require call to work.')}var vn={},Uo={get exports(){return vn},set exports(e){vn=e}};(function(e,t){(function(n){e.exports=n()})(function(){return function n(r,i,o){function s(c,m){if(!i[c]){if(!r[c]){var d=typeof bt=="function"&&bt;if(!m&&d)return d(c,!0);if(a)return a(c,!0);var u=new Error("Cannot find module '"+c+"'");throw u.code="MODULE_NOT_FOUND",u}var f=i[c]={exports:{}};r[c][0].call(f.exports,function(h){var p=r[c][1][h];return s(p||h)},f,f.exports,n,r,i,o)}return i[c].exports}for(var a=typeof bt=="function"&&bt,l=0;l<o.length;l++)s(o[l]);return s}({1:[function(n,r,i){Object.defineProperty(i,"__esModule",{value:!0}),i.default=function(o){function s(a){if(this._event=a,this._data=a.data,this.receivedTime=a.receivedTime,this._data&&this._data.length<2){console.warn("Illegal MIDI message of length",this._data.length);return}switch(this._messageCode=a.data[0]&240,this.channel=a.data[0]&15,this._messageCode){case 128:this.messageType="noteoff",this.key=a.data[1]&127,this.velocity=a.data[2]&127;break;case 144:this.messageType="noteon",this.key=a.data[1]&127,this.velocity=a.data[2]&127;break;case 160:this.messageType="keypressure",this.key=a.data[1]&127,this.pressure=a.data[2]&127;break;case 176:this.messageType="controlchange",this.controllerNumber=a.data[1]&127,this.controllerValue=a.data[2]&127,this.controllerNumber===120&&this.controllerValue===0?this.channelModeMessage="allsoundoff":this.controllerNumber===121?this.channelModeMessage="resetallcontrollers":this.controllerNumber===122?this.controllerValue===0?this.channelModeMessage="localcontroloff":this.channelModeMessage="localcontrolon":this.controllerNumber===123&&this.controllerValue===0?this.channelModeMessage="allnotesoff":this.controllerNumber===124&&this.controllerValue===0?this.channelModeMessage="omnimodeoff":this.controllerNumber===125&&this.controllerValue===0?this.channelModeMessage="omnimodeon":this.controllerNumber===126?this.channelModeMessage="monomodeon":this.controllerNumber===127&&(this.channelModeMessage="polymodeon");break;case 192:this.messageType="programchange",this.program=a.data[1];break;case 208:this.messageType="channelpressure",this.pressure=a.data[1]&127;break;case 224:this.messageType="pitchbendchange";var l=a.data[2]&127,c=a.data[1]&127;this.pitchBend=(l<<8)+c;break}}return new s(o)},r.exports=i.default},{}]},{},[1])(1)})})(Uo);var Mo=vn,Fo=function(e){return e.listenToMidi=function(t,n){var r={},i=n||{},o=i.gain||function(s){return s/127};return t.onmidimessage=function(s){var a=s.messageType?s:Mo(s);if(a.messageType==="noteon"&&a.velocity===0&&(a.messageType="noteoff"),!(i.channel&&a.channel!==i.channel))switch(a.messageType){case"noteon":r[a.key]=e.play(a.key,0,{gain:o(a.velocity)});break;case"noteoff":r[a.key]&&(r[a.key].stop(),delete r[a.key]);break}},e},e};(function(e){var t=bo,n=vo,r=Oo,i=Po,o=Fo;function s(a,l,c){return o(i(r(n(t(a,l,c)))))}e.exports&&(e.exports=s),typeof window<"u"&&(window.SamplePlayer=s)})(ro);function pr(e,t){return Array(t+1).join(e)}function Nn(e){return typeof e=="number"}function Ro(e){return typeof e=="string"}function Lo(e){return typeof e<"u"}function Zr(e,t){return Math.pow(2,(e-69)/12)*(t||440)}var ei=/^([a-gA-G])(#{1,}|b{1,}|x{1,}|)(-?\d*)\s*(.*)\s*$/;function Do(){return ei}var qo=[0,2,4,5,7,9,11];function Se(e,t,n){if(typeof e!="string")return null;var r=ei.exec(e);if(!r||!t&&r[4])return null;var i={letter:r[1].toUpperCase(),acc:r[2].replace(/x/g,"##")};i.pc=i.letter+i.acc,i.step=(i.letter.charCodeAt(0)+3)%7,i.alt=i.acc[0]==="b"?-i.acc.length:i.acc.length;var o=qo[i.step]+i.alt;return i.chroma=o<0?12+o:o%12,r[3]&&(i.oct=+r[3],i.midi=o+12*(i.oct+1),i.freq=Zr(i.midi,n)),t&&(i.tonicOf=r[4]),i}var Vo="CDEFGAB";function jo(e){return Nn(e)?e<0?pr("b",-e):pr("#",e):""}function $o(e){return Nn(e)?""+e:""}function ti(e,t,n){return e===null||typeof e>"u"?null:e.step?ti(e.step,e.alt,e.oct):e<0||e>6?null:Vo.charAt(e)+jo(t)+$o(n)}function ni(e){if((Nn(e)||Ro(e))&&e>=0&&e<128)return+e;var t=Se(e);return t&&Lo(t.midi)?t.midi:null}function Ko(e,t){var n=ni(e);return n===null?null:Zr(n,t)}function Ho(e){return(Se(e)||{}).letter}function zo(e){return(Se(e)||{}).acc}function Jo(e){return(Se(e)||{}).pc}function Go(e){return(Se(e)||{}).step}function Wo(e){return(Se(e)||{}).alt}function Yo(e){return(Se(e)||{}).chroma}function Xo(e){return(Se(e)||{}).oct}const Qo=Object.freeze(Object.defineProperty({__proto__:null,acc:zo,alt:Wo,build:ti,chroma:Yo,freq:Ko,letter:Ho,midi:ni,oct:Xo,parse:Se,pc:Jo,regex:Do,step:Go},Symbol.toStringTag,{value:"Module"})),Zo=Nr(Qo);var Yt,mr;function ea(){if(mr)return Yt;mr=1;var e=Zo;function t(i,o){if(console.warn("new Soundfont() is deprected"),console.log("Please use Soundfont.instrument() instead of new Soundfont().instrument()"),!(this instanceof t))return new t(i);this.nameToUrl=o||t.nameToUrl,this.ctx=i,this.instruments={},this.promises=[]}t.prototype.onready=function(i){console.warn("deprecated API"),console.log("Please use Promise.all(Soundfont.instrument(), Soundfont.instrument()).then() instead of new Soundfont().onready()"),Promise.all(this.promises).then(i)},t.prototype.instrument=function(i,o){console.warn("new Soundfont().instrument() is deprecated."),console.log("Please use Soundfont.instrument() instead.");var s=this.ctx;if(i=i||"default",i in this.instruments)return this.instruments[i];var a={name:i,play:r(s,o)};if(this.instruments[i]=a,i!=="default"){var l=t.instrument(s,i,o).then(function(c){return a.play=c.play,a});this.promises.push(l),a.onready=function(c){console.warn("onready is deprecated. Use Soundfont.instrument().then()"),l.then(c)}}else a.onready=function(c){console.warn("onready is deprecated. Use Soundfont.instrument().then()"),c()};return a};function n(i,o,s){return console.warn("Soundfont.loadBuffers is deprecate."),console.log("Use Soundfont.instrument(..) and get buffers properties from the result."),t.instrument(i,o,s).then(function(a){return a.buffers})}t.loadBuffers=n;function r(i,o){return o=o||{},function(s,a,l,c){console.warn("The oscillator player is deprecated."),console.log("Starting with version 0.9.0 you will have to wait until the soundfont is loaded to play sounds.");var m=s>0&&s<129?+s:e.midi(s),d=m?e.midiToFreq(m,440):null;if(d){l=l||.2,c=c||{};var u=c.destination||o.destination||i.destination,f=c.vcoType||o.vcoType||"sine",h=c.gain||o.gain||.4,p=i.createOscillator();p.type=f,p.frequency.value=d;var y=i.createGain();return y.gain.value=h,p.connect(y),y.connect(u),p.start(a),l>0&&p.stop(a+l),p}}}return t.noteToMidi=e.midi,Yt=t,Yt}(function(e){var t=gn,n=bn;function r(a,l,c){if(arguments.length===1)return function(h,p){return r(a,h,p)};var m=c||{},d=m.isSoundfontURL||i,u=m.nameToUrl||o,f=d(l)?l:u(l,m.soundfont,m.format);return t(a,f,{only:m.only||m.notes}).then(function(h){var p=n(a,h,m).connect(m.destination?m.destination:a.destination);return p.url=f,p.name=l,p})}function i(a){return/\.js(\?.*)?$/i.test(a)}function o(a,l,c){return c=c==="ogg"?c:"mp3",l=l==="FluidR3_GM"?l:"MusyngKite","https://gleitz.github.io/midi-js-soundfonts/"+l+"/"+a+"-"+c+".js"}var s=ea();s.instrument=r,s.nameToUrl=o,e.exports&&(e.exports=s),typeof window<"u"&&(window.Soundfont=s)})(Xs);const ri=window.AudioContext||window.webkitAudioContext;ri||alert("Your browser does not seem to support the Web Audio API!");const ta=new ri,Xt={};function ii(e){return Xt[e]||(Xt[e]=yn.instrument(ta,e)),Xt[e]}const et=te(!1),Ze=te(""),At=te("acoustic_grand_piano"),ze=te(new Map),Bt=te(!1),xe=new Map,Vt={audioNodeMap:new Map,colorHue:"220"};xe.set("0",Vt);let E,En,An;async function Bn(e,t){let n=await ii(e),r=xe.get(t);r&&(r.instrument=n)}function yr({socketID:e,colorHue:t,instrumentName:n}){xe.set(e,{audioNodeMap:e===E.id?Vt.audioNodeMap:new Map,colorHue:t}),ze.set(pe(ze).set(e,t)),n&&Bn(n,e)}function Qt(){E.removeAllListeners(),E=null,et.set(!1),Bt.set(!1),xe.clear(),xe.set("0",Vt)}function na(e,t){En=e,An=t}function Zt(e){if(pe(et)||pe(Bt))return;if(e.length>100)return Ze.set("Room name to long!");const t="https://calbabreaker-piano-backend.herokuapp.com";Ze.set(""),et.set(!0),E=St(t,{query:{roomName:e,instrumentName:pe(At)},path:{}.VITE_BACKEND_PATH}),E.on("connect_error",()=>{Qt(),Ze.set("Failed to connect to server!")}),E.on("connect_timeout",()=>{Qt(),Ze.set("Timed out while connecting to server!")}),E.on("connect",()=>{et.set(!1),Bt.set(!0),xe.delete("0"),pe(ze).clear(),history.replaceState({},void 0,`?room=${e}`),document.title=`Room ${e} - Play Piano!`}),E.on("disconnect",()=>{Qt(),history.replaceState({},void 0,location.pathname),document.title="Play Piano!"}),E.on("play_note",n=>{En(n)}),E.on("stop_note",n=>{An(n)}),E.on("instrument_change",n=>{const{instrumentName:r,socketID:i}=n;Bn(r,i)}),E.on("client_connect",n=>{yr(n)}),E.on("client_list_recieve",n=>{const r=n;for(let i of r)yr(i)}),E.on("client_disconnect",n=>{const r=pe(ze);r.delete(n),ze.set(r),xe.delete(n)})}function ra(e,t){const n={note:e,volume:t};E&&E.emit("play_note",n),En({...n,socketID:(E==null?void 0:E.id)??"0"})}function en(e,t){const n={note:e,sustain:t};E&&E.emit("stop_note",n),An({...n,socketID:(E==null?void 0:E.id)??"0"})}At.subscribe(e=>{E&&E.emit("instrument_change",{instrumentName:e}),Bn(e,(E==null?void 0:E.id)??"0")});function gr(e,t,n){const r=e.slice();return r[39]=t[n][0],r[40]=t[n][1],r}function br(e,t,n){const r=e.slice();return r[43]=t[n],r}function vr(e){let t,n=e[43]+"",r;return{c(){t=k("option"),r=re(n),t.__value=e[43],t.value=t.__value},m(i,o){V(i,t,o),g(t,r)},p:U,d(i){i&&L(t)}}}function ia(e){return{c:U,m:U,d:U}}function sa(e){return{c:U,m:U,d:U}}function oa(e){let t;return{c(){t=re("loading...")},m(n,r){V(n,t,r)},d(n){n&&L(t)}}}function aa(e){let t,n,r;return{c(){t=k("button"),t.textContent="Play"},m(i,o){V(i,t,o),n||(r=C(t,"click",e[27]),n=!0)},p:U,d(i){i&&L(t),n=!1,r()}}}function ca(e){let t,n,r;return{c(){t=k("button"),t.textContent="Pause"},m(i,o){V(i,t,o),n||(r=C(t,"click",e[26]),n=!0)},p:U,d(i){i&&L(t),n=!1,r()}}}function ua(e){let t,n,r,i;return{c(){t=k("button"),n=re("Join"),t.disabled=e[13]},m(o,s){V(o,t,s),g(t,n),r||(i=C(t,"click",e[37]),r=!0)},p(o,s){s[0]&8192&&(t.disabled=o[13])},d(o){o&&L(t),r=!1,i()}}}function la(e){let t,n,r,i,o,s,a,l,c,m,d=Array.from(e[12].entries()),u=[];for(let f=0;f<d.length;f+=1)u[f]=kr(gr(e,d,f));return{c(){t=k("button"),t.textContent="Leave",n=P(),r=k("span"),r.textContent="Connected!",i=k("br"),o=P(),s=k("span"),s.textContent="People:",a=P();for(let f=0;f<u.length;f+=1)u[f].c();l=Cr()},m(f,h){V(f,t,h),V(f,n,h),V(f,r,h),V(f,i,h),V(f,o,h),V(f,s,h),V(f,a,h);for(let p=0;p<u.length;p+=1)u[p].m(f,h);V(f,l,h),c||(m=C(t,"click",e[36]),c=!0)},p(f,h){if(h[0]&4096){d=Array.from(f[12].entries());let p;for(p=0;p<d.length;p+=1){const y=gr(f,d,p);u[p]?u[p].p(y,h):(u[p]=kr(y),u[p].c(),u[p].m(l.parentNode,l))}for(;p<u.length;p+=1)u[p].d(1);u.length=d.length}},d(f){f&&L(t),f&&L(n),f&&L(r),f&&L(i),f&&L(o),f&&L(s),f&&L(a),wn(u,f),f&&L(l),c=!1,m()}}}function _r(e){let t;return{c(){t=k("span"),t.textContent="(you)",Ct(t,"margin-right","0.5rem")},m(n,r){V(n,t,r)},d(n){n&&L(t)}}}function kr(e){let t,n,r,i,o=e[39]===E.id&&_r();return{c(){t=k("div"),r=P(),o&&o.c(),i=Cr(),v(t,"class","icon svelte-kmoprw"),v(t,"style",n=`--color-hue: ${e[40]}`)},m(s,a){V(s,t,a),V(s,r,a),o&&o.m(s,a),V(s,i,a)},p(s,a){a[0]&4096&&n!==(n=`--color-hue: ${s[40]}`)&&v(t,"style",n),s[39]===E.id?o||(o=_r(),o.c(),o.m(i.parentNode,i)):o&&(o.d(1),o=null)},d(s){s&&L(t),s&&L(r),o&&o.d(s),s&&L(i)}}}function fa(e){let t;return{c(){t=k("span"),t.textContent="Connecting..."},m(n,r){V(n,t,r)},p:U,d(n){n&&L(t)}}}function ha(e){let t,n;return{c(){t=k("span"),n=re(e[14]),v(t,"class","error svelte-kmoprw")},m(r,i){V(r,t,i),g(t,n)},p(r,i){i[0]&16384&&tn(n,r[14])},d(r){r&&L(t)}}}function da(e){let t,n,r,i,o,s,a,l,c,m,d,u,f,h,p,y,I,D,F,w,N,$,T,_,A,B,ne,b,S,M,z,ue,ge,be,ve,rt,le,Ie,Re,it,Be,st,_e,Ge,Le,x,R,Pn,ie,Un,ke,Mn,Fn,Rn,W,Ln,ot=e[8].toFixed(1)+"",jt,Dn,at=e[10].toFixed(1)+"",$t,qn,Vn,se,ct,jn,fe,$n,Kt,Ht,Kn,De=er,Q=[];for(let j=0;j<De.length;j+=1)Q[j]=vr(br(e,De,j));let oe={ctx:e,current:null,token:null,hasCatch:!1,pending:oa,then:sa,catch:ia};Qn(B=e[2],oe);function Hn(j,q){return j[7]?ca:aa}let ut=Hn(e),he=ut(e);function zn(j,q){return j[11]?la:ua}let lt=zn(e),de=lt(e);function Jn(j,q){if(j[14])return ha;if(j[13])return fa}let qe=Jn(e),Z=qe&&qe(e);return{c(){t=k("div"),n=k("div"),r=k("div"),i=k("div"),o=k("span"),o.textContent="Sustain:",s=P(),a=k("input"),l=P(),c=k("div"),m=k("span"),m.textContent="Octave Shift:",d=P(),u=k("input"),f=P(),h=k("div"),p=k("span"),p.textContent="Volume:",y=P(),I=k("input"),D=P(),F=k("input"),w=P(),N=k("div"),$=k("span"),$.textContent="Instrument:",T=P(),_=k("select");for(let j=0;j<Q.length;j+=1)Q[j].c();A=P(),oe.block.c(),ne=P(),b=k("span"),b.textContent="Size:",S=P(),M=k("select"),z=k("option"),z.textContent="Full size (88 keys)",ue=k("option"),ue.textContent="Half size (61 keys)",ge=k("option"),ge.textContent="Quater Size (37 keys)",be=k("option"),be.textContent="2 Octaves (24 keys)",ve=k("option"),ve.textContent="1 Octave (12 keys)",rt=P(),le=k("div"),Ie=k("div"),Re=k("p"),Re.textContent="Play a midi:",it=P(),Be=k("input"),st=P(),_e=k("div"),he.c(),Ge=P(),Le=k("button"),Le.textContent="Restart",x=P(),R=k("div"),Pn=re("Speed:"),ie=k("input"),Un=P(),ke=k("input"),Mn=re("times"),Fn=k("br"),Rn=P(),W=k("input"),Ln=P(),jt=re(ot),Dn=re("/"),$t=re(at),qn=re(" seconds"),Vn=P(),se=k("div"),ct=k("p"),ct.textContent="Join a room:",jn=P(),fe=k("input"),$n=P(),de.c(),Kt=P(),Z&&Z.c(),v(a,"type","checkbox"),v(a,"class","svelte-kmoprw"),v(i,"title","Shortcut: space"),v(i,"class","svelte-kmoprw"),v(u,"type","number"),v(u,"min","-3"),v(u,"max","3"),v(u,"class","svelte-kmoprw"),v(c,"title","Shortcut: left ctrl +, left alt or right ctrl -"),v(c,"class","svelte-kmoprw"),v(I,"type","range"),v(I,"min","0"),v(I,"max","10"),v(I,"step","0.1"),v(I,"class","svelte-kmoprw"),v(F,"type","number"),v(F,"class","svelte-kmoprw"),v(h,"class","svelte-kmoprw"),e[0]===void 0&&Ot(()=>e[23].call(_)),v(N,"class","svelte-kmoprw"),v(z,"data-range","A0,C8"),z.__value="Full size (88 keys)",z.value=z.__value,v(ue,"data-range","C2,C7"),ue.selected=!0,ue.__value="Half size (61 keys)",ue.value=ue.__value,v(ge,"data-range","C3,C6"),ge.__value="Quater Size (37 keys)",ge.value=ge.__value,v(be,"data-range","C4,B5"),be.__value="2 Octaves (24 keys)",be.value=be.__value,v(ve,"data-range","C4,B4"),ve.__value="1 Octave (12 keys)",ve.value=ve.__value,v(r,"class","svelte-kmoprw"),v(Re,"class","svelte-kmoprw"),v(Be,"type","file"),v(Be,"class","svelte-kmoprw"),v(Ie,"class","svelte-kmoprw"),v(_e,"class","svelte-kmoprw"),v(ie,"type","range"),v(ie,"min","0.01"),v(ie,"max","4"),v(ie,"step","0.01"),v(ie,"class","svelte-kmoprw"),v(ke,"type","number"),v(ke,"min","0.01"),v(ke,"class","svelte-kmoprw"),v(W,"type","range"),v(W,"min","0"),v(W,"max",e[10]),v(W,"step","0.1"),Ct(W,"width","18rem"),v(W,"class","svelte-kmoprw"),v(R,"class","svelte-kmoprw"),v(le,"class","svelte-kmoprw"),v(n,"class","row svelte-kmoprw"),v(ct,"class","svelte-kmoprw"),v(fe,"type","text"),v(fe,"placeholder","Room name"),v(fe,"class","svelte-kmoprw"),v(t,"class","control-panel svelte-kmoprw")},m(j,q){V(j,t,q),g(t,n),g(n,r),g(r,i),g(i,o),g(i,s),g(i,a),a.checked=e[3],g(r,l),g(r,c),g(c,m),g(c,d),g(c,u),ee(u,e[4]),g(r,f),g(r,h),g(h,p),g(h,y),g(h,I),ee(I,e[5]),g(h,D),g(h,F),ee(F,e[5]),g(r,w),g(r,N),g(N,$),g(N,T),g(N,_);for(let G=0;G<Q.length;G+=1)Q[G].m(_,null);Yn(_,e[0]),g(N,A),oe.block.m(N,oe.anchor=null),oe.mount=()=>N,oe.anchor=null,g(r,ne),g(r,b),g(r,S),g(r,M),g(M,z),g(M,ue),g(M,ge),g(M,be),g(M,ve),g(n,rt),g(n,le),g(le,Ie),g(Ie,Re),g(Ie,it),g(Ie,Be),g(le,st),g(le,_e),he.m(_e,null),g(_e,Ge),g(_e,Le),g(le,x),g(le,R),g(R,Pn),g(R,ie),ee(ie,e[9]),g(R,Un),g(R,ke),ee(ke,e[9]),g(R,Mn),g(R,Fn),g(R,Rn),g(R,W),ee(W,e[8]),g(R,Ln),g(R,jt),g(R,Dn),g(R,$t),g(R,qn),g(t,Vn),g(t,se),g(se,ct),g(se,jn),g(se,fe),ee(fe,e[1]),g(se,$n),de.m(se,null),g(se,Kt),Z&&Z.m(se,null),Ht||(Kn=[C(window,"keydown",e[17]),C(window,"keyup",e[18]),C(window,"load",e[15]),C(a,"change",e[19]),C(u,"input",e[20]),C(I,"change",e[21]),C(I,"input",e[21]),C(F,"input",e[22]),C(_,"change",e[23]),C(M,"change",e[24]),ai(e[16].call(null,M)),C(Be,"change",e[25]),C(Le,"click",e[28]),C(ie,"change",e[29]),C(ie,"input",e[29]),C(ke,"input",e[30]),C(W,"change",e[31]),C(W,"input",e[31]),C(W,"mousedown",e[32]),C(W,"mouseup",e[33]),C(fe,"input",e[34]),C(fe,"keydown",e[35])],Ht=!0)},p(j,q){if(e=j,q[0]&8&&(a.checked=e[3]),q[0]&16&&we(u.value)!==e[4]&&ee(u,e[4]),q[0]&32&&ee(I,e[5]),q[0]&32&&we(F.value)!==e[5]&&ee(F,e[5]),q&0){De=er;let G;for(G=0;G<De.length;G+=1){const Gn=br(e,De,G);Q[G]?Q[G].p(Gn,q):(Q[G]=vr(Gn),Q[G].c(),Q[G].m(_,null))}for(;G<Q.length;G+=1)Q[G].d(1);Q.length=De.length}q[0]&1&&Yn(_,e[0]),oe.ctx=e,q[0]&4&&B!==(B=e[2])&&Qn(B,oe),ut===(ut=Hn(e))&&he?he.p(e,q):(he.d(1),he=ut(e),he&&(he.c(),he.m(_e,Ge))),q[0]&512&&ee(ie,e[9]),q[0]&512&&we(ke.value)!==e[9]&&ee(ke,e[9]),q[0]&1024&&v(W,"max",e[10]),q[0]&256&&ee(W,e[8]),q[0]&256&&ot!==(ot=e[8].toFixed(1)+"")&&tn(jt,ot),q[0]&1024&&at!==(at=e[10].toFixed(1)+"")&&tn($t,at),q[0]&2&&fe.value!==e[1]&&ee(fe,e[1]),lt===(lt=zn(e))&&de?de.p(e,q):(de.d(1),de=lt(e),de&&(de.c(),de.m(se,Kt))),qe===(qe=Jn(e))&&Z?Z.p(e,q):(Z&&Z.d(1),Z=qe&&qe(e),Z&&(Z.c(),Z.m(se,null)))},i:U,o:U,d(j){j&&L(t),wn(Q,j),oe.block.d(),oe.token=null,oe=null,he.d(),de.d(),Z&&Z.d(),Ht=!1,Ae(Kn)}}}const Oe=te(0),He=te(!1),It=te(5),_n=te(["C0","C0"]);function pa(e,t,n){let r,i,o=U,s,a=U,l,c=U,m,d,u=U,f,h,p,y,I,D,F,w,N;J(e,He,x=>n(3,i=x)),J(e,Oe,x=>n(4,s=x)),J(e,_n,x=>n(38,l=x)),J(e,At,x=>n(0,m=x)),J(e,It,x=>n(5,d=x)),J(e,ln,x=>n(6,f=x)),J(e,ae,x=>n(7,h=x)),J(e,Me,x=>n(8,p=x)),J(e,wt,x=>n(9,y=x)),J(e,kt,x=>n(10,I=x)),J(e,Bt,x=>n(11,D=x)),J(e,ze,x=>n(12,F=x)),J(e,et,x=>n(13,w=x)),J(e,Ze,x=>n(14,N=x)),e.$$.on_destroy.push(()=>o()),e.$$.on_destroy.push(()=>a()),e.$$.on_destroy.push(()=>c()),e.$$.on_destroy.push(()=>u());let $="";function T(){const R=new URLSearchParams(location.search).get("room");R!=null&&(n(1,$=R),Zt($))}function _(x){const R=x.children[x.selectedIndex];Y(_n,l=R.dataset.range.split(","),l)}function A(x){x.code==="Space"&&Y(He,i=!0,i),x.code==="ControlLeft"?Y(Oe,s-=1,s):(x.code==="AltLeft"||x.code=="ControlRight")&&Y(Oe,s+=1,s),s<-3?Y(Oe,s=3,s):s>3&&Y(Oe,s=-3,s)}function B(x){x.code==="Space"&&Y(He,i=!1,i)}function ne(){i=this.checked,He.set(i)}function b(){s=we(this.value),Oe.set(s)}function S(){d=we(this.value),It.set(d)}function M(){d=we(this.value),It.set(d)}function z(){m=li(this),At.set(m)}const ue=x=>_(x.currentTarget),ge=x=>{var R;return Y(ln,f=(R=x.currentTarget.files)==null?void 0:R[0],f)},be=()=>Y(ae,h=!1,h),ve=()=>Y(ae,h=!0,h),rt=()=>{Y(ae,h=!1,h),Y(Me,p=0,p),setTimeout(()=>Y(ae,h=!0,h),100)};function le(){y=we(this.value),wt.set(y)}function Ie(){y=we(this.value),wt.set(y)}function Re(){p=we(this.value),Me.set(p)}const it=()=>Y(ae,h=!1,h),Be=()=>Y(ae,h=!0,h);function st(){$=this.value,n(1,$)}const _e=x=>{x.code==="Enter"&&Zt($)},Ge=()=>E.disconnect(),Le=()=>Zt($);return e.$$.update=()=>{e.$$.dirty[0]&1&&n(2,r=ii(m))},[m,$,r,i,s,d,f,h,p,y,I,D,F,w,N,T,_,A,B,ne,b,S,M,z,ue,ge,be,ve,rt,le,Ie,Re,it,Be,st,_e,Ge,Le]}class ma extends Sn{constructor(t){super(),xn(this,t,pa,da,Pt,{},null,[-1,-1])}}function wr(e,t,n){const r=e.slice();return r[25]=t[n][0],r[26]=t[n][1].isWhite,r[27]=t[n][1].pressedColor,r[28]=t[n][1].isGhost,r}function Tr(e){let t,n,r,i;function o(...c){return e[13](e[25],...c)}function s(){return e[14](e[25])}function a(){return e[15](e[25])}function l(){return e[16](e[25])}return{c(){t=k("div"),v(t,"class",n="key "+(e[26]?"white":"black")+" svelte-rsi44m"),Ct(t,"--color-hue",e[27]),ft(t,"pressed",e[27]!==null),ft(t,"ghost",e[28]&&e[27]===null)},m(c,m){V(c,t,m),r||(i=[C(t,"pointerdown",o),C(t,"pointerenter",s),C(t,"pointerleave",a),C(t,"pointerup",l)],r=!0)},p(c,m){e=c,m&2&&n!==(n="key "+(e[26]?"white":"black")+" svelte-rsi44m")&&v(t,"class",n),m&2&&Ct(t,"--color-hue",e[27]),m&2&&ft(t,"pressed",e[27]!==null),m&2&&ft(t,"ghost",e[28]&&e[27]===null)},d(c){c&&L(t),r=!1,Ae(i)}}}function ya(e){let t,n,r,i,o=Object.entries(e[1]),s=[];for(let a=0;a<o.length;a+=1)s[a]=Tr(wr(e,o,a));return{c(){t=k("div"),n=k("div");for(let a=0;a<s.length;a+=1)s[a].c();v(n,"class","piano svelte-rsi44m"),v(t,"class","piano-container svelte-rsi44m")},m(a,l){V(a,t,l),g(t,n);for(let c=0;c<s.length;c+=1)s[c].m(n,null);e[17](t),r||(i=[C(window,"resize",e[10]),C(window,"keyup",e[7]),C(window,"keydown",e[6]),C(window,"pointerdown",e[11]),C(window,"pointerup",e[12]),C(n,"touchstart",ci(e[9]))],r=!0)},p(a,[l]){if(l&27){o=Object.entries(a[1]);let c;for(c=0;c<o.length;c+=1){const m=wr(a,o,c);s[c]?s[c].p(m,l):(s[c]=Tr(m),s[c].c(),s[c].m(n,null))}for(;c<s.length;c+=1)s[c].d(1);s.length=o.length}},i:U,o:U,d(a){a&&L(t),wn(s,a),e[17](null),r=!1,Ae(i)}}}function xr(e,t){t.get(e)&&(t.get(e).stop(),t.delete(e))}function ga(e,t,n){let r,i,o;J(e,He,b=>n(18,r=b)),J(e,It,b=>n(19,i=b)),J(e,Oe,b=>n(20,o=b));let s=!1,a,l,c,m=new Map;_n.subscribe(b=>{const S=os(b[0],b[1]);n(1,a=S.noteMap),n(8,l=S.whiteKeys)}),na(h,p);function d(b){const S=cn(b)+o;return un(b)+S}function u(b,S){const M=d(b);m.get(M)||(a[b]&&n(1,a[b].isGhost=!0,a),m.set(M,!0),ra(M,i*S))}function f(b){const S=d(b);a[b]&&n(1,a[b].isGhost=!1,a),m.get(S)&&(m.delete(S),en(S,r))}function h({socketID:b,note:S,volume:M}){const z=xe.get(b);a[S]&&n(1,a[S].pressedColor=z.colorHue,a),z.instrument&&(xr(S,z.audioNodeMap),z.audioNodeMap.set(S,z.instrument.play(S,void 0,{gain:M})))}function p({socketID:b,note:S,sustain:M}){const z=xe.get(b);a[S]&&n(1,a[S].pressedColor=null,a),M||xr(S,z.audioNodeMap)}as(u,f),He.subscribe(b=>{if(!b)for(const S of Vt.audioNodeMap.keys())m.get(S)||en(S,!1)}),Oe.subscribe(()=>{for(const b of m.keys())en(b,r)});function y(b=l){if(!c)return;const S=c.clientHeight/6,M=c.offsetWidth/b;c.style.setProperty("--white-key-width",`${Math.min(M,S)}px`)}fi(()=>{y()});function I(b){const S=rr[b.code],M=b.target;S&&M.tagName!=="INPUT"&&(b.preventDefault(),u(S,.5))}function D(b){const S=rr[b.code];S&&f(S)}function F(b){hi.call(this,e,b)}const w=()=>y(),N=()=>n(0,s=!0),$=()=>n(0,s=!1),T=(b,S)=>{S.currentTarget.releasePointerCapture(S.pointerId),u(b,.5)},_=b=>{s&&u(b,.5)},A=b=>f(b),B=b=>f(b);function ne(b){nn[b?"unshift":"push"](()=>{c=b,n(2,c)})}return e.$$.update=()=>{e.$$.dirty&256&&y(l)},[s,a,c,u,f,y,I,D,l,F,w,N,$,T,_,A,B,ne]}class ba extends Sn{constructor(t){super(),xn(this,t,ga,ya,Pt,{})}}function va(e){let t,n,r,i,o;return n=new ma({}),i=new ba({}),{c(){t=k("main"),Zn(n.$$.fragment),r=P(),Zn(i.$$.fragment),v(t,"class","svelte-ieeeet")},m(s,a){V(s,t,a),on(n,t,null),g(t,r),on(i,t,null),o=!0},p:U,i(s){o||(Nt(n.$$.fragment,s),Nt(i.$$.fragment,s),o=!0)},o(s){sn(n.$$.fragment,s),sn(i.$$.fragment,s),o=!1},d(s){s&&L(t),an(n),an(i)}}}class _a extends Sn{constructor(t){super(),xn(this,t,null,va,Pt,{})}}new _a({target:document.body});

(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))r(i);new MutationObserver(i=>{for(const o of i)if(o.type==="childList")for(const s of o.addedNodes)s.tagName==="LINK"&&s.rel==="modulepreload"&&r(s)}).observe(document,{childList:!0,subtree:!0});function n(i){const o={};return i.integrity&&(o.integrity=i.integrity),i.referrerpolicy&&(o.referrerPolicy=i.referrerpolicy),i.crossorigin==="use-credentials"?o.credentials="include":i.crossorigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function r(i){if(i.ep)return;i.ep=!0;const o=n(i);fetch(i.href,o)}})();function U(){}function ii(t){return t&&typeof t=="object"&&typeof t.then=="function"}function _r(t){return t()}function Hn(){return Object.create(null)}function Be(t){t.forEach(_r)}function kr(t){return typeof t=="function"}function Bt(t,e){return t!=t?e==e:t!==e||t&&typeof t=="object"||typeof t=="function"}function si(t){return Object.keys(t).length===0}function wr(t,...e){if(t==null)return U;const n=t.subscribe(...e);return n.unsubscribe?()=>n.unsubscribe():n}function we(t){let e;return wr(t,n=>e=n)(),e}function J(t,e,n){t.$$.on_destroy.push(wr(e,n))}function Y(t,e,n){return t.set(n),e}function oi(t){return t&&kr(t.destroy)?t.destroy:U}function g(t,e){t.appendChild(e)}function q(t,e,n){t.insertBefore(e,n||null)}function D(t){t.parentNode.removeChild(t)}function yn(t,e){for(let n=0;n<t.length;n+=1)t[n]&&t[n].d(e)}function k(t){return document.createElement(t)}function re(t){return document.createTextNode(t)}function P(){return re(" ")}function Tr(){return re("")}function C(t,e,n,r){return t.addEventListener(e,n,r),()=>t.removeEventListener(e,n,r)}function ai(t){return function(e){return e.preventDefault(),t.call(this,e)}}function v(t,e,n){n==null?t.removeAttribute(e):t.getAttribute(e)!==n&&t.setAttribute(e,n)}function ke(t){return t===""?null:+t}function ci(t){return Array.from(t.childNodes)}function en(t,e){e=""+e,t.wholeText!==e&&(t.data=e)}function ee(t,e){t.value=e==null?"":e}function St(t,e,n,r){n===null?t.style.removeProperty(e):t.style.setProperty(e,n,r?"important":"")}function $n(t,e){for(let n=0;n<t.options.length;n+=1){const r=t.options[n];if(r.__value===e){r.selected=!0;return}}t.selectedIndex=-1}function ui(t){const e=t.querySelector(":checked")||t.options[0];return e&&e.__value}function lt(t,e,n){t.classList[n?"add":"remove"](e)}let et;function Te(t){et=t}function xr(){if(!et)throw new Error("Function called outside component initialization");return et}function li(t){xr().$$.on_mount.push(t)}function fi(t,e){const n=t.$$.callbacks[e.type];n&&n.slice().forEach(r=>r.call(this,e))}const Ye=[],tn=[],bt=[],zn=[],hi=Promise.resolve();let nn=!1;function di(){nn||(nn=!0,hi.then(gn))}function Ct(t){bt.push(t)}const $t=new Set;let ft=0;function gn(){const t=et;do{for(;ft<Ye.length;){const e=Ye[ft];ft++,Te(e),pi(e.$$)}for(Te(null),Ye.length=0,ft=0;tn.length;)tn.pop()();for(let e=0;e<bt.length;e+=1){const n=bt[e];$t.has(n)||($t.add(n),n())}bt.length=0}while(Ye.length);for(;zn.length;)zn.pop()();nn=!1,$t.clear(),Te(t)}function pi(t){if(t.fragment!==null){t.update(),Be(t.before_update);const e=t.dirty;t.dirty=[-1],t.fragment&&t.fragment.p(t.ctx,e),t.after_update.forEach(Ct)}}const vt=new Set;let Ue;function mi(){Ue={r:0,c:[],p:Ue}}function yi(){Ue.r||Be(Ue.c),Ue=Ue.p}function Ot(t,e){t&&t.i&&(vt.delete(t),t.i(e))}function rn(t,e,n,r){if(t&&t.o){if(vt.has(t))return;vt.add(t),Ue.c.push(()=>{vt.delete(t),r&&(n&&t.d(1),r())}),t.o(e)}else r&&r()}function Jn(t,e){const n=e.token={};function r(i,o,s,a){if(e.token!==n)return;e.resolved=a;let u=e.ctx;s!==void 0&&(u=u.slice(),u[s]=a);const c=i&&(e.current=i)(u);let p=!1;e.block&&(e.blocks?e.blocks.forEach((h,l)=>{l!==o&&h&&(mi(),rn(h,1,1,()=>{e.blocks[l]===h&&(e.blocks[l]=null)}),yi())}):e.block.d(1),c.c(),Ot(c,1),c.m(e.mount(),e.anchor),p=!0),e.block=c,e.blocks&&(e.blocks[o]=c),p&&gn()}if(ii(t)){const i=xr();if(t.then(o=>{Te(i),r(e.then,1,e.value,o),Te(null)},o=>{if(Te(i),r(e.catch,2,e.error,o),Te(null),!e.hasCatch)throw o}),e.current!==e.pending)return r(e.pending,0),!0}else{if(e.current!==e.then)return r(e.then,1,e.value,t),!0;e.resolved=t}}function Gn(t){t&&t.c()}function sn(t,e,n,r){const{fragment:i,on_mount:o,on_destroy:s,after_update:a}=t.$$;i&&i.m(e,n),r||Ct(()=>{const u=o.map(_r).filter(kr);s?s.push(...u):Be(u),t.$$.on_mount=[]}),a.forEach(Ct)}function on(t,e){const n=t.$$;n.fragment!==null&&(Be(n.on_destroy),n.fragment&&n.fragment.d(e),n.on_destroy=n.fragment=null,n.ctx=[])}function gi(t,e){t.$$.dirty[0]===-1&&(Ye.push(t),di(),t.$$.dirty.fill(0)),t.$$.dirty[e/31|0]|=1<<e%31}function bn(t,e,n,r,i,o,s,a=[-1]){const u=et;Te(t);const c=t.$$={fragment:null,ctx:null,props:o,update:U,not_equal:i,bound:Hn(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(e.context||(u?u.$$.context:[])),callbacks:Hn(),dirty:a,skip_bound:!1,root:e.target||u.$$.root};s&&s(c.root);let p=!1;if(c.ctx=n?n(t,e.props||{},(h,l,...f)=>{const d=f.length?f[0]:l;return c.ctx&&i(c.ctx[h],c.ctx[h]=d)&&(!c.skip_bound&&c.bound[h]&&c.bound[h](d),p&&gi(t,h)),l}):[],c.update(),p=!0,Be(c.before_update),c.fragment=r?r(c.ctx):!1,e.target){if(e.hydrate){const h=ci(e.target);c.fragment&&c.fragment.l(h),h.forEach(D)}else c.fragment&&c.fragment.c();e.intro&&Ot(t.$$.fragment),sn(t,e.target,e.anchor,e.customElement),gn()}Te(u)}class vn{$destroy(){on(this,1),this.$destroy=U}$on(e,n){const r=this.$$.callbacks[e]||(this.$$.callbacks[e]=[]);return r.push(n),()=>{const i=r.indexOf(n);i!==-1&&r.splice(i,1)}}$set(e){this.$$set&&!si(e)&&(this.$$.skip_bound=!0,this.$$set(e),this.$$.skip_bound=!1)}}const Ve=[];function te(t,e=U){let n;const r=new Set;function i(a){if(Bt(t,a)&&(t=a,n)){const u=!Ve.length;for(const c of r)c[1](),Ve.push(c,t);if(u){for(let c=0;c<Ve.length;c+=2)Ve[c][0](Ve[c+1]);Ve.length=0}}}function o(a){i(a(t))}function s(a,u=U){const c=[a,u];return r.add(c),r.size===1&&(n=e(i)||U),a(t),()=>{r.delete(c),r.size===0&&(n(),n=null)}}return{set:i,update:o,subscribe:s}}const Wn=["accordion","acoustic_bass","acoustic_grand_piano","acoustic_guitar_nylon","acoustic_guitar_steel","agogo","alto_sax","applause","bagpipe","banjo","baritone_sax","bassoon","bird_tweet","blown_bottle","brass_section","breath_noise","bright_acoustic_piano","celesta","cello","choir_aahs","church_organ","clarinet","clavinet","contrabass","distortion_guitar","drawbar_organ","dulcimer","electric_bass_finger","electric_bass_pick","electric_grand_piano","electric_guitar_clean","electric_guitar_jazz","electric_guitar_muted","electric_piano_1","electric_piano_2","english_horn","fiddle","flute","french_horn","fretless_bass","fx_1_rain","fx_2_soundtrack","fx_3_crystal","fx_4_atmosphere","fx_5_brightness","fx_6_goblins","fx_7_echoes","fx_8_scifi","glockenspiel","guitar_fret_noise","guitar_harmonics","gunshot","harmonica","harpsichord","helicopter","honkytonk_piano","kalimba","koto","lead_1_square","lead_2_sawtooth","lead_3_calliope","lead_4_chiff","lead_5_charang","lead_6_voice","lead_7_fifths","lead_8_bass__lead","marimba","melodic_tom","music_box","muted_trumpet","oboe","ocarina","orchestra_hit","orchestral_harp","overdriven_guitar","pad_1_new_age","pad_2_warm","pad_3_polysynth","pad_4_choir","pad_5_bowed","pad_6_metallic","pad_7_halo","pad_8_sweep","pan_flute","percussive_organ","piccolo","pizzicato_strings","recorder","reed_organ","reverse_cymbal","rock_organ","seashore","shakuhachi","shamisen","shanai","sitar","slap_bass_1","slap_bass_2","soprano_sax","steel_drums","string_ensemble_1","string_ensemble_2","synth_bass_1","synth_bass_2","synth_brass_1","synth_brass_2","synth_choir","synth_drum","synth_strings_1","synth_strings_2","taiko_drum","tango_accordion","telephone_ring","tenor_sax","timpani","tinkle_bell","tremolo_strings","trombone","trumpet","tuba","tubular_bells","vibraphone","viola","violin","voice_oohs","whistle","woodblock","xylophone"];var He=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function Ir(t){var e=t.default;if(typeof e=="function"){var n=function(){return e.apply(this,arguments)};n.prototype=e.prototype}else n={};return Object.defineProperty(n,"__esModule",{value:!0}),Object.keys(t).forEach(function(r){var i=Object.getOwnPropertyDescriptor(t,r);Object.defineProperty(n,r,i.get?i:{enumerable:!0,get:function(){return t[r]}})}),n}var Sr={},Pt={};function bi(t){var e=new X(t),n=e.readChunk();if(n.id!="MThd")throw"Bad MIDI file.  Expected 'MHdr', got: '"+n.id+"'";for(var r=vi(n.data),i=[],o=0;!e.eof()&&o<r.numTracks;o++){var s=e.readChunk();if(s.id!="MTrk")throw"Bad MIDI file.  Expected 'MTrk', got: '"+s.id+"'";var a=_i(s.data);i.push(a)}return{header:r,tracks:i}}function vi(t){var e=new X(t),n=e.readUInt16(),r=e.readUInt16(),i={format:n,numTracks:r},o=e.readUInt16();return o&32768?(i.framesPerSecond=256-(o>>8),i.ticksPerFrame=o&255):i.ticksPerBeat=o,i}function _i(t){for(var e=new X(t),n=[];!e.eof();){var r=o();n.push(r)}return n;var i;function o(){var s={};s.deltaTime=e.readVarInt();var a=e.readUInt8();if((a&240)===240)if(a===255){s.meta=!0;var u=e.readUInt8(),c=e.readVarInt();switch(u){case 0:if(s.type="sequenceNumber",c!==2)throw"Expected length for sequenceNumber event is 2, got "+c;return s.number=e.readUInt16(),s;case 1:return s.type="text",s.text=e.readString(c),s;case 2:return s.type="copyrightNotice",s.text=e.readString(c),s;case 3:return s.type="trackName",s.text=e.readString(c),s;case 4:return s.type="instrumentName",s.text=e.readString(c),s;case 5:return s.type="lyrics",s.text=e.readString(c),s;case 6:return s.type="marker",s.text=e.readString(c),s;case 7:return s.type="cuePoint",s.text=e.readString(c),s;case 32:if(s.type="channelPrefix",c!=1)throw"Expected length for channelPrefix event is 1, got "+c;return s.channel=e.readUInt8(),s;case 33:if(s.type="portPrefix",c!=1)throw"Expected length for portPrefix event is 1, got "+c;return s.port=e.readUInt8(),s;case 47:if(s.type="endOfTrack",c!=0)throw"Expected length for endOfTrack event is 0, got "+c;return s;case 81:if(s.type="setTempo",c!=3)throw"Expected length for setTempo event is 3, got "+c;return s.microsecondsPerBeat=e.readUInt24(),s;case 84:if(s.type="smpteOffset",c!=5)throw"Expected length for smpteOffset event is 5, got "+c;var p=e.readUInt8(),h={0:24,32:25,64:29,96:30};return s.frameRate=h[p&96],s.hour=p&31,s.min=e.readUInt8(),s.sec=e.readUInt8(),s.frame=e.readUInt8(),s.subFrame=e.readUInt8(),s;case 88:if(s.type="timeSignature",c!=2&&c!=4)throw"Expected length for timeSignature event is 4 or 2, got "+c;return s.numerator=e.readUInt8(),s.denominator=1<<e.readUInt8(),c===4?(s.metronome=e.readUInt8(),s.thirtyseconds=e.readUInt8()):(s.metronome=36,s.thirtyseconds=8),s;case 89:if(s.type="keySignature",c!=2)throw"Expected length for keySignature event is 2, got "+c;return s.key=e.readInt8(),s.scale=e.readUInt8(),s;case 127:return s.type="sequencerSpecific",s.data=e.readBytes(c),s;default:return s.type="unknownMeta",s.data=e.readBytes(c),s.metatypeByte=u,s}}else if(a==240){s.type="sysEx";var c=e.readVarInt();return s.data=e.readBytes(c),s}else if(a==247){s.type="endSysEx";var c=e.readVarInt();return s.data=e.readBytes(c),s}else throw"Unrecognised MIDI event type byte: "+a;else{var l;if((a&128)===0){if(i===null)throw"Running status byte encountered before status byte";l=a,a=i,s.running=!0}else l=e.readUInt8(),i=a;var f=a>>4;switch(s.channel=a&15,f){case 8:return s.type="noteOff",s.noteNumber=l,s.velocity=e.readUInt8(),s;case 9:var d=e.readUInt8();return s.type=d===0?"noteOff":"noteOn",s.noteNumber=l,s.velocity=d,d===0&&(s.byte9=!0),s;case 10:return s.type="noteAftertouch",s.noteNumber=l,s.amount=e.readUInt8(),s;case 11:return s.type="controller",s.controllerType=l,s.value=e.readUInt8(),s;case 12:return s.type="programChange",s.programNumber=l,s;case 13:return s.type="channelAftertouch",s.amount=l,s;case 14:return s.type="pitchBend",s.value=l+(e.readUInt8()<<7)-8192,s;default:throw"Unrecognised MIDI event type: "+f}}}}function X(t){this.buffer=t,this.bufferLen=this.buffer.length,this.pos=0}X.prototype.eof=function(){return this.pos>=this.bufferLen};X.prototype.readUInt8=function(){var t=this.buffer[this.pos];return this.pos+=1,t};X.prototype.readInt8=function(){var t=this.readUInt8();return t&128?t-256:t};X.prototype.readUInt16=function(){var t=this.readUInt8(),e=this.readUInt8();return(t<<8)+e};X.prototype.readInt16=function(){var t=this.readUInt16();return t&32768?t-65536:t};X.prototype.readUInt24=function(){var t=this.readUInt8(),e=this.readUInt8(),n=this.readUInt8();return(t<<16)+(e<<8)+n};X.prototype.readInt24=function(){var t=this.readUInt24();return t&8388608?t-16777216:t};X.prototype.readUInt32=function(){var t=this.readUInt8(),e=this.readUInt8(),n=this.readUInt8(),r=this.readUInt8();return(t<<24)+(e<<16)+(n<<8)+r};X.prototype.readBytes=function(t){var e=this.buffer.slice(this.pos,this.pos+t);return this.pos+=t,e};X.prototype.readString=function(t){var e=this.readBytes(t);return String.fromCharCode.apply(null,e)};X.prototype.readVarInt=function(){for(var t=0;!this.eof();){var e=this.readUInt8();if(e&128)t+=e&127,t<<=7;else return t+e}return t};X.prototype.readChunk=function(){var t=this.readString(4),e=this.readUInt32(),n=this.readBytes(e);return{id:t,length:e,data:n}};var ki=bi;function wi(t,e){if(typeof t!="object")throw"Invalid MIDI data";e=e||{};var n=t.header||{},r=t.tracks||[],i,o=r.length,s=new $;for(Ti(s,n,o),i=0;i<o;i++)xi(s,r[i],e);return s.buffer}function Ti(t,e,n){var r=e.format==null?1:e.format,i=128;e.timeDivision?i=e.timeDivision:e.ticksPerFrame&&e.framesPerSecond?i=-(e.framesPerSecond&255)<<8|e.ticksPerFrame&255:e.ticksPerBeat&&(i=e.ticksPerBeat&32767);var o=new $;o.writeUInt16(r),o.writeUInt16(n),o.writeUInt16(i),t.writeChunk("MThd",o.buffer)}function xi(t,e,n){var r=new $,i,o=e.length,s=null;for(i=0;i<o;i++)(n.running===!1||!n.running&&!e[i].running)&&(s=null),s=Ii(r,e[i],s,n.useByte9ForNoteOff);t.writeChunk("MTrk",r.buffer)}function Ii(t,e,n,r){var i=e.type,o=e.deltaTime,s=e.text||"",a=e.data||[],u=null;switch(t.writeVarInt(o),i){case"sequenceNumber":t.writeUInt8(255),t.writeUInt8(0),t.writeVarInt(2),t.writeUInt16(e.number);break;case"text":t.writeUInt8(255),t.writeUInt8(1),t.writeVarInt(s.length),t.writeString(s);break;case"copyrightNotice":t.writeUInt8(255),t.writeUInt8(2),t.writeVarInt(s.length),t.writeString(s);break;case"trackName":t.writeUInt8(255),t.writeUInt8(3),t.writeVarInt(s.length),t.writeString(s);break;case"instrumentName":t.writeUInt8(255),t.writeUInt8(4),t.writeVarInt(s.length),t.writeString(s);break;case"lyrics":t.writeUInt8(255),t.writeUInt8(5),t.writeVarInt(s.length),t.writeString(s);break;case"marker":t.writeUInt8(255),t.writeUInt8(6),t.writeVarInt(s.length),t.writeString(s);break;case"cuePoint":t.writeUInt8(255),t.writeUInt8(7),t.writeVarInt(s.length),t.writeString(s);break;case"channelPrefix":t.writeUInt8(255),t.writeUInt8(32),t.writeVarInt(1),t.writeUInt8(e.channel);break;case"portPrefix":t.writeUInt8(255),t.writeUInt8(33),t.writeVarInt(1),t.writeUInt8(e.port);break;case"endOfTrack":t.writeUInt8(255),t.writeUInt8(47),t.writeVarInt(0);break;case"setTempo":t.writeUInt8(255),t.writeUInt8(81),t.writeVarInt(3),t.writeUInt24(e.microsecondsPerBeat);break;case"smpteOffset":t.writeUInt8(255),t.writeUInt8(84),t.writeVarInt(5);var c={24:0,25:32,29:64,30:96},p=e.hour&31|c[e.frameRate];t.writeUInt8(p),t.writeUInt8(e.min),t.writeUInt8(e.sec),t.writeUInt8(e.frame),t.writeUInt8(e.subFrame);break;case"timeSignature":t.writeUInt8(255),t.writeUInt8(88),t.writeVarInt(4),t.writeUInt8(e.numerator);var h=Math.floor(Math.log(e.denominator)/Math.LN2)&255;t.writeUInt8(h),t.writeUInt8(e.metronome),t.writeUInt8(e.thirtyseconds||8);break;case"keySignature":t.writeUInt8(255),t.writeUInt8(89),t.writeVarInt(2),t.writeInt8(e.key),t.writeUInt8(e.scale);break;case"sequencerSpecific":t.writeUInt8(255),t.writeUInt8(127),t.writeVarInt(a.length),t.writeBytes(a);break;case"unknownMeta":e.metatypeByte!=null&&(t.writeUInt8(255),t.writeUInt8(e.metatypeByte),t.writeVarInt(a.length),t.writeBytes(a));break;case"sysEx":t.writeUInt8(240),t.writeVarInt(a.length),t.writeBytes(a);break;case"endSysEx":t.writeUInt8(247),t.writeVarInt(a.length),t.writeBytes(a);break;case"noteOff":var l=r!==!1&&e.byte9||r&&e.velocity==0?144:128;u=l|e.channel,u!==n&&t.writeUInt8(u),t.writeUInt8(e.noteNumber),t.writeUInt8(e.velocity);break;case"noteOn":u=144|e.channel,u!==n&&t.writeUInt8(u),t.writeUInt8(e.noteNumber),t.writeUInt8(e.velocity);break;case"noteAftertouch":u=160|e.channel,u!==n&&t.writeUInt8(u),t.writeUInt8(e.noteNumber),t.writeUInt8(e.amount);break;case"controller":u=176|e.channel,u!==n&&t.writeUInt8(u),t.writeUInt8(e.controllerType),t.writeUInt8(e.value);break;case"programChange":u=192|e.channel,u!==n&&t.writeUInt8(u),t.writeUInt8(e.programNumber);break;case"channelAftertouch":u=208|e.channel,u!==n&&t.writeUInt8(u),t.writeUInt8(e.amount);break;case"pitchBend":u=224|e.channel,u!==n&&t.writeUInt8(u);var f=8192+e.value,d=f&127,m=f>>7&127;t.writeUInt8(d),t.writeUInt8(m);break;default:throw"Unrecognized event type: "+i}return u}function $(){this.buffer=[]}$.prototype.writeUInt8=function(t){this.buffer.push(t&255)};$.prototype.writeInt8=$.prototype.writeUInt8;$.prototype.writeUInt16=function(t){var e=t>>8&255,n=t&255;this.writeUInt8(e),this.writeUInt8(n)};$.prototype.writeInt16=$.prototype.writeUInt16;$.prototype.writeUInt24=function(t){var e=t>>16&255,n=t>>8&255,r=t&255;this.writeUInt8(e),this.writeUInt8(n),this.writeUInt8(r)};$.prototype.writeInt24=$.prototype.writeUInt24;$.prototype.writeUInt32=function(t){var e=t>>24&255,n=t>>16&255,r=t>>8&255,i=t&255;this.writeUInt8(e),this.writeUInt8(n),this.writeUInt8(r),this.writeUInt8(i)};$.prototype.writeInt32=$.prototype.writeUInt32;$.prototype.writeBytes=function(t){this.buffer=this.buffer.concat(Array.prototype.slice.call(t,0))};$.prototype.writeString=function(t){var e,n=t.length,r=[];for(e=0;e<n;e++)r.push(t.codePointAt(e));this.writeBytes(r)};$.prototype.writeVarInt=function(t){if(t<0)throw"Cannot write negative variable-length integer";if(t<=127)this.writeUInt8(t);else{var e=t,n=[];for(n.push(e&127),e>>=7;e;){var r=e&127|128;n.push(r),e>>=7}this.writeBytes(n.reverse())}};$.prototype.writeChunk=function(t,e){this.writeString(t),this.writeUInt32(e.length),this.writeBytes(e)};var Si=wi;Pt.parseMidi=ki;Pt.writeMidi=Si;var Nt={},Fe={};Object.defineProperty(Fe,"__esModule",{value:!0});Fe.insert=Fe.search=void 0;function Cr(t,e,n){n===void 0&&(n="ticks");var r=0,i=t.length,o=i;if(i>0&&t[i-1][n]<=e)return i-1;for(;r<o;){var s=Math.floor(r+(o-r)/2),a=t[s],u=t[s+1];if(a[n]===e){for(var c=s;c<t.length;c++){var p=t[c];p[n]===e&&(s=c)}return s}else{if(a[n]<e&&u[n]>e)return s;a[n]>e?o=s:a[n]<e&&(r=s+1)}}return-1}Fe.search=Cr;function Ci(t,e,n){if(n===void 0&&(n="ticks"),t.length){var r=Cr(t,e[n],n);t.splice(r+1,0,e)}else t.push(e)}Fe.insert=Ci;(function(t){Object.defineProperty(t,"__esModule",{value:!0}),t.Header=t.keySignatureKeys=void 0;var e=Fe,n=new WeakMap;t.keySignatureKeys=["Cb","Gb","Db","Ab","Eb","Bb","F","C","G","D","A","E","B","F#","C#"];var r=function(){function i(o){var s=this;if(this.tempos=[],this.timeSignatures=[],this.keySignatures=[],this.meta=[],this.name="",n.set(this,480),o){n.set(this,o.header.ticksPerBeat),o.tracks.forEach(function(u){u.forEach(function(c){c.meta&&(c.type==="timeSignature"?s.timeSignatures.push({ticks:c.absoluteTime,timeSignature:[c.numerator,c.denominator]}):c.type==="setTempo"?s.tempos.push({bpm:6e7/c.microsecondsPerBeat,ticks:c.absoluteTime}):c.type==="keySignature"&&s.keySignatures.push({key:t.keySignatureKeys[c.key+7],scale:c.scale===0?"major":"minor",ticks:c.absoluteTime}))})});var a=0;o.tracks[0].forEach(function(u){a+=u.deltaTime,u.meta&&(u.type==="trackName"?s.name=u.text:(u.type==="text"||u.type==="cuePoint"||u.type==="marker"||u.type==="lyrics")&&s.meta.push({text:u.text,ticks:a,type:u.type}))}),this.update()}}return i.prototype.update=function(){var o=this,s=0,a=0;this.tempos.sort(function(u,c){return u.ticks-c.ticks}),this.tempos.forEach(function(u,c){var p=c>0?o.tempos[c-1].bpm:o.tempos[0].bpm,h=u.ticks/o.ppq-a,l=60/p*h;u.time=l+s,s=u.time,a+=h}),this.timeSignatures.sort(function(u,c){return u.ticks-c.ticks}),this.timeSignatures.forEach(function(u,c){var p=c>0?o.timeSignatures[c-1]:o.timeSignatures[0],h=(u.ticks-p.ticks)/o.ppq,l=h/p.timeSignature[0]/(p.timeSignature[1]/4);p.measures=p.measures||0,u.measures=l+p.measures})},i.prototype.ticksToSeconds=function(o){var s=(0,e.search)(this.tempos,o);if(s!==-1){var a=this.tempos[s],u=a.time,c=(o-a.ticks)/this.ppq;return u+60/a.bpm*c}else{var p=o/this.ppq;return 60/120*p}},i.prototype.ticksToMeasures=function(o){var s=(0,e.search)(this.timeSignatures,o);if(s!==-1){var a=this.timeSignatures[s],u=(o-a.ticks)/this.ppq;return a.measures+u/(a.timeSignature[0]/a.timeSignature[1])/4}else return o/this.ppq/4},Object.defineProperty(i.prototype,"ppq",{get:function(){return n.get(this)},enumerable:!1,configurable:!0}),i.prototype.secondsToTicks=function(o){var s=(0,e.search)(this.tempos,o,"time");if(s!==-1){var a=this.tempos[s],u=a.time,c=o-u,p=c/(60/a.bpm);return Math.round(a.ticks+p*this.ppq)}else{var h=o/.5;return Math.round(h*this.ppq)}},i.prototype.toJSON=function(){return{keySignatures:this.keySignatures,meta:this.meta,name:this.name,ppq:this.ppq,tempos:this.tempos.map(function(o){return{bpm:o.bpm,ticks:o.ticks}}),timeSignatures:this.timeSignatures}},i.prototype.fromJSON=function(o){this.name=o.name,this.tempos=o.tempos.map(function(s){return Object.assign({},s)}),this.timeSignatures=o.timeSignatures.map(function(s){return Object.assign({},s)}),this.keySignatures=o.keySignatures.map(function(s){return Object.assign({},s)}),this.meta=o.meta.map(function(s){return Object.assign({},s)}),n.set(this,o.ppq),this.update()},i.prototype.setTempo=function(o){this.tempos=[{bpm:o,ticks:0}],this.update()},i}();t.Header=r})(Nt);var tt={},_n={};(function(t){Object.defineProperty(t,"__esModule",{value:!0}),t.ControlChange=t.controlChangeIds=t.controlChangeNames=void 0,t.controlChangeNames={1:"modulationWheel",2:"breath",4:"footController",5:"portamentoTime",7:"volume",8:"balance",10:"pan",64:"sustain",65:"portamentoTime",66:"sostenuto",67:"softPedal",68:"legatoFootswitch",84:"portamentoControl"},t.controlChangeIds=Object.keys(t.controlChangeNames).reduce(function(i,o){return i[t.controlChangeNames[o]]=o,i},{});var e=new WeakMap,n=new WeakMap,r=function(){function i(o,s){e.set(this,s),n.set(this,o.controllerType),this.ticks=o.absoluteTime,this.value=o.value}return Object.defineProperty(i.prototype,"number",{get:function(){return n.get(this)},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"name",{get:function(){return t.controlChangeNames[this.number]?t.controlChangeNames[this.number]:null},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"time",{get:function(){var o=e.get(this);return o.ticksToSeconds(this.ticks)},set:function(o){var s=e.get(this);this.ticks=s.secondsToTicks(o)},enumerable:!1,configurable:!0}),i.prototype.toJSON=function(){return{number:this.number,ticks:this.ticks,time:this.time,value:this.value}},i}();t.ControlChange=r})(_n);var Ut={};Object.defineProperty(Ut,"__esModule",{value:!0});Ut.createControlChanges=void 0;var ht=_n;function Oi(){return new Proxy({},{get:function(t,e){if(t[e])return t[e];if(ht.controlChangeIds.hasOwnProperty(e))return t[ht.controlChangeIds[e]]},set:function(t,e,n){return ht.controlChangeIds.hasOwnProperty(e)?t[ht.controlChangeIds[e]]=n:t[e]=n,!0}})}Ut.createControlChanges=Oi;var Mt={};Object.defineProperty(Mt,"__esModule",{value:!0});Mt.PitchBend=void 0;var zt=new WeakMap,Ni=function(){function t(e,n){zt.set(this,n),this.ticks=e.absoluteTime,this.value=e.value}return Object.defineProperty(t.prototype,"time",{get:function(){var e=zt.get(this);return e.ticksToSeconds(this.ticks)},set:function(e){var n=zt.get(this);this.ticks=n.secondsToTicks(e)},enumerable:!1,configurable:!0}),t.prototype.toJSON=function(){return{ticks:this.ticks,time:this.time,value:this.value}},t}();Mt.PitchBend=Ni;var Ft={},Ae={};Object.defineProperty(Ae,"__esModule",{value:!0});Ae.DrumKitByPatchID=Ae.InstrumentFamilyByID=Ae.instrumentByPatchID=void 0;Ae.instrumentByPatchID=["acoustic grand piano","bright acoustic piano","electric grand piano","honky-tonk piano","electric piano 1","electric piano 2","harpsichord","clavi","celesta","glockenspiel","music box","vibraphone","marimba","xylophone","tubular bells","dulcimer","drawbar organ","percussive organ","rock organ","church organ","reed organ","accordion","harmonica","tango accordion","acoustic guitar (nylon)","acoustic guitar (steel)","electric guitar (jazz)","electric guitar (clean)","electric guitar (muted)","overdriven guitar","distortion guitar","guitar harmonics","acoustic bass","electric bass (finger)","electric bass (pick)","fretless bass","slap bass 1","slap bass 2","synth bass 1","synth bass 2","violin","viola","cello","contrabass","tremolo strings","pizzicato strings","orchestral harp","timpani","string ensemble 1","string ensemble 2","synthstrings 1","synthstrings 2","choir aahs","voice oohs","synth voice","orchestra hit","trumpet","trombone","tuba","muted trumpet","french horn","brass section","synthbrass 1","synthbrass 2","soprano sax","alto sax","tenor sax","baritone sax","oboe","english horn","bassoon","clarinet","piccolo","flute","recorder","pan flute","blown bottle","shakuhachi","whistle","ocarina","lead 1 (square)","lead 2 (sawtooth)","lead 3 (calliope)","lead 4 (chiff)","lead 5 (charang)","lead 6 (voice)","lead 7 (fifths)","lead 8 (bass + lead)","pad 1 (new age)","pad 2 (warm)","pad 3 (polysynth)","pad 4 (choir)","pad 5 (bowed)","pad 6 (metallic)","pad 7 (halo)","pad 8 (sweep)","fx 1 (rain)","fx 2 (soundtrack)","fx 3 (crystal)","fx 4 (atmosphere)","fx 5 (brightness)","fx 6 (goblins)","fx 7 (echoes)","fx 8 (sci-fi)","sitar","banjo","shamisen","koto","kalimba","bag pipe","fiddle","shanai","tinkle bell","agogo","steel drums","woodblock","taiko drum","melodic tom","synth drum","reverse cymbal","guitar fret noise","breath noise","seashore","bird tweet","telephone ring","helicopter","applause","gunshot"];Ae.InstrumentFamilyByID=["piano","chromatic percussion","organ","guitar","bass","strings","ensemble","brass","reed","pipe","synth lead","synth pad","synth effects","world","percussive","sound effects"];Ae.DrumKitByPatchID={0:"standard kit",8:"room kit",16:"power kit",24:"electronic kit",25:"tr-808 kit",32:"jazz kit",40:"brush kit",48:"orchestra kit",56:"sound fx kit"};Object.defineProperty(Ft,"__esModule",{value:!0});Ft.Instrument=void 0;var dt=Ae,Yn=new WeakMap,Ei=function(){function t(e,n){if(this.number=0,Yn.set(this,n),this.number=0,e){var r=e.find(function(i){return i.type==="programChange"});r&&(this.number=r.programNumber)}}return Object.defineProperty(t.prototype,"name",{get:function(){return this.percussion?dt.DrumKitByPatchID[this.number]:dt.instrumentByPatchID[this.number]},set:function(e){var n=dt.instrumentByPatchID.indexOf(e);n!==-1&&(this.number=n)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"family",{get:function(){return this.percussion?"drums":dt.InstrumentFamilyByID[Math.floor(this.number/8)]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"percussion",{get:function(){var e=Yn.get(this);return e.channel===9},enumerable:!1,configurable:!0}),t.prototype.toJSON=function(){return{family:this.family,number:this.number,name:this.name}},t.prototype.fromJSON=function(e){this.number=e.number},t}();Ft.Instrument=Ei;var Rt={};Object.defineProperty(Rt,"__esModule",{value:!0});Rt.Note=void 0;function Ai(t){var e=Math.floor(t/12)-1;return Or(t)+e.toString()}function Or(t){var e=["C","C#","D","D#","E","F","F#","G","G#","A","A#","B"],n=t%12;return e[n]}function Bi(t){var e=["C","C#","D","D#","E","F","F#","G","G#","A","A#","B"];return e.indexOf(t)}var Pi=function(){var t=/^([a-g]{1}(?:b|#|x|bb)?)(-?[0-9]+)/i,e={cbb:-2,cb:-1,c:0,"c#":1,cx:2,dbb:0,db:1,d:2,"d#":3,dx:4,ebb:2,eb:3,e:4,"e#":5,ex:6,fbb:3,fb:4,f:5,"f#":6,fx:7,gbb:5,gb:6,g:7,"g#":8,gx:9,abb:7,ab:8,a:9,"a#":10,ax:11,bbb:9,bb:10,b:11,"b#":12,bx:13};return function(n){var r=t.exec(n),i=r[1],o=r[2],s=e[i.toLowerCase()];return s+(parseInt(o,10)+1)*12}}(),je=new WeakMap,Ui=function(){function t(e,n,r){je.set(this,r),this.midi=e.midi,this.velocity=e.velocity,this.noteOffVelocity=n.velocity,this.ticks=e.ticks,this.durationTicks=n.ticks-e.ticks}return Object.defineProperty(t.prototype,"name",{get:function(){return Ai(this.midi)},set:function(e){this.midi=Pi(e)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"octave",{get:function(){return Math.floor(this.midi/12)-1},set:function(e){var n=e-this.octave;this.midi+=n*12},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"pitch",{get:function(){return Or(this.midi)},set:function(e){this.midi=12*(this.octave+1)+Bi(e)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"duration",{get:function(){var e=je.get(this);return e.ticksToSeconds(this.ticks+this.durationTicks)-e.ticksToSeconds(this.ticks)},set:function(e){var n=je.get(this),r=n.secondsToTicks(this.time+e);this.durationTicks=r-this.ticks},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"time",{get:function(){var e=je.get(this);return e.ticksToSeconds(this.ticks)},set:function(e){var n=je.get(this);this.ticks=n.secondsToTicks(e)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"bars",{get:function(){var e=je.get(this);return e.ticksToMeasures(this.ticks)},enumerable:!1,configurable:!0}),t.prototype.toJSON=function(){return{duration:this.duration,durationTicks:this.durationTicks,midi:this.midi,name:this.name,ticks:this.ticks,time:this.time,velocity:this.velocity}},t}();Rt.Note=Ui;Object.defineProperty(tt,"__esModule",{value:!0});tt.Track=void 0;var Jt=Fe,Mi=_n,Fi=Ut,Ri=Mt,Xn=Ft,Di=Rt,pt=new WeakMap,Li=function(){function t(e,n){var r=this;if(this.name="",this.notes=[],this.controlChanges=(0,Fi.createControlChanges)(),this.pitchBends=[],pt.set(this,n),e){var i=e.find(function(l){return l.type==="trackName"});this.name=i?i.text:""}if(this.instrument=new Xn.Instrument(e,this),this.channel=0,e){for(var o=e.filter(function(l){return l.type==="noteOn"}),s=e.filter(function(l){return l.type==="noteOff"}),a=function(){var l=o.shift();u.channel=l.channel;var f=s.findIndex(function(m){return m.noteNumber===l.noteNumber&&m.absoluteTime>=l.absoluteTime});if(f!==-1){var d=s.splice(f,1)[0];u.addNote({durationTicks:d.absoluteTime-l.absoluteTime,midi:l.noteNumber,noteOffVelocity:d.velocity/127,ticks:l.absoluteTime,velocity:l.velocity/127})}},u=this;o.length;)a();var c=e.filter(function(l){return l.type==="controller"});c.forEach(function(l){r.addCC({number:l.controllerType,ticks:l.absoluteTime,value:l.value/127})});var p=e.filter(function(l){return l.type==="pitchBend"});p.forEach(function(l){r.addPitchBend({ticks:l.absoluteTime,value:l.value/Math.pow(2,13)})});var h=e.find(function(l){return l.type==="endOfTrack"});this.endOfTrackTicks=h!==void 0?h.absoluteTime:void 0}}return t.prototype.addNote=function(e){var n=pt.get(this),r=new Di.Note({midi:0,ticks:0,velocity:1},{ticks:0,velocity:0},n);return Object.assign(r,e),(0,Jt.insert)(this.notes,r,"ticks"),this},t.prototype.addCC=function(e){var n=pt.get(this),r=new Mi.ControlChange({controllerType:e.number},n);return delete e.number,Object.assign(r,e),Array.isArray(this.controlChanges[r.number])||(this.controlChanges[r.number]=[]),(0,Jt.insert)(this.controlChanges[r.number],r,"ticks"),this},t.prototype.addPitchBend=function(e){var n=pt.get(this),r=new Ri.PitchBend({},n);return Object.assign(r,e),(0,Jt.insert)(this.pitchBends,r,"ticks"),this},Object.defineProperty(t.prototype,"duration",{get:function(){if(!this.notes.length)return 0;for(var e=this.notes[this.notes.length-1].time+this.notes[this.notes.length-1].duration,n=0;n<this.notes.length-1;n++){var r=this.notes[n].time+this.notes[n].duration;e<r&&(e=r)}return e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"durationTicks",{get:function(){if(!this.notes.length)return 0;for(var e=this.notes[this.notes.length-1].ticks+this.notes[this.notes.length-1].durationTicks,n=0;n<this.notes.length-1;n++){var r=this.notes[n].ticks+this.notes[n].durationTicks;e<r&&(e=r)}return e},enumerable:!1,configurable:!0}),t.prototype.fromJSON=function(e){var n=this;this.name=e.name,this.channel=e.channel,this.instrument=new Xn.Instrument(void 0,this),this.instrument.fromJSON(e.instrument),e.endOfTrackTicks!==void 0&&(this.endOfTrackTicks=e.endOfTrackTicks);for(var r in e.controlChanges)e.controlChanges[r]&&e.controlChanges[r].forEach(function(i){n.addCC({number:i.number,ticks:i.ticks,value:i.value})});e.notes.forEach(function(i){n.addNote({durationTicks:i.durationTicks,midi:i.midi,ticks:i.ticks,velocity:i.velocity})})},t.prototype.toJSON=function(){for(var e={},n=0;n<127;n++)this.controlChanges.hasOwnProperty(n)&&(e[n]=this.controlChanges[n].map(function(i){return i.toJSON()}));var r={channel:this.channel,controlChanges:e,pitchBends:this.pitchBends.map(function(i){return i.toJSON()}),instrument:this.instrument.toJSON(),name:this.name,notes:this.notes.map(function(i){return i.toJSON()})};return this.endOfTrackTicks!==void 0&&(r.endOfTrackTicks=this.endOfTrackTicks),r},t}();tt.Track=Li;var Dt={};function qi(t){var e=[];return Nr(t,e),e}function Nr(t,e){for(var n=0;n<t.length;n++){var r=t[n];Array.isArray(r)?Nr(r,e):e.push(r)}}const Vi=Object.freeze(Object.defineProperty({__proto__:null,flatten:qi},Symbol.toStringTag,{value:"Module"})),ji=Ir(Vi);var Ce=He&&He.__spreadArray||function(t,e,n){if(n||arguments.length===2)for(var r=0,i=e.length,o;r<i;r++)(o||!(r in e))&&(o||(o=Array.prototype.slice.call(e,0,r)),o[r]=e[r]);return t.concat(o||Array.prototype.slice.call(e))};Object.defineProperty(Dt,"__esModule",{value:!0});Dt.encode=void 0;var Ki=Pt,Hi=Nt,$i=ji;function zi(t,e){return[{absoluteTime:t.ticks,channel:e,deltaTime:0,noteNumber:t.midi,type:"noteOn",velocity:Math.floor(t.velocity*127)},{absoluteTime:t.ticks+t.durationTicks,channel:e,deltaTime:0,noteNumber:t.midi,type:"noteOff",velocity:Math.floor(t.noteOffVelocity*127)}]}function Ji(t){return(0,$i.flatten)(t.notes.map(function(e){return zi(e,t.channel)}))}function Gi(t,e){return{absoluteTime:t.ticks,channel:e,controllerType:t.number,deltaTime:0,type:"controller",value:Math.floor(t.value*127)}}function Wi(t){for(var e=[],n=0;n<127;n++)t.controlChanges.hasOwnProperty(n)&&t.controlChanges[n].forEach(function(r){e.push(Gi(r,t.channel))});return e}function Yi(t,e){return{absoluteTime:t.ticks,channel:e,deltaTime:0,type:"pitchBend",value:t.value}}function Xi(t){var e=[];return t.pitchBends.forEach(function(n){e.push(Yi(n,t.channel))}),e}function Qi(t){return{absoluteTime:0,channel:t.channel,deltaTime:0,programNumber:t.instrument.number,type:"programChange"}}function Zi(t){return{absoluteTime:0,deltaTime:0,meta:!0,text:t,type:"trackName"}}function es(t){return{absoluteTime:t.ticks,deltaTime:0,meta:!0,microsecondsPerBeat:Math.floor(6e7/t.bpm),type:"setTempo"}}function ts(t){return{absoluteTime:t.ticks,deltaTime:0,denominator:t.timeSignature[1],meta:!0,metronome:24,numerator:t.timeSignature[0],thirtyseconds:8,type:"timeSignature"}}function ns(t){var e=Hi.keySignatureKeys.indexOf(t.key);return{absoluteTime:t.ticks,deltaTime:0,key:e+7,meta:!0,scale:t.scale==="major"?0:1,type:"keySignature"}}function rs(t){return{absoluteTime:t.ticks,deltaTime:0,meta:!0,text:t.text,type:t.type}}function is(t){var e={header:{format:1,numTracks:t.tracks.length+1,ticksPerBeat:t.header.ppq},tracks:Ce([Ce(Ce(Ce(Ce([{absoluteTime:0,deltaTime:0,meta:!0,text:t.header.name,type:"trackName"}],t.header.keySignatures.map(function(n){return ns(n)}),!0),t.header.meta.map(function(n){return rs(n)}),!0),t.header.tempos.map(function(n){return es(n)}),!0),t.header.timeSignatures.map(function(n){return ts(n)}),!0)],t.tracks.map(function(n){return Ce(Ce(Ce([Zi(n.name),Qi(n)],Ji(n),!0),Wi(n),!0),Xi(n),!0)}),!0)};return e.tracks=e.tracks.map(function(n){n=n.sort(function(i,o){return i.absoluteTime-o.absoluteTime});var r=0;return n.forEach(function(i){i.deltaTime=i.absoluteTime-r,r=i.absoluteTime,delete i.absoluteTime}),n.push({deltaTime:0,meta:!0,type:"endOfTrack"}),n}),new Uint8Array((0,Ki.writeMidi)(e))}Dt.encode=is;(function(t){var e=He&&He.__awaiter||function(h,l,f,d){function m(y){return y instanceof f?y:new f(function(S){S(y)})}return new(f||(f=Promise))(function(y,S){function j(N){try{w(d.next(N))}catch(K){S(K)}}function F(N){try{w(d.throw(N))}catch(K){S(K)}}function w(N){N.done?y(N.value):m(N.value).then(j,F)}w((d=d.apply(h,l||[])).next())})},n=He&&He.__generator||function(h,l){var f={label:0,sent:function(){if(y[0]&1)throw y[1];return y[1]},trys:[],ops:[]},d,m,y,S;return S={next:j(0),throw:j(1),return:j(2)},typeof Symbol=="function"&&(S[Symbol.iterator]=function(){return this}),S;function j(w){return function(N){return F([w,N])}}function F(w){if(d)throw new TypeError("Generator is already executing.");for(;f;)try{if(d=1,m&&(y=w[0]&2?m.return:w[0]?m.throw||((y=m.return)&&y.call(m),0):m.next)&&!(y=y.call(m,w[1])).done)return y;switch(m=0,y&&(w=[w[0]&2,y.value]),w[0]){case 0:case 1:y=w;break;case 4:return f.label++,{value:w[1],done:!1};case 5:f.label++,m=w[1],w=[0];continue;case 7:w=f.ops.pop(),f.trys.pop();continue;default:if(y=f.trys,!(y=y.length>0&&y[y.length-1])&&(w[0]===6||w[0]===2)){f=0;continue}if(w[0]===3&&(!y||w[1]>y[0]&&w[1]<y[3])){f.label=w[1];break}if(w[0]===6&&f.label<y[1]){f.label=y[1],y=w;break}if(y&&f.label<y[2]){f.label=y[2],f.ops.push(w);break}y[2]&&f.ops.pop(),f.trys.pop();continue}w=l.call(h,f)}catch(N){w=[6,N],m=0}finally{d=y=0}if(w[0]&5)throw w[1];return{value:w[0]?w[1]:void 0,done:!0}}};Object.defineProperty(t,"__esModule",{value:!0}),t.Header=t.Track=t.Midi=void 0;var r=Pt,i=Nt,o=tt,s=Dt,a=function(){function h(l){var f=this,d=null;if(l){var m=l instanceof ArrayBuffer?new Uint8Array(l):l;d=(0,r.parseMidi)(m),d.tracks.forEach(function(y){var S=0;y.forEach(function(j){S+=j.deltaTime,j.absoluteTime=S})}),d.tracks=p(d.tracks)}this.header=new i.Header(d),this.tracks=[],l&&(this.tracks=d.tracks.map(function(y){return new o.Track(y,f.header)}),d.header.format===1&&this.tracks[0].duration===0&&this.tracks.shift())}return h.fromUrl=function(l){return e(this,void 0,void 0,function(){var f,d;return n(this,function(m){switch(m.label){case 0:return[4,fetch(l)];case 1:return f=m.sent(),f.ok?[4,f.arrayBuffer()]:[3,3];case 2:return d=m.sent(),[2,new h(d)];case 3:throw new Error("Could not load '".concat(l,"'"))}})})},Object.defineProperty(h.prototype,"name",{get:function(){return this.header.name},set:function(l){this.header.name=l},enumerable:!1,configurable:!0}),Object.defineProperty(h.prototype,"duration",{get:function(){var l=this.tracks.map(function(f){return f.duration});return Math.max.apply(Math,l)},enumerable:!1,configurable:!0}),Object.defineProperty(h.prototype,"durationTicks",{get:function(){var l=this.tracks.map(function(f){return f.durationTicks});return Math.max.apply(Math,l)},enumerable:!1,configurable:!0}),h.prototype.addTrack=function(){var l=new o.Track(void 0,this.header);return this.tracks.push(l),l},h.prototype.toArray=function(){return(0,s.encode)(this)},h.prototype.toJSON=function(){return{header:this.header.toJSON(),tracks:this.tracks.map(function(l){return l.toJSON()})}},h.prototype.fromJSON=function(l){var f=this;this.header=new i.Header,this.header.fromJSON(l.header),this.tracks=l.tracks.map(function(d){var m=new o.Track(void 0,f.header);return m.fromJSON(d),m})},h.prototype.clone=function(){var l=new h;return l.fromJSON(this.toJSON()),l},h}();t.Midi=a;var u=tt;Object.defineProperty(t,"Track",{enumerable:!0,get:function(){return u.Track}});var c=Nt;Object.defineProperty(t,"Header",{enumerable:!0,get:function(){return c.Header}});function p(h){for(var l=[],f=0;f<h.length;f++)for(var d=l.length,m=new Map,y=Array(16).fill(0),S=0,j=h[f];S<j.length;S++){var F=j[S],w=d,N=F.channel;if(N!==void 0){F.type==="programChange"&&(y[N]=F.programNumber);var K=y[N],T="".concat(K," ").concat(N);m.has(T)?w=m.get(T):(w=d+m.size,m.set(T,w))}l[w]||l.push([]),l[w].push(F)}return l}})(Sr);const Xe=["C","C#","D","D#","E","F","F#","G","G#","A","A#","B"],Qn={Backquote:"A#2",Tab:"B2",KeyQ:"C3",Digit2:"C#3",KeyW:"D3",Digit3:"D#3",KeyE:"E3",KeyR:"F3",Digit5:"F#3",KeyT:"G3",Digit6:"G#3",KeyY:"A3",Digit7:"A#3",KeyU:"B3",KeyI:"C4",Digit9:"C#4",KeyO:"D4",Digit0:"D#4",KeyP:"E4",BracketLeft:"F4",Equal:"F#4",BracketRight:"G4",Backspace:"G#4",Backslash:"A4",CapsLock:"A#4",ShiftLeft:"B4",KeyZ:"C5",KeyS:"C#5",KeyX:"D5",KeyD:"D#5",KeyC:"E5",KeyV:"F5",KeyG:"F#5",KeyB:"G5",KeyH:"G#5",KeyN:"A5",KeyJ:"A#5",KeyM:"B5",Comma:"C6",KeyL:"C#6",Period:"D6",Semicolon:"D#6",Slash:"E6",ShiftRight:"F6",Enter:"F#6"};function an(t){return parseInt(t.charAt(t.length-1))}function cn(t){return t.substring(0,t.length-1)}function Gt(t){const e=Math.floor(t/12)-1;return Xe[t%12]+e}function ss(t,e){const n=an(e),r=an(t),i=Xe.indexOf(cn(t)),o=Xe.indexOf(cn(e)),s={};let a=0;for(let u=r;u<=n;u++){let c=u===r?i:0;for(;c<Xe.length&&!(u===n&&c>o);){const h=Xe[c],l=h.length===1;s[h+u]={isWhite:l,pressedColor:null,isGhost:!1},l&&a++,c++}}return{noteMap:s,whiteKeys:a}}const ae=te(!1),Me=te(0),_t=te(0),un=te(),Ze=te(1);async function os(t,e){let n=[],r=null;function i(p){r=new Sr.Midi(p),r.tracks=r.tracks.filter(l=>l.notes.length!==0);let h=0;r.tracks.forEach(l=>{const f=l.notes[l.notes.length-1],d=f.time+f.duration;d>h&&(h=d)}),_t.set(h)}un.subscribe(p=>{if(ae.set(!1),_t.set(0),Me.set(0),!p){r=null;return}const h=new FileReader;h.onload=()=>i(h.result),h.readAsArrayBuffer(p)});function o(p){const h=we(Me)+p;Me.set(h),r.tracks.forEach((l,f)=>{for(;;){const d=l.notes[n[f]];if(!d||h<d.time)break;t(d.name,d.velocity),setTimeout(()=>e(d.name),d.duration*1e3/we(Ze)),n[f]++}}),h>we(_t)&&ae.set(!1)}let s;ae.subscribe(p=>{if(!p){clearInterval(s);return}if(!r)return ae.set(!1),alert("No MIDI file selected!");r.tracks.forEach((f,d)=>{const m=we(Me),y=as(f.notes,S=>S.time-m);n[d]=y});let h=performance.now();function l(){const f=performance.now(),d=f-h;h=f,o(d/1e3*we(Ze))}s=setInterval(l,10)});function a(p){const[h,l,f]=p.data;h>143&&h<160?f==0?e(Gt(l)):t(Gt(l),f/127):h>127&&h<144&&e(Gt(l))}const u=await navigator.requestMIDIAccess();function c(){u.inputs.forEach(p=>{p.onmidimessage=a})}c(),u.onstatechange=()=>{c()}}function as(t,e){let n=0,r=t.length-1;for(;n!=r;){const i=Math.ceil((n+r)/2);e(t[i])>0?r=i-1:n=i}return r}const me=Object.create(null);me.open="0";me.close="1";me.ping="2";me.pong="3";me.message="4";me.upgrade="5";me.noop="6";const kt=Object.create(null);Object.keys(me).forEach(t=>{kt[me[t]]=t});const cs={type:"error",data:"parser error"},us=typeof Blob=="function"||typeof Blob<"u"&&Object.prototype.toString.call(Blob)==="[object BlobConstructor]",ls=typeof ArrayBuffer=="function",fs=t=>typeof ArrayBuffer.isView=="function"?ArrayBuffer.isView(t):t&&t.buffer instanceof ArrayBuffer,Er=({type:t,data:e},n,r)=>us&&e instanceof Blob?n?r(e):Zn(e,r):ls&&(e instanceof ArrayBuffer||fs(e))?n?r(e):Zn(new Blob([e]),r):r(me[t]+(e||"")),Zn=(t,e)=>{const n=new FileReader;return n.onload=function(){const r=n.result.split(",")[1];e("b"+r)},n.readAsDataURL(t)},er="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",Qe=typeof Uint8Array>"u"?[]:new Uint8Array(256);for(let t=0;t<er.length;t++)Qe[er.charCodeAt(t)]=t;const hs=t=>{let e=t.length*.75,n=t.length,r,i=0,o,s,a,u;t[t.length-1]==="="&&(e--,t[t.length-2]==="="&&e--);const c=new ArrayBuffer(e),p=new Uint8Array(c);for(r=0;r<n;r+=4)o=Qe[t.charCodeAt(r)],s=Qe[t.charCodeAt(r+1)],a=Qe[t.charCodeAt(r+2)],u=Qe[t.charCodeAt(r+3)],p[i++]=o<<2|s>>4,p[i++]=(s&15)<<4|a>>2,p[i++]=(a&3)<<6|u&63;return c},ds=typeof ArrayBuffer=="function",Ar=(t,e)=>{if(typeof t!="string")return{type:"message",data:Br(t,e)};const n=t.charAt(0);return n==="b"?{type:"message",data:ps(t.substring(1),e)}:kt[n]?t.length>1?{type:kt[n],data:t.substring(1)}:{type:kt[n]}:cs},ps=(t,e)=>{if(ds){const n=hs(t);return Br(n,e)}else return{base64:!0,data:t}},Br=(t,e)=>{switch(e){case"blob":return t instanceof ArrayBuffer?new Blob([t]):t;case"arraybuffer":default:return t}},Pr=String.fromCharCode(30),ms=(t,e)=>{const n=t.length,r=new Array(n);let i=0;t.forEach((o,s)=>{Er(o,!1,a=>{r[s]=a,++i===n&&e(r.join(Pr))})})},ys=(t,e)=>{const n=t.split(Pr),r=[];for(let i=0;i<n.length;i++){const o=Ar(n[i],e);if(r.push(o),o.type==="error")break}return r},Ur=4;function H(t){if(t)return gs(t)}function gs(t){for(var e in H.prototype)t[e]=H.prototype[e];return t}H.prototype.on=H.prototype.addEventListener=function(t,e){return this._callbacks=this._callbacks||{},(this._callbacks["$"+t]=this._callbacks["$"+t]||[]).push(e),this};H.prototype.once=function(t,e){function n(){this.off(t,n),e.apply(this,arguments)}return n.fn=e,this.on(t,n),this};H.prototype.off=H.prototype.removeListener=H.prototype.removeAllListeners=H.prototype.removeEventListener=function(t,e){if(this._callbacks=this._callbacks||{},arguments.length==0)return this._callbacks={},this;var n=this._callbacks["$"+t];if(!n)return this;if(arguments.length==1)return delete this._callbacks["$"+t],this;for(var r,i=0;i<n.length;i++)if(r=n[i],r===e||r.fn===e){n.splice(i,1);break}return n.length===0&&delete this._callbacks["$"+t],this};H.prototype.emit=function(t){this._callbacks=this._callbacks||{};for(var e=new Array(arguments.length-1),n=this._callbacks["$"+t],r=1;r<arguments.length;r++)e[r-1]=arguments[r];if(n){n=n.slice(0);for(var r=0,i=n.length;r<i;++r)n[r].apply(this,e)}return this};H.prototype.emitReserved=H.prototype.emit;H.prototype.listeners=function(t){return this._callbacks=this._callbacks||{},this._callbacks["$"+t]||[]};H.prototype.hasListeners=function(t){return!!this.listeners(t).length};const Ee=(()=>typeof self<"u"?self:typeof window<"u"?window:Function("return this")())();function Mr(t,...e){return e.reduce((n,r)=>(t.hasOwnProperty(r)&&(n[r]=t[r]),n),{})}const bs=setTimeout,vs=clearTimeout;function Lt(t,e){e.useNativeTimers?(t.setTimeoutFn=bs.bind(Ee),t.clearTimeoutFn=vs.bind(Ee)):(t.setTimeoutFn=setTimeout.bind(Ee),t.clearTimeoutFn=clearTimeout.bind(Ee))}const _s=1.33;function ks(t){return typeof t=="string"?ws(t):Math.ceil((t.byteLength||t.size)*_s)}function ws(t){let e=0,n=0;for(let r=0,i=t.length;r<i;r++)e=t.charCodeAt(r),e<128?n+=1:e<2048?n+=2:e<55296||e>=57344?n+=3:(r++,n+=4);return n}class Ts extends Error{constructor(e,n,r){super(e),this.description=n,this.context=r,this.type="TransportError"}}class Fr extends H{constructor(e){super(),this.writable=!1,Lt(this,e),this.opts=e,this.query=e.query,this.readyState="",this.socket=e.socket}onError(e,n,r){return super.emitReserved("error",new Ts(e,n,r)),this}open(){return(this.readyState==="closed"||this.readyState==="")&&(this.readyState="opening",this.doOpen()),this}close(){return(this.readyState==="opening"||this.readyState==="open")&&(this.doClose(),this.onClose()),this}send(e){this.readyState==="open"&&this.write(e)}onOpen(){this.readyState="open",this.writable=!0,super.emitReserved("open")}onData(e){const n=Ar(e,this.socket.binaryType);this.onPacket(n)}onPacket(e){super.emitReserved("packet",e)}onClose(e){this.readyState="closed",super.emitReserved("close",e)}}const Rr="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz-_".split(""),ln=64,xs={};let tr=0,mt=0,nr;function rr(t){let e="";do e=Rr[t%ln]+e,t=Math.floor(t/ln);while(t>0);return e}function Dr(){const t=rr(+new Date);return t!==nr?(tr=0,nr=t):t+"."+rr(tr++)}for(;mt<ln;mt++)xs[Rr[mt]]=mt;function Lr(t){let e="";for(let n in t)t.hasOwnProperty(n)&&(e.length&&(e+="&"),e+=encodeURIComponent(n)+"="+encodeURIComponent(t[n]));return e}function Is(t){let e={},n=t.split("&");for(let r=0,i=n.length;r<i;r++){let o=n[r].split("=");e[decodeURIComponent(o[0])]=decodeURIComponent(o[1])}return e}let qr=!1;try{qr=typeof XMLHttpRequest<"u"&&"withCredentials"in new XMLHttpRequest}catch{}const Ss=qr;function Vr(t){const e=t.xdomain;try{if(typeof XMLHttpRequest<"u"&&(!e||Ss))return new XMLHttpRequest}catch{}if(!e)try{return new Ee[["Active"].concat("Object").join("X")]("Microsoft.XMLHTTP")}catch{}}function Cs(){}const Os=function(){return new Vr({xdomain:!1}).responseType!=null}();class Ns extends Fr{constructor(e){if(super(e),this.polling=!1,typeof location<"u"){const r=location.protocol==="https:";let i=location.port;i||(i=r?"443":"80"),this.xd=typeof location<"u"&&e.hostname!==location.hostname||i!==e.port,this.xs=e.secure!==r}const n=e&&e.forceBase64;this.supportsBinary=Os&&!n}get name(){return"polling"}doOpen(){this.poll()}pause(e){this.readyState="pausing";const n=()=>{this.readyState="paused",e()};if(this.polling||!this.writable){let r=0;this.polling&&(r++,this.once("pollComplete",function(){--r||n()})),this.writable||(r++,this.once("drain",function(){--r||n()}))}else n()}poll(){this.polling=!0,this.doPoll(),this.emitReserved("poll")}onData(e){const n=r=>{if(this.readyState==="opening"&&r.type==="open"&&this.onOpen(),r.type==="close")return this.onClose({description:"transport closed by the server"}),!1;this.onPacket(r)};ys(e,this.socket.binaryType).forEach(n),this.readyState!=="closed"&&(this.polling=!1,this.emitReserved("pollComplete"),this.readyState==="open"&&this.poll())}doClose(){const e=()=>{this.write([{type:"close"}])};this.readyState==="open"?e():this.once("open",e)}write(e){this.writable=!1,ms(e,n=>{this.doWrite(n,()=>{this.writable=!0,this.emitReserved("drain")})})}uri(){let e=this.query||{};const n=this.opts.secure?"https":"http";let r="";this.opts.timestampRequests!==!1&&(e[this.opts.timestampParam]=Dr()),!this.supportsBinary&&!e.sid&&(e.b64=1),this.opts.port&&(n==="https"&&Number(this.opts.port)!==443||n==="http"&&Number(this.opts.port)!==80)&&(r=":"+this.opts.port);const i=Lr(e),o=this.opts.hostname.indexOf(":")!==-1;return n+"://"+(o?"["+this.opts.hostname+"]":this.opts.hostname)+r+this.opts.path+(i.length?"?"+i:"")}request(e={}){return Object.assign(e,{xd:this.xd,xs:this.xs},this.opts),new pe(this.uri(),e)}doWrite(e,n){const r=this.request({method:"POST",data:e});r.on("success",n),r.on("error",(i,o)=>{this.onError("xhr post error",i,o)})}doPoll(){const e=this.request();e.on("data",this.onData.bind(this)),e.on("error",(n,r)=>{this.onError("xhr poll error",n,r)}),this.pollXhr=e}}class pe extends H{constructor(e,n){super(),Lt(this,n),this.opts=n,this.method=n.method||"GET",this.uri=e,this.async=n.async!==!1,this.data=n.data!==void 0?n.data:null,this.create()}create(){const e=Mr(this.opts,"agent","pfx","key","passphrase","cert","ca","ciphers","rejectUnauthorized","autoUnref");e.xdomain=!!this.opts.xd,e.xscheme=!!this.opts.xs;const n=this.xhr=new Vr(e);try{n.open(this.method,this.uri,this.async);try{if(this.opts.extraHeaders){n.setDisableHeaderCheck&&n.setDisableHeaderCheck(!0);for(let r in this.opts.extraHeaders)this.opts.extraHeaders.hasOwnProperty(r)&&n.setRequestHeader(r,this.opts.extraHeaders[r])}}catch{}if(this.method==="POST")try{n.setRequestHeader("Content-type","text/plain;charset=UTF-8")}catch{}try{n.setRequestHeader("Accept","*/*")}catch{}"withCredentials"in n&&(n.withCredentials=this.opts.withCredentials),this.opts.requestTimeout&&(n.timeout=this.opts.requestTimeout),n.onreadystatechange=()=>{n.readyState===4&&(n.status===200||n.status===1223?this.onLoad():this.setTimeoutFn(()=>{this.onError(typeof n.status=="number"?n.status:0)},0))},n.send(this.data)}catch(r){this.setTimeoutFn(()=>{this.onError(r)},0);return}typeof document<"u"&&(this.index=pe.requestsCount++,pe.requests[this.index]=this)}onError(e){this.emitReserved("error",e,this.xhr),this.cleanup(!0)}cleanup(e){if(!(typeof this.xhr>"u"||this.xhr===null)){if(this.xhr.onreadystatechange=Cs,e)try{this.xhr.abort()}catch{}typeof document<"u"&&delete pe.requests[this.index],this.xhr=null}}onLoad(){const e=this.xhr.responseText;e!==null&&(this.emitReserved("data",e),this.emitReserved("success"),this.cleanup())}abort(){this.cleanup()}}pe.requestsCount=0;pe.requests={};if(typeof document<"u"){if(typeof attachEvent=="function")attachEvent("onunload",ir);else if(typeof addEventListener=="function"){const t="onpagehide"in Ee?"pagehide":"unload";addEventListener(t,ir,!1)}}function ir(){for(let t in pe.requests)pe.requests.hasOwnProperty(t)&&pe.requests[t].abort()}const Es=(()=>typeof Promise=="function"&&typeof Promise.resolve=="function"?e=>Promise.resolve().then(e):(e,n)=>n(e,0))(),yt=Ee.WebSocket||Ee.MozWebSocket,sr=!0,As="arraybuffer",or=typeof navigator<"u"&&typeof navigator.product=="string"&&navigator.product.toLowerCase()==="reactnative";class Bs extends Fr{constructor(e){super(e),this.supportsBinary=!e.forceBase64}get name(){return"websocket"}doOpen(){if(!this.check())return;const e=this.uri(),n=this.opts.protocols,r=or?{}:Mr(this.opts,"agent","perMessageDeflate","pfx","key","passphrase","cert","ca","ciphers","rejectUnauthorized","localAddress","protocolVersion","origin","maxPayload","family","checkServerIdentity");this.opts.extraHeaders&&(r.headers=this.opts.extraHeaders);try{this.ws=sr&&!or?n?new yt(e,n):new yt(e):new yt(e,n,r)}catch(i){return this.emitReserved("error",i)}this.ws.binaryType=this.socket.binaryType||As,this.addEventListeners()}addEventListeners(){this.ws.onopen=()=>{this.opts.autoUnref&&this.ws._socket.unref(),this.onOpen()},this.ws.onclose=e=>this.onClose({description:"websocket connection closed",context:e}),this.ws.onmessage=e=>this.onData(e.data),this.ws.onerror=e=>this.onError("websocket error",e)}write(e){this.writable=!1;for(let n=0;n<e.length;n++){const r=e[n],i=n===e.length-1;Er(r,this.supportsBinary,o=>{const s={};try{sr&&this.ws.send(o)}catch{}i&&Es(()=>{this.writable=!0,this.emitReserved("drain")},this.setTimeoutFn)})}}doClose(){typeof this.ws<"u"&&(this.ws.close(),this.ws=null)}uri(){let e=this.query||{};const n=this.opts.secure?"wss":"ws";let r="";this.opts.port&&(n==="wss"&&Number(this.opts.port)!==443||n==="ws"&&Number(this.opts.port)!==80)&&(r=":"+this.opts.port),this.opts.timestampRequests&&(e[this.opts.timestampParam]=Dr()),this.supportsBinary||(e.b64=1);const i=Lr(e),o=this.opts.hostname.indexOf(":")!==-1;return n+"://"+(o?"["+this.opts.hostname+"]":this.opts.hostname)+r+this.opts.path+(i.length?"?"+i:"")}check(){return!!yt}}const Ps={websocket:Bs,polling:Ns},Us=/^(?:(?![^:@]+:[^:@\/]*@)(http|https|ws|wss):\/\/)?((?:(([^:@]*)(?::([^:@]*))?)?@)?((?:[a-f0-9]{0,4}:){2,7}[a-f0-9]{0,4}|[^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/,Ms=["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"];function fn(t){const e=t,n=t.indexOf("["),r=t.indexOf("]");n!=-1&&r!=-1&&(t=t.substring(0,n)+t.substring(n,r).replace(/:/g,";")+t.substring(r,t.length));let i=Us.exec(t||""),o={},s=14;for(;s--;)o[Ms[s]]=i[s]||"";return n!=-1&&r!=-1&&(o.source=e,o.host=o.host.substring(1,o.host.length-1).replace(/;/g,":"),o.authority=o.authority.replace("[","").replace("]","").replace(/;/g,":"),o.ipv6uri=!0),o.pathNames=Fs(o,o.path),o.queryKey=Rs(o,o.query),o}function Fs(t,e){const n=/\/{2,9}/g,r=e.replace(n,"/").split("/");return(e.substr(0,1)=="/"||e.length===0)&&r.splice(0,1),e.substr(e.length-1,1)=="/"&&r.splice(r.length-1,1),r}function Rs(t,e){const n={};return e.replace(/(?:^|&)([^&=]*)=?([^&]*)/g,function(r,i,o){i&&(n[i]=o)}),n}class Ne extends H{constructor(e,n={}){super(),e&&typeof e=="object"&&(n=e,e=null),e?(e=fn(e),n.hostname=e.host,n.secure=e.protocol==="https"||e.protocol==="wss",n.port=e.port,e.query&&(n.query=e.query)):n.host&&(n.hostname=fn(n.host).host),Lt(this,n),this.secure=n.secure!=null?n.secure:typeof location<"u"&&location.protocol==="https:",n.hostname&&!n.port&&(n.port=this.secure?"443":"80"),this.hostname=n.hostname||(typeof location<"u"?location.hostname:"localhost"),this.port=n.port||(typeof location<"u"&&location.port?location.port:this.secure?"443":"80"),this.transports=n.transports||["polling","websocket"],this.readyState="",this.writeBuffer=[],this.prevBufferLen=0,this.opts=Object.assign({path:"/engine.io",agent:!1,withCredentials:!1,upgrade:!0,timestampParam:"t",rememberUpgrade:!1,rejectUnauthorized:!0,perMessageDeflate:{threshold:1024},transportOptions:{},closeOnBeforeunload:!0},n),this.opts.path=this.opts.path.replace(/\/$/,"")+"/",typeof this.opts.query=="string"&&(this.opts.query=Is(this.opts.query)),this.id=null,this.upgrades=null,this.pingInterval=null,this.pingTimeout=null,this.pingTimeoutTimer=null,typeof addEventListener=="function"&&(this.opts.closeOnBeforeunload&&addEventListener("beforeunload",()=>{this.transport&&(this.transport.removeAllListeners(),this.transport.close())},!1),this.hostname!=="localhost"&&(this.offlineEventListener=()=>{this.onClose("transport close",{description:"network connection lost"})},addEventListener("offline",this.offlineEventListener,!1))),this.open()}createTransport(e){const n=Object.assign({},this.opts.query);n.EIO=Ur,n.transport=e,this.id&&(n.sid=this.id);const r=Object.assign({},this.opts.transportOptions[e],this.opts,{query:n,socket:this,hostname:this.hostname,secure:this.secure,port:this.port});return new Ps[e](r)}open(){let e;if(this.opts.rememberUpgrade&&Ne.priorWebsocketSuccess&&this.transports.indexOf("websocket")!==-1)e="websocket";else if(this.transports.length===0){this.setTimeoutFn(()=>{this.emitReserved("error","No transports available")},0);return}else e=this.transports[0];this.readyState="opening";try{e=this.createTransport(e)}catch{this.transports.shift(),this.open();return}e.open(),this.setTransport(e)}setTransport(e){this.transport&&this.transport.removeAllListeners(),this.transport=e,e.on("drain",this.onDrain.bind(this)).on("packet",this.onPacket.bind(this)).on("error",this.onError.bind(this)).on("close",n=>this.onClose("transport close",n))}probe(e){let n=this.createTransport(e),r=!1;Ne.priorWebsocketSuccess=!1;const i=()=>{r||(n.send([{type:"ping",data:"probe"}]),n.once("packet",h=>{if(!r)if(h.type==="pong"&&h.data==="probe"){if(this.upgrading=!0,this.emitReserved("upgrading",n),!n)return;Ne.priorWebsocketSuccess=n.name==="websocket",this.transport.pause(()=>{r||this.readyState!=="closed"&&(p(),this.setTransport(n),n.send([{type:"upgrade"}]),this.emitReserved("upgrade",n),n=null,this.upgrading=!1,this.flush())})}else{const l=new Error("probe error");l.transport=n.name,this.emitReserved("upgradeError",l)}}))};function o(){r||(r=!0,p(),n.close(),n=null)}const s=h=>{const l=new Error("probe error: "+h);l.transport=n.name,o(),this.emitReserved("upgradeError",l)};function a(){s("transport closed")}function u(){s("socket closed")}function c(h){n&&h.name!==n.name&&o()}const p=()=>{n.removeListener("open",i),n.removeListener("error",s),n.removeListener("close",a),this.off("close",u),this.off("upgrading",c)};n.once("open",i),n.once("error",s),n.once("close",a),this.once("close",u),this.once("upgrading",c),n.open()}onOpen(){if(this.readyState="open",Ne.priorWebsocketSuccess=this.transport.name==="websocket",this.emitReserved("open"),this.flush(),this.readyState==="open"&&this.opts.upgrade&&this.transport.pause){let e=0;const n=this.upgrades.length;for(;e<n;e++)this.probe(this.upgrades[e])}}onPacket(e){if(this.readyState==="opening"||this.readyState==="open"||this.readyState==="closing")switch(this.emitReserved("packet",e),this.emitReserved("heartbeat"),e.type){case"open":this.onHandshake(JSON.parse(e.data));break;case"ping":this.resetPingTimeout(),this.sendPacket("pong"),this.emitReserved("ping"),this.emitReserved("pong");break;case"error":const n=new Error("server error");n.code=e.data,this.onError(n);break;case"message":this.emitReserved("data",e.data),this.emitReserved("message",e.data);break}}onHandshake(e){this.emitReserved("handshake",e),this.id=e.sid,this.transport.query.sid=e.sid,this.upgrades=this.filterUpgrades(e.upgrades),this.pingInterval=e.pingInterval,this.pingTimeout=e.pingTimeout,this.maxPayload=e.maxPayload,this.onOpen(),this.readyState!=="closed"&&this.resetPingTimeout()}resetPingTimeout(){this.clearTimeoutFn(this.pingTimeoutTimer),this.pingTimeoutTimer=this.setTimeoutFn(()=>{this.onClose("ping timeout")},this.pingInterval+this.pingTimeout),this.opts.autoUnref&&this.pingTimeoutTimer.unref()}onDrain(){this.writeBuffer.splice(0,this.prevBufferLen),this.prevBufferLen=0,this.writeBuffer.length===0?this.emitReserved("drain"):this.flush()}flush(){if(this.readyState!=="closed"&&this.transport.writable&&!this.upgrading&&this.writeBuffer.length){const e=this.getWritablePackets();this.transport.send(e),this.prevBufferLen=e.length,this.emitReserved("flush")}}getWritablePackets(){if(!(this.maxPayload&&this.transport.name==="polling"&&this.writeBuffer.length>1))return this.writeBuffer;let n=1;for(let r=0;r<this.writeBuffer.length;r++){const i=this.writeBuffer[r].data;if(i&&(n+=ks(i)),r>0&&n>this.maxPayload)return this.writeBuffer.slice(0,r);n+=2}return this.writeBuffer}write(e,n,r){return this.sendPacket("message",e,n,r),this}send(e,n,r){return this.sendPacket("message",e,n,r),this}sendPacket(e,n,r,i){if(typeof n=="function"&&(i=n,n=void 0),typeof r=="function"&&(i=r,r=null),this.readyState==="closing"||this.readyState==="closed")return;r=r||{},r.compress=r.compress!==!1;const o={type:e,data:n,options:r};this.emitReserved("packetCreate",o),this.writeBuffer.push(o),i&&this.once("flush",i),this.flush()}close(){const e=()=>{this.onClose("forced close"),this.transport.close()},n=()=>{this.off("upgrade",n),this.off("upgradeError",n),e()},r=()=>{this.once("upgrade",n),this.once("upgradeError",n)};return(this.readyState==="opening"||this.readyState==="open")&&(this.readyState="closing",this.writeBuffer.length?this.once("drain",()=>{this.upgrading?r():e()}):this.upgrading?r():e()),this}onError(e){Ne.priorWebsocketSuccess=!1,this.emitReserved("error",e),this.onClose("transport error",e)}onClose(e,n){(this.readyState==="opening"||this.readyState==="open"||this.readyState==="closing")&&(this.clearTimeoutFn(this.pingTimeoutTimer),this.transport.removeAllListeners("close"),this.transport.close(),this.transport.removeAllListeners(),typeof removeEventListener=="function"&&removeEventListener("offline",this.offlineEventListener,!1),this.readyState="closed",this.id=null,this.emitReserved("close",e,n),this.writeBuffer=[],this.prevBufferLen=0)}filterUpgrades(e){const n=[];let r=0;const i=e.length;for(;r<i;r++)~this.transports.indexOf(e[r])&&n.push(e[r]);return n}}Ne.protocol=Ur;function Ds(t,e="",n){let r=t;n=n||typeof location<"u"&&location,t==null&&(t=n.protocol+"//"+n.host),typeof t=="string"&&(t.charAt(0)==="/"&&(t.charAt(1)==="/"?t=n.protocol+t:t=n.host+t),/^(https?|wss?):\/\//.test(t)||(typeof n<"u"?t=n.protocol+"//"+t:t="https://"+t),r=fn(t)),r.port||(/^(http|ws)$/.test(r.protocol)?r.port="80":/^(http|ws)s$/.test(r.protocol)&&(r.port="443")),r.path=r.path||"/";const o=r.host.indexOf(":")!==-1?"["+r.host+"]":r.host;return r.id=r.protocol+"://"+o+":"+r.port+e,r.href=r.protocol+"://"+o+(n&&n.port===r.port?"":":"+r.port),r}const Ls=typeof ArrayBuffer=="function",qs=t=>typeof ArrayBuffer.isView=="function"?ArrayBuffer.isView(t):t.buffer instanceof ArrayBuffer,jr=Object.prototype.toString,Vs=typeof Blob=="function"||typeof Blob<"u"&&jr.call(Blob)==="[object BlobConstructor]",js=typeof File=="function"||typeof File<"u"&&jr.call(File)==="[object FileConstructor]";function kn(t){return Ls&&(t instanceof ArrayBuffer||qs(t))||Vs&&t instanceof Blob||js&&t instanceof File}function wt(t,e){if(!t||typeof t!="object")return!1;if(Array.isArray(t)){for(let n=0,r=t.length;n<r;n++)if(wt(t[n]))return!0;return!1}if(kn(t))return!0;if(t.toJSON&&typeof t.toJSON=="function"&&arguments.length===1)return wt(t.toJSON(),!0);for(const n in t)if(Object.prototype.hasOwnProperty.call(t,n)&&wt(t[n]))return!0;return!1}function Ks(t){const e=[],n=t.data,r=t;return r.data=hn(n,e),r.attachments=e.length,{packet:r,buffers:e}}function hn(t,e){if(!t)return t;if(kn(t)){const n={_placeholder:!0,num:e.length};return e.push(t),n}else if(Array.isArray(t)){const n=new Array(t.length);for(let r=0;r<t.length;r++)n[r]=hn(t[r],e);return n}else if(typeof t=="object"&&!(t instanceof Date)){const n={};for(const r in t)Object.prototype.hasOwnProperty.call(t,r)&&(n[r]=hn(t[r],e));return n}return t}function Hs(t,e){return t.data=dn(t.data,e),t.attachments=void 0,t}function dn(t,e){if(!t)return t;if(t&&t._placeholder===!0){if(typeof t.num=="number"&&t.num>=0&&t.num<e.length)return e[t.num];throw new Error("illegal attachments")}else if(Array.isArray(t))for(let n=0;n<t.length;n++)t[n]=dn(t[n],e);else if(typeof t=="object")for(const n in t)Object.prototype.hasOwnProperty.call(t,n)&&(t[n]=dn(t[n],e));return t}const $s=5;var O;(function(t){t[t.CONNECT=0]="CONNECT",t[t.DISCONNECT=1]="DISCONNECT",t[t.EVENT=2]="EVENT",t[t.ACK=3]="ACK",t[t.CONNECT_ERROR=4]="CONNECT_ERROR",t[t.BINARY_EVENT=5]="BINARY_EVENT",t[t.BINARY_ACK=6]="BINARY_ACK"})(O||(O={}));class zs{constructor(e){this.replacer=e}encode(e){return(e.type===O.EVENT||e.type===O.ACK)&&wt(e)?(e.type=e.type===O.EVENT?O.BINARY_EVENT:O.BINARY_ACK,this.encodeAsBinary(e)):[this.encodeAsString(e)]}encodeAsString(e){let n=""+e.type;return(e.type===O.BINARY_EVENT||e.type===O.BINARY_ACK)&&(n+=e.attachments+"-"),e.nsp&&e.nsp!=="/"&&(n+=e.nsp+","),e.id!=null&&(n+=e.id),e.data!=null&&(n+=JSON.stringify(e.data,this.replacer)),n}encodeAsBinary(e){const n=Ks(e),r=this.encodeAsString(n.packet),i=n.buffers;return i.unshift(r),i}}class wn extends H{constructor(e){super(),this.reviver=e}add(e){let n;if(typeof e=="string"){if(this.reconstructor)throw new Error("got plaintext data when reconstructing a packet");n=this.decodeString(e),n.type===O.BINARY_EVENT||n.type===O.BINARY_ACK?(this.reconstructor=new Js(n),n.attachments===0&&super.emitReserved("decoded",n)):super.emitReserved("decoded",n)}else if(kn(e)||e.base64)if(this.reconstructor)n=this.reconstructor.takeBinaryData(e),n&&(this.reconstructor=null,super.emitReserved("decoded",n));else throw new Error("got binary data when not reconstructing a packet");else throw new Error("Unknown type: "+e)}decodeString(e){let n=0;const r={type:Number(e.charAt(0))};if(O[r.type]===void 0)throw new Error("unknown packet type "+r.type);if(r.type===O.BINARY_EVENT||r.type===O.BINARY_ACK){const o=n+1;for(;e.charAt(++n)!=="-"&&n!=e.length;);const s=e.substring(o,n);if(s!=Number(s)||e.charAt(n)!=="-")throw new Error("Illegal attachments");r.attachments=Number(s)}if(e.charAt(n+1)==="/"){const o=n+1;for(;++n&&!(e.charAt(n)===","||n===e.length););r.nsp=e.substring(o,n)}else r.nsp="/";const i=e.charAt(n+1);if(i!==""&&Number(i)==i){const o=n+1;for(;++n;){const s=e.charAt(n);if(s==null||Number(s)!=s){--n;break}if(n===e.length)break}r.id=Number(e.substring(o,n+1))}if(e.charAt(++n)){const o=this.tryParse(e.substr(n));if(wn.isPayloadValid(r.type,o))r.data=o;else throw new Error("invalid payload")}return r}tryParse(e){try{return JSON.parse(e,this.reviver)}catch{return!1}}static isPayloadValid(e,n){switch(e){case O.CONNECT:return typeof n=="object";case O.DISCONNECT:return n===void 0;case O.CONNECT_ERROR:return typeof n=="string"||typeof n=="object";case O.EVENT:case O.BINARY_EVENT:return Array.isArray(n)&&n.length>0;case O.ACK:case O.BINARY_ACK:return Array.isArray(n)}}destroy(){this.reconstructor&&this.reconstructor.finishedReconstruction()}}class Js{constructor(e){this.packet=e,this.buffers=[],this.reconPack=e}takeBinaryData(e){if(this.buffers.push(e),this.buffers.length===this.reconPack.attachments){const n=Hs(this.reconPack,this.buffers);return this.finishedReconstruction(),n}return null}finishedReconstruction(){this.reconPack=null,this.buffers=[]}}const Gs=Object.freeze(Object.defineProperty({__proto__:null,protocol:$s,get PacketType(){return O},Encoder:zs,Decoder:wn},Symbol.toStringTag,{value:"Module"}));function ce(t,e,n){return t.on(e,n),function(){t.off(e,n)}}const Ws=Object.freeze({connect:1,connect_error:1,disconnect:1,disconnecting:1,newListener:1,removeListener:1});class Kr extends H{constructor(e,n,r){super(),this.connected=!1,this.receiveBuffer=[],this.sendBuffer=[],this.ids=0,this.acks={},this.flags={},this.io=e,this.nsp=n,r&&r.auth&&(this.auth=r.auth),this.io._autoConnect&&this.open()}get disconnected(){return!this.connected}subEvents(){if(this.subs)return;const e=this.io;this.subs=[ce(e,"open",this.onopen.bind(this)),ce(e,"packet",this.onpacket.bind(this)),ce(e,"error",this.onerror.bind(this)),ce(e,"close",this.onclose.bind(this))]}get active(){return!!this.subs}connect(){return this.connected?this:(this.subEvents(),this.io._reconnecting||this.io.open(),this.io._readyState==="open"&&this.onopen(),this)}open(){return this.connect()}send(...e){return e.unshift("message"),this.emit.apply(this,e),this}emit(e,...n){if(Ws.hasOwnProperty(e))throw new Error('"'+e.toString()+'" is a reserved event name');n.unshift(e);const r={type:O.EVENT,data:n};if(r.options={},r.options.compress=this.flags.compress!==!1,typeof n[n.length-1]=="function"){const s=this.ids++,a=n.pop();this._registerAckCallback(s,a),r.id=s}const i=this.io.engine&&this.io.engine.transport&&this.io.engine.transport.writable;return this.flags.volatile&&(!i||!this.connected)||(this.connected?(this.notifyOutgoingListeners(r),this.packet(r)):this.sendBuffer.push(r)),this.flags={},this}_registerAckCallback(e,n){const r=this.flags.timeout;if(r===void 0){this.acks[e]=n;return}const i=this.io.setTimeoutFn(()=>{delete this.acks[e];for(let o=0;o<this.sendBuffer.length;o++)this.sendBuffer[o].id===e&&this.sendBuffer.splice(o,1);n.call(this,new Error("operation has timed out"))},r);this.acks[e]=(...o)=>{this.io.clearTimeoutFn(i),n.apply(this,[null,...o])}}packet(e){e.nsp=this.nsp,this.io._packet(e)}onopen(){typeof this.auth=="function"?this.auth(e=>{this.packet({type:O.CONNECT,data:e})}):this.packet({type:O.CONNECT,data:this.auth})}onerror(e){this.connected||this.emitReserved("connect_error",e)}onclose(e,n){this.connected=!1,delete this.id,this.emitReserved("disconnect",e,n)}onpacket(e){if(e.nsp===this.nsp)switch(e.type){case O.CONNECT:if(e.data&&e.data.sid){const i=e.data.sid;this.onconnect(i)}else this.emitReserved("connect_error",new Error("It seems you are trying to reach a Socket.IO server in v2.x with a v3.x client, but they are not compatible (more information here: https://socket.io/docs/v3/migrating-from-2-x-to-3-0/)"));break;case O.EVENT:case O.BINARY_EVENT:this.onevent(e);break;case O.ACK:case O.BINARY_ACK:this.onack(e);break;case O.DISCONNECT:this.ondisconnect();break;case O.CONNECT_ERROR:this.destroy();const r=new Error(e.data.message);r.data=e.data.data,this.emitReserved("connect_error",r);break}}onevent(e){const n=e.data||[];e.id!=null&&n.push(this.ack(e.id)),this.connected?this.emitEvent(n):this.receiveBuffer.push(Object.freeze(n))}emitEvent(e){if(this._anyListeners&&this._anyListeners.length){const n=this._anyListeners.slice();for(const r of n)r.apply(this,e)}super.emit.apply(this,e)}ack(e){const n=this;let r=!1;return function(...i){r||(r=!0,n.packet({type:O.ACK,id:e,data:i}))}}onack(e){const n=this.acks[e.id];typeof n=="function"&&(n.apply(this,e.data),delete this.acks[e.id])}onconnect(e){this.id=e,this.connected=!0,this.emitBuffered(),this.emitReserved("connect")}emitBuffered(){this.receiveBuffer.forEach(e=>this.emitEvent(e)),this.receiveBuffer=[],this.sendBuffer.forEach(e=>{this.notifyOutgoingListeners(e),this.packet(e)}),this.sendBuffer=[]}ondisconnect(){this.destroy(),this.onclose("io server disconnect")}destroy(){this.subs&&(this.subs.forEach(e=>e()),this.subs=void 0),this.io._destroy(this)}disconnect(){return this.connected&&this.packet({type:O.DISCONNECT}),this.destroy(),this.connected&&this.onclose("io client disconnect"),this}close(){return this.disconnect()}compress(e){return this.flags.compress=e,this}get volatile(){return this.flags.volatile=!0,this}timeout(e){return this.flags.timeout=e,this}onAny(e){return this._anyListeners=this._anyListeners||[],this._anyListeners.push(e),this}prependAny(e){return this._anyListeners=this._anyListeners||[],this._anyListeners.unshift(e),this}offAny(e){if(!this._anyListeners)return this;if(e){const n=this._anyListeners;for(let r=0;r<n.length;r++)if(e===n[r])return n.splice(r,1),this}else this._anyListeners=[];return this}listenersAny(){return this._anyListeners||[]}onAnyOutgoing(e){return this._anyOutgoingListeners=this._anyOutgoingListeners||[],this._anyOutgoingListeners.push(e),this}prependAnyOutgoing(e){return this._anyOutgoingListeners=this._anyOutgoingListeners||[],this._anyOutgoingListeners.unshift(e),this}offAnyOutgoing(e){if(!this._anyOutgoingListeners)return this;if(e){const n=this._anyOutgoingListeners;for(let r=0;r<n.length;r++)if(e===n[r])return n.splice(r,1),this}else this._anyOutgoingListeners=[];return this}listenersAnyOutgoing(){return this._anyOutgoingListeners||[]}notifyOutgoingListeners(e){if(this._anyOutgoingListeners&&this._anyOutgoingListeners.length){const n=this._anyOutgoingListeners.slice();for(const r of n)r.apply(this,e.data)}}}function Je(t){t=t||{},this.ms=t.min||100,this.max=t.max||1e4,this.factor=t.factor||2,this.jitter=t.jitter>0&&t.jitter<=1?t.jitter:0,this.attempts=0}Je.prototype.duration=function(){var t=this.ms*Math.pow(this.factor,this.attempts++);if(this.jitter){var e=Math.random(),n=Math.floor(e*this.jitter*t);t=(Math.floor(e*10)&1)==0?t-n:t+n}return Math.min(t,this.max)|0};Je.prototype.reset=function(){this.attempts=0};Je.prototype.setMin=function(t){this.ms=t};Je.prototype.setMax=function(t){this.max=t};Je.prototype.setJitter=function(t){this.jitter=t};class pn extends H{constructor(e,n){var r;super(),this.nsps={},this.subs=[],e&&typeof e=="object"&&(n=e,e=void 0),n=n||{},n.path=n.path||"/socket.io",this.opts=n,Lt(this,n),this.reconnection(n.reconnection!==!1),this.reconnectionAttempts(n.reconnectionAttempts||1/0),this.reconnectionDelay(n.reconnectionDelay||1e3),this.reconnectionDelayMax(n.reconnectionDelayMax||5e3),this.randomizationFactor((r=n.randomizationFactor)!==null&&r!==void 0?r:.5),this.backoff=new Je({min:this.reconnectionDelay(),max:this.reconnectionDelayMax(),jitter:this.randomizationFactor()}),this.timeout(n.timeout==null?2e4:n.timeout),this._readyState="closed",this.uri=e;const i=n.parser||Gs;this.encoder=new i.Encoder,this.decoder=new i.Decoder,this._autoConnect=n.autoConnect!==!1,this._autoConnect&&this.open()}reconnection(e){return arguments.length?(this._reconnection=!!e,this):this._reconnection}reconnectionAttempts(e){return e===void 0?this._reconnectionAttempts:(this._reconnectionAttempts=e,this)}reconnectionDelay(e){var n;return e===void 0?this._reconnectionDelay:(this._reconnectionDelay=e,(n=this.backoff)===null||n===void 0||n.setMin(e),this)}randomizationFactor(e){var n;return e===void 0?this._randomizationFactor:(this._randomizationFactor=e,(n=this.backoff)===null||n===void 0||n.setJitter(e),this)}reconnectionDelayMax(e){var n;return e===void 0?this._reconnectionDelayMax:(this._reconnectionDelayMax=e,(n=this.backoff)===null||n===void 0||n.setMax(e),this)}timeout(e){return arguments.length?(this._timeout=e,this):this._timeout}maybeReconnectOnOpen(){!this._reconnecting&&this._reconnection&&this.backoff.attempts===0&&this.reconnect()}open(e){if(~this._readyState.indexOf("open"))return this;this.engine=new Ne(this.uri,this.opts);const n=this.engine,r=this;this._readyState="opening",this.skipReconnect=!1;const i=ce(n,"open",function(){r.onopen(),e&&e()}),o=ce(n,"error",s=>{r.cleanup(),r._readyState="closed",this.emitReserved("error",s),e?e(s):r.maybeReconnectOnOpen()});if(this._timeout!==!1){const s=this._timeout;s===0&&i();const a=this.setTimeoutFn(()=>{i(),n.close(),n.emit("error",new Error("timeout"))},s);this.opts.autoUnref&&a.unref(),this.subs.push(function(){clearTimeout(a)})}return this.subs.push(i),this.subs.push(o),this}connect(e){return this.open(e)}onopen(){this.cleanup(),this._readyState="open",this.emitReserved("open");const e=this.engine;this.subs.push(ce(e,"ping",this.onping.bind(this)),ce(e,"data",this.ondata.bind(this)),ce(e,"error",this.onerror.bind(this)),ce(e,"close",this.onclose.bind(this)),ce(this.decoder,"decoded",this.ondecoded.bind(this)))}onping(){this.emitReserved("ping")}ondata(e){try{this.decoder.add(e)}catch{this.onclose("parse error")}}ondecoded(e){this.emitReserved("packet",e)}onerror(e){this.emitReserved("error",e)}socket(e,n){let r=this.nsps[e];return r||(r=new Kr(this,e,n),this.nsps[e]=r),r}_destroy(e){const n=Object.keys(this.nsps);for(const r of n)if(this.nsps[r].active)return;this._close()}_packet(e){const n=this.encoder.encode(e);for(let r=0;r<n.length;r++)this.engine.write(n[r],e.options)}cleanup(){this.subs.forEach(e=>e()),this.subs.length=0,this.decoder.destroy()}_close(){this.skipReconnect=!0,this._reconnecting=!1,this.onclose("forced close"),this.engine&&this.engine.close()}disconnect(){return this._close()}onclose(e,n){this.cleanup(),this.backoff.reset(),this._readyState="closed",this.emitReserved("close",e,n),this._reconnection&&!this.skipReconnect&&this.reconnect()}reconnect(){if(this._reconnecting||this.skipReconnect)return this;const e=this;if(this.backoff.attempts>=this._reconnectionAttempts)this.backoff.reset(),this.emitReserved("reconnect_failed"),this._reconnecting=!1;else{const n=this.backoff.duration();this._reconnecting=!0;const r=this.setTimeoutFn(()=>{e.skipReconnect||(this.emitReserved("reconnect_attempt",e.backoff.attempts),!e.skipReconnect&&e.open(i=>{i?(e._reconnecting=!1,e.reconnect(),this.emitReserved("reconnect_error",i)):e.onreconnect()}))},n);this.opts.autoUnref&&r.unref(),this.subs.push(function(){clearTimeout(r)})}}onreconnect(){const e=this.backoff.attempts;this._reconnecting=!1,this.backoff.reset(),this.emitReserved("reconnect",e)}}const We={};function Tt(t,e){typeof t=="object"&&(e=t,t=void 0),e=e||{};const n=Ds(t,e.path||"/socket.io"),r=n.source,i=n.id,o=n.path,s=We[i]&&o in We[i].nsps,a=e.forceNew||e["force new connection"]||e.multiplex===!1||s;let u;return a?u=new pn(r,e):(We[i]||(We[i]=new pn(r,e)),u=We[i]),n.query&&!e.query&&(e.query=n.queryKey),u.socket(n.path,e)}Object.assign(Tt,{Manager:pn,Socket:Kr,io:Tt,connect:Tt});var Hr={exports:{}},$r={exports:{}};function Ys(t){return t>64&&t<91?t-65:t>96&&t<123?t-71:t>47&&t<58?t+4:t===43?62:t===47?63:0}function Xs(t,e){for(var n=t.replace(/[^A-Za-z0-9\+\/]/g,""),r=n.length,i=e?Math.ceil((r*3+1>>2)/e)*e:r*3+1>>2,o=new Uint8Array(i),s,a,u=0,c=0,p=0;p<r;p++)if(a=p&3,u|=Ys(n.charCodeAt(p))<<18-6*a,a===3||r-p===1){for(s=0;s<3&&c<i;s++,c++)o[c]=u>>>(16>>>s&24)&255;u=0}return o}var Qs={decode:Xs},Zs=function(t,e){return new Promise(function(n,r){var i=new XMLHttpRequest;e&&(i.responseType=e),i.open("GET",t),i.onload=function(){i.status===200?n(i.response):r(Error(i.statusText))},i.onerror=function(){r(Error("Network Error"))},i.send()})};(function(t){var e=Qs,n=Zs;function r(T){return function(_){return typeof _=="string"&&T.test(_)}}function i(T,_){return typeof T=="string"?T+_:typeof T=="function"?T(_):_}function o(T,_,A,B){var ne=s(_)?a:u(_)?c:p(_)?h:l(_)?f:d(_)?m:y(_)?S:j(_)?F:w(_)?N:null,b=A||{};return ne?ne(T,_,b):B?Promise.resolve(B):Promise.reject("Source not valid ("+_+")")}o.fetch=n;function s(T){return T instanceof ArrayBuffer}function a(T,_,A){return new Promise(function(B,ne){T.decodeAudioData(_,function(b){B(b)},function(){ne("Can't decode audio data ("+_.slice(0,30)+"...)")})})}var u=r(/\.(mp3|wav|ogg)(\?.*)?$/i);function c(T,_,A){var B=i(A.from,_);return o(T,o.fetch(B,"arraybuffer"),A)}function p(T){return T&&typeof T.then=="function"}function h(T,_,A){return _.then(function(B){return o(T,B,A)})}var l=Array.isArray;function f(T,_,A){return Promise.all(_.map(function(B){return o(T,B,A,B)}))}function d(T){return T&&typeof T=="object"}function m(T,_,A){var B={},ne=Object.keys(_).map(function(b){if(A.only&&A.only.indexOf(b)===-1)return null;var I=_[b];return o(T,I,A,I).then(function(M){B[b]=M})});return Promise.all(ne).then(function(){return B})}var y=r(/\.json(\?.*)?$/i);function S(T,_,A){var B=i(A.from,_);return o(T,o.fetch(B,"text").then(JSON.parse),A)}var j=r(/^data:audio/);function F(T,_,A){var B=_.indexOf(",");return o(T,e.decode(_.slice(B+1)).buffer,A)}var w=r(/\.js(\?.*)?$/i);function N(T,_,A){var B=i(A.from,_);return o(T,o.fetch(B,"text").then(K),A)}function K(T){var _=T.indexOf("MIDI.Soundfont.");if(_<0)throw Error("Invalid MIDI.js Soundfont format");_=T.indexOf("=",_)+2;var A=T.lastIndexOf(",");return JSON.parse(T.slice(_,A)+"}")}t.exports&&(t.exports=o),typeof window<"u"&&(window.loadAudio=o)})($r);var zr={exports:{}},eo=to;function to(t){var e=t.createGain(),n=e._voltage=io(t),r=Ke(n),i=Ke(n),o=Ke(n);return e._startAmount=Ke(i),e._endAmount=Ke(o),e._multiplier=Ke(r),e._multiplier.connect(e),e._startAmount.connect(e),e._endAmount.connect(e),e.value=r.gain,e.startValue=i.gain,e.endValue=o.gain,e.startValue.value=0,e.endValue.value=0,Object.defineProperties(e,no),e}var no={attack:{value:0,writable:!0},decay:{value:0,writable:!0},sustain:{value:1,writable:!0},release:{value:0,writable:!0},getReleaseDuration:{value:function(){return this.release}},start:{value:function(t){var e=this._multiplier.gain,n=this._startAmount.gain,r=this._endAmount.gain;this._voltage.start(t),this._decayFrom=this._decayFrom=t+this.attack,this._startedAt=t;var i=this.sustain;e.cancelScheduledValues(t),n.cancelScheduledValues(t),r.cancelScheduledValues(t),r.setValueAtTime(0,t),this.attack?(e.setValueAtTime(0,t),e.linearRampToValueAtTime(1,t+this.attack),n.setValueAtTime(1,t),n.linearRampToValueAtTime(0,t+this.attack)):(e.setValueAtTime(1,t),n.setValueAtTime(0,t)),this.decay&&e.setTargetAtTime(i,this._decayFrom,ar(this.decay))}},stop:{value:function(t,e){e&&(t=t-this.release);var n=t+this.release;if(this.release){var r=this._multiplier.gain,i=this._startAmount.gain,o=this._endAmount.gain;r.cancelScheduledValues(t),i.cancelScheduledValues(t),o.cancelScheduledValues(t);var s=ar(this.release);if(this.attack&&t<this._decayFrom){var a=so(0,1,this._startedAt,this._decayFrom,t);r.linearRampToValueAtTime(a,t),i.linearRampToValueAtTime(1-a,t),i.setTargetAtTime(0,t,s)}o.setTargetAtTime(1,t,s),r.setTargetAtTime(0,t,s)}return this._voltage.stop(n),n}},onended:{get:function(){return this._voltage.onended},set:function(t){this._voltage.onended=t}}},ro=new Float32Array([1,1]);function io(t){var e=t.createBufferSource(),n=t.createBuffer(1,2,t.sampleRate);return n.getChannelData(0).set(ro),e.buffer=n,e.loop=!0,e}function Ke(t){var e=t.context.createGain();return t.connect(e),e}function ar(t){return Math.log(t+1)/Math.log(100)}function so(t,e,n,r,i){var o=e-t,s=r-n,a=i-n,u=a/s,c=t+u*o;return c<=t&&(c=t),c>=e&&(c=e),c}var oo=eo,ao={},co={gain:1,attack:.01,decay:.1,sustain:.9,release:.3,loop:!1,cents:0,loopStart:0,loopEnd:0};function uo(t,e,n){var r=!1,i=0,o={},s=t.createGain();s.gain.value=1;var a=Object.assign({},co,n),u={context:t,out:s,opts:a};return e instanceof AudioBuffer?u.buffer=e:u.buffers=e,u.start=function(h,l,f){if(u.buffer&&h!==null)return u.start(null,h,l);var d=h?u.buffers[h]:u.buffer;if(d){if(!r){console.warn("SamplePlayer not connected to any node.");return}}else{console.warn("Buffer "+h+" not found.");return}var m=f||ao;l=Math.max(t.currentTime,l||0),u.emit("start",l,h,m);var y=p(h,d,m);return y.id=c(h,y),y.env.start(l),y.source.start(l),u.emit("started",l,y.id,y),m.duration&&y.stop(l+m.duration),y},u.play=function(h,l,f){return u.start(h,l,f)},u.stop=function(h,l){var f;return l=l||Object.keys(o),l.map(function(d){return f=o[d],f?(f.stop(h),f.id):null})},u.connect=function(h){return r=!0,s.connect(h),u},u.emit=function(h,l,f,d){u.onevent&&u.onevent(h,l,f,d);var m=u["on"+h];m&&m(l,f,d)},u;function c(h,l){return l.id=i++,o[l.id]=l,l.source.onended=function(){var f=t.currentTime;l.source.disconnect(),l.env.disconnect(),l.disconnect(),u.emit("ended",f,l.id,l)},l.id}function p(h,l,f){var d=t.createGain();return d.gain.value=0,d.connect(s),d.env=fo(t,f,a),d.env.connect(d.gain),d.source=t.createBufferSource(),d.source.buffer=l,d.source.connect(d),d.source.loop=f.loop||a.loop,d.source.playbackRate.value=ho(f.cents||a.cents),d.source.loopStart=f.loopStart||a.loopStart,d.source.loopEnd=f.loopEnd||a.loopEnd,d.stop=function(m){var y=m||t.currentTime;u.emit("stop",y,h);var S=d.env.stop(y);d.source.stop(S)},d}}function cr(t){return typeof t=="number"}var lo=["attack","decay","sustain","release"];function fo(t,e,n){var r=oo(t),i=e.adsr||n.adsr;return lo.forEach(function(o,s){i?r[o]=i[s]:r[o]=e[o]||n[o]}),r.value.value=cr(e.gain)?e.gain:cr(n.gain)?n.gain:1,r}function ho(t){return t?Math.pow(2,t/1200):1}var po=uo,mo=function(t){return t.on=function(e,n){if(arguments.length===1&&typeof e=="function")return t.on("event",e);var r="on"+e,i=t[r];return t[r]=i?yo(i,n):n,t},t};function yo(t,e){return function(n,r,i,o){t(n,r,i,o),e(n,r,i,o)}}var Jr=/^([a-gA-G])(#{1,}|b{1,}|x{1,}|)(-?\d*)\s*(.*)\s*$/;function go(){return Jr}var bo=[0,2,4,5,7,9,11];function Gr(t,e,n){if(typeof t!="string")return null;var r=Jr.exec(t);if(!r||!e&&r[4])return null;var i={letter:r[1].toUpperCase(),acc:r[2].replace(/x/g,"##")};return i.pc=i.letter+i.acc,i.step=(i.letter.charCodeAt(0)+3)%7,i.alt=i.acc[0]==="b"?-i.acc.length:i.acc.length,i.chroma=bo[i.step]+i.alt,r[3]&&(i.oct=+r[3],i.midi=i.chroma+12*(i.oct+1),i.freq=Wr(i.midi,n)),e&&(i.tonicOf=r[4]),i}function Wr(t,e){return Math.pow(2,(t-69)/12)*(e||440)}var Yr={parse:Gr,regex:go,midiToFreq:Wr},vo=["letter","acc","pc","step","alt","chroma","oct","midi","freq"];vo.forEach(function(t){Yr[t]=function(e){var n=Gr(e);return n&&typeof n[t]<"u"?n[t]:null}});var _o=Yr,ko=_o,wo=function(t){return t!==null&&t!==[]&&t>=0&&t<129},To=function(t){return wo(t)?+t:ko.midi(t)},xo=function(t){if(t.buffers){var e=t.opts.map,n=typeof e=="function"?e:To,r=function(o){return o?n(o)||o:null};t.buffers=Io(t.buffers,r);var i=t.start;t.start=function(o,s,a){var u=r(o),c=u%1;return c&&(u=Math.floor(u),a=Object.assign(a||{},{cents:Math.floor(c*100)})),i(u,s,a)}}return t};function Io(t,e){return Object.keys(t).reduce(function(n,r){return n[e(r)]=t[r],n},{})}var So=Array.isArray,Co=function(t){return t&&typeof t=="object"},Oo={},No=function(t){return t.schedule=function(e,n){var r=t.context.currentTime,i=e<r?r:e;t.emit("schedule",i,n);var o,s,a,u;return n.map(function(c){if(c)So(c)?(o=c[0],s=c[1]):(o=c.time,s=c);else return null;return Co(s)?(a=s.name||s.key||s.note||s.midi||null,u=s):(a=s,u=Oo),t.start(a,i+(o||0),u)})},t};function gt(t){throw new Error('Could not dynamically require "'+t+'". Please configure the dynamicRequireTargets or/and ignoreDynamicRequires option of @rollup/plugin-commonjs appropriately for this require call to work.')}var Xr={exports:{}};(function(t,e){(function(n){t.exports=n()})(function(){return function n(r,i,o){function s(c,p){if(!i[c]){if(!r[c]){var h=typeof gt=="function"&&gt;if(!p&&h)return h(c,!0);if(a)return a(c,!0);var l=new Error("Cannot find module '"+c+"'");throw l.code="MODULE_NOT_FOUND",l}var f=i[c]={exports:{}};r[c][0].call(f.exports,function(d){var m=r[c][1][d];return s(m||d)},f,f.exports,n,r,i,o)}return i[c].exports}for(var a=typeof gt=="function"&&gt,u=0;u<o.length;u++)s(o[u]);return s}({1:[function(n,r,i){Object.defineProperty(i,"__esModule",{value:!0}),i.default=function(o){function s(a){if(this._event=a,this._data=a.data,this.receivedTime=a.receivedTime,this._data&&this._data.length<2){console.warn("Illegal MIDI message of length",this._data.length);return}switch(this._messageCode=a.data[0]&240,this.channel=a.data[0]&15,this._messageCode){case 128:this.messageType="noteoff",this.key=a.data[1]&127,this.velocity=a.data[2]&127;break;case 144:this.messageType="noteon",this.key=a.data[1]&127,this.velocity=a.data[2]&127;break;case 160:this.messageType="keypressure",this.key=a.data[1]&127,this.pressure=a.data[2]&127;break;case 176:this.messageType="controlchange",this.controllerNumber=a.data[1]&127,this.controllerValue=a.data[2]&127,this.controllerNumber===120&&this.controllerValue===0?this.channelModeMessage="allsoundoff":this.controllerNumber===121?this.channelModeMessage="resetallcontrollers":this.controllerNumber===122?this.controllerValue===0?this.channelModeMessage="localcontroloff":this.channelModeMessage="localcontrolon":this.controllerNumber===123&&this.controllerValue===0?this.channelModeMessage="allnotesoff":this.controllerNumber===124&&this.controllerValue===0?this.channelModeMessage="omnimodeoff":this.controllerNumber===125&&this.controllerValue===0?this.channelModeMessage="omnimodeon":this.controllerNumber===126?this.channelModeMessage="monomodeon":this.controllerNumber===127&&(this.channelModeMessage="polymodeon");break;case 192:this.messageType="programchange",this.program=a.data[1];break;case 208:this.messageType="channelpressure",this.pressure=a.data[1]&127;break;case 224:this.messageType="pitchbendchange";var u=a.data[2]&127,c=a.data[1]&127;this.pitchBend=(u<<8)+c;break}}return new s(o)},r.exports=i.default},{}]},{},[1])(1)})})(Xr);var Eo=Xr.exports,Ao=function(t){return t.listenToMidi=function(e,n){var r={},i=n||{},o=i.gain||function(s){return s/127};return e.onmidimessage=function(s){var a=s.messageType?s:Eo(s);if(a.messageType==="noteon"&&a.velocity===0&&(a.messageType="noteoff"),!(i.channel&&a.channel!==i.channel))switch(a.messageType){case"noteon":r[a.key]=t.play(a.key,0,{gain:o(a.velocity)});break;case"noteoff":r[a.key]&&(r[a.key].stop(),delete r[a.key]);break}},t},t};(function(t){var e=po,n=mo,r=xo,i=No,o=Ao;function s(a,u,c){return o(i(r(n(e(a,u,c)))))}t.exports&&(t.exports=s),typeof window<"u"&&(window.SamplePlayer=s)})(zr);function ur(t,e){return Array(e+1).join(t)}function Tn(t){return typeof t=="number"}function Bo(t){return typeof t=="string"}function Po(t){return typeof t<"u"}function Qr(t,e){return Math.pow(2,(t-69)/12)*(e||440)}var Zr=/^([a-gA-G])(#{1,}|b{1,}|x{1,}|)(-?\d*)\s*(.*)\s*$/;function Uo(){return Zr}var Mo=[0,2,4,5,7,9,11];function Ie(t,e,n){if(typeof t!="string")return null;var r=Zr.exec(t);if(!r||!e&&r[4])return null;var i={letter:r[1].toUpperCase(),acc:r[2].replace(/x/g,"##")};i.pc=i.letter+i.acc,i.step=(i.letter.charCodeAt(0)+3)%7,i.alt=i.acc[0]==="b"?-i.acc.length:i.acc.length;var o=Mo[i.step]+i.alt;return i.chroma=o<0?12+o:o%12,r[3]&&(i.oct=+r[3],i.midi=o+12*(i.oct+1),i.freq=Qr(i.midi,n)),e&&(i.tonicOf=r[4]),i}var Fo="CDEFGAB";function Ro(t){return Tn(t)?t<0?ur("b",-t):ur("#",t):""}function Do(t){return Tn(t)?""+t:""}function ei(t,e,n){return t===null||typeof t>"u"?null:t.step?ei(t.step,t.alt,t.oct):t<0||t>6?null:Fo.charAt(t)+Ro(e)+Do(n)}function ti(t){if((Tn(t)||Bo(t))&&t>=0&&t<128)return+t;var e=Ie(t);return e&&Po(e.midi)?e.midi:null}function Lo(t,e){var n=ti(t);return n===null?null:Qr(n,e)}function qo(t){return(Ie(t)||{}).letter}function Vo(t){return(Ie(t)||{}).acc}function jo(t){return(Ie(t)||{}).pc}function Ko(t){return(Ie(t)||{}).step}function Ho(t){return(Ie(t)||{}).alt}function $o(t){return(Ie(t)||{}).chroma}function zo(t){return(Ie(t)||{}).oct}const Jo=Object.freeze(Object.defineProperty({__proto__:null,regex:Uo,parse:Ie,build:ei,midi:ti,freq:Lo,letter:qo,acc:Vo,pc:jo,step:Ko,alt:Ho,chroma:$o,oct:zo},Symbol.toStringTag,{value:"Module"})),Go=Ir(Jo);var Wt,lr;function Wo(){if(lr)return Wt;lr=1;var t=Go;function e(i,o){if(console.warn("new Soundfont() is deprected"),console.log("Please use Soundfont.instrument() instead of new Soundfont().instrument()"),!(this instanceof e))return new e(i);this.nameToUrl=o||e.nameToUrl,this.ctx=i,this.instruments={},this.promises=[]}e.prototype.onready=function(i){console.warn("deprecated API"),console.log("Please use Promise.all(Soundfont.instrument(), Soundfont.instrument()).then() instead of new Soundfont().onready()"),Promise.all(this.promises).then(i)},e.prototype.instrument=function(i,o){console.warn("new Soundfont().instrument() is deprecated."),console.log("Please use Soundfont.instrument() instead.");var s=this.ctx;if(i=i||"default",i in this.instruments)return this.instruments[i];var a={name:i,play:r(s,o)};if(this.instruments[i]=a,i!=="default"){var u=e.instrument(s,i,o).then(function(c){return a.play=c.play,a});this.promises.push(u),a.onready=function(c){console.warn("onready is deprecated. Use Soundfont.instrument().then()"),u.then(c)}}else a.onready=function(c){console.warn("onready is deprecated. Use Soundfont.instrument().then()"),c()};return a};function n(i,o,s){return console.warn("Soundfont.loadBuffers is deprecate."),console.log("Use Soundfont.instrument(..) and get buffers properties from the result."),e.instrument(i,o,s).then(function(a){return a.buffers})}e.loadBuffers=n;function r(i,o){return o=o||{},function(s,a,u,c){console.warn("The oscillator player is deprecated."),console.log("Starting with version 0.9.0 you will have to wait until the soundfont is loaded to play sounds.");var p=s>0&&s<129?+s:t.midi(s),h=p?t.midiToFreq(p,440):null;if(!!h){u=u||.2,c=c||{};var l=c.destination||o.destination||i.destination,f=c.vcoType||o.vcoType||"sine",d=c.gain||o.gain||.4,m=i.createOscillator();m.type=f,m.frequency.value=h;var y=i.createGain();return y.gain.value=d,m.connect(y),y.connect(l),m.start(a),u>0&&m.stop(a+u),m}}}return e.noteToMidi=t.midi,Wt=e,Wt}(function(t){var e=$r.exports,n=zr.exports;function r(a,u,c){if(arguments.length===1)return function(d,m){return r(a,d,m)};var p=c||{},h=p.isSoundfontURL||i,l=p.nameToUrl||o,f=h(u)?u:l(u,p.soundfont,p.format);return e(a,f,{only:p.only||p.notes}).then(function(d){var m=n(a,d,p).connect(p.destination?p.destination:a.destination);return m.url=f,m.name=u,m})}function i(a){return/\.js(\?.*)?$/i.test(a)}function o(a,u,c){return c=c==="ogg"?c:"mp3",u=u==="FluidR3_GM"?u:"MusyngKite","https://gleitz.github.io/midi-js-soundfonts/"+u+"/"+a+"-"+c+".js"}var s=Wo();s.instrument=r,s.nameToUrl=o,t.exports&&(t.exports=s),typeof window<"u"&&(window.Soundfont=s)})(Hr);const ni=window.AudioContext||window.webkitAudioContext;ni||alert("Your browser does not seem to support the Web Audio API!");const Yo=new ni,Yt={};function ri(t){return Yt[t]||(Yt[t]=Hr.exports.instrument(Yo,t)),Yt[t]}const Et=te(!1),xt=te(""),At=te("acoustic_grand_piano"),ze=te(new Map),xn=te(!1),xe=new Map,qt={audioNodeMap:new Map,colorHue:"220"};xe.set("0",qt);let E,In,Sn;async function Cn(t,e){let n=await ri(t),r=xe.get(e);r&&(r.instrument=n)}function fr({socketID:t,colorHue:e,instrumentName:n}){xe.set(t,{audioNodeMap:t===E.id?qt.audioNodeMap:new Map,colorHue:e}),ze.set(we(ze).set(t,e)),n&&Cn(n,t)}function Xt(){E.removeAllListeners(),E=null,Et.set(!1),xn.set(!1),xe.clear(),xe.set("0",qt)}function Xo(t,e){In=t,Sn=e}function Qt(t){const e="https://calbabreaker-piano-backend.herokuapp.com";xt.set(""),Et.set(!0),E=Tt(e,{query:{roomName:t,instrumentName:we(At)},path:{VITE_BACKEND_HOST:"https://calbabreaker-piano-backend.herokuapp.com",BASE_URL:"./",MODE:"production",DEV:!1,PROD:!0}.VITE_BACKEND_PATH}),E.on("connect_error",()=>{Xt(),xt.set("Failed to connect to server!")}),E.on("connect_timeout",()=>{Xt(),xt.set("Timed out while connecting to server!")}),E.on("connect",()=>{Et.set(!1),xn.set(!0),xe.delete("0"),we(ze).clear(),history.replaceState({},void 0,`?room=${t}`),document.title=`Room ${t} - Play Piano!`}),E.on("disconnect",()=>{Xt(),history.replaceState({},void 0,location.pathname),document.title="Play Piano!"}),E.on("play_note",n=>{In(n)}),E.on("stop_note",n=>{Sn(n)}),E.on("instrument_change",n=>{const{instrumentName:r,socketID:i}=n;Cn(r,i)}),E.on("client_connect",n=>{fr(n)}),E.on("client_list_recieve",n=>{const r=n;for(let i of r)fr(i)}),E.on("client_disconnect",n=>{const r=we(ze);r.delete(n),ze.set(r),xe.delete(n)})}function Qo(t,e){var r;const n={note:t,volume:e};E&&E.emit("play_note",n),In({...n,socketID:(r=E==null?void 0:E.id)!=null?r:"0"})}function Zt(t,e){var r;const n={note:t,sustain:e};E&&E.emit("stop_note",n),Sn({...n,socketID:(r=E==null?void 0:E.id)!=null?r:"0"})}At.subscribe(t=>{var e;E&&E.emit("instrument_change",{instrumentName:t}),Cn(t,(e=E==null?void 0:E.id)!=null?e:"0")});function hr(t,e,n){const r=t.slice();return r[39]=e[n][0],r[40]=e[n][1],r}function dr(t,e,n){const r=t.slice();return r[43]=e[n],r}function pr(t){let e,n=t[43]+"",r;return{c(){e=k("option"),r=re(n),e.__value=t[43],e.value=e.__value},m(i,o){q(i,e,o),g(e,r)},p:U,d(i){i&&D(e)}}}function Zo(t){return{c:U,m:U,d:U}}function ea(t){return{c:U,m:U,d:U}}function ta(t){let e;return{c(){e=re("loading...")},m(n,r){q(n,e,r)},d(n){n&&D(e)}}}function na(t){let e,n,r;return{c(){e=k("button"),e.textContent="Play"},m(i,o){q(i,e,o),n||(r=C(e,"click",t[27]),n=!0)},p:U,d(i){i&&D(e),n=!1,r()}}}function ra(t){let e,n,r;return{c(){e=k("button"),e.textContent="Pause"},m(i,o){q(i,e,o),n||(r=C(e,"click",t[26]),n=!0)},p:U,d(i){i&&D(e),n=!1,r()}}}function ia(t){let e,n,r,i;return{c(){e=k("button"),n=re("Join"),e.disabled=t[13]},m(o,s){q(o,e,s),g(e,n),r||(i=C(e,"click",t[37]),r=!0)},p(o,s){s[0]&8192&&(e.disabled=o[13])},d(o){o&&D(e),r=!1,i()}}}function sa(t){let e,n,r,i,o,s,a,u,c,p,h=Array.from(t[12].entries()),l=[];for(let f=0;f<h.length;f+=1)l[f]=yr(hr(t,h,f));return{c(){e=k("button"),e.textContent="Leave",n=P(),r=k("span"),r.textContent="Connected!",i=k("br"),o=P(),s=k("span"),s.textContent="People:",a=P();for(let f=0;f<l.length;f+=1)l[f].c();u=Tr()},m(f,d){q(f,e,d),q(f,n,d),q(f,r,d),q(f,i,d),q(f,o,d),q(f,s,d),q(f,a,d);for(let m=0;m<l.length;m+=1)l[m].m(f,d);q(f,u,d),c||(p=C(e,"click",t[36]),c=!0)},p(f,d){if(d[0]&4096){h=Array.from(f[12].entries());let m;for(m=0;m<h.length;m+=1){const y=hr(f,h,m);l[m]?l[m].p(y,d):(l[m]=yr(y),l[m].c(),l[m].m(u.parentNode,u))}for(;m<l.length;m+=1)l[m].d(1);l.length=h.length}},d(f){f&&D(e),f&&D(n),f&&D(r),f&&D(i),f&&D(o),f&&D(s),f&&D(a),yn(l,f),f&&D(u),c=!1,p()}}}function mr(t){let e;return{c(){e=k("span"),e.textContent="(you)",St(e,"margin-right","0.5rem")},m(n,r){q(n,e,r)},d(n){n&&D(e)}}}function yr(t){let e,n,r,i,o=t[39]===E.id&&mr();return{c(){e=k("div"),r=P(),o&&o.c(),i=Tr(),v(e,"class","icon svelte-kmoprw"),v(e,"style",n=`--color-hue: ${t[40]}`)},m(s,a){q(s,e,a),q(s,r,a),o&&o.m(s,a),q(s,i,a)},p(s,a){a[0]&4096&&n!==(n=`--color-hue: ${s[40]}`)&&v(e,"style",n),s[39]===E.id?o||(o=mr(),o.c(),o.m(i.parentNode,i)):o&&(o.d(1),o=null)},d(s){s&&D(e),s&&D(r),o&&o.d(s),s&&D(i)}}}function oa(t){let e;return{c(){e=k("span"),e.textContent="Connecting..."},m(n,r){q(n,e,r)},p:U,d(n){n&&D(e)}}}function aa(t){let e,n;return{c(){e=k("span"),n=re(t[14]),v(e,"class","error svelte-kmoprw")},m(r,i){q(r,e,i),g(e,n)},p(r,i){i[0]&16384&&en(n,r[14])},d(r){r&&D(e)}}}function ca(t){let e,n,r,i,o,s,a,u,c,p,h,l,f,d,m,y,S,j,F,w,N,K,T,_,A,B,ne,b,I,M,z,ue,ye,ge,be,nt,le,Se,Re,rt,Pe,it,ve,Ge,De,x,R,On,ie,Nn,_e,En,An,Bn,W,Pn,st=t[8].toFixed(1)+"",Vt,Un,ot=t[10].toFixed(1)+"",jt,Mn,Fn,se,at,Rn,fe,Dn,Kt,Ht,Ln,Le=Wn,Q=[];for(let V=0;V<Le.length;V+=1)Q[V]=pr(dr(t,Le,V));let oe={ctx:t,current:null,token:null,hasCatch:!1,pending:ta,then:ea,catch:Zo};Jn(B=t[2],oe);function qn(V,L){return V[7]?ra:na}let ct=qn(t),he=ct(t);function Vn(V,L){return V[11]?sa:ia}let ut=Vn(t),de=ut(t);function jn(V,L){if(V[14])return aa;if(V[13])return oa}let qe=jn(t),Z=qe&&qe(t);return{c(){e=k("div"),n=k("div"),r=k("div"),i=k("div"),o=k("span"),o.textContent="Sustain:",s=P(),a=k("input"),u=P(),c=k("div"),p=k("span"),p.textContent="Octave Shift:",h=P(),l=k("input"),f=P(),d=k("div"),m=k("span"),m.textContent="Volume:",y=P(),S=k("input"),j=P(),F=k("input"),w=P(),N=k("div"),K=k("span"),K.textContent="Instrument:",T=P(),_=k("select");for(let V=0;V<Q.length;V+=1)Q[V].c();A=P(),oe.block.c(),ne=P(),b=k("span"),b.textContent="Size:",I=P(),M=k("select"),z=k("option"),z.textContent="Full size (88 keys)",ue=k("option"),ue.textContent="Half size (61 keys)",ye=k("option"),ye.textContent="Quater Size (37 keys)",ge=k("option"),ge.textContent="2 Octaves (24 keys)",be=k("option"),be.textContent="1 Octave (12 keys)",nt=P(),le=k("div"),Se=k("div"),Re=k("p"),Re.textContent="Play a midi:",rt=P(),Pe=k("input"),it=P(),ve=k("div"),he.c(),Ge=P(),De=k("button"),De.textContent="Restart",x=P(),R=k("div"),On=re("Speed:"),ie=k("input"),Nn=P(),_e=k("input"),En=re("times"),An=k("br"),Bn=P(),W=k("input"),Pn=P(),Vt=re(st),Un=re("/"),jt=re(ot),Mn=re(" seconds"),Fn=P(),se=k("div"),at=k("p"),at.textContent="Join a room:",Rn=P(),fe=k("input"),Dn=P(),de.c(),Kt=P(),Z&&Z.c(),v(a,"type","checkbox"),v(a,"class","svelte-kmoprw"),v(i,"title","Shortcut: space"),v(i,"class","svelte-kmoprw"),v(l,"type","number"),v(l,"min","-3"),v(l,"max","3"),v(l,"class","svelte-kmoprw"),v(c,"title","Shortcut: left ctrl +, left alt or right ctrl -"),v(c,"class","svelte-kmoprw"),v(S,"type","range"),v(S,"min","0"),v(S,"max","50"),v(S,"step","0.1"),v(S,"class","svelte-kmoprw"),v(F,"type","number"),v(F,"class","svelte-kmoprw"),v(d,"class","svelte-kmoprw"),t[0]===void 0&&Ct(()=>t[23].call(_)),v(N,"class","svelte-kmoprw"),v(z,"data-range","A0,C8"),z.__value="Full size (88 keys)",z.value=z.__value,v(ue,"data-range","C2,C7"),ue.selected=!0,ue.__value="Half size (61 keys)",ue.value=ue.__value,v(ye,"data-range","C3,C6"),ye.__value="Quater Size (37 keys)",ye.value=ye.__value,v(ge,"data-range","C4,B5"),ge.__value="2 Octaves (24 keys)",ge.value=ge.__value,v(be,"data-range","C4,B4"),be.__value="1 Octave (12 keys)",be.value=be.__value,v(r,"class","svelte-kmoprw"),v(Re,"class","svelte-kmoprw"),v(Pe,"type","file"),v(Pe,"class","svelte-kmoprw"),v(Se,"class","svelte-kmoprw"),v(ve,"class","svelte-kmoprw"),v(ie,"type","range"),v(ie,"min","0.01"),v(ie,"max","4"),v(ie,"step","0.01"),v(ie,"class","svelte-kmoprw"),v(_e,"type","number"),v(_e,"min","0.01"),v(_e,"class","svelte-kmoprw"),v(W,"type","range"),v(W,"min","0"),v(W,"max",t[10]),v(W,"step","0.1"),St(W,"width","18rem"),v(W,"class","svelte-kmoprw"),v(R,"class","svelte-kmoprw"),v(le,"class","svelte-kmoprw"),v(n,"class","row svelte-kmoprw"),v(at,"class","svelte-kmoprw"),v(fe,"type","text"),v(fe,"placeholder","Room name"),v(fe,"class","svelte-kmoprw"),v(e,"class","control-panel svelte-kmoprw")},m(V,L){q(V,e,L),g(e,n),g(n,r),g(r,i),g(i,o),g(i,s),g(i,a),a.checked=t[3],g(r,u),g(r,c),g(c,p),g(c,h),g(c,l),ee(l,t[4]),g(r,f),g(r,d),g(d,m),g(d,y),g(d,S),ee(S,t[5]),g(d,j),g(d,F),ee(F,t[5]),g(r,w),g(r,N),g(N,K),g(N,T),g(N,_);for(let G=0;G<Q.length;G+=1)Q[G].m(_,null);$n(_,t[0]),g(N,A),oe.block.m(N,oe.anchor=null),oe.mount=()=>N,oe.anchor=null,g(r,ne),g(r,b),g(r,I),g(r,M),g(M,z),g(M,ue),g(M,ye),g(M,ge),g(M,be),g(n,nt),g(n,le),g(le,Se),g(Se,Re),g(Se,rt),g(Se,Pe),g(le,it),g(le,ve),he.m(ve,null),g(ve,Ge),g(ve,De),g(le,x),g(le,R),g(R,On),g(R,ie),ee(ie,t[9]),g(R,Nn),g(R,_e),ee(_e,t[9]),g(R,En),g(R,An),g(R,Bn),g(R,W),ee(W,t[8]),g(R,Pn),g(R,Vt),g(R,Un),g(R,jt),g(R,Mn),g(e,Fn),g(e,se),g(se,at),g(se,Rn),g(se,fe),ee(fe,t[1]),g(se,Dn),de.m(se,null),g(se,Kt),Z&&Z.m(se,null),Ht||(Ln=[C(window,"keydown",t[17]),C(window,"keyup",t[18]),C(window,"load",t[15]),C(a,"change",t[19]),C(l,"input",t[20]),C(S,"change",t[21]),C(S,"input",t[21]),C(F,"input",t[22]),C(_,"change",t[23]),C(M,"change",t[24]),oi(t[16].call(null,M)),C(Pe,"change",t[25]),C(De,"click",t[28]),C(ie,"change",t[29]),C(ie,"input",t[29]),C(_e,"input",t[30]),C(W,"change",t[31]),C(W,"input",t[31]),C(W,"mousedown",t[32]),C(W,"mouseup",t[33]),C(fe,"input",t[34]),C(fe,"keydown",t[35])],Ht=!0)},p(V,L){if(t=V,L[0]&8&&(a.checked=t[3]),L[0]&16&&ke(l.value)!==t[4]&&ee(l,t[4]),L[0]&32&&ee(S,t[5]),L[0]&32&&ke(F.value)!==t[5]&&ee(F,t[5]),L&0){Le=Wn;let G;for(G=0;G<Le.length;G+=1){const Kn=dr(t,Le,G);Q[G]?Q[G].p(Kn,L):(Q[G]=pr(Kn),Q[G].c(),Q[G].m(_,null))}for(;G<Q.length;G+=1)Q[G].d(1);Q.length=Le.length}L[0]&1&&$n(_,t[0]),oe.ctx=t,L[0]&4&&B!==(B=t[2])&&Jn(B,oe),ct===(ct=qn(t))&&he?he.p(t,L):(he.d(1),he=ct(t),he&&(he.c(),he.m(ve,Ge))),L[0]&512&&ee(ie,t[9]),L[0]&512&&ke(_e.value)!==t[9]&&ee(_e,t[9]),L[0]&1024&&v(W,"max",t[10]),L[0]&256&&ee(W,t[8]),L[0]&256&&st!==(st=t[8].toFixed(1)+"")&&en(Vt,st),L[0]&1024&&ot!==(ot=t[10].toFixed(1)+"")&&en(jt,ot),L[0]&2&&fe.value!==t[1]&&ee(fe,t[1]),ut===(ut=Vn(t))&&de?de.p(t,L):(de.d(1),de=ut(t),de&&(de.c(),de.m(se,Kt))),qe===(qe=jn(t))&&Z?Z.p(t,L):(Z&&Z.d(1),Z=qe&&qe(t),Z&&(Z.c(),Z.m(se,null)))},i:U,o:U,d(V){V&&D(e),yn(Q,V),oe.block.d(),oe.token=null,oe=null,he.d(),de.d(),Z&&Z.d(),Ht=!1,Be(Ln)}}}const Oe=te(0),$e=te(!1),It=te(25),mn=te(["C0","C0"]);function ua(t,e,n){let r,i,o=U,s,a=U,u,c=U,p,h,l=U,f,d,m,y,S,j,F,w,N;J(t,$e,x=>n(3,i=x)),J(t,Oe,x=>n(4,s=x)),J(t,mn,x=>n(38,u=x)),J(t,At,x=>n(0,p=x)),J(t,It,x=>n(5,h=x)),J(t,un,x=>n(6,f=x)),J(t,ae,x=>n(7,d=x)),J(t,Me,x=>n(8,m=x)),J(t,Ze,x=>n(9,y=x)),J(t,_t,x=>n(10,S=x)),J(t,xn,x=>n(11,j=x)),J(t,ze,x=>n(12,F=x)),J(t,Et,x=>n(13,w=x)),J(t,xt,x=>n(14,N=x)),t.$$.on_destroy.push(()=>o()),t.$$.on_destroy.push(()=>a()),t.$$.on_destroy.push(()=>c()),t.$$.on_destroy.push(()=>l());let K="";function T(){const R=new URLSearchParams(location.search).get("room");R!=null&&(n(1,K=R),Qt(K))}function _(x){const R=x.children[x.selectedIndex];Y(mn,u=R.dataset.range.split(","),u)}function A(x){x.code==="Space"&&Y($e,i=!0,i),x.code==="ControlLeft"?Y(Oe,s-=1,s):(x.code==="AltLeft"||x.code=="ControlRight")&&Y(Oe,s+=1,s),s<-3?Y(Oe,s=3,s):s>3&&Y(Oe,s=-3,s)}function B(x){x.code==="Space"&&Y($e,i=!1,i)}function ne(){i=this.checked,$e.set(i)}function b(){s=ke(this.value),Oe.set(s)}function I(){h=ke(this.value),It.set(h)}function M(){h=ke(this.value),It.set(h)}function z(){p=ui(this),At.set(p)}const ue=x=>_(x.currentTarget),ye=x=>{var R;return Y(un,f=(R=x.currentTarget.files)==null?void 0:R[0],f)},ge=()=>Y(ae,d=!1,d),be=()=>Y(ae,d=!0,d),nt=()=>{Y(ae,d=!1,d),Y(Me,m=0,m),setTimeout(()=>Y(ae,d=!0,d),100)};function le(){y=ke(this.value),Ze.set(y)}function Se(){y=ke(this.value),Ze.set(y)}function Re(){m=ke(this.value),Me.set(m)}const rt=()=>Y(ae,d=!1,d),Pe=()=>Y(ae,d=!0,d);function it(){K=this.value,n(1,K)}const ve=x=>{x.code==="Enter"&&Qt(K)},Ge=()=>E.disconnect(),De=()=>Qt(K);return t.$$.update=()=>{t.$$.dirty[0]&1&&n(2,r=ri(p))},[p,K,r,i,s,h,f,d,m,y,S,j,F,w,N,T,_,A,B,ne,b,I,M,z,ue,ye,ge,be,nt,le,Se,Re,rt,Pe,it,ve,Ge,De]}class la extends vn{constructor(e){super(),bn(this,e,ua,ca,Bt,{},null,[-1,-1])}}function gr(t,e,n){const r=t.slice();return r[25]=e[n][0],r[26]=e[n][1].isWhite,r[27]=e[n][1].pressedColor,r[28]=e[n][1].isGhost,r}function br(t){let e,n,r,i;function o(...c){return t[13](t[25],...c)}function s(){return t[14](t[25])}function a(){return t[15](t[25])}function u(){return t[16](t[25])}return{c(){e=k("div"),v(e,"class",n="key "+(t[26]?"white":"black")+" svelte-15rg95q"),St(e,"--color-hue",t[27]),lt(e,"pressed",t[27]!==null),lt(e,"ghost",t[28]&&t[27]===null)},m(c,p){q(c,e,p),r||(i=[C(e,"pointerdown",o),C(e,"pointerenter",s),C(e,"pointerleave",a),C(e,"pointerup",u)],r=!0)},p(c,p){t=c,p&2&&n!==(n="key "+(t[26]?"white":"black")+" svelte-15rg95q")&&v(e,"class",n),p&2&&St(e,"--color-hue",t[27]),p&2&&lt(e,"pressed",t[27]!==null),p&2&&lt(e,"ghost",t[28]&&t[27]===null)},d(c){c&&D(e),r=!1,Be(i)}}}function fa(t){let e,n,r,i,o=Object.entries(t[1]),s=[];for(let a=0;a<o.length;a+=1)s[a]=br(gr(t,o,a));return{c(){e=k("div"),n=k("div");for(let a=0;a<s.length;a+=1)s[a].c();v(n,"class","piano svelte-15rg95q"),v(e,"class","piano-container svelte-15rg95q")},m(a,u){q(a,e,u),g(e,n);for(let c=0;c<s.length;c+=1)s[c].m(n,null);t[17](e),r||(i=[C(window,"resize",t[10]),C(window,"keyup",t[7]),C(window,"keydown",t[6]),C(window,"pointerdown",t[11]),C(window,"pointerup",t[12]),C(n,"touchstart",ai(t[9]))],r=!0)},p(a,[u]){if(u&27){o=Object.entries(a[1]);let c;for(c=0;c<o.length;c+=1){const p=gr(a,o,c);s[c]?s[c].p(p,u):(s[c]=br(p),s[c].c(),s[c].m(n,null))}for(;c<s.length;c+=1)s[c].d(1);s.length=o.length}},i:U,o:U,d(a){a&&D(e),yn(s,a),t[17](null),r=!1,Be(i)}}}function vr(t,e){e.get(t)&&(e.get(t).stop(),e.delete(t))}function ha(t,e,n){let r,i,o;J(t,$e,b=>n(18,r=b)),J(t,It,b=>n(19,i=b)),J(t,Oe,b=>n(20,o=b));let s=!1,a,u,c,p=new Map;mn.subscribe(b=>{const I=ss(b[0],b[1]);n(1,a=I.noteMap),n(8,u=I.whiteKeys)}),Xo(d,m);function h(b){const I=an(b)+o;return cn(b)+I}function l(b,I){const M=h(b);p.get(M)||(a[b]&&n(1,a[b].isGhost=!0,a),p.set(M,!0),Qo(M,i*I))}function f(b){const I=h(b);a[b]&&n(1,a[b].isGhost=!1,a),p.get(I)&&(p.delete(I),Zt(I,r))}function d({socketID:b,note:I,volume:M}){const z=xe.get(b);a[I]&&n(1,a[I].pressedColor=z.colorHue,a),z.instrument&&(vr(I,z.audioNodeMap),z.audioNodeMap.set(I,z.instrument.play(I,void 0,{gain:M})))}function m({socketID:b,note:I,sustain:M}){const z=xe.get(b);a[I]&&n(1,a[I].pressedColor=null,a),M||vr(I,z.audioNodeMap)}os(l,f),$e.subscribe(b=>{if(!b)for(const I of qt.audioNodeMap.keys())p.get(I)||Zt(I,!1)}),Oe.subscribe(()=>{for(const b of p.keys())Zt(b,r)});function y(b=u){if(!c)return;const I=c.clientHeight/6,M=c.offsetWidth/b;c.style.setProperty("--white-key-width",`${Math.min(M,I)}px`)}li(()=>{y()});function S(b){const I=Qn[b.code],M=b.target;I&&M.tagName!=="INPUT"&&(b.preventDefault(),l(I,.5))}function j(b){const I=Qn[b.code];I&&f(I)}function F(b){fi.call(this,t,b)}const w=()=>y(),N=()=>n(0,s=!0),K=()=>n(0,s=!1),T=(b,I)=>{I.currentTarget.releasePointerCapture(I.pointerId),l(b,.5)},_=b=>{s&&l(b,.5)},A=b=>f(b),B=b=>f(b);function ne(b){tn[b?"unshift":"push"](()=>{c=b,n(2,c)})}return t.$$.update=()=>{t.$$.dirty&256&&y(u)},[s,a,c,l,f,y,S,j,u,F,w,N,K,T,_,A,B,ne]}class da extends vn{constructor(e){super(),bn(this,e,ha,fa,Bt,{})}}function pa(t){let e,n,r,i,o;return n=new la({}),i=new da({}),{c(){e=k("main"),Gn(n.$$.fragment),r=P(),Gn(i.$$.fragment),v(e,"class","svelte-ieeeet")},m(s,a){q(s,e,a),sn(n,e,null),g(e,r),sn(i,e,null),o=!0},p:U,i(s){o||(Ot(n.$$.fragment,s),Ot(i.$$.fragment,s),o=!0)},o(s){rn(n.$$.fragment,s),rn(i.$$.fragment,s),o=!1},d(s){s&&D(e),on(n),on(i)}}}class ma extends vn{constructor(e){super(),bn(this,e,null,pa,Bt,{})}}new ma({target:document.body});

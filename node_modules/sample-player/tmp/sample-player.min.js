(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require=="function"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require=="function"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})({1:[function(require,module,exports){"use strict";var ADSR=require("adsr");var DEFAULTS={gain:1,loop:false,pitch:0,loopStart:0,loopEnd:0,adsr:[.01,.1,.8,.3],filter:"highpass",freq:0};function Sample(buffer,destination,options,event){if(!(this instanceof Sample))return new Sample(buffer,destination,options,event);var s=this;var opts=typeof options==="function"?options:from(options,{},{});s.ac=destination.context;s.event=event||function(){};s.amp=s.ac.createGain();s.amp.gain.value=0;s.amp.connect(destination||s.output);s.env=adsr(s.ac,opts("adsr"));s.env.value.value=opts("gain");s.env.connect(s.amp.gain);s.filter=s.ac.createBiquadFilter();s.filter.type=opts("filter");s.filter.frequency.value=opts("freq");s.filter.connect(s.amp);s.source=s.ac.createBufferSource();s.source.buffer=buffer;s.source.loop=opts("loop");s.source.connect(s.filter);s.source.playbackRate.value=centsToRate(opts("pitch")*100);s.source.loopStart=opts("loopStart");s.source.loopEnd=opts("loopEnd");s.source.onended=function(){s.event("ended",s);s.source.stop();s.source.disconnect();s.filter.disconnect();s.amp.disconnect();s.env.disconnect();s.onended(this)}}Sample.prototype.onended=function(){};Sample.prototype.start=function(when,duration){this.event("start",this,when);this.env.start(when);this.source.start(when);if(duration>0)this.stop(when+duration)};Sample.prototype.stop=function(when){this.event("stop",this,when);var stopAt=this.env.stop(when||this.ac.currentTime);this.source.stop(stopAt)};function Player(ac,options){if(!(this instanceof Player))return new Player(ac,options);this.options=options||{};this.nextId=1;this._playing={};this.onevent=function(){};if(ac.context){this.ac=ac.context;this.output=this.ac.createGain();this.output.connect(ac)}else{this.ac=ac;this.output=ac.createGain()}}Player.prototype.start=function(buffer,when,duration,options,destination){var ac=this.ac;var event=this.onevent;var tracked=this._playing;when=when||ac.currentTime;var opts=from(options||{},this.options,DEFAULTS);var s=new Sample(buffer,destination||this.output,opts,event);s.id=this.nextId++;tracked[s.id]=s;s.onended=function(){delete tracked[s.id]};s.start(when,duration);return s};Player.prototype.stop=function(when,ids){when=when||0;var tracked=this._playing;function stopById(id){var p=tracked[id];if(!p)return null;p.stop();delete tracked[id];return id}if(!ids)return Object.keys(tracked).map(stopById);else if(Array.isArray(ids))return ids.map(stopById);else return stopById(ids)};Player.prototype.connect=function(destination){this.output.connect(destination);return this};Player.Sample=Sample;if(typeof module==="object"&&module.exports)module.exports=Player;if(typeof window!=="undefined")window.Player=Player;function from(a,b,c){return function(name){return name in a?a[name]:name in b?b[name]:c[name]}}function centsToRate(cents){return Math.pow(2,cents/1200)}function adsr(ac,adsr){return["attack","decay","sustain","release"].reduce(function(env,n,i){env[n]=adsr[i];return env},ADSR(ac))}},{adsr:2}],2:[function(require,module,exports){module.exports=ADSR;function ADSR(audioContext){var node=audioContext.createGain();var voltage=node._voltage=getVoltage(audioContext);var value=scale(voltage);var startValue=scale(voltage);var endValue=scale(voltage);node._startAmount=scale(startValue);node._endAmount=scale(endValue);node._multiplier=scale(value);node._multiplier.connect(node);node._startAmount.connect(node);node._endAmount.connect(node);node.value=value.gain;node.startValue=startValue.gain;node.endValue=endValue.gain;node.startValue.value=0;node.endValue.value=0;Object.defineProperties(node,props);return node}var props={attack:{value:0,writable:true},decay:{value:0,writable:true},sustain:{value:1,writable:true},release:{value:0,writable:true},getReleaseDuration:{value:function(){return this.release}},start:{value:function(at){var target=this._multiplier.gain;var startAmount=this._startAmount.gain;var endAmount=this._endAmount.gain;this._voltage.start(at);this._decayFrom=this._decayFrom=at+this.attack;this._startedAt=at;var sustain=this.sustain;target.cancelScheduledValues(at);startAmount.cancelScheduledValues(at);endAmount.cancelScheduledValues(at);endAmount.setValueAtTime(0,at);if(this.attack){target.setValueAtTime(0,at);target.linearRampToValueAtTime(1,at+this.attack);startAmount.setValueAtTime(1,at);startAmount.linearRampToValueAtTime(0,at+this.attack)}else{target.setValueAtTime(1,at);startAmount.setValueAtTime(0,at)}if(this.decay){target.setTargetAtTime(sustain,this._decayFrom,getTimeConstant(this.decay))}}},stop:{value:function(at,isTarget){if(isTarget){at=at-this.release}var endTime=at+this.release;if(this.release){var target=this._multiplier.gain;var startAmount=this._startAmount.gain;var endAmount=this._endAmount.gain;target.cancelScheduledValues(at);startAmount.cancelScheduledValues(at);endAmount.cancelScheduledValues(at);var expFalloff=getTimeConstant(this.release);if(this.attack&&at<this._decayFrom){var valueAtTime=getValue(0,1,this._startedAt,this._decayFrom,at);target.linearRampToValueAtTime(valueAtTime,at);startAmount.linearRampToValueAtTime(1-valueAtTime,at);startAmount.setTargetAtTime(0,at,expFalloff)}endAmount.setTargetAtTime(1,at,expFalloff);target.setTargetAtTime(0,at,expFalloff)}this._voltage.stop(endTime);return endTime}},onended:{get:function(){return this._voltage.onended},set:function(value){this._voltage.onended=value}}};var flat=new Float32Array([1,1]);function getVoltage(context){var voltage=context.createBufferSource();var buffer=context.createBuffer(1,2,context.sampleRate);buffer.getChannelData(0).set(flat);voltage.buffer=buffer;voltage.loop=true;return voltage}function scale(node){var gain=node.context.createGain();node.connect(gain);return gain}function getTimeConstant(time){return Math.log(time+1)/Math.log(100)}function getValue(start,end,fromTime,toTime,at){var difference=end-start;var time=toTime-fromTime;var truncateTime=at-fromTime;var phase=truncateTime/time;return start+phase*difference}},{}]},{},[1]);